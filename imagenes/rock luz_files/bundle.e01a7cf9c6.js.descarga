!function(){"use strict";function e(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function n(e){return function(){var n=this,i=arguments;return new Promise(function(r,a){var o=e.apply(n,i);function s(e){t(o,r,a,s,l,"next",e)}function l(e){t(o,r,a,s,l,"throw",e)}s(void 0)})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=c(e);if(t){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m(this,n)}}function g(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}var I=["Abadi MT Condensed","Agency FB","Aharoni","Aldhabi","Algerian","American Typewriter","Andale Mono","Apple Casual","Apple Chancery","Arial","Arial Black","Arial Narrow","Athelas","Avenir","Avenir Next","Avenir Next Condensed","Bangla","Baskerville","Batang","Bell MT","Bodoni","Book Antigua","Brush Script MT","Calibri","Californian FB","Calisto MT","Cambria","Century Schoolbook","Chalkboard","Chalkduster","Charter","Chiller","Colonna MT","Comic Sans MS","Copperplate","Courier New","Didot","Diwan","Estrangelo Edessa","Euphemia","Farah","Franklin Gothic","Futura","Garamond","Gautami","Geeza","Georgia","Gill Sans","Gill Sans MT","Goudy Old Style","Harrington","Helvetica","Helvetica Neue","Hoefler","Hoefler Text","Impact","Iowan Old Style","Jokerman","Juice ITC","Kohinoor Bangla","Latha","Lucida Sans","Magneto","Marion","Marker Felt","Menlo","Modern No. 20","Noteworthy","Optima","Palatino","Papyrus","PingFang HK","Rockwell","Savoye Let","Snell RoundHand","Superclarendon","Tahoma","Telugu","Thonburi","Times","Times New Roman","Trebuchet MS","Verdana","Vivaldi","Wide Latin"],T=[{name:"Amble",file:"amble"},{name:"Bear and Loupe",file:"bearandloupe"},{name:"Big Snow",file:"bigsnow"},{name:"Capture It",file:"captureit"},{name:"Carbon Type",file:"carbontype"},{name:"Carrington",file:"carrington"},{name:"Caviar dreams",file:"caviardreams"},{name:"Chomsky",file:"chomsky"},{name:"ChunkFive",file:"chunkfive"},{name:"Costura Light",file:"costuralight"},{name:"Crass Roots",file:"crassroots"},{name:"Deutsch Gothic",file:"deutschgothic"},{name:"Digna’s Handwriting",file:"dignashand"},{name:"Eczar SemiBold",file:"eczarsemibold"},{name:"Edo",file:"edo"},{name:"Eutemia I",file:"eutemia"},{name:"Free Universal",file:"freeuniversal"},{name:"Frente H1",file:"frenteh1"},{name:"Gothic Ultra",file:"gothicultra"},{name:"Gputeks",file:"gputeks"},{name:"Handserif",file:"handserif"},{name:"Harting",file:"harting"},{name:"Helsinki",file:"helsinki"},{name:"Henry Morgan Hand",file:"henrymorganhand"},{name:"Holitter Gothic",file:"holitter"},{name:"Hominis",file:"hominis"},{name:"HVD Comic Serif Pro",file:"hvdcomic"},{name:"Inkcalig",file:"inkcalig"},{name:"Itsadzoke",file:"itsadzoke"},{name:"Kawoszeh",file:"kawoszeh"},{name:"Kingthings Trypewriter",file:"kingthings"},{name:"Komika Axis",file:"komikaaxis"},{name:"Langdon",file:"langdon"},{name:"League Gothic",file:"leaguegothic"},{name:"League Spartan Bold",file:"leaguespartanbold"},{name:"Let’s Trace",file:"letstrace"},{name:"Mathlete Bulky",file:"mathletebulky"},{name:"Miama",file:"miama"},{name:"Norwester",file:"norwester"},{name:"Odstemplik",file:"odstemplik"},{name:"Okolaks",file:"okolaks"},{name:"Ostrich Sans",file:"ostrichsans"},{name:"Palitoon",file:"palitoon"},{name:"Peace Sans",file:"peacesans"},{name:"Pirou Regular",file:"pirouregular"},{name:"Pix Antiqua",file:"pixantiqua"},{name:"Playlist Script",file:"playlistscript"},{name:"Qwigley Regular",file:"qwigleyregular"},{name:"Raustila Regular",file:"raustilaregular"},{name:"Selima",file:"selima"},{name:"Silkscreen",file:"silkscreen"},{name:"Temporarium",file:"temporarium"},{name:"The Art of Illuminating",file:"artofillum"},{name:"Vavont",file:"vavont"},{name:"Veggieburger",file:"veggieburger"}],b=["Abel","Abhaya Libre:400,500,600,700,800","Abril Fatface","Alegreya:400,500,600,700,800,900","Alegreya Sans:100,300,400,500,700,800,900","Alfa Slab One","Allerta Stencil","Amaranth:400,700","Amatic SC:400,700","Amita:400,700","Annie Use Your Telescope","Anonymous Pro:400,700","Anton","Arapey","Architects Daughter","Archivo Black","Arima Madurai:100,200,300,400,500,700,800,900","Arizonia","Arvo:400,700","Arya:400,700","Averia Serif Libre:300,400,700","Bad Script","Bahianita","Bebas Neue","Bellota:300,400,700","Berkshire Swash","Beth Ellen","Bigelow Rules","BioRhyme Expanded:200,300,400,700,800","Boogaloo","Bowlby One","Bungee","Bungee Shade","Butcherman","Butterfly Kids","Cabin:400,500,600,700","Cairo:200,300,400,600,700,900","Candal","Caveat:400,500,600,700","Chango","Charmonman:400,700","Chewy","Chilanka","Cinzel:400,500,600,700,800,900","Cinzel Decorative:400,700,900","Coiny","Comfortaa:300,400,500,600,700","Concert One","Cookie","Cormorant Unicase:300,400,500,600,700","Creepster","Croissant One","Cutive Mono","Dancing Script:400,500,600,700","Darker Grotesque:300,400,500,600,700,800,900","Didact Gothic","Domine:400,500,600,700","Dosis:200,300,400,500,600,700,800","Economica:400,700","Elsie Swash Caps:400,900","Emblema One","Englebert","Euphoria Script","Exo:100,200,300,400,500,600,700,800,900","Exo 2:100,200,300,400,500,600,700,800,900","Fahkwang:200,300,400,500,600,700","Fjalla One","Fredericka the Great","Fredoka One","Fugaz One","Galada","Gochi Hand","Graduate","Grand Hotel","Gravitas One","Great Vibes","Gruppo","Handlee","Heebo:100,200,300,400,500,600,700,800,900","Hind:300,400,500,600,700","Homemade Apple","Indie Flower","Josefin Sans:100,200,300,400,500,600,700","Josefin Slab:100,200,300,400,500,600,700","Julius Sans One","Jura:300,400,500,600,700","Just Another Hand","Just Me Again Down Here","Kalam:300,400,700","Kameron:400,700","Karla:200,300,400,500,600,700,800","Khand:300,400,500,600,700","Krona One","Kumar One Outline","La Belle Aurore","Lato:100,300,400,700,900","Leckerli One","Lexend Exa","Libre Baskerville:400,700","Life Savers:400,700,800","Lily Script One","Limelight","Lobster","Lobster Two:400,700","Londrina Outline","Londrina Shadow","Londrina Sketch","Londrina Solid:100,300,400,900","Lora:400,500,600,700","Luckiest Guy","Maiden Orange","Marvel:400,700","Medula One","Megrim","Merriweather:300,400,700,900","Metamorphous","Modak","Monoton","Montserrat:100,200,300,400,500,600,700,800,900","Montserrat Alternates:100,200,300,400,500,600,700,800,900","Mountains of Christmas:400,700","Mr Bedfort","Mrs Sheppards","Mulish:200,300,400,500,600,700,800,900","Niconne","Nixie One","Nothing You Could Do","Nova Cut","Numans","Nunito:200,300,400,600,700,800,900","Old Standard TT:400,700","Oleo Script:400,700","Open Sans:300,400,600,700,800","Open Sans Condensed:300,700","Oranienbaum","Orbitron:400,500,600,700,800,900","Oswald:200,300,400,500,600,700","Overlock:400,700,900","Oxygen:300,400,700","Pacifico","Parisienne","Passion One:400,700,900","Pathway Gothic One","Pavanam","Paytone One","Permanent Marker","Petit Formal Script","Plaster","Playball","Playfair Display:400,500,600,700,800,900","Poller One","Poppins:100,200,300,400,500,600,700,800,900","Prata","Quattrocento:400,700","Questrial","Quicksand:300,400,500,600,700","Racing Sans One","Raleway:100,200,300,400,500,600,700,800,900","Rammetto One","Ravi Prakash","Red Hat Display:400,500,700,900","Righteous","Roboto:100,300,400,500,700,900","Roboto Mono:100,200,300,400,500,600,700","Roboto Slab:100,200,300,400,500,600,700,800,900","Rock Salt","Rokkitt:100,200,300,400,500,600,700,800,900","Rubik Mono One","Sacramento","Sanchez","Sancreek","Satisfy","Shadows Into Light","Shrikhand","Sigmar One","Six Caps","Slabo 27px","Slackey","Smokum","Sofia","Source Code Pro:200,300,400,500,600,700,900","Spicy Rice","Stint Ultra Expanded","Syncopate:400,700","Tangerine:400,700","Teko:300,400,500,600,700","Tenali Ramakrishna","Tenor Sans","Ubuntu:300,400,500,700","Ultra","Underdog","Unica One","Vampiro One","Varela","Varela Round","Vast Shadow","Vidaloka","Vollkorn:400,500,600,700,800,900","Wire One","Work Sans:100,200,300,400,500,600,700,800,900","Yantramanav:100,300,400,500,700,900","Yatra One","Yellowtail"],S={"ChunkFive Roman":"ChunkFive",Sigmar:"Sigmar One","Bowlby One SC":"Bowlby One","Londrina Sketche":"Londrina Sketch","Mr Bedford":"Mr Bedfort",Muli:"Mulish"},C={"Bookman Old Style":{name:"Quattrocento"},"Claire Hand":{name:"Chilanka",isAllCaps:!0,sizeScale:.8,lineHeightScale:1.25},Forque:{name:"Anton",isAllCaps:!0,sizeScale:.83,lineHeightScale:1.25},"Good Foot":{name:"Caveat"},Idolwild:{name:"Life Savers",isBold:!0,sizeScale:.88,charSpacingIncrement:100,lineHeightScale:1.18},"My Underwood":{name:"Kingthings Trypewriter",sizeScale:.96},"Myriad Pro":{name:"Yantramanav"},Teen:{name:"Questrial",isBold:!0},"Teen Light":{name:"Questrial"}},B=[{extension:"otf",cssFormat:"opentype",mimeType:"application/font-sfnt"},{extension:"ttf",cssFormat:"truetype",mimeType:"application/font-sfnt"},{extension:"woff",cssFormat:"woff",mimeType:"application/font-woff"}],F={100:"Thin",200:"Extra Light",300:"Light",400:"Regular",500:"Medium",600:"Semi Bold",700:"Bold",800:"Extra Bold",900:"Black"},E={100:"font_thickness_thin",200:"font_thickness_extra_light",300:"font_thickness_light",400:"font_thickness_regular",500:"font_thickness_medium",600:"font_thickness_semi_bold",700:"font_thickness_bold",800:"font_thickness_extra_bold",900:"font_thickness_black"};function P(e){if(!e.length)return 400;if(e.includes(400))return 400;if(e.includes(500))return 500;var t=e.filter(function(e){return e<400});return t.length?Math.max.apply(Math,v(t)):Math.min.apply(Math,v(e))}function k(e){return"number"==typeof e&&e%100==0&&e>=100&&e<=900}function N(e){return e.replace(/"/g,"").trim().replace(/(^'+)|('+$)/g,"").trim()}function M(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=(e=N(e)).replace(/\\/g,"");var n=/^[a-z][a-z0-9_]+$/i,i=/^(inherit|serif|sans-serif|monospace|fantasy|cursive|initial|default)$/i;return t||e.split(" ").some(function(e){return!e||!n.test(e)||i.test(e)})?'"'.concat(e,'"'):e}var D,w=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=a.isUserDefined,s=void 0!==o&&o,l=a.fileName,u=a.files,c=a.bgYOffset;i(this,e),this._name=this.validate("name",t),this._type=this.validate("type",n),"befunky"===n&&(this._fileName=this.validate("fileName",l)),this._isUserDefined=this.validate("isUserDefined",s),this.weights=r,u&&(this.files=u),"system"===n&&(this.isAvailable=null),s||"google"!==n&&"befunky"!==n||(this._bgYOffset=this.validate("bgYOffset",c))}return a(e,[{key:"validate",value:function(t,n){var i=this,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";throw console.log("FontVO:",i),console.log("Value:",n),new Error('Invalid FontVO property "'.concat(t,'". ').concat(e))},a={name:function(){return"string"!=typeof n&&r("Not string"),(n=N(n))||r("empty"),n},type:function(){return["google","befunky","system","uploaded"].includes(n)||r(),n},fileName:function(){return n&&"string"==typeof n||r(),n},isUserDefined:function(){return"boolean"!=typeof n&&r(),n&&"befunky"===i.type&&r(),n},isAvailable:function(){return"boolean"!=typeof n&&null!==n&&r(),"system"!==i.type&&r(),n},weights:function(){return Array.isArray(n)&&n.every(k)||r(),n.unique().sort()},files:function(){return Array.isArray(n)&&n.every(function(e){var t=e.weight,n=e.fileName;return k(t)&&n&&"string"==typeof n})||r(),"uploaded"!==i.type&&r(),n},replacedDefaultFont:function(){return n instanceof e&&(!n.isUserDefined||"system"===n.type)||r(),n},bgYOffset:function(){return"number"!=typeof n&&r(),!i.isUserDefined&&["befunky","google"].includes(i.type)||r(),n}};return a[t]||r("Property not supported"),a[t]()}},{key:"name",get:function(){return this._name}},{key:"type",get:function(){return this._type}},{key:"fileName",get:function(){return this._fileName}},{key:"isUserDefined",get:function(){return this._isUserDefined}},{key:"bgYOffset",get:function(){return this._bgYOffset}},{key:"weights",set:function(e){this._weights=this.validate("weights",e)},get:function(){return this._weights}},{key:"files",set:function(e){this._files=this.validate("files",e)},get:function(){return this._files}},{key:"isAvailable",set:function(e){this._isAvailable=this.validate("isAvailable",e)},get:function(){return this._isAvailable}},{key:"replacedDefaultFont",set:function(e){this._replacedDefaultFont=this.validate("replacedDefaultFont",e)},get:function(){return this._replacedDefaultFont}}]),e}();function L(){}window.BFN={},BFN.CSS={leftMenuBarWidth:56,topMenuBarHeight:56,imageManagerThumbSize:108,historyMenuThumbSize:24,historyMenuPreviewSize:240,sideMenuWidth:272,footerHeight:48,sideBySideImageHeight:144,sideBySideImageWidth:258,floatingElementBaseZIndex:12,appViewportBGZIndex:2e3,appViewportZIndex:2001,modalZIndex:1e3,dialogZIndex:9999999999},BFN.UI={},BFN.filters={},BFN.effects={},BFN.baseFrameRate=BeFunky.isEdgeHTML?24:40,BFN.maxZipSizeMB=500,BFN.minImageSize=32,BFN.maxImageSize=window.BfnmaxImageSize||4096,BFN.maxImageSizeForArtsy=BFN.maxImageSize,BFN.maxImageUploadSizeFreeUser=2500,BFN.maxImageSizeLayer=Math.min(window.BfnmaxImageSize,3264),BFN.minCollageSize=128,BFN.defaultCollageSize=3264,BFN.openedSections=[],BFN.imageTypes=["computer","sample","befunky_photo","befunky_layer","befunky_project","pixabay","unsplash","pexels","facebook","google_photos","patterns","graphic","text_mask","alpha_mask","collage_photo","mask_image","image","designer","template_svg","designer_template"],BFN.activePresetMenuItem=null,BFN.cluesToHideOnTablet=["cutout","guide_liquify_protip_1","guide_funkyfocus_protip_1","guide_funkyfocus_protip_2","guide_clone_protip","guide_blemish_fix_protip_1","guide_paint_mode_zoomed_in","erase_mode_background","erase_mode"],BFN._updatingTextTransformItem=null,Object.defineProperty(BFN,"updatingTextTransformItem",{set:function(e){UIToggler.showLoadScreenWhileTrue(BFN.checkUpdatingTextTransformItem,200),BFN._updatingTextTransformItem=e},get:function(){return BFN._updatingTextTransformItem}}),BFN.checkUpdatingTextTransformItem=function(){return BFN._updatingTextTransformItem||BFN.updatingTextQueue.length||BFN.accurateBoundsQueue.length},BFN.nextUid=0,BFN.uid=function(){return++BFN.nextUid},BFN.renderTexturesPool=null,BFN.renderTextureResolution=1,BFN.renderTextureResolutionLarge=1,BFN.updatingShapeQueue=[],BFN.updatingTextQueue=[],BFN.accurateBoundsQueue=[],BFN.floatingElements=[],BFN.addFloatingElement=function(e){BFN.floatingElements.includes(e)||(BFN.floatingElements.push(e),BFN.updateFloatingElementDisplay())},BFN.focusFloatingElement=function(e){if(BFN.floatingElements.includes(e)){var t=BFN.floatingElements.indexOf(e);BFN.floatingElements.splice(t,1),BFN.floatingElements.push(e),BFN.updateFloatingElementDisplay()}},BFN.updateFloatingElementDisplayImmediately=function(){BFN.floatingElements.forEach(function(e,t){if(e.hasClass("active")){var n=BFN.CSS.floatingElementBaseZIndex+t;BFN.FabricManager&&BFN.FabricManager.currentTextTransformItem&&e.zIndexOverFabric&&(n=BFN.CSS.appViewportZIndex+t+1),BeFunky.isModalOpen()&&e.zIndexOverModal&&(n=BFN.CSS.modalZIndex+t+1),e.setStyles({zIndex:n})}else e.setStyles({zIndex:-1})})},BFN.updateFloatingElementDisplay=BeFunky.debounce(BFN.updateFloatingElementDisplayImmediately,"ric"),BFN.tabRecentlyReopened=!1,BFN.hasEnteredEditor=!1,BFN.hasEnteredCollage=!1,BFN.hasEnteredDesigner=!1,BFN.hasFullyOpenedEditor=!1,BFN.toolViewstates={},BFN._applyCancelMenu=null,Object.defineProperty(BFN,"applyCancelMenu",{get:function(){return BFN._applyCancelMenu||(BFN._applyCancelMenu=document.getElementById("editor_apply_cancel_menu")),BFN._applyCancelMenu}}),BFN.sectionMemoryLimitMB=navigator.deviceMemory>=8?1500:1e3,BFN._smoothPicture=window.webglTextureSize&&window.webglTextureSize>8192?"always":"auto",Object.defineProperty(BFN,"smoothPicture",{set:function(e){["auto","always","never"].includes(e)&&(BFN._smoothPicture=e,BFN.smoothPictureDisabled=BFN.smoothPictureDisabled)},get:function(){return BFN._smoothPicture}}),BFN._smoothPictureDisabled=!1,Object.defineProperty(BFN,"smoothPictureDisabled",{set:function(e){BFN._smoothPictureDisabled="auto"===BFN._smoothPicture?e:"always"!==BFN._smoothPicture,BFN.MainUI.requestRender()},get:function(){return BFN._smoothPictureDisabled}}),BFN.retrievePresetThumbHelperGraphics=function(e){"texture"===e&&BFN.XMLGraphicLoader.loadTexturesThumbnailsXml().catch(function(){}),"effect"===e&&BFN.XMLGraphicLoader.loadEffectsThumbnailsJson().catch(function(){})},BFN.PhotoEditorCanvasModelViewStates={VIEWING_CANVAS:"VIEWING_CANVAS",VIEWING_TOUCH_UP:"VIEWING_TOUCH_UP",VIEWING_EFFECT:"VIEWING_EFFECT",VIEWING_ARTSY:"VIEWING_ARTSY",VIEWING_BORDER:"VIEWING_BORDER",VIEWING_DROP_SHADOW:"VIEWING_DROP_SHADOW",VIEWING_FRAME:"VIEWING_FRAME",VIEWING_TEXTURE:"VIEWING_TEXTURE",VIEWING_OVERLAY:"VIEWING_OVERLAY",VIEWING_LENS_FLARE:"VIEWING_LENS_FLARE",VIEWING_PAINT_BRUSH:"VIEWING_PAINT_BRUSH",VIEWING_CLONE:"VIEWING_CLONE",VIEWING_BLEMISH_FIX:"VIEWING_BLEMISH_FIX",VIEWING_BACKGROUND:"VIEWING_BACKGROUND",VIEWING_CUTOUT:"VIEWING_CUTOUT",VIEWING_CROP:"VIEWING_CROP",VIEWING_ROTATE:"VIEWING_ROTATE",VIEWING_RESIZE:"VIEWING_RESIZE",VIEWING_SLIMMING:"VIEWING_SLIMMING",VIEWING_RESHAPE:"VIEWING_RESHAPE",VIEWING_TILT:"VIEWING_TILT",VIEWING_FOCUS:"VIEWING_FOCUS",VIEWING_VIGNETTE:"VIEWING_VIGNETTE"},BFN.CONST={BLEND_MODES:{NORMAL:0,ADD:1,SUBTRACT:2,MULTIPLY:3,DARKEN:4,COLOR_BURN:5,LINEAR_BURN:6,LIGHTEN:7,SCREEN:8,COLOR_DODGE:9,LINEAR_DODGE:10,OVERLAY:11,SOFT_LIGHT:12,HARD_LIGHT:13,VIVID_LIGHT:14,LINEAR_LIGHT:15,PIN_LIGHT:16,DIFFERENCE:17,EXCLUSION:18,ERASE:19,ALPHA:20,COLOR:22,HUE:23,LUMINOSITY:24},PICTURE_RENDERER_FILTERS:{BLACK_WHITE:0,COLOR:1},ANALOG_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10},BWFX_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_12:12,PRESET_13:13,PRESET_14:14,PRESET_15:14},WARMFX_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11},CINEMATIC_PRESETS:{FILM_GRAIN:1,COLOR_GRADING:2,ANAMORPHIC:3,LENS_DISTORTION:4,WARPED_BLUR:5,CHROMATIC_ABERRATION:6},MULTIMEDIA_PRESETS:{SCAN_LINES:1,TELEVISION:2,HALFTONE_DUO:3},GLITCH_ART_PRESETS:{CORRUPTED:1,DISTORTED:2,SEGMENTED:3,FRAGMENTED:4,DIGITIZED:5},BLACK_WHITE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9},CHROMATIC_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10},CHARCOAL_PRESETS:{PRESET_1:1,PRESET_2:2},CYANOTYPE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6},VIEWFINDER_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_12:12},SUMMER_PRESETS:{PRESET_1:1,PRESET_2:2},UNITED_COLORS_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6},INSTANT_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_10:10,PRESET_11:11,PRESET_13:13},VINTAGE_COLORS_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9},HOLGA_ART_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5},LINE_ARTOPIA_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4},PINHOLE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5},STENCILER_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11},GRUNGE_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_13:13,PRESET_15:15,PRESET_16:16,PRESET_17:17},SUNBURST_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6},OLD_PHOTO_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_8:8,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_12:12,PRESET_13:13,PRESET_14:14,PRESET_15:15,PRESET_16:16,PRESET_17:17,PRESET_18:18,PRESET_19:19,PRESET_20:20},WINTER_PRESETS:{PRESET_1:1,PRESET_2:2},TILT_SHIFT_PRESETS:{PRESET_1:1,PRESET_2:2},PATRIOTIC_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7},POPART_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5,PRESET_6:6,PRESET_7:7,PRESET_9:9,PRESET_10:10,PRESET_11:11,PRESET_13:13,PRESET_14:14,PRESET_15:15,PRESET_16:16,PRESET_17:17,PRESET_18:18,PRESET_19:19,PRESET_20:20},MOTION_COLOR_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_5:5},LOMO_ART_PRESETS:{PRESET_1:1,PRESET_2:2,PRESET_3:3,PRESET_4:4,PRESET_6:6,PRESET_7:7},TOUCH_UP_PRESETS:{wrinkles:1,bronzer:2,blush:3,flashspot:4,mascara:6,eye_color:7,eye_brighten:8,eyebrow_pencil:9,fix_redeye:10,lipstick:11,teeth_whiten:12,haircolor:13,perfectskin:14},PALETTE_MAPS:{retroCol1:[[[0,28],[25,60],[44,83],[65,116],[85,135],[126,184],[148,198],[174,212],[190,223],[214,233],[234,244],[255,255]],[[0,0],[25,30],[41,53],[60,75],[88,113],[104,134],[134,173],[153,187],[169,196],[196,211],[216,219],[235,235],[255,240]],[[0,17],[23,38],[65,76],[93,104],[111,121],[121,131],[150,153],[165,171],[212,196],[232,203],[255,211]]],retroCol2:[[[0,0],[23,13],[44,28],[63,48],[83,71],[106,102],[128,131],[149,160],[170,185],[187,209],[214,231],[235,246],[255,255]],[[0,0],[23,13],[44,28],[63,48],[83,71],[106,102],[128,131],[149,160],[170,185],[187,209],[214,231],[235,246],[255,255]],[[0,31],[22,47],[41,62],[64,79],[82,95],[105,111],[128,129],[150,145],[170,161],[191,180],[212,196],[234,212],[255,224]]],retroCol3:[[[0,20],[24,46],[52,80],[61,90],[87,121],[110,143],[129,162],[152,184],[166,193],[196,209],[213,225],[232,232],[255,242]],[[0,0],[19,15],[41,43],[62,72],[88,106],[105,129],[123,152],[148,178],[172,197],[189,213],[212,226],[234,240],[255,255]],[[0,19],[22,41],[42,61],[64,86],[82,104],[104,124],[125,144],[151,164],[173,183],[215,209],[232,221],[255,232]]],retroCol4:[[[0,25],[22,56],[31,72],[78,149],[87,157],[101,175],[110,182],[129,194],[150,201],[172,202],[189,210],[214,223],[234,236],[255,255]],[[0,25],[31,55],[54,96],[65,118],[86,146],[127,185],[152,196],[169,203],[191,218],[212,230],[234,240],[255,255]],[[0,35],[23,54],[41,75],[65,107],[84,126],[108,156],[120,164],[143,182],[175,190],[198,201],[215,214],[234,225],[255,232]]],retroCol5:[[[0,0],[25,17],[44,34],[62,56],[86,95],[108,122],[130,154],[144,170],[165,193],[176,202],[211,229],[236,243],[234,236],[255,255]],[[0,0],[21,9],[46,24],[65,42],[85,65],[103,91],[128,127],[153,160],[172,182],[193,201],[213,222],[235,241],[255,255]],[[0,0],[21,9],[44,17],[66,32],[87,54],[104,75],[126,107],[150,143],[171,166],[192,189],[217,211],[238,225],[255,243]]],retroCol6:[[[0,139],[32,170],[51,173],[65,183],[76,186],[106,197],[126,208],[146,216],[168,223],[188,233],[213,240],[234,248],[255,255]],[[0,0],[24,61],[46,103],[60,124],[78,144],[102,166],[127,179],[146,193],[173,210],[195,226],[220,238],[234,244],[255,255]],[[0,58],[18,59],[42,60],[60,76],[81,105],[105,133],[126,151],[150,164],[170,179],[186,188],[207,195],[234,209],[255,211]]],retro6mask:[[[0,0],[108,137],[255,255]],[[0,0],[131,121],[255,255]],[[0,0],[33,50],[133,116],[255,255]]],retroCol7:[[[0,75],[22,81],[43,82],[63,113],[75,128],[96,151],[119,168],[147,201],[164,220],[191,222],[209,219],[235,225],[255,231]],[[0,54],[16,59],[30,55],[43,58],[77,87],[89,104],[111,124],[130,144],[155,169],[176,190],[188,202],[216,221],[237,240],[255,244]],[[0,65],[23,61],[40,65],[67,84],[90,118],[108,134],[134,167],[153,188],[175,209],[195,213],[211,210],[234,214],[255,208]]],retroCol8:[[[0,26],[15,43],[32,64],[65,114],[83,149],[109,178],[127,192],[147,201],[170,208],[195,218],[215,229],[234,242],[255,251]],[[0,0],[26,32],[49,72],[72,123],[89,147],[115,188],[148,205],[160,210],[177,222],[189,224],[215,235],[234,246],[255,254]],[[1,29],[30,72],[57,124],[74,147],[87,162],[108,175],[130,184],[152,189],[172,195],[187,203],[215,216],[239,237],[255,247]]],MegaContrast1:[[[0,0],[255,255]],[[0,0],[255,255]],[[0,0],[255,255]]],MegaContrast2:[[[0,0],[75,29],[178,204],[255,255]],[[0,25],[255,230]],[[0,0],[49,76],[255,255]]],crossProcess1:[[[0,0],[60,30],[210,255],[255,255]],[[0,0],[47,38],[101,111],[187,206],[255,255]],[[0,32],[255,216]]],crossProcess2:[[[0,0],[66,79],[195,182],[255,255]],[[0,0],[77,73],[199,177],[255,255]],[[0,0],[77,63],[186,200],[255,255]]],darkerMap:[[[0,0],[132,134],[203,173],[255,255]],[[0,0],[55,43],[171,180],[255,255]],[[0,0],[63,76],[159,138],[193,171],[255,255]]],contrast:[[[0,0],[78,51],[181,191],[255,255]],[[0,0],[78,51],[181,191],[255,255]],[[0,0],[78,51],[181,191],[255,255]]],contrastHigh:[[[0,0],[93,63],[168,195],[255,255]],[[0,0],[93,63],[168,195],[255,255]],[[0,0],[93,63],[168,195],[255,255]]],blackenCurve:[[[0,0],[201,85],[255,255]],[[0,0],[201,85],[255,255]],[[0,0],[201,85],[255,255]]]}},BFN.CONST.FONT_LIST=function(){var e=b.map(function(e,t){var n=f(e.split(":"),2),i=n[0],r=n[1];return new w(i,"google",function(e){return e.split(",").map(function(e){return parseInt(e)})}(void 0===r?"400":r),{bgYOffset:36*t})}),t=I.map(function(e){return new w(e,"system",[])}),n=T.map(function(e,t){var n=e.name,i=e.file;return new w(n,"befunky",[400],{fileName:i,bgYOffset:36*t})});return[].concat(v(e),v(t),v(n)).sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1})}(),BFN.assetsURL=BeFunky.Params.globalAssetsPath,BFN.imagesURL=BeFunky.Params.globalImagesPath,BFN.remoteImagesURL=BeFunky.Params.IS_LC?BeFunky.Params.remoteImagesPath:BeFunky.Params.globalImagesPath,BFN.jsURL="".concat(BFN.assetsURL,"js/"),BFN.originalTextureURl="".concat(BFN.remoteImagesURL,"app/textures/sml/"),BFN.thumbTextureURl="".concat(BFN.remoteImagesURL,"app/textures/texture_78/"),BFN.folderNames={goodies:"6JAN2020/",overlays:"11FEB2021/",patterns:"02FEB18/"},BFN.goodiesUrl="".concat(BFN.remoteImagesURL,"app/graphics/goodies/").concat(BFN.folderNames.goodies),BFN.overlaysUrl="".concat(BFN.remoteImagesURL,"app/graphics/overlays/").concat(BFN.folderNames.overlays),BFN.patternsUrl="".concat(BFN.remoteImagesURL,"app/graphics/patterns/").concat(BFN.folderNames.patterns),BFN.artsyThumbURL="".concat(BFN.imagesURL,"app/graphics/artsy/preview_v4/"),BFN.designerElementsUrl="".concat(BFN.remoteImagesURL,"app/graphics/designer_elements/svg/"),BFN.designerSourceTemplateURL="".concat(BeFunky.Params.remoteAssetsPath,"designer_templates_v2/"),BFN.designerTemplateFlashURL="".concat(BeFunky.Params.remoteAssetsPath,"designer_source_templates_flash/"),BFN.designerTemplatePreviewsUrl="".concat(BFN.remoteImagesURL,"app/designer_templates_v2/previews/"),BFN.patchPreviewImageUrl="".concat(BFN.remoteImagesURL,"app/template_patches/previews/"),BFN.assetsDataVersions={overlays_thumb:"",overlays_data:"",patterns_thumb:"",patterns_data:"",effects_thumbs_data:"_v1"},BFN.goodiesAssetsFolder={original:"org/",thumb:"t/"},BFN._appRect=null,BFN._appRectDiv=null,BFN._appRectMinSize=null,window.addEventListener("resize",function(){BFN._appRect=null}),Object.defineProperty(BFN,"appRect",{get:function(){var e=this._appRect;if(e&&!e.usingFallback)return e;if(this._appRectDiv=this._appRectDiv||BFN.appContainer,!this._appRectDiv)return n();var t=this._appRectDiv.getBoundingClientRect();return t&&t.width?i(t):n();function n(){if(e&&e.usingFallback)return e;var t=window.innerWidth,n=window.innerHeight;return i({usingFallback:!0,x:0,y:0,top:0,left:0,width:t,right:t,height:n,bottom:n})}function i(e){var t=BFN._appRectMinSize,n=e.x,i=e.y,r=e.top,a=e.left,o=e.width,s=e.height,l=a+(o=Math.max(t,o)),u=r+(s=Math.max(t,s-function(){"number"!=typeof D&&(D=BeFunky.isTablet&&parseInt(getComputedStyle(document.documentElement).getPropertyValue("--tablet-home-bar-safe-area"))||0);return D}()));return BFN._appRect={x:n,y:i,top:r,left:a,bottom:u,right:l,width:o,height:s},e}}}),Object.defineProperty(BFN,"appViewportRect",{get:function(){var e=BFN.appRect,t=e.x,n=e.y,i=e.top,r=e.left,a=e.bottom,o=e.right,s=e.width,l=e.height,u=BFN.CSS.topMenuBarHeight;i+=u,n+=u,l-=u;var c=BFN.CSS.footerHeight;l-=c,a-=c;var h,d,m=BFN.getAppViewportLeftOffset();return h={x:t+=m,y:n,top:i,left:r+=m,bottom:a,right:o,width:s-=m,height:l},d=BFN._appRectMinSize,h.width=Math.max(d,h.width),h.height=Math.max(d,h.height),h.right=h.left+h.width,h.bottom=h.top+h.height,h}}),BFN.getAppViewportLeftOffset=function(){return BFN.CSS.leftMenuBarWidth},BFN.XHelpers={},BFN.XHelpers.emptyContainer=new PIXI.Container,PIXI.RenderTexture.prototype.clear=function(){BFN.Stage.render(BFN.XHelpers.emptyContainer,this,!0),this.undetermineTransparency()},BFN.XHelpers.clearRect=null,PIXI.Texture.prototype.clearRect=PIXI.RenderTexture.prototype.clearRect=function(e,t,n,i){var r=BFN.Stage.gl;if(r){r.disable(r.BLEND),BFN.XHelpers.clearRect||(BFN.XHelpers.clearRect=new PIXI.Graphics,BFN.XHelpers.clearRect.beginFill(0,0),BFN.XHelpers.clearRect.drawRect(0,0,100,100),BFN.XHelpers.clearRect.endFill());var a=BFN.XHelpers.clearRect;a.x=e,a.y=t,a.width=n,a.height=i,BFN.Stage.render(a,this,!1),r.enable(r.BLEND),this.undetermineTransparency()}},BFN.XHelpers.fillRect=new PIXI.Graphics,PIXI.RenderTexture.prototype.fillRect=function(e,t,n,i,r,a){var o=BFN.Stage.gl;if(o){o.disable(o.BLEND);var s=BFN.XHelpers.fillRect;s.clear(),s.beginFill(r,a),s.drawRect(0,0,n,i),s.endFill(),s.x=e,s.y=t,BFN.Stage.render(s,this,!1),o.enable(o.BLEND),this.undetermineTransparency()}},PIXI.RenderTexture.prototype.fillColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=BFN.Stage.gl;n.disable(n.BLEND);var i=BFN.XHelpers.fillRect;i.clear(),i.beginFill(e,t),i.drawRect(0,0,this.width,this.height),i.endFill(),i.x=0,i.y=0,BFN.Stage.render(i,this,!1),n.enable(n.BLEND),this.undetermineTransparency()},PIXI.RenderTexture.prototype.fillColorOverlap=function(e,t,n,i,r,a){e=e||0,t=t||1,n=n||0,i=i||0,r=r||this.width,a=a||this.height;var o=BFN.XHelpers.fillRect;o.clear(),o.beginFill(e,t),o.drawRect(0,0,r,a),o.endFill(),o.x=n,o.y=i,BFN.Stage.render(o,this,!1),this.undetermineTransparency()},PIXI.RenderTexture.prototype.determineTransparency=PIXI.Texture.prototype.determineTransparency=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:48;if(!this.baseTexture)return!1;if(this.baseTexture.hasOwnProperty("isTransparent")&&!e)return this.baseTexture.isTransparent;var n=BFN.Util.getThumbTexture(this,Math.min(t,this.width,this.height),!1,!1);return this.isTransparent=BFN.Util.isTransparent(n),n.destroyGC(!0),this.isTransparent},PIXI.RenderTexture.prototype.undetermineTransparency=PIXI.Texture.prototype.undetermineTransparency=function(){this.baseTexture&&this.baseTexture.hasOwnProperty("isTransparent")&&delete this.baseTexture.isTransparent},Object.defineProperty(PIXI.Texture.prototype,"isTransparent",{set:function(e){this.baseTexture&&(this.baseTexture.isTransparent=!!e)},get:function(){return this.baseTexture?!!this.baseTexture.isTransparent:void 0}}),Object.defineProperty(PIXI.RenderTexture.prototype,"isTransparent",{set:function(e){this.baseTexture&&(this.baseTexture.isTransparent=!!e)},get:function(){return this.baseTexture?this.baseTexture.isTransparent:void 0}}),BFN.XHelpers.renderSprite=new PIXI.Sprite,BFN.XHelpers.renderSprite.pluginName="smooth_picture",BFN.XHelpers.renderContainer=new PIXI.Container,BFN.XHelpers.renderContainer.addChild(BFN.XHelpers.renderSprite),PIXI.RenderTexture.prototype.copyPixels=function(t,n,i,r,a,o){null==n&&(n={x:0,y:0}),null==i&&(i=!0),null==r&&(r=1),null==a&&(a=1);var s="object"===e(a)&&a.hasOwnProperty("x")?a.x:a,l="object"===e(a)&&a.hasOwnProperty("y")?a.y:a;null==o&&(o=16777215);var u=BFN.XHelpers.renderSprite,c=BFN.XHelpers.renderContainer;u.texture=t,u.x=n.x,u.y=n.y,u.alpha=r,u.scale.x=u.currentScale=s,u.scale.y=u.currentScaleY=l,u.tint=o,BFN.Stage.render(c,this,i),u.texture=null,this.undetermineTransparency()},PIXI.RenderTexture.prototype.invert=function(){var e=new PIXI.Container,t=new PIXI.Graphics;t.beginFill(16777215),t.drawRect(0,0,this.width,this.height),e.addChild(t);var n=new PIXI.Sprite(this);n.pluginName="blend_picture",n.blendMode=BFN.CONST.BLEND_MODES.DIFFERENCE,e.addChild(n);var i=PIXI.RenderTexture.create(this.width,this.height);BFN.Stage.render(n,i),BFN.Stage.render(e,i),this.copyPixels(i),e.removeChild(n),n.destroy(!1),e.removeChild(t),t.clear()},PIXI.RenderTexture.prototype.convertLumaToAlpha=function(){var e=new PIXI.Container,t=new PIXI.Graphics;t.beginFill(16777215),t.drawRect(0,0,this.width,this.height),t.endFill(),e.addChild(t);var n=new PIXI.Sprite(this);e.addChild(n),t.mask=n;var i=PIXI.RenderTexture.create(this.width,this.height);BFN.Stage.render(n,i),BFN.Stage.render(e,i),this.copyPixels(i),e.removeChild(n),n.destroy(!1),e.removeChild(t),t.clear()},PIXI.RenderTexture.prototype.convertAlphaToLuma=function(){var e=new PIXI.Container,t=new PIXI.Graphics;t.beginFill(0),t.drawRect(0,0,this.width,this.height),t.endFill(),e.addChild(t);var n=new PIXI.Sprite(this);n.pluginName="blend_picture",n.fillColor=16777215,n.intensity=1,e.addChild(n);var i=PIXI.RenderTexture.create(this.width,this.height);BFN.Stage.render(n,i),BFN.Stage.render(e,i),this.copyPixels(i),e.removeChild(n),n.destroy(!1),e.removeChild(t),t.clear()},PIXI.Texture.prototype.renderClone=function(){var e=PIXI.RenderTexture.create(this.width,this.height);return e.copyPixels(this),this.baseTexture&&this.baseTexture.hasOwnProperty("isTransparent")&&(e.isTransparent=this.isTransparent),e},PIXI.RenderTexture.prototype.save=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"saved_render_texture",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];void 0!==window.saveTexture&&window.saveTexture(this,e,t,n,i)},PIXI.RenderTexture.prototype.destroyGC=function(e){if(this.baseTexture&&this.baseTexture.maskTexture){try{this.baseTexture.maskTexture.destroyGC(!0)}catch(e){}delete this.baseTexture.maskTexture}this.destroy(e)},PIXI.Texture.prototype.save=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"saved_texture",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0!==window.saveTexture&&window.saveTexture(this,e,t,n)},PIXI.Texture.prototype.destroyGC=function(e){if(this.baseTexture&&this.baseTexture.maskTexture){try{this.baseTexture.maskTexture.destroyGC(!0)}catch(e){}delete this.baseTexture.maskTexture}this.destroy(e)},PIXI.Texture.prototype.setScaleMode=function(e){switch(BFN.Stage.bindTexture(this,null,!0),e){case PIXI.SCALE_MODES.NEAREST:this.baseTexture._glTextures[0].enableNearestScaling();break;case PIXI.SCALE_MODES.LINEAR:this.baseTexture._glTextures[0].enableLinearScaling()}BFN.Stage.unbindTexture(this)},PIXI.Container.prototype.getMousePosition=function(){return BFN.Stage.plugins.interaction.mouse.getLocalPosition(this)},PIXI.Container.prototype.getPointerPosition=function(e){return e.data.getLocalPosition(this)},PIXI.Graphics.prototype.getMousePosition=function(){return BFN.Stage.plugins.interaction.mouse.getLocalPosition(this)},PIXI.Graphics.prototype.getPointerPosition=function(e){var t=null;return e?t=e.data.getLocalPosition(this):BFN.MainUI.pointerEvent&&(t=BFN.MainUI.pointerEvent.data.getLocalPosition(this)),t||new PIXI.Point},PIXI.WebGLRenderer.prototype.uploadTextureData=function(e,t){BFN.PIXITicker.started||BFN.PIXITicker.start(),BFN.PIXITicker.keepRunning=!0,this.plugins.prepare.upload(e,function(){BFN.PIXITicker.keepRunning=!1,BFN.PIXITicker.started&&!BFN.PIXITicker.stopPending&&BFN.PIXITicker.stop(),t&&t()})},BFN.reportAppBreadcrumbs=!0,BFN.reportAppBreadcrumbs&&(PIXI.Container.prototype.addChildOriginal=PIXI.Container.prototype.addChild,PIXI.Container.prototype.addChild=function(e){for(var t=0;t<arguments.length;t++){var n=this.addChildOriginal(arguments[t]);BFN.SentryManager&&BFN.SentryManager.registerDisplayObject(n,!0)}return e},PIXI.Container.prototype.addChildAtOriginal=PIXI.Container.prototype.addChildAt,PIXI.Container.prototype.addChildAt=function(e,t){var n=this.addChildAtOriginal(e,t);return BFN.SentryManager&&BFN.SentryManager.registerDisplayObject(n,!0),e},PIXI.Container.prototype.removeChildOriginal=PIXI.Container.prototype.removeChild,PIXI.Container.prototype.removeChild=function(e){for(var t=0;t<arguments.length;t++){var n=this.removeChildOriginal(arguments[t]);BFN.SentryManager&&BFN.SentryManager.unregisterDisplayObject(n)}return e},PIXI.Container.prototype.removeChildAtOriginal=PIXI.Container.prototype.removeChildAt,PIXI.Container.prototype.removeChildAt=function(e){var t=this.removeChildAtOriginal(e);return BFN.SentryManager&&BFN.SentryManager.unregisterDisplayObject(t),t},PIXI.Container.prototype.removeChildrenOriginal=PIXI.Container.prototype.removeChildren,PIXI.Container.prototype.removeChildren=function(){var e=this.removeChildrenOriginal(arguments[0],arguments[1]);if(BFN.SentryManager)for(var t=0;t<e.length;t++)BFN.SentryManager.unregisterDisplayObject(e[t]);return e}),fabric.TextboxPad=fabric.util.createClass(fabric.Textbox,{_renderBackground:function(e){if(this.hasOwnProperty("backgroundOverrideColor")||(this.backgroundOverrideColor=""),this.hasOwnProperty("backgroundOverridePadding")||(this.backgroundOverridePadding=0),this.backgroundColor||this.backgroundOverrideColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundOverrideColor?this.backgroundOverrideColor:this.backgroundColor;var n=this.backgroundOverrideColor?this.backgroundOverridePadding:this.padding;e.fillRect(-t.x/2-n,-t.y/2-n,t.x+2*n,t.y+2*n),this._removeShadow(e)}}}),fabric.util.object.extend(fabric.TextboxPad.prototype,{initDimensions:function(){if(!this.__skipDimension){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}),this.prevScaledHeight=this.prevScaledHeight||0;var e=this.height*this.scaleY;Math.abs(e-this.prevScaledHeight)>.1&&(this.fire("height:changed",{target:this,before:this.prevScaledHeight||0,after:e}),this.prevScaledHeight=e)}},_renderTextStroke:function(e){this.outlineEnabled&&(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderTextLinesBackground:function(e){if(this.highlightEnabled&&(this.textBackgroundColor||this.styleHas("textBackgroundColor"))){for(var t,n,i,r,a,o,s=0,l=e.fillStyle,u=this._getLeftOffset(),c=this._getTopOffset(),h=0,d=0,m=0,p=this._textLines.length;m<p;m++)if(t=this.getHeightOfLine(m),this.textBackgroundColor||this.styleHas("textBackgroundColor",m)){i=this._textLines[m],n=this._getLineLeftOffset(m),d=0,h=0,r=this.getValueOfPropertyAt(m,0,"textBackgroundColor");for(var g=0,f=i.length;g<f;g++)a=this.__charBounds[m][g],(o=this.getValueOfPropertyAt(m,g,"textBackgroundColor"))!==r?(e.fillStyle=r,r&&e.fillRect(u+n+h,c+s,d,t/this.lineHeight),h=a.left,d=a.width,r=o):d+=a.kernedWidth;o&&(e.fillStyle=o,e.fillRect(u+n+h,c+s,d,t/this.lineHeight)),s+=t}else s+=t;e.fillStyle=l,this._removeShadow(e)}},styleIsEmpty:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e&&"string"==typeof e){t=t||this.styles;var n=!0;for(var i in t){var r=t[i];for(var a in r){var o=r[a];n&&o[e]&&(n=!1)}}return n}},setStyles:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&e instanceof Object){for(var i in t=t||this.styles){var r=t[i];for(var a in r){var o=r[a];for(var s in e)o[s]=e[s]}}n&&t!==this.styles&&this.setStyles(e)}}}),fabric.enableWordBreaks=!0,fabric.wordBreakMethods={wordBreaksEnabled:!0,updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.preventWrapTextSelectionModify=!0,this.initDimensions(),this.preventWrapTextSelectionModify=!1,this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=this.hiddenTextarea.prevSelectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=this.hiddenTextarea.prevSelectionEnd=e.selectionEnd}this.updateTextareaPosition()}},fromStringToGraphemeSelection:function(e,t,n){if(this.wordBreakIndices)for(var i=0,r=0;r<this.wordBreakIndices.length;r++){var a=this.wordBreakIndices[r]+i;e>=a&&(e=Math.min(this.textLength,e+1)),t>=a&&(t=Math.min(this.textLength,t+1)),i+=1}return{selectionStart:e,selectionEnd:t}},fromGraphemeToStringSelection:function(e,t,n){if(this.wordBreakIndices)for(var i=0;i<this.wordBreakIndices.length;i++){var r=this.wordBreakIndices[i];e>r&&(e=Math.max(0,e-1)),t>r&&(t=Math.max(0,t-1))}return{selectionStart:e,selectionEnd:t}},trackStyles:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"trackStyles";console.log(e);var t={};for(var n in this.styles){t[n]={};var i=this.styles[n],r=0;for(var a in i)t[n][a]=Object.assign(this.styles[n][a]),r++;console.log(n,":",r)}console.log(t),console.log("")},getSelectionStartFromPointer:function(e){if(!this.canvas)return 0;var t=this.getLocalPointer(e),n=0,i=0,r=0,a=0,o=0;this.flipX&&(t.x=this.width*this.scaleX-t.x),this.flipY&&(t.y=this.height*this.scaleY-t.y);for(var s=0,l=this._textLines.length;s<l&&r<=t.y;s++)r+=this.getHeightOfLine(s)*this.scaleY,o=s,s>0&&(a+=this._textLines[s-1].length+1);i=this._getLineLeftOffset(o)*this.scaleX;for(var u=0,c=this._textLines[o].length;u<c&&(n=i,(i+=this.__charBounds[o][u].kernedWidth*this.scaleX)<=t.x);u++)a++;return this._getNewSelectionStartFromOffset(t,n,i,a,c)},_getNewSelectionStartFromOffset:function(e,t,n,i,r){var a=e.x-t,o=n-e.x,s=i+(o>a||o<0?0:1);return s>(this.textLength||this._text.length)&&(s=this.textLength||this._text.length),s},onKeyDown:function(e){if(this.isEditing&&!this.inCompositionMode){if(e.keyCode in this.keysMap){var t=["moveCursorLeft","moveCursorRight"],n=["moveCursorUp","moveCursorDown"],i=this.keysMap[e.keyCode];this.flipX&&t.includes(i)&&(i=t[(t.indexOf(i)+1)%t.length]),this.flipY&&n.includes(i)&&(i=n[(n.indexOf(i)+1)%n.length]),this[i](e)}else{if(!(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey)))return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),this.isEditing){this.preventWrapTextSelectionModify=!0;var n,i,r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,a=this._text.length,o=r.length,s=o-a;if(this.preventWrapTextSelectionModify=!1,""===this.hiddenTextarea.value)return this.inputErase=!0,this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var l={selectionStart:this.hiddenTextarea.selectionStart,selectionEnd:this.hiddenTextarea.selectionEnd},u={selectionStart:this.hiddenTextarea.prevSelectionStart,selectionEnd:this.hiddenTextarea.prevSelectionEnd};this.hiddenTextarea.prevSelectionStart=this.hiddenTextarea.selectionStart,this.hiddenTextarea.prevSelectionEnd=this.hiddenTextarea.selectionEnd;var c=u.selectionStart>l.selectionStart,h=u.selectionStart===l.selectionStart&&l.selectionStart===l.selectionEnd;if(this.inputErase=c||h,u.selectionStart!==u.selectionEnd?(n=this._text.slice(u.selectionStart,u.selectionEnd),s+=u.selectionEnd-u.selectionStart):o<a&&(n=c?this._text.slice(u.selectionEnd+s,u.selectionEnd):this._text.slice(u.selectionStart,u.selectionStart-s)),i=r.slice(l.selectionEnd-s,l.selectionEnd),n&&n.length&&(u.selectionStart!==u.selectionEnd?this.removeStyleFromTo(u.selectionStart,u.selectionEnd):c?this.removeStyleFromTo(u.selectionEnd-n.length,u.selectionEnd):this.removeStyleFromTo(u.selectionEnd,u.selectionEnd+n.length)),i.length)if(t&&i.join("")===fabric.copiedText)this.insertNewStyleBlock(i,u.selectionStart,fabric.copiedTextStyle);else if(t)for(var d=this.hiddenTextarea.value.split("\n"),m=0;m<d.length;m++){this.styles.hasOwnProperty(m)||(this.styles[m]={});for(var p=0;p<=d[m].length;p++)this.styles[m].hasOwnProperty(p)||(this.styles[m][p]={})}else this.insertNewStyleBlock(i,u.selectionStart);this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},_wrapLine:function(e,t,n,i){n-=i=i||0,t||(this.dynamicMinWidthWord=0,this.dynamicMinWidthWordChar=0,this.textLength=this.text.length,this.wordWrapped=!1,this.wordBreaks=0,this.wordBreakIndices?this.wordBreakIndices.splice(0):this.wordBreakIndices=[],this.isEditing&&this.hiddenTextarea&&!this.preventWrapTextSelectionModify&&(this.selectionStart=this.hiddenTextarea.selectionStart,this.selectionEnd=this.hiddenTextarea.selectionEnd));var r=this.text.split(this._reNewline),a=0;if(t<r.length)for(var o=0;o<=t;o++){var s=r[o];o<t?a+=s.length+1:a+s.length}var l,u,c,h,d,m,p,g,f=[],v=[],y=0,x=!0,_=0,I=0,T=0,b=0,S=0,C=this._getWidthOfCharSpacing(),B=e.split(this._reSpaceAndTab);for(o=0;o<B.length;o++){if(u=B[o],c=fabric.util.string.graphemeSplit(u),h=this._measureWord(c,t,S),(d=this.wordBreaksEnabled&&h-C>n)||(S+=c.length),(y+=h+b-C)>=n&&!x?(f.push(v),v=[],y=h,x=!0):y+=C,!x&&v.push(" "),b=this._measureWord([" "],t,S),d)for(this.wordWrapped=!0,y=0,null,l=0;l<c.length;l++)m=c[l],(y+=(p=this._measureWord([m],t,S,null))-(l===c.length-1?C:0))>=n&&!x?(f.push(v),v=[],y=p,x=!0,g=a+S,this.wordBreakIndices.push(g),this.isEditing&&!this.preventWrapTextSelectionModify&&(g+this.wordBreaks+_<=this.selectionStart&&this.selectionStart++,g+this.wordBreaks+_<this.selectionEnd&&this.selectionEnd++),_++):y+=l===c.length-1?C:0,v.push(m),S++,x=!1,p>T&&(T=p);else v=v.concat(c);S++,x=!1,h>I&&(I=h)}return o&&f.push(v),this.textLength+=_,this.wordBreaks+=_,I+i>this.dynamicMinWidthWord&&(this.dynamicMinWidthWord=I-C+i),T+i>this.dynamicMinWidthWordChar&&(this.dynamicMinWidthWordChar=T-C+i),this.dynamicMinWidth=this.wordWrapped?this.dynamicMinWidthWordChar:this.dynamicMinWidthWord,f},_measureWord:function(e,t,n,i){var r=0;n=n||0;for(var a=0,o=e.length;a<o;a++){r+=this._getGraphemeBox(e[a],t,a+n,i,!0).kernedWidth,i=e[a]}return r},getSelectedText:function(){if(this.hiddenTextarea)return this.hiddenTextarea.value.substring(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd)},_extendStyles:function(e,t){var n=this.get2DCursorLocation(e,!0);this.styles[n.lineIndex]||(this.styles[n.lineIndex]={}),this.styles[n.lineIndex][n.charIndex]?this.isEditing&&(e=this.modifySelectionIndex(e,-1),n=this.get2DCursorLocation(e,!0)):this.styles[n.lineIndex][n.charIndex]={},this.styles[n.lineIndex][n.charIndex]&&fabric.util.object.extend(this.styles[n.lineIndex][n.charIndex],t)},getSelectionStyles:function(e,t,n){void 0===e&&(e=this.selectionStart||0),void 0===t&&(t=this.selectionEnd||e),(e=this.modifySelectionIndex(e,-1))===(t=this.modifySelectionIndex(t,-1))&&(e>0?e--:t<this.text.length&&t++),e===t-1&&this.text.length&&t<=this.text.length&&this._reNewline.test(this.text.substring(e,t))&&t<this.text.length&&!this._reNewline.test(this.text.substring(e+1,t+1))&&(e++,t++);for(var i=[],r=e;r<t;r++)i.push(this.getStyleAtPosition(r,n,!0));return i},getStyleAtPosition:function(e,t,n){var i=this.get2DCursorLocation(e,n);this.gettingStyleAtPosition=!0;var r=t?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex);return this.gettingStyleAtPosition=!1,r||{}},_getStyleDeclaration:function(e,t){if(this._styleMap&&!this.isWrapping&&!this.gettingStyleAtPosition){var n=this._styleMap[e];if(!n)return null;e=n.line,t=n.offset+t}var i=this.styles&&this.styles[e];return i?i[t]:null},modifySelectionIndex:function(e,t){if(this.wordBreakIndices){for(var n=0;n<this.wordBreakIndices.length;n++)e+=this.wordBreakIndices[n]<e?t:0;e=Math.max(0,Math.min(this.textLength,e))}return e},searchWordBoundary:function(e,t){for(var n=this._reSpace.test(this.text.charAt(e))?e-1:e,i=this.text.charAt(n),r=/[ \n\.,;!\?\-]/;!r.test(i)&&n>0&&n<this.text.length;)if(n+=t,i=this.text.charAt(n),-1===t&&r.test(i)){n-=t,i=this.text.charAt(n);break}return r.test(i)&&"\n"!==i&&(n+=1===t?0:1),n},selectWord:function(e){e=this.modifySelectionIndex(e||this.selectionStart,-1),this.selectionStart=this.modifySelectionIndex(this.searchWordBoundary(e,-1),1),this.selectionEnd=this.modifySelectionIndex(this.searchWordBoundary(e,1),1),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){return e=this.modifySelectionIndex(e||this.selectionStart,-1),this.selectionStart=this.modifySelectionIndex(this.findLineBoundaryLeft(e),1),this.selectionEnd=this.modifySelectionIndex(this.findLineBoundaryRight(e),1),this._fireSelectionChanged(),this._updateTextarea(),this}},fabric.enableWordBreaks&&fabric.util.object.extend(fabric.TextboxPad.prototype,fabric.wordBreakMethods),BFN.getCanvasCoordinates=function(e,t,n){e="number"==typeof e&&e>=0?e:0,t="number"==typeof t&&t>=0?t:0;var i=(n=n||BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas)).scale.x,r=(e-BFN.CSS.leftMenuBarWidth-BFN.MainUI.x-n.x)/i,a=(t-BFN.CSS.topMenuBarHeight-BFN.MainUI.y-n.y)/i;return new PIXI.Point(r,a)},BFN.getImageType=function(e){if("string"==typeof e){var t=BFN.imageTypes.find(function(t){return e.startsWith("".concat(t,"_"))});if(t)return t;BeFunky.throwError('MenuImageVO id "'.concat(e,'" does not have a valid type'))}else BeFunky.throwError("MenuImageVO id must be a string: ".concat(e," (").concat(BeFunky.getType(e),")"))},BFN.toTitleCase=function(e){var t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return e.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(e,n,i){return n>0&&n+e.length!==i.length&&e.search(t)>-1&&":"!==i.charAt(n-2)&&("-"!==i.charAt(n+e.length)||"-"===i.charAt(n-1))&&i.charAt(n-1).search(/[^\s-]/)<0?e.toLowerCase():e.substr(1).search(/[A-Z]|\../)>-1?e:e.charAt(0).toUpperCase()+e.substr(1)})},BFN.getDateParts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t="".concat(e.getMonth()+1),n="".concat(e.getDate()),i="".concat(e.getFullYear());t.length<2&&(t="0".concat(t)),n.length<2&&(n="0".concat(n));var r=e.toTimeString().split(" ")[0].split(":");return[i,t,n].concat(v(r))},BFN.getExtension=function(e){if(!e.includes("."))return"";var t;try{if("jpg_large"===(t=e.split(".").pop().toLowerCase())&&(t="jpg"),!/^[a-z0-9]{1,10}$/.test(t))throw"invalid_extension"}catch(n){BeFunky.throwError("Unable to get file extension",e,n),t=""}return t},BFN.formatKeyString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("string"!=typeof e)return"";var r=v(n);r.forEach(function(e,t){r[t]=e.toLowerCase()});var a=e.split("_").join(" ").split(" "),o=[];return a.forEach(function(e){r.includes(e.toLowerCase())||o.push(i?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e.toLowerCase())}),o.join(t)},BFN.shortcutText=function(e){return[BeFunky.isMac?"⌘":"Ctrl"].concat(v(e.split(""))).join(BeFunky.isMac?" ":"".concat(" ","+").concat(" "))},BFN.openImageShortcutText=function(e){return[BeFunky.isMac&&!BeFunky.isSafari?"⌘":"Ctrl"].concat(v(e.split(""))).join(BeFunky.isMac&&!BeFunky.isSafari?" ":"".concat(" ","+").concat(" "))},BFN.shortcutString=function(e){var t=document.createElement("string");return t.className="shortcut",BeFunky.isMac||t.setStyles({letterSpacing:"-0.5px"}),t.textContent=e,t},Object.assign(L.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.dispatcher=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e)}}}}),BFN.EventDispatcher=L,BFN.FilterHelper={getNextPowerOfTwo:function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},hex2rgb:function(e,t){-1==e.indexOf("0x")&&(e="0x"+e);var n=[];return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,1==t&&(e.length>8?n[3]=(e>>24&255)/255:n[3]=1),n},hex2rgbForPlugin:function(e,t){return(t=t||[])[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t},hex32torgba:function(e){var t=[];return t[3]=((4278190080&e)>>>24)/255,t[0]=((16711680&e)>>>16)/255,t[1]=((65280&e)>>>8)/255,t[2]=(255&e)/255,t},hex2rgbFactor:function(e){var t=[];return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t},normalize:function(e,t,n){return(e-t)/(n-t)},calculateFilterClamp:function(e,t,n){var i=e.size.width-t.destinationFrame.width,r=e.size.height-t.destinationFrame.height,a=0==i?1:1-i/e.size.width,o=0==r?1:1-r/e.size.height;if(null!=n){var s=n.width!=t.defaultFrame.width?Math.abs(t.defaultFrame.width-n.width):n.height!=t.defaultFrame.height?Math.abs(t.defaultFrame.height-n.height):null;null!=s&&(a+=s/e.size.width,o+=s/e.size.height)}return{x:1/a,y:1/o}},createLinearGradient:function(e,t,n,i,r,a,o,s,l,u,c){if(null==e&&(e=["rgba(255, 0 ,0, 1.0)","rgba(255, 0 ,255, 1.0)","rgba(0, 0 ,255, 1.0)","rgba(0, 255 ,255, 1.0)","rgba(0, 255 ,0, 1.0)","rgba(255, 255 ,0, 1.0)","rgba(255, 0 ,0, 1.0)"]),null==t&&(t=[0,38,85,128,170,214,255],u=!0),t=BFN.FilterHelper.copy(t),1==u)for(var h=0;h<t.length;h++)t[h]=t[h]/255;null==n&&(n=0),null==i&&(i=0),null==r&&(r=256),null==a&&(a=3);var d=document.createElement("canvas");d.width=r<<1,d.height=a<<1,d.ctx=d.getContext("2d"),d.ctx.save();var m=null;m=l==-Math.PI/2?d.ctx.createLinearGradient(0,a,0,0):l==-Math.PI/4?d.ctx.createLinearGradient(0,a,r,0):d.ctx.createLinearGradient(0,0,r,0);for(var p=0,g=e.length;p<g;p++)m.addColorStop(t[p],e[p]);d.ctx.fillStyle=m,d.ctx.fillRect(n,i,r,a);var f=null;if(1==c){var v=new PIXI.Sprite(PIXI.Texture.fromCanvas(d,BFN.PIXIScaleMode));f=PIXI.RenderTexture.create(o,s),BFN.Stage.render(v,f)}else f=PIXI.Texture.fromCanvas(d,BFN.PIXIScaleMode);return d.ctx.clearRect(0,0,r,a),d.ctx.restore(),f},GetCurvesTexture:function(e,t,n){var i=function(e){for(var t,n,i,r=new BFN.FilterHelper.SplineInterpolator(e),a=[],o=0;o<256;o++)a.push((t=0,n=Math.floor(256*r.interpolate(o/255)),i=255,Math.max(t,Math.min(n,i))));return a},r=null!=e?BFN.FilterHelper.copy(e):null,a=null!=t?BFN.FilterHelper.copy(t):null,o=null!=n?BFN.FilterHelper.copy(n):null;if(null!=r)for(var s=0;s<r.length;s++)r[s][0]/=255,r[s][1]/=255;if(null!=a)for(s=0;s<a.length;s++)a[s][0]/=255,a[s][1]/=255;if(null!=o)for(s=0;s<o.length;s++)o[s][0]/=255,o[s][1]/=255;r=i(r),1==arguments.length?a=o=r:(a=i(a),o=i(o));for(var l=[],u=0;u<256;u++)l.splice(l.length,0,r[u],a[u],o[u],255);var c=document.createElement("canvas");c.width=256,c.height=1;var h=new PIXI.BaseTexture(c);BFN.Stage.textureManager.updateTexture(h),h._glTextures[0].uploadData(new Uint8Array(l),256,1);var d=new PIXI.Sprite(new PIXI.Texture(h)),m=PIXI.RenderTexture.create(d.texture.width,d.texture.height);BFN.Stage.render(d,m),d.destroy(!0);try{h.destroyGC(!0)}catch(e){}return h=null,d=null,c=null,l=null,r=null,a=null,o=null,m},SplineInterpolator:function(e){var t=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[],e.sort(function(e,t){return e[0]-t[0]});for(var n=0;n<t;n++)this.xa.push(e[n][0]),this.ya.push(e[n][1]);this.u[0]=0,this.y2[0]=0;for(n=1;n<t-1;++n){var i=this.xa[n+1]-this.xa[n-1],r=(this.xa[n]-this.xa[n-1])/i,a=r*this.y2[n-1]+2;this.y2[n]=(r-1)/a;var o=(this.ya[n+1]-this.ya[n])/(this.xa[n+1]-this.xa[n])-(this.ya[n]-this.ya[n-1])/(this.xa[n]-this.xa[n-1]);this.u[n]=(6*o/i-r*this.u[n-1])/a}this.y2[t-1]=0;for(n=t-2;n>=0;--n)this.y2[n]=this.y2[n]*this.y2[n+1]+this.u[n]},copy:function(t){var n,i,r;for(r in n=Array.isArray(t)?[]:{},t)i=t[r],n[r]="object"===e(i)?BFN.FilterHelper.copy(i):i;return n},getUnmaskedInfo:function(){var e=BFN.Stage.gl,t={renderer:"",vendor:""},n=e.getExtension("WEBGL_debug_renderer_info");return null!=n&&(t.renderer=e.getParameter(n.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(n.UNMASKED_VENDOR_WEBGL)),t},emptyPoolForFilter:function(){BFN.Stage.filterManager.emptyPool()}},BFN.FilterHelper.SplineInterpolator.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var i=n+t>>1;this.xa[i]>e?n=i:t=i}var r=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/r,o=(e-this.xa[t])/r;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(r*r)/6};var O=function(e){u(n,PIXI.Sprite);var t=p(n);function n(e){return i(this,n),t.call(this,e)}return a(n,[{key:"_renderWebGL",value:function(e){this.updateGeometry?this.updateGeometry():this.calculateVertices(),e.setObjectRenderer(e.plugins.picture),e.plugins.picture.render(this)}}]),n}(),R=function(e){u(n,PIXI.extras.TilingSprite);var t=p(n);function n(e,r,a){return i(this,n),t.call(this,e,r,a)}return a(n,[{key:"_renderWebGL",value:function(e){this.updateGeometry&&this.updateGeometry();var t=this._texture;t&&t.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),e.setObjectRenderer(e.plugins.picture),e.plugins.picture.render(this))}}]),n}(),A="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",V="#define GLSLIFY 1\nconst int kSize = 2;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color) {\n   return pow( color, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color) {\n   return pow( color, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_0/eDimensions_0.x,gap_0/eDimensions_0.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_0-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_1/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_1/adjDimensions);\n\n    vec2 st = vTextureCoord_1-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvoid main(void)\n{\n\n   vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n   vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n   vec4 src = smoothImage(uSampler,textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n   gl_FragColor = alphaMask(src,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp);\n   //texture2D(uSampler, textureCoord);\n\n}\n",U=function(e){u(n,PIXI.Shader);var t=p(n);function n(e,r,a,o){var s;return i(this,n),(s=t.call(this,e,r,a)).bind(),s.tilingMode=o,s.tempQuad=new PIXI.Quad(e),s.tempQuad.initVao(d(s)),s.uniforms.uColor=new Float32Array([1,1,1,1]),s.uniforms.uSampler=[0,1],s.uniforms.fillColor=new Float32Array([0,0,0,1]),s.uniforms.intensity=0,s}return n}(),G=function(e){u(n,U);var t=p(n);function n(e,r){var a;return i(this,n),(a=t.call(this,e,A,V,r)).bind(),a.uniforms.uColor=new Float32Array(1,1,1,1),a}return n}(),H="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize = 2;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 addBlend (vec3 src, vec3 dst)\n{\n    return src + dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n\n    //unpremultiply\n    if (src.a == 0.0) {\n            gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    //src.rgb/src.a;\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    //dst.rgb / (dst.a + 0.000001);\n    //\n\n    //blend\n    vec3 colour = clamp(addBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n\n    //premultiply and blend image alphas\n//    vec4 res;\n//    res.xyz = (1.0 - src.a) * Cs + src.a * colour;\n//    res.a = src.a + dst.a * (1.0-src.a);\n\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n\n}\n",z="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 subtractBlend (vec3 src, vec3 dst)\n{\n    return dst-src;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(subtractBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n\n",j="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 multiplyBlend (vec3 src, vec3 dst)\n{\n    return src * dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(multiplyBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n\n}\n",X="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 darkenBlend (vec3 src, vec3 dst)\n{\n    return min(src, dst);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(darkenBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n\n}\n",W="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 colorBurnBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.x) / src.x)),\n           \t\t\t\t(src.y == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.y) / src.y)),\n           \t\t\t\t(src.z == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.z) / src.z)));\n}\n\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n   if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(colorBurnBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",Y="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 linearBurnBlend (vec3 src, vec3 dst)\n{\n    return (src + dst) - 1.0;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(linearBurnBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",q="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 lightenBlend (vec3 src, vec3 dst)\n{\n    return max(src, dst);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(lightenBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",K="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 screenBlend (vec3 src, vec3 dst)\n{\n    return (src + dst) - (src * dst);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(screenBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",Q="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 colordodgeBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x == 1.0) ? 1.0 : min(1.0, dst.x / (1.0 - src.x)),\n           \t\t\t\t(src.y == 1.0) ? 1.0 : min(1.0, dst.y / (1.0 - src.y)),\n           \t\t\t\t(src.z == 1.0) ? 1.0 : min(1.0, dst.z / (1.0 - src.z)));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(colordodgeBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n\n}\n",Z="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 lineardodgeBlend (vec3 src, vec3 dst)\n{\n    return src + dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(lineardodgeBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",J="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 overlayBlend (vec3 src, vec3 dst)\n{\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\n           \t\t\t\t(dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\n           \t\t\t\t(dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(overlayBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",$="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 softlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))),\n           \t\t\t\t(src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))),\n           \t\t\t\t(src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(softlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",ee="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 hardlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - src.x) * (1.0 - dst.x)),\n           \t\t\t\t(src.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - src.y) * (1.0 - dst.y)),\n           \t\t\t\t(src.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - src.z) * (1.0 - dst.z)));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(hardlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",te="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 vividlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (1.0 - (1.0 - dst.x) / (2.0 * src.x)) : (dst.x / (2.0 * (1.0 - src.x))),\n           \t\t\t\t(src.y <= 0.5) ? (1.0 - (1.0 - dst.y) / (2.0 * src.y)) : (dst.y / (2.0 * (1.0 - src.y))),\n           \t\t\t\t(src.z <= 0.5) ? (1.0 - (1.0 - dst.z) / (2.0 * src.z)) : (dst.z / (2.0 * (1.0 - src.z))));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(vividlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",ne="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 linearlightBlend (vec3 src, vec3 dst)\n{\n    return 2.0 * src + dst - 1.0;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(linearlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",ie="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 pinlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x > 0.5) ? max(dst.x, 2.0 * (src.x - 0.5)) : min(dst.x, 2.0 * src.x),\n           \t\t\t\t(src.x > 0.5) ? max(dst.y, 2.0 * (src.y - 0.5)) : min(dst.y, 2.0 * src.y),\n           \t\t\t\t(src.z > 0.5) ? max(dst.z, 2.0 * (src.z - 0.5)) : min(dst.z, 2.0 * src.z));\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(pinlightBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",re="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 differenceBlend (vec3 src, vec3 dst)\n{\n    return abs(dst - src);\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(differenceBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",ae="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize_0 = 2;\nconst vec3 gaussWeights_0 = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 2;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nvec3 exclusionBlend (vec3 src, vec3 dst)\n{\n    return src + dst - 2.0 * src * dst;\n}\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(exclusionBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",oe="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize = 2;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nfloat lum(vec3 c) {\n    return dot(c, vec3(0.3, 0.59, 0.11));\n}\n\nvec3 clipcolor(vec3 c) {\n    float l = lum(c);\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n\n    if (n < 0.0) {\n        c.r = l + ((c.r - l) * l) / (l - n);\n        c.g = l + ((c.g - l) * l) / (l - n);\n        c.b = l + ((c.b - l) * l) / (l - n);\n    }\n    if (x > 1.0) {\n        c.r = l + ((c.r - l) * (1.0 - l)) / (x - l);\n        c.g = l + ((c.g - l) * (1.0 - l)) / (x - l);\n        c.b = l + ((c.b - l) * (1.0 - l)) / (x - l);\n    }\n\n    return c;\n}\n\nvec3 setlum(vec3 c, float l) {\n    float d = l - lum(c);\n    c = c + vec3(d);\n    return clipcolor(c);\n}\n\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(setlum(unSrc.xyz, lum(unDst.xyz)), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",se="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize = 2;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nfloat lum(vec3 c) {\n    return dot(c, vec3(0.3, 0.59, 0.11));\n}\n\nvec3 clipcolor(vec3 c) {\n    float l = lum(c);\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n\n    if (n < 0.0) {\n        c.r = l + ((c.r - l) * l) / (l - n);\n        c.g = l + ((c.g - l) * l) / (l - n);\n        c.b = l + ((c.b - l) * l) / (l - n);\n    }\n    if (x > 1.0) {\n        c.r = l + ((c.r - l) * (1.0 - l)) / (x - l);\n        c.g = l + ((c.g - l) * (1.0 - l)) / (x - l);\n        c.b = l + ((c.b - l) * (1.0 - l)) / (x - l);\n    }\n\n    return c;\n}\n\nvec3 setlum(vec3 c, float l) {\n    float d = l - lum(c);\n    c = c + vec3(d);\n    return clipcolor(c);\n}\n\nfloat sat(vec3 c) {\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n    return x - n;\n}\n\nfloat mid(float cmin, float cmid, float cmax, float s) {\n    return ((cmid - cmin) * s) / (cmax - cmin);\n}\n\nvec3 setsat(vec3 c, float s) {\n    if (c.r > c.g) {\n        if (c.r > c.b) {\n            if (c.g > c.b) {\n                /* g is mid, b is min */\n                c.g = mid(c.b, c.g, c.r, s);\n                c.b = 0.0;\n            } else {\n                /* b is mid, g is min */\n                c.b = mid(c.g, c.b, c.r, s);\n                c.g = 0.0;\n            }\n            c.r = s;\n        } else {\n            /* b is max, r is mid, g is min */\n            c.r = mid(c.g, c.r, c.b, s);\n            c.b = s;\n            c.r = 0.0;\n        }\n    } else if (c.r > c.b) {\n        /* g is max, r is mid, b is min */\n        c.r = mid(c.b, c.r, c.g, s);\n        c.g = s;\n        c.b = 0.0;\n    } else if (c.g > c.b) {\n        /* g is max, b is mid, r is min */\n        c.b = mid(c.r, c.b, c.g, s);\n        c.g = s;\n        c.r = 0.0;\n    } else if (c.b > c.g) {\n        /* b is max, g is mid, r is min */\n        c.g = mid(c.r, c.g, c.b, s);\n        c.b = s;\n        c.r = 0.0;\n    } else {\n        c = vec3(0.0);\n    }\n    return c;\n}\n\nvec3 hueBlend (vec3 front, vec3 back){\n    return setlum(setsat(front.rgb, sat(back.rgb)), lum(back.rgb));\n}\n\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(hueBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",le="#define GLSLIFY 1\n\nvec4 alphaMask (vec4 inputColor, vec2 vTextureCoord_0, vec2 eDimensions_0, float gap_0, vec4 gapFactor_0, float isRotated_0,vec4 uTextureClamp_0) {\n\n    vec2 adjDimensions = eDimensions_0/vec2(abs(uTextureClamp_0.z-uTextureClamp_0.x),abs(uTextureClamp_0.w-uTextureClamp_0.y));//vec2(2500,1790);\n    vec2 gapRatio = vec2(gap_0/adjDimensions);\n\n    vec2 st = vTextureCoord_0-vec2(uTextureClamp_0.x, uTextureClamp_0.y);\n    vec2 edgeOne; vec2 edgeTwo;\n    vec2 topLeft; float result2; vec2 bottomRight;\n\n    //checks if sprite is rotated, if rotated apply interpolation\n    if(isRotated_0==0.0) {\n        edgeOne = gapRatio;\n\n        topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n    else {\n\n        // gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y);\n        edgeOne = gapRatio-vec2(1.0/adjDimensions.x,1.0/adjDimensions.y);\n        edgeTwo = gapRatio + gapRatio;\n\n        topLeft = smoothstep(edgeOne,edgeTwo,st);\n        topLeft = max(topLeft, (vec2(1.0) - gapFactor_0.xz)); // WITH GAP FACTOR\n        result2 = topLeft.x * topLeft.y;\n        bottomRight = smoothstep(edgeOne,edgeTwo,vec2(uTextureClamp_0.z-uTextureClamp_0.x,uTextureClamp_0.w-uTextureClamp_0.y)-st);\n        bottomRight = max(bottomRight, (vec2(1.0) - gapFactor_0.yw)); // WITH GAP FACTOR\n        result2 *= bottomRight.x * bottomRight.y;\n\n    }\n\n    //gamma correct mask, increase this value for sharper less smooth edges\n    result2 = pow(result2,1.5);\n\n    //apply mask\n    vec4 result = mix(vec4(0.0),inputColor,result2);\n\n    return result;\n    //return vec4(vec3(result2), 1.0); // FOR TESTING ALPHA OUTPUT\n\n}\n\nconst int kSize = 2;\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\n\nvec4 gamma (vec4 color_0) {\n   return pow( color_0, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color_0) {\n   return pow( color_0, vec4(2.2) );\n\n}\n\nvec4 smoothImage (sampler2D inputImage, vec2 vTextureCoord_1, vec2 eDimensions_1, float gap_1, vec2 smoothingScaleFactor_0, vec2 dims_0, vec4 uColor_0, vec4 fillColor_0, float intensity_0) {\n\n    vec2 gapRatio = vec2(gap_1/eDimensions_1.x,gap_1/eDimensions_1.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord =(vTextureCoord_1-gapRatio) / scaleRatio;\n\n    vec4 src = vec4(0.0);\n\n    if(smoothingScaleFactor_0.x < 1.0){\n        vec2 res1 = 1.0/dims_0/smoothingScaleFactor_0*0.25;\n\n            src = deGamma(texture2D(inputImage, textureCoord)) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(-res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(res1.x,0.0))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,res1.y))) * 0.20;\n            src += deGamma(texture2D(inputImage, textureCoord + vec2(0.0,-res1.y))) * 0.20;\n            src = gamma(src) * uColor_0;\n            src = mix(src, fillColor_0 * src.a, intensity_0);\n\n    } else {\n        src = texture2D(inputImage, textureCoord) * uColor_0;\n        src = mix(src, fillColor_0 * src.a, intensity_0);\n    }\n\n    return src;\n}\n\nvec3 unpremultiply_1_1117569599(vec4 color, int isDivide){\n\n    if(isDivide == 1){\n        return color.rgb / (color.a + 0.000001);\n    } else {\n        return color.rgb / color.a;\n    }\n}\n\nvec4 premultiply_for_blend_2281831123(vec3 unpr_dst, vec3 blended_color, float src_alpha, float dst_alpha){\n\n   vec4 res;\n\n      res.xyz = (1.0 - src_alpha) * unpr_dst + src_alpha * blended_color;\n      res.a = src_alpha + dst_alpha * (1.0-src_alpha);\n\n      return res;\n}\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\nuniform vec4 fillColor;\nuniform float intensity;\nuniform vec4 uTextureClamp;\n\nuniform vec2 dims;\nuniform vec2 smoothingScaleFactor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform vec4 gapFactor;\nuniform float isRotated;\n\nfloat lum(vec3 c) {\n    return dot(c, vec3(0.3, 0.59, 0.11));\n}\n\nvec3 clipcolor(vec3 c) {\n    float l = lum(c);\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n\n    if (n < 0.0) {\n        c.r = l + ((c.r - l) * l) / (l - n);\n        c.g = l + ((c.g - l) * l) / (l - n);\n        c.b = l + ((c.b - l) * l) / (l - n);\n    }\n    if (x > 1.0) {\n        c.r = l + ((c.r - l) * (1.0 - l)) / (x - l);\n        c.g = l + ((c.g - l) * (1.0 - l)) / (x - l);\n        c.b = l + ((c.b - l) * (1.0 - l)) / (x - l);\n    }\n\n    return c;\n}\n\nvec3 setlum(vec3 c, float l) {\n    float d = l - lum(c);\n    c = c + vec3(d);\n    return clipcolor(c);\n}\n\nvec3 lumoBlend (vec3 front, vec3 back){\n    return setlum(back.rgb, lum(front.rgb));\n}\n\nvoid main(void)\n{\n    vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);\n    vec2 adjDimensions = eDimensions/vec2(abs(uTextureClamp.z-uTextureClamp.x),abs(uTextureClamp.w-uTextureClamp.y));\n    vec4 src = smoothImage(uSampler[0],textureCoord,adjDimensions,gap,smoothingScaleFactor,dims,uColor, fillColor, intensity);\n    vec4 dst = texture2D(uSampler[1], vMapCoord);\n    if (src.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    if (dst.a == 0.0) {\n        gl_FragColor = src;\n        return;\n    }\n    vec3 unSrc = unpremultiply_1_1117569599(src, 0);\n    vec3 unDst = unpremultiply_1_1117569599(dst, 1);\n    vec3 colour = clamp(lumoBlend(unSrc.xyz, unDst.xyz), 0.0, 1.0);\n    vec4 res = premultiply_for_blend_2281831123(unDst, colour, src.a, dst.a);\n\n    vec4 result = vec4(res.xyz * res.a, res.a);\n    result = mix(src, result, dst.a);\n    gl_FragColor = isRotated == 1.0 ? alphaMask(result,textureCoord,eDimensions, gap, gapFactor, isRotated, uTextureClamp) : result;\n}\n",ue="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 mapMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMapCoord = (mapMatrix * vec3(aVertexPosition, 1.0)).xy;\n}\n",ce=function(e){u(n,U);var t=p(n);function n(e,r,a){var o;i(this,n);var s=H;switch(a){case BFN.CONST.BLEND_MODES.SUBTRACT:s=z;break;case BFN.CONST.BLEND_MODES.MULTIPLY:s=j;break;case BFN.CONST.BLEND_MODES.DARKEN:s=X;break;case BFN.CONST.BLEND_MODES.COLOR_BURN:s=W;break;case BFN.CONST.BLEND_MODES.LINEAR_BURN:s=Y;break;case BFN.CONST.BLEND_MODES.LIGHTEN:s=q;break;case BFN.CONST.BLEND_MODES.SCREEN:s=K;break;case BFN.CONST.BLEND_MODES.COLOR_DODGE:s=Q;break;case BFN.CONST.BLEND_MODES.LINEAR_DODGE:s=Z;break;case BFN.CONST.BLEND_MODES.OVERLAY:s=J;break;case BFN.CONST.BLEND_MODES.SOFT_LIGHT:s=$;break;case BFN.CONST.BLEND_MODES.HARD_LIGHT:s=ee;break;case BFN.CONST.BLEND_MODES.VIVID_LIGHT:s=te;break;case BFN.CONST.BLEND_MODES.LINEAR_LIGHT:s=ne;break;case BFN.CONST.BLEND_MODES.PIN_LIGHT:s=ie;break;case BFN.CONST.BLEND_MODES.DIFFERENCE:s=re;break;case BFN.CONST.BLEND_MODES.EXCLUSION:s=ae;break;case BFN.CONST.BLEND_MODES.COLOR:s=oe;break;case BFN.CONST.BLEND_MODES.HUE:s=se;break;case BFN.CONST.BLEND_MODES.LUMINOSITY:s=le}return(o=t.call(this,e,ue,s,r)).bind(),o.uniforms.uSampler=[0,1],o}return n}();var he=PIXI.WRAP_MODES;function de(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}var me=function(e){u(n,PIXI.ObjectRenderer);var t=p(n);function n(e){return i(this,n),t.call(this,e)}return a(n,[{key:"onContextChange",value:function(){this._tempClamp=new Float32Array(4),this._tempColor=new Float32Array(4),this._tempRect=new PIXI.Rectangle,this._tempRect2=new PIXI.Rectangle,this._tempRect3=new PIXI.Rectangle,this._tempMatrix=new PIXI.Matrix,this._tempMatrix2=new PIXI.Matrix,this._bigBuf=new Uint8Array(1<<20);var e=this.renderer.gl;this.drawModes=[],this.normalShader=[new G(e,0)],this._renderTexture=new PIXI.BaseRenderTexture(1024,1024)}},{key:"start",value:function(){}},{key:"flush",value:function(){}},{key:"_getRenderTexture",value:function(e,t){return(this._renderTexture.width<e||this._renderTexture.height<t)&&(e=de(e),t=de(t),this._renderTexture.resize(e,t)),this._renderTexture}},{key:"_getBuf",value:function(e){var t=this._bigBuf;return t.length<e&&(e=de(e),t=new Uint8Array(e),this._bigBuf=t),t}},{key:"render",value:function(e){if(e.texture.valid){var t=0;e.tileTransform&&(t=this._isSimpleSprite(e)?1:2);var n=null;if(e.blendMode){if(e.blendMode=parseInt(e.blendMode),this.drawModes.length<1||!this.drawModes[e.blendMode]){var i=this.renderer.gl;this.drawModes=function(e,t,n){t=t||[];var i=[BFN.CONST.BLEND_MODES.ADD,BFN.CONST.BLEND_MODES.SUBTRACT,BFN.CONST.BLEND_MODES.MULTIPLY,BFN.CONST.BLEND_MODES.DARKEN,BFN.CONST.BLEND_MODES.COLOR_BURN,BFN.CONST.BLEND_MODES.LINEAR_BURN,BFN.CONST.BLEND_MODES.LIGHTEN,BFN.CONST.BLEND_MODES.SCREEN,BFN.CONST.BLEND_MODES.COLOR_DODGE,BFN.CONST.BLEND_MODES.LINEAR_DODGE,BFN.CONST.BLEND_MODES.OVERLAY,BFN.CONST.BLEND_MODES.SOFT_LIGHT,BFN.CONST.BLEND_MODES.HARD_LIGHT,BFN.CONST.BLEND_MODES.VIVID_LIGHT,BFN.CONST.BLEND_MODES.LINEAR_LIGHT,BFN.CONST.BLEND_MODES.PIN_LIGHT,BFN.CONST.BLEND_MODES.DIFFERENCE,BFN.CONST.BLEND_MODES.EXCLUSION,BFN.CONST.BLEND_MODES.COLOR,BFN.CONST.BLEND_MODES.HUE,BFN.CONST.BLEND_MODES.LUMINOSITY];return null!=n&&i.includes(n)&&!t[n]&&(t[n]=[new ce(e,0,n)]),t}(i,this.drawModes,e.blendMode)}this.drawModes[e.blendMode]&&(n=this.drawModes[e.blendMode])}n?this._renderBlend(e,n[t]):this._renderNormal(e,this.normalShader[t])}}},{key:"_renderNormal",value:function(e,t){var n=this.renderer;n.bindShader(t),n.state.setBlendMode(e.blendMode),this._renderInner(e,t)}},{key:"_renderBlend",value:function(e,t){var n=this.renderer,i=e.getBounds();i.x-=1,i.y-=1,i.width+=2,i.height+=2;var r=n._activeRenderTarget,a=r.projectionMatrix,o=a.a<0,s=a.d<0,l=r.resolution,u=this._tempRect,c=r.sourceFrame||r.destinationFrame;u.x=0,u.y=0,u.width=c.width*l,u.height=c.height*l;var h=this._tempRect2,d=c.width*l,m=c.height*l;h.x=(i.x+a.tx/a.a)*l+d/2,h.y=(i.y+a.ty/a.d)*l+m/2,h.width=i.width*l,h.height=i.height*l,o&&(h.y=d-h.width-h.x),s&&(h.y=m-h.height-h.y);this._tempRect3;var p=Math.floor(Math.max(u.x,h.x)),g=Math.ceil(Math.min(u.x+u.width,h.x+h.width)),f=Math.floor(Math.max(u.y,h.y)),v=g-p,y=Math.ceil(Math.min(u.y+u.height,h.y+h.height))-f;if(!(v<=0||y<=0)){var x=this._getRenderTexture(v,y);n.bindTexture(x,1,!0);var _=n.gl;if(n.renderingToScreen&&r.root){this._getBuf(v*y*4);_.readPixels(p,f,v,y,_.RGBA,_.UNSIGNED_BYTE,this._bigBuf),_.texSubImage2D(_.TEXTURE_2D,0,0,0,v,y,_.RGBA,_.UNSIGNED_BYTE,this._bigBuf)}else _.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,p,f,v,y);if(n.bindShader(t),n.state.setBlendMode(PIXI.BLEND_MODES.NORMAL),t.uniforms.mapMatrix){var I=this._tempMatrix;I.a=h.width/x.width/i.width,o?(I.a=-I.a,I.tx=(h.x-p)/x.width-(i.x+i.width)*I.a):I.tx=(h.x-p)/x.width-i.x*I.a,I.d=h.height/x.height/i.height,s?(I.d=-I.d,I.ty=(h.y-f)/x.height-(i.y+i.height)*I.d):I.ty=(h.y-f)/x.height-i.y*I.d,t.uniforms.mapMatrix=I.toArray(!0)}this._renderInner(e,t)}}},{key:"_renderInner",value:function(e,t){this.renderer;t.tilingMode>0?this._renderWithShader(e,1===t.tilingMode,t):this._renderSprite(e,t)}},{key:"_renderSprite",value:function(e,t){var n=this.renderer,i=t.tempQuad;n.bindVao(i.vao);var r,a,o,s,l=e.texture._uvs,u=(i.vertices,e.vertexData,Math.abs(e.transform.worldTransform.b)),c=!e.hasOwnProperty("smoothEdges")||e.smoothEdges,h=e.gapFactor||null;u>1e-5&&c?(r=1,a=BFN.Util.expandVertices(e.vertexData,r,h),o=BFN.Util.getDistance(a[0],a[1],a[2],a[3]),s=BFN.Util.getDistance(a[2],a[3],a[4],a[5]),t.uniforms.isRotated=1):(r=0,a=e.vertexData,o=e.texture.baseTexture.width,s=e.texture.baseTexture.height,t.uniforms.isRotated=0),i.vertices[0]=a[0],i.vertices[1]=a[1],i.vertices[2]=a[2],i.vertices[3]=a[3],i.vertices[4]=a[4],i.vertices[5]=a[5],i.vertices[6]=a[6],i.vertices[7]=a[7];var d=e.texture.frame,m=e.texture.baseTexture;if(t.uniforms.eDimensions=[o,s],t.uniforms.gap=r,t.uniforms.gapFactor=h||[1,1,1,1],i.uvs[0]=l.x0,i.uvs[1]=l.y0,i.uvs[2]=l.x1,i.uvs[3]=l.y1,i.uvs[4]=l.x2,i.uvs[5]=l.y2,i.uvs[6]=l.x3,i.uvs[7]=l.y3,i.upload(),d&&m){var p=this._tempClamp,g=0/m.resolution;p[0]=(d.x-g)/m.width,p[1]=(d.y-g)/m.height,p[2]=(d.x+d.width+g)/m.width,p[3]=(d.y+d.height+g)/m.height,t.uniforms.uTextureClamp=p;var f=this._tempColor;PIXI.utils.hex2rgb(e.tint,f);var v=e.worldAlpha;f[0]*=v,f[1]*=v,f[2]*=v,f[3]=v,t.uniforms.uColor=f;var y=e.hasOwnProperty("fillColor")?PIXI.utils.hex2rgb(e.fillColor):new Float32Array([0,0,0,1]);y[0]*=v,y[1]*=v,y[2]*=v,y[3]=v;var x=e.hasOwnProperty("intensity")?e.intensity:0;t.uniforms.fillColor=y,t.uniforms.intensity=x,t.uniforms.dims=[m.width,m.height];var _=BFN.smoothPictureDisabled?1:e.hasOwnProperty("currentScale")?e.currentScale:1,I=BFN.smoothPictureDisabled?1:e.hasOwnProperty("currentScaleY")?e.currentScaleY:_;t.uniforms.smoothingScaleFactor=[_*window.bfn_resolution,I*window.bfn_resolution],n.bindTexture(m,0,!0),i.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}},{key:"_isSimpleSprite",value:function(e){var t=this.renderer,n=e._texture,i=n.baseTexture,r=i.isPowerOfTwo&&n.frame.width===i.width&&n.frame.height===i.height;return r&&(i._glTextures[t.CONTEXT_UID]?r=i.wrapMode!==he.CLAMP:i.wrapMode===he.CLAMP&&(i.wrapMode=he.REPEAT)),r}},{key:"_renderWithShader",value:function(e,t,n){var i=n.tempQuad,r=this.renderer;r.bindVao(i.vao);var a=i.vertices,o=e._width,s=e._height,l=e._anchor._x,u=e._anchor._y,c=o*(1-l),h=o*-l,d=s*(1-u),m=s*-u,p=e.transform.worldTransform,g=p.a,f=p.b,v=p.c,y=p.d,x=p.tx,_=p.ty;a[0]=g*h+v*m+x,a[1]=y*m+f*h+_,a[2]=g*c+v*m+x,a[3]=y*m+f*c+_,a[4]=g*c+v*d+x,a[5]=y*d+f*c+_,a[6]=g*h+v*d+x,a[7]=y*d+f*h+_,(a=i.uvs)[0]=a[6]=-e.anchor.x,a[1]=a[3]=-e.anchor.y,a[2]=a[4]=1-e.anchor.x,a[5]=a[7]=1-e.anchor.y,i.upload();var I=e._texture,T=e.tileTransform.localTransform,b=e.uvTransform,S=b.mapCoord,C=b.uClampFrame,B=b.uClampOffset,F=I.width,E=I.height,P=o,k=s,N=this._tempMatrix2;N.set(T.a*F/P,T.b*F/k,T.c*E/P,T.d*E/k,T.tx/P,T.ty/k),N.invert(),t?N.append(S):(n.uniforms.uMapCoord=S.toArray(!0),n.uniforms.uClampFrame=C,n.uniforms.uClampOffset=B),n.uniforms.uTransform=N.toArray(!0);var M=this._tempColor,D=e.worldAlpha;PIXI.utils.hex2rgb(e.tint,M),M[0]*=D,M[1]*=D,M[2]*=D,M[3]=D,n.uniforms.uColor=M;var w=e.hasOwnProperty("fillColor")?PIXI.utils.hex2rgb(e.fillColor):new Float32Array([0,0,0,1]);w[0]*=D,w[1]*=D,w[2]*=D,w[3]=D;var L=e.hasOwnProperty("intensity")?e.intensity:0;n.uniforms.fillColor=w,n.uniforms.intensity=L,r.bindTexture(I,0,!0),i.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}]),n}();PIXI.WebGLRenderer.registerPlugin("blend_picture",me);var pe={PictureSprite:O,PictureTilingSprite:R,PictureRenderer:me};Object.assign(PIXI.extras,pe);var ge="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform vec2 kernelDim;\nuniform vec2 gapRatio;\nuniform vec2 scaleRatio;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 gapTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    gapTextureCoord = (aTextureCoord-gapRatio) / scaleRatio;\n    vSmoothTexCoordsLeft = gapTextureCoord + vec2(-kernelDim.x,0.0);\n    vSmoothTexCoordsRight = gapTextureCoord + vec2(kernelDim.x,0.0);\n    vSmoothTexCoordsTop = gapTextureCoord + vec2(0.0,kernelDim.y);\n    vSmoothTexCoordsBottom = gapTextureCoord + vec2(0.0,-kernelDim.y);\n\n    vTextureCoord = aTextureCoord;\n}\n",fe="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 gapTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\n//for kernel 3\n//const vec4 gaussWeights = vec4(0.4403113, 0.2988043, 0.0453564, -0.0643164);\n\n//for kernel 2\nconst vec3 gaussWeights = vec3(0.496, 0.284, -0.032);\nconst int kSize = 1;\n\nvec4 alphaMask(vec4 inputColor) {\n    vec4 result;\n    if(gap==0.0) {\n        result = inputColor;\n\n    } else {\n            vec2 gapRatio = vec2(gap/eDimensions.x,gap/eDimensions.y);\n            vec2 st = vTextureCoord;\n            vec2 edgeOne; vec2 edgeTwo;\n            vec2 topLeft; float result2; vec2 bottomRight;\n\n            //checks if sprite is rotated, if rotated apply interpolation\n            if(isRotated==0.0) {\n                edgeOne = gapRatio;\n\n                topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n                result2 *= bottomRight.x * bottomRight.y;\n\n            }\n            else {\n\n                edgeOne = max(gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y),vec2(0.0,0.0));\n                edgeTwo = gapRatio + gapRatio/gap;\n\n                topLeft = smoothstep(edgeOne,edgeTwo,st);\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = smoothstep(edgeOne,edgeTwo,1.0-st);\n                result2 *= bottomRight.x * bottomRight.y;\n            }\n\n            //gamma correct mask, increase this value for sharper less smooth edges\n            result2 = pow(result2,1.5);\n\n            //apply mask\n            result = mix(vec4(0.0),inputColor,result2);\n\n    }\n    return result;\n\n}\n\nvoid main(void)\n{\n    //apply smoothing, corrdinates passed by vertex\n    vec4 color = vec4(0.0);\n    color = texture2D(uSampler, gapTextureCoord) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsLeft) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsRight) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsTop) * 0.20;\n    color += texture2D(uSampler, vSmoothTexCoordsBottom) * 0.20;\n\n    gl_FragColor = isRotated == 1.0 ? alphaMask(color*uColor) : color*uColor;\n}\n",ve=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,ge,fe)).bind(),r.uniforms.uColor=new Float32Array(1,1,1,1),r}return n}(),ye="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nuniform vec2 kernelDim;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vSmoothTexCoordsLeft = aTextureCoord + vec2(-kernelDim.x,0.0);\n    vSmoothTexCoordsRight = aTextureCoord + vec2(kernelDim.x,0.0);\n    vSmoothTexCoordsTop = aTextureCoord + vec2(0.0,kernelDim.y);\n    vSmoothTexCoordsBottom = aTextureCoord + vec2(0.0,-kernelDim.y);\n\n    vTextureCoord = aTextureCoord;\n}\n",xe="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvec4 gamma (vec4 color) {\n   return pow( color, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color) {\n   return pow( color, vec4(2.2) );\n\n}\n\nvoid main(void)\n{\n    //apply smoothing, corrdinates passed by vertex\n    vec4 color = vec4(0.0);\n    color = deGamma(texture2D(uSampler, vTextureCoord)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsLeft)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsRight)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTop)) * 0.20;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottom)) * 0.20;\n\n    gl_FragColor = gamma(color)*uColor;\n}\n",_e=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,ye,xe)).bind(),r.uniforms.uColor=new Float32Array(1,1,1,1),r}return n}(),Ie="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nuniform vec2 kernelDim;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 vSmoothTexCoordsTopLeft;\nvarying vec2 vSmoothTexCoordsTopRight;\nvarying vec2 vSmoothTexCoordsBottomLeft;\nvarying vec2 vSmoothTexCoordsBottomRight;\n\nvarying vec2 vTextureCoord;\n\n/*\n\n0.077847\t0.123317\t0.077847\n0.123317\t0.195346\t0.123317\n0.077847\t0.123317\t0.077847\n\n*/\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vSmoothTexCoordsLeft = aTextureCoord + vec2(-kernelDim.x,0.0);\n    vSmoothTexCoordsRight = aTextureCoord + vec2(kernelDim.x,0.0);\n    vSmoothTexCoordsTop = aTextureCoord + vec2(0.0,kernelDim.y);\n    vSmoothTexCoordsBottom = aTextureCoord + vec2(0.0,-kernelDim.y);\n\n    vSmoothTexCoordsTopLeft = aTextureCoord + vec2(-kernelDim.x,-kernelDim.y);\n    vSmoothTexCoordsTopRight = aTextureCoord + vec2(kernelDim.x,-kernelDim.y);\n    vSmoothTexCoordsBottomLeft = aTextureCoord + vec2(-kernelDim.x,kernelDim.y);\n    vSmoothTexCoordsBottomRight = aTextureCoord + vec2(kernelDim.x,kernelDim.y);\n\n    vTextureCoord = aTextureCoord;\n}\n",Te="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vSmoothTexCoordsLeft;\nvarying vec2 vSmoothTexCoordsRight;\nvarying vec2 vSmoothTexCoordsTop;\nvarying vec2 vSmoothTexCoordsBottom;\nvarying vec2 vSmoothTexCoordsTopLeft;\nvarying vec2 vSmoothTexCoordsTopRight;\nvarying vec2 vSmoothTexCoordsBottomLeft;\nvarying vec2 vSmoothTexCoordsBottomRight;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\n/*\n\n0.077847\t0.123317\t0.077847\n0.123317\t0.195346\t0.123317\n0.077847\t0.123317\t0.077847\n\n*/\n\nvec4 gamma (vec4 color) {\n   return pow( color, vec4(1.0/2.2) );\n\n}\nvec4 deGamma (vec4 color) {\n   return pow( color, vec4(2.2) );\n\n}\n\nvoid main(void)\n{\n    //apply smoothing, corrdinates passed by vertex\n    vec4 color = vec4(0.0);\n    color = deGamma(texture2D(uSampler, vTextureCoord)) * 0.195346;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsLeft)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsRight)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTop)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottom)) * 0.123317;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTopLeft)) * 0.077847;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsTopRight)) * 0.077847;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottomLeft)) * 0.077847;\n    color += deGamma(texture2D(uSampler, vSmoothTexCoordsBottomRight)) * 0.077847;\n\n    gl_FragColor = gamma(color)*uColor;\n}\n",be=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,Ie,Te)).bind(),r.uniforms.uColor=new Float32Array(1,1,1,1),r}return n}(),Se="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",Ce="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nuniform vec2 eDimensions;\nuniform float gap;\nuniform float isRotated;\n\nvec4 alphaMask(vec4 inputColor) {\n\n    vec4 result;\n    if(gap==0.0) {\n        result = inputColor;\n\n    } else {\n            vec2 gapRatio = vec2(gap/eDimensions.x,gap/eDimensions.y);\n            vec2 st = vTextureCoord;\n            vec2 edgeOne; vec2 edgeTwo;\n            vec2 topLeft; float result2; vec2 bottomRight;\n\n            //checks if sprite is rotated, if rotated apply interpolation\n            if(isRotated==0.0) {\n                edgeOne = gapRatio;\n\n                topLeft = step(edgeOne,clamp(st,vec2(0.0),vec2(1.0)));\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = step(edgeOne,clamp(1.0-st,vec2(0.0),vec2(1.0)));\n                result2 *= bottomRight.x * bottomRight.y;\n\n            }\n            else {\n\n                edgeOne = max(gapRatio-vec2(1.0/eDimensions.x,1.0/eDimensions.y),vec2(0.0,0.0));\n                edgeTwo = gapRatio + gapRatio/gap;\n\n                topLeft = smoothstep(edgeOne,edgeTwo,st);\n                result2 = topLeft.x * topLeft.y;\n                bottomRight = smoothstep(edgeOne,edgeTwo,1.0-st);\n                result2 *= bottomRight.x * bottomRight.y;\n            }\n\n            //gamma correct mask, increase this value for sharper less smooth edges\n            result2 = pow(result2,1.5);\n\n            //apply mask\n            result = mix(vec4(0.0),inputColor,result2);\n\n    }\n    return result;\n\n}\n\nvoid main(void)\n{\n    vec2 gapRatio = vec2(gap/eDimensions.x,gap/eDimensions.y);\n    vec2 scaleRatio = 1.0 - gapRatio*2.0;\n    vec2 textureCoord;\n    if(gap==0.0) {\n        textureCoord =vTextureCoord;\n    }\n    else {\n       textureCoord = (vTextureCoord-gapRatio) / scaleRatio;\n    }\n\n    vec4 inputColor = texture2D(uSampler, textureCoord)*uColor;\n    gl_FragColor = isRotated == 1.0 ? alphaMask(inputColor) : inputColor;\n}\n",Be=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,Se,Ce)).bind(),r.uniforms.uColor=new Float32Array(1,1,1,1),r}return n}(),Fe="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",Ee="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 inputColor = texture2D(uSampler, vTextureCoord)*uColor;\n    gl_FragColor = inputColor;\n}\n",Pe=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,Fe,Ee)).bind(),r.uniforms.uColor=new Float32Array(1,1,1,1),r}return n}(),ke=(PIXI.glCore,function(e){u(n,PIXI.ObjectRenderer);var t=p(n);function n(e){return i(this,n),t.call(this,e)}return a(n,[{key:"onContextChange",value:function(){var e=this.renderer.gl;this.quad=new PIXI.Quad(e),this.smoothRotationShader=new ve(e),this.smoothShader=new _e(e),this.smoothResizeShader=new be(e),this.normalShader=new Pe(e),this.normalRotationShader=new Be(e),this.quad.initVao(this.normalShader),this._tempColor=new Float32Array(4)}},{key:"start",value:function(){}},{key:"flush",value:function(){}},{key:"render",value:function(e){if(e.texture.valid){var t=e.hasOwnProperty("currentScale")?e.currentScale:1,n=e.hasOwnProperty("currentScaleY")?e.currentScaleY:t,i=Math.abs(e.transform.worldTransform.b),r=!e.hasOwnProperty("smoothEdges")||e.smoothEdges,a=!!e.hasOwnProperty("isResize")&&e.isResize;t<1&&!BFN.smoothPictureDisabled?i>1e-5&&r?this._renderSmoothRotation(e,this.smoothRotationShader,t,n,i,r):a?this._renderSmooth(e,this.smoothResizeShader,t,n):this._renderSmooth(e,this.smoothShader,t,n):i>1e-5&&r?this._renderNormalRotation(e,this.normalRotationShader,i,r):this._renderNormal(e,this.normalShader)}}},{key:"_renderNormal",value:function(e,t){var n=this.renderer;n.bindShader(t),n.state.setBlendMode(e.blendMode);var i=this.quad;n.bindVao(i.vao);for(var r=e.vertexData,a=0;a<8;a++)i.vertices[a]=r[a];var o=e.texture._uvs;i.uvs[0]=o.x0,i.uvs[1]=o.y0,i.uvs[2]=o.x1,i.uvs[3]=o.y1,i.uvs[4]=o.x2,i.uvs[5]=o.y2,i.uvs[6]=o.x3,i.uvs[7]=o.y3,i.upload();var s=this._tempColor;PIXI.utils.hex2rgb(e.tint,s);var l=e.worldAlpha;s[0]*=l,s[1]*=l,s[2]*=l,s[3]=l,t.uniforms.uColor=s;var u=e.texture.baseTexture;n.bindTexture(u,0,!0),i.vao.draw(this.renderer.gl.TRIANGLES,6,0)}},{key:"_renderNormalRotation",value:function(e,t,n,i){var r=this.renderer;r.bindShader(t),r.state.setBlendMode(e.blendMode);var a=this.quad;r.bindVao(a.vao);var o,s,l,u,c=e.texture._uvs;n>1e-5&&i?(o=1,s=BFN.Util.expandVertices(e.vertexData,o),l=BFN.Util.getDistance(s[0],s[1],s[2],s[3]),u=BFN.Util.getDistance(s[2],s[3],s[4],s[5]),t.uniforms.isRotated=1):(o=0,s=e.vertexData,l=e.texture.baseTexture.width,u=e.texture.baseTexture.height,t.uniforms.isRotated=0),a.uvs[0]=c.x0,a.uvs[1]=c.y0,a.uvs[2]=c.x1,a.uvs[3]=c.y1,a.uvs[4]=c.x2,a.uvs[5]=c.y2,a.uvs[6]=c.x3,a.uvs[7]=c.y3,a.vertices[0]=s[0],a.vertices[1]=s[1],a.vertices[2]=s[2],a.vertices[3]=s[3],a.vertices[4]=s[4],a.vertices[5]=s[5],a.vertices[6]=s[6],a.vertices[7]=s[7],t.uniforms.eDimensions=[l,u],t.uniforms.gap=o,a.upload();var h=this._tempColor;PIXI.utils.hex2rgb(e.tint,h);var d=e.worldAlpha;h[0]*=d,h[1]*=d,h[2]*=d,h[3]=d,t.uniforms.uColor=h;var m=e.texture.baseTexture;r.bindTexture(m,0,!0),a.vao.draw(this.renderer.gl.TRIANGLES,6,0)}},{key:"_renderSmooth",value:function(e,t,n,i){var r=this.renderer;r.bindShader(t),r.state.setBlendMode(e.blendMode);var a=this.quad;r.bindVao(a.vao);for(var o=e.vertexData,s=0;s<8;s++)a.vertices[s]=o[s];var l=e.texture._uvs;a.uvs[0]=l.x0,a.uvs[1]=l.y0,a.uvs[2]=l.x1,a.uvs[3]=l.y1,a.uvs[4]=l.x2,a.uvs[5]=l.y2,a.uvs[6]=l.x3,a.uvs[7]=l.y3,a.upload();var u=e.texture.baseTexture;t.uniforms.kernelDim=[1/u.width/n/window.bfn_resolution*.25,1/u.height/i/window.bfn_resolution*.25];var c=this._tempColor;PIXI.utils.hex2rgb(e.tint,c);var h=e.worldAlpha;c[0]*=h,c[1]*=h,c[2]*=h,c[3]=h,t.uniforms.uColor=c,r.bindTexture(u,0,!0),a.vao.draw(this.renderer.gl.TRIANGLES,6,0)}},{key:"_renderSmoothRotation",value:function(e,t,n,i,r,a){var o=this.renderer;o.bindShader(t),o.state.setBlendMode(e.blendMode);var s=this.quad;o.bindVao(s.vao);var l,u,c,h,d=e.texture._uvs;r>1e-5&&a?(h=1,l=BFN.Util.expandVertices(e.vertexData,h),u=BFN.Util.getDistance(l[0],l[1],l[2],l[3]),c=BFN.Util.getDistance(l[2],l[3],l[4],l[5]),t.uniforms.isRotated=1):(h=0,l=e.vertexData,u=e.texture.baseTexture.width,c=e.texture.baseTexture.height,t.uniforms.isRotated=0),s.uvs[0]=d.x0,s.uvs[1]=d.y0,s.uvs[2]=d.x1,s.uvs[3]=d.y1,s.uvs[4]=d.x2,s.uvs[5]=d.y2,s.uvs[6]=d.x3,s.uvs[7]=d.y3,s.vertices[0]=l[0],s.vertices[1]=l[1],s.vertices[2]=l[2],s.vertices[3]=l[3],s.vertices[4]=l[4],s.vertices[5]=l[5],s.vertices[6]=l[6],s.vertices[7]=l[7],t.uniforms.gap=h,t.uniforms.eDimensions=[u,c],t.uniforms.gapRatio=[h/u,h/c],t.uniforms.scaleRatio=[1-2*t.uniforms.gapRatio[0],1-2*t.uniforms.gapRatio[1]],s.upload();var m=e.texture.baseTexture;t.uniforms.kernelDim=[1/m.width/n*.25,1/m.height/i*.25];var p=this._tempColor;PIXI.utils.hex2rgb(e.tint,p);var g=e.worldAlpha;p[0]*=g,p[1]*=g,p[2]*=g,p[3]=g,t.uniforms.uColor=p,o.bindTexture(m,0,!0),s.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}]),n}());PIXI.WebGLRenderer.registerPlugin("smooth_picture",ke),PIXI.CanvasRenderer.registerPlugin("smooth_picture",PIXI.CanvasSpriteRenderer);var Ne={SmoothPictureRenderer:ke};Object.assign(PIXI.extras,Ne);var Me=function(e){u(n,PIXI.ObjectRenderer);var t=p(n);function n(e){return i(this,n),t.call(this,e)}return a(n,[{key:"onContextChange",value:function(){BFN.ObjectRenderer=this.renderer}},{key:"bindShaderParams",value:function(e){if(!e.tempQuad){if(e.tempQuad=new PIXI.Quad(this.renderer.gl),e.tempQuad.initVao(e),e.bind(),void 0!==e.channelTextures&&null!=e.channelTextures){var t=[];for(var n in e.channelTextures)t.push(parseInt(n));e.uniforms.uSampler=t}if(void 0!==e.initParams)try{e.initParams()}catch(e){}}}},{key:"render",value:function(e){var t=this.renderer,n=e.bfn_shaders[0];this.bindShaderParams(n),t.bindShader(n),t.state.setBlendMode(e.blendMode);var i=n.tempQuad;t.bindVao(i.vao);for(var r=e.vertexData,a=0;a<8;a++)i.vertices[a]=r[a];var o=e.texture._uvs;i.uvs[0]=o.x0,i.uvs[1]=o.y0,i.uvs[2]=o.x1,i.uvs[3]=o.y1,i.uvs[4]=o.x2,i.uvs[5]=o.y2,i.uvs[6]=o.x3,i.uvs[7]=o.y3,i.upload();var s=e.texture.baseTexture;if(void 0!==n.applyParams)try{n.applyParams(s)}catch(e){}if(t.bindTexture(s,0,!0),void 0!==n.channelTextures&&null!==n.channelTextures)for(var l in n.channelTextures)"def"!=n.channelTextures[parseInt(l)]&&t.bindTexture(n[n.channelTextures[parseInt(l)]].baseTexture,parseInt(l),!0);i.vao.draw(this.renderer.gl.TRIANGLES,6,0)}}]),n}();PIXI.WebGLRenderer.registerPlugin("filter_renderer",Me);var De={FilterRenderer:Me};Object.assign(PIXI.extras,De);var we=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("SingletonQueue Init"),this.queue=[]}},{key:"add",value:function(e){this.queue.push(e)}},{key:"process",value:function(){for(;this.queue.length;)this.queue.shift()()}}]),e}();function Le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._x=e,this._y=t,this._width=n,this._height=i,this._left=e,this._top=t,this._right=e+n,this._bottom=t+i,this._minX=Math.min(this._left,this._right),this._minY=Math.min(this._top,this._bottom),this._maxX=Math.max(this._left,this._right),this._maxY=Math.max(this._top,this._bottom)}function Oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.x1=e,this.y1=t,this.x2=n,this.y2=i,this.x3=r,this.y3=a}function Re(){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.init()}function Ae(){BFN.EventDispatcher.call(this),this.init()}BFN.SingletonQueue=new we,Le.prototype.contains=function(e,t){return e>=this.minX&&e<=this.maxX&&t>=this.minY&&t<=this.maxY},Le.prototype.containsRect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e&&e.left>=this.left&&e.right<=this.right&&e.top>=this.top&&e.bottom<=this.bottom},Le.prototype.intersects=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e)try{if(n){if(this.minX>e.maxX+t||e.minX>this.maxX+t)return!1;if(this.minY>e.maxY+t||e.minY>this.maxY+t)return!1}else{if(this.minX>=e.maxX+t||e.minX>=this.maxX+t)return!1;if(this.minY>=e.maxY+t||e.minY>=this.maxY+t)return!1}return!0}catch(e){}return!1},Le.prototype.overlaps=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e)try{return!(!t(this.left,this.right,e.left)||!t(this.top,this.bottom,e.top)&&!t(this.top,this.bottom,e.bottom))||(!(!t(this.top,this.bottom,e.top)||!t(this.left,this.right,e.left)&&!t(this.left,this.right,e.right))||(!(!t(this.left,this.right,e.right)||!t(this.top,this.bottom,e.top)&&!t(this.top,this.bottom,e.bottom))||!(!t(this.top,this.bottom,e.bottom)||!t(this.left,this.right,e.left)&&!t(this.left,this.right,e.right))))}catch(e){}function t(e,t,n){return n>e&&n<t}return!1},Le.prototype.intersectsH=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!(Math.floor(this.top)>Math.ceil(e.bottom)||Math.floor(e.top)>Math.ceil(this.bottom))},Le.prototype.intersectsV=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!(Math.floor(this.left)>Math.ceil(e.right)||Math.floor(e.left)>Math.ceil(this.right))},Le.prototype.neighbors=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e)try{var n=new BFN.Rectangle;if(this.intersectsH(e)){if(e.right<this.left){if(!t)return"left";n.x=e.right,n.y=Math.min(this.top,e.top),n.width=this.left-e.right,n.height=Math.max(this.bottom,e.bottom)-Math.min(this.top,e.top);var i=n.clone();return i.y=Math.max(this.top,e.top),i.height=Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top),{side:"left",direction:"horizontal",distance:n.width,rect:e,gapRect:n,intersectRect:i}}if(e.left>this.right){if(!t)return"right";n.x=this.right,n.y=Math.min(this.top,e.top),n.width=e.left-this.right,n.height=Math.max(this.bottom,e.bottom)-Math.min(this.top,e.top);var r=n.clone();return r.y=Math.max(this.top,e.top),r.height=Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top),{side:"right",direction:"horizontal",distance:n.width,rect:e,gapRect:n,intersectRect:r}}}if(this.intersectsV(e)){if(e.bottom<this.top){if(!t)return"top";n.x=Math.min(this.left,e.left),n.y=e.bottom,n.width=Math.max(this.right,e.right)-Math.min(this.left,e.left),n.height=this.top-e.bottom;var a=n.clone();return a.x=Math.max(this.left,e.left),a.width=Math.min(this.right,e.right)-Math.max(this.left,e.left),{side:"top",direction:"vertical",distance:n.height,rect:e,gapRect:n,intersectRect:a}}if(e.top>this.bottom){if(!t)return"bottom";n.x=Math.min(this.left,e.left),n.y=this.bottom,n.width=Math.max(this.right,e.right)-Math.min(this.left,e.left),n.height=e.top-this.bottom;var o=n.clone();return o.x=Math.max(this.left,e.left),o.width=Math.min(this.right,e.right)-Math.max(this.left,e.left),{side:"bottom",direction:"vertical",distance:n.height,rect:e,gapRect:n,intersectRect:o}}}}catch(e){}return null},Le.prototype.intersectsLine=function(e,t){var n,i,r,a,o,s,l,u,c=function(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)},h=function(e,t,n){var i=parseInt((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y));return 0==i?0:i>0?1:2},d={a:e,b:t},m={tl:new PIXI.Point(this._left,this._top),tr:new PIXI.Point(this._right,this.top),bl:new PIXI.Point(this._left,this._bottom),br:new PIXI.Point(this._right,this._bottom)},p={tltr:{a:m.tl,b:m.tr},trbr:{a:m.tr,b:m.br},brbl:{a:m.br,b:m.bl},bltl:{a:m.bl,b:m.tl}},g=0;for(var f in p){var v=p[f];n=d.a,i=d.b,r=v.a,a=v.b,o=void 0,s=void 0,l=void 0,u=void 0,o=h(n,i,r),s=h(n,i,a),l=h(r,a,n),u=h(r,a,i),(o!==s&&l!==u||0===o&&c(n,r,i)||0===s&&c(n,a,i)||0===l&&c(r,n,a)||0===u&&c(r,i,a))&&g++}return g},Le.prototype.clone=function(){return new BFN.Rectangle(this._x,this._y,this._width,this._height)},Le.prototype.updateAttributes=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null){case"x":this._left=this._x,this._right=this._left+this._width;break;case"y":this._top=this._y,this._bottom=this._top+this._height;break;case"width":this._right=this._left+this._width;break;case"height":this._bottom=this._top+this._height;break;case"left":this._x=this._left,this._width=this._right-this._left;break;case"right":this._width=this._right-this._left;break;case"top":this._y=this._top,this._height=this._bottom-this._top;break;case"bottom":this._height=this._bottom-this._top}this._minX=Math.min(this._left,this._right),this._minY=Math.min(this._top,this._bottom),this._maxX=Math.max(this._left,this._right),this._maxY=Math.max(this._top,this._bottom)},Object.defineProperty(Le.prototype,"x",{set:function(e){this._x=e,this.updateAttributes("x")},get:function(){return this._x}}),Object.defineProperty(Le.prototype,"y",{set:function(e){this._y=e,this.updateAttributes("y")},get:function(){return this._y}}),Object.defineProperty(Le.prototype,"width",{set:function(e){this._width=e,this.updateAttributes("width")},get:function(){return this._width}}),Object.defineProperty(Le.prototype,"height",{set:function(e){this._height=e,this.updateAttributes("height")},get:function(){return this._height}}),Object.defineProperty(Le.prototype,"left",{set:function(e){this._left=e,this.updateAttributes("left")},get:function(){return this._left}}),Object.defineProperty(Le.prototype,"right",{set:function(e){this._right=e,this.updateAttributes("right")},get:function(){return this._right}}),Object.defineProperty(Le.prototype,"center",{get:function(){return this.centerX}}),Object.defineProperty(Le.prototype,"top",{set:function(e){this._top=e,this.updateAttributes("top")},get:function(){return this._top}}),Object.defineProperty(Le.prototype,"bottom",{set:function(e){this._bottom=e,this.updateAttributes("bottom")},get:function(){return this._bottom}}),Object.defineProperty(Le.prototype,"middle",{get:function(){return this.centerY}}),Object.defineProperty(Le.prototype,"centerX",{get:function(){return this._x+this._width/2}}),Object.defineProperty(Le.prototype,"centerY",{get:function(){return this._y+this._height/2}}),Object.defineProperty(Le.prototype,"minX",{get:function(){return this._minX}}),Object.defineProperty(Le.prototype,"maxX",{get:function(){return this._maxX}}),Object.defineProperty(Le.prototype,"minY",{get:function(){return this._minY}}),Object.defineProperty(Le.prototype,"maxY",{get:function(){return this._maxY}}),Object.defineProperty(Le.prototype,"rectangleObject",{get:function(){return{x:this._x,y:this._y,width:this._width,height:this._height}}}),Object.defineProperty(Le.prototype,"rectanglePolygon",{get:function(){return[new PIXI.Point(this._minX,this._minY),new PIXI.Point(this._maxX,this._minY),new PIXI.Point(this._maxX,this._maxY),new PIXI.Point(this._minX,this._maxY)]}}),BFN.Rectangle=Le,Oe.prototype.contains=function(e,t){var n=(t-this.y1)*(this.x2-this.x1)-(e-this.x1)*(this.y2-this.y1),i=(t-this.y3)*(this.x1-this.x3)-(e-this.x3)*(this.y1-this.y3),r=(t-this.y2)*(this.x3-this.x2)-(e-this.x2)*(this.y3-this.y2);return n*r>0&&i*r>0},Oe.prototype.clone=function(){return new BFN.Triangle(this.x1,this.y1,this.x2,this.y2,this.x3,this.y3)},Object.defineProperty(Oe.prototype,"width",{get:function(){return Math.max(this.x1,this.x2,this.x3)-Math.min(this.x1,this.x2,this.x3)}}),Object.defineProperty(Oe.prototype,"height",{get:function(){return Math.max(this.y1,this.y2,this.y3)-Math.min(this.y1,this.y2,this.y3)}}),Object.defineProperty(Oe.prototype,"left",{get:function(){return Math.min(this.x1,this.x2,this.x3)}}),Object.defineProperty(Oe.prototype,"right",{get:function(){Math.max(this.x1,this.x2,this.x3)}}),Object.defineProperty(Oe.prototype,"top",{get:function(){return Math.min(this.y1,this.y2,this.y3)}}),Object.defineProperty(Oe.prototype,"bottom",{get:function(){Math.max(this.y1,this.y2,this.y3)}}),Object.defineProperty(Oe.prototype,"centerX",{get:function(){return this.left+this.width/2}}),Object.defineProperty(Oe.prototype,"centerY",{get:function(){return this.top+this.height/2}}),Object.defineProperty(Oe.prototype,"minX",{get:function(){return this.left}}),Object.defineProperty(Oe.prototype,"maxX",{get:function(){return this.right}}),Object.defineProperty(Oe.prototype,"minY",{get:function(){return this.top}}),Object.defineProperty(Oe.prototype,"maxY",{get:function(){return this.bottom}}),Object.defineProperty(Oe.prototype,"triangleObject",{get:function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,x3:this.x3,y3:this.y3}}}),BFN.Triangle=Oe,BFN.FrameDisplayEvents={FRAME_LOADED:new Event("FRAME_LOADED"),FRAME_UPDATED:new Event("FRAME_UPDATED")},Re.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),Re.prototype.init=function(){BeFunky.log("FrameDisplay Init"),this.initDefaultValues(),this.initGraphicLoader(),this.initDisplay(),this.initWindow(),this.initFrame()},Re.prototype.initDefaultValues=function(){this._scale=1,this._itemWidth=0,this._itemHeight=0,this.minW=this.minH=10,this.maxW=this.maxH=BFN.maxImageSize,this.isThumb=!1,this.scaleOffsetFactor=1,this.smoothPadding=20,this.windowTexture=null,this.frameTexture=null,this.frameTextureData=null,this.frameW=0,this.frameH=0,this.windowX=0,this.windowY=0,this.windowW=0,this.windowH=0,this.frameScale=1,this.windowScale=1,this.frameAngle=0,this.renderPending=!1,this.colorOverlayFilter=new BFN.filters.ColorOverlayFilter,this.handleGraphicCompleteBind=this.handleGraphicComplete.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},Re.prototype.initGraphicLoader=function(){this.graphicLoader=new BFN.GraphicLoader},Re.prototype.initDisplay=function(){this.displayContainer=new PIXI.Container,this.addChild(this.displayContainer)},Re.prototype.initWindow=function(){this.windowContainer=new PIXI.Container,this.displayContainer.addChild(this.windowContainer),this.windowSprite=new PIXI.Sprite,this.windowSprite.pluginName="blend_picture",this.windowSprite.currentScale=1,this.windowSprite.anchor.x=this.windowSprite.anchor.y=.5,this.windowContainer.addChild(this.windowSprite),this.windowMask=new PIXI.Sprite(PIXI.RenderTexture.create(32,32)),this.windowMask.pluginName="blend_picture",this.windowMask.currentScale=1,this.windowContainer.addChild(this.windowMask),this.windowSprite.mask=this.windowMask},Re.prototype.initFrame=function(){this.frameTextureSprite=new PIXI.Sprite,this.frameSprite=new PIXI.Sprite,this.frameSprite.pluginName="blend_picture",this.frameSprite.currentScale=1,this.frameSprite.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.displayContainer.addChild(this.frameSprite)},Re.prototype.setupFrame=function(e,t,n,i,r,a,o,s,l){this.windowTexture=e,this.frameTextureData=n,this.minW=i,this.minH=r,this.maxW=a,this.maxH=o,this.isThumb=s,this.scaleOffsetFactor=1,s&&n.hasOwnProperty("frameW")&&(this.scaleOffsetFactor=n.frameW/l),this.updateFrame();try{this.frameTextureSprite.texture.destroyGC(!0),this.frameSprite.texture.destroyGC(!0)}catch(e){}this.frameTextureSprite.texture=PIXI.Texture.EMPTY,this.frameSprite.texture=PIXI.Texture.EMPTY,this.graphicLoader.reset(),this.graphicLoader.graphicsData[t]=t,this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type,this.handleGraphicCompleteBind),this.graphicLoader.loadGraphics()},Re.prototype.updateFrame=function(){if(this.frameW=this.frameTextureData.hasOwnProperty("frameW")?this.frameTextureData.frameW:this.windowTexture.width,this.frameH=this.frameTextureData.hasOwnProperty("frameH")?this.frameTextureData.frameH:this.windowTexture.height,this.windowX=this.frameTextureData.hasOwnProperty("windowX")?this.frameTextureData.windowX:0,this.windowY=this.frameTextureData.hasOwnProperty("windowY")?this.frameTextureData.windowY:0,this.windowW=this.frameTextureData.hasOwnProperty("windowW")?this.frameTextureData.windowW:this.frameTextureData.frameW,this.windowH=this.frameTextureData.hasOwnProperty("windowH")?this.frameTextureData.windowH:this.frameTextureData.frameH,this.frameAngle>0){var e;switch(this.frameAngle){case 90:e=this.windowX,this.windowX=this.frameH-this.windowH-this.windowY,this.windowY=e;break;case 180:this.windowX=this.frameW-this.windowW-this.windowX,this.windowY=this.frameH-this.windowH-this.windowY;break;case 270:e=this.windowX,this.windowX=this.windowY,this.windowY=this.frameW-this.windowW-e}this.frameAngle%180&&(e=this.frameW,this.frameW=this.frameH,this.frameH=e,e=this.windowW,this.windowW=this.windowH,this.windowH=e)}this.frameAngle%180?(this.frameTextureSprite.scale.y<0&&(this.windowX=this.frameW-(this.windowX+this.windowW)),this.frameTextureSprite.scale.x<0&&(this.windowY=this.frameH-(this.windowY+this.windowH))):(this.frameTextureSprite.scale.x<0&&(this.windowX=this.frameW-(this.windowX+this.windowW)),this.frameTextureSprite.scale.y<0&&(this.windowY=this.frameH-(this.windowY+this.windowH)));var t=Math.min(this.maxW/this.frameW,this.maxH/this.frameH),n=Math.max(this.minW/this.frameW,this.minH/this.frameH),i=Math.min(this.windowTexture.width/this.windowW,this.windowTexture.height/this.windowH);this.frameScale=Math.min(t,Math.max(n,i)),this.frameW=Math.round(this.frameW*this.frameScale),this.frameH=Math.round(this.frameH*this.frameScale),this.windowX=Math.round(this.windowX*this.frameScale),this.windowY=Math.round(this.windowY*this.frameScale),this.windowW=Math.round(this.windowW*this.frameScale),this.windowH=Math.round(this.windowH*this.frameScale),this.windowScale=Math.max(this.windowW/this.windowTexture.width,this.windowH/this.windowTexture.height),this.frameSprite.scale.x=this.frameSprite.scale.y=this.frameScale*this.scaleOffsetFactor,this.windowSprite.texture=this.windowTexture,this.windowSprite.scale.x=this.windowSprite.scale.y=this.windowScale,this.windowSprite.x=this.windowX+this.windowW/2,this.windowSprite.y=this.windowY+this.windowH/2,this.windowMask.texture.resize(this.windowW+2*this.smoothPadding,this.windowH+2*this.smoothPadding),this.windowMask.x=this.windowX-this.smoothPadding,this.windowMask.y=this.windowY-this.smoothPadding,BFN.graphics.drawShape("roundedRect",this.windowMask.texture,{fillColor:4294967295,edgePadding:0,paddingX:this.smoothPadding,paddingY:this.smoothPadding}),this.updateSmoothing(),this._itemWidth=this.frameW,this._itemHeight=this.frameH,this.dispatchEvent(BFN.FrameDisplayEvents.FRAME_UPDATED),BFN.MainUI.requestRender()},Re.prototype.updateSmoothing=function(){this.frameSprite.currentScale=this.frameScale*this.scaleOffsetFactor*this._scale,this.windowSprite.currentScale=this.windowScale*this._scale,this.windowMask.currentScale=this.windowScale*this._scale,BFN.MainUI.requestRender()},Re.prototype.resetFrame=function(){this.setColor(-1),this.setOpacity(1),this.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL),this.setPosition(0),this.frameAngle=0,this.frameTextureSprite.x=this.frameTextureSprite.y=0,this.frameTextureSprite.scale.x=this.frameTextureSprite.scale.y=1,this.updateFrame(),this.updateFrameOrientation(),this.updateFrameTexture()},Re.prototype.setColor=function(e,t){t=null!=t&&t>=0?t:1,e>=0?(this.colorOverlayFilter.color=e,this.colorOverlayFilter.intensity=t,this.frameTextureSprite.filters=[this.colorOverlayFilter]):this.frameTextureSprite.filters=[],this.updateFrameTexture()},Re.prototype.setOpacity=function(e){this.frameSprite.alpha=e,BFN.MainUI.requestRender()},Re.prototype.setBlendMode=function(e){this.frameSprite.blendMode=e,BFN.MainUI.requestRender()},Re.prototype.setPosition=function(e){var t=(this.windowSprite.texture.width*this.windowSprite.scale.x-this.windowW)/2/this.windowSprite.texture.width,n=(this.windowSprite.texture.height*this.windowSprite.scale.y-this.windowH)/2/this.windowSprite.texture.height;this.windowSprite.anchor.x=.5-t*e,this.windowSprite.anchor.y=.5-n*e,BFN.MainUI.requestRender()},Re.prototype.rotateCounterClockwise=function(){this.frameAngle=(this.frameAngle-90+360)%360,this.updateFrame(),this.updateFrameOrientation()},Re.prototype.rotateClockwise=function(){this.frameAngle=(this.frameAngle+90)%360,this.updateFrame(),this.updateFrameOrientation()},Re.prototype.flipHorizontal=function(){this.frameAngle%180?(this.frameTextureSprite.scale.y*=-1,this.frameTextureSprite.y=this.frameTextureSprite.scale.y>0?0:this.frameTextureSprite.texture.height):(this.frameTextureSprite.scale.x*=-1,this.frameTextureSprite.x=this.frameTextureSprite.scale.x>0?0:this.frameTextureSprite.texture.width),this.updateFrame(),this.updateFrameTexture()},Re.prototype.flipVertical=function(){this.frameAngle%180?(this.frameTextureSprite.scale.x*=-1,this.frameTextureSprite.x=this.frameTextureSprite.scale.x>0?0:this.frameTextureSprite.texture.width):(this.frameTextureSprite.scale.y*=-1,this.frameTextureSprite.y=this.frameTextureSprite.scale.y>0?0:this.frameTextureSprite.texture.height),this.updateFrame(),this.updateFrameTexture()},Re.prototype.updateFrameTexture=function(){try{BFN.Stage.render(this.frameTextureSprite,this.frameSprite.texture),BFN.MainUI.requestRender()}catch(e){}},Re.prototype.updateFrameOrientation=function(){switch(this.frameAngle){case 0:this.frameSprite.x=0,this.frameSprite.y=0;break;case 90:this.frameSprite.x=this.itemWidth,this.frameSprite.y=0;break;case 180:this.frameSprite.x=this.itemWidth,this.frameSprite.y=this.itemHeight;break;case 270:this.frameSprite.x=0,this.frameSprite.y=this.itemHeight}this.frameSprite.rotation=this.frameAngle*(Math.PI/180),BFN.MainUI.requestRender()},Re.prototype.handleGraphicComplete=function(e){if(this.graphicLoader.removeEventListener(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type,this.handleGraphicCompleteBind),this.isThumb)this.frameTextureSprite.texture=e.data.graphic.renderClone();else{var t=PIXI.RenderTexture.create(e.data.graphic.width+2*this.smoothPadding,e.data.graphic.height+2*this.smoothPadding);t.copyPixels(e.data.graphic,new PIXI.Point(this.smoothPadding,this.smoothPadding),!1),this.frameTextureSprite.texture=t}this.frameSprite.texture=this.frameTextureSprite.texture.renderClone(),this.frameSprite.anchor.x=this.isThumb?0:this.smoothPadding/this.frameSprite.texture.width,this.frameSprite.anchor.y=this.isThumb?0:this.smoothPadding/this.frameSprite.texture.height,this.graphicLoader.reset(),this.dispatchEvent(BFN.FrameDisplayEvents.FRAME_LOADED),BFN.MainUI.requestRender()},Re.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.displayContainer,this.displayTexture))},Object.defineProperty(Re.prototype,"canvasScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(Re.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Re.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.FrameDisplay=Re,BFN.ImagePainterRegionVO=function(){this.originPoint=new PIXI.Point,this.undoRegionTexture=null,this.redoRegionTexture=null,this.totalPixels=0},BFN.GlobalHistoryVO=function(){this.timestamp=0,this.historyTag=null,this.thumbImage=null,this.previewImage=null,this.isText=!1,this.isGroup=!1,this.useTextIcon=!1,this.useGroupIcon=!1},BFN.HistoryVO=function(){this.id=-1,this.name=null,this.historyAction=null,this.timestamp=Date.now(),this.imageTexture=null,this.imageW=0,this.imageH=0,this.thumbTexture=null,this.thumbImage=null,this.thumbW=0,this.thumbH=0,this.previewTexture=null,this.previewImage=null,this.previewW=0,this.previewH=0},BFN.TransformItemStateVO=function(){this.id=BeFunky.randomString(10),this.parent=null,this.zIndex=null,this.locked=!1,this.creationTime=performance.now(),this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.accurateBounds=null,this.basicShapeValues=null,this.borderEnabled=!1,this.borderValues=null,this.dropShadowValues=null,this.shapeColorMap=null,this.refreshDropShadow=!1,this.opacity=1,this.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.tintEnabled=!1,this.tint=-1,this.overlayColorEnabled=!1,this.overlayColor=-1,this.overlayColorIntensity=0,this.flippedHorizontal=!1,this.flippedVertical=!1,this.text=null,this.textStyle=null,this.textWidth=0,this.textScale=1,this.textItemScale=1,this.textBackgroundEnabled=!1,this.textBackgroundColor=-1,this.textBackgroundIntensity=1,this.textBackgroundPadding=0,this.textOutlineEnabled=!1,this.textHighlightEnabled=!1,this.imageID=null,this.imageTexture=null,this.maskImageFrameWidth=0,this.maskImageFrameHeight=0,this.maskImageOffsetFactorX=.5,this.maskImageOffsetFactorY=.5,this.maskImageTextureScale={x:1,y:1},this.collageSettings={},this.designerSettings={}},BFN.TransformItemTransitionVO=function(){this.id=null,this.batchID=null,this.batchIDPlaceholder=null,this.timestamp=Date.now(),this.transformItem=null,this.startState=new BFN.TransformItemStateVO,this.endState=new BFN.TransformItemStateVO,this.isCreateTransition=!1,this.isGroupTransition=!1,this.isSettingsTransition=!1,this.useGroupIcon=!1,this.useTextIcon=!1,this.alternateHistoryAction=null,this.previewTexture=null,this.previewImage=null,this.thumbTexture=null,this.thumbImage=null},BFN.TransformItemGroupVO=function(){this.id=null,this.name=null,this.itemIDs=[]},BFN.UploadVO=function(){this.url=null,this.width=0,this.height=0,this.size=0,this.resizedUrl=null,this.resizedWidth=0,this.resizedHeight=0,this.resizedSize=0},BFN.LensFlareAssetVO=function(){this.categoryID=null,this.assetID=null,this.static=!1,this.imageURL=null,this.thumbURL=null,this.imageTexture=null,this.thumbTexture=null},BFN.LensFlarePresetVO=function(){this.presetID=null,this.presetName=null,this.isPlus=!1,this.elementVOs=[]},BFN.LensFlareElementVOConstants={propertyOrder:["assetID","active","color","colorGlobal","colorGlobalGroup","blendMode","intensityFactor","intensityFactorGlobal","sizeFactor","sizeFactorGlobal","rotationOffset","rotationLock","stretchXFactor","stretchYFactor","sourceDistanceFactor","centerDistanceFactor"],defaultProperties:{assetID:null,active:!0,color:-1,colorGlobal:-1,colorGlobalGroup:0,blendMode:"screen",intensityFactor:1,intensityFactorGlobal:0,sizeFactor:1,sizeFactorGlobal:0,rotationOffset:0,rotationLock:!1,stretchXFactor:1,stretchYFactor:1,sourceDistanceFactor:0,centerDistanceFactor:0}},BFN.LensFlareElementVOEvents={ASSET_UPDATED:new Event("ASSET_UPDATED"),PROPERTY_UPDATED:new Event("PROPERTY_UPDATED"),POSITION_UPDATED:new Event("POSITION_UPDATED")},Ae.prototype=Object.create(BFN.EventDispatcher.prototype),Ae.prototype.init=function(){this.initDefaultValues()},Ae.prototype.initDefaultValues=function(){for(var e in this.properties={},BFN.LensFlareElementVOConstants.defaultProperties)this.properties[e]=BFN.LensFlareElementVOConstants.defaultProperties[e]},Ae.prototype.setProperty=function(e,t){this.properties.hasOwnProperty(e)&&(this.properties[e]=t,"assetID"==e||"color"==e||"colorGlobal"==e?this.dispatchEvent(BFN.LensFlareElementVOEvents.ASSET_UPDATED):"sourceDistanceFactor"==e||"centerDistanceFactor"==e?this.dispatchEvent(BFN.LensFlareElementVOEvents.POSITION_UPDATED):this.dispatchEvent(BFN.LensFlareElementVOEvents.PROPERTY_UPDATED))},Ae.prototype.getProperty=function(e){return this.properties.hasOwnProperty(e)?this.properties[e]:null},Ae.prototype.clone=function(){var e=new BFN.LensFlareElementVO;for(var t in this.properties)e.properties[t]=this.properties[t];return e},BFN.LensFlareElementVO=Ae;var Ve=function(){function e(){i(this,e),this.name=null,this.extension=null,this.id=null,this.indexedDBKey=null,this.imageURL=null,this.imageTexture=null,this.imageWidth=null,this.imageHeight=null,this.thumbURL=null,this.thumbTexture=null,this.thumbWidth=null,this.thumbHeight=null,this.isRemovable=!0,this.isSaved=!1,this.isTransparent=!1,this.isSVG=!1,this.date=null,this.isPattern=!1,this.author=null,this.authorURL=null}return a(e,[{key:"createId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BeFunky.randomString(10);if(!BFN.imageTypes.includes(e))throw new Error("Invalid MenuImageVO type: ".concat(BeFunky.stringValue(e)));return this.id="".concat(e,"_").concat(t),this.id}},{key:"hasUsableTexture",value:function(){return this.imageTexture&&this.imageTexture.valid&&this.imageTexture.baseTexture&&!this.imageTexture.baseTexture._destroyed}},{key:"getObject",value:function(){return Object.assign({},this,{imageTexture:null})}},{key:"setObject",value:function(e){var t=this,n=Object.keys(this);n.push("isPlus","trackingID"),n.forEach(function(n){e.hasOwnProperty(n)&&(t[n]=e[n])})}}]),e}();function Ue(){this.itemID=null,this.type=null,this.layerName=null,this.layerNum=-1,this.basicShapeValues=null,this.borderEnabled=!1,this.borderValues=null,this.dropShadowValues=null,this.graphicID=null,this.graphicStyle=null,this.shapeColorMap=null,this.imageID=null,this.isGoodie=!1,this.maskImageID=null,this.maskImageMaskID=null,this.maskImageMaskFlippedHorizontal=!1,this.maskImageMaskFlippedVertical=!1,this.maskImageFrameWidth=0,this.maskImageFrameHeight=0,this.maskImageOffsetFactorX=.5,this.maskImageOffsetFactorY=.5,this.maskImageTextureScale=1,this.labelText="",this.labelTextStyles={},this.labelWidth=0,this.labelTextScale=1,this.labelTextItemScale=1,this.labelTextBackgroundEnabled=!1,this.labelTextBackgroundColor=-1,this.labelTextBackgroundIntensity=1,this.labelTextBackgroundPadding=0,this.labelTextOutlineEnabled=!1,this.labelTextHighlightEnabled=!1,this.labelWordBreaksEnabled=!1,this.gridCellImageID=null,this.gridCellRect=null,this.gridCellTextureOffsetFactorX=.5,this.gridCellTextureOffsetFactorY=.5,this.gridCellTextureRotate=0,this.gridCellTextureScale=1,this.gridCellTextureTint=-1,this.transformZIndex=0,this.transformLocked=!1,this.transformX=0,this.transformY=0,this.transformRotation=0,this.transformScaleX=1,this.transformScaleY=1,this.transformWidth=0,this.transformHeight=0,this.transformFlippedHorizontal=!1,this.transformFlippedVertical=!1,this.transformOpacity=100,this.transformBlendMode=0,this.transformOverlayColorEnabled=!1,this.transformOverlayColor=-1,this.transformOverlayColorIntensity=0,this.transformTintColorEnabled=!1,this.transformTintColor=-1}function Ge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.timestamp=e,this.baseTextures=[]}function He(){this.originalName=null,this.originalTransparent=!1,this.name=null,this.extension=null,this.imageBlob=null,this.imageW=0,this.imageH=0,this.thumbSRC=null,this.thumbTexture=null,this.thumbW=0,this.thumbH=0,this.backgroundColor=-1,this.imageType="jpg",this.resizeData={},this.cropData={},this.actions=null}function ze(){this.active=!0,this.eventID=null,this.eventObject=null,this.superObject=null,this.peopleObject=null,this.actionSection=null,this.actionTimestamp=null,this.transformItem=null,this.transformItems=null}function je(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type=BFN.BasicShapeManager.validShapeTypes.includes(e)?e:"ellipse",this.fill="FFFFFF",this.fillAlpha=1,this.stroke=-1,this.strokeAlpha=1,this.strokeWidth=10,this.fillBak=-1,this.strokeBak=-1,this.shape=new PIXI.Graphics,this.shapeW=64,this.shapeH=64,this.attributes={},this.maxShapeSize=BFN.maxImageSize,this.fitScale=1,this.hitAreaPolygonPoints=null,"line"===e&&(this.shapeH=Math.max(20,t.hasOwnProperty("strokeWidth")?t.strokeWidth:this.strokeWidth)),"arrow"===e&&(this.shapeH/=2),this.setValues(t)}function Xe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.enabled=!1,this.color=-1,this.blend_mode=0,this.distance=25,this.angle=-45,this.size=10,this.density=0,this.opacity=75,this.scale=100,this.setValues(e)}BFN.MenuImageVO=Ve,BFN.TemplateVO=function(){this.name=null,this.categoryID=null,this.isPlus=null,this.preset=null,this.spritePosition=null},BFN.TemplateCategoryVO=function(){this.id=null,this.name=null,this.graphic=null,this.templateVOs=[]},BFN.PhotoGridSnapshotChildVO=function(){this.rect=new BFN.Rectangle,this.texture=null,this.offsetFactorX=.5,this.offsetFactorY=.5,this.rotate=0,this.textureScale=1,this.menuImageVO=null},BFN.PhotoGridSnapshotVO=function(){this.historyAction=null,this.snapshotWidth=0,this.snapshotHeight=0,this.gridWidth=0,this.gridHeight=0,this.rounding=0,this.gap=0,this.backgroundColor="FFFFFF",this.backgroundPatternBaseTexture=null,this.timestamp=Date.now(),this.thumbTexture=null,this.thumbImage=null,this.previewTexture=null,this.previewImage=null,this.snapshotChildren=[]},BFN.ProjectVO=function(){this.filename=null,this.time=Date.now(),this.sourceTemplateID=null,this.version=null,this.section=null,this.thumbBase64=null,this.projectWidth=0,this.projectHeight=0,this.isPlusTemplate=!1,this.printDPI=null,this.editorImageBase64=null,this.collageFreeform=!1,this.collageBackgroundColor=-1,this.collageBackgroundPatternBase64=null,this.collageGridWidth=0,this.collageGridHeight=0,this.collageRounding=0,this.collageGap=0,this.collageGridChildren=[],this.designerBackgroundColor=-1,this.transformGraphics=[],this.transformImages=[],this.transformMaskImages=[],this.transformLabels=[],this.transformGroups=[],this.transformGuides=[],this.transformGuidesLocked=!1,this.imageDataKeys=[],this.imageData={},this.svgDataKeys=[],this.svgData={}},Ue.prototype.clone=function(){var e=Object.assign(new Ue,this);return e.labelTextStyles instanceof Object&&(e.labelTextStyles=JSON.parse(JSON.stringify(e.labelTextStyles))),e},BFN.ProjectItemVO=Ue,Ge.prototype.addUsedTexture=function(e,t){e&&e.baseTexture&&!this.baseTextures.includes(e.baseTexture)&&this.baseTextures.push(e.baseTexture)},Ge.prototype.addUsedBaseTexture=function(e,t){e&&!this.baseTextures.includes(e)&&this.baseTextures.push(e)},Ge.prototype.clear=function(){this.baseTextures.splice(0)},BFN.TextureHistoryVO=Ge,He.prototype.addAction=function(e){e&&"string"==typeof e&&(this.actions||(this.actions=[]),this.actions.includes(e)||this.actions.push(e))},BFN.BatchImageVO=He,ze.prototype.register=function(){this.isValid&&BFN.UserActionManager.registerUserAction(this)},ze.prototype.track=function(){this.isValid&&window.bfn_mp&&BFN.UserActionManager.isTrackable&&(window.bfn_mp.track(this.eventID,this.eventObject,this.superObject,this.peopleObject),console.log("Mixpanel tracked: ".concat(this.eventID),this.eventObject))},Object.defineProperty(ze.prototype,"isValid",{get:function(){return!!(this.eventID&&window.bfn_mp&&window.bfn_mp.property_map.hasOwnProperty(this.eventID))}}),BFN.UserActionVO=ze,je.prototype.setValues=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.hasOwnProperty("fill")?t.fill:this.fill;t.hasOwnProperty("fill")&&-1!==t.fill&&t.useFillBak&&-1!==this.fillBak&&(n=this.fillBak);var i=t.hasOwnProperty("stroke")?t.stroke:this.stroke;t.hasOwnProperty("stroke")&&-1!==t.stroke&&t.useStrokeBak&&-1!==this.strokeBak&&(i=this.strokeBak),this.type=t.hasOwnProperty("type")&&BFN.BasicShapeManager.validShapeTypes.includes(t.type)?t.type:this.type,this.fill=n,this.fillColor=-1!==this.fill?parseInt("0x"+this.fill):null,this.fillAlpha=t.hasOwnProperty("fillAlpha")?t.fillAlpha:this.fillAlpha,this.stroke=i,this.strokeColor=-1!==this.stroke?parseInt("0x"+this.stroke):null,this.strokeAlpha=t.hasOwnProperty("strokeAlpha")?t.strokeAlpha:this.strokeAlpha,this.strokeWidth=t.hasOwnProperty("strokeWidth")?t.strokeWidth:this.strokeWidth,this.fillBak=t.hasOwnProperty("fillBak")?t.fillBak:-1!==this.fill?this.fill:this.fillBak,this.strokeBak=t.hasOwnProperty("strokeBak")?t.strokeBak:-1!==this.stroke?this.stroke:this.strokeBak;var r=function(n,i){e.attributes[n]=t.hasOwnProperty(n)?t[n]:e.attributes.hasOwnProperty(n)?e.attributes[n]:i};switch(this.type){case"line":r("lineStyle","solid"),r("lineSegmentWidth",3),r("lineGapSize",.5);break;case"rectangle":r("rectangleCornerRounding",0);break;case"polygon":r("polygonSides",6),r("polygonShiftOrientation",!1);break;case"star":r("starPoints",5),r("starInsetWeight",.5),r("starShiftOrientation",!1);break;case"arrow":r("arrowStyle","thick"),r("arrowWeight",.25),r("arrowDoubleSided",!1)}this.drawShape()},je.prototype.getValues=function(){var e={type:this.type,fill:this.fill,fillAlpha:this.fillAlpha,stroke:this.stroke,strokeAlpha:this.strokeAlpha,strokeWidth:this.strokeWidth,fillBak:this.fillBak,strokeBak:this.strokeBak};return Object.assign(e,this.attributes),e},je.prototype.resize=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&t?(e=Math.abs(e),t=Math.abs(t),this.fitScale=Math.min(1,this.maxShapeSize/Math.max(e,t)),this.shapeW=Math.round(this.fitScale*e),this.shapeH=Math.round(this.fitScale*t),n&&this.drawShape()):this.shape.clear()},je.prototype.drawShape=function(){"group"!==this.type&&BFN.BasicShapeManager.drawShape(this)},je.prototype.updateTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e&&t&&n)if(t=Math.abs(t),n=Math.abs(n),this.shapeW==t&&this.shapeH==n||this.resize(t,n,!1),e.width==this.shapeW&&e.height==this.shapeH||e.resize(this.shapeW,this.shapeH),this.drawShape(),i){var r=this.getCanvasTexture(),a={x:(e.width-r.width)/2,y:(e.height-r.height)/2};e.copyPixels(r,a),r.destroyGC(!0)}else BFN.Stage.render(this.shape,e)},je.prototype.convertToMaskValues=function(){if(-1===this.fill)-1===this.stroke?this.setValues({fill:"FFFFFF",fillAlpha:1}):this.setValues({stroke:"FFFFFF"});else{var e={fill:"FFFFFF"};-1!==this.stroke&&this.strokeAlpha===this.fillAlpha?(e.stroke=-1,e.strokeAlpha=1,e.strokeWidth=10):-1!==this.stroke&&(e.stroke="FFFFFF"),this.setValues(e)}},je.prototype.getCanvasTexture=function(){return BFN.BasicShapeManager.dummyTexture||(BFN.BasicShapeManager.dummyTexture=PIXI.RenderTexture.create(16,16)),BFN.Stage.render(this.shape,BFN.BasicShapeManager.dummyTexture),this.shape.generateCanvasTexture()},je.prototype.clone=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new BFN.BasicShapeVO(this.type,Object.assign(this.getValues(),e))},Object.defineProperty(je.prototype,"isSolidRectangle",{get:function(){var e=!0;return(e=(e=e&&"rectangle"===this.type)&&0===this.attributes.rectangleCornerRounding)&&(-1===this.stroke?-1!==this.fill&&1!==this.fillAlpha&&0!==this.fillAlpha&&(e=!1):(-1===this.fill||-1!==this.fill&&1!==this.fillAlpha||1!==this.strokeAlpha)&&(e=!1)),e}}),BFN.BasicShapeVO=je,Xe.prototype.setValues=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&"object"===e(t)&&(this.enabled=t.hasOwnProperty("enabled")?t.enabled:this.enabled,this.color=t.hasOwnProperty("color")?t.color:this.color,this.blend_mode=t.hasOwnProperty("blend_mode")?t.blend_mode:this.blend_mode,this.distance=t.hasOwnProperty("distance")?t.distance:this.distance,this.angle=t.hasOwnProperty("angle")?t.angle:this.angle,this.size=t.hasOwnProperty("size")?t.size:this.size,this.density=t.hasOwnProperty("density")?t.density:this.density,this.opacity=t.hasOwnProperty("opacity")?t.opacity:this.opacity,this.scale=t.hasOwnProperty("scale")?t.scale:this.scale)},Xe.prototype.getValues=function(){return{enabled:this.enabled,color:this.color,blend_mode:this.blend_mode,distance:this.distance,angle:this.angle,size:this.size,density:this.density,opacity:this.opacity,scale:this.scale}},BFN.DropShadowVO=Xe,BFN.PatchVO=function(){this.id="patch_"+BeFunky.randomString(10),this.name="BeFunkyPatch",this.version="1.0",this.thumbBase64=null,this.loaded=!1,this.width=0,this.height=0,this.transformGraphics=[],this.transformImages=[],this.transformMaskImages=[],this.transformLabels=[],this.imageData={},this.svgData={}};var We=BeFunky.loggingFlags.includes("blob_perf"),Ye={},qe=We?function(e){Ye[e]=Date.now()}:function(){},Ke=We?function(e){BeFunky.logFeature("blob_perf",e,Date.now()-Ye[e]),delete Ye[e]}:function(){};BFN.BlobUtils={blobToBase64:function(e,t){return BFN.BlobUtils.fileReader("readAsDataURL",e,t)},blobToArrayBuffer:function(e,t,n){BFN.BlobUtils.fileReader("readAsArrayBuffer",e,n).then(function(e){return t({arrayBuffer:e})},function(e){return t({error:"Unable to read blob as array buffer: ".concat(BeFunky.stringValue(e))})})},blobToText:function(e,t,n){BFN.BlobUtils.fileReader("readAsText",e,n).then(function(e){return t({text:e})},function(e){return t({error:"Unable to read blob as string: ".concat(BeFunky.stringValue(e))})})},blobToBinaryString:function(e,t,n){BFN.BlobUtils.fileReader("readAsBinaryString",e,n).then(function(e){return t({binaryString:e})},function(e){return t({error:"Unable to read blob as binary string: ".concat(BeFunky.stringValue(e))})})},blobToImage:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).cleanUpMemory,i=void 0===n||n,r=e.type.startsWith("image/svg+xml"),a="Blob ".concat(e.name?"".concat(e.name," "):"").concat(BeFunky.formatBytes(e.size)," -> ImageBitmap");BeFunky.isImageBitmapSupported&&!r?(qe(a),createImageBitmap(e).then(function(e){Ke(a),t({imageBitmap:e}),i&&e.close()},function(n){Ke(a),BeFunky.logError("Unable to create ImageBitmap from blob:",n,"\nFalling back to Image Element w/ object URL"),BFN.BlobUtils.blobToImageElement(e,t,{cleanUpMemory:i})})):BFN.BlobUtils.blobToImageElement(e,t,{cleanUpMemory:i})},blobToImageElement:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.cleanUpMemory,r=void 0===i||i,a=n.isSvgSanitized,o=void 0!==a&&a,s=new Image,l=1,u="",c="Blob ".concat(e.name?"".concat(e.name," "):"").concat(BeFunky.formatBytes(e.size)," -> ImageElement");function h(){try{u=URL.createObjectURL(e)}catch(e){return BeFunky.logError("Unable to create object URL from blob",e),t({error:e})}s.src=u}qe(c),s.onerror=function(e){Ke(c),URL.revokeObjectURL(u),l<3?(BeFunky.logError("Unable to load image from object URL on attempt #".concat(l,". Trying again...")),l++,BFN.MainUI.addIdleRenderFunction(h)):(BeFunky.logError("Unable to load image from object URL after ".concat(3," attempts"),e),t({error:e}))},s.onload=function(){Ke(c),BeFunky.isFirefox&&!o&&!s.naturalWidth&&e.type.startsWith("image/svg+xml")?(URL.revokeObjectURL(u),BeFunky.logError("Re-attempting SVG -> Image conversion in Firefox b/c resulting image is missing dimensions"),BFN.BlobUtils.blobToText(e,function(e){var n=e.text,i=e.error;if(i)return t({error:i});var a=BFN.SVGManager.sanitizeSVG(n);if(!a)return t({error:"Unable to parse SVG"});var o=new Blob([a],{type:"image/svg+xml"});BFN.BlobUtils.blobToImageElement(o,t,{cleanUpMemory:r,isSvgSanitized:!0})})):t({imageElement:s}),r&&URL.revokeObjectURL(u),s.onerror=void 0},h()},getOrientationAndEXIF:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={orientation:1,exif:void 0};return new Promise(function(r){if("image/jpeg"!==e.type)return r(n);BFN.ExifTool.load(e,function(a){var o,s,l=a.error,u=a.exif;if(l)return BeFunky.logError("Unable to read EXIF data from Blob:",BeFunky.stringValue(l)),t?r(n):(o=r,s=Date.now(),void function(t){BFN.BlobUtils.blobToArrayBuffer(e,function(e){var n=e.error,i=e.arrayBuffer;if(n)return t(-3);var r=new DataView(i);if(65496!==r.getUint16(0,!1))return t(-2);for(var a=r.byteLength,o=2;o<a;){if(r.getUint16(o+2,!1)<=8)return t(-1);var s=r.getUint16(o,!1);if(o+=2,65505===s){if(1165519206!==r.getUint32(o+=2,!1))return t(-1);var l=18761===r.getUint16(o+=6,!1);o+=r.getUint32(o+4,l);var u=r.getUint16(o,l);o+=2;for(var c=0;c<u;c++)if(274===r.getUint16(o+12*c,l))return t(r.getUint16(o+12*c+8,l))}else{if(65280!=(65280&s))break;o+=r.getUint16(o,!1)}}return t(-1)},{timeoutMs:2e3,reportErrors:!1})}(function(t){var n=i(t);return BeFunky.logError("Blob size = ".concat(BeFunky.formatBytes(e.size),". Detected orientation = ").concat(t,". Time = ").concat(Date.now()-s,"ms")),n===t?BeFunky.logError("Orientation fallback was successful"):BeFunky.logError("Orientation fallback failed"),o({orientation:n,exif:void 0})}));if(!u)return r(n);try{var c=i(BFN.ExifTool.getOrientation(u));return r({orientation:c,exif:u})}catch(e){return r(n)}})});function i(e){return Number.isInteger(e)?e<1||e>8?1:e:1}},base64ToBlob:function(e){for(var t=e.split(","),n=t[0].includes("base64")?atob(t[1]):decodeURIComponent(t[1]),i=t[0].split(":")[1].split(";")[0],r=new Uint8Array(n.length),a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return new Blob([r],{type:i})},fileReader:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.timeoutMs,r=void 0===i?15e3:i,a=n.reportErrors,o=void 0===a||a,s=new FileReader;return new Promise(function(n,i){if(!(t instanceof Blob))throw new Error("".concat(BeFunky.stringValue(t)," passed to FileReader"));var a;r>9e3&&(a=setTimeout(function(){console.log("Blob size: ".concat(BeFunky.formatBytes(t.size),"  Blob type: ").concat(t.type)),console.log("FileReader readystate:",s.readyState);var n="FileReader ".concat(e," took over 9 seconds");o?BeFunky.throwError(n):BeFunky.logError(n)},9e3));var l=!1,u=setTimeout(function(){l=!0,console.log("Blob size: ".concat(BeFunky.formatBytes(t.size),"  Blob type: ").concat(t.type)),console.log("FileReader readystate:",s.readyState);var n="FileReader ".concat(e," timed out after ").concat(r,"ms");o?BeFunky.reportWarning(n):BeFunky.logError(n),s.abort(),i(new Error(n))},r);s.onload=function(){return c({result:s.result})},s.onerror=function(e){return c({error:e})};try{s[e](t)}catch(e){c({error:e})}function c(e){var t=e.result,s=e.error;if(clearTimeout(a),clearTimeout(u),!l)return t?n(t):i(s);var c="FileReader called ".concat(t?"onload":"onerror"," after ").concat(r,"ms timeout rejected Promise. Consider increasing timeout period.");o?BeFunky.throwError(c):BeFunky.logError(c)}})},downsizeImageBlob:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.maxSize,r=void 0===i?BFN.maxImageSizeLayer:i,a=n.quality,o=void 0===a?.95:a,s=n.skipSmallImages,l=void 0===s||s,u=Date.now(),c=new Promise(function(n,i){t.blobToImageElement(e,function(e){var t=e.error,r=e.imageElement;t?i(t):n(r)})}),h=BeFunky.safariVersion>=13.1||BeFunky.chromiumVersion>=81||BeFunky.firefoxVersion>=77?Promise.resolve({orientation:1}):this.getOrientationAndEXIF(e,!0);return Promise.all([c,h]).then(function(n){var i=f(n,2),a=i[0],s=i[1].orientation,c=a.naturalWidth,h=a.naturalHeight,d="".concat(e.size/1e6,"MB (").concat(c," x ").concat(h,")"),m=Math.min(r/c,r/h);if(m>=1){if(l)throw console.log('Blob "'.concat(e.name,'" ').concat(d," is already smaller than maxSize (").concat(r,"px). Skipping downsizing...")),"skipped_small_image";console.log('Blob "'.concat(e.name,'" ').concat(d," is smaller than maxSize (").concat(r,"px), but will still be compressed to desired quality.")),m=1}var p=document.createElement("canvas"),g=p.getContext("2d"),v=Math.round(c*m),y=Math.round(h*m);return function(e,t,n,i,r){[5,6,7,8].includes(n)?(e.width=r,e.height=i):(e.width=i,e.height=r);var a={2:function(){return t.transform(-1,0,0,1,i,0)},3:function(){return t.transform(-1,0,0,-1,i,r)},4:function(){return t.transform(1,0,0,-1,0,r)},5:function(){return t.transform(0,1,1,0,0,0)},6:function(){return t.transform(0,1,-1,0,r,0)},7:function(){return t.transform(0,-1,-1,0,r,i)},8:function(){return t.transform(0,-1,1,0,0,i)}};a[n]&&a[n]()}(p,g,s,v,y),g.mozImageSmoothingEnabled=!0,g.imageSmoothingQuality="medium",g.webkitImageSmoothingEnabled=!0,g.msImageSmoothingEnabled=!0,g.imageSmoothingEnabled=!0,g.drawImage(a,0,0,v,y),t.canvasToBlob(p,e.type,o).then(function(t){var n="".concat(t.size/1e6,"MB (").concat(p.width," x ").concat(p.height,")");return console.log('Blob "'.concat(e.name,'" resized ').concat(d," -> ").concat(n," in ").concat(Date.now()-u,"ms ").concat("image/jpeg"===e.type?"at ".concat(100*o,"% quality"):"")),t})})},canvasToBlob:function(e,t,n){return new Promise(function(i,r){e.toBlob(function(e){e instanceof Blob?i(e):r("canvas_to_blob_failed")},t,n)})}};var Qe,Ze,Je=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){}},{key:"getJSON",value:function(e,t){var n="".concat(e).concat(e.includes("?")?"&":"?","nocache=").concat(Math.random().toString().split(".")[1]),i={fallbackURLs:[n]};BeFunky.request(e,i,function(i){var r=i.error,a=i.response;return r?("request_failed"!==r&&(console.log({url:e,noCacheURL:n}),BeFunky.throwError("Unable to get valid JSON from server: ".concat(r))),t({error:r})):t({response:a})})}},{key:"getBlob",value:function(e,t){return BeFunky.request(e,{responseType:"blob"},function(e){var n=e.response,i=e.error;return i?t({error:i}):n instanceof Blob?n.size?void t({blob:n}):(BeFunky.logError("Server responded with an empty Blob"),t({error:"invalid_response"})):(BeFunky.logError("Blob requested but server retured a different type of response"),t({error:"invalid_response"}))})}},{key:"getTexture",value:function(e,t,n){BFN.RequestUtils.getBlob(e,function(e){var i=e.error,r=e.blob;if(i)return n({error:i});BFN.TextureUtils.blobOrBase64ToTexture(r,function(e){var t=e.texture,i=e.error;if(i)return n({error:i});n({texture:t})},t)})}},{key:"getBlobWithFallback",value:function(e,t,n){var i=this;this.getBlob(e,function(e){var r=e.blob;r?n({blob:r}):i.getBlob(t,n)})}},{key:"getBase64",value:function(e,t){this.getBlob(e,function(e){var n=e.blob,i=e.error;if(i)return t({error:i});BFN.BlobUtils.blobToBase64(n).then(function(e){return t({base64:e})},function(e){return t({error:e})})})}},{key:"getBase64WithFallback",value:function(e,t,n){var i=this;this.getBase64(e,function(e){var r=e.base64;r?n({base64:r}):i.getBase64(t,n)})}},{key:"getText",value:function(e,t){BeFunky.request(e,{responseType:"blob"},function(e){var n=e.response,i=e.error;if(i)return t({error:i});BFN.BlobUtils.blobToText(n,t)})}},{key:"loadScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1};return BeFunky.loadScript("".concat(BFN.jsURL).concat(e),t)}}]),e}();BFN.SingletonQueue.add(function(){BFN.RequestUtils=new Je});var $e=BeFunky.loggingFlags.includes("texture_perf"),et={},tt=$e?function(e){et[e]=Date.now()}:function(){},nt=$e?function(e){BeFunky.logFeature("texture_perf",e,Date.now()-et[e]),delete et[e]}:function(){};BFN.TextureUtils={setupReusableImageTexture:function(){Qe=BFN.renderTexturesPool[1].texture,BFN.Stage.uploadTextureData(Qe.baseTexture)},blobOrBase64ToTexture:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.textureSize,r=void 0===i?BFN.maxImageSizeLayer:i,a=n.readEXIF,o=void 0===a||a;if(!e)return BeFunky.logError("No blob or base64 provided"),t({error:"No blob or base64 provided"});var s=e;if("string"==typeof e)try{s=BFN.BlobUtils.base64ToBlob(e)}catch(e){return t({error:"Unable to convert base64 to blob: ".concat(e)})}var l=o?BFN.BlobUtils.getOrientationAndEXIF(s):Promise.resolve({orientation:1,exif:void 0});BFN.BlobUtils.blobToImage(s,function(e){var n=e.error,i=e.imageBitmap,a=e.imageElement;if(n)return t({error:n});var o=i?i.width:a.naturalWidth,u=i?i.height:a.naturalHeight,c=s.type.startsWith("image/svg+xml"),h=BFN.TextureUtils.imageToTexture(i||a,{textureSize:r,scaleUp:c,couldBeTransparent:"image/jpeg"!==s.type});Math.min(h.width,h.height)<BFN.minImageSize&&BeFunky.throwError("Texture is too small","Dimensions = ".concat(h.width," x ").concat(h.height,". Blob type = ").concat(s.type)),l.then(function(e){var n=e.orientation,r=e.exif,s=a&&(BeFunky.safariVersion>=13.1||BeFunky.chromiumVersion>=81||BeFunky.firefoxVersion>=77)||i&&(BeFunky.chromiumVersion>=84||BeFunky.firefoxVersion>=77);if(1===n||s)return t({texture:h,exif:r,imageWidth:o,imageHeight:u});var l=h.width;if(BFN.Util.orientTexture(h,n),h.width!==l){var c=o;o=u,u=c}return t({texture:h,exif:r,imageWidth:o,imageHeight:u})})})},imageToTexture:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.textureSize,i=void 0===n?BFN.maxImageSizeLayer:n,r=t.scaleUp,a=void 0!==r&&r,o=t.couldBeTransparent,s=void 0===o||o,l=BFN.Stage.gl.getParameter(BFN.Stage.gl.MAX_TEXTURE_SIZE)||BFN.maxImageSize,u=e instanceof HTMLImageElement?e.naturalWidth:e.width,c=e instanceof HTMLImageElement?e.naturalHeight:e.height,h=Math.max(u,c),d="".concat(e instanceof HTMLImageElement?"ImageElement":"ImageBitmap"," ").concat(u," x ").concat(c," -> Texture");tt(d),i=Math.min(i,l),a||(i=Math.min(i,h));var m=u/c,p=(i=Math.max(i,Math.ceil(BFN.minImageSize*(m>1?m:1/m))))/h;if(1!==p&&BeFunky.Params.IS_LC&&console.log("Scaling ".concat(p>1?"up":"down"," image ").concat(p.toFixed(1),"x"),{width:u,height:c},"->",{width:Math.round(u*p),height:Math.round(c*p)}),e instanceof HTMLImageElement||h>l){var g=document.createElement("canvas"),f=g.getContext("2d");g.width=Math.round(u*p),g.height=Math.round(c*p),f.drawImage(e,0,0,g.width,g.height);var v=!0;if(!s&&[87,88,89].includes(BeFunky.chromiumVersion))f.getImageData(0,0,1,1).data.every(function(e){return 0===e})&&(h<=l?(v=!1,BeFunky.reportWarning("drawImage failed due to Chromium bug - rendering directly to texture")):BeFunky.throwError("drawImage failed due to Chromium bug - image too large"));var y=v?PIXI.Texture.fromCanvas(g):new PIXI.Texture(new PIXI.BaseTexture(e));Qe.resize(g.width,g.height,!1),Qe.frame=new PIXI.Rectangle(0,0,Qe.width,Qe.height),v?Qe.copyPixels(y):Qe.copyPixels(y,null,null,null,{x:g.width/y.width,y:g.height/y.height}),y.destroyGC(!0)}else{var x=new PIXI.Texture(new PIXI.BaseTexture(e)),_=Math.floor(x.width*p),I=Math.floor(x.height*p);Qe.resize(_,I,!1),Qe.frame=new PIXI.Rectangle(0,0,Qe.width,Qe.height),Qe.copyPixels(x,null,null,null,{x:_/x.width,y:I/x.height}),x.destroyGC(!0)}var T=PIXI.RenderTexture.create(Qe.width,Qe.height);return T.copyPixels(Qe),Qe.resize(512,512),nt(d),T},svgStringToTexture:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).textureSize,i=void 0===n?BFN.maxImageSizeLayer:n;if("string"!=typeof e)return BeFunky.logError("Invalid svgString provided: ".concat(BeFunky.getType(e))),t({error:"Invalid svgString provided"});BFN.SVGManager.getSVGShape(e,function(n){var r=BFN.SVGManager.getTexture(n,function(){if(n.width&&n.height){var a=n.width/n.height,o=a>1?i:i*a,s=a<1?i:i/a;return BFN.SVGManager.updateTexture(r,1,1,o,s),t({texture:r})}BeFunky.logError("Unable to convert SVG to Fabric Shape. Falling back to rendering it in an ImageElement");var l=new Blob([e],{type:"image/svg+xml"});BFN.TextureUtils.blobOrBase64ToTexture(l,t,{textureSize:i,readEXIF:!1})})},null,!0)},textureToBlob:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.validateQualityAndMimeType(t),i=n.isTransparent,r=n.quality,a=n.mimeType,o=BFN.TextureUtils.textureToCanvas(e,{isTransparent:i});return new Promise(function(e){o.toBlob(e,a,r)})},textureToBlobWithErrorHandling:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(i,r){var a=t.validateQualityAndMimeType(n),o=a.isTransparent,s=a.quality,l=a.mimeType;BFN.TextureUtils.textureToCanvas(e,{isTransparent:o}).toBlob(function(e){e instanceof Blob?i(e):r("canvas.toBlob failed")},l,s)})},textureToBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.validateQualityAndMimeType(t),i=n.isTransparent,r=n.quality,a=n.mimeType;return BFN.TextureUtils.textureToCanvas(e,{isTransparent:i}).toDataURL(a,r)},validateQualityAndMimeType:function(e){var t=e.isTransparent,n=e.mimeType,i=void 0===n?"image/png":n,r=e.quality,a=void 0===r?.99:r;if("boolean"==typeof t?i=t?"image/png":"image/jpeg":t="image/png"===i,!["image/png","image/jpeg"].includes(i))throw new Error("Invalid mime-type: ".concat(i));if("image/jpeg"===i&&(!(a=parseFloat(a))||a<0||a>1))throw new Error("Invalid quality: ".concat(a));return{isTransparent:t,quality:a,mimeType:i}},textureToCanvas:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isTransparent;if(!(void 0!==t&&t)){var n=PIXI.RenderTexture.create(e.width,e.height);n.fillColor(16777215),n.copyPixels(e,null,!1);var i=BFN.Stage.extract.canvas(n);return n.destroyGC(!0),i}Ze||((Ze=new PIXI.Sprite).filters=[new BFN.filters.UnPremultiplyFilter]),Ze.texture=e;var r=e.renderClone();BFN.Stage.render(Ze,r);var a=BFN.Stage.extract.canvas(r);return Ze.texture=PIXI.Texture.EMPTY,r.destroyGC(!0),a},getScaledDimensions:function(e,t){var n,i,r,a=t.maxWidth,o=t.maxHeight,s=t.scaleUp,l=void 0!==s&&s;return e.width/e.height>a/o?(i=(n=l?a:Math.min(a,e.width))/e.width,r=Math.round(e.height*i)):(i=(r=l?o:Math.min(o,e.height))/e.height,n=Math.round(e.width*i)),[n,r]}};var it,rt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"keyval-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";i(this,e),this.storeName=n,this._dbp=new Promise(function(e,i){var r=indexedDB.open(t,1);r.onerror=function(){return i(r.error)},r.onsuccess=function(){return e(r.result)},r.onupgradeneeded=function(){r.result.createObjectStore(n)}})}return a(e,[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then(function(i){return new Promise(function(r,a){var o=i.transaction(n.storeName,e);o.oncomplete=function(){return r()},o.onabort=o.onerror=function(){return a(o.error)},t(o.objectStore(n.storeName))})})}}]),e}();function at(){return it||(it=new rt),it}function ot(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:at())._withIDBStore("readwrite",function(n){n.put(t,e)})}function st(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:at())._withIDBStore("readwrite",function(e){e.clear()})}function lt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at(),t=[];return e._withIDBStore("readonly",function(e){(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(function(){return t})}var ut=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){var e=this;this.version="0.4",this.fallbackStore={},this.disabledReason=null,this.errorsRemaining=10,this.indexedDBReady=new Promise(function(t){var n=function(n,i){e.logError("Disabling IndexedDB during initial setup:",n),i&&e.reportError("Failed to setup IndexedDB",i),e.disabledReason=n,t(!1)},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return BeFunky.isFirefox&&"InvalidStateError"===i.name?(e.setPrivateBrowsingTag(!0),n("Firefox is in Private Browsing mode.")):BeFunky.isFirefox&&"UnknownError"===i.name?n("Firefox ESR user profile might be corrupted."):BeFunky.isEdgeHTML&&void 0===window.indexedDB?(e.setPrivateBrowsingTag(!0),n("Microsoft Edge is in Private Browsing mode.")):BeFunky.isSafari&&i.message.includes("BlobURLs are not yet supported.")?(e.setPrivateBrowsingTag(!0),n("Safari is in Private Browsing mode.")):"QuotaExceededError"===i.name?function(t){e.forceLog("Handing QuotaExceededError during startup");var n=function(t){return e.get(t,{readyPromise:Promise.resolve(!0)}).then(function(n){e.fallbackStore[t]=n}).catch(function(n){return e.logError("Unable to copy ".concat(t," into memory"),n)})};lt(e.store).then(function(e){return Promise.all(e.map(n))}).then(function(){return st(e.store)}).then(function(){e.forceLog("Successfully copied all keys into memory & cleared IndexedDB")}).catch(function(t){e.reportError("Failed to handle QuotaExceededError during startup",t)}).then(t)}(function(){return n(t,i)}):void n(t,i)},r=function(){ot("test_blob",new Blob,e.store).then(function(){return t(!0)},function(e){return i("Unable to set empty Blob",e)})};if(BeFunky.testingFlags.includes("disable_indexeddb"))return n("Automated testing");try{e.store=new rt}catch(e){return i("new idbKeyval.Store failed",e)}e.store._dbp.then(function(){e.log("Connected");var t,a="__IndexedDB_version",o=e.version;try{t=localStorage.getItem(a)}catch(e){return n("Unable to read ".concat(a," from localStorage"),e)}if(t===o)return r();t!==o&&(null!==t&&e.logError("Clearing IndexedDB while upgrading version",t,"->",o),st(e.store).then(function(){try{localStorage.setItem(a,o)}catch(e){return n("Unable to write ".concat(a," to localStorage"),e)}r()}).catch(function(e){i("Unable to clear keys while upgrading version",e)}))},function(e){return i("indexedDB.open failed",e)})}),this.usagePercent=null,this.hasLoggedUsage=!1,navigator.storage&&navigator.storage.estimate?this.logUsage=BeFunky.debounce(this.logUsage.bind(this),1e3):(BeFunky.logWarning("Unable to calculate storage usage or quota in this browser"),this.logUsage=function(){},this.hasLoggedUsage=!0),this.newBeFunkyTabOpened=!1,this.indexedDBReady.then(function(t){t?e.log("Allowing IndexedDB lookups"):e.logError("Using memory store b/c IndexedDB failed to initialize"),e.logUsage(),t&&e.listenForNewTabOpen()}),BeFunky.loggingFlags.includes("indexeddb")&&this.monitorLookups(),this.ignoreAutosaveNextSession=!1}},{key:"disable",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t?this.reportError("Disabling IndexedDB",t,e):this.logError("Disabling IndexedDB",t,e),this.indexedDBReady=Promise.resolve(!1),this.disabledReason=e,n){this.ignoreAutosaveNextSession=!0;var i=BFN.AppModel.sectionID;BeFunky.setLocal("ignore_autosave__".concat(i),"true")}}},{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=BeFunky).logFeature.apply(e,["indexeddb"].concat(n))}},{key:"forceLog",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r;BeFunky.loggingFlags.includes("indexeddb")?(i=BeFunky).logFeature.apply(i,["indexeddb"].concat(t)):(r=console).log.apply(r,["IndexedDB >"].concat(t))}},{key:"logWarning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r;BeFunky.loggingFlags.includes("indexeddb")?(i=BeFunky).logFeature.apply(i,["indexeddb"].concat(t)):(r=BeFunky).logWarning.apply(r,["IndexedDB >"].concat(t))}},{key:"logError",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r;BeFunky.loggingFlags.includes("indexeddb")?(i=BeFunky).logFeature.apply(i,["indexeddb"].concat(t)):(r=BeFunky).logError.apply(r,["IndexedDB >"].concat(t))}},{key:"retryAndTimeout",value:function(e){var t=e.attempt,n=e.retryAfter,i=e.onRetry,r=e.timeoutAfter,a=e.onTimeout;return new Promise(function(e,o){t().then(e,o).then(u,u);var s=setTimeout(function(){t().then(e,o).then(u,u),i()},n),l=setTimeout(function(){o("timeout"),a(),u()},r);function u(){clearTimeout(s),clearTimeout(l)}})}},{key:"reportError",value:function(e,t){var n,i,r=t&&t.name?t.name:t;"string"==typeof r&&t&&t.message&&(r="".concat(r,": ").concat(t.message));for(var a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];this.errorsRemaining>0?((n=BeFunky).throwError.apply(n,["".concat(e," - ").concat(r)].concat(o)),this.errorsRemaining--):(i=BeFunky).logError.apply(i,["".concat(e," - ").concat(r)].concat(o))}},{key:"get",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.useFallback,r=void 0===i||i,a=n.readyPromise;return(void 0===a?this.indexedDBReady:a).then(function(n){return r&&t.fallbackStore.hasOwnProperty(e)?t.fallbackStore[e]:n?t.retryAndTimeout({attempt:function(){return function(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:at())._withIDBStore("readonly",function(n){t=n.get(e)}).then(function(){return t.result})}(e,t.store).then(function(t){return t instanceof Blob&&(t.idbKeyName=e),t})},retryAfter:3e3,onRetry:function(){return t.logError("IndexedDB.get retried after 3 seconds",e)},timeoutAfter:1e4,onTimeout:function(){return t.reportError("IndexedDB.get took over 10 seconds","timeout",e)}}):void 0})}},{key:"set",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.useFallback,a=void 0===r||r;i.saveAttempt;return new Promise(function(i,r){n.indexedDBReady.then(function(o){if(n.fallbackStore.hasOwnProperty(e)&&delete n.fallbackStore[e],!o)return a?(n.fallbackStore[e]=t,i({store:"memory"})):r(n.disabledReason);t instanceof Blob&&t.idbKeyName&&(t.idbKeyName===e?n.logWarning('Blob from IndexedDB saved there again with same key "'.concat(e,'"')):n.logWarning('Blob from IndexedDB saved there again with new key "'.concat(t.idbKeyName,'" ->  "').concat(e,'"'))),ot(e,t,n.store).then(function(){t instanceof Blob&&BeFunky.isSafari?BFN.BlobUtils.blobToArrayBuffer(t,function(a){a.error?(n.logError("Unable to read Blob ".concat(e," (size = ").concat(BeFunky.formatBytes(t.size),") as ArrayBuffer after saving to IndexedDB.")),r("invalid_blob")):i({store:"IndexedDB"})}):i({store:"IndexedDB"}),n.logUsage()},function(o){if(!a)return r(o);n.fallbackStore[e]=t,i({store:"memory"});var s=o&&o.name?o.name:o;n.logError(s,"Storing ".concat(e," (").concat(BeFunky.getType(t),") in memory storage instead of IndexedDB"));var l=function(){if(o&&o.message&&/connection is closing/i.test(o.message))return n.disable("Fatal error during set()",o,!0);n.reportError("IndexedDB set failed",o)};BeFunky.isChrome?BeFunky.waitUntil({condition:function(){return n.hasLoggedUsage},onSuccess:l,onTimeout:l}):l()})})})}},{key:"delete",value:function(e){var t=this;return this.indexedDBReady.then(function(n){if(t.fallbackStore.hasOwnProperty(e))delete t.fallbackStore[e];else if(n)return function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:at())._withIDBStore("readwrite",function(t){t.delete(e)})}(e,t.store)})}},{key:"keys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.prefix,i=t.includeFallback,r=void 0===i||i;return this.indexedDBReady.then(function(t){var i=function(t){return r&&(t=t.concat(Object.keys(e.fallbackStore))),n&&(t=t.filter(function(e){return"string"==typeof e&&e.startsWith(n)})),t};return t?lt(e.store).then(i).catch(function(t){return r?(e.logError("Unable to list IndexedDB keys",t),i([])):Promise.reject(t)}):i([])})}},{key:"clear",value:function(){var e=this;return this.indexedDBReady.then(function(t){if(e.fallbackStore={},t)return st(e.store)})}},{key:"getFile",value:function(e,t,n){var i=this;return new Promise(function(r,a){i.indexedDBReady.then(function(i){var o="".concat(e,"__").concat(t);if(!i)return s();function s(){BFN.RequestUtils.getJSON(n,function(e){var t=e.error,n=e.response;if(t)return BeFunky.logError("Unable to fetch valid JSON file from server",t),i?u(function(e){if(!e.length)return a(t);BFN.IndexedDB.get(e[e.length-1]).then(function(t){t&&(BeFunky.logError("Falling back to outdated file",e[e.length-1]),l(t,!1))})}):a(t);l(n),i&&BFN.IndexedDB.set(o,n,{useFallback:!1}).catch(function(e){return BeFunky.logError("Unable to store file in IndexedDB",o,e)})})}function l(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r(e),t&&u(function(e){return e.forEach(function(e){return BFN.IndexedDB.delete(e)})})}function u(t){BFN.IndexedDB.keys({prefix:e,includeFallback:!1}).then(function(e){return t(e.filter(function(e){return e!==o}))}).catch(function(){return t([])})}BFN.IndexedDB.get(o).then(function(e){e?l(e):s()}).catch(function(e){BeFunky.logError("Unable lookup key in IndexedDB:",o,e),s()})})})}},{key:"listenForNewTabOpen",value:function(){var e=this,t=Date.now().toString();try{localStorage.setItem("__latest_tab",t)}catch(e){this.disable("Unable to write ".concat("__latest_tab"," to localStorage"),e)}window.addEventListener("storage",function n(i){"__latest_tab"===i.key&&BeFunky.getLocal("__latest_tab")!==t&&(e.newBeFunkyTabOpened=!0,console.log("A new tab was opened. Timestamp = ",i.newValue),window.removeEventListener("storage",n),e.disabledReason||(e.keys({includeFallback:!1}).then(function(t){return Promise.all(t.map(function(t){return e.get(t).then(function(n){e.fallbackStore[t]=n})}))}).catch(function(t){e.reportError("Unable to copy IndexedDB values to memory when new tab was opened",t)}).then(function(){e.disable("A new tab was opened")}),BeFunky.acknowledge("auto_save_disabled")))})}},{key:"logUsage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];requestIdleCallback(function(){navigator.storage.estimate().then(function(n){var i=n.usage,r=n.quota,a=(100*i/r).toFixed(2);if(t||a!==e.usagePercent){e.usagePercent=a;var o=["Using ".concat(a,"% of allowed storage, ").concat(BeFunky.formatBytes(i)," of ").concat(BeFunky.formatBytes(r))];a>100?e.logError.apply(e,o):t||!e.hasLoggedUsage?e.forceLog.apply(e,o):e.log.apply(e,o),BeFunky.isChrome&&!e.hasLoggedUsage&&e.setPrivateBrowsingTag(r/Math.pow(1024,2)<110)}},function(t){e.logError("Unable to calculate storage usage or quota",t)}).then(function(){e.hasLoggedUsage=!0})})}},{key:"monitorLookups",value:function(){var e=this,t=[],n=function(n){var i=e[n];e[n]=function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s=[n].concat(a),l=setTimeout(function(){e.log("Lookup taking a long time",s)},3e3);return t.push(s),i.call.apply(i,[e].concat(a)).then(function(){return clearTimeout(l),t=t.filter(function(e){return e!==s}),Promise.resolve.apply(Promise,arguments)},function(){return clearTimeout(l),t=t.filter(function(e){return e!==s}),Promise.reject.apply(Promise,arguments)})}};n("get"),n("set"),n("clear"),n("delete"),n("keys"),Object.defineProperty(this,"pendingLookups",{get:function(){return t.slice()}})}},{key:"setPrivateBrowsingTag",value:function(e){BeFunky.setSentryTag("private_browsing",e),this.log("Private browsing =",e)}}]),e}();BFN.SingletonQueue.add(function(){BFN.IndexedDB=new ut}),BFN.ExtractImageEvents={IMAGE_COMPRESS_FINISHED:new Event("IMAGE_COMPRESS_FINISHED"),WAITING_COMPRESS_STARTED:new Event("WAITING_COMPRESS_STARTED"),UPLOAD_STARTED:new Event("UPLOAD_STARTED"),UPLOAD_CANCELLED:new Event("UPLOAD_CANCELLED"),UPLOAD_FAILED:new Event("UPLOAD_FAILED"),UPLOAD_COMPLETED:new Event("UPLOAD_COMPLETED")};var ct=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.quality=.95,this.mimeType="image/jpeg",this.fileName="BeFunkyArtwork",this._currentTexture=null,this.xhr=null,BFN.uploadVo=null,this.binaryData=null,this.UPDATE_PGOGRESS_EVENT_HANDLER=this.updateProgress.bind(this),this.TRANSFER_FAILED_HANDLER=this.transferFailed.bind(this),this.TRANSFER_CANCELED_HANDLER=this.transferCanceled.bind(this)}},{key:"compress",value:function(e,t,n,i){if(null!=e&&e!=this.quality&&(this.quality=e),null!=t&&t!=this.mimeType&&(this.mimeType=t),!0!==n&&(this.blobData=null),null!=this.currentTexture){var r,a=null;if("image/png"===this.mimeType){var o=new BFN.filters.UnPremultiplyFilter;(r=new PIXI.Sprite(this.currentTexture)).filters=[o],a=PIXI.RenderTexture.create(this.currentTexture.width,this.currentTexture.height),BFN.Stage.render(r,a);try{r.texture=null,r=null}catch(e){}o=null;try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){}}else(a=PIXI.RenderTexture.create(this.currentTexture.width,this.currentTexture.height)).fillColor(16777215),a.copyPixels(this.currentTexture,null,!1);var s=null!==a?BFN.Stage.extract.canvas(a):BFN.Stage.extract.canvas(this.currentTexture),l=this;if(!0===n){var u=s.toDataURL(this.mimeType,this.quality);return u=u.replace("data:".concat(this.mimeType,";base64,"),"")}setTimeout(function(){s.toBlob(function(e){l.blobData=e,null!==a&&(a.destroyGC(!0),a=null),null!=i?i(l.blobData):l.dispatchEvent(BFN.ExtractImageEvents.IMAGE_COMPRESS_FINISHED)},l.mimeType,l.quality)},0)}else console.warn("-[ExtractImage:compress] : currentTexture parameter is null");if(1==n)return null}},{key:"saveToDesktop",value:function(){if(null!=this.blobData){this.fileName.length<1&&(this.fileName="BeFunky-artwork");var e=this.fileName.replace(/\.(jpe?g|png)$/,"")+("image/jpeg"===this.mimeType?".jpg":".png");saveAs(this.blobData,e)}}},{key:"upload",value:function(e,t){var n=this;BFN.uploadVo=null;var i=null==e?"https://upload.befunky.com/restupload/uploadbinv6.bfn?fromFlash=1&method=befunky.uploadFile":e;t.CSRFtoken=getCsToken();var r=this;if(null!=this.currentTexture){this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_STARTED);var a=BFN.Stage.extract.canvas(this.currentTexture);a.toBlob(function(e){r.binaryData=e,a=null,r.xhr=new XMLHttpRequest,r.xhr.onload=function(){var e=null!=r.xhr.response?r.xhr.response:r.xhr.responseText;if(null!=e){e=e.replace("\n","");var t=null;try{t=window.parseXml(e)}catch(e){return void r.transferFailed()}if(null!=t){var i=null;try{i=t}catch(e){return void r.transferFailed()}null==i||null!=i.getElementsByTagName("url")&&i.getElementsByTagName("url")[0].childNodes[0].nodeValue.length<1?n.transferFailed():(BFN.uploadVo=new BFN.UploadVO,BFN.uploadVo.url=i.getElementsByTagName("url")[0].childNodes[0].nodeValue,BFN.uploadVo.width=i.getElementsByTagName("width")[0].childNodes[0].nodeValue,BFN.uploadVo.height=i.getElementsByTagName("height")[0].childNodes[0].nodeValue,BFN.uploadVo.size=i.getElementsByTagName("size")[0].childNodes[0].nodeValue,BFN.uploadVo.resizedUrl=i.getElementsByTagName("url")[1].childNodes[0].nodeValue,BFN.uploadVo.resizedWidth=i.getElementsByTagName("width")[1].childNodes[0].nodeValue,BFN.uploadVo.resizedHeight=i.getElementsByTagName("height")[1].childNodes[0].nodeValue,BFN.uploadVo.resizedSize=i.getElementsByTagName("size")[1].childNodes[0].nodeValue,r.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_COMPLETED),r.removeUploadEvent(),BeFunky.log("Upload completed : ".concat(BFN.uploadVo.url)))}else r.transferFailed()}else r.transferFailed()},r.xhr.upload.addEventListener("progress",r.UPDATE_PGOGRESS_EVENT_HANDLER),r.xhr.upload.addEventListener("error",r.TRANSFER_FAILED_HANDLER),r.xhr.upload.addEventListener("abort",r.TRANSFER_CANCELED_HANDLER),r.xhr.withCredentials=!0,r.xhr.open("POST",i,!0),r.xhr.setRequestHeader("Content-Type","application/octet-stream"),r.xhr.responseType="text",r.xhr.send(r.binaryData)},"image/jpeg",1)}else this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_FAILED)}},{key:"cancelUpload",value:function(){if(null!=this.xhr)try{this.xhr.abort()}catch(e){}}},{key:"removeUploadEvent",value:function(){try{this.xhr.upload.removeEventListener("progress",this.UPDATE_PGOGRESS_EVENT_HANDLER),this.xhr.upload.removeEventListener("error",this.TRANSFER_FAILED_HANDLER),this.xhr.upload.removeEventListener("abort",this.TRANSFER_CANCELED_HANDLER)}catch(e){}try{this.xhr.onload=null}catch(e){}this.xhr=null,this.binaryData=null}},{key:"updateProgress",value:function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;BeFunky.log("uploading progress : %".concat(t))}else BeFunky.log("Unable to compute progress information since the total size is unknown")}},{key:"transferFailed",value:function(e){BeFunky.log("An error occurred while transferring the file."),this.removeUploadEvent(),this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_FAILED)}},{key:"transferCanceled",value:function(e){BeFunky.log("The transfer has been canceled by the user."),this.removeUploadEvent(),this.dispatchEvent(BFN.ExtractImageEvents.UPLOAD_CANCELLED)}},{key:"quality",set:function(e){this._quality=e},get:function(){return this._quality}},{key:"mimeType",set:function(e){this._mimeType=e},get:function(){return this._mimeType}},{key:"fileName",set:function(e){this._fileName=e},get:function(){return this._fileName}},{key:"binaryData",set:function(e){this._binaryData=e},get:function(){return this._binaryData}},{key:"blobData",set:function(e){this._blobData=e},get:function(){return this._blobData}},{key:"currentTexture",set:function(e){this._currentTexture=e},get:function(){return this._currentTexture}}]),n}();BFN.SingletonQueue.add(function(){BFN.ExtractImage=new ct}),BFN.ArtsyServiceEvents={CANCELLED:new Event("ARTSY_SERVICE_CANCELLED"),FAILED:new Event("ARTSY_SERVICE_FAILED"),COMPLETED:new Event("ARTSY_SERVICE_COMPLETED")};var ht=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.isArtsy=!0,this.maxPixels=null,this.xhr=null,this._currentTexture=null,this._uploadTexture=null,this.artsyServiceURL="https://upload.befunky.com/artsy/",this.currentArtsyID=233,this.currentArtsyParams={color_detail:350,sketch_smoothness:20,clutter_cleaner:3,sketch_brightness:35,sketch_detail:17,color_smoothness:100},this.downloadedImage=null,this.PROCESS_FAILED_EVENT_HANDLER=this.processFailed.bind(this),this.PROCESS_ABORTED_EVENT_HANDLER=this.processAborted.bind(this),this.UPLOAD_COMPLETE_EVENT_HANDLER=this.processImage.bind(this)}},{key:"processImage",value:function(){var e=this;if(null!=BFN.uploadVo){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}this.isArtsy?UIMessages.display("processing_image"):UIMessages.display("enhancing_your_photo"),this.removeUploadEvent(),null!=this.xhr&&this.removeArtsyEvent(),this.xhr=new XMLHttpRequest,this.xhr.onload=function(){e.processCompleted()},this.xhr.onerror=function(){e.processFailed("error")},this.xhr.upload.addEventListener("error",this.PROCESS_FAILED_EVENT_HANDLER),this.xhr.upload.addEventListener("abort",this.PROCESS_ABORTED_EVENT_HANDLER),this.xhr.withCredentials=!0,this.xhr.open("POST",this.artsyServiceURL,!0);var t,n=getCsToken();if(["a_i_enhancer","a_i_portrait"].includes(this.currentArtsyID)){var i="a_i_enhancer"===this.currentArtsyID?"enhancer":"portrait";t="method=api/auto-enhancer/&image=".concat(BFN.uploadVo.url,"&model=").concat(i,"&CSRFtoken=").concat(n)}else if(this.currentArtsyID.startsWith("AI_ARTSY_STYLE_")){var r=this.currentArtsyID.replace("AI_ARTSY_STYLE_","");t="method=api/artsy-style/&image=".concat(BFN.uploadVo.url,"&style=").concat(r,"&CSRFtoken=").concat(n)}else t="method=befunky.runTemplateEffect&template_id=".concat(this.currentArtsyID,"&adjustment=&url=").concat(BFN.uploadVo.url,"&psize=&vm=&CSRFtoken=").concat(n);for(var a in BeFunky.Params.isAdmin&&(t+="&is_beta=1"),this.currentArtsyParams)t="".concat(t,"&").concat(a,"=").concat(this.currentArtsyParams[a]);this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.xhr.setRequestHeader("X-CSRF-Token",n),this.xhr.responseType="json",this.xhr.send(t)}else this.uploadImage()}},{key:"uploadImage",value:function(){var e=this;if(this._currentTexture){var t=this._currentTexture.determineTransparency(),n=this._currentTexture.renderClone();if(t){var i=PIXI.RenderTexture.create(n.width,n.height);i.fillColor(16777215),i.copyPixels(n,null,!1);try{n.destroyGC(!0)}catch(e){}n=i}var r=BFN.BfnService.userIsPlus;if(r||n.width<BFN.maxImageUploadSizeFreeUser&&n.height<BFN.maxImageUploadSizeFreeUser)if(null!=this.maxPixels&&this.maxPixels>0){var a=BFN.Util.conformImageSizeMegaPixels(n,BFN.minImageSize,this.maxPixels);n.destroyGC(!0),n=a}else{var o=BFN.Util.conformImageSize(n,BFN.minImageSize,BFN.maxImageSizeForArtsy);n.destroyGC(!0),n=o}else if(r&&null!=this.maxPixels&&this.maxPixels>0){var s=BFN.Util.conformImageSizeMegaPixels(n,BFN.minImageSize,this.maxPixels);n.destroyGC(!0),n=s}else{var l=BFN.maxImageUploadSizeFreeUser;(["a_i_enhancer","a_i_portrait"].includes(this.currentArtsyID)||this.currentArtsyID.startsWith("AI_ARTSY_STYLE_"))&&(l=BFN.maxImageSizeForArtsy),n=BFN.Util.conformImageSize(n,BFN.minImageSize,l)}if(this._uploadTexture=n,void 0===window.DirectUPL)BFN.ExtractImage.currentTexture=this._uploadTexture,BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER),BFN.ExtractImage.upload();else{var u=null,c=BFN.Stage.extract.canvas(this._uploadTexture);c.toBlob(function(t){u=t,c=null,window.DirectUPL.upload(function(t){if(u=null,t&&t.url&&t.s3_name)BFN.uploadVo=new BFN.UploadVO,BFN.uploadVo.url=t.url,e.processImage();else try{if("abort"!==t&&void 0!==t&&void 0===t.abort)try{BFN.ExtractImage.currentTexture=e._uploadTexture,BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,e.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,e.UPLOAD_COMPLETE_EVENT_HANDLER),BFN.ExtractImage.upload()}catch(t){e.processFailed("error")}else e.processFailed()}catch(t){e.processFailed()}},{bucket:["a_i_enhancer","a_i_portrait"].includes(e.currentArtsyID)||e.currentArtsyID.startsWith("AI_ARTSY_STYLE_")?"ai-enhancer":"artsyupload",content_type:"image/jpeg",blob:u})},"image/jpeg",["a_i_enhancer","a_i_portrait"].includes(this.currentArtsyID)||this.currentArtsyID.startsWith("AI_ARTSY_STYLE_")?.99:.9)}UIMessages.display("preparing_image")}}},{key:"processCompleted",value:function(){var e=this;this.removeUploadEvent();try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}var t=function(t,n){console.log(t,n),e.processFailed("error")},n=null;try{n=null!=this.xhr.response?this.xhr.response:this.xhr.responseText}catch(e){}if(n&&n.error)return t("Artsy request failed",n.error);if(!n||!n.data)return t("Artsy request failed","no_response");var i=n.data.url||n.data.image;if(!i)return this.processFailed("error");UIMessages.display("downloading_processed_image"),this.downloadedImage=null;var r=document.createElement("img");r.setAttribute("crossOrigin","Anonymous"),r.onload=function(){var t=new PIXI.Texture(new PIXI.BaseTexture(r)),n=t.renderClone();t.destroyGC(!0),BFN.ArtsyServiceEvents.COMPLETED.data=n,e.dispatchEvent(BFN.ArtsyServiceEvents.COMPLETED),BFN.ArtsyServiceEvents.COMPLETED.data=null,n.destroyGC(!0)},r.onerror=function(){e.processFailed("error")},r.src=i,this.downloadedImage=r,this.removeArtsyEvent()}},{key:"processFailed",value:function(e){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}this.removeUploadEvent(),this.removeArtsyEvent(),this.downloadedImage=null,this.dispatchEvent(BFN.ArtsyServiceEvents.FAILED),"error"===e&&setTimeout(function(){UIMessages.display("error_invalid_response")},666)}},{key:"cancel",value:function(){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}if(this.removeUploadEvent(),BFN.ExtractImage.cancelUpload(),null!=this.downloadedImage&&(this.downloadedImage.src="",this.downloadedImage=null),void 0!==window.DirectUPL)try{if(void 0!==window.DirectUPL.signReq&&null!=window.DirectUPL.signReq){try{window.DirectUPL.signReq.abort()}catch(e){}window.DirectUPL.signReq=null}if(void 0!==window.DirectUPL.uploadReq&&null!=window.DirectUPL.uploadReq){try{window.DirectUPL.uploadReq.abort()}catch(e){}window.DirectUPL.uploadReq=null}}catch(e){}if(null!=this.xhr)try{this.xhr.abort()}catch(e){}this.removeArtsyEvent(),this.dispatchEvent(BFN.ArtsyServiceEvents.CANCELLED)}},{key:"reset",value:function(){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}null!=BFN.uploadVo&&(BFN.uploadVo=null),this._currentTexture=null,this.downloadedImage=null}},{key:"processAborted",value:function(){this.removeUploadEvent(),this.removeArtsyEvent(),BFN.ExtractImage.cancelUpload();try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}this.downloadedImage=null,this.dispatchEvent(BFN.ArtsyServiceEvents.CANCELLED)}},{key:"removeUploadEvent",value:function(){try{BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER)}catch(e){}}},{key:"removeArtsyEvent",value:function(){try{this._uploadTexture.destroyGC(!0),this._uploadTexture=null}catch(e){}if(this.xhr){try{this.xhr.upload.removeEventListener("error",this.PROCESS_FAILED_EVENT_HANDLER),this.xhr.upload.removeEventListener("abort",this.PROCESS_ABORTED_EVENT_HANDLER)}catch(e){}try{this.xhr.onload=null}catch(e){}this.xhr=null}}},{key:"currentArtsyID",set:function(e){this._currentArtsyID=e},get:function(){return this._currentArtsyID}},{key:"currentArtsyParams",set:function(e){this._currentArtsyParams=e},get:function(){return this._currentArtsyParams}},{key:"currentTexture",set:function(e){this._currentTexture=e},get:function(){return this._currentTexture}}]),n}();BFN.SingletonQueue.add(function(){BFN.ArtsyService=new ht}),BFN.BfnServiceEvents={USER_DATA_CHANGED:new Event("USER_DATA_CHANGED"),CUSTOM_RESIZE_EVENT:new Event("CUSTOM_RESIZE_EVENT"),TRANSFER_FAILED:new Event("TRANSFER_FAILED"),TRANSFER_CANCELLED:new Event("TRANSFER_CANCELLED"),TRANSFER_COMPLETED:new Event("TRANSFER_COMPLETED")};var dt=function(e){u(r,BFN.EventDispatcher);var t=p(r);function r(){var e;return i(this,r),(e=t.call(this)).init(),e}return a(r,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.xhr=null,this.UPDATE_PGOGRESS_EVENT_HANDLER=this.updateProgress.bind(this),this.TRANSFER_FAILED_HANDLER=this.transferFailed.bind(this),this.TRANSFER_CANCELED_HANDLER=this.transferCanceled.bind(this),this.UPLOAD_FAILED_EVENT_HANDLER=this.onUploadFailed.bind(this),this.UPLOAD_COMPLETE_EVENT_HANDLER=this.onUploadComplete.bind(this),this.hashtagRegExp=/(#[a-zA-Z0-9_%-]*)/g,this.initCompleteFired=!1,window.addEventListener("INIT_COMPLETE",function(){e.initCompleteFired=!0})}},{key:"updateUserData",value:function(){var e=this;this.initCompleteFired?this.dispatchEvent(BFN.BfnServiceEvents.USER_DATA_CHANGED):setTimeout(function(){window.addEventListener("INIT_COMPLETE",function(){e.dispatchEvent(BFN.BfnServiceEvents.USER_DATA_CHANGED)})},0)}},{key:"login",value:function(e){var t=!1;e&&(t=function(){BeFunky.befunkyPopupContainerClose(),e()}),BeFunky.openLoginPanel("SIGNIN",t)}},{key:"register",value:function(e){BeFunky.openLoginPanel("REGISTER",e||!1)}},{key:"signOut",value:function(){function e(){BeFunky.signOut()}BFN.IndexedDB.indexedDBReady.then(function(t){if(!t)return e();BeFunky.confirm("confirm_keep_projects",{onConfirm:e,onCancel:function(){return function(){Object.values(BFN.ProjectManager.autoSave).forEach(function(e){e.allowAutoSave=!1});var e=["editor","collage","designer"].map(function(e){return BFN.IndexedDB.delete("project__".concat(e))}),t=BFN.ProjectService.clearLocalAssets("all"),n=BFN.IndexedDB.delete("options__selectedMenuImageVOs"),i=BFN.IndexedDB.delete("options__selectedGraphics");return Promise.all([].concat(v(e),[t,n,i])).catch(function(e){BeFunky.logError("Unable to delete all projects and their assets:",e)})}().then(e)},confirmText:"yes",cancelText:"no_clear_them",isCritical:!0})})}},{key:"upgrade",value:function(e,t,n){"string"==typeof e&&BFN.BfnService.track("CREATE",e.toUpperCase(),t?t.toUpperCase():"UPGRADE"),BeFunky.openTeaserModal(n)}},{key:"onUserLogin",value:function(e){var t=this;if(this.userLoggedIn)return e(this.userIsPlus);this.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,function n(){t.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,n),t.userLoggedIn&&e(t.userIsPlus)})}},{key:"importDropBoxImage",value:function(){window.dBoxOpenPicker()}},{key:"importGoogleDriveImage",value:function(){window.drv_OpenPicker()}},{key:"hideEditor",value:function(){window.hideEditor(),BFN.BfnService.track("CREATE","GLOBALMENU","HIDE_APP")}},{key:"callbackFromJs",value:function(e,t){t?(this.googleDriveObj={insertUrl:e,access_token:t},null!=this.tmpInternalCallback&&(this.tmpInternalCallback(),this.tmpInternalCallback=null)):null!=this.tmpCallback&&(this.tmpCallback("cancel"),this.tmpCallback=null)}},{key:"callbackDriveInsertFile",value:function(e){if(this.googleDriveObj.base64=null,null!=this.tmpCallback){if("error"!==e){var t=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",t,"GOOGLE_DRIVE")}this.tmpCallback("error"===e?"error":"cancel"===e?"cancel":null),this.tmpCallback=null,this.tempParams=null}}},{key:"getGoogleDriveAccessToken",value:function(){try{window.driveInmediateDisplay(!0)}catch(e){}}},{key:"saveGoogleDriveImage",value:function(e,t){try{window.insertDriveFile(e,t)}catch(e){}}},{key:"ToJsBase64Uploader",value:function(e,t,n){BFN.AppModel.viewingEditor||BeFunky.throwError("ToJsBase64Uploader requested while not in Editor"),e.includes("data:image")||(e="data:image/png;base64,".concat(e)),"string"==typeof n?BFN.BfnService.trackMediaOpened("image",n):BeFunky.logError("Unable to track ToJsBase64Uploader media open b/c no source was provided"),"string"==typeof t&&t.includes(".")&&(t=t.split(".").slice(0,-1).join(".")),BFN.BfnService.ToJsUrlUploader(e,t,!0,n)}},{key:"ToJsUrlUploader",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(BFN.AppModel.viewingEditor||BeFunky.throwError("ToJsUrlUploader requested while not in Editor"),!BFN.hasFullyOpenedEditor)return console.log("Waiting for Photo Editor to initialize before opening external image"),void(BeFunky.editorExternalImage={ignoreExistingProject:i,loadImage:function(){if(!BFN.hasFullyOpenedEditor)return BeFunky.throwError("BeFunky.editorExternalImage.loadImage called before hasFullyOpenedEditor");n.ToJsUrlUploader(e,t,!0,r)}});var a=function(){if(e.startsWith("data:image"))BFN.PhotoEditorModel.loadBase64OrBlob(e,{filename:t});else{if(!n.isUrl(e))return BeFunky.logError("Invalid url provided",e),o();"string"==typeof r?BFN.BfnService.track("CREATE","UPLOAD",r.toUpperCase()):BFN.BfnService.track("CREATE","UPLOAD","WEB"),"string"==typeof r?BFN.BfnService.trackMediaOpened("image",r):BeFunky.logError("Unable to track ToJsUrlUploader media open b/c no source was provided");var i=!1;BeFunky.showLoadScreen({onCancel:function(){i=!0,o()}}),"string"!=typeof t&&(t=e.substring(e.lastIndexOf("/")+1).replace(/\.[^/.]+$/,"").trim()||"External Image");var a="".concat(BeFunky.Params.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(e));BFN.RequestUtils.getBlobWithFallback(e,a,function(e){var n=e.error,r=e.blob;if(!i)return n?(BeFunky.logError(n),BeFunky.hideLoadScreen(),void o()):void BFN.PhotoEditorModel.loadBase64OrBlob(r,{filename:t})})}};function o(){BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture&&UIToggler.toggleSampleImagePopover(!0)}i?a():BFN.IndexedDB.get("project__editor").then(function(e){if(!BFN.ProjectManager.validateProject(e,{requireEditorMainImage:!1}))throw"No valid editor project";BeFunky.logError("Ignoring ToJsUrlUploader() b/c Editor Project already exists")}).catch(function(){a()})}},{key:"track",value:function(e,t,n,i){BeFunky.log("TRACKING:",e,t,n),window.bf_eventTrack(e,t,n,i)}},{key:"trackMediaOpened",value:function(e,t){BFN.imageTypes.includes(t)&&t.startsWith("befunky_")&&(t="befunky");var n={image:"Image",project:"Project"},i={computer:"Computer",facebook:"Facebook",drive:"Drive",dropbox:"Dropbox",befunky:"BeFunky",webcam:"Webcam",sample:"Sample",unsplash:"Unsplash",pixabay:"Pixabay",pexels:"Pexels",chrome_extension:"chrome_extension",google_photos:"Google Photos"};if(!n.hasOwnProperty(e))return BeFunky.throwError("Invalid media type: ".concat(e));if(!i.hasOwnProperty(t))return BeFunky.throwError("Invalid media source: ".concat(t));var r=new BFN.UserActionVO;r.eventID="media_opened",r.eventObject={mediaType:n[e],mediaOpenLocation:i[t]},r.peopleObject={lastMediaOpenDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaOpenCount:1,lifetimeImagesOpenCount:"project"===e?0:1},r.track()}},{key:"saveToBeFunky",value:function(e,t){if(BFN.BfnService.userLoggedIn){var n=e.text.slice(0,100),i="";try{for(var r={},a=[];r=this.hashtagRegExp.exec(n);){var o=r[0].replace("#","").toLowerCase();a.push(o)}i=a.join(",")}catch(e){}var s=this;e.quality=void 0!==e.quality?e.quality:.9,e.mimeType=void 0!==e.mimeType?e.mimeType:"image/jpeg";var l,u;l=e.blob,u={},BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&(u.apptype="collage"),u.Title=n,u.bftags="",u.preset_id="0",u.isPublic=e.isPublic?1:0,u.tags=i,u.image=l,u.image_type=e.mimeType,u.CSRFtoken=getCsToken(),s.multipartUpload("".concat(BeFunky.Params.uplUri,"/restupload/savegallery.bfn"),u,function(e){if(0==(null!=e)){var n=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",n,"BEFUNKY")}null!=t&&(t(e),s.multipartCallBack=null),u=null,"not_login"===e&&BeFunky.UserManager.checkUserToken("not_logged_in","API")})}}},{key:"saveToGoogleDrive",value:function(e,t){var n=this;n.tempParams=n.tempParams||e,n.tmpCallback=n.tmpCallback||t;var i=n.tempParams.text;this.tmpInternalCallback=function(){BFN.ExtractImage.currentTexture=n.tempParams.texture,BFN.ExtractImage.compress(1,"image/jpeg",!1,function(e){var t=new FileReader;t.onload=function(e){try{n.googleDriveObj.base64=e.target.result.replace("data:image/jpeg;base64,",""),n.saveGoogleDriveImage(n.googleDriveObj.base64,i),t=null}catch(e){null!=n.tmpCallback&&(n.tmpCallback("error"),n.tempParams=null,n.tmpCallback=null)}},t.readAsDataURL(e)})},this.getGoogleDriveAccessToken()}},{key:"prepareDropboxSave",value:function(e,t){if(this.tmpCallback=t,null==e)null!=t&&(t(),this.tmpCallback=null);else if(void 0===window.DirectUPL)BFN.ExtractImage.currentTexture=e,BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.UPLOAD_FAILED_EVENT_HANDLER),BFN.ExtractImage.addEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER),BFN.ExtractImage.upload();else{var n=this,i=null,r=BFN.Stage.extract.canvas(e);r.toBlob(function(e){i=e,r=null,window.DirectUPL.upload(function(e){i=null,e&&e.url&&e.s3_name?(BFN.uploadVo=new BFN.UploadVO,BFN.uploadVo.url=e.url,n.onUploadComplete()):n.onUploadFailed()},{bucket:"artsyupload",content_type:"image/jpeg",blob:i})},"image/jpeg",.9)}}},{key:"onUploadFailed",value:function(){try{BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER)}catch(e){}null!=this.tmpCallback&&(this.tmpCallback(),this.tempParams=null,this.tmpCallback=null)}},{key:"onUploadComplete",value:function(){try{BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_FAILED.type,this.PROCESS_FAILED_EVENT_HANDLER),BFN.ExtractImage.removeEventListener(BFN.ExtractImageEvents.UPLOAD_COMPLETED.type,this.UPLOAD_COMPLETE_EVENT_HANDLER)}catch(e){}null!=this.tmpCallback&&(this.tmpCallback(),this.tempParams=null,this.tmpCallback=null)}},{key:"saveToDropBox",value:function(e,t){this.tempParams=this.tempParams||e,this.tmpCallback=this.tmpCallback||t,BFN.uploadVo&&null!=BFN.uploadVo.url?window.dBoxSaveFile(BFN.uploadVo.url,"".concat(this.tempParams.text,".jpg")):null!=this.tmpCallback&&(this.tmpCallback("error"),this.tempParams=null,this.tmpCallback=null)}},{key:"handlerDropBoxInsert",value:function(e){if("error"===e)null!=this.tmpCallback&&this.tmpCallback("error");else if("cancel"===e)null!=this.tmpCallback&&this.tmpCallback("cancel");else{var t=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",t,"DROP_BOX"),null!=this.tmpCallback&&this.tmpCallback()}this.tempParams=null,this.tmpCallback=null}},{key:"shareToFacebookOrPinterest",value:function(e,t){var n=this;n.tempParams=n.tempParams||e,n.tmpCallback=n.tmpCallback||t;var i=n.tempParams.text;BFN.ExtractImage.currentTexture=n.tempParams.texture;var r=n.tempParams.hasOwnProperty("mimeType")?n.tempParams.mimeType:"image/jpeg";BFN.ExtractImage.compress(1,r,!1,function(e){var t={};t.title=i,t.image_type=r,t.image=e,t.CSRFtoken=getCsToken(),UIToggler.onLoadScreenCancel=n.transferCanceled,n.multipartUpload("".concat(BeFunky.Params.uplUri,"/restupload/savetoanonymous.bfn"),t,function(e,r){if(0==(null!=e)){var a=BFN.AppModel.sectionValue("SHARE","SHARE_COLLAGE","SHARE_DESIGNER");if(BFN.BfnService.track("CREATE",a,n.tempParams.apptype.toUpperCase()),null!=r&&r.hasOwnProperty("link")){var o=encodeURIComponent(i),s=encodeURIComponent(r.fileurl),l=encodeURI(r.link);BeFunky.shareLink(n.tempParams.apptype,l,s,o)}}null!=n.tmpCallback&&(n.tmpCallback(e),n.tmpCallback=null),n.multipartCallBack=null,t=null,n.tempParams=null},null,null,"json",!0)})}},{key:"multipartUpload",value:function(e,t,n,i,r,a,o){var s=this;this.multipartCallBack=n,this.xhr=new XMLHttpRequest,this.xhr.onload=function(){var e=null;try{e=null!=s.xhr.response?s.xhr.response:s.xhr.responseText}catch(e){}null!=e?e.hasOwnProperty("err")?s.transferFailed(e.err):e.hasOwnProperty("error")?s.transferFailed("error"):e.hasOwnProperty("errors")?s.transferFailed("errors"):(s.clearXHR(),null!=s.multipartCallBack?o?s.multipartCallBack(null,e):s.multipartCallBack():s.dispatchEvent(BFN.BfnServiceEvents.TRANSFER_COMPLETED)):s.transferFailed("err")},this.xhr.upload.addEventListener("progress",this.UPDATE_PGOGRESS_EVENT_HANDLER),this.xhr.upload.addEventListener("error",this.TRANSFER_FAILED_HANDLER),this.xhr.upload.addEventListener("abort",this.TRANSFER_CANCELED_HANDLER),i||(this.xhr.withCredentials=!0),this.xhr.open("POST",e,!0),null!=r&&this.xhr.setRequestHeader("Content-Type",r),this.xhr.responseType=a||"json";var l=new FormData;for(var u in t)l.append(u,t[u]);this.xhr.send(l)}},{key:"updateProgress",value:function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;BeFunky.log("uploading progress : %".concat(t))}else BeFunky.log("Unable to compute progress information since the total size is unknown")}},{key:"transferFailed",value:function(e){BeFunky.log("An error occurred while transferring the file."),this.clearXHR(),null!=this.multipartCallBack?this.multipartCallBack(null!=e&&("string"==typeof e||e instanceof String)?e:"error"):this.dispatchEvent(BFN.BfnServiceEvents.TRANSFER_FAILED)}},{key:"transferCanceled",value:function(e){BeFunky.log("The transfer has been canceled by the user."),BFN.BfnService.clearXHR(),null!=BFN.BfnService.multipartCallBack?BFN.BfnService.multipartCallBack():BFN.BfnService.dispatchEvent(BFN.BfnServiceEvents.TRANSFER_CANCELLED)}},{key:"clearXHR",value:function(){try{if(null!=this.xhr){this.xhr.upload.removeEventListener("progress",this.UPDATE_PGOGRESS_EVENT_HANDLER),this.xhr.upload.removeEventListener("error",this.TRANSFER_FAILED_HANDLER),this.xhr.upload.removeEventListener("abort",this.TRANSFER_CANCELED_HANDLER);try{this.xhr.abort()}catch(e){}this.xhr.onload=null,this.xhr=null}}catch(e){}}},{key:"isUrl",value:function(e){return/^(ftp|http|https):\/\/(\w+:?\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@\-/]))?/.test(e)}},{key:"getImageBlobOrSVG",value:function(e,t){var n=function(){var n=e.imageURL,i="".concat(BeFunky.Params.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(e.imageURL));BFN.RequestUtils.getBlobWithFallback(n,i,function(n){var i=n.error,r=n.blob;return i?"pixabay"===BFN.getImageType(e.id)?(BeFunky.logError("Failed to load expired Pixabay full-size image. Trying again..."),void BFN.ImageLibraryService.getPixabayImageById(e.id.replace("pixabay_","")).then(function(n){e.imageURL=n.imageURL,e.thumbURL=n.thumbURL,requestIdleCallback(function(){return BFN.ImageLibraryManager.updateImageStore()});var i=e.imageURL,r="".concat(BeFunky.Params.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(e.imageURL));BFN.RequestUtils.getBlobWithFallback(i,r,function(e){var n=e.error,i=e.blob;if(n)return t({error:n});t({blob:i})})},function(e){return BeFunky.reportWarning("Unable to get updated Pixabay image",e),t({error:e})})):t({error:i}):e.isPattern?BFN.CollageMakerPatternManager.doubleBlobDimensions(e,r,t):e.isSVG?BFN.BlobUtils.blobToText(r,function(e){var n=e.error,i=e.text;if(n)return t({error:n});var r=BFN.SVGManager.sanitizeSVG(i);return t(r?{svgString:r}:{error:"Unable to parse SVG"})}):t({blob:r})})};!function(n){if(!e.indexedDBKey)return n({error:"Missing IndexedDBKey"});var i=e.isSVG;i!==e.indexedDBKey.startsWith("svg__")?n({error:"SVG MenuImageVO has invalid IndexedDBKey"}):BFN.IndexedDB.get(e.indexedDBKey).then(function(r){if(r instanceof Blob)return n({blob:r});if("string"==typeof r){if(i)return t({svgString:r});try{var a=BFN.BlobUtils.base64ToBlob(r);return BeFunky.logError("Converted stored base64 -> blob for MenuImageVO ".concat(e)),n({blob:a})}catch(e){return n({error:"Unable to convert string to blob: ".concat(e)})}}return n({error:"Unable to get valid blob/base64/SVG from IndexedDB key ".concat(e.indexedDBKey)})}).catch(function(e){return n({error:e})})}(function(i){var r=i.error,a=i.blob;return a?t({blob:a}):e.imageURL?void n():t({error:r})})}},{key:"getTexturesForMenuImageVOs",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).saveAssetsSectionID;BeFunky.showLoadScreen();var i=deferredPromise(),r=[],a=0,o=e.length,s=function(){++a===o&&(BeFunky.hideLoadScreen(),n?Promise.all(r).catch(BeFunky.logError).then(function(){i.resolve(e)}):i.resolve(e))};return e.forEach(function(e){if(e.hasUsableTexture())return s();t.getImageBlobOrSVG(e,function(t){var i=t.error,a=t.blob,o=t.svgString;if(i)return BeFunky.throwError("Unable to get blob or SVG string for ".concat(BFN.getImageType(e.id)," MenuImageVO"),e,i),s();var l=a?"image":"svg",u=a||o;if(n){var c=BFN.ProjectService.localAssetExists(l,e.id);r.push(c),c.then(function(t){t||BFN.ProjectService.setLocalAsset(n,l,e.id,u)})}return e.hasUsableTexture()?s():"image"===l?BFN.TextureUtils.blobOrBase64ToTexture(a,function(t){var n=t.error,i=t.texture;return n?(BeFunky.logError("Unable to generate texture for MenuImageVO image",n),s()):(e.imageTexture=i,s())}):void BFN.TextureUtils.svgStringToTexture(o,function(t){var n=t.error,i=t.texture;return n?(BeFunky.logError("Unable to generate texture for MenuImageVO SVG",n),s()):(e.imageTexture=i,s())})})}),i}},{key:"storeBlobForMenuImageVO",value:function(){var e=n(function*(e,t){var n=e.isSVG?"svg":"image";if(!(yield BFN.ProjectService.localAssetExists(n,e.id)))return new Promise(function(i,r){BFN.BfnService.getImageBlobOrSVG(e,function(a){var o=a.error,s=a.blob,l=a.svgString;if(o)return BeFunky.logError("Unable to get ".concat("svg"===n?"SVG string":"blob"," from MenuImageVO ").concat(e.id),o),r(o);BFN.ProjectService.setLocalAsset(t,n,e.id,s||l).then(function(){return i()},function(t){BeFunky.logError("Unable to store ".concat("svg"===n?"SVG string":"blob"," from MenuImageVO ").concat(e.id," in IndexedDB"),t),r(t)})})})});return function(t,n){return e.apply(this,arguments)}}()},{key:"userLoggedIn",get:function(){return BeFunky.isLoggedIn()}},{key:"userIsPlus",get:function(){return Boolean(BeFunky.isPlus()||BeFunky.isPaywallEnabled()||BeFunky.isInDemoMode())}}]),r}();BFN.SingletonQueue.add(function(){BFN.BfnService=new dt});var mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function pt(e,t){return e(t={exports:{}},t.exports),t.exports}var gt=pt(function(e){var t,n;t=mt,n=function(){var e={strSeed:null,shuffle:function(e,t,n){if("Array"==this.getType(e)&&this.setSeed(t)){for(var i=n?e.slice(0):e,r=i.length,a=this.genMap(r),o=r-1;o>0;o--)i[o]=i.splice(a[r-1-o],1,i[o])[0];return i}return null},unshuffle:function(e,t,n){if("Array"==this.getType(e)&&this.setSeed(t)){for(var i=n?e.slice(0):e,r=i.length,a=this.genMap(r),o=1;o<r;o++)i[o]=i.splice(a[r-1-o],1,i[o])[0];return i}return null},genMap:function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=(this.__seed=(9301*this.__seed+49297)%233280)/233280*e|0;return t},setSeed:function(e){if(!/(number|string)/i.test(this.getType(e)))return!1;if(isNaN(e))e=String(this.strSeed=e).split("").map(function(e){return e.charCodeAt(0)}).join("");return this.__seed=this.seed=Number(e)},getType:function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1]}};return Object.create(e)},e.exports?e.exports=n():t.SeededShuffle=n()}),ft=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.imagesPerPage=50,this.shuffleSeed=Math.random(),this.stockImageCache={},this.stockImagePageCounts={},this.pixabayKey="c29a6650081dcabb5c5d",this.pexelsAPIKey="563492ad6f917000010000014a77ae091e0b4c91a1fe80aafee7f864",this.hasHitPexelsRateLimit=!1}},{key:"deleteBeFunkyPhoto",value:function(e,t){return BFN.BfnService.userLoggedIn?BeFunky.requestAPI("photo/delete-image",{imgIds:e},t).then(function(e){if("success"!==e.data)throw"invalid_response";return e}):Promise.reject("not_logged_in")}},{key:"getStockImages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if([/black leaders?/i,/black power/i].find(function(e){return e.test(n)}))return i({error:"no_relevant_results"});var r={pixabay:this.getPixabayImages.bind(this),pexels:this.getPexelsImages.bind(this)},a=Object.keys(r),o=[];function s(e){if(o.push(e),!(o.length<a.length)){var t=o.map(function(e){return e.error}).filter(Boolean);if(t.length===a.length){var n="no_results";return t.every(function(e){return"no_results"!==e})&&(n=t[0]),i({error:n})}var r=[],s=0;o.filter(function(e){return!e.error}).forEach(function(e){var t=e.data,n=e.totalPages;r=r.concat(t),s=Math.max(s,n)}),i({data:l(r),totalPages:s})}}function l(e){return e.sort(function(e,t){return e.imageURL>t.imageURL}),gt.shuffle(e,this.shuffleSeed),e}s=s.bind(this),l=l.bind(this),this.stockImagePageCounts[n]=this.stockImagePageCounts[n]||{},a.forEach(function(i){var a=e.stockImagePageCounts[n];a.hasOwnProperty(i)&&a[i]<t?s({error:"no_results"}):r[i]({page:t,imagesPerPage:25,keywords:n},function(e){e.hasOwnProperty("totalPages")?a[i]=e.totalPages:e.error&&"no_results"===e.error&&(a[i]=0),s(e)})})}},{key:"getPixabayImages",value:function(e,t){var n=this,i=e.page,r=void 0===i?1:i,a=e.imagesPerPage,o=e.keywords;"featured"===o&&(o="urban");var s="https://pixabay.com/api/?".concat(["username=BeFunky","key=".concat(this.pixabayKey),"response_group=high_resolution","image_type=photo","per_page=".concat(a),"page=".concat(r),"q=".concat(o)].join("&")),l="".concat(BeFunky.Params.uplUri,"/pixabay.php?q=").concat(encodeURIComponent(s));if(this.stockImageCache.hasOwnProperty(l))return t(this.stockImageCache[l]);BeFunky.request(l,{},function(e){var i=e.response,r=e.error;if(r)return t({error:r});if(!i||!Array.isArray(i.hits)||"number"!=typeof i.totalHits)return t({error:"invalid_response"});if(!i.hits.length)return t({error:"no_results"});var o={data:i.hits.map(n.createPixabayMenuImageVO.bind(n)),totalImages:i.totalHits,totalPages:Math.ceil(i.totalHits/a)};return n.stockImageCache[l]=o,t(o)})}},{key:"createPixabayMenuImageVO",value:function(e){var t=new BFN.MenuImageVO;t.createId("pixabay",e.id_hash);var n=e.imageWidth/e.imageHeight;t.imageURL=a(e.fullHDURL?e.fullHDURL:e.largeImageURL);var i=e.fullHDURL?1920:1280;t.imageWidth=n>=1?i:Math.floor(i*n),t.imageHeight=n<=1?i:Math.floor(i/n);var r=BFN.getExtension(t.imageURL.split("?")[0]);t.isTransparent="png"===r;return t.thumbURL=a(e.webformatURL.replace("_640","_".concat(180))),t.thumbWidth=Math.floor(180*n),t.thumbHeight=180,t.getImageURL=function(t){return function(e,t){var i=t/n*(BeFunky.isRetina()?1.5:1),r=[150,180,240,340,480,640].find(function(e){return e>i})||640;return e.replace("_640","_".concat(r))}(e.webformatURL,t)},t.author=e.user,t.authorURL="https://pixabay.com/en/users/".concat(e.user,"-").concat(e.user_id,"/"),t;function a(e){return e.startsWith("http://")&&(e=e.replace("http://","https://")),"".concat(e,"?permalink=befunky")}}},{key:"getPixabayImageById",value:function(e){var t=this;return new Promise(function(n,i){var r="https://pixabay.com/api/?".concat(["username=BeFunky","key=".concat(t.pixabayKey),"id=".concat(e)].join("&")),a="".concat(BeFunky.Params.uplUri,"/pixabay.php?q=").concat(encodeURIComponent(r));BeFunky.request(a,{},function(e){var r=e.response,a=e.error;if(a)return i(a);if(!r||!Array.isArray(r.hits)||"number"!=typeof r.totalHits)return i("invalid_response");if(!r.hits.length)return i("no_results");var o=t.createPixabayMenuImageVO(r.hits[0]);n(o)})})}},{key:"getPexelsImages",value:function(e,t){var n=this,i=e.page,r=void 0===i?1:i,a=e.imagesPerPage,o=e.keywords;"featured"===o&&(o="outdoors");var s=BeFunky.addParamsToURL("https://api.pexels.com/v1/search",{page:r,per_page:a,query:o}),l={headers:{Authorization:this.pexelsAPIKey}};return this.stockImageCache.hasOwnProperty(s)?t(this.stockImageCache[s]):this.hasHitPexelsRateLimit?t({error:"no_results"}):void BeFunky.request(s,l,function(e){var i=e.response,r=e.error;if(r)return"string"!=typeof r||"rate limit exceeded"!==r.toLowerCase()&&"quota exceeded"!==r.toLowerCase()||(n.hasHitPexelsRateLimit=!0),t({error:r});if(!i||!Array.isArray(i.photos))return t({error:"invalid_response"});if("number"!=typeof i.total_results)return t({error:"invalid_response"});if(!i.photos.length)return t({error:"no_results"});var o={data:i.photos.map(function(e){var t=new BFN.MenuImageVO;t.createId("pexels",e.id),t.imageURL=e.src.original;var n=e.width/e.height;return t.thumbURL=e.src.medium,t.thumbWidth=Math.round(350*n),t.thumbHeight=350,t.author=e.photographer,t.authorURL=e.photographer_url,t}),totalImages:i.total_results,totalPages:Math.ceil(i.total_results/a)};return n.stockImageCache[s]=o,t(o)})}}]),e}();BFN.SingletonQueue.add(function(){BFN.ImageLibraryService=new ft});var vt=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){this.fetchingTagsPromise=null,this.fetchingEditorsChoicePromise=null}},{key:"getTags",value:function(){var e=this;return this.fetchingTagsPromise?this.fetchingTagsPromise:(this.fetchingTagsPromise=BeFunky.requestAPI("get/photo/all-graphic-tags").then(function(t){var n=t.data;if(!Array.isArray(n.items))throw"invalid_response";return n.items.includes("all_items")||n.items.push("all_items"),e.tags=n.items,n.items}).catch(function(t){return e.fetchingTagsPromise=null,Promise.reject(t)}),this.fetchingTagsPromise)}},{key:"getGraphics",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];0===(e=e.toLowerCase().trim().replace(/\s+/g,"_")).length&&(e="all_items");var o={t:e,isq:this.tags.includes(e)?1:0,v:n,start:100*(i-1),end:r};!0===a&&(o.rev_0=1);var s=BeFunky.requestAPI("photo/search-graphics",o),l=s.then(function(e){var n=e.data.items;if(!Array.isArray(n))throw"invalid_response";if(!n.length)throw"no_results";var i=t.graphicDataToMenuImageVO(n).filter(function(e,t,n){return n.findIndex(function(t){return t.id===e.id})===t});return i.length!==n.length&&BeFunky.logError("Ignoring ".concat(n.length-i.length," duplicate graphics")),i.sort(function(e,t){return(e.isPlus?1:0)-(t.isPlus?1:0)}),i});return l.request=s.request,l}},{key:"getEditorsChoiceGraphics",value:function(){var t=this;return this.fetchingEditorsChoicePromise?this.fetchingEditorsChoicePromise:(this.fetchingEditorsChoicePromise=BeFunky.requestAPI("get/photo/editors-choice-graphics").then(function(t){var n=t.data;if("object"!==e(n))throw"invalid_response";return n}).catch(function(e){return"request_failed"!==e&&BeFunky.throwError("Invalid data received from graphics editors choice JSON",e),t.fetchingEditorsChoicePromise=null,Promise.reject(e)}),this.fetchingEditorsChoicePromise)}},{key:"graphicDataToMenuImageVO",value:function(e){var t=BeFunky.isRetina();return e.map(function(e){var n=e.f,i=e.g,r=e.t,a=e.rev,o=e.v,s=1!==parseInt(n),l=i.split(".")[0],u="svg"===BFN.getExtension(i),c=new BFN.MenuImageVO;c.createId("graphic",l);var h="".concat(BFN.goodiesUrl+BFN.goodiesAssetsFolder.original).concat(i);c.isTransparent=!0,c.isSVG=u,c.indexedDBKey=u?"svg__".concat(c.id):"image__".concat(c.id),c.isPlus=s,c.trackingID="".concat(r,"_").concat(l),c.style=o,c.isReviewed=1===a,c.isGraphic=!0;var d=t?200:130;return u?(c.thumbURL=h,c.imageURL=h):(c.thumbURL="".concat(h,"?w=").concat(d,"&h=").concat(d,"&fit=bounds"),c.imageURL="".concat(h,"?io=off")),c})}}]),t}();BFN.SingletonQueue.add(function(){BFN.GraphicLibraryService=new vt});var yt=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var t=this;this.localAssetIDs=null,this.localAssetSections=["editor","collage","designer","imagemanager","graphicmanager"],this.localAssetTypes=["image","svg"],this.getLocalAssetIDs=new Promise(function(n){BFN.IndexedDB.get("options__localAssetIDs").then(function(n){if(!n||"object"!==e(n))throw"";t.localAssetIDs=n}).catch(function(){t.localAssetIDs={}}).then(n)}),this.getLocalAssetIDs.then(function(){BFN.IndexedDB.keys().then(function(e){e.filter(function(e){return!!t.localAssetTypes.find(function(t){return e.startsWith("".concat(t,"__"))})}).filter(function(e){return!Array.isArray(t.localAssetIDs[e])}).forEach(function(e){BFN.IndexedDB.delete(e)})}).catch(BeFunky.logError)}),this.persistLocalAssetIDs=BeFunky.debounce(this.persistLocalAssetIDs.bind(this),100)}},{key:"getLocalAsset",value:function(e,t){return this.localAssetTypes.includes(e)?"string"==typeof t&&t.includes("_")?new Promise(function(n,i){var r="".concat(e,"__").concat(t);BFN.IndexedDB.get(r).then(function(e){if(!e)throw"Local asset ".concat(r," could not be found in IndexedDB");n(e)}).catch(i)}):Promise.reject("Invalid key"):Promise.reject("Invalid type")}},{key:"localAssetExists",value:function(e,t){var n=this;return this.getLocalAssetIDs.then(function(){return!!Array.isArray(n.localAssetIDs["".concat(e,"__").concat(t)])&&n.getLocalAsset(e,t).then(function(){return!0}).catch(function(){return!1})})}},{key:"setLocalAsset",value:function(e,t,n,i){var r=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.getLocalAssetIDs.then(function(){if(!r.localAssetSections.includes(e))throw"Invalid sectionID";if(!r.localAssetTypes.includes(t))throw"Invalid type";if("string"!=typeof n||!n.includes("_"))throw"Invalid key";if(!(a||"string"==typeof i||i instanceof Blob))throw"Invalid value: ".concat(BeFunky.getType(i));var o="".concat(t,"__").concat(n),s=r.localAssetIDs[o];if(Array.isArray(s)?s.includes(e)||(s.push(e),r.persistLocalAssetIDs()):(r.localAssetIDs[o]=[e],r.persistLocalAssetIDs()),!a)return BFN.IndexedDB.set(o,i)})}},{key:"removeLocalAsset",value:function(e,t,n){var i=this;return this.getLocalAssetIDs.then(function(){if(!i.localAssetSections.includes(e))throw"Invalid sectionID";if(!i.localAssetTypes.includes(t))throw"Invalid type";if("string"!=typeof n||!n.includes("_"))throw"Invalid key";var r="".concat(t,"__").concat(n),a=i.localAssetIDs[r];Array.isArray(a)&&a.includes(e)&&(a.splice(a.indexOf(e),1),a.length||(delete i.localAssetIDs[r],BFN.IndexedDB.delete(r)),i.persistLocalAssetIDs())})}},{key:"clearLocalAssets",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.getLocalAssetIDs.then(function(){if(!t.localAssetSections.includes(e)&&"all"!==e)return Promise.reject("Invalid sectionID");Object.keys(t.localAssetIDs).filter(function(e){return!n.includes(e)}).forEach(function(n){var i=t.localAssetIDs[n],r=i.indexOf(e);-1!==r?i.splice(r,1):"all"===e&&i.splice(0),i.length||(delete t.localAssetIDs[n],BFN.IndexedDB.delete(n))}),t.persistLocalAssetIDs()})}},{key:"persistLocalAssetIDs",value:function(){BFN.IndexedDB.set("options__localAssetIDs",this.localAssetIDs)}},{key:"getLocalProject",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.logLevel,r=void 0===i?"console":i,a=n.showLoadScreen,o=void 0!==a&&a,s=n.excludeAssets,l=void 0!==s&&s,u=n.excludeThumbnail,c=void 0!==u&&u,h=n.fallbackToCanvas,d=void 0===h||h;return new Promise(function(n,i){if(!["editor","collage","designer"].includes(e))return i("Invalid sectionID");var a=!1;o&&BeFunky.showLoadScreen({onCancel:function(){a=!0,BeFunky.logError("User cancelled ".concat(e," project load")),i("Cancelled by user")}});var s=BFN.IndexedDB.get("project__".concat(e)),u="editor"===e?t.getLocalAsset("image","editor_canvas_image").then(function(e){if(e instanceof Blob&&!a){var t=e;return new Promise(function(e){BFN.BlobUtils.blobToArrayBuffer(t,function(n){var i=n.error;e(i?"invalid_editor_image_blob":t)})})}return e}).catch(function(){}):Promise.resolve(),h=c?Promise.resolve(null):t.getLocalAsset("image","".concat(e,"_thumb")).catch(function(){return null});Promise.all([s,h,u]).then(function(t){var i=f(t,3),s=i[0],u=i[1],h=i[2];if(!a){if(!s)throw"No saved project exists";if("editor"===e&&"invalid_editor_image_blob"===h)throw"invalid_editor_image_blob";if("editor"===e&&(s.editorImageBase64=s.editorImageBase64||h),"editor"===e&&!s.editorImageBase64)throw"missing_editor_image_blob";if(!BFN.ProjectManager.validateProject(s,{logLevel:r}))throw"Saved ".concat(e," project is invalid");if(c?s.thumbBase64=null:(s.thumbBase64=s.thumbBase64||u,s.thumbBase64||s._wasReset||BeFunky.logError("".concat(e," project thumbnail was not found in IndexedDB"))),l)return o&&BeFunky.hideLoadScreen(),n(s);BFN.ProjectService.addImagesToProject(s,{showLoadScreen:o,fallbackToCanvas:d}).then(n)}}).catch(function(e){o&&BeFunky.hideLoadScreen(),i(e)})})}},{key:"getAutosavedProjectThumbnail",value:function(e){return["editor","collage","designer"].includes(e)?this.getLocalAsset("image","".concat(e,"_thumb")).then(function(e){if(!t(e))throw"no_thumbnail";return e}).catch(function(){return BFN.IndexedDB.get("project__".concat(e)).then(function(e){if(!e)throw"no_autosave";if(!t(e.thumbBase64))throw"no_thumbnail";return e.thumbBase64})}):Promise.reject("Invalid sectionID");function t(e){return e instanceof Blob||"string"==typeof e&&e.startsWith("data:image")}}},{key:"addImagesToProject",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.showLoadScreen,r=void 0!==i&&i,a=n.fallbackToCanvas,o=void 0===a||a;return new Promise(function(n){var i=!1;r&&BeFunky.showLoadScreen({message:"loading_project_assets",onCancel:function(){i=!0,BeFunky.logError("User cancelled ".concat(e.section," project asset loading")),n(e)}});var a=0,s=0,l=e.imageDataKeys,u=e.svgDataKeys;e.imageDataKeys=[],e.svgDataKeys=[];var c=l.map(function(n){return BFN.ProjectService.getLocalAsset("image",n).catch(function(r){if(a++,BeFunky.logError("Unable to fetch project image blob ".concat(n," from IndexedDB:"),r),!i&&o)return t.getAssetBlobFromTextureOnCanvas(e.section,n).then(function(e){return s++,console.log("Extracted project image blob ".concat(n," from canvas")),e},function(e){BeFunky.logError("Unable to extract project image blob ".concat(n," from canvas:"),e)})}).then(function(t){i||t&&(e.imageData[n]=t)})}),h=u.map(function(t){return BFN.ProjectService.getLocalAsset("svg",t).then(function(n){i||(e.svgData[t]=n)}).catch(function(e){a++,BeFunky.logError("Unable to fetch project svg string ".concat(t," from IndexedDB:"),e)})});Promise.all([].concat(v(c),v(h))).then(function(){if(a)if(a===s)BeFunky.throwError("Recovered one or more project images from canvas",{errorCount:a,recoveredCount:s});else{var t=BFN.IndexedDB.disabledReason?"memory":"IndexedDB";BeFunky.throwError("Unable to fetch one or more project images from ".concat(t).concat(o?" w/ canvas fallback":""),{errorCount:a,recoveredCount:s})}!i&&r&&BeFunky.hideLoadScreen(),n(e)})})}},{key:"saveLocalProject",value:function(e,t){return["editor","collage","designer"].includes(e)?BFN.IndexedDB.set("project__".concat(e),t):Promise.reject("Invalid sectionID")}},{key:"removeLocalProject",value:function(e){return["editor","collage","designer"].includes(e)?BFN.IndexedDB.delete("project__".concat(e)):Promise.reject("Invalid sectionID")}},{key:"getAssetBlobFromTextureOnCanvas",value:function(e,t){var n={editor:BFN.PhotoEditorCanvas,collage:BFN.CollageMakerCanvas,designer:BFN.DesignerCanvas}[e].transformLayer.children,i="collage"===e?BFN.CollageMakerCanvasPhotoGrid.photoGrid.gridChildren:[],r=n.filter(function(e){return e instanceof BFN.TransformItem}).find(function(e){return"frame_texture"===e.type&&e.projectItemVO.maskImageID===t||"texture"===e.type&&e.projectItemVO.imageID===t}),a=i.find(function(e){return e.projectItemVO.gridCellImageID===t});if(!r&&!a)return Promise.reject("No matching Transform Item or Grid Cell");var o=r?r.itemContent.texture:a.childContent.image.texture,s=(o||{}).baseTexture;if(!s)return Promise.reject("No baseTexture in ".concat(r?"Transform Item":"Grid Cell"));var l=new PIXI.Texture(s),u=o.determineTransparency(),c=BeFunky.isFirefox||u?.99:1;return console.log("Got texture for asset",t,"".concat(s.width," x ").concat(s.height),{isTransparent:u}),setTimeout(function(){l.destroyGC(!1)},0),BFN.TextureUtils.textureToBlobWithErrorHandling(l,{isTransparent:u,quality:c})}}]),t}();BFN.SingletonQueue.add(function(){BFN.ProjectService=new yt});var xt=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){this.fetchingTextPatchesPromise=null}},{key:"getTextPatches",value:function(){var e=this;return this.fetchingTextPatchesPromise?this.fetchingTextPatchesPromise:(this.fetchingTextPatchesPromise=BeFunky.requestAPI("get/photo/text-patches").then(function(e){var t=e.data;if(!Array.isArray(t.items))throw"invalid_response";return t.items}).catch(function(t){return e.fetchingTextPatchesPromise=null,Promise.reject(t)}),this.fetchingTextPatchesPromise)}},{key:"fetchBfp",value:function(t){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).showLoadScreen,i=void 0===n||n;return new Promise(function(n,r){console.log("Downloading BFP",t);var a,o=function(e){i&&BeFunky.hideLoadScreen(),r(e)},s=!1,l=!1;setTimeout(function(){s||(l=!0)},200),i&&BeFunky.showLoadScreen({onCancel:function(){o("cancelled_by_user"),s=!0,a.abort()},message:"downloading"});var u={responseType:"json",downloadProgressHandler:function(e,t){l&&i&&BeFunky.updateLoadScreenProgress("downloading",100*e/t)}};a=BeFunky.request(t,u,function(t){var r,a=t.response,l=t.error;if(!s)return l?o(l):void("object"===e(a)&&a.id&&a.width&&a.height?(r=a,i&&BeFunky.hideLoadScreen(),n(r)):o("invalid_bfp"))})})}}]),t}();BFN.SingletonQueue.add(function(){BFN.PatchService=new xt});var _t=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){}},{key:"resetProjectData",value:function(){BeFunky.SavedProjectFetcher.resetProjectData()}},{key:"getFirst100Projects",value:function(){return BeFunky.SavedProjectFetcher.getFirst100Projects()}},{key:"getAllProjects",value:function(){return BeFunky.SavedProjectFetcher.getAllProjects()}},{key:"searchProjects",value:function(e){return BeFunky.SavedProjectFetcher.searchProjects(e)}},{key:"fetchBFD",value:function(t){var n=this,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).showLoadScreen,r=void 0===i||i;return new Promise(function(i,a){console.log("Downloading BFD",t);var o,s=function(e){r&&BeFunky.hideLoadScreen(),a(e)},l=!1,u=!1;setTimeout(function(){l||(u=!0)},200),r&&BeFunky.showLoadScreen({onCancel:function(){s("cancelled_by_user"),l=!0,o.abort()},message:"downloading"});var c={responseType:"blob",downloadProgressHandler:function(e,t){u&&r&&BeFunky.updateLoadScreenProgress("downloading",100*e/t)}};o=BeFunky.request(t,c,function(t){var a=t.response,o=t.error;if(!l)return o?s(o):void n.decodeProjectFile(a,function(t){var n=t.data,a=t.error;if(a)return s(a);BFN.ObjectCompressor.decompress(n).then(function(t){if("object"!==e(t)||!t)throw"invalid_bfd";var n;n=t,r&&BeFunky.hideLoadScreen(),i(n)}).catch(s)})})})}},{key:"decodeProjectFile",value:function(e,t){BFN.BlobUtils.blobToText(e,function(e){var n=e.text,i=e.error;return t(i?{error:i}:{data:n})})}},{key:"saveBfdFileToBeFunky",value:function(e,t){var n=e.bfdBlob,i=e.thumbnailBlob,r=e.uploadProgressHandler,a=e.date,o=e.projectObject;if(!BFN.BfnService.userLoggedIn)return t({error:"not_logged_in"});var s={bucket:"befunkydesigner",content_type:"text/plain",blob:n};window.DirectUPL.upload(function(e){if(!e||!e.url||!e.s3_name)return t({error:"invalid_response"});var r=e.s3_name,s="".concat(r,"_thumb.").concat("image/png"===i.type?"png":"jpg"),l={bucket:"befunkydesigner",content_type:i.type,blob:i,filename:s};window.DirectUPL.upload(function(e){if(!e||!e.url||!e.s3_name)return t({error:"invalid_response"});var i=o.transformLabels.map(function(e){return e.labelText}).map(function(e){return e.replace(/\s+/g," ").trim()}).filter(function(e){return e&&!BFN.FabricManager.isDefaultText(e)}).join(" ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"").slice(0,1e3),l=function(e){return btoa(encodeURIComponent(e))},u={bfdname:r,thumbname:s,filename:l(o.filename),content:l(i),p_type:o.section,source_template:o.sourceTemplateID||"",width:o.projectWidth,height:o.projectHeight,size:Math.round(n.size/1024)};a&&(u.creation_date=a),BeFunky.requestAPI("photo/projects/add",u).then(function(e){if("success"!==e.data)throw"invalid_response";t({data:"success"})}).catch(function(e){t({error:e})})},l)},s);var l=void 0!==window.DirectUPL&&null!==window.DirectUPL?window.DirectUPL.uploadReq:void 0;BeFunky.addProgressHandler(l,r,!0)}},{key:"deleteBfdFile",value:function(e,t){return BeFunky.SavedProjectFetcher.deleteBfdFile(e,t)}}]),t}();BFN.SingletonQueue.add(function(){BFN.SavedProjectService=new _t});var It=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){}},{key:"uploadImage",value:function(e,t){if(!BFN.BfnService.userLoggedIn)return t({error:"not_logged_in"});var n=function(){var n="".concat(BeFunky.Params.uplUri,"/restupload/bfns3uploader.bfn"),i={method:"POST",body:BeFunky.createFormData({image_type:e.type,bucket:"bfnwatermark",image:e,CSRFtoken:getCsToken()})};BeFunky.request(n,i,function(e){var n=e.response,i=e.error;if(i)return t({error:i});n&&n.url&&n.s3_name?t({url:n.url,name:n.s3_name}):t({error:"invalid_response"})})};void 0!==window.DirectUPL?window.DirectUPL.upload(function(e){e&&e.url&&e.s3_name?t({url:e.url,name:e.s3_name}):n()},{bucket:"bfnwatermark",content_type:e.type,blob:e}):n()}},{key:"deleteImage",value:function(e,t){t&&t({success:!0,url:e})}}]),e}();BFN.SingletonQueue.add(function(){BFN.BfnWatermarkService=new It});var Tt=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.tags=[],this.fetchingTagsPromise=null}},{key:"getTags",value:function(){var e=this;return Array.isArray(this.tags)&&this.tags.length?Promise.resolve(this.tags):this.fetchingTagsPromise?this.fetchingTagsPromise:(this.fetchingTagsPromise=BeFunky.requestAPI("get/photo/all-designer-template-tags").then(function(t){var n=t.data;if(!Array.isArray(n.items))throw"invalid_response";return e.tags=n.items,n.items}).catch(function(t){return e.fetchingTagsPromise=null,Promise.reject(t)}),this.fetchingTagsPromise)}},{key:"getTemplates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof e)return Promise.reject("invalid_tag");var a={t:e=e.toLowerCase().trim().replace(/\s+/g,"_"),isq:this.tags.includes(e)?1:0,start:100*(n-1),end:i,all_templates:r?1:0};return BeFunky.requestAPI("photo/search-designer-templates",a).then(function(e){var n=e.data.items;if(!Array.isArray(n))throw"invalid_response";if(!n.length)throw"no_results";return n.map(t.cleanupTemplateObject).filter(function(e){return e.hasValidDimensions})})}},{key:"getTemplate",value:function(e){var t=this;return BeFunky.requestAPI("photo/get-designer-template",{id:e}).then(function(n){var i=n.data;if(!Array.isArray(i.items))throw"invalid_response";if(!i.items.length)throw"no_results";var r=i.items,a=["blank","dim","f","n","rev","tmp"],o=[];r.length>1&&r.slice(1).forEach(function(e){a.forEach(function(t){e[t]!==r[0][t]&&o.push(t)})}),o.length&&BeFunky.throwError("Invalid tag data for template ".concat(e,": Mismatched ").concat(o.unique().join(", ")));var s=t.cleanupTemplateObject(r[0]);return s.tags=r.map(function(e){return e.t}),s})}},{key:"getEditorsChoiceTemplates",value:function(){var e=this;return BeFunky.requestAPI("get/photo/editors-choice-templates").then(function(t){if(!Array.isArray(t.data.tags))throw"invalid_response";var n=t.data.tags;return n.forEach(function(t){t.items=t.items.map(e.cleanupTemplateObject)}),n}).catch(function(e){return BeFunky.throwError("Invalid data received from editors choice JSON",e),[]})}},{key:"cleanupTemplateObject",value:function(e){var t=e.f,n=e.tmp,i=e.n,r=e.dim,a=e.blank,o=e.t,s=e.rev,l=e.version,u=e.creation,c=Boolean(BFN.DesignerTemplateManager.parseDimensions(r));return c||BeFunky.throwError("Designer template has invalid dimensions: ".concat(n," -- ").concat(r)),{id:n,isPlus:1!==parseInt(t),isBlank:parseInt(a)>0,isReviewed:1===parseInt(s),tagID:o,version:l,displayName:i,dimensions:r,hasValidDimensions:c,creationDate:u}}},{key:"templateObjectsToMenuImageVOs",value:function(e){var t=BeFunky.isRetina();return e.map(function(e){var n=e.id,i=e.isPlus,r=e.isBlank,a=e.isReviewed,o=e.tagID,s=e.version,l=e.displayName,u=e.dimensions,c=e.creationDate,h=new BFN.MenuImageVO;return h.createId("designer_template",n),h.isBlank=r,h.isReviewed=a,h.version=s,h.displayName=l,h.dimensions=u,h.projectFileName="".concat(n,".bfd"),h.groupID=c,h.setObject({isPlus:i,trackingID:"".concat(o,"_").concat(n)}),Object.assign(h,BFN.DesignerTemplateManager.getTemplateImages({id:n,isBlank:r,dimensions:u,version:s,isRetina:t})),h})}}]),e}();BFN.SingletonQueue.add(function(){BFN.DesignerTemplateService=new Tt});var bt={CONST:{NOT_SUPPORTED:0,hdConstraints:{video:{width:{exact:1280},height:{exact:720}}},vgaConstraints:{video:{width:{exact:640},height:{exact:360}}},hdMandatory:{video:{width:1280,height:720}}}};BFN.isWebCamSupported=function(){return!!(navigator.getUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)};var St=function(){function e(t,n,r,a){i(this,e),this.supported=!1,this.errCallback=n,this.videoElement=t,this.constraints=a||bt.CONST.hdConstraints,this.isAudio=r||!1,this.localMediStream=null,this.init()}return a(e,[{key:"init",value:function(){var e=this;this.supported=BFN.isWebCamSupported();var t=this.constraints;if(t.audio=this.isAudio,this.supported){!function n(i){navigator.mediaDevices.getUserMedia(t).then(function(t){return e.handleStream(t)}).catch(function(){i?((t=bt.CONST.hdMandatory).audio=!1,n()):e.errCallback("not_available")})}(!0)}}},{key:"handleStream",value:function(e){var t=this;if(this.localMediStream=e,navigator.mozGetUserMedia)try{this.videoElement.mozSrcObject=this.localMediStream,this.videoElement.srcObject=this.localMediStream}catch(e){}else try{this.videoElement.srcObject=this.localMediStream}catch(e){try{var n=URL.createObjectURL(this.localMediStream);this.videoElement.src=n}catch(e){}}this.videoElement.onloadedmetadata=function(){t.start()}}},{key:"getSnapshot",value:function(e){var t=document.createElement("canvas");t.width=this.constraints.video.width.exact,t.height=this.constraints.video.height.exact;var n=t.getContext("2d");n.drawImage(this.videoElement,0,0),t.toBlob(function(i){n=null,t=null,e(i)},"image/webp")}},{key:"stop",value:function(e){try{this.videoElement.pause()}catch(e){}if(!e){try{this.localMediStream.getTracks().forEach(function(e){e.stop()})}catch(e){try{this.localMediStream.getVideoTracks()[0].stop()}catch(e){try{this.localMediStream.stop()}catch(e){}}}try{URL.revokeObjectURL(this.videoElement.src),this.videoElement.src="",this.videoElement.srcObject=null}catch(e){}}}},{key:"start",value:function(){try{this.videoElement.play()}catch(e){}}}]),e}();BFN.WebcamRecorder=St;var Ct=function(){function e(){i(this,e),this.isZlibEnabled=!!window.pako}return a(e,[{key:"isJSONString",value:function(e){if("string"!=typeof e)return!1;try{JSON.parse(e)}catch(e){return!1}return!0}},{key:"compress",value:function(e){return new Promise(function(t){t(JSON.stringify(e))})}},{key:"decompress",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(i,r){if(n&&"string"==typeof e)try{return i(JSON.parse(e))}catch(e){}var a=null,o=null;if(!t.isZlibEnabled)return r("no_zlib");try{a=pako.inflate(e,{gzip:!0,to:"string"}),BeFunky.reportWarning("Pako successfully decompressed gzipped file")}catch(e){o=e}e="incorrect header check"===o?atob(e):n&&!t.isJSONString(a)?atob(a):a,i(n?JSON.parse(e):e)})}}]),e}();BFN.SingletonQueue.add(function(){BFN.ObjectCompressor=new Ct});var Bt=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.inFlightMaskImageURLs=[],this.swappedFonts={}}},{key:"objectToProjectVO",value:function(e){var t=this;return new Promise(function(n,i){"1.0"===e.version?t.prepareV1(e).then(function(e){return BFN.FlashProjectParser.parseFlashProject(e,n)}):t.prepareV2(e).then(function(e){return BFN.ProjectManager.getProjectVO(e)}).catch(i).then(n)})}},{key:"prepareV1",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isSourceTemplate,i=void 0!==n&&n;i?(this.swappedFonts={},console.log("Loading Flash source template")):console.log("Loading BFD v1 saved from Flash");var r=!1;i||UIToggler.toggleLoadScreen(!0,{message:"loading_project_assets",onCancel:function(){r=!0,t.abortPrepare()}});var a=[].concat(v(e.transformLabelStates.map(this.translateLabelState.bind(this))),[this.fetchDesignerElementSvgData(e),this.decodeTemplateElementSvgData(e),this.fetchMaskImages(e)]);return i||a.push(this.fetchSourceTemplate(e)),Promise.all(a).then(function(){if(r)throw"User cancelled BFD asset loading.";return i||UIToggler.toggleLoadScreen(!1),e})}},{key:"prepareV2",value:function(e){var t=this;this.swappedFonts={};var n=!1;UIToggler.toggleLoadScreen(!0,{onCancel:function(){n=!0,t.abortPrepare()}});var i=v(e.transformLabels.map(function(e){var n=e.labelTextStyles,i=e.labelText;return n.compressedStyles&&(n.styles=t.decompressCharacterStyles(n.compressedStyles),delete n.compressedStyles),t.loadAndValidateFonts(n,i).then(function(t){e.labelText=t})}));return Promise.all(i).then(function(){if(n)throw"cancelled_by_user";return UIToggler.toggleLoadScreen(!1),e})}},{key:"abortPrepare",value:function(){UIToggler.toggleLoadScreen(!1),this.inFlightMaskImageURLs.map(function(e){return BeFunky.inFlightRequests[e]}).filter(Boolean).forEach(function(e){return e.abort()})}},{key:"translateLabelState",value:function(e){return this.translateLabelHTML(e).then(function(t){var n=t.labelText,i=t.labelTextStyles;e.labelText=n,e.labelTextStyles=i;["labelHTMLText","labelLetterSpacing","labelTextAlign","labelFontFamily","labelTintColor","labelTintColorEnabled","labelTintMultiplier","labelStrokeAlpha","labelStrokeColor","labelStrokeEnabled","labelBackgroundAlpha","labelBackgroundColor","labelBackgroundEnabled"].forEach(function(t){delete e[t]})})}},{key:"translateLabelHTML",value:function(e){var t=this,n=v((new DOMParser).parseFromString(e.labelHTMLText,"text/html").querySelectorAll("p"));return new Promise(function(a){var o="",s={textAlign:i(n[0]),charSpacing:r(n[0]),lineHeight:BFN.TransformItemTextBaseLineHeight,styles:{}},l={fontFamily:{attributeName:"face",transform:function(e){return e}},fontSize:{attributeName:"size",transform:function(e){return e=parseInt(e)||20}},fill:{attributeName:"color",transform:function(t){if(!e.labelTintColorEnabled)return"#00000000";var n=t&&t.startsWith("#")?t.replace("#",""):BFN.ColorUtil.hexNumberToHexString(e.labelTintColor),i=e.labelTintMultiplier;return BFN.ColorUtil.hexStringObjectToRGBAString({hex:n,alpha:i})}},stroke:{transform:function(){if(!e.labelStrokeEnabled)return"";var t=BFN.ColorUtil.hexNumberToHexString(e.labelStrokeColor),n=e.labelStrokeAlpha;return BFN.ColorUtil.hexStringObjectToRGBAString({hex:t,alpha:n})}},fontWeight:{transform:function(){return""}},textBackgroundColor:{transform:function(){if(!e.labelBackgroundEnabled)return"";var t=BFN.ColorUtil.hexNumberToHexString(e.labelBackgroundColor),n=e.labelBackgroundAlpha;return BFN.ColorUtil.hexStringObjectToRGBAString({hex:t,alpha:n})}}};n.forEach(function(e,t){t>0&&(o+="\n");var n=0,i={};s.styles[t]=i;var r=e.children[0];v(r.childNodes).forEach(function(e){var t,a=1===e.nodeType,s={};Object.keys(l).forEach(function(t){var n,i=l[t],o=i.attributeName,u=i.transform;o&&(n=a&&e.getAttribute(o)||r.getAttribute(o)),s[t]=u(n)}),(t=e.textContent,decodeURIComponent(Array.prototype.map.call(t,function(e){return"%".concat("00".concat(e.charCodeAt(0).toString(16)).slice(-2))}).join(""))).split("").forEach(function(e){o+=e,i[n]=Object.assign({},s),n++})})}),t.loadAndValidateFonts(s,o).then(function(e){a({labelTextStyles:s,labelText:e})})});function i(e){var t;try{t=e.getAttribute("align").toLowerCase()}catch(e){}return["left","center","right"].includes(t)?t:"left"}function r(e){var t;try{t=e.children[0].getAttribute("letterspacing")}catch(e){}if((t=parseInt(t)||0)<=0)t=0;else{t=Math.round(100+t/2.5*100)}return t=Math.min(1e3,t)}}},{key:"fetchDesignerElementSvgData",value:function(e){return new Promise(function(t){var n=e.designerElementStates,i={},r=0,a=0;function o(){r>a||(e.designerElementSvgData=i,t())}Object.keys(n).forEach(function(e){Object.keys(n[e]).forEach(function(e){r++;var t="".concat(BFN.designerElementsUrl+e,".svg");BFN.RequestUtils.getText(t,function(t){var n=t.text,r=t.error;a++,r?(BeFunky.logError(r),i[e]=null):i[e]=n,o()})})}),o()})}},{key:"decodeTemplateElementSvgData",value:function(e){return new Promise(function(t){if(!e.templateElementSvgData)return t();var n=Object.keys(e.templateElementSvgData).map(function(t){return BFN.ObjectCompressor.decompress(e.templateElementSvgData[t],!1).then(function(n){e.templateElementSvgData[t]=n}).catch(BeFunky.logError)});Promise.all(n).then(t)})}},{key:"fetchMaskImages",value:function(e){var t=this;return new Promise(function(n){if(!e.transformMaskImageStates)return n();var i={};e.transformMaskImageStates.forEach(function(e){var n;(e.maskImageBase64=e.maskImageBase64||null,!e.maskImageBase64&&e.maskImageURL)&&(n=e.maskImageURL,i[n]||(i[n]=new Promise(function(e,i){var r="".concat(BeFunky.Params.uplUri,"/loadImage.php?c=").concat(encodeURIComponent(n));t.inFlightMaskImageURLs.push(n,r),BFN.RequestUtils.getBase64WithFallback(n,r,function(a){var o=a.error,s=a.base64;o&&i(o),e(s),[n,r].forEach(function(e){var n=t.inFlightMaskImageURLs.indexOf(e);-1!==n&&t.inFlightMaskImageURLs.splice(n,1)})})})),i[n]).then(function(t){e.maskImageBase64=t}).catch(function(e){BeFunky.logError("Unable to load mask image base64:",e)})}),Promise.all(Object.values(i).map(function(e){return e.catch(function(){})})).then(n)})}},{key:"fetchSourceTemplate",value:function(e){var t=this;return new Promise(function(n){if(!e.sourceTemplateID)return n();var i="".concat(BFN.designerTemplateFlashURL).concat(e.sourceTemplateID,".bfd"),r=function(t){BeFunky.logError(t),e.sourceTemplate=null,n()};BFN.SavedProjectService.fetchBFD(i,{showLoadScreen:!1}).then(function(i){t.prepareV1(i,{isSourceTemplate:!0}).then(function(t){e.sourceTemplate=t,n()}).catch(function(e){r("Unable to prepare source template: ".concat(e))})},function(e){return r("Unable to fetch source template: ".concat(e))})})}},{key:"loadAndValidateFonts",value:function(e,t){var n=this,i=e.styles,r=e.charSpacing,a=e.lineHeight,o=[],s={},l=BFN.FontManager.defaultFontFamily,u=t.split("\n").map(function(e){return"".concat(e,"\n")}),c=[];return new Promise(function(h){var d=l;if(n.forEachCharacterStyle(i,function(i,h,m){var p=parseInt(h),g=parseInt(m),f=u[p]?u[p][g]:void 0;f&&"\n"!==f||(c.push({character:f,font:i.fontFamily}),i.fontFamily=void 0);var v,y,x,_,I=d;i.fontFamily&&(I=function(e){var t=BFN.FontManager.findSimilarFont(e);if(t)return BFN.FontManager.isLoaded(t)||(s[t]=BFN.FontManager.load(t)),t;if(!o.includes(e)){if(BFN.FontManager.addUserDefinedSystemFont(e))return e;BeFunky.logError('Unable to find custom font needed by BFD: "'.concat(e,'"')),o.push(e)}var n=C[e];if(n){var i=n.name;return BFN.FontManager.isLoaded(i)||(s[i]=BFN.FontManager.load(i)),this.swappedFonts[e]=i,n}return this.swappedFonts[e]?this.swappedFonts[e]:(this.swappedFonts[e]=l,l)}.call(n,i.fontFamily)),d=I,"string"==typeof I?v=M(I):(v=M(I.name),I.isBold&&(i.fontWeight="bold"),I.isAllCaps&&t[g]&&(y=t,x=g,_=t[g].toUpperCase(),t=y.substr(0,x)+_+y.substr(x+_.length)),I.sizeScale&&(i.fontSize=(i.fontSize*I.sizeScale).toFixed(1)),I.charSpacingIncrement&&(e.charSpacing=r+I.charSpacingIncrement),I.lineHeightScale&&(e.lineHeight=(a*I.lineHeightScale).toFixed(2)),i.fontFamily&&(n.swappedFonts[i.fontFamily]=I.name)),i.fontFamily=v}),!c.every(function(e){return"\n"===e.character})){var m=c.reduce(function(e,t){var n=t.font;return[].concat(v(e),[n]).unique()},[]),p=t.replace(/\n/g," ");p.length>20&&(p="".concat(p.slice(0,20),"...")),BeFunky.logError("Ignored font of ".concat(c.length,' character styles in label "').concat(p,'" Fonts = ').concat(m.join(", ")))}var g=Object.keys(s),f=0;if(!g.length)return y();function y(){++f<g.length||h(t)}g.forEach(function(e){s[e].catch(function(t){BeFunky.logError(t);var r=M(e);BFN.ParseBFD.forEachCharacterStyle(i,function(t){if(t.fontFamily===r){var i=n.swappedFonts[e]||l;t.fontFamily=M(i),n.swappedFonts[e]=i}})}).then(y)})})}},{key:"forEachCharacterStyle",value:function(e,t){Object.keys(e).forEach(function(n){var i=e[n];Object.keys(i).forEach(function(e){t(i[e],n,e)})})}},{key:"decompressCharacterStyles",value:function(e){return e.reduce(function(e,t){var n=t.indexes,i=t.styles;return n.forEach(function(t){var n=f(t.split(","),2),r=n[0],a=n[1];e[r]||(e[r]={}),e[r][a]=i}),e},{})}},{key:"compressCharacterStyles",value:function(e){var t=[];return this.forEachCharacterStyle(e,function(e,n,i){var r="".concat(n,",").concat(i),a=JSON.stringify(e),o=t.find(function(e){return e.stylesString===a});o?o.indexes.push(r):t.push({indexes:[r],stylesString:a,styles:e})}),t.map(function(e){return delete e.stylesString,e})}}]),e}();BFN.SingletonQueue.add(function(){BFN.ParseBFD=new Bt});var Ft,Et=pt(function(e,t){!function(){var n={};function i(e){return h(">"+m("B",e.length),e)}function r(e){return h(">"+m("H",e.length),e)}function a(e){return h(">"+m("L",e.length),e)}function o(e,t,n){var o,s,l,u,c="",d="";if("Byte"==t)(o=e.length)<=4?d=i(e)+m("\0",4-o):(d=h(">L",[n]),c=i(e));else if("Short"==t)(o=e.length)<=2?d=r(e)+m("\0\0",2-o):(d=h(">L",[n]),c=r(e));else if("Long"==t)(o=e.length)<=1?d=a(e):(d=h(">L",[n]),c=a(e));else if("Ascii"==t)(o=(s=e+"\0").length)>4?(d=h(">L",[n]),c=s):d=s+m("\0",4-o);else if("Rational"==t){if("number"==typeof e[0])o=1,l=e[0],u=e[1],s=h(">L",[l])+h(">L",[u]);else{o=e.length,s="";for(var p=0;p<o;p++)l=e[p][0],u=e[p][1],s+=h(">L",[l])+h(">L",[u])}d=h(">L",[n]),c=s}else if("SRational"==t){if("number"==typeof e[0])o=1,l=e[0],u=e[1],s=h(">l",[l])+h(">l",[u]);else{o=e.length,s="";for(p=0;p<o;p++)l=e[p][0],u=e[p][1],s+=h(">l",[l])+h(">l",[u])}d=h(">L",[n]),c=s}else"Undefined"==t&&((o=e.length)>4?(d=h(">L",[n]),c=e):d=e+m("\0",4-o));return[h(">L",[o]),d,c]}function s(e,t,n){var i,r=Object.keys(e).length,a=h(">H",[r]);i=["0th","1st"].indexOf(t)>-1?2+12*r+4:2+12*r;var s="",l="";for(var u in e)if("string"==typeof u&&(u=parseInt(u)),!("0th"==t&&[34665,34853].indexOf(u)>-1||"Exif"==t&&40965==u||"1st"==t&&[513,514].indexOf(u)>-1)){var c=e[u],d=h(">H",[u]),m=f[t][u].type,p=h(">H",[g[m]]);"number"==typeof c&&(c=[c]);var v=o(c,m,8+i+n+l.length);s+=d+p+v[0]+v[1],l+=v[2]}return[a+s,l]}function l(e){var t;if("ÿØ"==e.slice(0,2))t=function(e){for(var t,n=0;n<e.length;n++)if("ÿá"==(t=e[n]).slice(0,2)&&"Exif\0\0"==t.slice(4,10))return t;return null}(p(e)),this.tiftag=t?t.slice(10):null;else if(["II","MM"].indexOf(e.slice(0,2))>-1)this.tiftag=e;else{if("Exif"!=e.slice(0,4))throw new Error("Given file is neither JPEG nor TIFF.");this.tiftag=e.slice(6)}}if(n.version="1.0.4",n.remove=function(e){var t=!1;if("ÿØ"==e.slice(0,2));else{if("data:image/jpeg;base64,"!=e.slice(0,23)&&"data:image/jpg;base64,"!=e.slice(0,22))throw new Error("Given data is not jpeg.");e=c(e.split(",")[1]),t=!0}var n=p(e).filter(function(e){return!("ÿá"==e.slice(0,2)&&"Exif\0\0"==e.slice(4,10))}).join("");return t&&(n="data:image/jpeg;base64,"+u(n)),n},n.insert=function(e,t){var n=!1;if("Exif\0\0"!=e.slice(0,6))throw new Error("Given data is not exif.");if("ÿØ"==t.slice(0,2));else{if("data:image/jpeg;base64,"!=t.slice(0,23)&&"data:image/jpg;base64,"!=t.slice(0,22))throw new Error("Given data is not jpeg.");t=c(t.split(",")[1]),n=!0}var i="ÿá"+h(">H",[e.length+2])+e,r=function(e,t){var n=!1,i=[];e.forEach(function(r,a){"ÿá"==r.slice(0,2)&&"Exif\0\0"==r.slice(4,10)&&(n?i.unshift(a):(e[a]=t,n=!0))}),i.forEach(function(t){e.splice(t,1)}),!n&&t&&(e=[e[0],t].concat(e.slice(1)));return e.join("")}(p(t),i);return n&&(r="data:image/jpeg;base64,"+u(r)),r},n.load=function(e){var t;if("string"!=typeof e)throw new Error("'load' gots invalid type argument.");if("ÿØ"==e.slice(0,2))t=e;else if("data:image/jpeg;base64,"==e.slice(0,23)||"data:image/jpg;base64,"==e.slice(0,22))t=c(e.split(",")[1]);else{if("Exif"!=e.slice(0,4))throw new Error("'load' gots invalid file data.");t=e.slice(6)}var n={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},i=new l(t);if(null===i.tiftag)return n;"II"==i.tiftag.slice(0,2)?i.endian_mark="<":i.endian_mark=">";var r=d(i.endian_mark+"L",i.tiftag.slice(4,8))[0];n["0th"]=i.get_ifd(r,"0th");var a=n["0th"].first_ifd_pointer;if(delete n["0th"].first_ifd_pointer,34665 in n["0th"]&&(r=n["0th"][34665],n.Exif=i.get_ifd(r,"Exif")),34853 in n["0th"]&&(r=n["0th"][34853],n.GPS=i.get_ifd(r,"GPS")),40965 in n.Exif&&(r=n.Exif[40965],n.Interop=i.get_ifd(r,"Interop")),"\0\0\0\0"!=a&&(r=d(i.endian_mark+"L",a)[0],n["1st"]=i.get_ifd(r,"1st"),513 in n["1st"]&&514 in n["1st"])){var o=n["1st"][513]+n["1st"][514],s=i.tiftag.slice(n["1st"][513],o);n.thumbnail=s}return n},n.dump=function(e){var t,i,r,a,o,l,u=(t=e,JSON.parse(JSON.stringify(t))),c=!1,d=!1,m=!1,f=!1;i="0th"in u?u["0th"]:{},"Exif"in u&&Object.keys(u.Exif).length||"Interop"in u&&Object.keys(u.Interop).length?(i[34665]=1,c=!0,r=u.Exif,"Interop"in u&&Object.keys(u.Interop).length?(r[40965]=1,m=!0,a=u.Interop):Object.keys(r).indexOf(n.ExifIFD.InteroperabilityTag.toString())>-1&&delete r[40965]):Object.keys(i).indexOf(n.ImageIFD.ExifTag.toString())>-1&&delete i[34665],"GPS"in u&&Object.keys(u.GPS).length?(i[n.ImageIFD.GPSTag]=1,d=!0,o=u.GPS):Object.keys(i).indexOf(n.ImageIFD.GPSTag.toString())>-1&&delete i[n.ImageIFD.GPSTag],"1st"in u&&"thumbnail"in u&&null!=u.thumbnail&&(f=!0,u["1st"][513]=1,u["1st"][514]=1,l=u["1st"]);var v,y,x,_=s(i,"0th",0),I=_[0].length+12*c+12*d+4+_[1].length,T="",b=0,S="",C=0,B="",F=0,E="";(c&&(b=(v=s(r,"Exif",I))[0].length+12*m+v[1].length),d&&(C=(S=s(o,"GPS",I+b).join("")).length),m)&&(F=(B=s(a,"Interop",I+b+C).join("")).length);if(f&&(y=s(l,"1st",I+b+C+F),(x=function(e){var t=p(e);for(;"ÿà"<=t[1].slice(0,2)&&t[1].slice(0,2)<="ÿï";)t=[t[0]].concat(t.slice(2));return t.join("")}(u.thumbnail)).length>64e3))throw new Error("Given thumbnail is too large. max 64kB");var P="",k="",N="",M="\0\0\0\0";if(c){var D=h(">L",[w=8+I]);P=h(">H",[34665])+h(">H",[g.Long])+h(">L",[1])+D}if(d){D=h(">L",[w=8+I+b]);k=h(">H",[34853])+h(">H",[g.Long])+h(">L",[1])+D}if(m){D=h(">L",[w=8+I+b+C]);N=h(">H",[40965])+h(">H",[g.Long])+h(">L",[1])+D}if(f){var w;M=h(">L",[w=8+I+b+C+F]);var L="\0\0\0\0"+h(">L",[w+y[0].length+24+4+y[1].length]),O="\0\0\0\0"+h(">L",[x.length]);E=y[0]+L+O+"\0\0\0\0"+y[1]+x}var R=_[0]+P+k+M+_[1];return c&&(T=v[0]+N+v[1]),"Exif\0\0MM\0*\0\0\0\b"+R+T+S+B+E},l.prototype={get_ifd:function(e,t){var n,i={},r=d(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],a=e+2;n=["0th","1st"].indexOf(t)>-1?"Image":t;for(var o=0;o<r;o++){e=a+12*o;var s=d(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],l=[d(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],d(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],this.tiftag.slice(e+8,e+12)];s in f[n]&&(i[s]=this.convert_value(l))}return"0th"==t&&(e=a+12*r,i.first_ifd_pointer=this.tiftag.slice(e,e+4)),i},convert_value:function(e){var t,n=null,i=e[0],r=e[1],a=e[2];if(1==i)r>4?(t=d(this.endian_mark+"L",a)[0],n=d(this.endian_mark+m("B",r),this.tiftag.slice(t,t+r))):n=d(this.endian_mark+m("B",r),a.slice(0,r));else if(2==i)r>4?(t=d(this.endian_mark+"L",a)[0],n=this.tiftag.slice(t,t+r-1)):n=a.slice(0,r-1);else if(3==i)r>2?(t=d(this.endian_mark+"L",a)[0],n=d(this.endian_mark+m("H",r),this.tiftag.slice(t,t+2*r))):n=d(this.endian_mark+m("H",r),a.slice(0,2*r));else if(4==i)r>1?(t=d(this.endian_mark+"L",a)[0],n=d(this.endian_mark+m("L",r),this.tiftag.slice(t,t+4*r))):n=d(this.endian_mark+m("L",r),a);else if(5==i)if(t=d(this.endian_mark+"L",a)[0],r>1){n=[];for(var o=0;o<r;o++)n.push([d(this.endian_mark+"L",this.tiftag.slice(t+8*o,t+4+8*o))[0],d(this.endian_mark+"L",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else n=[d(this.endian_mark+"L",this.tiftag.slice(t,t+4))[0],d(this.endian_mark+"L",this.tiftag.slice(t+4,t+8))[0]];else if(7==i)r>4?(t=d(this.endian_mark+"L",a)[0],n=this.tiftag.slice(t,t+r)):n=a.slice(0,r);else if(9==i)r>1?(t=d(this.endian_mark+"L",a)[0],n=d(this.endian_mark+m("l",r),this.tiftag.slice(t,t+4*r))):n=d(this.endian_mark+m("l",r),a);else{if(10!=i)throw new Error("Exif might be wrong. Got incorrect value type to decode. type:"+i);if(t=d(this.endian_mark+"L",a)[0],r>1){n=[];for(o=0;o<r;o++)n.push([d(this.endian_mark+"l",this.tiftag.slice(t+8*o,t+4+8*o))[0],d(this.endian_mark+"l",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else n=[d(this.endian_mark+"l",this.tiftag.slice(t,t+4))[0],d(this.endian_mark+"l",this.tiftag.slice(t+4,t+8))[0]]}return n instanceof Array&&1==n.length?n[0]:n}},"undefined"!=typeof window&&"function"==typeof window.btoa)var u=window.btoa;if(void 0===u)u=function(e){for(var t,n,i,r,a,o,s,l="",u=0,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u<e.length;)r=(t=e.charCodeAt(u++))>>2,a=(3&t)<<4|(n=e.charCodeAt(u++))>>4,o=(15&n)<<2|(i=e.charCodeAt(u++))>>6,s=63&i,isNaN(n)?o=s=64:isNaN(i)&&(s=64),l=l+c.charAt(r)+c.charAt(a)+c.charAt(o)+c.charAt(s);return l};if("undefined"!=typeof window&&"function"==typeof window.atob)var c=window.atob;if(void 0===c)c=function(e){var t,n,i,r,a,o,s="",l=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=u.indexOf(e.charAt(l++))<<2|(r=u.indexOf(e.charAt(l++)))>>4,n=(15&r)<<4|(a=u.indexOf(e.charAt(l++)))>>2,i=(3&a)<<6|(o=u.indexOf(e.charAt(l++))),s+=String.fromCharCode(t),64!=a&&(s+=String.fromCharCode(n)),64!=o&&(s+=String.fromCharCode(i));return s};function h(e,t){if(!(t instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(e.length-1!=t.length)throw new Error("'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.");var n;if("<"==e[0])n=!0;else{if(">"!=e[0])throw new Error("");n=!1}for(var i="",r=1,a=null,o=null,s=null;o=e[r];){if("b"==o.toLowerCase()){if(a=t[r-1],"b"==o&&a<0&&(a+=256),a>255||a<0)throw new Error("'pack' error.");s=String.fromCharCode(a)}else if("H"==o){if((a=t[r-1])>65535||a<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(a%65536/256))+String.fromCharCode(a%256),n&&(s=s.split("").reverse().join(""))}else{if("l"!=o.toLowerCase())throw new Error("'pack' error.");if(a=t[r-1],"l"==o&&a<0&&(a+=4294967296),a>4294967295||a<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(a/16777216))+String.fromCharCode(Math.floor(a%16777216/65536))+String.fromCharCode(Math.floor(a%65536/256))+String.fromCharCode(a%256),n&&(s=s.split("").reverse().join(""))}i+=s,r+=1}return i}function d(e,t){if("string"!=typeof t)throw new Error("'unpack' error. Got invalid type argument.");for(var n,i=0,r=1;r<e.length;r++)if("b"==e[r].toLowerCase())i+=1;else if("h"==e[r].toLowerCase())i+=2;else{if("l"!=e[r].toLowerCase())throw new Error("'unpack' error. Got invalid mark.");i+=4}if(i!=t.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+i+":"+t.length);if("<"==e[0])n=!0;else{if(">"!=e[0])throw new Error("'unpack' error.");n=!1}for(var a=[],o=0,s=1,l=null,u=null,c=null,h="";u=e[s];){if("b"==u.toLowerCase())c=1,l=(h=t.slice(o,o+c)).charCodeAt(0),"b"==u&&l>=128&&(l-=256);else if("H"==u)c=2,h=t.slice(o,o+c),n&&(h=h.split("").reverse().join("")),l=256*h.charCodeAt(0)+h.charCodeAt(1);else{if("l"!=u.toLowerCase())throw new Error("'unpack' error. "+u);c=4,h=t.slice(o,o+c),n&&(h=h.split("").reverse().join("")),l=16777216*h.charCodeAt(0)+65536*h.charCodeAt(1)+256*h.charCodeAt(2)+h.charCodeAt(3),"l"==u&&l>=2147483648&&(l-=4294967296)}a.push(l),o+=c,s+=1}return a}function m(e,t){for(var n="",i=0;i<t;i++)n+=e;return n}function p(e){if("ÿØ"!=e.slice(0,2))throw new Error("Given data isn't JPEG.");for(var t=2,n=["ÿØ"];;){if("ÿÚ"==e.slice(t,t+2)){n.push(e.slice(t));break}var i=t+d(">H",e.slice(t+2,t+4))[0]+2;if(n.push(e.slice(t,i)),(t=i)>=e.length)throw new Error("Wrong JPEG data.")}return n}var g={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},f={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};f["0th"]=f.Image,f["1st"]=f.Image,n.TAGS=f,n.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},n.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},n.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},n.InteropIFD={InteroperabilityIndex:1},n.GPSHelper={degToDmsRational:function(e){var t=Math.abs(e),n=t%1*60,i=n%1*60;return[[Math.floor(t),1],[Math.floor(n),1],[Math.round(100*i),100]]},dmsRationalToDeg:function(e,t){var n="S"===t||"W"===t?-1:1;return(e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600)*n}},e.exports&&(t=e.exports=n),t.piexif=n}()});Et.piexif;function Pt(e){var t=-1;Ft||(Ft=function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var n=t,i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}());for(var n=0;n<e.length;n++)t=Ft[255&(t^e[n])]^t>>>8;return-1^t}var kt="image/png",Nt="image/jpeg",Mt="p".charCodeAt(0),Dt="H".charCodeAt(0),wt="Y".charCodeAt(0),Lt="s".charCodeAt(0);function Ot(e,t){var n=e.slice(0,33);return new Promise(function(i,r){BFN.BlobUtils.blobToArrayBuffer(n,function(n){var a=n.arrayBuffer,o=n.error;if(o)return r(o);var s=new Uint8Array(a),l=e.slice(33),u=function(e,t,n,i){if(n===Nt)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(n===kt){var r=new Uint8Array(13);t*=39.3701,r[0]=Mt,r[1]=Dt,r[2]=wt,r[3]=Lt,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=255&t,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;var a=Pt(r),o=new Uint8Array(4);if(o[0]=a>>>24,o[1]=a>>>16,o[2]=a>>>8,o[3]=255&a,i){var s=function(e){for(var t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===Mt&&e[t-2]===Dt&&e[t-1]===wt&&e[t]===Lt)return t-3}(e);return e.set(r,s),e.set(o,s+13),e}var l=new Uint8Array(4);l[0]=0,l[1]=0,l[2]=0,l[3]=9;var u=new Uint8Array(54);return u.set(e,0),u.set(l,33),u.set(r,37),u.set(o,50),u}}(s,t,e.type);i(new Blob([u,l],{type:e.type}))},{timeoutMs:1e3,reportErrors:!1})})}var Rt=function(){function e(){i(this,e),this.default_dpi=300}return a(e,[{key:"load",value:function(e,t){var n=BeFunky.callbackTimeout("ExifTool.load (with promise)",2500);BFN.BlobUtils.blobToBinaryString(e,function(e){var i=e.binaryString,r=e.error;if(n(),r)return t({error:r});var a=null;try{(a=Et.load(i)).thumbnail=null}catch(e){}t({exif:a,binaryString:i})},{timeoutMs:2e3,reportErrors:!1})}},{key:"getOrientation",value:function(e){return e["0th"][Et.ImageIFD.Orientation]}},{key:"changeOrientation",value:function(e,t){e["0th"][Et.ImageIFD.Orientation]=t}},{key:"getDPI",value:function(e){return{x:e["0th"][Et.ImageIFD.XResolution],y:e["0th"][Et.ImageIFD.YResolution]}}},{key:"changeDPI",value:function(e,t,n){e["0th"][Et.ImageIFD.XResolution]=[t,1],e["0th"][Et.ImageIFD.YResolution]=[n,1],e["0th"][Et.ImageIFD.ResolutionUnit]=2}},{key:"changeDPIForPNG",value:function(e,t,n){t=t||this.getDpiFromExif(n)||this.default_dpi;var i=Date.now();return Ot(e,t).then(function(e){return console.log("Added ".concat(t," DPI to PNG blob in ").concat(Date.now()-i,"ms")),e}).catch(function(t){return BeFunky.logError("Failed to add DPI to PNG blob:",t),e})}},{key:"getDpiFromExif",value:function(e){if(e&&e["0th"]&&Array.isArray(e["0th"][Et.ImageIFD.XResolution])){var t=f(e["0th"][Et.ImageIFD.XResolution].map(function(e){return parseInt(e)}),2),n=t[0],i=t[1],r=n;return i>1&&(r=n/i),3===e["0th"][Et.ImageIFD.ResolutionUnit]&&(r*=2.54),(r=Math.round(r))||void 0}}},{key:"generateExif",value:function(e,t){var n={};return n[Et.ImageIFD.Make]="BeFunky",n[Et.ImageIFD.Software]="BeFunky Photo Editor",t||(t=1),n[Et.ImageIFD.Orientation]=t,e||(e=this.default_dpi),n[Et.ImageIFD.XResolution]=[e,1],n[Et.ImageIFD.YResolution]=[e,1],n[Et.ImageIFD.ResolutionUnit]=2,{"0th":n}}},{key:"insert",value:function(e,t,n,i){var r=this;n=n||this.getDpiFromExif(t)||this.default_dpi,t?(this.changeDPI(t,n,n),this.changeOrientation(t,1)):t=this.generateExif(n),delete t["0th"][Et.ImageIFD.WhitePoint],delete t["0th"][Et.ImageIFD.PrimaryChromaticities];var a=function(n){n=n||e;var a=Date.now();r.load(n,function(e){var n,r=e.error,o=e.binaryString;if(r)return i({error:r});try{var s=Et.dump(t),l=Et.insert(s,o);n=BFN.ByteArrayUtil.convertBinaryStringToUint8Array(l),console.log("Added EXIF to JPEG blob in ".concat(Date.now()-a,"ms"))}catch(e){return BeFunky.logError("Unable to add EXIF data to blob using Piexif"),Math.random()>.9&&(console.log("Exif data",t),BeFunky.throwError(e)),i({error:"Unable to generate blob: ".concat(e.message?e.message:e)})}return i({blob:new Blob([n],{type:"image/jpeg"})})})},o=Date.now();Ot(e,n).then(function(e){console.log("Added ".concat(n," DPI to JPEG blob in ").concat(Date.now()-o,"ms")),a(e)}).catch(function(e){BeFunky.logError("Failed to add DPI to JPEG blob:",e),a()})}}]),e}();BFN.SingletonQueue.add(function(){BFN.ExifTool=new Rt});var At=function(){function e(){i(this,e),this.holder=new PIXI.Sprite,this.filter=null}return a(e,[{key:"drawShape",value:function(e,t,n,i){this.currentTexture=t,this.currentParams=n||{},this.renderer=i||BFN.Stage;var r=Math.min(Math.min(this.currentTexture.width,this.currentTexture.height)/2,Math.max(0,this.currentParams.hasOwnProperty("padding")?this.currentParams.padding:0)),a=Math.min(this.currentTexture.width/2,Math.max(0,this.currentParams.hasOwnProperty("paddingX")?this.currentParams.paddingX:r)),o=Math.min(this.currentTexture.height/2,Math.max(0,this.currentParams.hasOwnProperty("paddingY")?this.currentParams.paddingY:r)),s=this.currentParams.hasOwnProperty("paddingL")?Math.min(this.currentTexture.width/2,Math.max(0,this.currentParams.paddingL||0)):a,l=this.currentParams.hasOwnProperty("paddingR")?Math.min(this.currentTexture.width/2,Math.max(0,this.currentParams.paddingR||0)):a,u=this.currentParams.hasOwnProperty("paddingT")?Math.min(this.currentTexture.height/2,Math.max(0,this.currentParams.paddingT||0)):o,c=this.currentParams.hasOwnProperty("paddingB")?Math.min(this.currentTexture.height/2,Math.max(0,this.currentParams.paddingB||0)):o;switch(this.holder.width=this.currentTexture.width-(s+l),this.holder.height=this.currentTexture.height-(u+c),this.holder.x=s,this.holder.y=u,e){case"ellipse":this.ellipse();break;case"roundedRect":this.roundedRect()}}},{key:"apply",value:function(){this.currentParams.hasOwnProperty("backgroundColor")&&-1!==this.currentParams.backgroundColor&&(this.currentTexture.fillColor(this.currentParams.backgroundColor,this.currentParams.backgroundAlpha||1),this.currentParams.clear=!1),this.filter.autoFit=!1,this.holder.filters=[this.filter],this.renderer.render(this.holder,this.currentTexture,!this.currentParams.hasOwnProperty("clear")||this.currentParams.clear);try{this.holder.destroyGC(!0)}catch(e){}this.currentParams=null,this.filter=null,this.currentTexture=null}},{key:"ellipse",value:function(){this.filter=new BFN.filters.EllipseFilter,this.filter.quality=this.currentParams.hasOwnProperty("quality")?this.currentParams.quality:.75,this.filter.edgePadding=this.currentParams.hasOwnProperty("edgePadding")?this.currentParams.edgePadding:1,this.filter.strokeWidth=this.currentParams.hasOwnProperty("strokeWidth")?this.currentParams.strokeWidth:0,this.filter.strokeColor=this.currentParams.hasOwnProperty("strokeColor")?this.currentParams.strokeColor:4278190080,this.filter.fillColor=this.currentParams.hasOwnProperty("fillColor")?this.currentParams.fillColor:0,this.apply()}},{key:"roundedRect",value:function(){this.filter=new BFN.filters.RoundedRectFilter,this.filter.quality=this.currentParams.hasOwnProperty("quality")?this.currentParams.quality:.75,this.filter.edgePadding=this.currentParams.hasOwnProperty("edgePadding")?this.currentParams.edgePadding:1,this.filter.strokeWidth=this.currentParams.hasOwnProperty("strokeWidth")?this.currentParams.strokeWidth:0,this.filter.cornerRadius=this.currentParams.hasOwnProperty("cornerRadius")?this.currentParams.cornerRadius:1,this.filter.strokeColor=this.currentParams.hasOwnProperty("strokeColor")?this.currentParams.strokeColor:4278190080,this.filter.fillColor=this.currentParams.hasOwnProperty("fillColor")?this.currentParams.fillColor:0,this.filter.outerColor=this.currentParams.hasOwnProperty("outerColor")?this.currentParams.outerColor:0,this.apply()}}]),e}();function Vt(){}BFN.graphics=new At,Vt.prototype.hexStringToHexNumber=function(e){return parseInt("0x"+e)},Vt.prototype.hexNumberToHexString=function(e){var t=this.hexNumberToRGBAObject(e),n=this.rgbaObjectToHexStringObject(t);return e<=16777215?n.hex:(256|255*n.alpha).toString(16).slice(1)+n.hex},Vt.prototype.hexNumberToRGBAObject=function(e){var t={};return t.r=e>>16&255,t.g=e>>8&255,t.b=255&e,t.a=e<=16777215?1:(e>>24&255)/255,t},Vt.prototype.rgbaObjectToHexStringObject=function(e){var t={};return t.hex=(16777216|e.b|e.g<<8|e.r<<16).toString(16).slice(1),t.alpha=e.a,t},Vt.prototype.hexNumberToRGBAString=function(e){var t=this.hexNumberToRGBAObject(e);return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},Vt.prototype.hexStringObjectToRGBAString=function(e){var t=this.hexStringToHexNumber(e.hex),n=this.hexNumberToRGBAObject(t);return n.a=e.alpha,n.a>=1?"rgb("+n.r+","+n.g+","+n.b+")":"rgba("+n.r+","+n.g+","+n.b+","+n.a+")"},Vt.prototype.rgbaStringToHexStringObject=function(e){var t=e.replace("rgb(","").replace("rgba(","").replace(")","").split(",");if(t&&t.length){for(var n=0;n<t.length;n++)if(t[n]=parseFloat(t[n]),"number"!=typeof t[n]||isNaN(t[n]))return null;if(t.length>=3){var i={};return i.r=t[0],i.g=t[1],i.b=t[2],i.a=1,t.length>3&&(i.a=t[3]),this.rgbaObjectToHexStringObject(i)}}return{hex:"000000",alpha:0}},BFN.SingletonQueue.add(function(){BFN.ColorUtil=new Vt}),BFN.transformItemPoolTexture=PIXI.RenderTexture.create(256,256,PIXI.SCALE_MODES.NEAREST),BFN.transformItemTempParent=new PIXI.Sprite;var Ut=function(){function e(){i(this,e)}return a(e,[{key:"interpolateNumber",value:function(e,t,n){return e*(1-n)+t*n}},{key:"polygonHitTest",value:function(e,t){for(var n,i,r,a,o,s=[e,t],l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){var h=(c+1)%u.length,d=u[c],m=u[h],p={x:m.y-d.y,y:d.x-m.x};i=r=void 0;for(var g=0;g<e.length;g++)n=p.x*e[g].x+p.y*e[g].y,(void 0===i||n<i)&&(i=n),(void 0===r||n>r)&&(r=n);a=o=void 0;for(var f=0;f<t.length;f++)n=p.x*t[f].x+p.y*t[f].y,(void 0===a||n<a)&&(a=n),(void 0===o||n>o)&&(o=n);if(r<a||o<i)return!1}return!0}},{key:"isTransparent",value:function(e){var t=BFN.Stage.gl,n=t.createFramebuffer(),i=e.baseTexture._glTextures[0],r=e.width,a=e.height;if(!i||!i.texture)return!1;var o=null;function s(){t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null),n=null,o=null}if(t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i.texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)==t.FRAMEBUFFER_COMPLETE){var l=r*a*4;o=new Uint8Array(l),t.readPixels(0,0,r,a,t.RGBA,t.UNSIGNED_BYTE,o);for(var u=0;u<l;u+=4)if(o[u+3]<255)return s(),!0}return s(),!1}},{key:"isSolidColor",value:function(e){var t=BFN.Stage.gl,n=t.createFramebuffer(),i=e.baseTexture._glTextures[0],r=e.width,a=e.height;if(!i||!i.texture)return!1;var o=null;function s(){t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null),n=null,o=null}t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i.texture,0);var l=[0,0,0,0];if(t.checkFramebufferStatus(t.FRAMEBUFFER)==t.FRAMEBUFFER_COMPLETE){var u=r*a*4;o=new Uint8Array(u),t.readPixels(0,0,r,a,t.RGBA,t.UNSIGNED_BYTE,o);for(var c=0;c<u;c+=4)if(c){if(o[c+0]!=l[0]||o[c+1]!=l[1]||o[c+2]!=l[2]||o[c+3]!=l[3])return s(),!1}else l=[o[c+0],o[c+1],o[c+2],o[c+3]]}return s(),!0}},{key:"getTextureAverageColor",value:function(e,t,n,i,r){var a=BFN.Stage.gl,o=a.createFramebuffer(),s=e.baseTexture._glTextures[0],l=e.width,u=e.height,c=null,h=null;a.bindFramebuffer(a.FRAMEBUFFER,o),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,s.texture,0);var d=0,m=0,p=0;if(a.checkFramebufferStatus(a.FRAMEBUFFER)==a.FRAMEBUFFER_COMPLETE){var g=l*u*4;c=new Uint8Array(g),a.readPixels(0,0,l,u,a.RGBA,a.UNSIGNED_BYTE,c);for(var f=0,v=0;v<g;v+=4)c[v+3]>0&&(f++,d+=c[v],i?(m=d,p=d):(m+=c[v+1],p+=c[v+2]));if(d/=f,m/=f,p/=f,1==r){f=0;for(var y=d,x=0;x<g;x+=4)c[x+3]>0&&c[x]<=y&&(f++,d+=c[x]);m=d/=f,p=d}n&&(d/=255,m/=255,p/=255),h=t?d<<16|m<<8|p:[d,m,p]}return a.deleteFramebuffer(o),a.bindFramebuffer(a.FRAMEBUFFER,null),o=null,c=null,h}},{key:"getAlphaBounds",value:function(e){var t,n,i,r,a,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],h=BFN.Stage.gl,d={minX:0,minY:0,maxX:e.width,maxY:e.height,left:0,right:0,top:0,bottom:0,width:e.width,height:e.height,centerX:e.width/2,centerY:e.height/2,centerOffsetX:0,centerOffsetY:0,noBounds:!1},m=e.baseTexture._glTextures[0],p=e.width,g=e.height,f=null;s||(s=["left","right","top","bottom"]);var v=h.createFramebuffer();function y(t,n){return u?(r=4*(n*e.width+t),(f[r]+f[r+1]+f[r+2])/3):(r=4*(n*e.width+t)+3,f[r])}function x(){h.deleteFramebuffer(v),h.bindFramebuffer(h.FRAMEBUFFER,null),v=null,f=null}function _(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d.minX=d.minY=d.maxX=d.maxY=d.left=d.right=d.top=d.bottom=d.width=d.height=d.centerX=d.centerY=d.centerOffsetX=d.centerOffsetY=0,d.noBounds=e}h.bindFramebuffer(h.FRAMEBUFFER,v),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,m.texture,0);var I=new PIXI.Point,T=.5;function b(e,t){var n={x:e.x,y:e.y,alpha:e.alpha};if(n.alpha<T)for(var i=!1,r=1;r<=2;r++){for(var a=-2;a<=2;a++){switch(t){case"left":I.x=e.x-r,I.y=e.y+a;break;case"right":I.x=e.x+r,I.y=e.y-a;break;case"up":I.x=e.x-a,I.y=e.y-r;break;case"down":I.x=e.x+a,I.y=e.y+r}if(I.x>=0&&I.y<p&&I.y>=0&&I.y<g){var o=y(I.x,I.y)/255;if(o>n.alpha&&(n.x=I.x,n.y=I.y,n.alpha=o,o>=T)){i=!0;break}}}if(i)break}return{x:n.x-e.x,y:n.y-e.y}}if(h.checkFramebufferStatus(h.FRAMEBUFFER)==h.FRAMEBUFFER_COMPLETE){if(f=new Uint8Array(p*g*4),h.readPixels(0,0,p,g,h.RGBA,h.UNSIGNED_BYTE,f),o=null,-1!=s.indexOf("left")){for(t=!1,n=d.minX;n<d.maxX;n++){for(i=d.minY;i<d.maxY;i++)if((a=y(n,i)/255)>0){if(t=!0,c){d.minX=n;break}o?a>o.alpha&&(o.x=n,o.y=i,o.alpha=a):(d.minX=n,o={x:n,y:i,alpha:a})}if(o&&1!=o.alpha&&(d.minX+=b(o,"right").x),t)break}if(!t)return x(),_(!0),d}if(o=null,-1!=s.indexOf("top")){for(t=!1,i=d.minY;i<d.maxY;i++){for(n=d.minX;n<d.maxX;n++)if((a=y(n,i)/255)>0){if(t=!0,c){d.minY=i;break}o?a>o.alpha&&(o.x=n,o.y=i,o.alpha=a):(d.minY=i,o={x:n,y:i,alpha:a})}if(o&&1!=o.alpha&&(d.minY+=b(o,"down").y),t)break}if(!t)return x(),_(!0),d}if(o=null,-1!=s.indexOf("right")){for(t=!1,n=d.maxX;--n>d.minX-1;){for(i=d.minY;i<d.maxY;i++)if((a=y(n,i)/255)>0){if(t=!0,c){d.maxX=n;break}o?a>o.alpha&&(o.x=n,o.y=i,o.alpha=a):(d.maxX=n,o={x:n,y:i,alpha:a})}if(o&&1!=o.alpha&&(d.maxX+=b(o,"left").x),t)break}if(!t)return x(),_(!0),d}if(o=null,-1!=s.indexOf("bottom")){for(t=!1,i=d.maxY;--i>d.minY-1;){for(n=d.minX;n<d.maxX;n++)if((a=y(n,i)/255)>0){if(t=!0,c){d.maxY=i;break}o?a>o.alpha&&(o.x=n,o.y=i,o.alpha=a):(d.maxY=i,o={x:n,y:i,alpha:a})}if(o&&1!=o.alpha&&(d.maxY+=b(o,"up").y),t)break}if(!t)return x(),_(!0),d}d.left=d.minX,d.top=d.minY,d.right=d.width-d.maxX-1,d.bottom=d.height-d.maxY-1,d.minX*=l,d.minY*=l,d.maxX*=l,d.maxY*=l,d.width*=l,d.height*=l,d.left*=l,d.top*=l,d.right*=l,d.bottom*=l,d.width=d.width-d.left-d.right,d.height=d.height-d.top-d.bottom,d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.centerOffsetX=d.centerX-e.width*l/2,d.centerOffsetY=d.centerY-e.height*l/2}return x(),0!==d.width&&0!==d.height||(d.noBounds=!0),d}},{key:"getTransformItemBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0,left:0,right:0,top:0,bottom:0,centerOffsetX:0,centerOffsetY:0};if(e&&e.parent){for(var i="text"!=e.type||t?e.globalBorderPolygon:e.globalTextPolygon,r=0;r<i.length;r++){var a=e.parent.toLocal(i[r],BFN.MainUI);(void 0===n.minX||a.x<n.minX)&&(n.minX=a.x),(void 0===n.maxX||a.x>n.maxX)&&(n.maxX=a.x),(void 0===n.minY||a.y<n.minY)&&(n.minY=a.y),(void 0===n.maxY||a.y>n.maxY)&&(n.maxY=a.y)}return n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.centerX=n.minX+n.width/2,n.centerY=n.minY+n.height/2,n}return n.minX=n.minY=n.maxX=n.maxY=0,n}},{key:"getTransformItemTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e&&e.parent){var a=e.rotation;n&&(e.rotation=0,t=null),t=t||BFN.Util.getTransformItemBounds(e,!1),i=i||BFN.transformItemPoolTexture;var o=Math.min(1,1024/t.width,1024/t.height),s=Math.round(t.width*o),l=Math.round(t.height*o),u=s/t.width,c=l/t.height;i!==BFN.transformItemPoolTexture&&(i.adjustScale=i.adjustScale||{},i.adjustScale.x=u,i.adjustScale.y=c);var h=e.interactive,d=e.buttonMode,m=e.x,p=e.y,g=e.scale.x,f=e.scale.y,v=e.alpha,y=e.visible,x=e.renderable,_=e.parent,I=_.getChildIndex(e),T=e.itemBlendMode,b=e.itemContent.visible,S=!!e.hiResTextSprite&&e.hiResTextSprite.visible,C=!!e.hiResTextHelper&&e.hiResTextHelper.visible;return e.x=Math.round((e.x-t.minX)*o),e.y=Math.round((e.y-t.minY)*o),e.scale.x*=u,e.scale.y*=c,e.alpha=1,e.visible=!0,e.renderable=!0,e.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL),e.updateSmoothingScale(1,!1),e.itemContent.visible=!0,e.itemContentShadow.visible=!1,e.hiResTextSprite&&(e.hiResTextSprite.visible=!1),e.hiResTextHelper&&(e.hiResTextHelper.visible=!1),BFN.transformItemTempParent.addChild(e),i.resize(Math.round(t.width*o),Math.round(t.height*o)),BFN.Stage.render(BFN.transformItemTempParent,i),r&&BFN.Stage.render(BFN.transformItemTempParent,i),e.rotation=a,e.interactive=h,e.buttonMode=d,e.x=m,e.y=p,e.scale.x=g,e.scale.y=f,e.alpha=v,e.visible=y,e.renderable=x,e.setBlendMode(T),e.updateSmoothingScale(),e.itemContent.visible=b,e.itemContentShadow.visible=!0,e.hiResTextSprite&&(e.hiResTextSprite.visible=S),e.hiResTextHelper&&(e.hiResTextHelper.visible=C),_.addChildAt(e,I),i}return null}},{key:"getThumbTextureGL",value:function(e,t,n,i){if(null==e)return null;null==t&&(t=50),null==n&&(n=!1),null==i&&(i=!1);var r=new PIXI.Sprite(e),a=new PIXI.Container;a.addChild(r);var o=Math.max(e.width,e.height),s=Math.min(e.width,e.height),l=n&&i?t/s:t/o,u=Math.floor(e.width*l),c=Math.floor(e.height*l);r.x=n?t/2-u/2:0,r.y=n?t/2-c/2:0;var h=PIXI.RenderTexture.create(n?t:u,n?t:c);return r.scale.x=u/e.width,r.scale.y=c/e.height,BFN.Stage.render(a,h),a.removeChild(r),a=null,r.destroy(!1),r=null,h}},{key:"getThumbTexture",value:function(e,t,n,i){if(null==e)return null;t=t||50,n=n||!1,i=i||!1;var r=new PIXI.Texture(e.baseTexture);r.frame=e.frame,r.orig=e.orig,r.trim=e.trim;var a=Math.min(r.width,r.height),o=Math.max(r.width,r.height),s=null;if(o>3*t){var l=3*t/o,u=Math.max(8,Math.round(r.width*l)),c=Math.max(8,Math.round(r.height*l));s=this.resizeTexture(r,u,c,!1,!0),r.destroy(!1),r=s}else if(a<t){var h=n&&i?t/a:t/o,d=Math.max(8,Math.min(t,Math.round(r.width*h))),m=Math.max(8,Math.min(t,Math.round(r.height*h)));s=this.resizeTexture(r,d,m,n&&i),r.destroy(!1),r=s}var p=Math.max(r.width,r.height),g=Math.min(r.width,r.height),f=n&&i?t/g:t/p,v=Math.max(8,Math.round(r.width*f)),y=Math.max(8,Math.round(r.height*f)),x=new PIXI.Sprite(r);x.pluginName="smooth_picture",x.x=n?t/2-v/2:0,x.y=n?t/2-y/2:0,x.scale.x=x.currentScale=v/r.width,x.scale.y=x.currentScaleY=y/r.height;var _=PIXI.RenderTexture.create(n?t:v,n?t:y);return BFN.Stage.render(x,_),x.destroy(!1),x=null,s&&s.destroyGC(!0),e.baseTexture&&e.baseTexture.hasOwnProperty("isTransparent")&&!n&&!i&&(_.isTransparent=e.baseTexture.isTransparent),_}},{key:"getHTMLImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return t&&t(null),null;var i=null;if(n&&(this.unPremultiplySprite||(this.unPremultiplySprite=new PIXI.Sprite,this.unPremultiplyFilter=new BFN.filters.UnPremultiplyFilter,this.unPremultiplySprite.filters=[this.unPremultiplyFilter]),this.unPremultiplySprite.texture=e,i=e.renderClone(),BFN.Stage.render(this.unPremultiplySprite,i)),null==t){var r=BFN.Stage.extract.image(n?i:e);return n&&(this.unPremultiplySprite.texture=PIXI.Texture.EMPTY,i.destroyGC(!0),i=null),r}if(t){var a=BFN.Stage.extract.canvas(n?i:e);n&&(this.unPremultiplySprite.texture=PIXI.Texture.EMPTY);var o=n?"image/png":"image/jpeg";a.toBlob(function(e){BFN.BlobUtils.blobToBase64(e).catch(function(e){return BeFunky.throwError("Unable to convert blob -> base64 in getHTMLImage",e),""}).then(function(e){var r=new Image;r.src=e,n&&i.destroyGC(!0),i=null,t(r)})},o,.99)}}},{key:"getRandomInt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2147483647;return Math.round(Math.random()*(t-e))+e}},{key:"orientTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e&&e.valid&&t>=2&&t<=8){var n=[5,6,7,8].indexOf(t)>=0,i=n?e.height:e.width,r=n?e.width:e.height,a=e.renderClone(),o=new PIXI.Sprite(a);a.rotate={2:12,3:4,4:8,5:10,6:6,7:14,8:2}[t],o.width=i,o.height=r,n&&e.resize(i,r,!1),BFN.Stage.render(o,e),a.destroyGC(!0),o.destroy(!1)}}},{key:"resizeTexture",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{if(e&&e.width&&e.height&&t&&n){var a=new PIXI.Sprite(e);i?(a.scale.x=a.scale.y=Math.max(Math.abs(t)/e.width,Math.abs(n)/e.height),a.x=(t-e.width*a.scale.x)/2,a.y=(n-e.height*a.scale.y)/2):(a.scale.x=Math.abs(t)/e.width,a.scale.y=Math.abs(n)/e.height),r&&(a.pluginName="smooth_picture",a.currentScale=a.scale.x,a.currentScaleY=a.scale.y);var o=PIXI.RenderTexture.create(t,n);return BFN.Stage.render(a,o),a.destroy(!1),a=null,e&&e.baseTexture&&e.baseTexture.hasOwnProperty("isTransparent")&&(o.isTransparent=e.baseTexture.isTransparent),o}}catch(e){BeFunky.logError("resizeTexture failed",e)}return null}},{key:"fitTextureInRect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;try{if(e&&e.width&&e.height&&t&&n){var a=PIXI.RenderTexture.create(t,n);if(i)a.copyPixels(e,{x:0,y:0},!0,1,{x:t/e.width,y:n/e.height});else{-1==r?a.clear():a.fillColor(parseInt("0x".concat(r)),1);var o=Math.min(t/e.width,n/e.height),s=Math.round(t/2-e.width*o/2),l=Math.round(n/2-e.height*o/2);a.copyPixels(e,{x:s,y:l},!1,1,o)}return a}}catch(e){}return null}},{key:"conformImageSizeMegaPixels",value:function(e,t,n){try{if(e&&e.width&&e.height){var i=e.width,r=e.height,a=r/i,o=i*r,s=t,l=t,u=i*Math.sqrt(n/o),c=r*Math.sqrt(n/o);if(i<s||i>u||r<l||r>c){var h=Math.round(a>1?Math.max(s/a,Math.min(u/a,i/a)):Math.max(s,Math.min(u,i))),d=Math.round(a>1?Math.max(s,Math.min(u,i)):Math.max(s*a,Math.min(u*a,i*a)));return this.resizeTexture(e,h,d,!1)}}}catch(e){}return e.renderClone()}},{key:"conformImageSize",value:function(e,t,n){try{if(e&&e.width&&e.height){var i=e.width,r=e.height,a=r/i,o=t,s=n,l=t,u=n;if(i<o||i>s||r<l||r>u){var c=-1,h=-1;if(a>1?i<o?(c=o,h=Math.min(u,Math.round(c*a))):r>u&&(h=u,c=Math.max(o,Math.round(h/a))):r<l?(h=l,c=Math.min(s,Math.round(h/a))):i>s&&(c=s,h=Math.max(l,Math.round(c*a))),c>0&&h>0)return this.resizeTexture(e,c,h,!1)}}}catch(e){}return e.renderClone()}},{key:"hex2rgbVec3",value:function(e){var t=[];return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t}},{key:"rgbToHex",value:function(e,t,n){return e<<16|t<<8|n}},{key:"cloneTexture",value:function(e){var t=new PIXI.Sprite(e),n=PIXI.RenderTexture.create(e.width,e.height);return BFN.Stage.render(t,n),t.destroy(!1),t=null,n}},{key:"createRenderTexturePool",value:function(){BFN.renderTexturesPool||(BFN.renderTextureHolder=new PIXI.Sprite,BFN.renderTexturesPool=[{is_protected:!0,description:"photo-edit-model",used:!0,texture:PIXI.RenderTexture.create(512,512)},{is_protected:!0,description:"multiple-file-uploader",used:!0,texture:PIXI.RenderTexture.create(512,512)},{used:!1,texture:PIXI.RenderTexture.create(512,512)}])}},{key:"getNonUsedRenderTexturePool",value:function(e,t){for(var n=null,i=0;i<BFN.renderTexturesPool.length;i++)if(null!=BFN.renderTexturesPool[i]&&1!=BFN.renderTexturesPool[i].used&&0==BFN.renderTexturesPool[i].hasOwnProperty("is_protected")){BFN.renderTexturesPool[i].used=!0,e==BFN.renderTexturesPool[i].texture.width&&t==BFN.renderTexturesPool[i].texture.height||BFN.renderTexturesPool[i].texture.resize(e,t,!1),n=BFN.renderTexturesPool[i].texture;break}if(null==n){var r=BFN.renderTexturesPool.length;BFN.renderTexturesPool[r]={used:!0,texture:PIXI.RenderTexture.create(e,t)},n=BFN.renderTexturesPool[r].texture}return n}},{key:"destroyRenderTexturePool",value:function(){if(null!=BFN.renderTexturesPool){for(var e=0;e<BFN.renderTexturesPool.length;e++)if(null!=BFN.renderTexturesPool[e]&&1==BFN.renderTexturesPool[e].used&&0==BFN.renderTexturesPool[e].hasOwnProperty("is_protected")){BFN.renderTexturesPool[e].used=!1;try{BFN.renderTexturesPool[e].texture.resize(512,512)}catch(e){}}BFN.renderTextureHolder.texture=null,BFN.renderTextureHolder.filters=[]}}},{key:"calculateRes",value:function(e,t){var n={small:1,large:1},i=Math.max(e,t);return i<=8192&&(n.small=.25,n.large=.125),i<=4096&&(n.small=.5,n.large=.25),i<=2048&&(n.small=n.large=.5),i<1024&&(n.small=n.large=1),n}},{key:"expandVertices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&8==e.length){for(var i=[],r=0;r<8;r+=2){var a=Math.atan2(e[r+1]-e[(r+7)%8],e[r]-e[(r+6)%8]),o=Math.atan2(e[r+1]-e[(r+3)%8],e[r]-e[(r+2)%8]),s=Math.cos(a)*t,l=Math.sin(a)*t,u=Math.cos(o)*t,c=Math.sin(o)*t;if(n&&4===n.length)switch(Math.floor(r/2)){case 0:s*=n[2],l*=n[2],u*=n[0],c*=n[0];break;case 1:s*=n[1],l*=n[1],u*=n[2],c*=n[2];break;case 2:s*=n[3],l*=n[3],u*=n[1],c*=n[1];break;case 3:s*=n[0],l*=n[0],u*=n[3],c*=n[3]}var h=s+u,d=l+c;i.push(e[r]+h),i.push(e[r+1]+d)}return i}return e}},{key:"getDistance",value:function(e,t,n,i){return Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2))}},{key:"hsv2rgb",value:function(e){var t,n,i,r,a,o=e.h,s=e.s,l=e.v;o=o%360/60,t=n=i=l-(a=l*s),t+=[a,r=a*(1-Math.abs(o%2-1)),0,0,r,a][o=~~o],n+=[r,a,a,r,0,0][o],i+=[0,0,r,a,a,r][o];var u=Math.floor(255*t),c=Math.floor(255*n),h=Math.floor(255*i);return{r:u,g:c,b:h,hex:"#".concat((16777216|h|c<<8|u<<16).toString(16).slice(1))}}},{key:"rgb2hsv",value:function(e){var t,n,i=e.r,r=e.g,a=e.b;return(i>1||r>1||a>1)&&(i/=255,r/=255,a/=255),{h:(0===(n=(t=Math.max(i,r,a))-Math.min(i,r,a))?null:t===i?(r-a)/n+(r<a?6:0):t===r?(a-i)/n+2:(i-r)/n+4)%6*60,s:0===n?0:n/t,v:t}}},{key:"hex2rgb",value:function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}},{key:"hex2hsv",value:function(e){return this.rgb2hsv(this.hex2rgb(e))}},{key:"getTotalTextureMemory",value:function(){var e=[];try{e.push.apply(e,v(BFN.Stage.textureManager._managedTextures))}catch(e){return BeFunky.logError("Unable to get PIXI _managedTextures array"),0}try{var t,n=(t=[]).concat.apply(t,v(Object.values(BFN.Stage.filterManager.pool))).map(function(e){return e.texture});e.push.apply(e,v(n))}catch(e){return BeFunky.logError("Unable to get PIXI pooled filter textures"),0}var i=4*e.reduce(function(e,t){var n=parseInt(t.width)||0,i=parseInt(t.height)||0,r="number"==typeof t.resolution?t.resolution:1;return n<=0||i<=0?(BeFunky.logError("Found texture with invalid width/height",t,t.width,t.height),e):e+n*i*r},0)/Math.pow(1024,2);return Math.round(10*i)/10}},{key:"addSetterCallback",value:function(e,t,n){var i=this.getPropertyDescriptor(e,t);i&&i.set&&i.get&&(e["".concat(t,"Set")]=i.set,e["".concat(t,"Get")]=i.get,e["".concat(t,"SetCB")]=n,Object.defineProperty(e,t,{set:function(e){this["".concat(t,"Set")](e),this["".concat(t,"SetCB")]()},get:function(){return this["".concat(t,"Get")]()}}))}},{key:"getPropertyDescriptor",value:function(e,t){var n;do{n=Object.getOwnPropertyDescriptor(e,t)}while(!n&&(e=Object.getPrototypeOf(e)));return n}},{key:"hasPropertyDescriptor",value:function(e,t){return!!this.getPropertyDescriptor(e,t)}},{key:"rotatePoint",value:function(e,t,n){t.x-=e.x,t.y-=e.y;var i=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),r=Math.atan2(t.y,t.x)+n;return new PIXI.Point(Math.cos(r)*i+e.x,Math.sin(r)*i+e.y)}},{key:"rectFromPointCloud",value:function(){var e,t,n,i,r=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=new PIXI.Point,l={rotation:o,width:0,height:0,tl:new PIXI.Point,tr:new PIXI.Point,bl:new PIXI.Point,br:new PIXI.Point};if(0!==o){var u=[];a.forEach(function(e){u.push(r.rotatePoint(s,e,-o))}),a=u}a.length&&(a.forEach(function(r,a){a?(e=Math.min(e,r.x),t=Math.min(t,r.y),n=Math.max(n,r.x),i=Math.max(i,r.y)):(e=n=r.x,t=i=r.y)}),l.width=n-e,l.height=i-t,l.tl.set(e,t),l.tr.set(n,t),l.bl.set(e,i),l.br.set(n,i),0!==o&&(l.tl=this.rotatePoint(s,l.tl,l.rotation),l.tr=this.rotatePoint(s,l.tr,l.rotation),l.bl=this.rotatePoint(s,l.bl,l.rotation),l.br=this.rotatePoint(s,l.br,l.rotation)));return l}}]),e}();function Gt(){this.init()}BFN.Util=new Ut,Gt.prototype.init=function(){BeFunky.log("SpritePool Init"),this.initDefaultValues()},Gt.prototype.initDefaultValues=function(){this.sprites=[],this.spriteAnchor=new PIXI.Point(.5,.5)},Gt.prototype.makeSprite=function(){var e=new PIXI.Sprite;return e.anchor.x=this.spriteAnchor.x,e.anchor.y=this.spriteAnchor.y,e},Gt.prototype.grow=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=0;t<e;t++)this.sprites.push(this.makeSprite())},Gt.prototype.growTo=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)-this.sprites.length;e>0&&this.grow(e)},Gt.prototype.getSprite=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e>=this.sprites.length&&this.growTo(e+1);var i=this.sprites[e];return t&&(i.x=t.x,i.y=t.y),n&&(i.texture=n),i},BFN.SpritePool=Gt;var Ht=function(){function e(){i(this,e)}return a(e,[{key:"convertBinaryStringToUint8Array",value:function(e){for(var t=e.length,n=new Uint8Array(t),i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}},{key:"AS3ByteArrayToPixel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:110,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:110,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){console.log(e.src)},r=function(e){for(var t=null,n=e.length,i=0;i<n/2;i+=1){t=n-1-i;var r=e[i],a=e[t];r^=a,r^=a^=r,e[i]=r,e[t]=a}return e},a=function(e){for(var t,n,i=[],a=0;a<e.length;a++){t=e.charCodeAt(a),n=[];do{n.push(255&t),t>>=8}while(t);n=r(n);try{Array.prototype.push.apply(i,n)}catch(e){}}return t=null,n=null,i}(atob(e)),o=document.createElement("canvas");o.width=t,o.height=n;for(var s=o.getContext("2d"),l=s.createImageData(t,n),u=0;u<a.length;u+=4)l.data[u+0]=a[u+1],l.data[u+1]=a[u+2],l.data[u+2]=a[u+3],l.data[u+3]=a[u+0];s.putImageData(l,0,0);var c=o.toDataURL();s=null,l=null,o=null,a=null;var h=document.createElement("img");h.onload=function(){i(h)},h.src=c}}]),e}();BFN.SingletonQueue.add(function(){BFN.ByteArrayUtil=new Ht}),BFN.GraphicLoaderEvents={GRAPHIC_COMPLETE:new Event("GRAPHIC_COMPLETE"),LOADING_COMPLETE:new Event("LOADING_COMPLETE")};var zt=function(t){u(r,BFN.EventDispatcher);var n=p(r);function r(){var e;return i(this,r),(e=n.call(this)).init(),e}return a(r,[{key:"init",value:function(){BeFunky.log("GraphicLoader Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this._graphicsLoaded=!1,this._graphicsData={},this._graphics={},this._blobs={},this.activeLoaders={},this.loaderCount=0,this.handleImageLoadErrorBind=this.handleImageLoadError.bind(this),this.handleImageLoadCompleteBind=this.handleImageLoadComplete.bind(this)}},{key:"loadGraphics",value:function(){for(var e in this._graphicsData){var t=this._graphicsData[e];this._graphics[e]&&this._graphics[e]!=this.missingTexture&&this._graphics[e].destroyGC(!0),this._graphics[e]=null;var n=new XMLHttpRequest;n.onerror=this.handleImageLoadErrorBind,n.onload=this.handleImageLoadCompleteBind,n.open("GET",t,!0),n.responseType=57===BeFunky.firefoxVersion?"arraybuffer":"blob",this.activeLoaders[e]=n,n.send(),this.loaderCount++,this._graphicsData[e]=null,delete this._graphicsData[e]}this.loaderCount||(this._graphicsLoaded=!0,this.dispatchEvent(BFN.GraphicLoaderEvents.LOADING_COMPLETE))}},{key:"reset",value:function(){for(var e in this._graphicsData)this._graphicsData[e]=null,delete this._graphicsData[e];for(var t in this._graphics)this._graphics[t]&&this._graphics[t]!=this.missingTexture&&this._graphics[t].destroyGC(!0),this._graphics[t]=null,delete this._graphics[t];for(var n in this._blobs)this._blobs[n]=null,delete this._blobs[n];for(var i in this.activeLoaders){this.activeLoaders[i];null,delete this.activeLoaders[i]}this.loaderCount=0,this._graphicsLoaded=!1}},{key:"handleImageLoadError",value:function(e){var t=e.currentTarget;for(var n in this.activeLoaders)if(this.activeLoaders[n]==t){this._graphics[n]=this.missingTexture,this._blobs[n]=null,t=null,delete this.activeLoaders[n];var i=new Event(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type);return i.data={graphicID:n,graphic:this._graphics[n],blob:this._blobs[n]},this.dispatchEvent(i),void(--this.loaderCount||(this._graphicsLoaded=!0,this.dispatchEvent(BFN.GraphicLoaderEvents.LOADING_COMPLETE)))}}},{key:"handleImageLoadComplete",value:function(t){var n=this,i=t.currentTarget,r=function(e){if(n.activeLoaders[e]==i){if(200==i.status){var r=i.response;"arraybuffer"===i.responseType&&(r=new Blob([new Uint8Array(r)])),BFN.TextureUtils.blobOrBase64ToTexture(r,function(a){var o=a.texture;if(a.error)n.handleImageLoadError(t);else{n._graphics[e]=o,n._blobs[e]=r,i=null,delete n.activeLoaders[e];var s=new Event(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type);s.data={graphicID:e,graphic:n._graphics[e],blob:n._blobs[e]},n.dispatchEvent(s),--n.loaderCount||(n._graphicsLoaded=!0,n.dispatchEvent(BFN.GraphicLoaderEvents.LOADING_COMPLETE))}},{textureSize:BFN.maxImageSize,readEXIF:!1})}else n.handleImageLoadError(t);return{v:void 0}}};for(var a in this.activeLoaders){var o=r(a);if("object"===e(o))return o.v}}},{key:"graphicsLoaded",get:function(){return this._graphicsLoaded}},{key:"graphicsData",get:function(){return this._graphicsData}},{key:"graphics",get:function(){return this._graphics}},{key:"blobs",get:function(){return this._blobs}},{key:"loading",get:function(){return this.loaderCount>0}},{key:"missingTexture",get:function(){if(!this._missingTexture){var e=new PIXI.Graphics;e.beginFill(16711680),e.drawRect(0,0,5,5),e.endFill(),this._missingTexture=PIXI.RenderTexture.create(5,5),BFN.Stage.render(e,this._missingTexture)}return this._missingTexture}}]),r}();function jt(){BFN.EventDispatcher.call(this),this.init()}BFN.GraphicLoader=zt,BFN.EffectTextureLoaderEvents={TEXTURE_LOADED:new Event("TEXTURE_LOADED")},jt.prototype=Object.create(BFN.EventDispatcher.prototype),jt.prototype.init=function(){BeFunky.log("EffectTextureLoader Init"),this.initDefaultValues(),this.initGraphicLoader()},jt.prototype.initDefaultValues=function(){this.loadedTextures={}},jt.prototype.initGraphicLoader=function(){this.graphicLoader=new BFN.GraphicLoader,this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.GRAPHIC_COMPLETE.type,this.handleGraphicLoaderGraphicComplete.bind(this))},jt.prototype.getTexture=function(e,t,n){return null==t&&(t=0),null==n&&(n=0),this.loadedTextures.hasOwnProperty(e)?(t>0&&n>0||(t=this.loadedTextures[e].width,n=this.loadedTextures[e].height),BFN.Util.resizeTexture(this.loadedTextures[e],t,n)):(this.graphicLoader.reset(),this.graphicLoader.graphicsData[e]=e,this.graphicLoader.loadGraphics(),null)},jt.prototype.handleGraphicLoaderGraphicComplete=function(e){var t=e.data.graphicID,n=e.data.graphic;this.loadedTextures.hasOwnProperty(t)&&this.loadedTextures[t].destroyGC(!0),this.loadedTextures[t]=PIXI.RenderTexture.create(n.width,n.height),this.loadedTextures[t].copyPixels(n),this.graphicLoader.reset();try{try{n.destroyGC(!0)}catch(e){}try{e.data=null}catch(e){}try{e=null}catch(e){}}catch(e){}this.dispatchEvent(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED)},jt.prototype.destroy=function(){var e=this;Object.keys(e.loadedTextures).forEach(function(t){if(e.loadedTextures.hasOwnProperty(t)&&null!=e.loadedTextures[t])try{e.loadedTextures[t].destroyGC(!0),e.loadedTextures[t]=null}catch(e){}})},Object.defineProperty(jt.prototype,"loading",{get:function(){return this.graphicLoader.loading}}),BFN.EffectTextureLoader=jt;var Xt=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this._base64graphics={},this._textureGraphics={},this.texturesThumbsPromise=void 0,this.effectsThumbsPromise=void 0,this.warningReported=!1}},{key:"loadTexturesThumbnailsXml",value:function(){var e=this,t="".concat(BFN.assetsURL,"datas/textures_thumbs.xml");return this.texturesThumbsPromise?this.texturesThumbsPromise:(this.texturesThumbsPromise=new Promise(function(n,i){BeFunky.request(t,{responseType:"text"},function(t){var r=t.error,a=t.response;if(r)return"request_failed"===r?BeFunky.logWarning("Failed to load textures thumb XML: ".concat(r)):BeFunky.reportWarning("Failed to load textures thumb XML: ".concat(r)),e.texturesThumbsPromise=null,i(r);for(var o=window.parseXml(a).getElementsByTagName("image"),s=o.length,l=[],u=0;u<s;u++){var c=o[u],h=c.getAttribute("name");e._base64graphics[h]=c.childNodes[0].nodeValue,l.push(e.loadBase64ToTexture(h))}n(e.waitForImageToTextureConversion(l))})}),this.texturesThumbsPromise)}},{key:"loadEffectsThumbnailsJson",value:function(){var e=this,t="".concat(BFN.assetsURL,"datas/effect_thumbs").concat(BFN.assetsDataVersions.effects_thumbs_data,".json");return this.effectsThumbsPromise?this.effectsThumbsPromise:(this.effectsThumbsPromise=new Promise(function(n,i){BFN.RequestUtils.getJSON(t,function(t){var r=t.error,a=t.response;if(r||!a.images)return"request_failed"===r?BeFunky.logWarning("Failed to load effects thumb JSON: ".concat(r||"invalid_response")):BeFunky.reportWarning("Failed to load effects thumb JSON: ".concat(r||"invalid_response")),e.effectsThumbsPromise=null,i(r||"invalid_response");for(var o=a.images.length,s=[],l=0;l<o;l++){var u=a.images[l];if(u&&u.hasOwnProperty("image")&&u.hasOwnProperty("name")){var c=u.image,h=u.name;e._base64graphics[h]=c,s.push(e.loadBase64ToTexture(h))}}n(e.waitForImageToTextureConversion(s))})}),this.effectsThumbsPromise)}},{key:"loadBase64ToTexture",value:function(e){var t=this;return new Promise(function(n,i){var r=document.createElement("img"),a=206,o=140;r.onload=function(){var i=new PIXI.Sprite(new PIXI.Texture(new PIXI.BaseTexture(r)));e.includes("lut_")||e.includes("_grad")||e.includes("texture_halftone")||e.includes("frost_pattern.jpg")||e.includes("snow_texture.jpg")||e.includes("256star")||e.includes("analog_fx")||e.includes("bw_fx")||e.includes("warm_fx")?e.includes("texture_halftone")?(a=BFN.FilterHelper.getNextPowerOfTwo(i.texture.width),o=BFN.FilterHelper.getNextPowerOfTwo(i.texture.height),i.scale.x=a/i.texture.width,i.scale.y=o/i.texture.height):(a=i.texture.width,o=i.texture.height):(i.scale.x=a/i.texture.width,i.scale.y=o/i.texture.height);var s=PIXI.RenderTexture.create(a,o);BFN.Stage.render(i,s),i.destroy(!0),i=null,t._textureGraphics[e]=s,BeFunky.log("LOADED THUMB : ".concat(e)),r=null,n()},r.onerror=function(){return i("Failed to load thumbnail ".concat(e))},r.src=t._base64graphics[e]})}},{key:"getGraphicByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this._textureGraphics.hasOwnProperty(e)){var i=BFN.Util.cloneTexture(this._textureGraphics[e]);if(t>0&&n>0||(t=i.width,n=i.height),t!==i.width||n!==i.height){var r=BFN.Util.resizeTexture(i,t,n);return i.destroyGC(!0),i=null,r}return i}this._base64graphics.hasOwnProperty(e)?(this.reportOnce("Thumbnail requested before texture generated",e),this.loadBase64ToTexture(e)):this.reportOnce("Thumbnail requested before base64 loaded",e);var a=PIXI.RenderTexture.create(10,10);return a.fillColor(16711680),a}},{key:"reportOnce",value:function(e){var t,n=this;if(!this.warningReported){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];(t=BeFunky).reportWarning.apply(t,[e].concat(r)),this.warningReported=!0,setTimeout(function(){n.warningReported=!1},1e3)}}},{key:"waitForImageToTextureConversion",value:function(e){return Promise.all(e).catch(function(e){return BeFunky.reportWarning("Failed to convert thumbnail base64(s) to texture",e),new Promise(function(e){return requestIdleCallback(function(){return e()})})})}}]),e}();BFN.SingletonQueue.add(function(){BFN.XMLGraphicLoader=new Xt});var Wt=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.baseTextures={}}}]),e}();function Yt(){BFN.EventDispatcher.call(this),this.init()}BFN.SingletonQueue.add(function(){BFN.GoodiesItemLoader=new Wt}),BFN.OverlaysThumbLoaderEvents={LOADED:new Event("OVERLAYS_THUMBS_LOADED")},Yt.prototype=Object.create(BFN.EventDispatcher.prototype),Yt.prototype.init=function(){this.initDefaultValues()},Yt.prototype.initDefaultValues=function(){this.thumbs={}},Yt.prototype.load=function(e){var t=this;if(this.thumbs[e])return this.dispatchEvent(BFN.OverlaysThumbLoaderEvents.LOADED);var n="".concat(BFN.overlaysUrl,"_thumbs/").concat(e).concat(BFN.assetsDataVersions.overlays_thumb,".json");BFN.RequestUtils.getJSON(n,function(n){var i=n.error,r=n.response;if(i)return BeFunky.throwError("Unable to load Overlays category ".concat(e),i);r&&r.thumbs&&(t.thumbs[e]=r.thumbs,t.dispatchEvent(BFN.OverlaysThumbLoaderEvents.LOADED))})},Yt.prototype.getBase64=function(e,t){if(null!=this.thumbs&&this.thumbs.hasOwnProperty(e))for(var n=0;n<this.thumbs[e].length;n++){var i=this.thumbs[e][n];if(i.id==t)return i.data}return null},Yt.prototype.getImage=function(e,t,n,i){var r=null;if(null!=this.thumbs&&this.thumbs.hasOwnProperty(e))for(var a=0;a<this.thumbs[e].length&&(r=this.thumbs[e][a]).id!=t;a++)r=null;if(null!=r){var o=document.createElement("img");o.id=r.id,o.onload=function(){if(1==n){var e=new PIXI.Texture(new PIXI.BaseTexture(o)),t=PIXI.RenderTexture.create(e.width,e.height),r=new PIXI.Sprite(e);BFN.Stage.render(r,t),r.destroy(!0);try{e.destroyGC(!0)}catch(e){}o.src="",null!=i&&i(t)}else i(o)},o.src=r.data}else i()},BFN.SingletonQueue.add(function(){BFN.OverlaysThumbLoader=new Yt});var qt=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){}},{key:"load",value:function(e,t,n,i){e=e.split(" ").join("-");var r="".concat(BFN.overlaysUrl+e,"/").concat(t,".png");BFN.RequestUtils.getBase64(r,function(e){var t=e.error,r=e.base64;if(t)return BeFunky.logError(t),void UIToggler.toggleLoadScreen(!1);if(r.includes("data:image")||(r="data:image/png;base64,".concat(r)),i)return n(r);var a=new Image;a.onload=function(){var e=new PIXI.Texture(new PIXI.BaseTexture(a)),t=PIXI.RenderTexture.create(e.width,e.height);t.copyPixels(e),e.destroyGC(!0),e=null,n(t)},a.src=r})}}]),e}();BFN.SingletonQueue.add(function(){BFN.OverlaysItemLoader=new qt});var Kt=function(){function e(){i(this,e)}return a(e,[{key:"getPotRenderTarget",value:function(){BFN.Stage.filterManager.getPotRenderTarget=function(e,t,n,i){var r=(65535&(t*=i))<<16|65535&(n*=i);BFN.Stage.filterManager.pool[r]||(BFN.Stage.filterManager.pool[r]=[]);var a=BFN.Stage.filterManager.pool[r].pop();if(!a){var o=BFN.Stage.filterManager.renderer.boundTextures[0];e.activeTexture(e.TEXTURE0),a=new PIXI.RenderTarget(e,t,n,null,1),e.bindTexture(e.TEXTURE_2D,o._glTextures[BFN.Stage.CONTEXT_UID].texture)}return a.resolution=i,a.defaultFrame.width=a.size.width=t/i,a.defaultFrame.height=a.size.height=n/i,a}}}]),e}();function Qt(){BFN.EventDispatcher.call(this),this.init()}for(var Zt in BFN.FilterManagerOverrider=new Kt,Qt.prototype=Object.create(BFN.EventDispatcher.prototype),Qt.prototype.init=function(){BeFunky.log("FlashProjectParser Init"),this.initDefaultValues()},Qt.prototype.initDefaultValues=function(){this.blendModeMap={add:BFN.CONST.BLEND_MODES.ADD,alpha:BFN.CONST.BLEND_MODES.ALPHA,darken:BFN.CONST.BLEND_MODES.DARKEN,difference:BFN.CONST.BLEND_MODES.DIFFERENCE,erase:BFN.CONST.BLEND_MODES.ERASE,hardlight:BFN.CONST.BLEND_MODES.HARD_LIGHT,invert:BFN.CONST.BLEND_MODES.DIFFERENCE,layer:BFN.CONST.BLEND_MODES.NORMAL,lighten:BFN.CONST.BLEND_MODES.LIGHTEN,multiply:BFN.CONST.BLEND_MODES.MULTIPLY,normal:BFN.CONST.BLEND_MODES.NORMAL,overlay:BFN.CONST.BLEND_MODES.OVERLAY,screen:BFN.CONST.BLEND_MODES.SCREEN,shader:BFN.CONST.BLEND_MODES.NORMAL,subtract:BFN.CONST.BLEND_MODES.SUBTRACT},this.projectVO=null,this.callback=null,this.itemOffsetX=0,this.itemOffsetY=0,this.templateElementSvgData=null,this.templateElementStates=null,this.templateElementStatesArray=[],this.queuedTemplateElementStates=[],this.designerElementSvgData=null,this.designerElementStates=null,this.designerElementStatesArray=[],this.transformImageStates=[],this.transformMaskImageStates=null,this.queuedTransformMaskImageStates=[],this.transformLabelStates=null},Qt.prototype.parseFlashProject=function(e,t){if(this.projectVO)return BeFunky.logError("Already Parsing Project"),null;if("1.0"!=e.version)return BeFunky.logError("Project Already Parsed"),null;if(UIToggler.toggleLoadScreen(!0,{isCancellable:!1}),this.projectVO=new BFN.ProjectVO,this.projectVO.version=2,this.projectVO.section="designer",this.projectVO.sourceTemplateID=e.hasOwnProperty("sourceTemplateID")?e.sourceTemplateID:null,this.projectVO.projectWidth=e.sourceTemplateWidth,this.projectVO.projectHeight=e.sourceTemplateHeight,this.projectVO.designerBackgroundColor=e.sourceTemplateBackgroundColor.toString(16),this.callback=t,this.itemOffsetX=-this.projectVO.projectWidth/2,this.itemOffsetY=-this.projectVO.projectHeight/2,e.sourceTemplate){if(e.sourceTemplate.hasOwnProperty("templateElementSvgData"))for(var n in e.hasOwnProperty("templateElementSvgData")||(e.templateElementSvgData={}),e.templateElementStates)if(e.sourceTemplate.templateElementStates.hasOwnProperty(n))for(var i=e.sourceTemplate.templateElementStates[n],r=e.templateElementStates[n],a=0;a<r.length;a++)if(a<i.length){var o=i[a],s=r[a];if(o.hasOwnProperty("graphicSvgShapeData")){for(var l=0;l<o.graphicSvgShapeData.length;l++){var u=o.graphicSvgShapeData[l].svgID;e.sourceTemplate.templateElementSvgData.hasOwnProperty(u)&&!e.templateElementSvgData.hasOwnProperty(u)&&(e.templateElementSvgData[u]=e.sourceTemplate.templateElementSvgData[u])}s.graphicSvgShapeData=o.graphicSvgShapeData}}for(var c=0;c<e.transformMaskImageStates.length;c++){var h=e.transformMaskImageStates[c];if(h.maskImageURL&&h.maskImageBase64&&(h.maskImageOriginalTemplateID=null),h.maskImageOriginalTemplateID)for(var d=0;d<e.sourceTemplate.transformMaskImageStates.length;d++){var m=e.sourceTemplate.transformMaskImageStates[d];m.maskImageOriginalTemplateID&&m.maskImageOriginalTemplateID==h.maskImageOriginalTemplateID&&m.maskImageBase64&&(h.maskImageBase64=m.maskImageBase64)}}}for(var p in this.templateElementSvgData=e.templateElementSvgData,this.templateElementStates=e.templateElementStates,this.templateElementStatesArray.splice(0),this.queuedTemplateElementStates.splice(0),this.templateElementStates)for(var g=this.templateElementStates[p],f=0;f<g.length;f++)g[f].svgID=p+"_"+f,this.templateElementStatesArray.push(g[f]),this.queuedTemplateElementStates.push(g[f]);for(var v in this.designerElementSvgData=e.designerElementSvgData,this.designerElementStates=e.designerElementStates,this.designerElementStatesArray.splice(0),this.designerElementStates)for(var y in this.designerElementStates[v])if(this.designerElementSvgData.hasOwnProperty(y))for(var x=this.designerElementStates[v][y],_=0;_<x.length;_++)x[_].svgID=y,this.designerElementStatesArray.push(x[_]);this.transformImageStates.splice(0),this.transformMaskImageStates=e.transformMaskImageStates,this.queuedTransformMaskImageStates.splice(0);for(var I=0;I<this.transformMaskImageStates.length;I++)this.queuedTransformMaskImageStates.push(this.transformMaskImageStates[I]);this.transformLabelStates=e.transformLabelStates,this.processQueuedTemplateElementStates()},Qt.prototype.processQueuedTemplateElementStates=function(){if(this.queuedTemplateElementStates.length){var e=this.queuedTemplateElementStates.shift();if(e.graphicSvgShapeData&&e.graphicSvgShapeData.length){for(var t=null,n=e.graphicSvgShapeData.length;--n>-1;){var i=e.graphicSvgShapeData[n];if(i.hasOwnProperty("svgImage")){t=i;break}}if(t){e.graphicSvgShapeData.splice(0),e.graphicSvgShapeData=null,delete e.graphicSvgShapeData,e.imageID=t.svgID,e.imageBase64=t.svgImage;for(var r=0;r<this.templateElementStatesArray.length;r++){if(this.templateElementStatesArray[r]==e){this.templateElementStatesArray.splice(r,1);break}}this.transformImageStates.push(e),this.processQueuedTemplateElementStates()}else BFN.SVGManager.combineSVGs(e.graphicSvgShapeData,this.templateElementSvgData,function(t){if(t)e.svgID=t;else{var n=this.templateElementStates.indexOf(e);-1!=n&&this.templateElementStates.splice(n,1)}this.processQueuedTemplateElementStates()}.bind(this))}else this.processQueuedTemplateElementStates()}else this.processQueuedTransformMaskImageStates()},Qt.prototype.processQueuedTransformMaskImageStates=function(){if(this.queuedTransformMaskImageStates.length){var e=this.queuedTransformMaskImageStates.shift();if(e.hasOwnProperty("maskImageMaskSvgShapeData")){var t=e.maskImageMaskSvgShapeData;t&&t.length?BFN.SVGManager.combineSVGs(t,this.templateElementSvgData,function(t){if(t)e.maskSvgID=t;else{var n=this.transformMaskImageStates.indexOf(e);-1!=n&&this.transformMaskImageStates.splice(n,1)}this.processQueuedTemplateElementStates()}.bind(this),!0,!0):this.processQueuedTransformMaskImageStates()}else this.processQueuedTransformMaskImageStates()}else this.buildProjectVO()},Qt.prototype.buildProjectVO=function(){if(this.projectVO&&this.callback){for(var e in this.designerElementSvgData)this.projectVO.svgData.hasOwnProperty(e)||(this.projectVO.svgData[e]=this.designerElementSvgData[e]);for(var t in BFN.SVGManager.cachedCombinedSVGs)this.projectVO.svgData.hasOwnProperty(t)||(this.projectVO.svgData[t]=BFN.SVGManager.cachedCombinedSVGs[t]);BFN.SVGManager.clearCache();for(var n=0;n<this.templateElementStatesArray.length;n++){var i=this.templateElementStatesArray[n],r=new BFN.ProjectItemVO;r.type="graphic",r.graphicID=i.svgID,this.transferTransformProperties(r,i),this.projectVO.transformGraphics.push(r)}for(var a=0;a<this.designerElementStatesArray.length;a++){var o=this.designerElementStatesArray[a],s=new BFN.ProjectItemVO;s.type="graphic",s.graphicID=o.svgID,this.transferTransformProperties(s,o),this.projectVO.transformGraphics.push(s)}for(var l=0;l<this.transformImageStates.length;l++){var u=this.transformImageStates[l],c=null;if(u.hasOwnProperty("imageID")&&null!=u.imageID&&(c="image_"+BeFunky.hash(u.imageID).toString(36)),c&&u.imageBase64){this.projectVO.imageData.hasOwnProperty(c)||(this.projectVO.imageData[c]=u.imageBase64);var h=new BFN.ProjectItemVO;h.type="image",h.imageID=c,this.transferTransformProperties(h,u),this.projectVO.transformImages.push(h)}}for(var d=0;d<this.transformMaskImageStates.length;d++){var m=this.transformMaskImageStates[d],p=null;if(m.hasOwnProperty("maskImageOriginalTemplateID")&&null!=m.maskImageOriginalTemplateID?p="mask_image_"+BeFunky.hash(m.maskImageOriginalTemplateID).toString(36):m.hasOwnProperty("maskImageURL")&&null!=m.maskImageURL&&(p="mask_image_"+BeFunky.hash(m.maskImageURL).toString(36)),p&&m.maskImageBase64){this.projectVO.imageData.hasOwnProperty(p)||(this.projectVO.imageData[p]=m.maskImageBase64);var g=new BFN.ProjectItemVO;g.type="mask_image",g.maskImageID=p,g.maskImageFlashVars={},g.maskImageFlashVars.maskImageX=m.maskImageBitmapX,g.maskImageFlashVars.maskImageY=m.maskImageBitmapY,g.maskImageFlashVars.maskImageScaleX=m.maskImageBitmapScaleX,g.maskImageFlashVars.maskImageScaleY=m.maskImageBitmapScaleY,g.maskImageFlashVars.maskImageWidth=m.maskImageItemWidth,g.maskImageFlashVars.maskImageHeight=m.maskImageItemHeight,m.hasOwnProperty("maskSvgID")&&(g.maskImageMaskID=m.maskSvgID),this.transferTransformProperties(g,m),this.projectVO.transformMaskImages.push(g)}}for(var f=0;f<this.transformLabelStates.length;f++){var v=this.transformLabelStates[f],y=new BFN.ProjectItemVO;y.type="label",y.labelText=v.labelText,y.labelTextStyles=v.labelTextStyles,y.labelWidth=Math.ceil(v.labelWidth)+2;var x=(y.labelWidth+BFN.TransformItemTextBaseFontSize)*v.scale;if(y.labelTextScale=x>BFN.maxImageSize?BFN.maxImageSize/y.labelWidth:v.scale,y.labelTextItemScale=x>BFN.maxImageSize?x/BFN.maxImageSize:1,v.hasOwnProperty("accurateBounds")&&v.accurateBounds)y.labelBounds=new BFN.Rectangle(v.accurateBounds.x+this.itemOffsetX,v.accurateBounds.y+this.itemOffsetY,v.accurateBounds.width,v.accurateBounds.x.height);else{var _=v.rotation*(Math.PI/180),I={distance:5*v.scale,direction:Math.PI/4+_};if(y.positionOffsetVectors=[I],y.labelText.length&&y.labelTextStyles.styles[0]&&y.labelTextStyles.styles[0][0]){var T=y.labelTextStyles.styles[0][0],b={distance:2*v.scale,direction:Math.PI/4+_};if(y.positionOffsetVectors.push(b),T.hasOwnProperty("fontFamily")&&T.hasOwnProperty("fontSize")&&BFN.FontOffsetVectors.hasOwnProperty(T.fontFamily)){var S=BFN.FontOffsetVectors[T.fontFamily],C=S.distance/100*(T.fontSize*v.scale),B=S.direction+_;y.positionOffsetVectors.push({distance:C,direction:B})}else console.log(T.fontFamily+" not found in BFN.FontOffsetVectors, Final Offset Not Applied : "+y.labelText)}}this.transferTransformProperties(y,v),this.projectVO.transformLabels.push(y)}UIToggler.toggleLoadScreen(!1),this.callback(this.projectVO),this.projectVO=null}},Qt.prototype.transferTransformProperties=function(e,t){e.transformZIndex=t.zIndex,e.transformLocked=t.locked,e.transformX=t.x+this.itemOffsetX,e.transformY=t.y+this.itemOffsetY,e.transformRotation=t.rotation*(Math.PI/180),e.transformScale=t.scale,e.transformScaleX=t.scaleX,e.transformScaleY=t.scaleY,e.transformFlippedHorizontal=t.flippedHorizontal,e.transformFlippedVertical=t.flippedVertical,e.transformOpacity=t.opacity,e.transformBlendMode=this.blendModeMap.hasOwnProperty(t.blendMode)?this.blendModeMap[t.blendMode]:BFN.CONST.BLEND_MODES.NORMAL,e.transformOverlayColor=t.tintColorEnabled?t.tintColor.toString(16):-1,e.transformOverlayColorIntensity=t.tintColorEnabled?t.tintMultiplier:0,e.transformTintColor=-1},BFN.SingletonQueue.add(function(){BFN.FlashProjectParser=new Qt}),BFN.UIMenuData={mainMenus:{editor:[{id:"editor_main_image_manager",name:"image_manager",icon:"image-icon"},{id:"editor_main_edit",name:"edit",icon:"edit-icon"},{id:"editor_main_touch_up",name:"touchup",icon:"touchup-icon"},{id:"editor_main_effect",name:"effects",icon:"effects-icon"},{id:"editor_main_artsy",name:"artsy",icon:"artsy-icon"},{id:"editor_main_frame",name:"frames",icon:"frames-icon"},{id:"editor_main_graphic",name:"graphics",icon:"graphics-icon"},{id:"editor_main_overlay",name:"overlays",icon:"overlays-icon"},{id:"editor_main_text",name:"text",icon:"text-icon"},{id:"editor_main_texture",name:"textures",icon:"textures-icon"}],collage:[{id:"collage_main_image_manager",name:"image_manager",icon:"image-icon"},{id:"collage_main_customize",name:"customize",icon:"edit-horizontal-icon"},{id:"collage_main_layouts",name:"layouts",icon:"layouts-icon"},{id:"collage_main_patterns",name:"patterns",icon:"patterns-icon"},{id:"collage_main_graphic",name:"graphics",icon:"graphics-icon"},{id:"collage_main_text",name:"text",icon:"text-icon"}],designer:[{id:"designer_main_image_manager",name:"image_manager",icon:"image-icon"},{id:"designer_main_customize",name:"customize",icon:"edit-horizontal-icon"},{id:"designer_main_templates",name:"templates",icon:"templates-icon"},{id:"designer_main_graphic",name:"graphics",icon:"graphics-icon"},{id:"designer_main_text",name:"text",icon:"text-icon"}]},accordionMenus:{editor_edit:[{name:"enhance_dlx",isOpen:!1,items:[{id:"editor_edit_hdr_dlx",name:"HDR DLX",icon:"hdr-dlx-icon",isPlus:!0},{id:"editor_edit_sharpen_dlx",name:"Sharpen DLX",icon:"sharpen-dlx-icon",isPlus:!0},{id:"editor_edit_vibrant_colors_dlx",name:"Vibrant Colors DLX",icon:"vibrant-colors-dlx-icon",isPlus:!0},{id:"editor_edit_denoise_dlx",name:"Denoise DLX",icon:"denoise-dlx-icon",isPlus:!0}]},{name:"essentials",items:[{id:"editor_edit_crop",name:"crop",icon:"crop-icon",iconStroke:!1},{id:"editor_edit_resize",name:"resize",icon:"resize-icon"},{id:"editor_edit_rotate",name:"rotate",icon:"rotate-icon"},{id:"editor_edit_cutout",name:"cutout",icon:"cutout-icon",isPlus:!0},{id:"editor_edit_background",name:"background",icon:"background-icon",isPlus:!0},{id:"editor_edit_replace_color",name:"replace_color",icon:"color-picker-icon",isPlus:!0},{id:"editor_edit_exposure",name:"exposure",icon:"exposure-icon"},{id:"editor_edit_fill_light",name:"fill_light",icon:"fill-light-icon",isPlus:!0},{id:"editor_edit_auto_enhance",name:"auto_enhance",icon:"auto-enhance-icon",isPlus:!0},{id:"editor_edit_beautify",name:"beautify",icon:"beautify-icon"},{id:"editor_edit_color",name:"color",icon:"color-icon"},{id:"editor_edit_vibrance",name:"vibrance",icon:"vibrance-icon",isPlus:!0},{id:"editor_edit_sharpen",name:"sharpen",icon:"sharpen-icon"},{id:"editor_edit_clarity",name:"clarity",icon:"clarity-icon",isPlus:!0},{id:"editor_edit_glow",name:"glow",icon:"glow-icon",isPlus:!0},{id:"editor_edit_funky_vignette",name:"vignette",icon:"vignette-icon",isPlus:!0}]},{name:"blur_and_smooth",items:[{id:"editor_edit_smoothing",name:"smoothing",icon:"smoothing-icon"},{id:"editor_edit_blur",name:"blur",icon:"blur-icon"},{id:"editor_edit_lens_blur",name:"lens_blur",icon:"lens-blur-icon",isPlus:!0},{id:"editor_edit_funky_focus",name:"funky_focus",icon:"funky-focus-icon",isPlus:!0},{id:"editor_edit_soften",name:"soften",icon:"soften-icon"},{id:"editor_edit_blur_edges",name:"blur_edges",icon:"blur-edges-icon"}]},{name:"miscellaneous",items:[{id:"editor_edit_tilt",name:"tilt",icon:"tilt-icon"},{id:"editor_edit_tint",name:"tint",icon:"tint-icon"},{id:"editor_edit_levels",name:"levels",icon:"levels-icon",isPlus:!0},{id:"editor_edit_color_mixer",name:"color_mixer",icon:"color-mixer-icon"}]}],editor_touch_up:[{name:"skin",items:[{id:"editor_touch_up_perfectskin",name:"skin_heal",icon:"perfect-skin-icon",isPlus:!0},{id:"editor_touch_up_wrinkles",name:"wrinkles",icon:"wrinkles-icon",isPlus:!0},{id:"editor_touch_up_blemish_fix",name:"blemish_fix",icon:"blemish-fix-icon"},{id:"editor_touch_up_bronzer",name:"bronzer",icon:"bronzer-icon",isPlus:!0},{id:"editor_touch_up_blush",name:"blush",icon:"blush-icon"},{id:"editor_touch_up_flashspot",name:"flashspot",icon:"flash-spot-icon",isPlus:!0},{id:"editor_touch_up_clone",name:"clone",icon:"clone-icon",isPlus:!0}]},{name:"eyes",items:[{id:"editor_touch_up_mascara",name:"mascara",icon:"mascara-icon",isPlus:!0},{id:"editor_touch_up_eye_color",name:"eye_color",icon:"eye-color-icon",isPlus:!0},{id:"editor_touch_up_eye_brighten",name:"eye_brighten",icon:"eye-brighten-icon",isPlus:!0},{id:"editor_touch_up_eyebrow_pencil",name:"eyebrow_pencil",icon:"eyebrow-pencil-icon",isPlus:!0},{id:"editor_touch_up_fix_redeye",name:"fix_redeye",icon:"fix-red-eye-icon"}]},{name:"mouth",items:[{id:"editor_touch_up_lipstick",name:"lipstick",icon:"lipstick-icon",isPlus:!0},{id:"editor_touch_up_teeth_whiten",name:"teeth_whiten",icon:"teeth-whiten-icon"}]},{name:"miscellaneous",items:[{id:"editor_touch_up_hair_color",name:"hair_color",icon:"hair-color-icon",isPlus:!0},{id:"editor_touch_up_reshape",name:"reshape",icon:"reshape-icon",isPlus:!0},{id:"editor_touch_up_paint_brush",name:"paint_brush",icon:"paintbrush-icon"},{id:"editor_touch_up_slimming",name:"slimming",icon:"slimming-icon",isPlus:!0}]}]},categoryMenus:{editor_effect:[{id:"editor_effect_effect_featured",name:"Featured",icon:"featured-icon"},{id:"editor_effect_effect_favorites",name:"Favorites",icon:"favorite-star-fill-icon"},{id:"editor_effect_bwfx",name:"B&W Tones",imageName:"effect-v6"},{id:"editor_effect_warmfx",name:"Warmer Tones",imageName:"effect-v6"},{id:"editor_effect_analog",name:"Analog Tones",imageName:"effect-v6"},{id:"editor_effect_lens_flares",name:"Lens Flare",imageName:"effect-v6"},{id:"editor_effect_glitch_art",name:"Glitch Art",imageName:"effect-v6"},{id:"editor_effect_chromatic",name:"Chromatic",imageName:"effect-v6"},{id:"editor_effect_bw",name:"Black & White",imageName:"effect-v6"},{id:"editor_effect_charcoal",name:"Charcoal",imageName:"effect-v6"},{id:"editor_effect_cinematic",name:"Cinematic",imageName:"effect-v6"},{id:"editor_effect_colorpinhole",name:"Color Pinhole",imageName:"effect-v6"},{id:"editor_effect_cooler",name:"Cooler",imageName:"effect-v6"},{id:"editor_effect_crossprocess",name:"Cross Process",imageName:"effect-v6"},{id:"editor_effect_cyanotype",name:"Cyanotype",imageName:"effect-v6"},{id:"editor_effect_grungefx",name:"Grunge",imageName:"effect-v6"},{id:"editor_effect_hdr",name:"HDR",imageName:"effect-v6"},{id:"editor_effect_holgaart",name:"Holga Art",imageName:"effect-v6"},{id:"editor_effect_instant",name:"Instant",imageName:"effect-v6"},{id:"editor_effect_lineartopia",name:"Line Artopia",imageName:"effect-v6"},{id:"editor_effect_lomoart",name:"Lomo Art",imageName:"effect-v6"},{id:"editor_effect_motioncolor",name:"Motion Color",imageName:"effect-v6"},{id:"editor_effect_multimedia",name:"Multimedia",imageName:"effect-v6"},{id:"editor_effect_oldphotofx",name:"Old Photo",imageName:"effect-v6"},{id:"editor_effect_orton_style",name:"Orton Style",imageName:"effect-v6"},{id:"editor_effect_patrioticfx",name:"Patriotic",imageName:"effect-v6"},{id:"editor_effect_pinhole",name:"Pinhole",imageName:"effect-v6"},{id:"editor_effect_popartfx",name:"Pop Art",imageName:"effect-v6"},{id:"editor_effect_sepia",name:"Sepia",imageName:"effect-v6"},{id:"editor_effect_stenciler",name:"Stenciler",imageName:"effect-v6"},{id:"editor_effect_summer",name:"Summer",imageName:"effect-v6"},{id:"editor_effect_sunburst",name:"Sunburst",imageName:"effect-v6"},{id:"editor_effect_tiltshiftfx",name:"Tilt Shift",imageName:"effect-v6"},{id:"editor_effect_tinytype",name:"Tin Type",imageName:"effect-v6"},{id:"editor_effect_unitedcolors",name:"United Colors",imageName:"effect-v6"},{id:"editor_effect_warmer",name:"Warmer",imageName:"effect-v6"},{id:"editor_effect_viewfinder",name:"Viewfinder",imageName:"effect-v6"},{id:"editor_effect_vintagecolors",name:"Vintage Colors",imageName:"effect-v6"},{id:"editor_effect_winterfx",name:"Winter",imageName:"effect-v6"}].filter(Boolean),editor_artsy:[{id:"editor_artsy_artsy_favorites",name:"favorites",icon:"favorite-star-fill-icon"},{id:"editor_artsy_digitalart",name:"artsy_digital_art",imageName:"artsy-v4"},{id:"editor_artsy_cartoonizer",name:"artsy_cartoonizer",imageName:"artsy-v4"},{id:"editor_artsy_polyart",name:"artsy_poly_art",imageName:"artsy-v4"},{id:"editor_artsy_mosaic",name:"artsy_mosaic",imageName:"artsy-v4"},{id:"editor_artsy_pastel",name:"artsy_pastel",imageName:"artsy-v4"},{id:"editor_artsy_penart",name:"artsy_pen_art",imageName:"artsy-v4"},{id:"editor_artsy_gouache",name:"artsy_gouache",imageName:"artsy-v4"},{id:"editor_artsy_impressionist",name:"artsy_impressionist",imageName:"artsy-v4"},{id:"editor_artsy_inkify",name:"artsy_inkify",imageName:"artsy-v4"},{id:"editor_artsy_oilpainting",name:"artsy_oil_painting",imageName:"artsy-v4"},{id:"editor_artsy_pointillism",name:"artsy_pointillism",imageName:"artsy-v4"},{id:"editor_artsy_sketcher",name:"artsy_sketcher",imageName:"artsy-v4"},{id:"editor_artsy_underpainting",name:"artsy_underpainting",imageName:"artsy-v4"},{id:"editor_artsy_watercolor",name:"artsy_watercolor",imageName:"artsy-v4"}].filter(Boolean),editor_frame:[{id:"editor_frame_frame_featured",name:"featured",icon:"featured-icon"},{id:"editor_frame_frame_border",name:"frame_border",imageName:"frame-v2"},{id:"editor_frame_frame_drop_shadow",name:"frame_drop_shadow",imageName:"frame-v2"},{id:"editor_frame_frame_decorative",name:"frame_decorative",imageName:"frame-v2"},{id:"editor_frame_frame_vintage",name:"frame_vintage",imageName:"frame-v2"},{id:"editor_frame_frame_art_deco",name:"frame_art_deco",imageName:"frame-v2"},{id:"editor_frame_frame_floral",name:"frame_floral",imageName:"frame-v2"},{id:"editor_frame_frame_rustic",name:"frame_rustic",imageName:"frame-v2"},{id:"editor_frame_frame_lace",name:"frame_lace",imageName:"frame-v2"},{id:"editor_frame_frame_ornament",name:"frame_ornament",imageName:"frame-v2"},{id:"editor_frame_frame_hand_drawn",name:"frame_hand_drawn",imageName:"frame-v2"},{id:"editor_frame_frame_instant",name:"frame_instant",imageName:"frame-v2"},{id:"editor_frame_frame_grunge",name:"frame_grunge",imageName:"frame-v2"},{id:"editor_frame_frame_filmstrip",name:"frame_film_strip",imageName:"frame-v2"},{id:"editor_frame_frame_realistic",name:"frame_realistic",imageName:"frame-v2"}],editor_overlay:[{id:"editor_overlay_featured",name:"featured",icon:"featured-icon"},{id:"editor_overlay_circular",name:"overlay_circular",imageName:"overlay-v2"},{id:"editor_overlay_brushes",name:"overlay_brushes",imageName:"overlay-v2"},{id:"editor_overlay_floral",name:"overlay_floral",imageName:"overlay-v2"},{id:"editor_overlay_holiday_earth_day",name:"overlay_earth_day",imageName:"overlay-v2"},{id:"editor_overlay_geometry",name:"overlay_geometry",imageName:"overlay-v2"},{id:"editor_overlay_a_z",name:"overlay_alphabet",imageName:"overlay-v2"},{id:"editor_overlay_animals",name:"overlay_animals",imageName:"overlay-v2"},{id:"editor_overlay_hearts",name:"overlay_hearts",imageName:"overlay-v2"},{id:"editor_overlay_halloween",name:"overlay_halloween",imageName:"overlay-v2"},{id:"editor_overlay_st_patricks_day",name:"overlay_st_patricks_day",imageName:"overlay-v2"},{id:"editor_overlay_valentines_day",name:"overlay_valentines_day",imageName:"overlay-v2"},{id:"editor_overlay_numbers",name:"overlay_numbers",imageName:"overlay-v2"},{id:"editor_overlay_patterns",name:"overlay_patterns",imageName:"overlay-v2"},{id:"editor_overlay_sports",name:"overlay_sports",imageName:"overlay-v2"},{id:"editor_overlay_symbols",name:"overlay_symbols",imageName:"overlay-v2"},{id:"editor_overlay_winter_holidays",name:"overlay_winter_holidays",imageName:"overlay-v2"}],editor_text:[],editor_texture:[{id:"editor_texture_texture_featured",name:"featured",icon:"featured-icon"},{id:"editor_texture_bokeh",name:"texture_bokeh",imageName:"textures-v2"},{id:"editor_texture_scratches",name:"texture_scratches",imageName:"textures-v2"},{id:"editor_texture_light",name:"texture_light_trails",imageName:"textures-v2"},{id:"editor_texture_lightleak",name:"texture_light_leaks",imageName:"textures-v2"},{id:"editor_texture_fabric",name:"texture_fabric",imageName:"textures-v2"},{id:"editor_texture_grunge",name:"texture_grunge",imageName:"textures-v2"},{id:"editor_texture_paint",name:"texture_paint",imageName:"textures-v2"},{id:"editor_texture_metal",name:"texture_metal",imageName:"textures-v2"},{id:"editor_texture_bricks",name:"texture_bricks",imageName:"textures-v2"},{id:"editor_texture_paper",name:"texture_paper",imageName:"textures-v2"}],collage_layouts:[{id:"collage_layouts_featured",name:"Featured",icon:"featured-icon"},{id:"collage_layouts_grid",name:"Grid",icon:"collage-grid-icon"},{id:"collage_layouts_big_photo_wrap",name:"Big Photo Wrap",icon:"collage-photo-wrap-icon"},{id:"collage_layouts_shape",name:"Shape",icon:"collage-shape-icon"},{id:"collage_layouts_facebook",name:"Facebook Cover",icon:"facebook-social-icon"},{id:"collage_layouts_pinterest",name:"Pinterest",icon:"pinterest-circle-icon"}],collage_patterns:[{id:"collage_patterns_featured",name:"featured",icon:"featured-icon"},{id:"collage_patterns_autumn",name:"pattern_autumn",imageName:"pattern-v2"},{id:"collage_patterns_fabric",name:"pattern_fabric",imageName:"pattern-v2"},{id:"collage_patterns_fancy",name:"pattern_fancy",imageName:"pattern-v2"},{id:"collage_patterns_geometric",name:"pattern_geometric",imageName:"pattern-v2"},{id:"collage_patterns_polka_dots",name:"pattern_polka_dots",imageName:"pattern-v2"},{id:"collage_patterns_stripes",name:"pattern_stripes",imageName:"pattern-v2"},{id:"collage_patterns_summer",name:"pattern_summer",imageName:"pattern-v2"},{id:"collage_patterns_love",name:"pattern_love",imageName:"pattern-v2"},{id:"collage_patterns_winter",name:"pattern_winter",imageName:"pattern-v2"}]}},BFN.accordionMenuPlusIDs=[],BFN.UIMenuData.accordionMenus)for(var Jt=BFN.UIMenuData.accordionMenus[Zt],$t=0;$t<Jt.length;$t++)for(var en=Jt[$t],tn=0;tn<en.items.length;tn++){var nn=en.items[tn];nn.hasOwnProperty("isPlus")&&nn.isPlus&&BFN.accordionMenuPlusIDs.push(nn.id.replace("".concat(Zt,"_"),""))}var rn,an=["dark","light"],on=(rn=BeFunky.getLocal("app_theme"),an.includes(rn)?rn:an[0]);function sn(){return on}var ln=[];function un(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];ln.push(e),t&&e(on)}un(function(e){BeFunky.setLocal("app_theme",e),window.isAppOpen&&BeFunky.updateThemeColor("app")}),BFN.getTheme=sn;var cn,hn=[{name:"dark",hex:1842470},{name:"light",hex:16448250}],dn=(cn=BeFunky.getLocal("app_canvas_bg"),hn.find(function(e){var t=e.name;return t===cn})||hn[0]);function mn(){return dn}var pn=[];function gn(e){pn.push(e)}for(var fn in gn(function(e){var t=e.name;return BeFunky.setLocal("app_canvas_bg",t)}),BFN.getCanvasBgColor=mn,BFN.DropDownData={blendModes:[{name:"normal",value:BFN.CONST.BLEND_MODES.NORMAL},{name:"overlay",value:BFN.CONST.BLEND_MODES.OVERLAY},{name:"soft_light",value:BFN.CONST.BLEND_MODES.SOFT_LIGHT},{name:"multiply",value:BFN.CONST.BLEND_MODES.MULTIPLY},{name:"screen",value:BFN.CONST.BLEND_MODES.SCREEN},{name:"add",value:BFN.CONST.BLEND_MODES.ADD,hasDivider:!0},{name:"lighten",value:BFN.CONST.BLEND_MODES.LIGHTEN},{name:"darken",value:BFN.CONST.BLEND_MODES.DARKEN},{name:"color_dodge",value:BFN.CONST.BLEND_MODES.COLOR_DODGE},{name:"color_burn",value:BFN.CONST.BLEND_MODES.COLOR_BURN},{name:"linear_burn",value:BFN.CONST.BLEND_MODES.LINEAR_BURN,hasDivider:!0},{name:"hard_light",value:BFN.CONST.BLEND_MODES.HARD_LIGHT},{name:"vivid_light",value:BFN.CONST.BLEND_MODES.VIVID_LIGHT},{name:"linear_light",value:BFN.CONST.BLEND_MODES.LINEAR_LIGHT},{name:"pin_light",value:BFN.CONST.BLEND_MODES.PIN_LIGHT,hasDivider:!0},{name:"difference",value:BFN.CONST.BLEND_MODES.DIFFERENCE},{name:"exclusion",value:BFN.CONST.BLEND_MODES.EXCLUSION},{name:"subtract",value:BFN.CONST.BLEND_MODES.SUBTRACT},{name:"color",value:BFN.CONST.BLEND_MODES.COLOR},{name:"hue",value:BFN.CONST.BLEND_MODES.HUE},{name:"luminosity",value:BFN.CONST.BLEND_MODES.LUMINOSITY}],languages:BeFunky.LanguageManager.getLanguageNames().map(function(e){var t=e.id;return{name:e.name,value:t}}),cropAspectRatios:[{name:"freeform",value:"freeform"},{name:"original_ratio",value:"original_ratio"},{name:"golden_ratio",value:"golden_ratio"},{name:"square_1x1",value:"square_1x1"},{name:"photo_4x6",value:"photo_4x6"},{name:"photo_5x7",value:"photo_5x7"},{name:"photo_8x10",value:"photo_8x10"},{name:"photo_11x14",value:"photo_11x14"},{name:"photo_16x9",value:"photo_16x9"},{name:"image_3x2",value:"image_3x2"},{name:"image_4x3",value:"image_4x3"},{name:"cinema_1_375x1",value:"cinema_1_375x1"},{name:"cinema_1_85x1",value:"cinema_1_85x1"},{name:"cinema_2_20x1",value:"cinema_2_20x1"},{name:"facebook_cover",value:"facebook_cover"},{name:"photo_twitter",value:"photo_twitter"},{name:"photo_youtube_cover",value:"photo_youtube_cover"},{name:"photo_pinterest_pin",value:"photo_pinterest_pin"}],batchResizeOptions:[{name:"scale",value:"scale"},{name:"longest_side",value:"longest_side"},{name:"width",value:"width"},{name:"height",value:"height"},{name:"exact_size",value:"exact_size"}],resizeTemplateSizes:[{name:"Freeform",value:"freeform"},{name:"social_media",isHeader:!0},{name:"Presentation (4:3)",description:"1024 x 768px",value:"1024 x 768"},{name:"Presentation (16:9)",description:"1920 x 1080px",value:"1920 x 1080"},{name:"Social Media Story",description:"1080 x 1920px",value:"1080 x 1920"},{name:"Instagram Post",description:"1080 x 1080px",value:"1080 x 1080"},{name:"Facebook Post",description:"1200 x 1200px",value:"1200 x 1200"},{name:"Facebook Cover",description:"1702 x 630px",value:"1702 x 630"},{name:"Facebook Page Cover",description:"1640 x 624px",value:"1640 x 624"},{name:"Facebook Event Cover",description:"1920 x 1080px",value:"1920 x 1080(2)"},{name:"YouTube Channel Art",description:"2560 x 1440px",value:"2560 x 1440"},{name:"YouTube Thumbnail",description:"1280 x 720px",value:"1280 x 720"},{name:"Twitter Post",description:"1200 x 675px",value:"1200 x 675"},{name:"Twitter Header",description:"1500 x 500px",value:"1500 x 500"},{name:"Pinterest Pin",description:"1000 x 1500px",value:"1000 x 1500"},{name:"Etsy Big Banner",description:"3360 x 840px",value:"3360 x 840"},{name:"Etsy Mini Banner",description:"3360 x 448px",value:"3360 x 448"},{name:"Etsy Order Receipt Banner",description:"760 x 100px",value:"760 x 100"},{name:"print",isHeader:!0},{name:"Square",description:'11 x 11"',value:"3300 x 3300"},{name:"Business Card",description:'3.5 x 2"',value:"1050 x 600"},{name:"Thank You Card",description:'5 x 3"',value:"1500 x 900"},{name:"Postcard",description:'6 x 4"',value:"1800 x 1200"},{name:"Greeting Card",description:'7 x 5"',value:"2100 x 1500"},{name:"Half Letter",description:'5.5 x 8.5"',value:"1650 x 2550"},{name:"Rack Card",description:"4 x 9",value:"1200 x 2700"},{name:"Letter",description:'8.5 x 11"',value:"2550 x 3300"},{name:"A4",description:"21 x 29.7cm",value:"2481 x 3507"},{name:"Poster",description:'11 x 17"',value:"2640 x 4080"},{name:"online_advertising",isHeader:!0},{name:"Facebook Ad",description:"1200 x 628px",value:"1200 x 628"},{name:"Skyscraper",description:"120 x 600px",value:"120 x 600"},{name:"Wide Skyscraper",description:"160 x 600px",value:"160 x 600"},{name:"Leaderboard",description:"728 x 90px",value:"728 x 90"},{name:"Large Leaderboard",description:"728 x 210px",value:"728 x 210"},{name:"Medium Rectangle",description:"300 x 250px",value:"300 x 250"},{name:"Large Rectangle",description:"336 x 280px",value:"336 x 280"},{name:"Half Page",description:"300 x 600px",value:"300 x 600"},{name:"Large Mobile",description:"320 x 100px",value:"320 x 100"}],autosaveOptions:[{name:"autosave_yes",value:"yes"},{name:"autosave_no",value:"no"},{name:"ask_me",value:"ask"}],addTextModes:[{name:"after_name",value:"after"},{name:"before_name",value:"before"}],watermarkPlacements:[{name:"top_left",value:"tl"},{name:"top_center",value:"tc"},{name:"top_right",value:"tr"},{name:"middle_left",value:"ml"},{name:"middle_center",value:"mc"},{name:"middle_right",value:"mr"},{name:"bottom_left",value:"bl"},{name:"bottom_center",value:"bc"},{name:"bottom_right",value:"br"}],noise_distributions:[{name:"uniform",value:1},{name:"triangular",value:2},{name:"gaussian",value:3},{name:"gaussian_plus",value:4}]},BFN.CropRatioMap={freeform:-1,original_ratio:-1,golden_ratio:1/1.61803398875,square_1x1:1,photo_4x6:4/6,photo_5x7:5/7,photo_8x10:.8,photo_11x14:11/14,photo_16x9:9/16,image_3x2:2/3,image_4x3:.75,cinema_1_375x1:1/1.375,cinema_1_85x1:1/1.85,cinema_2_20x1:1/2.2,facebook_cover:315/851,photo_twitter:500/1500,photo_youtube_cover:.5625,photo_pinterest_pin:735/1102},BFN.UIToolData={app_goto:{controls:{app_goto_photo_editor:{type:"button"},app_goto_collage_maker:{type:"button"},app_goto_designer:{type:"button"},app_goto_edit_source_section:{type:"button"}}},editor_load_image:{controls:{editor_load_image_computer:{type:"button",allowEvent:!0},editor_load_image_befunky:{type:"button",allowEvent:!0},editor_load_image_google_drive:{type:"button",allowEvent:!0},editor_load_image_google_photos:{type:"button",allowEvent:!0},editor_load_image_stock_images:{type:"button",allowEvent:!0},editor_load_image_facebook:{type:"button",allowEvent:!0},editor_load_image_dropbox:{type:"button",allowEvent:!0},editor_load_image_webcam:{type:"button",allowEvent:!0}}},designer_open:{controls:{designer_open_blank_canvas:{type:"button",allowEvent:!0},designer_open_template:{type:"button",allowEvent:!0}}},open_project:{controls:{open_project_computer:{type:"button",allowEvent:!0},open_project_befunky:{type:"button"}}},editor_save_image:{controls:{editor_save_image_computer:{type:"button",allowEvent:!0},editor_save_image_befunky:{type:"button",allowEvent:!0},editor_save_image_google_drive:{type:"button",allowEvent:!0},editor_save_image_google_photos:{type:"button",allowEvent:!0},editor_save_image_dropbox:{type:"button",allowEvent:!0},editor_save_image_project:{type:"button",allowEvent:!0},editor_save_image_facebook:{type:"button",allowEvent:!0},editor_save_image_pinterest:{type:"button",allowEvent:!0},editor_save_image_twitter:{type:"button",allowEvent:!0}}},editor_history_action:{controls:{editor_history_action_undo:{type:"button"},editor_history_action_redo:{type:"button"},editor_history_action_reset:{type:"button"}}},user_account:{ignoreInitialControlRegister:!0,controls:{user_account_upgrade:{type:"button"},user_account_sign_in:{type:"button"},user_account_sign_up:{type:"button"},user_account_logout:{type:"button"},user_account_settings:{type:"button"},user_account_feedback:{type:"button"},user_account_canvas_bg_color:{type:"button"},user_account_theme:{type:"button"}}},user_settings:{controls:{user_settings_autosave:{type:"dropdown_item",name:"autosave",data:BFN.DropDownData.autosaveOptions,defaultValue:"ask",useLabel:!1},user_settings_theme_color:{type:"radio",defaultValue:sn(),buttons:[{value:"dark",langID:"theme_dark"},{value:"light",langID:"theme_light"}]},user_settings_canvas_bg_color:{type:"radio",defaultValue:mn().name,buttons:[{value:"dark",langID:"theme_dark"},{value:"light",langID:"theme_light"}]}}},editor_flatten:{controls:{editor_flatten_flatten_layers:{type:"button"}}},batch_processing:{controls:{batch_processing_open_modal:{type:"button"},batch_processing_section:{type:"static",defaultValue:null},batch_processing_manage_tools:{type:"button"},batch_processing_cancel:{type:"button"},batch_processing_apply:{type:"button"},batch_processing_load_images:{type:"button"},batch_processing_clear_images:{type:"button"},batch_processing_save_images:{type:"button"},batch_processing_upgrade:{type:"button"},batch_processing_background_color:{type:"color_item",name:"background_color",defaultValue:-1,fineChangeEnabled:!0},batch_processing_image_type:{type:"toggle_group",defaultValue:"jpg",buttons:[{value:"jpg",langID:"JPG"},{value:"png",langID:"PNG"}]},batch_processing_image_quality:{type:"slider_item",name:"quality",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:98},batch_processing_add_text:{type:"textinput",defaultValue:""},batch_processing_add_text_mode:{type:"dropdown_item",name:"add_text_mode",data:BFN.DropDownData.addTextModes,defaultValue:"after",useLabel:!1}}},batch_resize:{controls:{batch_resize_mode:{type:"dropdown_item",name:"resize_by",data:BFN.DropDownData.batchResizeOptions},batch_resize_scale:{type:"scrubber",min:0,defaultValue:100,unit:"%"},batch_resize_longest_side:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:800,unit:"px"},batch_resize_width:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:800,unit:"px"},batch_resize_height:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:600,unit:"px"},batch_resize_exact_width:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:800,unit:"px"},batch_resize_exact_height:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:600,unit:"px"},batch_resize_use_padding:{type:"checkbox_item",name:"use_padding",defaultValue:!0}}},batch_crop:{controls:{batch_crop_aspect_ratio:{type:"dropdown_item",name:"aspect_ratio",data:BFN.DropDownData.cropAspectRatios},batch_crop_orientation:{type:"toggle_group",defaultValue:"landscape",buttons:["landscape","portrait"]},batch_crop_focal_point_auto:{type:"button"},batch_crop_focal_point_align:{type:"button"},batch_crop_focal_point_tl:{type:"button"},batch_crop_focal_point_tc:{type:"button"},batch_crop_focal_point_tr:{type:"button"},batch_crop_focal_point_ml:{type:"button"},batch_crop_focal_point_mc:{type:"button"},batch_crop_focal_point_mr:{type:"button"},batch_crop_focal_point_bl:{type:"button"},batch_crop_focal_point_bc:{type:"button"},batch_crop_focal_point_br:{type:"button"},batch_crop_reset:{type:"button"}}},watermark:{controls:{watermark_upload:{type:"button"},watermark_placement_popover_button:{type:"button"},watermark_placement:{type:"toggle_group",defaultValue:"br",buttons:[{value:"tl",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:"transform: rotate(225deg)"},{value:"tc",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:"transform: rotate(270deg)"},{value:"tr",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:"transform: rotate(315deg)"},{value:"ml",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:"transform: rotate(180deg)"},{value:"mc",colorClass:"button--grey-200",text:"•"},{value:"mr",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:""},{value:"bl",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:"transform: rotate(135deg)"},{value:"bc",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:"transform: rotate(90deg)"},{value:"br",colorClass:"button--grey-200",icon:"arrow-icon",iconSize:16,iconStyle:"transform: rotate(45deg)"}]},watermark_size:{type:"slider_item",name:"size",unit:"%",multiplier:1,min:5,max:100,step:1,defaultValue:25},watermark_padding:{type:"slider_item",name:"padding",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:5},watermark_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:1,max:100,step:1,defaultValue:75},watermark_save:{type:"button"}}},editor_main:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_main_image_manager:{type:"button"},editor_main_edit:{type:"button"},editor_main_touch_up:{type:"button"},editor_main_effect:{type:"button"},editor_main_artsy:{type:"button"},editor_main_frame:{type:"button"},editor_main_graphic:{type:"button"},editor_main_overlay:{type:"button"},editor_main_text:{type:"button"},editor_main_texture:{type:"button"}}},collage_main:{controls:{collage_main_image_manager:{type:"button"},collage_main_customize:{type:"button"},collage_main_layouts:{type:"button"},collage_main_patterns:{type:"button"},collage_main_graphic:{type:"button"},collage_main_text:{type:"button"}}},designer_main:{controls:{designer_main_image_manager:{type:"button"},designer_main_customize:{type:"button"},designer_main_templates:{type:"button"},designer_main_graphic:{type:"button"},designer_main_text:{type:"button"}}},editor_edit:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_edit_ai_image:{type:"button"},editor_edit_ai_portrait:{type:"button"},editor_edit_hdr_dlx:{type:"button"},editor_edit_sharpen_dlx:{type:"button"},editor_edit_vibrant_colors_dlx:{type:"button"},editor_edit_denoise_dlx:{type:"button"},editor_edit_crop:{type:"button"},editor_edit_rotate:{type:"button"},editor_edit_resize:{type:"button"},editor_edit_background:{type:"button"},editor_edit_cutout:{type:"button"},editor_edit_funky_focus:{type:"button"},editor_edit_funky_vignette:{type:"button"},editor_edit_blur:{type:"button"},editor_edit_lens_blur:{type:"button"},editor_edit_exposure:{type:"button"},editor_edit_levels:{type:"button"},editor_edit_vibrance:{type:"button"},editor_edit_color:{type:"button"},editor_edit_replace_color:{type:"button"},editor_edit_fill_light:{type:"button"},editor_edit_sharpen:{type:"button"},editor_edit_clarity:{type:"button"},editor_edit_tint:{type:"button"},editor_edit_tilt:{type:"button"},editor_edit_beautify:{type:"button"},editor_edit_color_mixer:{type:"button"},editor_edit_soften:{type:"button"},editor_edit_smoothing:{type:"button"},editor_edit_blur_edges:{type:"button"},editor_edit_auto_enhance:{type:"button"},editor_edit_glow:{type:"button"}}},editor_touch_up:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_touch_up_perfectskin:{type:"button"},editor_touch_up_wrinkles:{type:"button"},editor_touch_up_blemish_fix:{type:"button"},editor_touch_up_bronzer:{type:"button"},editor_touch_up_blush:{type:"button"},editor_touch_up_flashspot:{type:"button"},editor_touch_up_clone:{type:"button"},editor_touch_up_mascara:{type:"button"},editor_touch_up_eye_color:{type:"button"},editor_touch_up_eye_brighten:{type:"button"},editor_touch_up_eyebrow_pencil:{type:"button"},editor_touch_up_fix_redeye:{type:"button"},editor_touch_up_lipstick:{type:"button"},editor_touch_up_teeth_whiten:{type:"button"},editor_touch_up_hair_color:{type:"button"},editor_touch_up_reshape:{type:"button"},editor_touch_up_paint_brush:{type:"button"},editor_touch_up_slimming:{type:"button"}}},editor_effect:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_effect_effect_featured:{type:"button"},editor_effect_effect_favorites:{type:"button"},editor_effect_lens_flares:{type:"button"},editor_effect_bwfx:{type:"button"},editor_effect_warmfx:{type:"button"},editor_effect_analog:{type:"button"},editor_effect_cinematic:{type:"button"},editor_effect_multimedia:{type:"button"},editor_effect_glitch_art:{type:"button"},editor_effect_bw:{type:"button"},editor_effect_chromatic:{type:"button"},editor_effect_charcoal:{type:"button"},editor_effect_cyanotype:{type:"button"},editor_effect_orton_style:{type:"button"},editor_effect_sepia:{type:"button"},editor_effect_viewfinder:{type:"button"},editor_effect_summer:{type:"button"},editor_effect_unitedcolors:{type:"button"},editor_effect_instant:{type:"button"},editor_effect_cooler:{type:"button"},editor_effect_warmer:{type:"button"},editor_effect_tinytype:{type:"button"},editor_effect_crossprocess:{type:"button"},editor_effect_vintagecolors:{type:"button"},editor_effect_holgaart:{type:"button"},editor_effect_lineartopia:{type:"button"},editor_effect_hdr:{type:"button"},editor_effect_pinhole:{type:"button"},editor_effect_colorpinhole:{type:"button"},editor_effect_stenciler:{type:"button"},editor_effect_grungefx:{type:"button"},editor_effect_sunburst:{type:"button"},editor_effect_oldphotofx:{type:"button"},editor_effect_winterfx:{type:"button"},editor_effect_tiltshiftfx:{type:"button"},editor_effect_patrioticfx:{type:"button"},editor_effect_popartfx:{type:"button"},editor_effect_motioncolor:{type:"button"},editor_effect_lomoart:{type:"button"}}},editor_artsy:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_artsy_artsy_favorites:{type:"button"},editor_artsy_digitalart:{type:"button"},editor_artsy_cartoonizer:{type:"button"},editor_artsy_polyart:{type:"button"},editor_artsy_mosaic:{type:"button"},editor_artsy_pastel:{type:"button"},editor_artsy_penart:{type:"button"},editor_artsy_gouache:{type:"button"},editor_artsy_impressionist:{type:"button"},editor_artsy_inkify:{type:"button"},editor_artsy_oilpainting:{type:"button"},editor_artsy_pointillism:{type:"button"},editor_artsy_sketcher:{type:"button"},editor_artsy_underpainting:{type:"button"},editor_artsy_watercolor:{type:"button"}}},editor_frame:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_frame_frame_featured:{type:"button"},editor_frame_frame_border:{type:"button"},editor_frame_frame_drop_shadow:{type:"button"},editor_frame_frame_decorative:{type:"button"},editor_frame_frame_vintage:{type:"button"},editor_frame_frame_art_deco:{type:"button"},editor_frame_frame_floral:{type:"button"},editor_frame_frame_rustic:{type:"button"},editor_frame_frame_lace:{type:"button"},editor_frame_frame_ornament:{type:"button"},editor_frame_frame_hand_drawn:{type:"button"},editor_frame_frame_instant:{type:"button"},editor_frame_frame_grunge:{type:"button"},editor_frame_frame_filmstrip:{type:"button"},editor_frame_frame_realistic:{type:"button"}}},editor_texture:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_texture_texture_featured:{type:"button"},editor_texture_bokeh:{type:"button"},editor_texture_scratches:{type:"button"},editor_texture_light:{type:"button"},editor_texture_lightleak:{type:"button"},editor_texture_fabric:{type:"button"},editor_texture_grunge:{type:"button"},editor_texture_paint:{type:"button"},editor_texture_metal:{type:"button"},editor_texture_bricks:{type:"button"},editor_texture_paper:{type:"button"}}},editor_overlay:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_overlay_featured:{type:"button"},editor_overlay_floral:{type:"button"},editor_overlay_holiday_earth_day:{type:"button"},editor_overlay_geometry:{type:"button"},editor_overlay_brushes:{type:"button"},editor_overlay_circular:{type:"button"},editor_overlay_a_z:{type:"button"},editor_overlay_animals:{type:"button"},editor_overlay_hearts:{type:"button"},editor_overlay_halloween:{type:"button"},editor_overlay_st_patricks_day:{type:"button"},editor_overlay_valentines_day:{type:"button"},editor_overlay_numbers:{type:"button"},editor_overlay_patterns:{type:"button"},editor_overlay_sports:{type:"button"},editor_overlay_symbols:{type:"button"},editor_overlay_winter_holidays:{type:"button"}}},editor_text:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_text_add_text:{type:"button",preventDeselectOnDoubleClick:!0}}},editor_graphic:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,controls:{editor_graphic_add_layer:{type:"button"}}},collage_customize:{controls:{collage_customize_background_color:{name:"color_palette",type:"color_palette",defaultValue:"FFFFFF",colors:[["FFFFFF","9B9B9B","4A4A4A","000000"],["A70C2C","DA9A15","F8E71D","47821A","4990E2"]],presetsOnly:!1,emptyEnabled:!0,fineChangeEnabled:!0},collage_customize_spacing:{type:"slider_item",name:"spacing",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:5},collage_customize_corner_rounding:{type:"slider_item",name:"corner_rounding",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},collage_customize_aspect_ratio:{type:"dropdown_item",name:"aspect_ratio",data:BFN.DropDownData.cropAspectRatios},collage_customize_orientation:{type:"toggle_group",defaultValue:"landscape",buttons:["portrait","landscape"]},collage_customize_width:{type:"scrubber",min:BFN.minCollageSize,max:1024,defaultValue:BFN.maxImageSize,unit:"px",arrowsAffectInputValue:!1},collage_customize_height:{type:"scrubber",min:BFN.minCollageSize,max:1024,defaultValue:BFN.maxImageSize,unit:"px",arrowsAffectInputValue:!1},collage_customize_lock_aspect_ratio:{type:"checkbox_item",name:"lock_aspect_ratio",defaultValue:!1}}},collage_layouts_custom:{controls:{collage_layouts_custom_collage_wizard:{type:"button"},collage_layouts_custom_create_your_own:{type:"button"}}},collage_layouts:{controls:{collage_layouts_featured:{type:"button"},collage_layouts_grid:{type:"button"},collage_layouts_big_photo_wrap:{type:"button"},collage_layouts_shape:{type:"button"},collage_layouts_facebook:{type:"button"},collage_layouts_pinterest:{type:"button"}}},collage_patterns:{controls:{collage_patterns_featured:{type:"button"},collage_patterns_autumn:{type:"button"},collage_patterns_fabric:{type:"button"},collage_patterns_fancy:{type:"button"},collage_patterns_geometric:{type:"button"},collage_patterns_polka_dots:{type:"button"},collage_patterns_stripes:{type:"button"},collage_patterns_summer:{type:"button"},collage_patterns_love:{type:"button"},collage_patterns_winter:{type:"button"}}},crop:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP,applyCancelMenuID:"editor_apply_cancel_menu",controls:{crop_aspect_ratio:{type:"dropdown_item",name:"aspect_ratio",data:BFN.DropDownData.cropAspectRatios},crop_orientation:{type:"toggle_group",defaultValue:"landscape",buttons:["portrait","landscape"]},crop_crop_width:{type:"scrubber",min:0,max:0,defaultValue:0,unit:"px"},crop_crop_height:{type:"scrubber",min:0,max:0,defaultValue:0,unit:"px"},crop_lock_aspect_ratio:{type:"checkbox"}}},rotate:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{rotate_rotate_counter_clockwise:{type:"button"},rotate_rotate_clockwise:{type:"button"},rotate_flip_horizontal:{type:"button"},rotate_flip_vertical:{type:"button"},rotate_straighten:{type:"slider_item",name:"straighten",unit:"°",multiplier:1,min:-90,max:90,step:1,defaultValue:0,enableStartEvent:!0}}},resize:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{resize_resize_width:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:0,unit:"px"},resize_resize_height:{type:"scrubber",min:BFN.minImageSize,max:BFN.maxImageSize,defaultValue:0,unit:"px"},resize_resize_xscale:{type:"scrubber",unit:"%"},resize_resize_yscale:{type:"scrubber",unit:"%"},resize_lock_aspect_ratio:{type:"checkbox"}}},slimming:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING,applyCancelMenuID:"editor_apply_cancel_menu",controls:{slimming_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:30}}},reshape:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{reshape_mode:{type:"toggle_group",defaultValue:"smudge",buttons:[{value:"smudge",icon:"smudge-icon",tooltip:"smudge"},{value:"grow",icon:"grow-icon",tooltip:"grow"},{value:"shrink",icon:"shrink-icon",tooltip:"shrink"},{value:"erase",icon:"erase-icon",tooltip:"erase"}]},reshape_reset:{type:"button"},reshape_pressure:{type:"slider_item",name:"pressure",unit:"%",multiplier:1,min:10,max:100,step:1,defaultValue:50},reshape_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},reshape_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},funky_focus:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS,applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{funky_focus_mode:{type:"toggle_group",defaultValue:"radial",buttons:[{value:"radial",icon:"vignette-icon",tooltip:"radial"},{value:"linear",icon:"vignette-linear-icon",iconSize:18,tooltip:"linear"}]},funky_focus_grayscale:{type:"checkbox"},funky_focus_mosaic:{type:"checkbox"},funky_focus_inverse:{type:"checkbox"},funky_focus_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:15},funky_focus_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},funky_vignette:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE,applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{funky_vignette_mode:{type:"toggle_group",defaultValue:"radial",buttons:[{value:"radial",icon:"vignette-icon",tooltip:"radial"},{value:"square",icon:"vignette-square-icon",tooltip:"square"},{value:"linear",icon:"vignette-linear-icon",tooltip:"linear"}]},funky_vignette_clear:{type:"button"},funky_vignette_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes,defaultValue:BFN.CONST.BLEND_MODES.NORMAL},funky_vignette_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.75},funky_vignette_color:{type:"color_item",name:"color",defaultValue:"000000",emptyEnabled:!1,fineChangeEnabled:!0}}},cutout:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT,applyCancelMenuID:"editor_apply_cancel_menu",controls:{cutout_show_mask:{type:"checkbox"},cutout_invert:{type:"button"},cutout_clear:{type:"button"},cutout_remove_background:{type:"button"},cutout_mode:{type:"toggle_group",defaultValue:"brush",buttons:[{value:"brush",icon:"paintbrush-icon",tooltip:"paint"},{value:"magic_brush",icon:"auto-enhance-icon",tooltip:"magic_brush"},{value:"lasso",icon:"lasso-icon",tooltip:"lasso"},{value:"polygon",icon:"polygonal-lasso-icon",tooltip:"polygon"},{value:"circle",icon:"dashed-circle-icon",tooltip:"circle"},{value:"rectangle",icon:"dashed-rectangle-icon",tooltip:"rectangle"}]},cutout_select_action:{type:"toggle_group",defaultValue:"subtract",buttons:[{value:"subtract",langID:"remove",tooltip:"remove_selection"},{value:"add",langID:"keep",tooltip:"keep_selection"}]},cutout_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},cutout_hardness:{type:"slider_item",name:"hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},cutout_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:10,max:100,step:1,defaultValue:50},cutout_tolerance:{type:"slider_item",name:"tolerance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},cutout_background_color:{type:"color_item",name:"background_color",defaultValue:-1,emptyEnabled:!0,fineChangeEnabled:!0},cutout_trim_transparency:{type:"checkbox_item",name:"trim_transparency",defaultValue:!1,description:"cutout_guide_trim_transparency"},cutout_export_as_layer:{type:"checkbox_item",name:"export_as_layer",defaultValue:!1,description:"cutout_guide_export_as_layer"},cutout_options_modal_cancel:{type:"button"},cutout_options_modal_apply:{type:"button"}}},blur:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{blur_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},lens_blur:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{lens_blur_blur_amount:{type:"slider_item",name:"blur_amount",defaultValue:50,min:1,max:100,step:1,unit:"%",multiplier:1},lens_blur_bokeh_intensity:{type:"slider_item",name:"bokeh_intensity",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1},lens_blur_blade_curvature:{type:"slider_item",name:"blade_curvature",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},lens_blur_blade_count:{type:"toggle_group",name:"blade_count",defaultValue:6,useLabel:!0,buttons:[{langID:"3",value:3},{langID:"4",value:4},{langID:"5",value:5},{langID:"6",value:6},{langID:"7",value:7},{langID:"8",value:8},{langID:"9",value:9}]},lens_blur_real_time:{type:"static",name:"real_time",defaultValue:!1},lens_blur_passes:{type:"static",name:"passes",defaultValue:4,min:1,max:10,step:1,unit:"",multiplier:1},lens_blur_pass1Radius:{type:"static",name:"pass1Radius",defaultValue:1,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass1Layers:{type:"static",name:"pass1Layers",defaultValue:1,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_pass2Radius:{type:"static",name:"pass2Radius",defaultValue:50,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass2Layers:{type:"static",name:"pass2Layers",defaultValue:4,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_pass3Radius:{type:"static",name:"pass3Radius",defaultValue:20,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass3Layers:{type:"static",name:"pass3Layers",defaultValue:3,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_pass4Radius:{type:"static",name:"pass4Radius",defaultValue:8.5,min:1,max:200,step:.5,unit:"",multiplier:1},lens_blur_pass4Layers:{type:"static",name:"pass4Layers",defaultValue:2,min:1,max:4,step:1,unit:"",multiplier:1},lens_blur_finalBlur:{type:"static",name:"finalBlur",defaultValue:!0}}},exposure:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{exposure_brightness:{type:"slider_item",name:"brightness",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0},exposure_contrast:{type:"slider_item",name:"contrast",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0},exposure_highlights:{type:"slider_item",name:"highlights",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0},exposure_shadows:{type:"slider_item",name:"shadows",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0}}},levels:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{levels_min_input:{type:"slider_item",name:"Min Input",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:0},levels_gamma:{type:"slider_item",name:"Gamma",unit:"",multiplier:100,min:0,max:3,step:.01,defaultValue:1},levels_max_input:{type:"slider_item",name:"Max Input",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:1},levels_min_output:{type:"slider_item",name:"Min Output",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:0},levels_max_output:{type:"slider_item",name:"Max Output",unit:"",multiplier:100,min:0,max:1,step:.01,defaultValue:1}}},invert:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{invert_invert_amount:{type:"slider",min:0,max:1,step:.001,defaultValue:1}}},vibrance:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{vibrance_vibrance_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},desaturate:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{desaturate_gray_amount:{type:"slider",min:0,max:1,step:.001,defaultValue:1}}},color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{color_hue:{type:"slider_item",name:"hue",unit:"°",multiplier:1,min:-180,max:180,step:1,defaultValue:0,customClasses:["slider-custom","slider-custom-hue"]},color_saturation:{type:"slider_item",name:"saturation",unit:"",multiplier:100,min:-1,max:1,step:.01,defaultValue:0,customClasses:["slider-custom","slider-custom-saturation"]},color_temperature:{type:"slider_item",name:"temperature",unit:"",multiplier:100,min:-.25,max:.25,step:.01,defaultValue:0,customClasses:["slider-custom","slider-custom-temperature"]}}},replace_color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{replace_color_reset:{type:"button",name:"reset",icon:"reset-icon",iconSize:18},replace_color_source_color:{type:"color_item",name:"source_color",defaultValue:-1,fineChangeEnabled:!0},replace_color_target_color:{type:"color_item",name:"target_color",defaultValue:-1,fineChangeEnabled:!0,intensityEnabled:!0},replace_color_tolerance:{type:"slider_item",name:"tolerance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},replace_color_preserve_luminosity:{type:"checkbox_item",name:"preserve_luminosity",defaultValue:!0}}},fill_light:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{fill_light_light_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},sharpen:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{sharpen_mode:{name:"mode",type:"toggle_group",defaultValue:"smart",buttons:[{value:"smart",icon:"smart-sharpen-icon",tooltip:"smart_sharpen"},{value:"normal",icon:"sharpen-icon",tooltip:"sharpen"}]},sharpen_unsharp_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.2}}},clarity:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{clarity_clarity_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.3}}},vignette:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{vignette_vignette_amount:{type:"slider_item",name:"vignette_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.2},vignette_vignette_softness:{type:"slider_item",name:"softness",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7}}},tint:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{tint_color_1:{type:"color_item",name:"color_value_1",defaultValue:"FFFFFF",emptyEnabled:!1,fineChangeEnabled:!0},tint_color_2:{type:"color_item",name:"color_value_2",defaultValue:-1,fineChangeEnabled:!0},tint_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1}}},tilt:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT,applyCancelMenuID:"editor_apply_cancel_menu",controls:{tilt_background_color:{type:"color_item",name:"background_color",defaultValue:-1},tilt_tilt_amount:{type:"slider_item",name:"tilt_amount",unit:"°",multiplier:1,min:-90,max:90,step:1,defaultValue:0}}},beautify:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{beautify_beautify_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.35}}},color_mixer:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{color_mixer_bw:{name:"black_and_white",type:"checkbox",defaultValue:!1,icon:"black-and-white-icon",iconSize:18,tooltip:"black_and_white",customClasses:["control-item--border-bottom"]},color_mixer_red:{type:"slider_item",name:"red",unit:"%",multiplier:1,min:-100,max:100,step:1,defaultValue:0},color_mixer_green:{type:"slider_item",name:"green",unit:"%",multiplier:1,min:-100,max:100,step:1,defaultValue:0},color_mixer_blue:{type:"slider_item",name:"blue",unit:"%",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},soften:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{soften_softness:{type:"slider_item",name:"softness",unit:"%",multiplier:1,min:5,max:100,step:1,defaultValue:30},soften_lightness:{type:"slider_item",name:"lightness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:40}}},smoothing:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{smoothing_smoothing_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:40}}},blur_edges:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{blur_edges_edge_size:{type:"slider_item",name:"size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},blur_edges_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:10},blur_edges_shift_vertical:{type:"slider_item",name:"shift_vertical",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0},blur_edges_shift_horizontal:{type:"slider_item",name:"shift_horizontal",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},auto_enhance:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,controls:{auto_enhance_intensity:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},glow:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,brushMenuID:"effect_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{glow_intensity_mode:{type:"toggle_group",defaultValue:"normal",buttons:["normal","intense"]},glow_intensity:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},glow_glow_size:{type:"slider_item",name:"glow_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},glow_glint_size:{type:"slider_item",name:"glint_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},glow_tolerance:{type:"slider_item",name:"tolerance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},glow_tint_color:{type:"color_item",name:"tint",defaultValue:-1,fineChangeEnabled:!0}}},background:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND,brushMenuID:"background_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{background_transparent:{type:"checkbox_item",name:"transparent",defaultValue:!0},background_fill_color:{type:"color_item",name:"fill_color",defaultValue:"FFFFFF",emptyEnabled:!1,fineChangeEnabled:!0},background_fill_amount:{type:"slider_item",name:"fill_amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},background_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},ai_image:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,name:"A.I. Image Enhancer",type:"edit",controls:{ai_image_id:{type:"static",defaultValue:"a_i_enhancer"}}},ai_portrait:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",isPlus:!0,name:"A.I. Portrait Enhancer",type:"touch_up",controls:{ai_portrait_id:{type:"static",defaultValue:"a_i_portrait"}}},hdr_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"HDR DLX",type:"edit",controls:{hdr_dlx_id:{type:"static",defaultValue:"ART_0023"},hdr_dlx_local_exposure:{type:"slider_item",name:"local_exposure",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},hdr_dlx_local_regions:{type:"slider_item",name:"local_regions",defaultValue:12,min:1,max:25,step:1,unit:"",multiplier:1}}},sharpen_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"Sharpen DLX",type:"edit",controls:{sharpen_dlx_id:{type:"static",defaultValue:"ART_0021"},sharpen_dlx_strength:{type:"slider_item",name:"strength",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},sharpen_dlx_detail_level:{type:"slider_item",name:"detail_level",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}}},vibrant_colors_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"Vibrant Colors DLX",type:"edit",controls:{vibrant_colors_dlx_id:{type:"static",defaultValue:"ART_0022"},vibrant_colors_dlx_color_amount:{type:"slider_item",name:"color_amount",defaultValue:60,min:-100,max:100,step:1,unit:"",multiplier:1}}},denoise_dlx:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",name:"Denoise DLX",type:"edit",controls:{denoise_dlx_id:{type:"static",defaultValue:"ART_0020"},denoise_dlx_smoothness:{type:"slider_item",name:"smoothness",defaultValue:50,min:10,max:100,step:1,unit:"",multiplier:1},denoise_dlx_fine_details:{type:"slider_item",name:"fine_details",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1}}},perfectskin:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{perfectskin_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},perfectskin_isBlur:{type:"static",defaultValue:!0},perfectskin_isBlur2:{type:"static",defaultValue:!0},perfectskin_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.perfectskin},perfectskin_brush_size:{type:"static",defaultValue:.3},perfectskin_brush_hardness:{type:"static",defaultValue:.9}}},wrinkles:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{wrinkles_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.4},wrinkles_isBlur:{type:"static",defaultValue:!0},wrinkles_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.wrinkles},wrinkles_brush_size:{type:"static",defaultValue:.25},wrinkles_brush_hardness:{type:"static",defaultValue:.7}}},bronzer:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{bronzer_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"724301",colors:[["724301","9A7035","D2AF7E","FCDDB1"]],presetsOnly:!1,emptyEnabled:!1,hueLocked:!0,fineChangeEnabled:!0},bronzer_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.5},bronzer_isBlur:{type:"static",defaultValue:!1},bronzer_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.bronzer},bronzer_brush_size:{type:"static",defaultValue:.25},bronzer_brush_hardness:{type:"static",defaultValue:.5}}},blush:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{blush_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"FFCDD9",colors:[["FFCDD9","ECB4Bf","DA798A","A16B72","703D42"],["D9BA9A","CEA989","A9856B","B28061","825436"]],presetsOnly:!0,emptyEnabled:!1},blush_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.5},blush_isBlur:{type:"static",defaultValue:!1},blush_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.blush},blush_brush_size:{type:"static",defaultValue:.25},blush_brush_hardness:{type:"static",defaultValue:.5}}},flashspot:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{flashspot_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},flashspot_isBlur:{type:"static",defaultValue:!1},flashspot_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.flashspot},flashspot_brush_size:{type:"static",defaultValue:.25},flashspot_brush_hardness:{type:"static",defaultValue:.5}}},mascara:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{mascara_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},mascara_isBlur:{type:"static",defaultValue:!0},mascara_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.mascara},mascara_brush_size:{type:"static",defaultValue:.25},mascara_brush_hardness:{type:"static",defaultValue:.8}}},eye_color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{eye_color_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"64C4FF",colors:[["64C4FF","81BC36","7A5C3A","BBBEBA"]],emptyEnabled:!1,fineChangeEnabled:!0},eye_color_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7},eye_color_isBlur:{type:"static",defaultValue:!1},eye_color_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_color},eye_color_brush_size:{type:"static",defaultValue:.25},eye_color_brush_hardness:{type:"static",defaultValue:.8}}},eye_brighten:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{eye_brighten_isBlur:{type:"static",defaultValue:!0},eye_brighten_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_brighten},eye_brighten_brush_size:{type:"static",defaultValue:.25},eye_brighten_brush_hardness:{type:"static",defaultValue:.3}}},eyebrow_pencil:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{eyebrow_pencil_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"3D3A33",colors:[["3D3A33","74717A","835836","A58646"]],emptyEnabled:!1,fineChangeEnabled:!0},eyebrow_pencil_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},eyebrow_pencil_isBlur:{type:"static",defaultValue:!0},eyebrow_pencil_curves:{type:"static",defaultValue:"blackenCurve"},eyebrow_pencil_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eyebrow_pencil},eyebrow_pencil_brush_size:{type:"static",defaultValue:.25},eyebrow_pencil_brush_hardness:{type:"static",defaultValue:.3}}},fix_redeye:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{fix_redeye_isBlur:{type:"static",defaultValue:!1},fix_redeye_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.fix_redeye},fix_redeye_brush_size:{type:"static",defaultValue:.25},fix_redeye_brush_hardness:{type:"static",defaultValue:.7}}},lipstick:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{lipstick_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"EF4292",colors:[["EF4292","D7058C","DA085F","E12438"]],emptyEnabled:!1,fineChangeEnabled:!0},lipstick_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7},lipstick_isBlur:{type:"static",defaultValue:!1},lipstick_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.lipstick},lipstick_brush_size:{type:"static",defaultValue:.25},lipstick_brush_hardness:{type:"static",defaultValue:.6}}},teeth_whiten:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{teeth_whiten_isBlur:{type:"static",defaultValue:!0},teeth_whiten_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.teeth_whiten},teeth_whiten_brush_size:{type:"static",defaultValue:.25},teeth_whiten_brush_hardness:{type:"static",defaultValue:.3}}},hair_color:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP,genericMenuID:"touch_up_generic_menu",brushMenuID:"touch_up_brush_menu",applyCancelMenuID:"editor_apply_cancel_menu",controls:{hair_color_color_palette:{name:"color_palette",type:"color_palette",defaultValue:"E8D18A",colors:[["E8D18A","935118","C58B4E","0C0C17"]],emptyEnabled:!1},hair_color_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.7},hair_color_isBlur:{type:"static",defaultValue:!1},hair_color_presetID:{type:"static",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.haircolor},hair_color_brush_size:{type:"static",defaultValue:.25},hair_color_brush_hardness:{type:"static",defaultValue:.6}}},paint_brush:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH,applyCancelMenuID:"editor_apply_cancel_menu",controls:{paint_brush_clear:{type:"button"},paint_brush_erase:{type:"checkbox",defaultValue:!1},paint_brush_color:{type:"color_item",name:"color",defaultValue:"FFFFFF",emptyEnabled:!1},paint_brush_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes,defaultValue:BFN.CONST.BLEND_MODES.NORMAL},paint_brush_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:.5},paint_brush_strength:{type:"slider_item",name:"strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},paint_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},paint_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},clone:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE,applyCancelMenuID:"editor_apply_cancel_menu",controls:{clone_target_reset:{type:"button"},clone_brush_clear:{type:"button"},clone_brush_erase:{type:"checkbox",defaultValue:!1},clone_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},clone_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},clone_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},blemish_fix:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX,applyCancelMenuID:"editor_apply_cancel_menu",controls:{blemish_fix_brush_erase:{type:"checkbox",defaultValue:!1},blemish_fix_brush_clear:{type:"button"},blemish_fix_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},blemish_fix_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:40}}},frame_border:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER,applyCancelMenuID:"editor_apply_cancel_menu",controls:{frame_border_outer_color:{type:"color",defaultValue:"000000",fineChangeEnabled:!0},frame_border_inner_color:{type:"color",defaultValue:"FFFFFF",fineChangeEnabled:!0},frame_border_matte_color:{type:"color",defaultValue:-1,fineChangeEnabled:!0},frame_border_outer_thickness:{type:"slider_item",name:"outer_thickness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},frame_border_inner_thickness:{type:"slider_item",name:"inner_thickness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},frame_border_corner_radius:{type:"slider_item",name:"corner_radius",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},frame_border_caption_space:{type:"slider_item",name:"caption_space",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0}}},frame_drop_shadow:{viewstate:BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW,applyCancelMenuID:"editor_apply_cancel_menu",controls:{frame_drop_shadow_type:{type:"toggle_group",defaultValue:"outer",buttons:[{langID:"outer",value:"outer"},{langID:"inner",value:"inner"}]},frame_drop_shadow_background_color:{type:"color",defaultValue:-1,fineChangeEnabled:!0},frame_drop_shadow_shadow_color:{type:"color",defaultValue:"000000",emptyEnabled:!1,fineChangeEnabled:!0},frame_drop_shadow_distance:{type:"slider_item",name:"distance",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},frame_drop_shadow_angle:{type:"slider_item",name:"angle",unit:"°",multiplier:1,min:-180,max:180,step:1,defaultValue:45},frame_drop_shadow_size:{type:"slider_item",name:"size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},frame_drop_shadow_density:{type:"slider_item",name:"density",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:5},frame_drop_shadow_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:75}}},background_brush:{controls:{background_brush_show_mask:{type:"checkbox"},background_brush_invert:{type:"button"},background_brush_clear:{type:"button"},background_brush_isolate_subject:{type:"button"},background_brush_select_action:{type:"toggle_group",name:"select_action",defaultValue:"subtract",buttons:[{langID:"keep",value:"subtract",tooltip:"keep_selection"},{langID:"remove",value:"add",tooltip:"remove_selection"}]},background_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},background_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:75},background_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},touch_up_brush:{controls:{touch_up_brush_clear:{type:"button"},touch_up_brush_erase:{type:"checkbox",defaultValue:!1},touch_up_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:35},touch_up_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50}}},effect_generic:{controls:{effect_generic_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},effect_brush:{controls:{effect_brush_show_mask:{type:"checkbox"},effect_brush_invert:{type:"button"},effect_brush_clear:{type:"button"},effect_brush_isolate_subject:{type:"button"},effect_brush_select_action:{type:"toggle_group",name:"select_action",defaultValue:"subtract",buttons:[{langID:"remove",value:"subtract",tooltip:"remove_selection"},{langID:"keep",value:"add",tooltip:"keep_selection"}]},effect_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},effect_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},effect_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},artsy_generic:{controls:{artsy_generic_amount:{type:"slider_item",name:"amount",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},artsy_brush:{controls:{artsy_brush_show_mask:{type:"checkbox"},artsy_brush_invert:{type:"button"},artsy_brush_clear:{type:"button"},artsy_brush_isolate_subject:{type:"button"},artsy_brush_select_action:{type:"toggle_group",name:"select_action",defaultValue:"subtract",buttons:[{langID:"remove",value:"subtract",tooltip:"remove_selection"},{langID:"keep",value:"add",tooltip:"keep_selection"}]},artsy_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},artsy_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},artsy_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},frame_crop_rotate_generic:{controls:{frame_crop_rotate_generic_rotate_counter_clockwise:{type:"button"},frame_crop_rotate_generic_rotate_clockwise:{type:"button"},frame_crop_rotate_generic_flip_horizontal:{type:"button"},frame_crop_rotate_generic_flip_vertical:{type:"button"},frame_crop_rotate_generic_background_color:{type:"color_item",name:"background_color",defaultValue:-1,fineChangeEnabled:!0},frame_crop_rotate_generic_position:{type:"slider_item",name:"position",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0},frame_crop_rotate_generic_tilt:{type:"slider_item",name:"tilt",unit:"°",multiplier:1,min:-90,max:90,step:1,defaultValue:0}}},frame_crop_generic:{controls:{frame_crop_generic_rotate_counter_clockwise:{type:"button"},frame_crop_generic_rotate_clockwise:{type:"button"},frame_crop_generic_flip_horizontal:{type:"button"},frame_crop_generic_flip_vertical:{type:"button"},frame_crop_generic_position:{type:"slider_item",name:"position",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},frame_full_generic:{controls:{frame_full_generic_color_overlay:{type:"color_item",name:"color_overlay",defaultValue:-1,intensityEnabled:!0,fineChangeEnabled:!0},frame_full_generic_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes},frame_full_generic_rotate_counter_clockwise:{type:"button"},frame_full_generic_rotate_clockwise:{type:"button"},frame_full_generic_flip_horizontal:{type:"button"},frame_full_generic_flip_vertical:{type:"button"},frame_full_generic_position:{type:"slider_item",name:"position",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0},frame_full_generic_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},texture_generic:{controls:{texture_generic_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},texture_generic_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes},texture_generic_rotate_counter_clockwise:{type:"button"},texture_generic_rotate_clockwise:{type:"button"},texture_generic_flip_horizontal:{type:"button"},texture_generic_flip_vertical:{type:"button"}}},texture_brush:{controls:{texture_brush_show_mask:{type:"checkbox"},texture_brush_invert:{type:"button"},texture_brush_clear:{type:"button"},texture_brush_isolate_subject:{type:"button"},texture_brush_select_action:{type:"toggle_group",name:"select_action",defaultValue:"subtract",buttons:[{langID:"remove",value:"subtract",tooltip:"remove_selection"},{langID:"keep",value:"add",tooltip:"keep_selection"}],useLabel:!1},texture_brush_size:{type:"slider_item",name:"brush_size",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},texture_brush_hardness:{type:"slider_item",name:"brush_hardness",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},texture_brush_strength:{type:"slider_item",name:"brush_strength",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100}}},overlay_generic:{controls:{overlay_generic_reset:{type:"button"},overlay_generic_color:{type:"color",defaultValue:"FFFFFF",emptyEnabled:!1,fineChangeEnabled:!0},overlay_generic_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},overlay_generic_size:{type:"slider_item",name:"size",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:1},overlay_generic_rotation:{type:"slider_item",name:"rotation",unit:"°",multiplier:1,min:-180,max:180,step:1,defaultValue:0},overlay_generic_blur_amount:{type:"slider_item",name:"blur_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:0},overlay_generic_shadow_amount:{type:"slider_item",name:"shadow_amount",unit:"%",multiplier:100,min:0,max:1,step:.01,defaultValue:0}}},lens_flare_generic:{controls:{lens_flare_generic_intense_mode:{type:"toggle_group",defaultValue:"normal",buttons:["normal","intense"]},lens_flare_generic_intensity:{type:"slider_item",name:"intensity",unit:"",multiplier:1,min:-100,max:100,step:1,defaultValue:0}}},editor_apply_cancel:{controls:{editor_apply_cancel_cancel:{type:"button"},editor_apply_cancel_apply:{type:"button"}}},transform:{controls:{transform_shape_fill_enabled:{type:"expandable_checkbox",defaultValue:!1},transform_shape_fill_color:{type:"color_item",name:"color",pickerName:"fill_color",defaultValue:"FFFFFF",intensityEnabled:!0,fineChangeEnabled:!0,emptyEnabled:!1},transform_shape_stroke_enabled:{type:"expandable_checkbox",defaultValue:!1},transform_shape_stroke_color:{type:"color_item",name:"color",pickerName:"stroke_color",defaultValue:-1,intensityEnabled:!0,fineChangeEnabled:!0,emptyEnabled:!1},transform_shape_stroke_width:{type:"slider_item",name:"thickness",min:1,max:100,step:1,defaultValue:5,unit:"px"},transform_shape_line_style:{type:"toggle_group",defaultValue:"solid",buttons:["solid","dashed","dotted"]},transform_shape_line_segment_width:{type:"slider_item",name:"segment_width",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:50},transform_shape_line_gap_size:{type:"slider_item",name:"gap_size",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:50},transform_shape_rectangle_corner_rounding:{type:"slider_item",name:"corner_rounding",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},transform_shape_polygon_sides:{type:"slider_item",name:"sides",unit:"",multiplier:1,min:3,max:12,step:1,defaultValue:6},transform_shape_polygon_shift_orientation:{type:"checkbox_item",name:"shift_orientation",defaultValue:!1},transform_shape_star_points:{type:"slider_item",name:"points",unit:"",multiplier:1,min:3,max:32,step:1,defaultValue:5},transform_shape_star_inset_weight:{type:"slider_item",name:"inset_weight",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:50},transform_shape_star_shift_orientation:{type:"checkbox_item",name:"shift_orientation",defaultValue:!1},transform_shape_arrow_style:{type:"toggle_group",defaultValue:"thick",buttons:["thick","thin"]},transform_shape_arrow_weight:{type:"slider_item",name:"weight",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:25},transform_shape_arrow_double_sided:{type:"checkbox_item",name:"double_sided",defaultValue:!1},transform_graphic_color_group_color:{name:"graphic_colors",type:"color_group",defaultValue:"FFFFFF",emptyEnabled:!1,resetColorEnabled:!0,fineChangeEnabled:!0,intensityEnabled:!0,intensityWhileTransparent:!0,useLabel:!0,maxVisibleRows:3,colorsPerRow:6,rowMarginAdjustment:4},transform_image_border_enabled:{type:"expandable_checkbox",defaultValue:!1},transform_image_border_color:{type:"color_item",name:"color",pickerName:"border_color",defaultValue:-1,intensityEnabled:!0,fineChangeEnabled:!0,emptyEnabled:!1},transform_image_border_thickness:{type:"slider_item",name:"thickness",min:1,max:100,step:1,defaultValue:5,unit:"px"},transform_drop_shadow_enabled:{type:"expandable_checkbox",defaultValue:!1},transform_drop_shadow_distance:{type:"slider_item",name:"distance",unit:"px",multiplier:1,min:0,max:500,step:1,defaultValue:25},transform_drop_shadow_angle:{type:"slider_item",name:"angle",unit:"°",multiplier:1,min:-180,max:180,step:1,defaultValue:-45},transform_drop_shadow_size:{type:"slider_item",name:"blur",unit:"px",multiplier:1,min:0,max:100,step:1,defaultValue:10},transform_drop_shadow_scale:{type:"slider_item",name:"size",unit:"%",multiplier:1,min:100,max:150,step:1,defaultValue:100},transform_drop_shadow_density:{type:"slider_item",name:"density",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:0},transform_drop_shadow_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:75},transform_drop_shadow_color:{type:"color_item",name:"color",pickerName:"drop_shadow",defaultValue:"000000",emptyEnabled:!1,fineChangeEnabled:!0},transform_blend_mode:{type:"dropdown_item",name:"blend_mode",data:BFN.DropDownData.blendModes},transform_overlay_color_enabled:{type:"expandable_checkbox",defaultValue:!1},transform_overlay_color:{type:"color_item",name:"color",defaultValue:-1,intensityEnabled:!0,fineChangeEnabled:!0,emptyEnabled:!1},transform_tint_color_enabled:{type:"expandable_checkbox",defaultValue:!1},transform_tint_color:{type:"color_item",name:"color",defaultValue:-1,fineChangeEnabled:!0,emptyEnabled:!1},transform_opacity:{type:"slider_item",name:"opacity",unit:"%",multiplier:1,min:0,max:100,step:1,defaultValue:100},transform_create_group:{type:"button"},transform_delete:{type:"button"},transform_duplicate:{type:"button"},transform_flip_horizontal:{type:"button"},transform_flip_vertical:{type:"button"},transform_move_backwards:{type:"button"},transform_move_forwards:{type:"button"},transform_align_left:{type:"button"},transform_align_center:{type:"button"},transform_align_right:{type:"button"},transform_align_top:{type:"button"},transform_align_middle:{type:"button"},transform_align_bottom:{type:"button"},transform_fit_to_canvas:{type:"button"},transform_fill_canvas:{type:"button"},transform_menu_popover_button:{type:"button"}}},layer:{controls:{layer_save_as_image:{type:"button"},layer_image_cutout:{type:"button"},layer_image_edit_layer:{type:"button"},layer_mask_image_crop:{type:"button"},layer_mask_image_replace:{type:"button"},layer_mask_image_crop_size:{type:"scrubber",min:100,max:100,defaultValue:100,unit:"%",maxLength:5},layer_mask_image_crop_fit_to_frame:{type:"button"},layer_mask_image_crop_fit_to_image:{type:"button"},layer_isolator_edit_complete:{type:"button"},layer_isolator_display_canvas:{type:"checkbox_item",name:"display_canvas",defaultValue:!0,checkboxColor:"light"}}},text_edit:{controls:{text_edit_bold:{type:"checkbox",defaultValue:!1},text_edit_italic:{type:"checkbox",defaultValue:!1},text_edit_underline:{type:"checkbox",defaultValue:!1},text_edit_background_enabled:{type:"expandable_checkbox",defaultValue:!1},text_edit_background_color:{type:"color_item",name:"color",pickerName:"background_color",defaultValue:"000000",intensityEnabled:!0,fineChangeEnabled:!0,emptyEnabled:!1},text_edit_background_padding:{type:"slider_item",name:"padding",min:0,max:100,step:1,defaultValue:0,unit:"%"},text_edit_highlight_enabled:{type:"expandable_checkbox",defaultValue:!1},text_edit_highlight_color:{type:"color_item",name:"color",pickerName:"highlight_color",defaultValue:"000000",intensityEnabled:!0,fineChangeEnabled:!0},text_edit_text_color:{type:"color",name:"text_color",defaultValue:"FF0000",intensityEnabled:!0,fineChangeEnabled:!0},text_edit_stroke_enabled:{type:"expandable_checkbox",defaultValue:!1},text_edit_stroke_color:{type:"color_item",name:"color",pickerName:"outline_color",defaultValue:"000000",intensityEnabled:!0,fineChangeEnabled:!0},text_edit_stroke_width:{type:"slider_item",name:"thickness",min:1,max:100,step:1,defaultValue:1,unit:"%"},text_edit_size:{type:"scrubber",min:6,max:9999,defaultValue:20,unit:"px",maxLength:4},text_edit_align:{type:"toggle_group",defaultValue:"left",buttons:[{value:"left",icon:"paragraph-left-align-icon",iconSize:14,tooltip:"alight_left"},{value:"center",icon:"paragraph-center-align-icon",iconSize:14,tooltip:"align_center"},{value:"right",icon:"paragraph-right-align-icon",iconSize:14,tooltip:"align_right"}]},text_edit_spacing:{type:"slider_item",name:"letter_spacing",min:0,max:10,step:1,defaultValue:0,unit:""},text_edit_line_height:{type:"slider_item",name:"line_height",min:50,max:200,step:1,defaultValue:100,unit:"%"},text_edit_spacing_menu_popover_button:{type:"button"}}},collage_image:{controls:{collage_image_size:{type:"slider_item",name:"size",min:100,max:500,step:1,defaultValue:100,unit:"%"},collage_image_rotate_counter_clockwise:{type:"button"},collage_image_rotate_clockwise:{type:"button"},collage_image_flip_horizontal:{type:"button"},collage_image_flip_vertical:{type:"button"},collage_image_open_in_editor:{type:"button"}}},collage_pattern:{controls:{collage_pattern_size:{type:"slider_item",name:"size",min:100,max:500,step:1,defaultValue:100,unit:"%"},collage_pattern_color:{type:"color_item",name:"color",defaultValue:"000000",emptyEnabled:!0,fineChangeEnabled:!1}}},layers:{controls:{layers_toggle_panel:{type:"checkbox",defaultValue:!1}}},alignment:{controls:{alignment_toggle_panel:{type:"checkbox",defaultValue:!1},alignment_snapping:{type:"toggle_switch",defaultValue:!1},alignment_display_distances:{type:"toggle_switch",defaultValue:!1},alignment_guides:{type:"toggle_switch",defaultValue:!1}}},history:{controls:{history_toggle_panel:{type:"checkbox",defaultValue:!1}}},language:{controls:{language_select:{type:"dropdown_item",name:"language",data:BFN.DropDownData.languages,defaultValue:BeFunky.LanguageManager.language.app,useLabel:!1}}},zoom:{controls:{zoom_minus:{type:"button",interval:80,intervalDelay:240},zoom_plus:{type:"button",interval:80,intervalDelay:240},zoom_amount:{type:"slider",min:10,max:200,step:1,defaultValue:100,enableStartEvent:!0},zoom_exact_fit:{type:"button"},zoom_full_screen:{type:"button"},zoom_stagger_factor:{type:"static",defaultValue:1}}},color_picker_panel:{controls:{color_picker_panel_intensity:{type:"slider_item",name:"intensity",min:0,max:100,step:1,defaultValue:100}}},sas:{controls:{sas_cancel:{type:"button"},sas_save:{type:"button"},sas_share:{type:"button"},sas_image_type:{type:"toggle_group",defaultValue:"jpg",buttons:[{value:"jpg",langID:"JPG"},{value:"png",langID:"PNG"},{value:"pdf",langID:"PDF"}]},sas_image_quality:{type:"slider_item",name:"quality",unit:"",multiplier:1,min:0,max:100,step:1,defaultValue:98},sas_pdf_quality:{type:"toggle_group",defaultValue:"print",buttons:[{value:"print",langID:"pdf_print_quality_label"},{value:"web",langID:"pdf_web_quality_label"}]},sas_download_again:{type:"button"},sas_disable_save_complete_modal:{type:"checkbox",defaultValue:!1},sas_project_location:{type:"toggle_group",defaultValue:"".concat(BeFunky.isChromeOnIOS?"befunky":"computer"),buttons:[{value:"computer",langID:"computer"},{value:"befunky",langID:"BeFunky"}]}}}},BFN.ArtsyAdjustAndPaintToolObjects={},BFN.ArtsyAdjustAndPaintIDMap={},BFN.UIToolData){var vn=BFN.UIToolData[fn];vn.hasOwnProperty("viewstate")&&(BFN.toolViewstates[fn]=vn.viewstate,vn.viewstate===BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY&&vn.controls&&vn.controls["".concat(fn,"_id")]&&vn.controls["".concat(fn,"_id")].defaultValue&&(BFN.ArtsyAdjustAndPaintToolObjects[fn]=vn,BFN.ArtsyAdjustAndPaintIDMap[vn.controls["".concat(fn,"_id")].defaultValue]=fn)),-1!==BFN.accordionMenuPlusIDs.indexOf(fn)&&(vn.isPlus=!0)}BFN.FeaturedData={effect:["hipster_preset2","orton_style_preset1","vintage_colors_preset6","tinytype_preset3","bw_preset2","oldphoto_preset18"],artsy:["ART_0004","ART_0016","ART_0010","ART_0012","ART_0013","ART_0018"],frame:["filmstrip_2","grunge_1","instant_2","lace_1","rustic_7","art_deco_7"],texture:["bokeh_2","bokeh_4","grunge_6","metal_4","paper_6"]},BFN.EffectData=[{id:"effect_featured",name:"Featured",graphic:"tba",presets:[]},{id:"effect_favorites",name:"Favorites",graphic:"tba",presets:[]},{id:"bwfx",name:"B&W Tones",graphic:"tba",presets:[{id:"bwfx_preset1",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_1}]},{id:"bwfx_preset2",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_2}]},{id:"bwfx_preset3",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_3}]},{id:"bwfx_preset4",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_4}]},{id:"bwfx_preset5",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_5}]},{id:"bwfx_preset6",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_6}]},{id:"bwfx_preset7",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_7}]},{id:"bwfx_preset8",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_8}]},{id:"bwfx_preset9",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_9}]},{id:"bwfx_preset10",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_10}]},{id:"bwfx_preset11",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_11}]},{id:"bwfx_preset12",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_12.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_12}]},{id:"bwfx_preset13",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_13.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_13}]},{id:"bwfx_preset14",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_14.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_14}]},{id:"bwfx_preset15",isPlus:!0,thumb:"tba",effectID:"bwfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"bw_fx_15.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BWFX_PRESETS.PRESET_15}]}]},{id:"warmfx",name:"Warmer Tones",graphic:"tba",presets:[{id:"warmfx_preset1",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_1}]},{id:"warmfx_preset2",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_2}]},{id:"warmfx_preset3",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_3}]},{id:"warmfx_preset4",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_4}]},{id:"warmfx_preset5",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_5}]},{id:"warmfx_preset6",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_6}]},{id:"warmfx_preset7",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_7}]},{id:"warmfx_preset8",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_8}]},{id:"warmfx_preset9",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_9}]},{id:"warmfx_preset10",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_10}]},{id:"warmfx_preset11",isPlus:!0,thumb:"tba",effectID:"warmfx",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"warm_fx_11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WARMFX_PRESETS.PRESET_11}]}]},{id:"analog",name:"Analog Tones",graphic:"tba",presets:[{id:"analog_preset1",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_1}]},{id:"analog_preset2",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_2}]},{id:"analog_preset3",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_3}]},{id:"analog_preset4",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_4}]},{id:"analog_preset5",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_5}]},{id:"analog_preset6",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_6}]},{id:"analog_preset7",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_7}]},{id:"analog_preset8",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_8}]},{id:"analog_preset9",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_9}]},{id:"analog_preset10",isPlus:!0,thumb:"tba",effectID:"analog",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"analog_fx_10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.ANALOG_PRESETS.PRESET_10}]}]},{id:"cinematic",name:"Cinematic",graphic:"tba",presets:[{id:"film_grain",name:"Film Grain",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.FILM_GRAIN},{type:"slider_item",name:"intensity",defaultValue:100,min:1,max:400,step:1,unit:"%",multiplier:1},{type:"button",name:"generate"},{type:"checkbox_item",name:"monochromatic",defaultValue:!1}]},{id:"color_grading",name:"Color Grading",isPlus:!0,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.COLOR_GRADING},{type:"color_item",name:"shadows",defaultValue:"000000",emptyEnabled:!1,intensityEnabled:!0,fineChangeEnabled:!0},{type:"color_item",name:"midtones",defaultValue:"808080",emptyEnabled:!1,intensityEnabled:!0,fineChangeEnabled:!0},{type:"color_item",name:"highlights",defaultValue:"FFFFFF",emptyEnabled:!1,intensityEnabled:!0,fineChangeEnabled:!0}]},{id:"anamorphic",name:"Anamorphic",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.ANAMORPHIC},{type:"slider_item",name:"stretch",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"distortion",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"vignette_opacity",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"edge_blur",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]},{id:"lens_distortion",name:"Lens Distortion",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.LENS_DISTORTION},{type:"slider_item",name:"distortion",defaultValue:50,min:-100,max:100,step:1,unit:"%",multiplier:1}]},{id:"warped_blur",name:"Warped Blur",isPlus:!0,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.WARPED_BLUR},{type:"slider_item",name:"blur_amount",defaultValue:100,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"phase",defaultValue:100,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"scale",defaultValue:100,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"lightness",defaultValue:0,min:-100,max:100,step:1,unit:"%",multiplier:1}]},{id:"chromatic_aberration",name:"Chromatic Aberration",isPlus:!0,thumb:"tba",effectID:"cinematic",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CINEMATIC_PRESETS.CHROMATIC_ABERRATION},{type:"slider_item",name:"distortion",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"focal_point_x",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"focal_point_y",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]}]},{id:"multimedia",name:"Multimedia",graphic:"tba",presets:[{id:"scan_lines",name:"Scan Lines",isPlus:!1,useBasicAmount:!1,useGeneric:!1,thumb:"tba",effectID:"multimedia",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.MULTIMEDIA_PRESETS.SCAN_LINES},{type:"color_item",name:"line_color",defaultValue:"000000",fineChangeEnabled:!0,fineChangeEnabled:!0,emptyEnabled:!1,intensityEnabled:!1},{type:"slider_item",name:"opacity",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"spacing",defaultValue:2,min:1,max:Math.floor(BFN.minImageSize/2),step:1,unit:"px",multiplier:1},{type:"checkbox_item",name:"invert",defaultValue:!1}]},{id:"television",name:"Television",isPlus:!0,thumb:"tba",effectID:"multimedia",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.MULTIMEDIA_PRESETS.TELEVISION}]},{id:"halftone_duo",name:"Halftone Duo",isPlus:!0,thumb:"tba",effectID:"multimedia",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO},{type:"slider_item",name:"density",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"tolerance",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"color_item",name:"shadow_color",defaultValue:-1,emptyEnabled:!0,fineChangeEnabled:!0},{type:"color_item",name:"highlight_color",defaultValue:-1,emptyEnabled:!0,fineChangeEnabled:!0},{type:"checkbox_item",name:"invert",defaultValue:!1}]}]},{id:"glitch_art",name:"Glitch Art",graphic:"tba",presets:[{id:"corrupted",name:"Corrupted",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.CORRUPTED},{type:"slider_item",name:"complexity",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1,pips:{mode:"count",values:8,density:8},customClasses:["slider-notch"]},{type:"slider_item",name:"phase",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"strength",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"distorted",name:"Distorted",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.DISTORTED},{type:"toggle_group",name:"grayscale",defaultValue:1,buttons:[{langID:"color",value:0},{langID:"grayscale",value:1}]},{type:"slider_item",name:"phase",defaultValue:10,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"length",defaultValue:10,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"slide_horizontal",defaultValue:10,min:0,max:100,step:1,unit:"%",multiplier:1}]},{id:"segmented",name:"Segmented",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.SEGMENTED},{type:"toggle_group",name:"grayscale",defaultValue:0,buttons:[{langID:"color",value:0},{langID:"grayscale",value:1}]},{type:"color_palette",name:"colors",defaultValue:"0",colors:[["0","1","2","3","4","5"]],presetsOnly:!0,useLabel:!0,styleOverrides:{global:{width:"1.5rem",height:"1.5rem",borderRadius:"50%"},unique:[[{backgroundColor:"rgb(255,0,0)",background:"linear-gradient(135deg, rgba(255,0,0,1) 20%, rgba(0,255,0,1) 50%, rgba(0,0,255,1) 80%)"},{backgroundColor:"rgb(0,255,0)",background:"linear-gradient(135deg, rgba(255,0,0,1) 20%, rgba(0,0,255,1) 50%, rgba(0,255,0,1) 80%)"},{backgroundColor:"rgb(0,0,255)",background:"linear-gradient(135deg, rgba(0,255,0,1) 20%, rgba(255,0,0,1) 50%, rgba(0,0,255,1) 80%)"},{backgroundColor:"rgb(255,0,255)",background:"linear-gradient(135deg, rgba(0,255,0,1) 20%, rgba(255,0,255,1) 80%)"},{backgroundColor:"rgb(255,255,0)",background:"linear-gradient(135deg, rgba(255,255,0,1) 20%, rgba(0,0,255,1) 80%)"},{backgroundColor:"rgb(0,255,255)",background:"linear-gradient(135deg, rgba(0,255,255,1) 20%, rgba(255,0,0,1) 80%)"}]]}},{type:"slider_item",name:"slide_horizontal",defaultValue:10,min:-100,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"slide_vertical",defaultValue:0,min:-100,max:100,step:1,unit:"%",multiplier:1}]},{id:"fragmented",name:"Fragmented",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.FRAGMENTED},{type:"toggle_group",name:"grayscale",defaultValue:0,buttons:[{langID:"color",value:0},{langID:"grayscale",value:1}]},{type:"slider_item",name:"highlights",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"offset",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]},{id:"digitized",name:"Digitized",isPlus:!0,thumb:"tba",effectID:"glitch_art",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.GLITCH_ART_PRESETS.DIGITIZED},{type:"static",name:"useHiResThumb",defaultValue:!0},{type:"color_palette",name:"color_picker",defaultValue:-1,colors:[["FF5555","55CC55","8888FF",-1]],fineChangeEnabled:!0,emptyEnabled:!0},{type:"slider_item",name:"highlights",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"weight",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1},{type:"slider_item",name:"slide_horizontal",defaultValue:50,min:0,max:100,step:1,unit:"%",multiplier:1}]}]},{id:"bw",name:"Black & White",graphic:"tba",presets:[{id:"bw_preset2",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_2}]},{id:"bw_preset3",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_3}]},{id:"bw_preset4",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4}]},{id:"bw_preset5",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_5}]},{id:"bw_warmer",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A7874",colors:[["8A7874","85748A","926C6C","A08D5E"]],presetsOnly:!0},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_6}]},{id:"bw_cooler",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"818A74",colors:[["818A74","6E917E","6E7791","606D9B"]],presetsOnly:!0},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_7}]},{id:"bw_new_preset1",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_8}]},{id:"bw_new_preset2",isPlus:!0,thumb:"tba",effectID:"bw",params:[{type:"static",name:"imageURL",defaultValue:"bw_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.BLACK_WHITE_PRESETS.PRESET_9}]}]},{id:"chromatic",name:"Chromatic",graphic:"tba",presets:[{id:"hipster_preset1",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro1_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_1}]},{id:"hipster_preset2",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro2_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_2}]},{id:"hipster_preset3",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_3}]},{id:"hipster_preset4",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro3_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_4}]},{id:"hipster_preset5",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro2_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_5}]},{id:"hipster_preset6",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro4_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_6}]},{id:"hipster_preset7",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_7}]},{id:"hipster_preset8",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_8}]},{id:"hipster_preset9",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro2_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_9}]},{id:"hipster_preset10",isPlus:!0,thumb:"tba",effectID:"chromatic",fixTransparency:!1,params:[{type:"static",name:"imageURL",defaultValue:"retro5_vignette.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHROMATIC_PRESETS.PRESET_10}]}]},{id:"charcoal",name:"Charcoal",graphic:"tba",presets:[{id:"charcoal_preset1",isPlus:!0,thumb:"tba",effectID:"charcoal",params:[{type:"static",name:"imageURL",defaultValue:"tex_Charcola_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHARCOAL_PRESETS.PRESET_1},{type:"color_item",name:"color_value_1",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"000000",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]},{id:"charcoal_preset3",isPlus:!0,thumb:"tba",effectID:"charcoal",params:[{type:"static",name:"imageURL",defaultValue:"tex_Charcola_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CHARCOAL_PRESETS.PRESET_2},{type:"color_item",name:"color_value_1",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"93E25F",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]}]},{id:"colorpinhole",name:"Color Pinhole",graphic:"tba",presets:[{id:"colorpinhole_preset1",isPlus:!1,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_1}]},{id:"colorpinhole_preset2",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset2_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_2}]},{id:"colorpinhole_preset3",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset3_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_3}]},{id:"colorpinhole_preset4",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"static",name:"vignette_amount",defaultValue:.2},{type:"static",name:"fisheye_amount",defaultValue:1.05},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset4_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_4}]},{id:"colorpinhole_preset5",isPlus:!0,thumb:"tba",effectID:"colorpinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.05,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_5}]}]},{id:"cooler",name:"Cooler",graphic:"tba",presets:[{id:"cooling_filter_preset1",isPlus:!1,thumb:"tba",effectID:"cooler",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"006dff"},{type:"static",name:"amount",defaultValue:40}]},{id:"cooling_filter_preset2",isPlus:!0,thumb:"tba",effectID:"cooler",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"00b5ff"},{type:"static",name:"amount",defaultValue:50}]}]},{id:"crossprocess",name:"Cross Process",graphic:"tba",presets:[{id:"cross_process_preset1",isPlus:!1,thumb:"tba",effectID:"crossprocess",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"contrast",defaultValue:10,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"fcff00"},{type:"static",name:"curves",defaultValue:"crossProcess1"}]},{id:"cross_process_preset2",isPlus:!1,thumb:"tba",effectID:"crossprocess",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"contrast",defaultValue:10,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"47a5f5"},{type:"static",name:"curves",defaultValue:"crossProcess2"}]}]},{id:"cyanotype",name:"Cyanotype",graphic:"tba",presets:[{id:"cyanotype_preset1",isPlus:!1,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_1}]},{id:"cyanotype_preset2",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_2}]},{id:"cyanotype_preset3",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_3}]},{id:"cyanotype_preset4",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_4}]},{id:"cyanotype_preset5",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_5}]},{id:"cyanotype_preset6",isPlus:!0,thumb:"tba",effectID:"cyanotype",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_cyanotype_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.CYANOTYPE_PRESETS.PRESET_6}]}]},{id:"grungefx",name:"Grunge",graphic:"tba",presets:[{id:"grunge_preset1",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:25,max:126,step:1,unit:"",multiplier:1}]},{id:"grunge_preset2",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_2},{type:"static",name:"useBlur",defaultValue:!0}]},{id:"grunge_preset3",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_3},{type:"slider_item",name:"shadow_amount",defaultValue:124,min:50,max:154,step:1,unit:"",multiplier:1}]},{id:"grunge_preset4",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset4_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_4}]},{id:"grunge_preset5",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_5},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset6",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_6},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset9",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_9},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"detail_level",defaultValue:127,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset10",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_10},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset11",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_11},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset13",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset13.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_13},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset15",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset15.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_15},{type:"slider_item",name:"silhouette_amount",defaultValue:56,min:50,max:153,step:1,unit:"",multiplier:1}]},{id:"grunge_preset16",isPlus:!1,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset16.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_16}]},{id:"grunge_preset17",isPlus:!0,thumb:"tba",effectID:"grungefx",params:[{type:"static",name:"imageURL",defaultValue:"tex_grunge_preset17.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.GRUNGE_PRESETS.PRESET_17},{type:"slider_item",name:"silhouette_amount",defaultValue:127,min:50,max:153,step:1,unit:"",multiplier:1}]}]},{id:"hdr",name:"HDR",graphic:"tba",presets:[{id:"imitate_hdr_preset1",isPlus:!0,thumb:"tba",effectID:"hdr",params:[]},{id:"imitate_hdr_preset2",isPlus:!0,thumb:"tba",effectID:"hdr",params:[{type:"static",name:"useFragment",defaultValue:!0}]}]},{id:"holgaart",name:"Holga Art",graphic:"tba",presets:[{id:"holgaart_preset1",isPlus:!1,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_right",defaultValue:.03,min:.01,max:.1,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_left",defaultValue:-.025,min:-.1,max:-.01,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_1}]},{id:"holgaart_preset2",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_vertical",defaultValue:.5,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_horizontal",defaultValue:.5,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_2}]},{id:"holgaart_preset3",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_vertical",defaultValue:.1,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_horizontal",defaultValue:.5,min:-.9,max:.9,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_3}]},{id:"holgaart_preset4",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_right",defaultValue:.25,min:0,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_left",defaultValue:-.25,min:-.9,max:0,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"vignette_amount",defaultValue:.45,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_4},{type:"static",name:"imageURL",defaultValue:"tex_holga_preset4.jpg"}]},{id:"holgaart_preset5",isPlus:!0,thumb:"tba",effectID:"holgaart",params:[{type:"slider_item",name:"slide_right",defaultValue:.5,min:0,max:.9,step:.001,unit:"",multiplier:1e3},{type:"slider_item",name:"slide_left",defaultValue:-.25,min:-.9,max:0,step:.001,unit:"",multiplier:1e3},{type:"static",name:"presetID",defaultValue:BFN.CONST.HOLGA_ART_PRESETS.PRESET_5},{type:"static",name:"imageURL",defaultValue:"tex_holgaart_preset5.jpg"}]}]},{id:"instant",name:"Instant",graphic:"tba",presets:[{id:"instant_preset1",isPlus:!1,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_1}]},{id:"instant_preset2",isPlus:!1,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_2}]},{id:"instant_preset3",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_3}]},{id:"instant_preset4",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_4}]},{id:"instant_preset5",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_5}]},{id:"instant_preset6",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_6}]},{id:"instant_preset10",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_10}]},{id:"instant_preset11",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_11}]},{id:"instant_preset13",isPlus:!0,thumb:"tba",effectID:"instant",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_instant13.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.INSTANT_PRESETS.PRESET_13}]}]},{id:"lineartopia",name:"Line Artopia",graphic:"tba",presets:[{id:"line_artopia_preset1",isPlus:!1,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_angle",defaultValue:45,min:1,max:180,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"9e5724",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_1}]},{id:"line_artopia_preset2",isPlus:!0,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_angle",defaultValue:45,min:1,max:180,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"38a9ff",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_2}]},{id:"line_artopia_preset3",isPlus:!0,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"c22c2c",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_3},{type:"static",name:"imageURL",defaultValue:"tex_drafting_preset3.jpg"}]},{id:"line_artopia_preset4",isPlus:!0,thumb:"tba",effectID:"lineartopia",params:[{type:"slider_item",name:"sketch_detail",defaultValue:30,min:10,max:126,step:1,unit:"",multiplier:1},{type:"slider_item",name:"line_width",defaultValue:5,min:4,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"color",defaultValue:"505050",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_4},{type:"static",name:"imageURL",defaultValue:"tex_line_artopia_preset4.jpg"}]}]},{id:"lomoart",name:"Lomo Art",graphic:"tba",presets:[{id:"lomoart_preset7",isPlus:!1,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.1,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"gradURL",defaultValue:"lomoart_7_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_7}]},{id:"lomoart_preset1",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_1}]},{id:"lomoart_preset2",isPlus:!1,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_2}]},{id:"lomoart_preset3",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_3}]},{id:"lomoart_preset4",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.5,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_lomoart_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_4}]},{id:"lomoart_preset6",isPlus:!0,thumb:"tba",effectID:"lomoart",params:[{type:"color_item",name:"border_color",defaultValue:"FFFFFF",fineChangeEnabled:!0},{type:"slider_item",name:"border_thickness",defaultValue:25,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.LOMO_ART_PRESETS.PRESET_6}]}]},{id:"motioncolor",name:"Motion Color",graphic:"tba",presets:[{id:"motioncolor_preset1",isPlus:!1,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_1}]},{id:"motioncolor_preset2",isPlus:!0,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_2}]},{id:"motioncolor_preset3",isPlus:!0,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_motioncolort_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_3}]},{id:"motioncolor_preset4",isPlus:!0,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_motioncolort_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_4}]},{id:"motioncolor_preset5",isPlus:!1,thumb:"tba",effectID:"motioncolor",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.7,min:.01,max:.99,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_motioncolor_preset5_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.MOTION_COLOR_PRESETS.PRESET_5}]}]},{id:"oldphotofx",name:"Old Photo",graphic:"tba",presets:[{id:"oldphoto_preset1",isPlus:!1,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_1},{type:"slider_item",name:"grain_amount",defaultValue:.6,min:.2,max:5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:0,max:127,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset2",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_2},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset4",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_4},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset5",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset5_1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_5},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"color_amount",defaultValue:110,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"focal_blur",defaultValue:1,min:.1,max:1.5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset6",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_6},{type:"slider_item",name:"brightness",defaultValue:1,min:1,max:10,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset7",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_7},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset8",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_8},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset9",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_9},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset10",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_10},{type:"slider_item",name:"silhouette_amount",defaultValue:100,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset11",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_11},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset12",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_12},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset13",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset13_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_13},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset14",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_14},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset15",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset_15.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_15},{type:"slider_item",name:"silhouette_amount",defaultValue:115,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset16",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"tex_oldphoto_preset16.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_16},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"blur_amount",defaultValue:.2,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset17",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_17},{type:"slider_item",name:"silhouette_amount",defaultValue:105,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset18",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_18},{type:"slider_item",name:"contrast",defaultValue:.1,min:0,max:.5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"oldphoto_preset19",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"oldies_texture19.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19}]},{id:"oldphoto_preset20",isPlus:!0,thumb:"tba",effectID:"oldphotofx",params:[{type:"static",name:"imageURL",defaultValue:"oldies_texture20.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.OLD_PHOTO_PRESETS.PRESET_20}]}]},{id:"orton_style",name:"Orton Style",graphic:"tba",presets:[{id:"orton_style_preset1",isPlus:!0,thumb:"tba",effectID:"orton_style",params:[{type:"slider_item",name:"blur_amount",defaultValue:.5,min:.05,max:1,step:.01,unit:"",multiplier:100}]}]},{id:"patrioticfx",name:"Patriotic",graphic:"tba",presets:[{id:"patriotic_preset1",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_space",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_1}]},{id:"patriotic_preset2",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:86,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_space",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_2}]},{id:"patriotic_preset3",isPlus:!1,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"line_color",defaultValue:"aa0000",fineChangeEnabled:!0},{type:"color_item",name:"background_color",defaultValue:"437fff",fineChangeEnabled:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_3}]},{id:"patriotic_preset4",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_4}]},{id:"patriotic_preset5",isPlus:!1,thumb:"tba",effectID:"patrioticfx",params:[{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_5}]},{id:"patriotic_preset6",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:86,min:50,max:152,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_space",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"slider_item",name:"star_size",defaultValue:.3,min:.1,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_patriot_preset6_4.jpg"},{type:"static",name:"tileURL",defaultValue:"256star.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_6}]},{id:"patriotic_preset7",isPlus:!0,thumb:"tba",effectID:"patrioticfx",params:[{type:"slider_item",name:"smoothness",defaultValue:.03,min:.03,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"red",defaultValue:.4,min:.1,max:.6,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"navy",defaultValue:.14,min:.1,max:.6,step:.01,unit:"",multiplier:100},{type:"static",name:"useBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.PATRIOTIC_PRESETS.PRESET_7}]}]},{id:"pinhole",name:"Pinhole",graphic:"tba",presets:[{id:"pinhole_preset1",isPlus:!1,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"motion_angle",defaultValue:120,min:0,max:360,step:1,unit:"",multiplier:1},{type:"slider_item",name:"motion_amount",defaultValue:10,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_1}]},{id:"pinhole_preset2",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_pinhole_preset2_b.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_2}]},{id:"pinhole_preset3",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"fisheye_amount",defaultValue:1.1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_pinhole3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_3}]},{id:"pinhole_preset4",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"motion_angle",defaultValue:0,min:0,max:360,step:1,unit:"",multiplier:1},{type:"slider_item",name:"motion_amount",defaultValue:10,min:5,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"fisheye_amount",defaultValue:1,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_pinhole_preset4_r.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_4}]},{id:"pinhole_preset5",isPlus:!0,thumb:"tba",effectID:"pinhole",params:[{type:"slider_item",name:"vignette_amount",defaultValue:.15,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"fisheye_amount",defaultValue:1.05,min:1,max:1.5,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"tex_colorpinhole_preset4_2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.PINHOLE_PRESETS.PRESET_5}]}]},{id:"popartfx",name:"Pop Art",graphic:"tba",presets:[{id:"popart_preset1",isPlus:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"gradURL",defaultValue:"popart_preset1_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_1}]},{id:"popart_preset2",isPlus:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:204,min:50,max:230,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"tex_popart_preset3.jpg"},{type:"static",name:"gradURL",defaultValue:"popart_preset1_grad.jpg"},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_2}]},{id:"popart_preset3",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:204,min:50,max:230,step:1,unit:"",multiplier:1},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"imageURL",defaultValue:"tex_popart_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_3}]},{id:"popart_preset4",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_4}]},{id:"popart_preset5",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:3,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_5}]},{id:"popart_preset6",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"imageURL",defaultValue:"tex_popart_preset6.jpg"},{type:"static",name:"gradURL",defaultValue:"popart_preset6_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_6}]},{id:"popart_preset7",isPlus:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"gradURL",defaultValue:"popart_preset1_grad.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_7}]},{id:"popart_preset9",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_9}]},{id:"popart_preset10",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smooth_amount",defaultValue:.02,min:.02,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"color_detail",defaultValue:4,min:4,max:15,step:.01,unit:"",multiplier:100},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_10}]},{id:"popart_preset11",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"gradURL",defaultValue:"popart_preset11_grad.jpg"},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_11}]},{id:"popart_preset13",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"color_item",name:"color_value_1",defaultValue:"ff0000",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"ffea00",fineChangeEnabled:!0},{type:"color_item",name:"color_value_3",defaultValue:"00d1ff",fineChangeEnabled:!0},{type:"color_item",name:"color_value_4",defaultValue:"37ff00",fineChangeEnabled:!0},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_13}]},{id:"popart_preset14",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"static",name:"isAdaptive",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_14}]},{id:"popart_preset15",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"isHalftone",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_15}]},{id:"popart_preset16",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_16}]},{id:"popart_preset17",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_17}]},{id:"popart_preset18",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_18}]},{id:"popart_preset19",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"halftoneURL",defaultValue:"popart_texture_halftone.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_19}]},{id:"popart_preset20",isPlus:!0,thumb:"tba",effectID:"popartfx",params:[{type:"slider_item",name:"silhouette_amount",defaultValue:102,min:50,max:152,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.POPART_PRESETS.PRESET_20}]}]},{id:"sepia",name:"Sepia",graphic:"tba",presets:[{id:"sepia_preset1",isPlus:!1,thumb:"tba",effectID:"sepia",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]}]},{id:"stenciler",name:"Stenciler",graphic:"tba",presets:[{id:"stenciler_preset1",isPlus:!1,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_1},{type:"static",name:"useBlur",defaultValue:!0},{type:"color_item",name:"color",defaultValue:"000000",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset2",isPlus:!1,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset2.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_2},{type:"static",name:"useBlur",defaultValue:!0},{type:"color_item",name:"color",defaultValue:"4590d1",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.6,min:0,max:1,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset3",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_3},{type:"color_item",name:"color",defaultValue:"000000",fineChangeEnabled:!0},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset4",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset4.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_4},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset6",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset6.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_6},{type:"static",name:"useBlur",defaultValue:!0},{type:"slider_item",name:"color_detail",defaultValue:4,min:2,max:15,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset7",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset7.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_7},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset8",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset8.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_8},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset9",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset9.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_9},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset10",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset10.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_10},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]},{id:"stenciler_preset11",isPlus:!0,thumb:"tba",effectID:"stenciler",params:[{type:"static",name:"imageURL",defaultValue:"tex_stenciler_preset11.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.STENCILER_PRESETS.PRESET_11},{type:"slider_item",name:"detail_level",defaultValue:.45,min:0,max:.75,step:.01,unit:"",multiplier:100}]}]},{id:"summer",name:"Summer",graphic:"tba",presets:[{id:"summer_preset1",isPlus:!1,thumb:"tba",effectID:"summer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"summer_texture.png"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUMMER_PRESETS.PRESET_1}]},{id:"summer_preset2",isPlus:!0,thumb:"tba",effectID:"summer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"summer_texture3.png"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUMMER_PRESETS.PRESET_2}]}]},{id:"sunburst",name:"Sunburst",graphic:"tba",presets:[{id:"sunburst_preset1",isPlus:!1,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"imageURL",defaultValue:"tex_sunburst_preset1.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_1},{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"silhouette_amount",defaultValue:204,min:102,max:255,step:1,unit:"",multiplier:1}]},{id:"sunburst_preset2",isPlus:!1,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_2},{type:"color_item",name:"color",defaultValue:"e9e9e9",fineChangeEnabled:!0},{type:"slider_item",name:"halftone_size",defaultValue:4,min:3,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sunburst_amount",defaultValue:30,min:5,max:50,step:1,unit:"",multiplier:1}]},{id:"sunburst_preset3",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"imageURL",defaultValue:"tex_sunburst_preset3.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_3},{type:"slider_item",name:"grain_amount",defaultValue:1,min:.1,max:5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"sunburst_amount",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"sunburst_preset4",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_4},{type:"slider_item",name:"grain_amount",defaultValue:1.1,min:.1,max:5,step:.01,unit:"",multiplier:100}]},{id:"sunburst_preset5",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"imageURL",defaultValue:"tex_sunburst_preset5.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_5},{type:"slider_item",name:"grain_amount",defaultValue:.8,min:.1,max:5,step:.01,unit:"",multiplier:100}]},{id:"sunburst_preset6",isPlus:!0,thumb:"tba",effectID:"sunburst",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.SUNBURST_PRESETS.PRESET_6},{type:"slider_item",name:"grain_amount",defaultValue:1.1,min:.1,max:5,step:.01,unit:"",multiplier:100}]}]},{id:"tiltshiftfx",name:"Tilt Shift",graphic:"tba",presets:[{id:"tiltshift_preset1",isPlus:!1,thumb:"tba",effectID:"tiltshiftfx",params:[{type:"slider_item",name:"size",defaultValue:3.5,min:1,max:10,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"blur_amount",defaultValue:.5,min:.05,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"angle",defaultValue:0,min:-180,max:180,step:1,unit:"",multiplier:1},{type:"slider_item",name:"slide_vertical",defaultValue:0,min:-.5,max:.5,step:.01,unit:"",multiplier:100},{type:"static",name:"useBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TILT_SHIFT_PRESETS.PRESET_1}]},{id:"tiltshift_preset2",isPlus:!0,thumb:"tba",effectID:"tiltshiftfx",params:[{type:"slider_item",name:"size",defaultValue:2.5,min:1,max:5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"blur_amount",defaultValue:.5,min:.05,max:1,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"slide_vertical",defaultValue:0,min:-.5,max:.5,step:.01,unit:"",multiplier:100},{type:"slider_item",name:"slide_horizontal",defaultValue:0,min:-.5,max:.5,step:.01,unit:"",multiplier:100},{type:"static",name:"useBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TILT_SHIFT_PRESETS.PRESET_2}]}]},{id:"tinytype",name:"Tin Type",graphic:"tba",presets:[{id:"tinytype_preset1",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_1.jpg"}]},{id:"tinytype_preset2",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"818A74",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_2.jpg"}]},{id:"tinytype_preset3",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_3.jpg"}]},{id:"tinytype_preset4",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_4.jpg"}]},{id:"tinytype_preset5",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_5.jpg"}]},{id:"tinytype_preset6",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_6.jpg"}]},{id:"tinytype_preset7",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_7.jpg"}]},{id:"tinytype_preset8",isPlus:!0,thumb:"tba",effectID:"tinytype",params:[{type:"toggle_group",name:"modeBW",defaultValue:1,buttons:[{langID:"lighter",value:0},{langID:"medium",value:1},{langID:"darker",value:2}]},{type:"color_palette",name:"modeColor",defaultValue:"8A8174",colors:[["8A8174","818A74","8A7874","85748A","6a5f37"],["926C6C","A08D5E","6E7791","6E917E","4d3846"]],presetsOnly:!0},{type:"static",name:"imageURL",defaultValue:"tintype_texture_8.jpg"}]}]},{id:"unitedcolors",name:"United Colors",graphic:"tba",presets:[{id:"unitedcolors_preset1",isPlus:!1,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_1},{type:"color_item",name:"color_value_1",defaultValue:"fff700",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"ff0000",fineChangeEnabled:!0}]},{id:"unitedcolors_preset2",isPlus:!0,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_2},{type:"color_item",name:"color_value_1",defaultValue:"f3ff00",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"0084ff",fineChangeEnabled:!0}]},{id:"unitedcolors_preset3",isPlus:!1,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_3},{type:"color_item",name:"color_value_1",defaultValue:"bcff6f",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"ad3232",fineChangeEnabled:!0}]},{id:"unitedcolors_preset4",isPlus:!0,thumb:"tba",effectID:"unitedcolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.UNITED_COLORS_PRESETS.PRESET_4},{type:"color_item",name:"color_value_1",defaultValue:"ffa1db",fineChangeEnabled:!0},{type:"color_item",name:"color_value_2",defaultValue:"1b6826",fineChangeEnabled:!0}]}]},{id:"warmer",name:"Warmer",graphic:"tba",presets:[{id:"warming_filter_preset1",isPlus:!1,thumb:"tba",effectID:"warmer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"ec8a00"},{type:"static",name:"amount",defaultValue:40}]},{id:"warming_filter_preset2",isPlus:!0,thumb:"tba",effectID:"warmer",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"color",defaultValue:"ebb113"},{type:"static",name:"amount",defaultValue:50}]}]},{id:"viewfinder",name:"Viewfinder",graphic:"tba",presets:[{id:"viewfinder_preset1",isPlus:!1,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect1_hardlight.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_1}]},{id:"viewfinder_preset2",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect2_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_2}]},{id:"viewfinder_preset3",isPlus:!1,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect3_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_3}]},{id:"viewfinder_preset4",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect4_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_4}]},{id:"viewfinder_preset5",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect5_lighten_opacity50.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_5}]},{id:"viewfinder_preset6",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect6_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_6}]},{id:"viewfinder_preset7",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect7_multiply.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_7}]},{id:"viewfinder_preset8",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect8_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_8}]},{id:"viewfinder_preset9",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect9_darken.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_9}]},{id:"viewfinder_preset10",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect10_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_10}]},{id:"viewfinder_preset11",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect11_hardlight.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_11}]},{id:"viewfinder_preset12",isPlus:!0,thumb:"tba",effectID:"viewfinder",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"imageURL",defaultValue:"org_viewfinder_effect12_overlay.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.VIEWFINDER_PRESETS.PRESET_12}]}]},{id:"vintagecolors",name:"Vintage Colors",graphic:"tba",presets:[{id:"vintage_colors_preset6",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_6}]},{id:"vintage_colors_preset1",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_1},{type:"static",name:"color1",defaultValue:"bcff6f"},{type:"static",name:"color2",defaultValue:"ad3232"}]},{id:"vintage_colors_preset2",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_2},{type:"static",name:"color1",defaultValue:"ffff9d"},{type:"static",name:"color2",defaultValue:"c61689"}]},{id:"vintage_colors_preset3",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_3},{type:"static",name:"color1",defaultValue:"fff77d"},{type:"static",name:"color2",defaultValue:"419dff"}]},{id:"vintage_colors_preset4",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_4},{type:"static",name:"color1",defaultValue:"ffc6e7"},{type:"static",name:"color2",defaultValue:"0f9800"}]},{id:"vintage_colors_preset5",isPlus:!0,useBasicAmount:!1,useGeneric:!1,usePaint:!1,thumb:"tba",effectID:"vintagecolors",params:[{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_5},{type:"static",name:"color1",defaultValue:["bcff6f","ffff9d","fff77d","ffc6e7"]},{type:"static",name:"color2",defaultValue:["ad3232","c61689","419dff","0f9800"]}]},{id:"vintage_colors_preset7",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7},{type:"static",name:"imageURL",defaultValue:"lut_vintage_preset7.jpg"}]},{id:"vintage_colors_preset8",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8},{type:"static",name:"imageURL",defaultValue:"lut_vintage_preset8.jpg"}]},{id:"vintage_colors_preset9",isPlus:!0,thumb:"tba",effectID:"vintagecolors",params:[{type:"slider_item",name:"highlights",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"shadows",defaultValue:0,min:0,max:100,step:1,unit:"",multiplier:1},{type:"static",name:"presetID",defaultValue:BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9},{type:"static",name:"imageURL",defaultValue:"lut_vintage_preset9.jpg"}]}]},{id:"winterfx",name:"Winter",graphic:"tba",presets:[{id:"frosteffect",isPlus:!1,thumb:"tba",effectID:"winterfx",params:[{type:"slider_item",name:"frost_amount",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"frost_pattern.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WINTER_PRESETS.PRESET_1}]},{id:"wintereffect",isPlus:!0,thumb:"tba",effectID:"winterfx",params:[{type:"slider_item",name:"opacity",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"imageURL",defaultValue:"snow_texture.jpg"},{type:"static",name:"presetID",defaultValue:BFN.CONST.WINTER_PRESETS.PRESET_2}]}]},{id:"touchup",name:"Touch Up",graphic:"tba",presets:[{id:"perfectskin",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"isBlur2",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.perfectskin}]},{id:"wrinkles",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.wrinkles}]},{id:"bronzer",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color_palette",name:"color_palette",defaultValue:"724301",colors:["724301","9A7035","D2AF7E","FCDDB1"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.bronzer}]},{id:"blush",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.5,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"FFCDD9",colors:["FFCDD9","ECB4Bf","DA798A","A16B72","703D42","D9BA9A","CEA989","A9856B","B28061","825436"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.blush}]},{id:"flashspot",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.flashspot}]},{id:"mascara",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.mascara}]},{id:"eye_color",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.7,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"64C4FF",colors:["64C4FF","81BC36","7A5C3A","BBBEBA"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_color}]},{id:"eye_brighten",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eye_brighten}]},{id:"eyebrow_pencil",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:1,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"3D3A33",colors:["3D3A33","74717A","835836","A58646"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"curves",defaultValue:"blackenCurve"},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.eyebrow_pencil}]},{id:"fix_redeye",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.fix_redeye}]},{id:"lipstick",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.7,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"EF4292",colors:["EF4292","D7058C","DA085F","E12438"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.lipstick}]},{id:"teeth_whiten",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"static",name:"isBlur",defaultValue:!0},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.teeth_whiten}]},{id:"hair_color",isPlus:!1,thumb:"tba",effectID:"touchup",params:[{type:"slider_item",name:"strength",defaultValue:.7,min:0,max:1,step:.01,unit:"",multiplier:100},{type:"color",name:"color_palette",defaultValue:"e8D18A",colors:["e8D18A","935118","C58B4E","0C0C17"]},{type:"static",name:"isBlur",defaultValue:!1},{type:"static",name:"presetID",defaultValue:BFN.CONST.TOUCH_UP_PRESETS.haircolor}]}]}].filter(Boolean),BFN.EffectsNoPaint=[];for(var yn=0;yn<BFN.EffectData.length;yn++)for(var xn=BFN.EffectData[yn],_n=0;_n<xn.presets.length;_n++){var In=xn.presets[_n],Tn=In.hasOwnProperty("name")?In.name:"".concat(xn.name," ").concat(_n+1);In.params.push({type:"static",name:"effectName",defaultValue:Tn});var bn="".concat(xn.id,"_").concat(In.id);BFN.toolViewstates[bn]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT,In.hasOwnProperty("usePaint")&&!In.usePaint&&BFN.EffectsNoPaint.push(bn);for(var Sn=0;Sn<In.params.length;Sn++){var Cn=In.params[Sn];"color"!==Cn.type&&"color_item"!==Cn.type||Cn.emptyEnabled||(Cn.emptyEnabled=!1)}In.params.push({type:"static",name:"fadeable",defaultValue:!0}),In.params.push({type:"static",name:"fixTransparency",defaultValue:!!In.fixTransparency})}BFN.ArtsyData=[{id:"artsy_favorites",name:"Favorites",langID:"favorites",presets:[]},{id:"digitalart",name:"Digital Art",langID:"artsy_digital_art",presets:[{id:"ART_0001",name:"Cartoonizer DLX",langID:"artsy_cartoonizer",isPlus:!0,thumb:"cartoonizer-dlx.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0002",name:"Underpainting DLX ",langID:"artsy_underpainting",isPlus:!0,thumb:"underpainting-dlx.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0004",name:"Oil Painting DLX",langID:"artsy_oil_painting",isPlus:!0,thumb:"oil-painting-dlx.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0007",name:"Graphic Novel DLX",langID:"artsy_graphic_novel",isPlus:!0,thumb:"graphic-novel-dlx.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:75,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_amount",defaultValue:30,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0008",name:"Impressionist DLX",langID:"artsy_impressionist",isPlus:!0,thumb:"impressionist-dlx.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_amount",defaultValue:20,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0009",name:"Ink Wash DLX",langID:"artsy_ink_wash",isPlus:!0,thumb:"ink-wash-dlx.jpg",params:[{type:"slider_item",name:"detail_level",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0006",name:"Watercolor DLX",langID:"artsy_watercolor",isPlus:!0,thumb:"watercolor-dlx.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0003",name:"Cross Hatch DLX",langID:"artsy_cross_hatch",isPlus:!0,thumb:"cross-hatch-dlx.jpg",params:[{type:"slider_item",name:"sharpen",defaultValue:50,min:0,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0005",name:"Pop Art DLX",langID:"artsy_pop_art",isPlus:!0,thumb:"pop-art-dlx.jpg",params:[]}]},{id:"cartoonizer",name:"Cartoonizer",langID:"artsy_cartoonizer",presets:[{id:"ART_0016",isPlus:!0,thumb:"cartoonizer-1.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:40,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:20,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:60,min:12,max:100,step:1,unit:"",multiplier:1}]},{id:"233",isPlus:!0,thumb:"cartoonizer-2.jpg",params:[{type:"slider_item",name:"sketch_brightness",defaultValue:35,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_smoothness",defaultValue:100,min:10,max:200,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:17,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"sketch_smoothness",defaultValue:20,min:1,max:30,step:1,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:3,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:350,min:4,max:1024,step:1,unit:"",multiplier:1}]},{id:"172",isPlus:!0,thumb:"cartoonizer-3.jpg",params:[{type:"slider_item",name:"sketch_detail",defaultValue:15,min:5,max:91,step:2,unit:"",multiplier:1},{type:"slider_item",name:"sketch_smoothness",defaultValue:20,min:1,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:1,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:36,min:10,max:80,step:2,unit:"",multiplier:1}]},{id:"13",isPlus:!0,thumb:"cartoonizer-4.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:3,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:30,min:10,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:13,min:5,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"halftone_size",defaultValue:5,min:3,max:45,step:2,unit:"",multiplier:1}]},{id:"14",isPlus:!0,thumb:"cartoonizer-5.jpg",params:[{type:"slider_item",name:"sketch_detail",defaultValue:31,min:3,max:91,step:1,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:50,min:10,max:80,step:1,unit:"",multiplier:1}]},{id:"48",isPlus:!0,thumb:"cartoonizer-6.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:3,min:3,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"color_detail",defaultValue:45,min:10,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:13,min:5,max:51,step:1,unit:"",multiplier:1}]}]},{id:"polyart",name:"Poly Art",langID:"artsy_poly_art",presets:[{id:"AI_ARTSY_STYLE_0",name:"Poly Art DLX 1",isPlus:!0,thumb:"poly-art-1.jpg",params:[]},{id:"AI_ARTSY_STYLE_1",name:"Poly Art DLX 2",isPlus:!0,thumb:"poly-art-2.jpg",params:[]},{id:"AI_ARTSY_STYLE_2",name:"Poly Art DLX 3",isPlus:!0,thumb:"poly-art-3.jpg",params:[]},{id:"AI_ARTSY_STYLE_3",name:"Poly Art DLX 4",isPlus:!0,thumb:"poly-art-4.jpg",params:[]},{id:"AI_ARTSY_STYLE_4",name:"Poly Art DLX 5",isPlus:!0,thumb:"poly-art-5.jpg",params:[]},{id:"AI_ARTSY_STYLE_5",name:"Poly Art DLX 6",isPlus:!0,thumb:"poly-art-6.jpg",params:[]}]},{id:"mosaic",name:"Mosaic",langID:"artsy_mosaic",presets:[{id:"AI_ARTSY_STYLE_6",name:"Mosaic DLX 1",isPlus:!0,thumb:"mosaic-1.jpg",params:[]},{id:"AI_ARTSY_STYLE_7",name:"Mosaic DLX 2",isPlus:!0,thumb:"mosaic-2.jpg",params:[]}]},{id:"pastel",name:"Pastel",langID:"artsy_pastel",presets:[{id:"AI_ARTSY_STYLE_12",name:"Pastel DLX 1",isPlus:!0,thumb:"pastel-1.jpg",params:[]},{id:"AI_ARTSY_STYLE_18",name:"Pastel DLX 2",isPlus:!0,thumb:"pastel-2.jpg",params:[]}]},{id:"penart",name:"Pen Art",langID:"artsy_pen_art",presets:[{id:"AI_ARTSY_STYLE_23",name:"Pen Art DLX 1",isPlus:!0,thumb:"pen-art-1.jpg",params:[]},{id:"AI_ARTSY_STYLE_24",name:"Pen Art DLX 2",isPlus:!0,thumb:"pen-art-2.jpg",params:[]}]},{id:"gouache",name:"Gouache",langID:"artsy_gouache",presets:[{id:"AI_ARTSY_STYLE_11",name:"Gouache DLX 1",isPlus:!0,thumb:"gouache-dlx-1.jpg",params:[]},{id:"259",name:"Gouache 1",isPlus:!0,thumb:"gouache-1.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"smoothness",defaultValue:30,min:1,max:50,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:10,min:2,max:100,step:1,unit:"",multiplier:1}]},{id:"251",name:"Gouache 2",isPlus:!0,thumb:"gouache-2.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"smoothness",defaultValue:25,min:1,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:15,min:3,max:51,step:1,unit:"",multiplier:1}]},{id:"258",name:"Gouache 3",isPlus:!0,thumb:"gouache-3.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"smoothness",defaultValue:30,min:1,max:30,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:10,min:2,max:100,step:1,unit:"",multiplier:1}]}]},{id:"impressionist",name:"Impressionist",langID:"artsy_impressionist",presets:[{id:"AI_ARTSY_STYLE_16",name:"Impressionist DLX 1",isPlus:!0,thumb:"impressionist-dlx-1.jpg",params:[]},{id:"AI_ARTSY_STYLE_17",name:"Impressionist DLX 2",isPlus:!0,thumb:"impressionist-dlx-2.jpg",params:[]},{id:"AI_ARTSY_STYLE_19",name:"Impressionist DLX 3",isPlus:!0,thumb:"impressionist-dlx-3.jpg",params:[]},{id:"59",name:"Impressionist 1",isPlus:!0,thumb:"impressionist-1.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:40,max:160,step:1,unit:"",multiplier:1}]},{id:"60",name:"Impressionist 2",isPlus:!0,thumb:"impressionist-2.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:150,min:40,max:200,step:1,unit:"",multiplier:1}]},{id:"61",name:"Impressionist 3",isPlus:!0,thumb:"impressionist-3.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:40,max:160,step:1,unit:"",multiplier:1}]},{id:"62",name:"Impressionist 4",isPlus:!0,thumb:"impressionist-4.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:40,max:160,step:1,unit:"",multiplier:1}]},{id:"63",name:"Impressionist 5",isPlus:!0,thumb:"impressionist-5.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:4,min:1,max:8,step:1,unit:"",multiplier:1},{type:"slider_item",name:"highlight_area",defaultValue:120,min:20,max:160,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:3,min:1,max:15,step:1,unit:"",multiplier:1}]}]},{id:"inkify",name:"Inkify",langID:"artsy_inkify",presets:[{id:"AI_ARTSY_STYLE_25",name:"Inkify DLX 1",isPlus:!0,thumb:"inkify-dlx-1.jpg",params:[]},{id:"ART_0011",name:"Inkify 1",isPlus:!0,thumb:"inkify-1.jpg",params:[{type:"slider_item",name:"detail_level",defaultValue:43,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:0,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0014",name:"Inkify 2",isPlus:!0,thumb:"inkify-2.jpg",params:[{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:0,min:-50,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"sketch_color",defaultValue:"C800FF"}]},{id:"ART_0015",name:"Inkify 3",isPlus:!0,thumb:"inkify-3.jpg",params:[{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"detail_level",defaultValue:0,min:-50,max:50,step:1,unit:"",multiplier:1},{type:"color_item",name:"sketch_color",defaultValue:"75A458"}]},{id:"ART_0012",name:"Inkify 4",isPlus:!0,thumb:"inkify-4.jpg",params:[{type:"slider_item",name:"detail_level",defaultValue:32,min:1,max:75,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:0,min:1,max:100,step:1,unit:"",multiplier:1}]}]},{id:"oilpainting",name:"Oil Painting",langID:"artsy_oil_painting",presets:[{id:"AI_ARTSY_STYLE_8",name:"Oil Painting DLX 1",isPlus:!0,thumb:"oil-painting-dlx-1.jpg",params:[]},{id:"AI_ARTSY_STYLE_10",name:"Oil Painting DLX 2",isPlus:!0,thumb:"oil-painting-dlx-2.jpg",params:[]},{id:"AI_ARTSY_STYLE_15",name:"Oil Painting DLX 3",isPlus:!0,thumb:"oil-painting-dlx-3.jpg",params:[]},{id:"AI_ARTSY_STYLE_20",name:"Oil Painting DLX 4",isPlus:!0,thumb:"oil-painting-dlx-4.jpg",params:[]},{id:"84",name:"Oil Painting 1",isPlus:!0,thumb:"oil-painting-1.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:20,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_length",defaultValue:8,min:3,max:19,step:1,unit:"",multiplier:1}]},{id:"86",name:"Oil Painting 2",isPlus:!0,thumb:"oil-painting-2.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:5,min:3,max:31,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_length",defaultValue:12,min:3,max:41,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]},{id:"85",name:"Oil Painting 3",isPlus:!0,thumb:"oil-painting-3.jpg",maxPixels:78e5,params:[{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:51,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_length",defaultValue:8,min:3,max:19,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]},{id:"88",name:"Oil Painting 4",isPlus:!0,thumb:"oil-painting-4.jpg",params:[{type:"slider_item",name:"color_detail",defaultValue:30,min:10,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:21,min:3,max:51,step:2,unit:"",multiplier:1}]},{id:"89",name:"Oil Painting 5",isPlus:!0,thumb:"oil-painting-5.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:21,min:3,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:25,min:17,max:80,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]},{id:"90",name:"Oil Painting 6",isPlus:!0,thumb:"oil-painting-6.jpg",params:[{type:"slider_item",name:"brush_length",defaultValue:18,min:11,max:65,step:1,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:10,min:2,max:45,step:1,unit:"",multiplier:1},{type:"slider_item",name:"paint_amount",defaultValue:0,min:-100,max:100,step:1,unit:"",multiplier:1}]}]},{id:"pointillism",name:"Pointillism",langID:"artsy_pointillism",presets:[{id:"AI_ARTSY_STYLE_13",name:"Pointillism DLX 1",isPlus:!0,thumb:"pointillism-dlx-1.jpg",params:[]},{id:"273",name:"Pointillism 1",isPlus:!0,thumb:"pointillism-1.jpg",params:[{type:"slider_item",name:"underpainting_brush_detail",defaultValue:21,min:1,max:21,step:1,unit:"",multiplier:1},{type:"slider_item",name:"underpainting_brush_size",defaultValue:3,min:1,max:70,step:1,unit:"",multiplier:1},{type:"slider_item",name:"overpainting_brush_detail",defaultValue:25,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"overpainting_brush_size",defaultValue:2,min:2,max:100,step:1,unit:"",multiplier:1}]},{id:"274",name:"Pointillism 2",isPlus:!0,thumb:"pointillism-2.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:100,step:1,unit:"",multiplier:1}]},{id:"275",name:"Pointillism 3",isPlus:!0,thumb:"pointillism-3.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:8,min:2,max:100,step:1,unit:"",multiplier:1}]},{id:"276",name:"Pointillism 4",isPlus:!0,thumb:"pointillism-4.jpg",params:[{type:"slider_item",name:"brush_detail",defaultValue:15,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"brush_size",defaultValue:8,min:3,max:100,step:1,unit:"",multiplier:1}]}]},{id:"sketcher",name:"Sketcher",langID:"artsy_sketcher",presets:[{id:"ART_0013",isPlus:!0,thumb:"sketcher-1.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:40,min:0,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sketch_detail",defaultValue:20,min:0,max:100,step:1,unit:"",multiplier:1},{type:"color_item",name:"background_color",defaultValue:"FFFFFF"},{type:"color_item",name:"sketch_color",defaultValue:"000000"}]},{id:"269",isPlus:!0,thumb:"sketcher-2.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:1,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1},{type:"color_item",name:"background_color",defaultValue:"FFFFFF"},{type:"color_item",name:"sketch_color",defaultValue:"000000"}]},{id:"239",isPlus:!0,thumb:"sketcher-3.jpg",params:[{type:"slider_item",name:"halftone_size",defaultValue:5,min:3,max:31,step:2,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:2,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1}]},{id:"243",isPlus:!0,thumb:"sketcher-4.jpg",params:[{type:"slider_item",name:"dot_size",defaultValue:5,min:3,max:31,step:2,unit:"",multiplier:1},{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:2,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"color_detail",defaultValue:30,min:10,max:80,step:1,unit:"",multiplier:1},{type:"color_item",name:"highlight_color",defaultValue:"CAF8FF"},{type:"color_item",name:"shadow_color",defaultValue:"00A6FF"}]},{id:"250",isPlus:!0,thumb:"sketcher-5.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:2,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:13,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"halftone_size",defaultValue:5,min:3,max:31,step:2,unit:"",multiplier:1},{type:"color_item",name:"background_color",defaultValue:"FFFF00"},{type:"color_item",name:"sketch_color",defaultValue:"DD2020"}]},{id:"264",isPlus:!0,thumb:"sketcher-6.jpg",params:[{type:"slider_item",name:"clutter_cleaner",defaultValue:2,min:1,max:5,step:.1,unit:"",multiplier:10},{type:"slider_item",name:"sketch_detail",defaultValue:11,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"dot_size",defaultValue:7,min:3,max:31,step:2,unit:"",multiplier:1},{type:"color_item",name:"sketch_color",defaultValue:"FF3DEF"},{type:"color_item",name:"background_color",defaultValue:"FFFFFF"}]}]},{id:"underpainting",name:"Underpainting",langID:"artsy_underpainting",presets:[{id:"ART_0010",isPlus:!0,thumb:"underpainting-1.jpg",params:[{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0017",isPlus:!0,thumb:"underpainting-2.jpg",params:[{type:"slider_item",name:"paint_amount",defaultValue:48,min:8,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:25,min:1,max:100,step:1,unit:"",multiplier:1}]}]},{id:"watercolor",name:"Watercolor",langID:"artsy_watercolor",presets:[{id:"AI_ARTSY_STYLE_9",name:"Watercolor DLX 1",isPlus:!0,thumb:"watercolor-dlx-1.jpg",params:[]},{id:"AI_ARTSY_STYLE_14",name:"Watercolor DLX 2",isPlus:!0,thumb:"watercolor-dlx-2.jpg",params:[]},{id:"AI_ARTSY_STYLE_21",name:"Watercolor DLX 3",isPlus:!0,thumb:"watercolor-dlx-3.jpg",params:[]},{id:"AI_ARTSY_STYLE_22",name:"Watercolor DLX 4",isPlus:!0,thumb:"watercolor-dlx-4.jpg",params:[]},{id:"ART_0018",name:"Watercolor 1",isPlus:!0,thumb:"watercolor-1.jpg",params:[{type:"slider_item",name:"paint_amount",defaultValue:30,min:8,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"sharpen",defaultValue:25,min:1,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"ART_0019",name:"Watercolor 2",isPlus:!0,thumb:"watercolor-2.jpg",params:[{type:"slider_item",name:"brush_size",defaultValue:50,min:10,max:100,step:1,unit:"",multiplier:1},{type:"slider_item",name:"smoothness",defaultValue:50,min:1,max:100,step:1,unit:"",multiplier:1}]},{id:"245",name:"Watercolor 3",isPlus:!0,thumb:"watercolor-3.jpg",params:[]},{id:"238",name:"Watercolor 4",isPlus:!0,thumb:"watercolor-4.jpg",params:[{type:"slider_item",name:"overpainting_brush_size",defaultValue:9,min:5,max:51,step:2,unit:"",multiplier:1},{type:"slider_item",name:"underpainting_brush_size",defaultValue:17,min:2,max:100,step:1,unit:"",multiplier:1}]}]}].filter(Boolean),BFN.ArtsyToolIDs={},BFN.ArtsyToolParams={},BFN.ArtsyToolColorParams={},BFN.ArtsyPresetObjects={},BFN.artsyPresetMap={},BFN.artsyIDMap={};for(var Bn=0;Bn<BFN.ArtsyData.length;Bn++)for(var Fn=BFN.ArtsyData[Bn],En=0;En<Fn.presets.length;En++){var Pn=Fn.presets[En];Pn.isArtsy=!0,Pn.hasOwnProperty("name")||(Pn.name="".concat(Fn.name," ").concat(En+1));var kn=Pn.name.match(/ \d+/g);kn&&(Pn.effectNumber=kn[0]),Pn.name.includes("DLX")&&(Pn.isDLX=!0),Pn.isDLX&&!Pn.effectNumber?Pn.presetSuffix="DLX":Pn.isDLX&&Pn.effectNumber?Pn.presetSuffix="DLX ".concat(Pn.effectNumber):Pn.presetSuffix=Pn.effectNumber||En+1;var Nn="".concat(Fn.id,"_").concat(Pn.id);BFN.toolViewstates[Nn]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY,BFN.ArtsyToolIDs[Nn]=Pn.id,BFN.ArtsyToolParams[Nn]=[],BFN.ArtsyToolColorParams[Nn]=[],BFN.ArtsyPresetObjects[Nn]=Pn,BFN.artsyPresetMap[Nn]=Fn.id,BFN.artsyIDMap[Pn.id]=Fn.id;for(var Mn=0;Mn<Pn.params.length;Mn++){var Dn=Pn.params[Mn];BFN.ArtsyToolParams[Nn].push(Dn.name),"color"!==Dn.type&&"color_item"!==Dn.type||(Dn.emptyEnabled=!1,BFN.ArtsyToolColorParams[Nn].push(Dn.name))}Pn.params.push({type:"static",name:"id",defaultValue:Pn.id})}for(var wn in BFN.FrameData={crop_rotate:[{id:"frame_featured",name:"Featured",langID:"featured",frame:"tba",presets:[]},{id:"frame_instant",name:"Instant",langID:"frame_instant",frame:"tba",presets:[{id:"instant_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_instant_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1652,frameH:2e3,windowX:106,windowY:109,windowW:1443,windowH:1488}}]},{id:"instant_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_2"},{type:"static",name:"texture_data",defaultValue:{frameW:900,frameH:900,windowX:52,windowY:42,windowW:793,windowH:663}}]},{id:"instant_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:110,windowY:106,windowW:1761,windowH:1754}}]},{id:"instant_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_4"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1419,windowX:85,windowY:85,windowW:1830,windowH:1130}}]},{id:"instant_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_5"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1547,windowX:92,windowY:94,windowW:1815,windowH:1360}}]},{id:"instant_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1647,frameH:2e3,windowX:109,windowY:108,windowW:1431,windowH:1431}}]},{id:"instant_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1652,frameH:2e3,windowX:104,windowY:107,windowW:1447,windowH:1492}}]},{id:"instant_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1547,frameH:2e3,windowX:94,windowY:93,windowW:1358,windowH:1813}}]},{id:"instant_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_instant_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1652,frameH:2e3,windowX:106,windowY:109,windowW:1443,windowH:1488}}]}]}],crop:[{id:"frame_realistic",name:"Realistic",langID:"frame_realistic",frame:"tba",presets:[{id:"realistic_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_1"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1e3,windowX:145,windowY:135,windowW:1710,windowH:730}}]},{id:"realistic_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1e3,frameH:1e3,windowX:125,windowY:135,windowW:750,windowH:730}}]},{id:"realistic_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:60,windowY:65,windowW:1880,windowH:1870}}]},{id:"realistic_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_4"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:430,windowY:415,windowW:1140,windowH:1170}}]},{id:"realistic_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_5"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:430,windowY:415,windowW:1140,windowH:1170}}]},{id:"realistic_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_6"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1615,windowX:405,windowY:380,windowW:1180,windowH:845}}]},{id:"realistic_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_7"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1615,windowX:400,windowY:375,windowW:1200,windowH:845}}]},{id:"realistic_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_8"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3,windowX:430,windowY:415,windowW:1140,windowH:1170}}]},{id:"realistic_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_realistic_9"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1615,windowX:330,windowY:330,windowW:1340,windowH:955}}]}]}],full:[{id:"frame_decorative",name:"Decorative",langID:"frame_decorative",frame:"tba",presets:[{id:"decorative_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"decorative_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_decorative_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_vintage",name:"Vintage",langID:"frame_vintage",frame:"tba",presets:[{id:"vintage_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"vintage_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_vintage_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_art_deco",name:"Art Deco",langID:"frame_art_deco",frame:"tba",presets:[{id:"art_deco_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"art_deco_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_art_deco_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_floral",name:"Floral",langID:"frame_floral",frame:"tba",presets:[{id:"floral_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_floral_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_13",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_13"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_14",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_14"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_15",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_15"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_16",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_16"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_17",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_17"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_18",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_18"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_19",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_19"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_20",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_20"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_21",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_21"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_22",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_22"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_23",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_23"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_24",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_24"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"floral_25",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_floral_25"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_rustic",name:"Rustic",langID:"frame_rustic",frame:"tba",presets:[{id:"rustic_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"rustic_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_rustic_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_lace",name:"Lace",langID:"frame_lace",frame:"tba",presets:[{id:"lace_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_lace_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_13",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_13"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_14",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_14"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_15",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_15"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"lace_16",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_lace_16"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_ornament",name:"Ornament",langID:"frame_ornament",frame:"tba",presets:[{id:"ornament_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_10",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_10"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_11",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_11"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_12",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_12"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_13",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_13"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_14",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_14"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"ornament_15",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_ornament_15"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_hand_drawn",name:"Hand Drawn",langID:"frame_hand_drawn",frame:"tba",presets:[{id:"hand_drawn_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_3"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]},{id:"hand_drawn_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_hand_drawn_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1800,frameH:1200}}]}]},{id:"frame_grunge",name:"Grunge",langID:"frame_grunge",frame:"tba",presets:[{id:"grunge_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_1"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_2"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3}}]},{id:"grunge_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_4"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_5"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_6"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1600,frameH:1200}}]},{id:"grunge_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_8"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:2e3}}]},{id:"grunge_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_grunge_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1500,frameH:2e3}}]}]},{id:"frame_filmstrip",name:"Film Strip",langID:"frame_film_strip",frame:"tba",presets:[{id:"filmstrip_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_1"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1614}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_2"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1536}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_3"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1614}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_4"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1536}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_5"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1380}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_6"},{type:"static",name:"texture_data",defaultValue:{frameW:2e3,frameH:1358}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.DARKEN}]},{id:"filmstrip_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_7"},{type:"static",name:"texture_data",defaultValue:{frameW:1024,frameH:1024}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY}]},{id:"filmstrip_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_8"},{type:"static",name:"texture_data",defaultValue:{frameW:1024,frameH:727}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY}]},{id:"filmstrip_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"frames_filmstrip_9"},{type:"static",name:"texture_data",defaultValue:{frameW:1024,frameH:813}},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY}]}]}]},BFN.frameCategoryIDMap={},BFN.framePresetMap={},BFN.frameIDMap={},BFN.FrameData)for(var Ln=BFN.FrameData[wn],On=0;On<Ln.length;On++)for(var Rn=Ln[On],An=0;An<Rn.presets.length;An++){var Vn=Rn.presets[An];Vn.usePaint=!1,Vn.params.push({type:"static",name:"texture_category",defaultValue:Rn.id.replace("frame_","")}),Vn.params.push({type:"static",name:"frame_type",defaultValue:wn}),Vn.params.push({type:"static",name:"frameName",defaultValue:Rn.name+" "+(An+1)}),BFN.toolViewstates[Rn.id+"_"+Vn.id]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME,BFN.frameCategoryIDMap[Rn.id+"_"+Vn.id]=Vn.id,BFN.frameIDMap[Vn.id]=Rn.id,BFN.framePresetMap[Vn.id]=Vn}BFN.TextureData=[{id:"texture_featured",name:"Featured",langID:"featured",graphic:"tba",presets:[]},{id:"bokeh",name:"Bokeh",langID:"texture_bokeh",graphic:"graphic_textures_bokeh",presets:[{id:"bokeh_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.75}]},{id:"bokeh_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.8}]},{id:"bokeh_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.88}]},{id:"bokeh_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_bokeh_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"bokeh_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_bokeh_overlay_75.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:.75}]},{id:"bokeh_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_bokeh_overlay_50.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.9}]}]},{id:"scratches",langID:"texture_scratches",name:"Scratches",graphic:"graphic_textures_scratches",presets:[{id:"scratches_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"scratches_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"9_scratch_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"light",langID:"texture_light_trails",name:"Light Trails",graphic:"graphic_textures_light_trails",presets:[{id:"light_trail_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_light_lighten_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.7}]},{id:"light_trail_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_light_lighten_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.75}]},{id:"light_trail_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_light_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_trail_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"9_light_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"lightleak",langID:"texture_light_leaks",name:"Light Leaks",graphic:"graphic_textures_light_leaks",presets:[{id:"light_leak_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_leak_screen_65.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.65}]},{id:"light_leak_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_leak_screen_70.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.7}]},{id:"light_leak_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_leak_screen_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.8}]},{id:"light_leak_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_leak_screen_75.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.75}]},{id:"light_leak_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_leak_screen_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:.8}]},{id:"light_leak_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_leak_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_leak_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]},{id:"light_leak_9",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"9_leak_screen_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.SCREEN},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"fabric",langID:"texture_fabric",name:"Fabric",graphic:"graphic_textures_fabric",presets:[{id:"fabric_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_fabric_multiply_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:1}]},{id:"fabric_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_fabric_multiply_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:1}]},{id:"fabric_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_fabric_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"grunge",langID:"texture_grunge",name:"Grunge",graphic:"graphic_textures_grunge",presets:[{id:"grunge_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_grunge_overlay_60.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.6}]},{id:"grunge_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_grunge_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.HARD_LIGHT},{type:"static",name:"alpha",defaultValue:.8}]},{id:"grunge_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_grunge_overlay_70.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.7}]},{id:"grunge_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_grunge_multiply_30.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:.3}]},{id:"grunge_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_grunge_overlay_60.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.6}]},{id:"grunge_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_grunge_overlay_60.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.6}]},{id:"grunge_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_grunge_hardlight_40.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.HARD_LIGHT},{type:"static",name:"alpha",defaultValue:.4}]},{id:"grunge_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_grunge_overlay_80.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.8}]}]},{id:"paint",langID:"texture_paint",name:"Paint",graphic:"graphic_textures_paint",presets:[{id:"paint_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paint_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.5}]},{id:"paint_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_paint_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"metal",langID:"texture_metal",name:"Metal",graphic:"graphic_textures_metal",presets:[{id:"metal_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_metal_overlay_50.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.5}]},{id:"metal_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"metal_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_metal_overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"bricks",langID:"texture_bricks",name:"Bricks",graphic:"graphic_textures_bricks",presets:[{id:"bricks_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_Bricks_Multiply_40.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.MULTIPLY},{type:"static",name:"alpha",defaultValue:.4}]},{id:"bricks_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_Bricks_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"bricks_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_Bricks_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"bricks_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_Bricks_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]},{id:"paper",langID:"texture_paper",name:"Paper",graphic:"graphic_textures_paper",presets:[{id:"paper_1",isPlus:!1,params:[{type:"static",name:"texture",defaultValue:"1_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_2",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"2_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_3",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"3_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_4",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"4_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_5",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"5_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:.5}]},{id:"paper_6",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"6_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_7",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"7_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]},{id:"paper_8",isPlus:!0,params:[{type:"static",name:"texture",defaultValue:"8_Paper_Overlay_100.jpg"},{type:"static",name:"blendMode",defaultValue:BFN.CONST.BLEND_MODES.OVERLAY},{type:"static",name:"alpha",defaultValue:1}]}]}],BFN.textureCategoryIDMap={},BFN.texturePresetMap={},BFN.textureIDMap={};for(var Un=0;Un<BFN.TextureData.length;Un++)for(var Gn=BFN.TextureData[Un],Hn=0;Hn<Gn.presets.length;Hn++){var zn=Gn.presets[Hn];zn.params.push({type:"static",name:"textureName",defaultValue:Gn.name+" "+(Hn+1)}),BFN.toolViewstates[Gn.id+"_"+zn.id]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE,BFN.textureCategoryIDMap[Gn.id+"_"+zn.id]=zn.id,BFN.textureIDMap[zn.id]=Gn.id,BFN.texturePresetMap[zn.id]=zn}function jn(){this.init()}jn.prototype.init=function(){BeFunky.log("LensFlareData Init"),this.initDefaultValues(),this.initAssetData(),this.initPresetData(),this.initAssets(),this.initPresets(),this.initMenuData()},jn.prototype.initDefaultValues=function(){this.assetPath=BFN.remoteImagesURL+"app/graphics/lens_flare_assets/"},jn.prototype.initAssetData=function(){this.assetData=[{categoryID:"glows",name:"Glows",assets:[{assetID:"Glow_01",static:!1},{assetID:"Glow_02",static:!1},{assetID:"Glow_03",static:!1},{assetID:"Glow_04",static:!1},{assetID:"Glow_05",static:!1},{assetID:"Glow_06",static:!1},{assetID:"Glow_07",static:!1},{assetID:"Glow_08",static:!1},{assetID:"Glow_09",static:!1},{assetID:"Glow_10",static:!1}]},{categoryID:"glints",name:"Glints",assets:[{assetID:"Glint_01",static:!1},{assetID:"Glint_02",static:!1},{assetID:"Glint_03",static:!1},{assetID:"Glint_04",static:!1},{assetID:"Glint_05",static:!1},{assetID:"Glint_06",static:!1},{assetID:"Glint_07",static:!1},{assetID:"Glint_08",static:!1}]},{categoryID:"shapes",name:"Shapes",assets:[{assetID:"Circle",static:!1},{assetID:"Circle_Gradient",static:!1},{assetID:"Octagon",static:!1},{assetID:"Octagon_Gradient",static:!1},{assetID:"Hexagon",static:!1},{assetID:"Hexagon_Gradient",static:!1},{assetID:"Square",static:!1},{assetID:"Square_Gradient",static:!1}]},{categoryID:"orbs",name:"Orbs",assets:[{assetID:"Orb_01",static:!1},{assetID:"Orb_02",static:!1},{assetID:"Orb_03",static:!1},{assetID:"Orb_04",static:!1},{assetID:"Orb_05",static:!1},{assetID:"Orb_06",static:!1},{assetID:"Orb_07",static:!1},{assetID:"Orb_08",static:!1},{assetID:"Orb_09",static:!1},{assetID:"Orb_10",static:!1},{assetID:"Orb_11",static:!1},{assetID:"Orb_12",static:!1},{assetID:"Orb_13",static:!1},{assetID:"Orb_14",static:!1},{assetID:"Orb_15",static:!1},{assetID:"Orb_16",static:!1}]},{categoryID:"irises",name:"Irises",assets:[{assetID:"Iris_01",static:!1},{assetID:"Iris_02",static:!1},{assetID:"Iris_03",static:!1},{assetID:"Iris_04",static:!1},{assetID:"Iris_05",static:!1},{assetID:"Iris_06",static:!1},{assetID:"Iris_07",static:!1},{assetID:"Iris_08",static:!1},{assetID:"Iris_09",static:!1},{assetID:"Iris_10",static:!1}]},{categoryID:"streaks",name:"Streaks",assets:[{assetID:"Streak_01",static:!1},{assetID:"Streak_02",static:!1},{assetID:"Streak_03",static:!1},{assetID:"Streak_04",static:!1},{assetID:"Streak_05",static:!1},{assetID:"Streak_06",static:!1},{assetID:"Streak_07",static:!1},{assetID:"Streak_08",static:!1},{assetID:"Streak_09",static:!1},{assetID:"Streak_10",static:!1},{assetID:"Streak_11",static:!1},{assetID:"Streak_12",static:!1},{assetID:"Streak_13",static:!1},{assetID:"Streak_14",static:!1},{assetID:"Streak_15",static:!1},{assetID:"Streak_16",static:!1}]},{categoryID:"caustics",name:"Caustics",assets:[{assetID:"Caustic_01",static:!1},{assetID:"Caustic_02",static:!1},{assetID:"Caustic_03",static:!1},{assetID:"Caustic_04",static:!1},{assetID:"Caustic_05",static:!1},{assetID:"Caustic_06",static:!1},{assetID:"Caustic_07",static:!1},{assetID:"Caustic_08",static:!1},{assetID:"Caustic_09",static:!1},{assetID:"Caustic_10",static:!1},{assetID:"Caustic_11",static:!1},{assetID:"Caustic_12",static:!1},{assetID:"Caustic_13",static:!1},{assetID:"Caustic_14",static:!1},{assetID:"Caustic_15",static:!1},{assetID:"Caustic_16",static:!1},{assetID:"Caustic_17",static:!1},{assetID:"Caustic_18",static:!1},{assetID:"Caustic_19",static:!1},{assetID:"Caustic_20",static:!1},{assetID:"Caustic_21",static:!1},{assetID:"Caustic_22",static:!1},{assetID:"Caustic_23",static:!1},{assetID:"Caustic_24",static:!1}]},{categoryID:"lenses",name:"Lenses",assets:[{assetID:"Lens_01",static:!0},{assetID:"Lens_02",static:!0},{assetID:"Lens_03",static:!0},{assetID:"Lens_04",static:!0},{assetID:"Lens_05",static:!0},{assetID:"Lens_06",static:!0},{assetID:"Lens_07",static:!0},{assetID:"Lens_08",static:!0},{assetID:"Lens_09",static:!0},{assetID:"Lens_10",static:!0},{assetID:"Lens_11",static:!0},{assetID:"Lens_12",static:!0},{assetID:"Lens_13",static:!0},{assetID:"Lens_14",static:!0},{assetID:"Lens_15",static:!0},{assetID:"Lens_16",static:!0},{assetID:"Lens_17",static:!0},{assetID:"Lens_18",static:!0},{assetID:"Lens_19",static:!0},{assetID:"Lens_20",static:!0}]}]},jn.prototype.initPresetData=function(){this.presetData=[{categoryID:"basic_presets",name:"Basic Presets",presets:[{presetID:"simple",presetName:"Simple",isPlus:!0,elements:[{assetID:"Glow_01",color:8421504,intensityFactor:.3,sizeFactor:2.5,sizeFactorGlobal:.5},{assetID:"Glow_01",color:8421504,intensityFactor:.5,sizeFactor:.5,sizeFactorGlobal:.5},{assetID:"Glint_08",color:8421504,intensityFactor:.4,sizeFactor:.6,sizeFactorGlobal:.5},{assetID:"Glow_01",color:8421504,blendMode:"add",intensityFactor:.35,sizeFactor:.3,sizeFactorGlobal:.75},{assetID:"Orb_07",color:14352384,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.35,sizeFactor:.2},{assetID:"Circle",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.7,sourceDistanceFactor:-.1},{assetID:"Circle",blendMode:"add",intensityFactor:.05,intensityFactorGlobal:.5,sizeFactor:.3,sourceDistanceFactor:-.22},{assetID:"Circle_Gradient",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.08,sourceDistanceFactor:-.14},{assetID:"Circle_Gradient",color:4077973,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.13,sourceDistanceFactor:.24},{assetID:"Circle_Gradient",color:4077973,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.06,sourceDistanceFactor:.27},{assetID:"Circle_Gradient",color:4077973,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.04,sourceDistanceFactor:.21},{assetID:"Circle",blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.04,sourceDistanceFactor:.35},{assetID:"Circle_Gradient",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.15,sourceDistanceFactor:.7},{assetID:"Circle",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.08,sourceDistanceFactor:.68},{assetID:"Circle",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.03,sourceDistanceFactor:.71},{assetID:"Circle",blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.07,sourceDistanceFactor:.78},{assetID:"Glow_01",color:4077973,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.25,sizeFactor:.05,sourceDistanceFactor:.78},{assetID:"Circle_Gradient",blendMode:"add",intensityFactor:.65,intensityFactorGlobal:.5,sizeFactor:.2,sourceDistanceFactor:.91},{assetID:"Orb_12",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.45,sourceDistanceFactor:1},{assetID:"Glow_01",color:4077973,blendMode:"add",intensityFactor:.96,intensityFactorGlobal:.25,sizeFactor:.05,sourceDistanceFactor:.63}]}]},{categoryID:"advanced_presets",name:"Advanced Presets",presets:[{presetID:"sunny_day",presetName:"Sunny Day",isPlus:!0,elements:[{assetID:"Glow_01",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.3,sizeFactor:1.5,sizeFactorGlobal:.75},{assetID:"Glow_10",color:16746496,intensityFactor:.5,sizeFactor:.7,sizeFactorGlobal:.75},{assetID:"Glow_02",intensityFactorGlobal:.5,sizeFactor:.4,sizeFactorGlobal:.5},{assetID:"Glow_09",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:1.1,sizeFactorGlobal:.5},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:1.2,sourceDistanceFactor:1},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.3,sourceDistanceFactor:.6},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.05,sourceDistanceFactor:.25},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.03,sourceDistanceFactor:.31},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.06,sourceDistanceFactor:.32},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.06,sourceDistanceFactor:.65},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.05,intensityFactorGlobal:.5,sizeFactor:.2,sourceDistanceFactor:.4},{assetID:"Iris_10",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.03,sourceDistanceFactor:.7},{assetID:"Glow_01",color:16746496,colorGlobalGroup:1,intensityFactorGlobal:.25,sizeFactor:.02,sourceDistanceFactor:.7},{assetID:"Glow_01",color:16746496,colorGlobalGroup:1,intensityFactorGlobal:.25,sizeFactor:.04,sourceDistanceFactor:.35},{assetID:"Caustic_01",color:16746496,colorGlobalGroup:1,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.55,rotationLock:!0,sourceDistanceFactor:-.5},{assetID:"Caustic_21",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.25,sizeFactor:.3,rotationOffset:180,rotationLock:!0,stretchYFactor:1.5,sourceDistanceFactor:1.3},{assetID:"Caustic_09",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.52,rotationLock:!0,sourceDistanceFactor:.6},{assetID:"Orb_14",blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:1.25,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Lens_15",color:16746496,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:1.5}]},{presetID:"sun_beam",presetName:"Sun Beam",isPlus:!0,elements:[{assetID:"Streak_05",color:13861167,colorGlobalGroup:1,intensityFactor:.8,intensityFactorGlobal:.4,sizeFactor:.98,sizeFactorGlobal:.2,rotationLock:!0,stretchXFactor:2.2,stretchYFactor:.8},{assetID:"Streak_05",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.4,sizeFactor:1.16,sizeFactorGlobal:.2,rotationOffset:180,rotationLock:!0,stretchXFactor:2.2,stretchYFactor:.8},{assetID:"Streak_13",colorGlobalGroup:1,intensityFactor:.8,sizeFactorGlobal:.6,rotationLock:!0},{assetID:"Streak_10",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,sizeFactorGlobal:.6,rotationOffset:-90,rotationLock:!0,stretchXFactor:1.5},{assetID:"Orb_10",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.6,sizeFactor:.53,sizeFactorGlobal:.2,rotationLock:!0},{assetID:"Glow_09",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,sizeFactor:1.5,sizeFactorGlobal:.3},{assetID:"Glow_04",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,sizeFactor:.35,sizeFactorGlobal:.4,rotationLock:!0,stretchYFactor:3},{assetID:"Caustic_03",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.15,sizeFactorGlobal:.8},{assetID:"Orb_15",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,sizeFactor:.5,sizeFactorGlobal:.8},{assetID:"Orb_01",color:13861167,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,intensityFactorGlobal:.25,sizeFactor:3},{assetID:"Orb_03",color:13861167,blendMode:"add",intensityFactor:.5,sizeFactor:2,rotationLock:!0,sourceDistanceFactor:1}]},{presetID:"warm_sun",presetName:"Warm Sun",isPlus:!0,elements:[{assetID:"Glow_10",color:13850903,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,intensityFactorGlobal:.59,sizeFactor:.46,sizeFactorGlobal:.19,rotationOffset:17,stretchXFactor:.75,stretchYFactor:.82},{assetID:"Glow_02",color:14376216,blendMode:"add",intensityFactor:.5,sizeFactor:.1,sizeFactorGlobal:.25},{assetID:"Octagon",color:14376216,colorGlobalGroup:1,intensityFactor:.85,intensityFactorGlobal:.57,sizeFactor:.04,sizeFactorGlobal:.16,sourceDistanceFactor:.24},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.32,intensityFactorGlobal:.24,sizeFactor:.08,sizeFactorGlobal:.33,sourceDistanceFactor:.14},{assetID:"Iris_01",color:14376216,colorGlobalGroup:1,intensityFactor:.71,intensityFactorGlobal:.6,sizeFactor:.14,sizeFactorGlobal:.27,rotationOffset:-180,rotationLock:!0,sourceDistanceFactor:.35},{assetID:"Orb_04",intensityFactor:.58,intensityFactorGlobal:.3,sizeFactor:.09,sizeFactorGlobal:.24,rotationOffset:-151,sourceDistanceFactor:.44},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.12,intensityFactorGlobal:.39,sizeFactor:.27,sizeFactorGlobal:.12,sourceDistanceFactor:.16},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.07,intensityFactorGlobal:.39,sizeFactor:.27,sizeFactorGlobal:.12,sourceDistanceFactor:.88},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.07,intensityFactorGlobal:.39,sizeFactor:.17,sizeFactorGlobal:.12,sourceDistanceFactor:1.1},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.08,intensityFactorGlobal:.17,sizeFactor:.17,sizeFactorGlobal:.19,sourceDistanceFactor:.24},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.08,intensityFactorGlobal:.2,sizeFactor:.25,sizeFactorGlobal:.15,sourceDistanceFactor:.27,centerDistanceFactor:.01},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.88,intensityFactorGlobal:.63,sizeFactor:.96,sizeFactorGlobal:.22,rotationOffset:100,rotationLock:!0,stretchXFactor:1.6,stretchYFactor:.68},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.66,intensityFactorGlobal:.54,sizeFactor:.96,sizeFactorGlobal:.34,rotationOffset:22,rotationLock:!0,stretchXFactor:1.6,stretchYFactor:.68},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.88,intensityFactorGlobal:.52,sizeFactor:.96,sizeFactorGlobal:.24,rotationOffset:67,rotationLock:!0,stretchXFactor:.65,stretchYFactor:.74},{assetID:"Streak_06",color:14376216,colorGlobalGroup:1,intensityFactor:.66,sizeFactor:.96,rotationOffset:-23,rotationLock:!0,stretchXFactor:.96,stretchYFactor:.41},{assetID:"Orb_15",color:14376216,colorGlobalGroup:1,blendMode:"add",intensityFactor:.23,intensityFactorGlobal:.4,sizeFactor:2.42,sizeFactorGlobal:.32,rotationOffset:105,rotationLock:!0,stretchXFactor:1.08,sourceDistanceFactor:.13},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.16,intensityFactorGlobal:.56,sizeFactor:.07,sizeFactorGlobal:.14,stretchXFactor:1.02,sourceDistanceFactor:.58},{assetID:"Octagon_Gradient",color:14376216,colorGlobalGroup:1,intensityFactor:.14,intensityFactorGlobal:.56,sizeFactor:.09,sizeFactorGlobal:.14,stretchXFactor:1.02,sourceDistanceFactor:1},{assetID:"Octagon",color:14376216,colorGlobalGroup:1,intensityFactor:.14,intensityFactorGlobal:.56,sizeFactor:.15,sizeFactorGlobal:.14,stretchXFactor:1.02,sourceDistanceFactor:.74},{assetID:"Lens_14",color:14376216,colorGlobalGroup:1,intensityFactor:.12,intensityFactorGlobal:1,sizeFactor:.9,sourceDistanceFactor:.08}]},{presetID:"sunset",presetName:"Sunset",isPlus:!0,elements:[{assetID:"Streak_14",blendMode:"add",sizeFactorGlobal:.8,rotationOffset:90,rotationLock:!0,stretchXFactor:.8},{assetID:"Streak_05",color:14783541,blendMode:"add",sizeFactorGlobal:.8,rotationOffset:95,rotationLock:!0,stretchXFactor:1.8},{assetID:"Streak_05",color:14783541,blendMode:"add",sizeFactorGlobal:.8,rotationOffset:-95,rotationLock:!0,stretchXFactor:1.8},{assetID:"Streak_05",color:14783541,sizeFactorGlobal:.6,rotationOffset:-115,rotationLock:!0,stretchYFactor:5},{assetID:"Streak_05",color:14783541,sizeFactorGlobal:.6,rotationOffset:115,rotationLock:!0,stretchYFactor:5},{assetID:"Streak_05",color:14783541,intensityFactor:.6,sizeFactorGlobal:.6,rotationOffset:180,rotationLock:!0,stretchYFactor:5},{assetID:"Glow_10",intensityFactor:.5,sizeFactor:.5,sizeFactorGlobal:.6,stretchXFactor:2.5,stretchYFactor:.75},{assetID:"Orb_03",intensityFactor:.8,sizeFactorGlobal:.4,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Orb_03",intensityFactor:.2,sizeFactor:.2,sizeFactorGlobal:.4,rotationLock:!0,sourceDistanceFactor:.65},{assetID:"Caustic_09",intensityFactor:.2,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:1}]},{presetID:"flash",presetName:"Flash",isPlus:!0,elements:[{assetID:"Glow_10",color:5471734,colorGlobalGroup:1,sizeFactorGlobal:.75},{assetID:"Glow_01",color:5669375,colorGlobalGroup:1,sizeFactor:.51,sizeFactorGlobal:.75},{assetID:"Caustic_09",color:5669375,colorGlobalGroup:1,intensityFactorGlobal:.5,sizeFactor:.45,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:1.33},{assetID:"Lens_09",color:5669375,colorGlobalGroup:1,intensityFactorGlobal:.25,sizeFactor:1.75},{assetID:"Orb_10",intensityFactor:.48,intensityFactorGlobal:.25,sizeFactor:.94,sizeFactorGlobal:.5,rotationLock:!0},{assetID:"Orb_13",color:5669375,colorGlobalGroup:1,intensityFactor:.53,intensityFactorGlobal:.5,sizeFactor:1.14,sourceDistanceFactor:1.46},{assetID:"Orb_04",intensityFactor:.8,intensityFactorGlobal:.25,sizeFactor:.25,rotationLock:!0,sourceDistanceFactor:.85}]},{presetID:"strobe",presetName:"Strobe",isPlus:!0,elements:[{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.85,sizeFactor:1.8,sizeFactorGlobal:.6,stretchXFactor:1.7},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.85,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:10,rotationLock:!0},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.55,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:150,rotationLock:!0,stretchYFactor:2.2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:100,rotationLock:!0,stretchXFactor:.8,stretchYFactor:2.2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:1.2,sizeFactorGlobal:.7,rotationOffset:90,rotationLock:!0,stretchXFactor:1.2,stretchYFactor:4.5},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.55,rotationOffset:65,rotationLock:!0,stretchXFactor:1.4,stretchYFactor:1.7},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.45,rotationOffset:60,rotationLock:!0,stretchXFactor:1.4,stretchYFactor:2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.5,rotationOffset:50,rotationLock:!0,stretchXFactor:1.4,stretchYFactor:2},{assetID:"Streak_07",color:3372953,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:1.2,sizeFactorGlobal:.6,rotationOffset:20,rotationLock:!0,stretchXFactor:.9,stretchYFactor:2},{assetID:"Orb_15",color:3372953,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,sizeFactor:.2,sizeFactorGlobal:.6},{assetID:"Orb_06",blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.25,sizeFactor:.51,rotationLock:!0,stretchXFactor:1.2,sourceDistanceFactor:.65},{assetID:"Orb_05",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.51,rotationLock:!0,stretchXFactor:1.2,sourceDistanceFactor:.65},{assetID:"Iris_08",color:3372953,colorGlobalGroup:1,intensityFactor:.3,intensityFactorGlobal:.35,sizeFactor:.2,rotationOffset:60,sourceDistanceFactor:.55},{assetID:"Lens_09",color:3372953,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.25},{assetID:"Iris_01",color:3372953,colorGlobalGroup:1,intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:2.5,rotationLock:!0,sourceDistanceFactor:1.25}]},{presetID:"spotlight",presetName:"Spotlight",isPlus:!0,elements:[{assetID:"Caustic_02",blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.25,sizeFactor:.4,sizeFactorGlobal:.35,rotationOffset:85,rotationLock:!0,sourceDistanceFactor:-.08},{assetID:"Streak_02",color:16777215,colorGlobalGroup:1,intensityFactor:.3,sizeFactor:.6,sizeFactorGlobal:.35,stretchXFactor:5,stretchYFactor:.2},{assetID:"Glint_04",color:16777215,colorGlobalGroup:1,intensityFactor:.3,sizeFactor:.4,sizeFactorGlobal:.75,rotationOffset:20},{assetID:"Orb_16",color:16777215,colorGlobalGroup:1,intensityFactor:.3,sizeFactor:.5,sizeFactorGlobal:.75,rotationOffset:40,rotationLock:!0},{assetID:"Glow_09",color:16777215,colorGlobalGroup:1,blendMode:"add",intensityFactor:.25,sizeFactor:.7,sizeFactorGlobal:.8},{assetID:"Glow_01",color:16777215,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:.1,sizeFactorGlobal:.8},{assetID:"Orb_10",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:.4,sizeFactorGlobal:.5},{assetID:"Caustic_02",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.5,rotationOffset:85,rotationLock:!0,stretchXFactor:.75,sourceDistanceFactor:-.75},{assetID:"Caustic_02",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.7,rotationOffset:-105,rotationLock:!0,stretchXFactor:.75,sourceDistanceFactor:1.1},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.07,rotationOffset:135,rotationLock:!0,sourceDistanceFactor:-.15,centerDistanceFactor:-.15},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.07,rotationOffset:135,rotationLock:!0,sourceDistanceFactor:.25,centerDistanceFactor:-.25},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.05,rotationLock:!0,sourceDistanceFactor:.25,centerDistanceFactor:.05},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.2,rotationLock:!0,sourceDistanceFactor:1.3},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.9,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Orb_03",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:.1,rotationLock:!0,sourceDistanceFactor:1.2},{assetID:"Orb_03",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.05,rotationLock:!0,sourceDistanceFactor:1.1,centerDistanceFactor:.05},{assetID:"Orb_03",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.25,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:-.85,centerDistanceFactor:.05},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.15,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.7,centerDistanceFactor:.05},{assetID:"Orb_03",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.15,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:-.55,centerDistanceFactor:.05},{assetID:"Orb_13",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.6,intensityFactorGlobal:.5,sizeFactor:.03,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:.3,centerDistanceFactor:-.05},{assetID:"Orb_13",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.1,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:1.35,centerDistanceFactor:-.05},{assetID:"Orb_13",color:5711050,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:-90,rotationLock:!0,sourceDistanceFactor:.8},{assetID:"Orb_13",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.3,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:1.25,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.2,rotationOffset:-92,rotationLock:!0,stretchYFactor:1.1,sourceDistanceFactor:.85,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:3363892,colorGlobalGroup:2,blendMode:"add",intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:.45,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.15,rotationOffset:-92,rotationLock:!0,stretchYFactor:1.1,sourceDistanceFactor:.5,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.1,rotationOffset:-92,rotationLock:!0,sourceDistanceFactor:.35,centerDistanceFactor:.05},{assetID:"Octagon_Gradient",color:5711050,colorGlobalGroup:3,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:-92,rotationLock:!0,centerDistanceFactor:.1},{assetID:"Orb_14",blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:1.9,rotationLock:!0,sourceDistanceFactor:.75},{assetID:"Caustic_16",color:5711050,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.4,rotationOffset:-101,rotationLock:!0,sourceDistanceFactor:1.64,centerDistanceFactor:-.05},{assetID:"Caustic_16",color:3363892,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.4,rotationOffset:-101,rotationLock:!0,sourceDistanceFactor:.6,centerDistanceFactor:-.05},{assetID:"Lens_09",colorGlobalGroup:4,blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:1.1,sizeFactorGlobal:.5}]},{presetID:"performance",presetName:"Performance",isPlus:!0,elements:[{assetID:"Orb_01",color:12072548,blendMode:"add",intensityFactorGlobal:.5,sizeFactor:1.65},{assetID:"Orb_01",color:923038,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.55,sizeFactorGlobal:.5},{assetID:"Orb_10",blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.3,sizeFactorGlobal:.5},{assetID:"Orb_04",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.55,sizeFactorGlobal:.5,rotationLock:!0},{assetID:"Orb_09",blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.8,sizeFactorGlobal:.5},{assetID:"Streak_14",intensityFactor:.2,sizeFactor:.78,sizeFactorGlobal:.5,stretchXFactor:2.5},{assetID:"Streak_11",color:12072548,intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:1.7,sizeFactorGlobal:.25,rotationOffset:90,stretchYFactor:2.5},{assetID:"Glow_09",blendMode:"add",intensityFactorGlobal:.4,sizeFactor:.2,sizeFactorGlobal:.29,stretchXFactor:.7},{assetID:"Orb_01",blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.15,sizeFactorGlobal:.5},{assetID:"Glow_08",color:12072548,blendMode:"add",intensityFactor:.4,sizeFactor:.7,sizeFactorGlobal:.3,rotationLock:!0},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,sizeFactorGlobal:.25,stretchXFactor:1.5},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,stretchXFactor:1.5,stretchYFactor:.25,sourceDistanceFactor:.98},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,stretchYFactor:1.25,sourceDistanceFactor:1},{assetID:"Streak_16",color:12072548,blendMode:"add",intensityFactorGlobal:.5,stretchXFactor:1.5,stretchYFactor:.25,sourceDistanceFactor:1.02},{assetID:"Streak_02",blendMode:"add",intensityFactorGlobal:.5,sizeFactor:1.4,sourceDistanceFactor:1},{assetID:"Streak_04",color:12072548,blendMode:"add",intensityFactor:.7,intensityFactorGlobal:.5,sizeFactor:1.4,sourceDistanceFactor:.75},{assetID:"Streak_13",color:12072548,blendMode:"add",intensityFactorGlobal:.5,sizeFactor:.5,stretchXFactor:3.2,sourceDistanceFactor:.71},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.1,sourceDistanceFactor:.7},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.09,sourceDistanceFactor:.55},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.08,sourceDistanceFactor:.4},{assetID:"Circle_Gradient",color:3890493,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.07,sourceDistanceFactor:.3},{assetID:"Circle_Gradient",color:4015509,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.05,sourceDistanceFactor:.47},{assetID:"Circle_Gradient",color:4015509,intensityFactor:.3,intensityFactorGlobal:.5,sizeFactor:.04,sourceDistanceFactor:.62},{assetID:"Lens_06",blendMode:"add",intensityFactor:.5,sizeFactor:.5}]},{presetID:"iris",presetName:"Iris",isPlus:!0,elements:[{assetID:"Orb_01",color:923038,blendMode:"add",intensityFactor:.3,sizeFactor:.55,sizeFactorGlobal:.5},{assetID:"Orb_10",blendMode:"add",intensityFactor:.4,sizeFactor:.3,sizeFactorGlobal:.5},{assetID:"Orb_04",blendMode:"add",intensityFactor:.5,sizeFactor:.55,sizeFactorGlobal:.5,rotationLock:!0},{assetID:"Orb_09",blendMode:"add",intensityFactor:.3,sizeFactor:.8,sizeFactorGlobal:.5},{assetID:"Streak_16",sizeFactorGlobal:.5,stretchXFactor:1.5},{assetID:"Streak_14",sizeFactor:.78,sizeFactorGlobal:.5},{assetID:"Glow_09",blendMode:"add",sizeFactor:.21,sizeFactorGlobal:.5},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,centerDistanceFactor:.05},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,stretchXFactor:1.25,centerDistanceFactor:.01},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,stretchXFactor:1.5,centerDistanceFactor:-.01},{assetID:"Streak_16",color:11099294,blendMode:"add",sizeFactor:.28,sizeFactorGlobal:.25,rotationOffset:90,centerDistanceFactor:-.05},{assetID:"Orb_01",blendMode:"add",intensityFactor:.3,sizeFactor:.15,sizeFactorGlobal:.5},{assetID:"Caustic_07",blendMode:"add",intensityFactor:.5,intensityFactorGlobal:.5,sizeFactor:.9,sizeFactorGlobal:.5,rotationLock:!0}]},{presetID:"nova",presetName:"Nova",isPlus:!0,elements:[{assetID:"Glow_01",color:16747374,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:2.5,sizeFactorGlobal:.6,stretchYFactor:.4},{assetID:"Glint_08",color:16747374,blendMode:"add",intensityFactor:.5,sizeFactor:.3,sizeFactorGlobal:.4},{assetID:"Streak_11",color:16747374,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactorGlobal:.25,rotationOffset:-90,rotationLock:!0},{assetID:"Orb_04",color:16747374,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.7,sizeFactor:.27,rotationOffset:-90},{assetID:"Streak_11",color:12751103,colorGlobalGroup:2,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,stretchXFactor:2.5},{assetID:"Streak_09",color:12751103,colorGlobalGroup:2,blendMode:"add",intensityFactor:.71,sizeFactorGlobal:.35,stretchXFactor:2.5,sourceDistanceFactor:-.02},{assetID:"Streak_08",color:12751103,colorGlobalGroup:2,blendMode:"add",intensityFactorGlobal:.5,sizeFactorGlobal:.15,stretchXFactor:2.3,sourceDistanceFactor:-.1},{assetID:"Streak_04",color:12751103,colorGlobalGroup:2,intensityFactorGlobal:.5,sizeFactorGlobal:.25,sourceDistanceFactor:.05},{assetID:"Orb_04",color:12751103,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:2,rotationLock:!0,sourceDistanceFactor:.95}]},{presetID:"elysium",presetName:"Elysium",isPlus:!0,elements:[{assetID:"Glow_09",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.4,sizeFactor:1.6,sizeFactorGlobal:.75},{assetID:"Caustic_09",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,sizeFactor:.2,sizeFactorGlobal:.25,rotationOffset:90,rotationLock:!0,stretchYFactor:2},{assetID:"Caustic_09",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1,sizeFactor:.2,sizeFactorGlobal:.25,rotationOffset:-90,rotationLock:!0,stretchYFactor:2},{assetID:"Glow_03",color:16742667,colorGlobalGroup:1,blendMode:"add",sizeFactor:.5,sizeFactorGlobal:.6,stretchXFactor:2.5},{assetID:"Streak_13",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,sizeFactor:1.25,sizeFactorGlobal:.5,stretchXFactor:1.5},{assetID:"Streak_02",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:1.25,sizeFactorGlobal:.25,rotationOffset:180,sourceDistanceFactor:.05},{assetID:"Streak_02",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.25,sizeFactor:1.25,sizeFactorGlobal:.25,sourceDistanceFactor:-.05},{assetID:"Streak_05",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:3,sizeFactorGlobal:.5,rotationOffset:180,rotationLock:!0},{assetID:"Streak_05",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:3,sizeFactorGlobal:.5,rotationOffset:120,rotationLock:!0},{assetID:"Streak_05",color:13265151,colorGlobalGroup:2,blendMode:"add",intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:3,sizeFactorGlobal:.5,rotationOffset:-120,rotationLock:!0},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.3,intensityFactorGlobal:.25,sizeFactor:.64,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.6},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.1},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.03,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.13},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.2},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.04,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.31},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.06,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.38},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.04,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.49},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.02,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.53},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.58},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.8,intensityFactorGlobal:.5,sizeFactor:.01,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.9},{assetID:"Orb_03",color:16742667,colorGlobalGroup:1,blendMode:"add",intensityFactor:.4,intensityFactorGlobal:.5,sizeFactor:.02,rotationOffset:180,rotationLock:!0,sourceDistanceFactor:.87}]},{presetID:"headlight",presetName:"Headlight",isPlus:!0,elements:[{assetID:"Glow_04",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.23,sizeFactor:.64,sizeFactorGlobal:.1,rotationOffset:41,rotationLock:!0,sourceDistanceFactor:-.02},{assetID:"Glow_04",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.52,sizeFactor:.54,sizeFactorGlobal:.45,rotationOffset:40,rotationLock:!0},{assetID:"Glow_04",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.46,sizeFactor:.37,sizeFactorGlobal:.7,rotationOffset:-35,rotationLock:!0},{assetID:"Glow_06",color:14345441,colorGlobalGroup:1,blendMode:"add",intensityFactor:.71,intensityFactorGlobal:.49,sizeFactor:.25,sizeFactorGlobal:.3,rotationOffset:-84,rotationLock:!0},{assetID:"Glow_08",color:16579836,colorGlobalGroup:1,intensityFactor:.17,sizeFactor:.46,sizeFactorGlobal:.64},{assetID:"Glow_10",color:16579836,colorGlobalGroup:1,intensityFactor:.66,sizeFactor:.29,sizeFactorGlobal:.32},{assetID:"Glow_10",color:16579836,colorGlobalGroup:1,blendMode:"add",intensityFactor:.35,sizeFactor:.1,sizeFactorGlobal:.32},{assetID:"Orb_10",intensityFactor:.13,intensityFactorGlobal:.26,sizeFactor:.47,sizeFactorGlobal:.65},{assetID:"Orb_02",color:15576700,colorGlobalGroup:2,intensityFactor:.28,sizeFactor:.25,sizeFactorGlobal:.69,sourceDistanceFactor:.12,centerDistanceFactor:-.02},{assetID:"Orb_02",color:13869175,colorGlobalGroup:2,blendMode:"add",intensityFactor:.25,intensityFactorGlobal:.3,sizeFactor:.35,sizeFactorGlobal:.1,sourceDistanceFactor:1.1,centerDistanceFactor:-.04},{assetID:"Caustic_07",color:16763554,colorGlobalGroup:2,intensityFactor:.18,intensityFactorGlobal:.2,sizeFactor:.09,sizeFactorGlobal:.68,sourceDistanceFactor:.13,centerDistanceFactor:-.1},{assetID:"Caustic_07",color:16169355,colorGlobalGroup:2,intensityFactor:.17,sizeFactor:.08,sizeFactorGlobal:.74,sourceDistanceFactor:.11,centerDistanceFactor:-.11},{assetID:"Orb_16",color:1265627,colorGlobalGroup:3,intensityFactor:.85,intensityFactorGlobal:.25,sizeFactor:.15,rotationOffset:-131,stretchXFactor:.98,sourceDistanceFactor:.55},{assetID:"Orb_16",color:960731,colorGlobalGroup:3,blendMode:"add",intensityFactor:.96,intensityFactorGlobal:.35,sizeFactor:.15,rotationOffset:-131,stretchXFactor:.98,sourceDistanceFactor:.67,centerDistanceFactor:-.04},{assetID:"Lens_15",color:10665727,colorGlobalGroup:4,intensityFactor:.35,intensityFactorGlobal:.2,sizeFactor:.85,sizeFactorGlobal:.4}]},{presetID:"glint",presetName:"Glint",isPlus:!0,elements:[{assetID:"Streak_13",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.2,sizeFactorGlobal:.8,rotationOffset:30,rotationLock:!0,stretchXFactor:2,stretchYFactor:.6},{assetID:"Streak_13",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.2,sizeFactorGlobal:.8,rotationOffset:-30,rotationLock:!0,stretchXFactor:2,stretchYFactor:.6},{assetID:"Streak_13",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.2,sizeFactorGlobal:.8,rotationOffset:90,rotationLock:!0,stretchXFactor:2,stretchYFactor:.6},{assetID:"Orb_15",color:11184895,colorGlobalGroup:1,intensityFactor:.6,sizeFactor:.4,sizeFactorGlobal:.8},{assetID:"Glow_09",color:11184895,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:.2,sizeFactorGlobal:.8},{assetID:"Streak_07",color:11184895,colorGlobalGroup:1,intensityFactor:.8,sizeFactor:.3,sizeFactorGlobal:.8,rotationOffset:30,rotationLock:!0},{assetID:"Streak_07",color:11184895,colorGlobalGroup:1,intensityFactor:.8,sizeFactor:.3,sizeFactorGlobal:.8,rotationOffset:-30,rotationLock:!0},{assetID:"Streak_07",color:11184895,colorGlobalGroup:1,intensityFactor:.8,sizeFactor:.3,sizeFactorGlobal:.8,rotationOffset:90,rotationLock:!0}]},{presetID:"xenon",presetName:"Xenon",isPlus:!0,elements:[{assetID:"Orb_15",color:499229,colorGlobalGroup:1,blendMode:"add",sizeFactor:.05,sizeFactorGlobal:.7},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:72,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:144,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:-144,rotationLock:!0,stretchYFactor:.2},{assetID:"Streak_05",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactorGlobal:.3,sizeFactorGlobal:.5,rotationOffset:-72,rotationLock:!0,stretchYFactor:.2},{assetID:"Orb_15",color:499229,colorGlobalGroup:1,intensityFactor:.5,sizeFactor:.4},{assetID:"Glow_09",color:499229,colorGlobalGroup:1,sizeFactor:.29,sizeFactorGlobal:.4,rotationLock:!0},{assetID:"Orb_01",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactor:.5,sizeFactor:2,sizeFactorGlobal:.1},{assetID:"Streak_03",color:499229,colorGlobalGroup:1,intensityFactor:.5,sizeFactorGlobal:.6,stretchYFactor:4},{assetID:"Caustic_03",color:499229,colorGlobalGroup:1,blendMode:"add",intensityFactor:.1},{assetID:"Orb_16",color:499229,colorGlobalGroup:1,intensityFactor:.8,intensityFactorGlobal:.25,rotationLock:!0,sourceDistanceFactor:1},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.05,sourceDistanceFactor:.1},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.2,intensityFactorGlobal:.5,sizeFactor:.07,sourceDistanceFactor:.2},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.15,intensityFactorGlobal:.5,sizeFactor:.1,sourceDistanceFactor:.3},{assetID:"Iris_07",color:499229,colorGlobalGroup:1,intensityFactor:.1,intensityFactorGlobal:.5,sizeFactor:.25,sourceDistanceFactor:.6},{assetID:"Lens_15",color:499229,intensityFactor:.6,sizeFactor:.7,sizeFactorGlobal:.25}]},{presetID:"laser",presetName:"Laser",isPlus:!0,elements:[{assetID:"Streak_16",color:16729896,colorGlobalGroup:1,blendMode:"add",sizeFactor:2,sizeFactorGlobal:.75,stretchYFactor:.29,sourceDistanceFactor:-.03},{assetID:"Streak_16",color:16729896,colorGlobalGroup:1,blendMode:"add",sizeFactor:2,sizeFactorGlobal:.75,stretchYFactor:.29,sourceDistanceFactor:.03},{assetID:"Glow_10",color:16729896,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactor:.3,sizeFactorGlobal:.75,stretchXFactor:2},{assetID:"Streak_01",color:16729896,colorGlobalGroup:1,blendMode:"add",intensityFactor:.6,sizeFactorGlobal:.5,stretchXFactor:2},{assetID:"Orb_15",color:16729896,colorGlobalGroup:1,sizeFactor:.8,sizeFactorGlobal:.35,stretchXFactor:1.5,stretchYFactor:.2},{assetID:"Glow_04",color:16729896,colorGlobalGroup:1,sizeFactor:.3,sizeFactorGlobal:.5,stretchXFactor:1.5},{assetID:"Streak_09",color:16729896,colorGlobalGroup:1,intensityFactorGlobal:.5,sizeFactor:.4,sizeFactorGlobal:.5,stretchXFactor:2.5,stretchYFactor:.35,sourceDistanceFactor:.03},{assetID:"Streak_09",color:16729896,colorGlobalGroup:1,intensityFactorGlobal:.5,sizeFactor:.4,sizeFactorGlobal:.5,rotationOffset:180,stretchXFactor:2.5,stretchYFactor:.35,sourceDistanceFactor:-.03}]}]}]},jn.prototype.initMenuData=function(){for(var e=[],t=0;t<this.presetData.length;t++)for(var n=this.presetData[t],i=0;i<n.presets.length;i++){for(var r=n.presets[i],a={id:"lens_flare_"+r.presetID,name:r.presetName,isPlus:r.isPlus,thumb:"tba",effectID:"lens_flare",usePaint:!1,params:[{type:"static",name:"presetID",defaultValue:r.presetID}]},o=[],s=0;s<r.elements.length;s++){var l=r.elements[s];if(l.hasOwnProperty("colorGlobalGroup")){var u=l.colorGlobalGroup;u>0&&-1==o.indexOf(u)&&o.push(u)}}if(o.length){o.sort(function(e,t){return e-t});for(var c=0;c<o.length;c++)a.params.push({type:"color_item",name:"color_value_"+o[c],defaultValue:-1})}e.push(a)}this.menuData=[{id:"lens_flares",name:"Lens Flare",graphic:"tba",presets:e}];for(var h=0;h<this.menuData.length;h++)for(var d=this.menuData[h],m=0;m<d.presets.length;m++){var p=d.presets[m];BFN.toolViewstates[d.id+"_"+p.id]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE}},jn.prototype.initAssets=function(){this.assets={},this.assetIDs=[];for(var e=0;e<this.assetData.length;e++)for(var t=this.assetData[e],n=0;n<t.assets.length;n++){var i=t.assets[n],r=new BFN.LensFlareAssetVO;r.categoryID=t.categoryID,r.assetID=i.assetID,r.static=i.static,r.imageURL=this.assetPath+r.categoryID+"/images/"+r.assetID+".jpg",r.thumbURL=this.assetPath+r.categoryID+"/thumbs/"+r.assetID+".jpg",this.assets[r.assetID]=r,this.assetIDs.push(r.assetID)}},BFN.lensFlarePresetMap={},jn.prototype.initPresets=function(){this.presets={},this.presetIDs=[];for(var e=0;e<this.presetData.length;e++)for(var t=this.presetData[e],n=0;n<t.presets.length;n++){var i=t.presets[n],r=new BFN.LensFlarePresetVO;r.presetID=i.presetID,r.presetName=i.presetName,r.isPlus=i.isPlus;for(var a=0;a<i.elements.length;a++){var o=i.elements[a],s=new BFN.LensFlareElementVO;for(var l in o)s.setProperty(l,o[l]);r.elementVOs.push(s)}this.presets[r.presetID]=r,this.presetIDs.push(r.presetID),BFN.lensFlarePresetMap["lens_flares_lens_flare_"+r.presetID]=r.presetID}},BFN.SingletonQueue.add(function(){BFN.LensFlareData=new jn});var Xn=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BFN.OverlaysData={}}},{key:"load",value:function(e){var t="overlays-data".concat(BFN.assetsDataVersions.overlays_data,".json"),n="".concat(BFN.overlaysUrl).concat(t);BFN.IndexedDB.getFile("overlays",BFN.folderNames.overlays+t,n).then(function(t){if(!t.hasOwnProperty("overlays-data"))return BeFunky.logError("Overlays data missing 'overlays-data' property",t);t["overlays-data"].forEach(function(e){BFN.OverlaysData[e.id]=e}),e&&e(!0)}).catch(function(e){BeFunky.logError("Unable to get overlays data from IndexedDB or server")})}}]),e}();BFN.SingletonQueue.add(function(){BFN.OverlaysDataLoader=new Xn});var Wn=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BFN.PatternsData={}}},{key:"load",value:function(e){var t="patterns-data".concat(BFN.assetsDataVersions.patterns_data,".json"),n="".concat(BFN.assetsURL,"datas/").concat(t);BFN.IndexedDB.getFile("patterns",BFN.folderNames.patterns+t,n).then(function(t){if(!t.hasOwnProperty("patterns-data"))return BeFunky.logError("Patterns data missing 'patterns-data' property",t);t["patterns-data"].forEach(function(e){BFN.PatternsData[e.id]=e}),e&&e(!0)}).catch(function(e){BeFunky.logError("Unable to get patterns data from IndexedDB or server",e||"")})}}]),e}();BFN.SingletonQueue.add(function(){BFN.PatternsDataLoader=new Wn});var Yn=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.fetchingLayoutsPromise=null,this.templateCategories=[]}},{key:"loadTemplateData",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).showLoadScreen,n=void 0===t||t;return n&&BeFunky.showLoadScreen(),this.fetchingLayoutsPromise?this.fetchingLayoutsPromise:(this.fetchingLayoutsPromise=new Promise(function(t,i){var r="".concat(BFN.assetsURL,"datas/collage_layouts_data_v2.json");BeFunky.request(r,{},function(r){var a=r.response,o=r.error;if(n&&BeFunky.hideLoadScreen(),o)return e.fetchingLayoutsPromise=null,i(o);e.templateCategories=a,e.setupTemplates(),t()})}),this.fetchingLayoutsPromise)}},{key:"setupTemplates",value:function(){var e,t=this;this._templateCategoryVOs=[];var n=["big_rectangle_3_square_right","grid17","grid18","grid19","3x3_square","grid22","grid28","grid37","big_rectangle_6_square_all","big_rectangle_6_square_left_bottom","overlay1","big_photo_15","big_photo_17","big_photo_24","fb7","fb16","pin2","pin4","pin8"],i=new BFN.TemplateCategoryVO;i.id="featured",i.name="Featured",i.graphic="collage_template_featured",this._templateCategoryVOs.push(i),this.templateCategories.forEach(function(e){var r=new BFN.TemplateCategoryVO;r.id=e.id,r.name=e.name,r.graphic=e.graphic,t._templateCategoryVOs.push(r),e.presets.forEach(function(e){var t=new BFN.TemplateVO;t.name=e.name,t.categoryID=r.id,t.isPlus=e.hasOwnProperty("isPlus")&&1==e.isPlus,t.preset=e,r.templateVOs.push(t),n.includes(t.name)&&i.templateVOs.push(t)})});var r=(e=[]).concat.apply(e,v(this._templateCategoryVOs.slice(1).map(function(e){return e.templateVOs}))),a=132*Math.ceil(r.length/3)+38*Math.floor(r.length/3)+4;a*=.5;var o="".concat(238,"px ").concat(a,"px");r.forEach(function(e,t){var n=t%3*170,i=170*Math.floor(t/3);e.spritePosition="-".concat(.5*n,"px -").concat(.5*i,"px"),e.spriteSize=o})}},{key:"templateCategoryVOs",get:function(){return this._templateCategoryVOs}}]),e}();BFN.SingletonQueue.add(function(){BFN.CollageMakerTemplateData=new Yn}),BFN.FontOffsetVectors={"Abril Fatface":{distance:17.11724276862369,direction:1.687905071361761},Alegreya:{distance:12.165525060596439,direction:1.7359450042095235},"Alegreya Sans":{distance:10.198039027185569,direction:-1.7681918866447774},Amaranth:{distance:15.132745950421556,direction:-1.7033478590915707},"Amatic SC":{distance:13.038404810405298,direction:1.6475682180646747},Amble:{distance:13.152946437965905,direction:-1.7234456551901618},"Anonymous Pro":{distance:8.246211251235321,direction:-1.8157749899217608},"Architects Daughter":{distance:9.055385138137417,direction:-1.6814535479687924},Arizonia:{distance:2,direction:3.141592653589793},"The Art of Illuminating":{distance:17.11724276862369,direction:-1.687905071361761},Arvo:{distance:13.152946437965905,direction:-1.7234456551901618},"Bear and Loupe":{distance:15.132745950421556,direction:-1.7033478590915707},"Bebas Neue":{distance:15.132745950421556,direction:-1.7033478590915707},Bellota:{distance:2.23606797749979,direction:-2.677945044588987},"Berkshire Swash":{distance:8.246211251235321,direction:1.8157749899217608},Boogaloo:{distance:5.385164807134504,direction:1.9513027039072617},"Bookman Old Style":{distance:17.11724276862369,direction:-1.687905071361761},"Bowlby One":{distance:21.213203435596427,direction:1.7126933813990606},"Brush Script MT":{distance:29.017236257093817,direction:-1.6052654277944047},Cabin:{distance:8.06225774829855,direction:1.6951513213416582},"Capture It":{distance:17.26267650163207,direction:-1.7454685258031364},"Carbon Type":{distance:17.029386365926403,direction:-1.6295521495106193},Carrington:{distance:3.605551275463989,direction:-2.1587989303424644},"Caviar dreams":{distance:12.165525060596439,direction:-1.7359450042095235},ChunkFive:{distance:14.142135623730951,direction:-1.7126933813990606},"Claire Hand":{distance:19.1049731745428,direction:-1.6756732655251305},"Comic Sans MS":{distance:10.198039027185569,direction:-1.7681918866447774},Cookie:{distance:12.041594578792296,direction:-1.653937558683338},"Crass Roots":{distance:3.605551275463989,direction:-2.1587989303424644},"Dancing Script":{distance:19,direction:-1.5707963267948966},"Deutsch Gothic":{distance:11.180339887498949,direction:-1.750649826587375},Edo:{distance:17.11724276862369,direction:-1.687905071361761},"Eutemia I":{distance:16.1245154965971,direction:-1.6951513213416582},Exo:{distance:9.055385138137417,direction:-1.6814535479687924},Forque:{distance:19.1049731745428,direction:-1.6756732655251305},"Free Universal":{distance:10.198039027185569,direction:-1.7681918866447774},"Frente H1":{distance:10.198039027185569,direction:-1.7681918866447774},Georgia:{distance:14.142135623730951,direction:-1.7126933813990606},"Good Foot":{distance:2.23606797749979,direction:2.677945044588987},"Gothic Ultra":{distance:14.142135623730951,direction:-1.7126933813990606},Gputeks:{distance:10.198039027185569,direction:-1.7681918866447774},"Grand Hotel":{distance:5.385164807134504,direction:1.9513027039072617},"Great Vibes":{distance:4.47213595499958,direction:-2.0344439357957027},Handserif:{distance:17.11724276862369,direction:-1.687905071361761},Harting:{distance:12.165525060596439,direction:-1.7359450042095235},Helsinki:{distance:17.029386365926403,direction:-1.6295521495106193},"Henry Morgan Hand":{distance:2.23606797749979,direction:-2.677945044588987},"Holitter Gothic":{distance:16.0312195418814,direction:-1.633215136790854},Hominis:{distance:10.198039027185569,direction:-1.7681918866447774},"HVD Comic Serif Pro":{distance:15.132745950421556,direction:-1.7033478590915707},Idolwild:{distance:2.8284271247461903,direction:-2.356194490192345},Inkcalig:{distance:17.029386365926403,direction:-1.6295521495106193},Itsadzoke:{distance:4.123105625617661,direction:-1.8157749899217608},"Josefin Slab":{distance:14.142135623730951,direction:-1.7126933813990606},Karla:{distance:2.8284271247461903,direction:2.356194490192345},Kawoszeh:{distance:16.0312195418814,direction:-1.633215136790854},"Kingthings Trypewriter":{distance:16.1245154965971,direction:-1.6951513213416582},"Komika Axis":{distance:2.8284271247461903,direction:-2.356194490192345},"La Belle Aurore":{distance:20.09975124224178,direction:-1.6704649792860586},Langdon:{distance:15.132745950421556,direction:-1.7033478590915707},Lato:{distance:9.219544457292887,direction:-1.7894652726688387},"League Gothic":{distance:15.132745950421556,direction:-1.7033478590915707},"Leckerli One":{distance:14.142135623730951,direction:-1.7126933813990606},"Lobster Two":{distance:10.198039027185569,direction:1.7681918866447774},"Londrina Outline":{distance:15,direction:-1.5707963267948966},"Londrina Shadow":{distance:16.0312195418814,direction:-1.633215136790854},"Londrina Sketch":{distance:16.0312195418814,direction:-1.633215136790854},"Londrina Solid":{distance:17.029386365926403,direction:-1.6295521495106193},"Luckiest Guy":{distance:19.1049731745428,direction:-1.6756732655251305},"Maiden Orange":{distance:20.09975124224178,direction:-1.6704649792860586},"Mathlete Bulky":{distance:10.198039027185569,direction:-1.7681918866447774},Merriweather:{distance:9.219544457292887,direction:1.7894652726688387},Miama:{distance:13.038404810405298,direction:-1.6475682180646747},Montserrat:{distance:8.246211251235321,direction:1.8157749899217608},"Myriad Pro":{distance:15.132745950421556,direction:-1.7033478590915707},"My Underwood":{distance:15.132745950421556,direction:-1.7033478590915707},Niconne:{distance:4.47213595499958,direction:2.0344439357957027},Norwester:{distance:10.198039027185569,direction:-1.7681918866447774},Odstemplik:{distance:19.1049731745428,direction:-1.6756732655251305},Okolaks:{distance:11.180339887498949,direction:-1.750649826587375},"Old Standard TT":{distance:14.142135623730951,direction:-1.7126933813990606},"Open Sans":{distance:12.165525060596439,direction:-1.7359450042095235},"Ostrich Sans":{distance:14.142135623730951,direction:-1.7126933813990606},Oswald:{distance:19.4164878389476,direction:1.7782925532300993},Overlock:{distance:8.246211251235321,direction:1.8157749899217608},Pacifico:{distance:50.00999900019995,direction:1.5907936607680473},Palitoon:{distance:10.198039027185569,direction:-1.7681918866447774},"Pix Antiqua":{distance:8.246211251235321,direction:-1.8157749899217608},"Playfair Display":{distance:19.1049731745428,direction:1.6756732655251305},Quicksand:{distance:5.385164807134504,direction:1.1902899496825317},Raleway:{distance:5.385164807134504,direction:1.9513027039072617},Roboto:{distance:14.142135623730951,direction:-1.7126933813990606},"Roboto Slab":{distance:16.1245154965971,direction:1.6951513213416582},"Rock Salt":{distance:9.219544457292887,direction:-1.7894652726688387},Sacramento:{distance:4.47213595499958,direction:2.0344439357957027},"Sigmar One":{distance:28.071337695236398,direction:1.642103791580187},Silkscreen:{distance:15.132745950421556,direction:-1.7033478590915707},Sofia:{distance:24.08318915758459,direction:1.653937558683338},"Spicy Rice":{distance:12.165525060596439,direction:1.7359450042095235},"Teen Light":{distance:12.041594578792296,direction:-1.653937558683338},Teen:{distance:12.165525060596439,direction:-1.7359450042095235},Temporarium:{distance:13.152946437965905,direction:-1.7234456551901618},"Times New Roman":{distance:21.095023109728988,direction:-1.665748033137653},"Trebuchet MS":{distance:16.1245154965971,direction:-1.6951513213416582},Ubuntu:{distance:12.041594578792296,direction:-1.653937558683338},"Varela Round":{distance:5.385164807134504,direction:2.761086276477428},Vavont:{distance:10.198039027185569,direction:-1.7681918866447774},Veggieburger:{distance:7.280109889280518,direction:-1.849095985800008},Verdana:{distance:12.165525060596439,direction:-1.7359450042095235},Vollkorn:{distance:19.1049731745428,direction:-1.6756732655251305},Yellowtail:{distance:7.0710678118654755,direction:1.7126933813990606},"Adobe Caslon Pro":{distance:16.1245154965971,direction:-1.6951513213416582},"Adobe Devanagari":{distance:18.24828759089466,direction:-1.7359450042095235},"Adobe Garamond Pro":{distance:17.11724276862369,direction:-1.687905071361761},"Adobe Gurmukhi":{distance:15.297058540778355,direction:-1.7681918866447774},"Al Nile":{distance:21.213203435596427,direction:-1.7126933813990606},"American Typewriter":{distance:22.090722034374522,direction:-1.661456213995642},"Andale Mono":{distance:20.09975124224178,direction:-1.6704649792860586},"Apple Chancery":{distance:11.180339887498949,direction:-1.750649826587375},"Apple Color Emoji":{distance:21.213203435596427,direction:-1.7126933813990606},"Apple Symbols":{distance:23.08679276123039,direction:-1.6575346654708818},Arial:{distance:18.027756377319946,direction:-1.6262948320406136},"Arial Black":{distance:19.1049731745428,direction:-1.6756732655251305},"Arial Hebrew":{distance:21.213203435596427,direction:-1.7126933813990606},"Arial Hebrew Scholar":{distance:21.213203435596427,direction:-1.7126933813990606},"Arial Narrow":{distance:18.027756377319946,direction:-1.6262948320406136},"Arial Rounded MT Bold":{distance:18.110770276274835,direction:-1.6814535479687924},"Arial Unicode MS":{distance:18.027756377319946,direction:-1.6262948320406136},Ayuthaya:{distance:17.11724276862369,direction:1.687905071361761},"Bangla MN":{distance:4.47213595499958,direction:-2.0344439357957027},"Bangla Sangam MN":{distance:19.1049731745428,direction:-1.6756732655251305},Baskerville:{distance:3,direction:3.141592653589793},"Birch Std":{distance:16.1245154965971,direction:-1.6951513213416582},"Blackoak Std":{distance:16.1245154965971,direction:-1.6951513213416582},"Bodoni Ornaments":{distance:10.44030650891055,direction:-1.8622531212727638},Chalkboard:{distance:7.280109889280518,direction:1.849095985800008},Chalkduster:{distance:8.246211251235321,direction:1.8157749899217608},"Chaparral Pro":{distance:17.11724276862369,direction:-1.687905071361761},Cochin:{distance:19.1049731745428,direction:-1.6756732655251305},Copperplate:{distance:13.152946437965905,direction:-1.7234456551901618},"Corsiva Hebrew":{distance:21.213203435596427,direction:-1.7126933813990606},"Courier New":{distance:28.071337695236398,direction:-1.642103791580187},"Devanagari MT":{distance:21.213203435596427,direction:-1.7126933813990606},"Devanagari Sangam MN":{distance:8.06225774829855,direction:-1.6951513213416582},Didot:{distance:3.605551275463989,direction:2.1587989303424644},"Euphemia UCAS":{distance:13.152946437965905,direction:-1.7234456551901618},Geneva:{distance:11.180339887498949,direction:-1.750649826587375},"Gill Sans":{distance:21.095023109728988,direction:-1.665748033137653},"Gujarati MT":{distance:21.213203435596427,direction:-1.7126933813990606},"Gujarati Sangam MN":{distance:24.08318915758459,direction:1.653937558683338},"Gurmukhi MN":{distance:14.142135623730951,direction:-1.7126933813990606},"Gurmukhi MT":{distance:21.213203435596427,direction:-1.7126933813990606},"Gurmukhi Sangam MN":{distance:15.132745950421556,direction:-1.7033478590915707},Helvetica:{distance:16.1245154965971,direction:-1.6951513213416582},"Helvetica Neue":{distance:6.324555320336759,direction:1.892546881191539},Herculanum:{distance:2.8284271247461903,direction:2.356194490192345},"Hoefler Text":{distance:4.47213595499958,direction:2.0344439357957027},Impact:{distance:12.165525060596439,direction:-1.7359450042095235},InaiMathi:{distance:23.08679276123039,direction:-1.6575346654708818},"Kannada MN":{distance:14.142135623730951,direction:-1.7126933813990606},"Kannada Sangam MN":{distance:22.090722034374522,direction:-1.661456213995642},"Khmer MN":{distance:20.09975124224178,direction:-1.6704649792860586},"Khmer Sangam MN":{distance:22.02271554554524,direction:1.6162196062164738},"Kohinoor Bangla":{distance:15.033296378372908,direction:1.6373644905707205},"Kohinoor Telugu":{distance:15.033296378372908,direction:1.6373644905707205},Krungthep:{distance:10.198039027185569,direction:1.7681918866447774},"Lao MN":{distance:8.246211251235321,direction:-1.8157749899217608},"Lao Sangam MN":{distance:15.033296378372908,direction:-1.6373644905707205},"Lithos Pro":{distance:17.11724276862369,direction:-1.687905071361761},"Lucida Grande":{distance:11.045361017187261,direction:-1.661456213995642},Luminari:{distance:8.246211251235321,direction:1.8157749899217608},"Malayalam MN":{distance:14.142135623730951,direction:-1.7126933813990606},"Malayalam Sangam MN":{distance:9.219544457292887,direction:-1.7894652726688387},"Microsoft Sans Serif":{distance:18.027756377319946,direction:-1.6262948320406136},"Minion Pro":{distance:17.26267650163207,direction:-1.7454685258031364},Mshtakan:{distance:21.213203435596427,direction:-1.7126933813990606},"Myanmar MN":{distance:5.385164807134504,direction:-1.9513027039072617},"Myanmar Sangam MN":{distance:15.033296378372908,direction:-1.6373644905707205},"Myriad Arabic":{distance:23.08679276123039,direction:-1.6575346654708818},"Myriad Hebrew":{distance:15.132745950421556,direction:-1.7033478590915707},"New Peninim MT":{distance:21.213203435596427,direction:-1.7126933813990606},"OCR A Std":{distance:13.152946437965905,direction:-1.7234456551901618},"Oriya MN":{distance:14.142135623730951,direction:-1.7126933813990606},"Oriya Sangam MN":{distance:10.198039027185569,direction:-1.7681918866447774},Palatino:{distance:8.246211251235321,direction:-1.8157749899217608},Papyrus:{distance:3.605551275463989,direction:2.1587989303424644},"Plantagenet Cherokee":{distance:21.095023109728988,direction:-1.665748033137653},"PT Mono":{distance:13.152946437965905,direction:-1.7234456551901618},"PT Sans":{distance:15.033296378372908,direction:-1.6373644905707205},"PT Sans Caption":{distance:15.033296378372908,direction:-1.6373644905707205},"PT Sans Narrow":{distance:15.132745950421556,direction:-1.7033478590915707},"PT Serif":{distance:13.341664064126334,direction:-1.7975951748487826},"PT Serif Caption":{distance:13.341664064126334,direction:-1.7975951748487826},Raanana:{distance:21.213203435596427,direction:-1.7126933813990606},Sathu:{distance:2.23606797749979,direction:2.677945044588987},Seravek:{distance:2.23606797749979,direction:2.0344439357957027},"SignPainter-HouseScript":{distance:20.09975124224178,direction:-1.6704649792860586},Silom:{distance:5.385164807134504,direction:1.9513027039072617},"Sinhala MN":{distance:9.219544457292887,direction:-1.7894652726688387},"Sinhala Sangam MN":{distance:12.041594578792296,direction:1.653937558683338},"Snell RoundHand":{distance:21.095023109728988,direction:-1.665748033137653},"Source Sans Pro":{distance:16.1245154965971,direction:-1.6951513213416582},"STIXGeneral-Bold":{distance:15.132745950421556,direction:-1.7033478590915707},"STIXGeneral-BoldItalic":{distance:15.132745950421556,direction:-1.7033478590915707},"STIXGeneral-Italic":{distance:16.1245154965971,direction:-1.6951513213416582},"STIXGeneral-Regular":{distance:15.132745950421556,direction:-1.7033478590915707},"STIXVariants-Regular":{distance:21.213203435596427,direction:-1.7126933813990606},STSong:{distance:5.385164807134504,direction:-1.9513027039072617},Symbol:{distance:21.213203435596427,direction:-1.7126933813990606},Tahoma:{distance:13.152946437965905,direction:-1.7234456551901618},"Tamil MN":{distance:2.23606797749979,direction:-2.677945044588987},"Tamil Sangam MN":{distance:54.037024344425184,direction:-1.6078164426688268},"Telugu MN":{distance:14.142135623730951,direction:-1.7126933813990606},"Telugu Sangam MN":{distance:16.1245154965971,direction:-1.6951513213416582},Thonburi:{distance:5.385164807134504,direction:1.9513027039072617},Trattatello:{distance:15.132745950421556,direction:-1.7033478590915707},Webdings:{distance:11.40175425099138,direction:-1.837048375945822},Wingdings:{distance:7.280109889280518,direction:-1.849095985800008},Zapfino:{distance:80.05623023850174,direction:1.6082787634865583}},BFN.AppModelViewStates={VIEWING_PHOTO_EDITOR:"VIEWING_PHOTO_EDITOR",VIEWING_COLLAGE_MAKER:"VIEWING_COLLAGE_MAKER",VIEWING_DESIGNER:"VIEWING_DESIGNER"},BFN.AppModelEvents={APP_READY:new Event("APP_READY"),APP_COMPLETE:new Event("APP_COMPLETE"),VIEWSTATE_UPDATED:new Event("VIEWSTATE_UPDATED")};var qn=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){var e=this;BeFunky.log("AppModel Init"),this.initViewState(),this.initDefaultValues(),this.appReady=!1,window.addEventListener("INIT",function(){e.appReady=!0,e.dispatchEvent(BFN.AppModelEvents.APP_READY)}),window.addEventListener("INIT_COMPLETE",function(){e.dispatchEvent(BFN.AppModelEvents.APP_COMPLETE)})}},{key:"initDefaultValues",value:function(){}},{key:"initViewState",value:function(){var e=this;this.viewStateChangeReason=null;var t=(window.currentDeepLinkParameters||{}).type;"collage"===t?this._viewState=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:"designer"===t?this._viewState=BFN.AppModelViewStates.VIEWING_DESIGNER:(this._viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,t||BeFunky.throwError("Missing currentDeepLinkParameters",window.currentDeepLinkParameters)),window.addEventListener("INIT_COMPLETE",function(){setTimeout(function(){e.applicationModeChange(window.currentDeepLinkParameters.type)},0)})}},{key:"applicationModeChange",value:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"photoeditor"){case"photoeditor":BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR;break;case"collage":BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER;break;case"designer":BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_DESIGNER;break;default:BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR}}},{key:"handleAppGoto",value:function(){switch(UITools.getToolVO("app_goto").updating_id){case"photo_editor":this.viewStateChangeReason="Top Menu",this.applicationModeChange("photoeditor");break;case"collage_maker":this.viewStateChangeReason="Top Menu",this.applicationModeChange("collage");break;case"designer":this.viewStateChangeReason="Top Menu",this.applicationModeChange("designer");break;case"edit_source_section":BFN.ImageEditManager.targetViewstate&&(this.viewState=BFN.ImageEditManager.targetViewstate)}this.viewStateChangeReason=null}},{key:"isFullScreen",value:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}},{key:"toggleFullscreen",value:function(){var e=this;if(this.isFullScreen())this.exitFullscreen();else{if(BFN.BfnService.userIsPlus)return BFN.BfnService.track("CREATE","TOOLBAR","FULLSCREEN"),void this.showFullscreen();BFN.BfnService.track("CREATE","TOOLBAR","FULLSCREEN_PREVIEW"),BeFunky.confirm("confirm_fullscreen_mode",{onConfirm:function(){e.showFullscreen(),setTimeout(function(){e.isFullScreen()&&e.exitFullscreen()},1e4)},confirmText:"yes",cancelText:"no"})}}},{key:"showFullscreen",value:function(){var e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen;t&&t.call(e)}},{key:"exitFullscreen",value:function(){var e=document,t=e.cancelFullScreen||e.webkitCancelFullScreen||e.mozCancelFullScreen||e.exitFullscreen;t&&t.call(e),BFN.BfnService.userIsPlus||setTimeout(function(){UIMessages.display("confirm_fullscreen_mode_message",1e3)},500)}},{key:"sectionValue",value:function(e,t,n){return this.viewingEditor?e:this.viewingCollage?t:this.viewingDesigner?n:void BeFunky.throwError("sectionValue called to early")}},{key:"getSectionValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;switch(e){case"editor":case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:return t;case"collage":case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:return n;case"designer":case BFN.AppModelViewStates.VIEWING_DESIGNER:return i}return null}},{key:"viewState",set:function(e){if(BFN.ImageEditManager.editingImage&&this._viewState===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&e!==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR)BFN.ImageEditManager.overrideSetAppViewState(e);else if(BFN.TransformItemIsolator.active)BFN.TransformModel.isolatorEditComplete();else{this._viewState=e,BeFunky.setLocal("lastAppSection",BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer"));var t,n=BeFunky.LanguageManager.language.app;t="es"===n?this.sectionValue("es/crear","es/crear/collage","es/crear/disenador"):"pt"===n?this.sectionValue("pt/criar","pt/criar/colagem","pt/criar/design"):"de"===n?this.sectionValue("de/erstellen","de/erstellen/collagen","de/erstellen/designer"):"fr"===n?this.sectionValue("fr/creer","fr/creer/collage","fr/creer/designer"):this.sectionValue("create","create/collage","create/designer");var i=window.currentDeepLinkParameters.type;BeFunky.isCreateRoute()?this.viewingEditor&&["collage","designer"].includes(i)?(BeFunky.pushRoute(t),window.currentDeepLinkParameters={type:"photoeditor"}):this.viewingCollage&&"collage"!==i?(BeFunky.pushRoute(t),window.currentDeepLinkParameters={type:"collage"}):this.viewingDesigner&&"designer"!==i&&(BeFunky.pushRoute(t),window.currentDeepLinkParameters={type:"designer"}):BeFunky.reportWarning("App section changed when user is not in create route",window.location.href,window.isAppOpen);var r=BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1],a=function(e){return e.split("?")[0].split("#")[0]},o=this.sectionValue("photo_editor","collage_maker","graphic_designer"),s=BeFunky.LanguageManager.getString(o);BeFunky.isInstalled()?document.title="".concat(s," | BeFunky"):a(BeFunky.initialRoute)===a(r)?document.title=BeFunky.originalPageTitle:document.title.includes("|")&&(document.title="".concat(s," |").concat(document.title.split("|").slice(1).join("|"))),BeFunky.setSentryTag("app_section",this.sectionID),this.dispatchEvent(BFN.AppModelEvents.VIEWSTATE_UPDATED)}},get:function(){return this._viewState}},{key:"viewingEditor",get:function(){return this._viewState===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR}},{key:"viewingCollage",get:function(){return this._viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER}},{key:"viewingDesigner",get:function(){return this._viewState===BFN.AppModelViewStates.VIEWING_DESIGNER}},{key:"sectionID",get:function(){return this.sectionValue("editor","collage","designer")}}]),n}();function Kn(){var e=g(["<p>","</p>"]);return Kn=function(){return e},e}function Qn(){var e=g(["<p>","</p>"]);return Qn=function(){return e},e}function Zn(){var e=g(["\n                <p>"," ","</p>\n                ","\n                <p>","</p>\n                ","\n            "]);return Zn=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.AppModel=new qn}),BFN.StageModelEvents={STAGE_DIMENSIONS_UPDATED:new Event("STAGE_DIMENSIONS_UPDATED")};var Jn=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){var e=this;BeFunky.log("StageModel Init"),this.appStage=document.getElementById("appStage");var t=this.appStage.getBoundingClientRect();this._stageW=t.width,this._stageH=t.height,this.appViewport=document.getElementById("appViewport"),window.webglUnmaskedRenderer&&(console.log("GRAPHIC: ".concat(window.webglUnmaskedRenderer)),BeFunky.setSentryTag("graphics_card",window.webglUnmaskedRenderer),navigator.deviceMemory&&BeFunky.setSentryTag("memory","".concat(navigator.deviceMemory,"GB")));try{BFN.Stage=new PIXI.WebGLRenderer(Math.ceil(BFN.appRect.width-BFN.CSS.leftMenuBarWidth),Math.ceil(BFN.appRect.height-BFN.CSS.topMenuBarHeight),{transparent:!0,autoResize:!0,preserveDrawingBuffer:!0,antialias:!1,resolution:window.bfn_resolution?window.bfn_resolution:1})}catch(e){return BeFunky.logError("WebGL is unavailable. Telling user... ".concat(BeFunky.stringValue(e))),this.handleWebGLUnavailable()}this.appStage.appendChild(BFN.Stage.view),BFN.Stage.view.oncontextmenu=function(){return!1};try{BFN.Stage.gl.getExtension("OES_standard_derivatives")}catch(e){}BFN.Stage.state&&(BFN.Stage.state.blendModes[21]=[WebGLRenderingContext.ONE_MINUS_DST_COLOR,WebGLRenderingContext.ONE_MINUS_SRC_COLOR,1,1],BFN.Stage.state.blendModes[22]=[WebGLRenderingContext.ONE,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA,1,1],BFN.Stage.state.blendModes[23]=[WebGLRenderingContext.ONE,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA,1,1],BFN.Stage.state.blendModes[24]=[WebGLRenderingContext.ONE,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA,1,1]),BFN.renderTexturesPool||BFN.Util.createRenderTexturePool(),this.debouncedResize=BeFunky.debounce(this.debouncedResize.bind(this),250),this.updatePixiRectangle(),BFN.Stage.view.addEventListener("webglcontextlost",this.handleWebGLContextLost.bind(this)),BFN.PIXITicker=PIXI.ticker.shared,BFN.PIXITicker.autoStart=!1,BFN.PIXITicker.stop(),BFN.PIXITicker.keepRunning=!1,BFN.PIXITicker.stopPending=!1,BFN.PIXITicker.nudge=function(){BFN.PIXITicker.started||BFN.PIXITicker.start(),BFN.PIXITicker.stopPending=!0,BFN.PIXITicker.completeNudge()},BFN.PIXITicker.completeNudge=BeFunky.debounce(function(){BFN.PIXITicker.keepRunning||BFN.PIXITicker.stop(),BFN.PIXITicker.stopPending=!1},500),this.updateRendererDimensions(),this.setRefreshFactor(1),BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this)),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,function(){return setTimeout(BFN.StageModel.updateStageDimensions.bind(e),0)}),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.CUSTOM_RESIZE_EVENT.type,function(){return setTimeout(BFN.StageModel.updateStageDimensions.bind(e),0)}),BFN.TextureUtils.setupReusableImageTexture(),this.appStageContainer=document.getElementById("canvas_container");var n=function(t){var n=t.name,i=t.hex;e.appStage.setStyles({backgroundColor:"#".concat(BFN.ColorUtil.hexNumberToHexString(i))}),e.appStageContainer.setClass("canvas canvas--".concat(n))};n(mn()),gn(n)}},{key:"debouncedResize",value:function(){var e=this;requestAnimationFrame(function(){e.updateRendererDimensions()})}},{key:"updateStageDimensions",value:function(){var e=BFN.appViewportRect;e.width<1&&e.height<1||(this.debouncedResize(),this._stageH===e.height&&this._stageW===e.width||(BFN.MainUI.x=e.left-BFN.CSS.leftMenuBarWidth,BFN.MainUI.y=e.top-BFN.CSS.topMenuBarHeight,this._stageW=e.width,this._stageH=e.height,this.dispatchEvent(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED)))}},{key:"updatePixiRectangle",value:function(e){e||(e={width:BFN.appRect.width-BFN.CSS.leftMenuBarWidth,height:BFN.appRect.height-BFN.CSS.topMenuBarHeight-BFN.CSS.footerHeight});try{BFN.Stage.plugins.interaction.befunkyCanvasRect={width:e.width,height:e.height,x:BFN.CSS.leftMenuBarWidth,y:BFN.CSS.topMenuBarHeight,top:BFN.CSS.topMenuBarHeight,left:BFN.CSS.leftMenuBarWidth,bottom:e.height+BFN.CSS.topMenuBarHeight,right:e.width+BFN.CSS.leftMenuBarWidth}}catch(e){}}},{key:"updateRendererDimensions",value:function(){var e={width:BFN.appRect.width-BFN.CSS.leftMenuBarWidth,height:BFN.appRect.height-BFN.CSS.topMenuBarHeight-BFN.CSS.footerHeight};e.width*BFN.Stage.resolution===BFN.Stage.width&&e.height*BFN.Stage.resolution===BFN.Stage.height||(BFN.Stage.resize(Math.ceil(e.width),Math.ceil(e.height)),this.updatePixiRectangle(e),BFN.MainUI&&(BFN.MainUI.renderCanvas(),BFN.MainUI.renderCanvas()))}},{key:"setRefreshFactor",value:function(e){this._refreshFactor!=e&&(BeFunky.log("SETTING REFRESH FACTOR : ".concat(e)),this._refreshFactor=e,BFN.frameRate=Math.round(BFN.baseFrameRate*this._refreshFactor),BFN.frameInterval=Math.round(1e3/BFN.frameRate))}},{key:"handleAppReady",value:function(){this.updateStageDimensions()}},{key:"handleWebGLUnavailable",value:function(){window.onbeforeunload=null,["editor","collage","designer"].forEach(function(e){BeFunky.setLocal("force_use_autosave__".concat(e),"true")}),function(){var e="";e=BeFunky.isChrome?"Chrome":BeFunky.isFirefox?"Firefox":BeFunky.isSafari?"Safari":BeFunky.isEdge?"Microsoft Edge":BeFunky.LanguageManager.getString("your_browser");var t={your_browser:e,alternate_browser:BeFunky.isChrome?"Firefox":"Chrome",contact_support:BeFunky.toLinkHTML("SUPPORT",!0)};BeFunky.acknowledge(["error_webgl_unavailable",t],{isCritical:!0,disableClose:!0}),BeFunky.logError("User message:",BeFunky.LanguageManager.getStringReplacements("error_webgl_unavailable",t))}(),function(){var e="webgl unavailable during app initialization";if("visible"!==document.visibilityState)throw new Error("".concat(e," - tab not visible"));if(BFN.tabRecentlyReopened)throw new Error("".concat(e," - tab recently re-opened"));throw new Error(e)}()}},{key:"handleWebGLContextLost",value:function(){BeFunky.webglContextWasLost=!0,BeFunky.logError("webglTextureSize:",window.webglTextureSize);try{if(void 0!==window.webglUnmaskedRenderer){BeFunky.logError("webglUnmaskedRenderer: ",window.webglUnmaskedRenderer);try{BFN.BfnService.track("EXTERNAL","WEBGL_GRAPHIC_PROBLEM",window.webglUnmaskedRenderer)}catch(e){}}}catch(e){}BeFunky.logError("Texture Memory: ".concat(BFN.Util.getTotalTextureMemory()," MB")),navigator.deviceMemory&&BeFunky.logError("Device Memory: ".concat(navigator.deviceMemory," GB")),BeFunky.logError("appRect:","".concat(BFN.appRect.width," x ").concat(BFN.appRect.height)),BFN.AppModel.viewingEditor&&(BeFunky.logError("Current tool:",BFN.PhotoEditorCanvasModel.viewState),BeFunky.logError("Photo Editor canvas size:","".concat(BFN.PhotoEditorModel.currentTextureDimensions.width," x ").concat(BFN.PhotoEditorModel.currentTextureDimensions.height))),Object.values(BFN.ProjectManager.autoSave).forEach(function(e){e.allowAutoSave=!1});try{window.onbeforeunload=null}catch(e){}["editor","collage","designer"].forEach(function(e){BeFunky.setLocal("force_use_autosave__".concat(e),"true")}),function(){var e=BFN.AppModel.sectionID,t="IndexedDB"===BFN.ProjectManager.autoSave[e].lastSaveLocation,n=window.failed_webgl_tests.includes("no_high_perf_canvas"),i=parseInt(BeFunky.getLocal("last_webgl_crash"))||0,r=Date.now();BeFunky.setLocal("last_webgl_crash",r.toString());var a=r-i<6912e5,o=BeFunky.lit,s=o.html,l=o.appLang;BeFunky.openNebulaDialog({body:function(){return s(Zn(),l("error_webglcontextlost"),l(t?"error_webglcontextlost_autosave":""),n?s(Qn(),l(["error_webglcontextlost_low_perf",{learn_how_to_fix:BeFunky.toLinkHTML(BeFunky.getArticleForPerfIssue(),!0)}])):"",l(["error_webglcontextlost_restart",{alternate_browser:BeFunky.isChrome?"Firefox":"Chrome"}]),a?s(Kn(),l(["optionally_contact_support",{contact_support:BeFunky.toLinkHTML("SUPPORT",!0)}])):"")},modalOptions:{isCritical:!0,disableClose:!0}})}(),function(){var e="webgl context lost";if(setTimeout(function(){window.Sentry&&(console.log("Stop Sentry from sending further errors "),Sentry.captureException=function(){},Sentry.getCurrentHub().getClient().getOptions().enabled=!1)},0),"visible"!==document.visibilityState)throw new Error("".concat(e," - tab not visible"));if(BFN.tabRecentlyReopened)throw new Error("".concat(e," - tab recently re-opened"));throw new Error(e)}()}},{key:"stageW",get:function(){return this._stageW}},{key:"stageH",get:function(){return this._stageH}},{key:"mouseX",get:function(){return BFN.Stage.plugins.interaction.mouse.global.x}},{key:"mouseY",get:function(){return BFN.Stage.plugins.interaction.mouse.global.y}}]),n}();function $n(){BFN.EventDispatcher.call(this),this.init()}function ei(){BFN.EventDispatcher.call(this),this.init()}function ti(){BFN.EventDispatcher.call(this),this.init()}BFN.SingletonQueue.add(function(){BFN.StageModel=new Jn}),BFN.TransformModelEvents={TRANSFORM_ITEM_UPDATED:new Event("TRANSFORM_ITEM_UPDATED"),TRANSFORM_ITEM_TEXT_UPDATED:new Event("TRANSFORM_ITEM_TEXT_UPDATED")},$n.prototype=Object.create(BFN.EventDispatcher.prototype),$n.prototype.init=function(){var e=this;BeFunky.log("TransformModel Init"),this.initDefaultValues(),window.addEventListener("INIT",function(){e.initContextMenu()})},$n.prototype.initDefaultValues=function(){this._selectedTransformItem=null,this._selectedTransformItemText=null,this._selectedGroupType=null,this.tempTransformItem=null,this.addedTransformItem=null,this.selectItemOnAdd=!0,this.startValue=null,this.maskImageSizeUpdating=!1,this.opacityUpdating=!1,this.overlayColorUpdating=!1,this.tintColorUpdating=!1,this.shapeAttributeUpdating=!1,this.borderAttributeUpdating=!1,this.dropShadowAttributeUpdating=!1,this.defaultLayerColors={overlay:"FF0000",tint:"FF0000",border:"FF0000"},this.defaultDropShadowVO=new BFN.DropShadowVO({color:"000000"}),this.layerItem=null,this._awaitingDrop=!1,this._focusedTransformItem=null,this._targetTransformItem=null,this.snappingEnabled=!0,this.showMeasurements=!1,this.handleSelectItemAfterEditBind=this.handleSelectItemAfterEdit.bind(this)},$n.prototype.initContextMenu=function(){var e=this;this.contextMenu=document.getElementById("context_menu_transform");var t={delete_item:{onClick:function(){n("transform_delete"),e.contextMenu.hide()},shortcutText:"Del"},duplicate_item:{onClick:function(){return n("transform_duplicate")},hasDivider:!0,shortcutText:BFN.shortcutText("D")},align:{hasDivider:!0,children:{align_left:{onClick:function(){return n("transform_align_left")}},align_center:{onClick:function(){return n("transform_align_center")}},align_right:{onClick:function(){return n("transform_align_right")}},align_top:{onClick:function(){return n("transform_align_top")}},align_middle:{onClick:function(){return n("transform_align_middle")}},align_bottom:{onClick:function(){return n("transform_align_bottom")}}}},flip:{onClick:function(){},hasDivider:!0,children:{horizontal:{onClick:function(){return n("transform_flip_horizontal")}},vertical:{onClick:function(){return n("transform_flip_vertical")}}}},layer_order:{onClick:function(){},hasDivider:!0,children:{move_backwards:{onClick:function(){return n("transform_move_backwards")}},move_forwards:{onClick:function(){return n("transform_move_forwards")}}}},select_group:{children:{}},add_to_group:{children:{}},remove_from_group:{children:{}},canvas:{children:{fit_to_canvas:{onClick:function(){return n("transform_fit_to_canvas")}},fill_canvas:{onClick:function(){return n("transform_fill_canvas")}}}}};function n(e){UITools.setControlValue(e,!0),UITools.applyToolControl(e),UITools.setControlValue(e,!1)}BeFunky.Params.isAdmin&&(t.patch={hasDivider:!0,children:{}}),BeFunky.contextMenu(this.contextMenu,t,{hideOnClick:!1}),BeFunky.Params.isAdmin&&this.contextMenu.hideButton("patch"),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},$n.prototype.handleTransform=function(){var e=this,t=UITools.getToolVO("transform"),n=t.updating_id;if(this._selectedTransformItem){var i=this._selectedTransformItem,r="group"==i.type,a=i.basicShapeVO;if(a){var o=function(n,o){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)s&&(e.shapeAttributeUpdating!=t.updating&&(e.shapeAttributeUpdating=t.updating,e.shapeAttributeUpdating?(i.clearDropShadow(),i.createTransition(n)):(a.setValues(o),i.selectedItems.forEach(function(e){e.basicShapeVO&&e.basicShapeVO.setValues(o)}),i.updateShapeTexture(),i.registerTransition(),BFN.BasicShapeManager.updateDefaultValues(o))),e.shapeAttributeUpdating&&(a.setValues(o),i.selectedItems.forEach(function(e){e.basicShapeVO&&e.basicShapeVO.setValues(o)}),i.updateShapeTexture(!1)));else{if(e.shapeAttributeUpdating!=t.updating)if(e.shapeAttributeUpdating=t.updating,e.shapeAttributeUpdating)e.startValue=Object.assign({},a.getValues()),i.clearDropShadow(),i.createTransition(n);else{var l=!1;for(var u in o)o[u]!==e.startValue[u]&&(l=!0);l?(i.registerTransition(),BFN.BasicShapeManager.updateDefaultValues(o)):i.updateDropShadowSource()}a.setValues(o),i.updateShapeTexture(!t.updating)}},s=function(e,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t.updating||(r?o&&(i.clearDropShadow(),i.createTransition(e),a.setValues(n),i.selectedItems.forEach(function(e){e.basicShapeVO&&e.basicShapeVO.setValues(n)}),i.updateShapeTexture(),i.registerTransition(),s&&BFN.BasicShapeManager.updateDefaultValues(n)):(i.clearDropShadow(),i.createTransition(e),a.setValues(n),i.updateShapeTexture(),i.registerTransition(),s&&BFN.BasicShapeManager.updateDefaultValues(n)))};switch(n){case"shape_fill_enabled":if(s(t.shape_fill_enabled?"history_shape_fill_on":"history_shape_fill_off",{fill:t.shape_fill_enabled?-1!==BFN.BasicShapeManager.defaultValues.fill?BFN.BasicShapeManager.defaultValues.fill:BFN.BasicShapeManager.defaultFill:-1,useFillBak:!0},!0,!1),t.shape_fill_enabled)if(r){var l=i.getGroupItemData(),u=l.shapeFill&&"mixed"!=l.shapeFill?l.shapeFill:-1,c=-1,h=1;-1!=u&&"mixed"!=l.shapeFillAlpha&&(c=u,h=l.shapeFillAlpha),UITools.setToolValue("transform","shape_fill_color",c),UITools.setToolValue("transform","shape_fill_color_intensity",h),UITools.updateToolControl("transform_shape_fill_color"),-1!==c&&BFN.BasicShapeManager.updateDefaultValues({fill:c})}else UITools.setToolValue("transform","shape_fill_color",a.fill),UITools.setToolValue("transform","shape_fill_color_intensity",a.fillAlpha),UITools.updateToolControl("transform_shape_fill_color"),-1!==a.fill&&BFN.BasicShapeManager.updateDefaultValues({fill:a.fill});else BFN.BasicShapeManager.updateDefaultValues({fill:-1});break;case"shape_stroke_enabled":if(s(t.shape_stroke_enabled?"history_shape_stroke_on":"history_shape_stroke_off",{stroke:t.shape_stroke_enabled?-1!==BFN.BasicShapeManager.defaultValues.stroke?BFN.BasicShapeManager.defaultValues.stroke:BFN.BasicShapeManager.defaultStroke:-1,useStrokeBak:!0},!0,!1),t.shape_stroke_enabled)if(r){var d=i.getGroupItemData(),m=d.shapeStroke&&"mixed"!=d.shapeStroke?d.shapeStroke:-1,p=-1,g=1;-1!=m&&"mixed"!=d.shapeStrokeAlpha&&(p=m,g=d.shapeStrokeAlpha),UITools.setToolValue("transform","shape_stroke_color",p),UITools.setToolValue("transform","shape_stroke_color_intensity",g),UITools.updateToolControl("transform_shape_stroke_color"),-1!==p&&BFN.BasicShapeManager.updateDefaultValues({stroke:p})}else UITools.setToolValue("transform","shape_stroke_color",a.stroke),UITools.setToolValue("transform","shape_stroke_color_intensity",a.strokeAlpha),UITools.updateToolControl("transform_shape_stroke_color"),-1!==a.stroke&&BFN.BasicShapeManager.updateDefaultValues({stroke:a.stroke});else BFN.BasicShapeManager.updateDefaultValues({stroke:-1});break;case"shape_fill_color":o("history_shape_fill_color",{fill:t.shape_fill_color,fillAlpha:parseFloat(t.shape_fill_color_intensity)},!0);break;case"shape_stroke_color":o("history_shape_stroke_color",{stroke:t.shape_stroke_color,strokeAlpha:parseFloat(t.shape_stroke_color_intensity)},!0);break;case"shape_stroke_width":o("history_shape_stroke_width",{strokeWidth:parseInt(t.shape_stroke_width)},!0);break;case"shape_line_style":s("history_shape_line_style",{lineStyle:t.shape_line_style}),UITools.toggleControlItem("transform_shape_line_segment_width","dashed"===t.shape_line_style),UITools.toggleControlItem("transform_shape_line_gap_size","solid"!==t.shape_line_style);break;case"shape_line_segment_width":o("history_shape_line_segment_width",{lineSegmentWidth:parseInt(t.shape_line_segment_width)/100*9+1});break;case"shape_line_gap_size":o("history_shape_line_gap_size",{lineGapSize:parseInt(t.shape_line_gap_size)/50});break;case"shape_rectangle_corner_rounding":o("history_shape_rectangle_corner_rounding",{rectangleCornerRounding:parseInt(t.shape_rectangle_corner_rounding)/100});break;case"shape_polygon_sides":o("history_shape_polygon_sides",{polygonSides:parseInt(t.shape_polygon_sides)});break;case"shape_polygon_shift_orientation":s("history_shape_polygon_shift_orientation",{polygonShiftOrientation:t.shape_polygon_shift_orientation});break;case"shape_star_points":o("history_shape_star_points",{starPoints:parseInt(t.shape_star_points)});break;case"shape_star_inset_weight":o("history_shape_star_inset_weight",{starInsetWeight:parseInt(t.shape_star_inset_weight)/100});break;case"shape_star_shift_orientation":s("history_shape_star_shift_orientation",{starShiftOrientation:t.shape_star_shift_orientation});break;case"shape_arrow_style":s("history_shape_arrow_style",{arrowStyle:t.shape_arrow_style});break;case"shape_arrow_weight":o("history_shape_arrow_weight",{arrowWeight:parseInt(t.shape_arrow_weight)/100});break;case"shape_arrow_double_sided":s("history_shape_arrow_double_sided",{arrowDoubleSided:t.shape_arrow_double_sided})}}var f=i.borderBasicShapeVO;if(f){var v=function(n,a){if(r)e.borderAttributeUpdating!=t.updating&&(e.borderAttributeUpdating=t.updating,e.borderAttributeUpdating?(i.clearDropShadow(),i.createTransition(n)):(f.setValues(a),i.selectedItems.forEach(function(e){e.borderBasicShapeVO&&e.borderBasicShapeVO.setValues(a)}),i.updateBorderTexture(),i.registerTransition())),e.borderAttributeUpdating&&(f.setValues(a),i.selectedItems.forEach(function(e){e.borderBasicShapeVO&&e.borderBasicShapeVO.setValues(a)}),i.updateBorderTexture(!1));else{if(e.borderAttributeUpdating!=t.updating)if(e.borderAttributeUpdating=t.updating,e.borderAttributeUpdating)e.startValue=Object.assign({},f.getValues()),i.clearDropShadow(),i.createTransition(n);else{var o=!1;for(var s in a)a[s]!==e.startValue[s]&&(o=!0);o?i.registerTransition():i.updateDropShadowSource()}f.setValues(a),i.updateBorderTexture(!t.updating)}};switch(n){case"image_border_enabled":if(!t.updating)if(r){var y=BFN.TransformItemGroup.getGroupItemData();if(y.borderEnabled!==t.image_border_enabled&&(i.clearDropShadow(),i.createTransition(t.image_border_enabled?"history_image_border_on":"history_image_border_off"),i.selectedItems.forEach(function(n){n.borderBasicShapeVO&&(n.borderEnabled=t.image_border_enabled,-1===n.borderBasicShapeVO.stroke&&n.borderBasicShapeVO.setValues({stroke:e.defaultLayerColors.border,strokeAlpha:1}))}),i.registerTransition(),i.updateBorderTexture(!0),t.image_border_enabled&&y.borderColorEmpty)){var x=(y=BFN.TransformItemGroup.getGroupItemData()).borderColor&&"mixed"!=y.borderColor?y.borderColor:-1,_=-1,I=1;-1!==x&&"mixed"!==y.borderAlpha&&(_=x,I=y.borderAlpha),UITools.setToolValue("transform","image_border_color",_),UITools.setToolValue("transform","image_border_color_intensity",I),UITools.updateToolControl("transform_image_border_color")}}else i.borderEnabled!==t.image_border_enabled&&(i.clearDropShadow(),i.createTransition(t.image_border_enabled?"history_image_border_on":"history_image_border_off"),i.borderBasicShapeVO&&(i.borderEnabled=t.image_border_enabled,-1===i.borderBasicShapeVO.stroke&&(i.borderBasicShapeVO.setValues({stroke:this.defaultLayerColors.border,strokeAlpha:1}),UITools.setToolValue("transform","image_border_color",i.borderBasicShapeVO.stroke),UITools.setToolValue("transform","image_border_color_intensity",i.borderBasicShapeVO.strokeAlpha),UITools.updateToolControl("transform_image_border_color"))),i.registerTransition(),i.updateBorderTexture(!0));break;case"image_border_color":this.setDefaultLayerColor("border",t.image_border_color),v("history_image_border_color",{stroke:t.image_border_color,strokeAlpha:parseFloat(t.image_border_color_intensity)});break;case"image_border_thickness":v("history_image_border_thickness",{strokeWidth:parseInt(t.image_border_thickness)})}}if(n.includes("drop_shadow")){var T=n.replace("drop_shadow_",""),b=null;switch(T){case"enabled":b="updateDropShadowSource";break;case"color":case"opacity":case"blend_mode":b="updateDropShadowVisuals";break;case"distance":case"angle":b="updateDropShadowOffset";break;case"size":case"density":b="updateDropShadowTexture";break;case"scale":b="updateDropShadowScale"}b&&function(a,o,s){var l="updateDropShadowTexture"===s;if(r){var u="updateDropShadowSource"!==s;if("enabled"!==a||t.updating||i.dropShadowVO.enabled===o)e.dropShadowAttributeUpdating!=t.updating&&(e.dropShadowAttributeUpdating=t.updating,e.dropShadowAttributeUpdating?(u||i.clearDropShadow(),i.createTransition("history_layer_".concat(n)),i.selectedItems.forEach(function(e){e.dropShadowRequiresRefresh=l})):(i.setDropShadowValues(a,o),i.registerTransition(),i.selectedItems.forEach(function(e){delete e.dropShadowRequiresRefresh})));else{var c=i.dropShadowEmpty;i.createTransition(o?"history_layer_drop_shadow_on":"history_layer_drop_shadow_off"),i.setDropShadowValues("enabled",o),i.registerTransition(),i.dropShadowVO.enabled&&c&&e.updateGroupDropShadowControls(!1)}e.defaultDropShadowVO[a]=o,i.setDropShadowValues(a,o),u&&i.selectedItems.forEach(function(e){e[s]()})}else{if("enabled"!==a||t.updating||i.dropShadowVO.enabled===o)e.dropShadowAttributeUpdating!=t.updating&&(e.dropShadowAttributeUpdating=t.updating,e.dropShadowAttributeUpdating?(e.startValue=i.dropShadowVO[a],i.createTransition("history_layer_".concat(n)),i.dropShadowRequiresRefresh=l):(i.dropShadowVO[a]!==e.startValue&&i.registerTransition(!0),delete i.dropShadowRequiresRefresh));else{if(i.createTransition(o?"history_layer_drop_shadow_on":"history_layer_drop_shadow_off"),i.dropShadowVO.enabled=o,-1===i.dropShadowVO.color){var h=e.defaultDropShadowVO.getValues();for(var d in delete h.enabled,i.dropShadowVO.setValues(h),h)UITools.setControlValue("transform_drop_shadow_".concat(d),h[d]),UITools.updateToolControl("transform_drop_shadow_".concat(d))}i.registerTransition()}e.defaultDropShadowVO[a]=o,i.dropShadowVO[a]=o,i[s]()}}(T,t[n],b)}switch(n){case"graphic_color_group_color":var S=parseInt(t.graphic_color_group_color_group_id);if(this.shapeAttributeUpdating!=t.updating)if(this.shapeAttributeUpdating=t.updating,this.shapeAttributeUpdating)this.startValue=this._selectedTransformItem.getShapeColorGroupColor(S),i.createTransition("history_shape_fill_color");else{var C=this._selectedTransformItem.getShapeColorGroupColor(S);-1===t.graphic_color_group_color&&(UITools.setToolValue("transform","graphic_color_group_color",C.color),UITools.setToolValue("transform","graphic_color_group_color_intensity",C.opacity),UITools.updateToolControl("transform_graphic_color_group_color"),BFN.ColorPickerPanel.colorButton&&(BFN.ColorPickerPanel.colorButton.hashColor=C.color,BFN.ColorPickerPanel.colorButton.intensity=C.opacity,BFN.ColorPickerPanel.handleColorButtonUpdated())),C.color===this.startValue.color&&C.opacity===this.startValue.opacity||i.registerTransition()}this._selectedTransformItem.setShapeColorGroupColor(S,t.graphic_color_group_color,t.graphic_color_group_color_intensity,!t.updating,BFN.ColorPickerPanel._emptyButtonClicked)}switch(n){case"delete":this._selectedTransformItem.removeItem();break;case"duplicate":"group"===this._selectedTransformItem.type?this._selectedTransformItem.duplicateGroup():this._selectedTransformItem.duplicateItem();break;case"opacity":if(r)return void(t.updating||(this._selectedTransformItem.createTransition("history_opacity"),this._selectedTransformItem.setOpacity(t.opacity),this._selectedTransformItem.registerTransition(!0)));this.opacityUpdating!=t.updating&&(this.opacityUpdating=t.updating,this.opacityUpdating?(this.startValue=this._selectedTransformItem.alpha,this._selectedTransformItem.createTransition("history_opacity")):this.startValue!=this._selectedTransformItem.alpha&&this._selectedTransformItem.registerTransition(!0)),this._selectedTransformItem.alpha=t.opacity/100;break;case"overlay_color_enabled":if(!t.updating)if(r){var B=BFN.TransformItemGroup.getGroupItemData();if(B.overlayColorEnabled!==t.overlay_color_enabled&&(i.createTransition(t.overlay_color_enabled?"history_color_overlay_on":"history_color_overlay_off"),i.selectedItems.forEach(function(n){n.overlayColorEnabled=t.overlay_color_enabled,-1===n.overlayColor&&(n.overlayColor=e.defaultLayerColors.overlay,n.overlayColorIntensity=1)}),i.registerTransition(),t.overlay_color_enabled&&B.overlayColorEmpty)){var F=(B=BFN.TransformItemGroup.getGroupItemData()).overlayColor&&"mixed"!=B.overlayColor?B.overlayColor:-1,E=-1,P=1;-1!=F&&"mixed"!=B.overlayColorIntensity&&(E=F,P=B.overlayColorIntensity),UITools.setToolValue("transform","overlay_color",E),UITools.setToolValue("transform","overlay_color_intensity",P),UITools.updateToolControl("transform_overlay_color")}}else i.overlayColorEnabled!==t.overlay_color_enabled&&(i.createTransition(t.overlay_color_enabled?"history_color_overlay_on":"history_color_overlay_off"),i.overlayColorEnabled=t.overlay_color_enabled,-1===i.overlayColor&&(i.overlayColor=this.defaultLayerColors.overlay,i.overlayColorIntensity=1,UITools.setToolValue("transform","overlay_color",i.overlayColor),UITools.setToolValue("transform","overlay_color_intensity",i.overlayColorIntensity),UITools.updateToolControl("transform_overlay_color")),i.registerTransition());break;case"overlay_color":if(this.setDefaultLayerColor("overlay",t.overlay_color),r){var k=!0;if(this.overlayColorUpdating!=t.updating)if(this.overlayColorUpdating=t.updating,this.overlayColorUpdating){this._selectedTransformItem.createTransition("history_color_overlay");var N=BFN.TransformItemGroup.getGroupItemData(),M="mixed"===N.overlayColor||-1===N.overlayColor||"mixed"===N.overlayColorIntensity,D=-1==t.overlay_color;M&&!D?(UITools.setToolValue("transform","overlay_color_intensity",1),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):!M&&D&&(UITools.setToolValue("transform","overlay_color_intensity",0),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}else k=!1,this._selectedTransformItem.setOverlayColor(t.overlay_color,t.overlay_color_intensity),this._selectedTransformItem.registerTransition();k&&this._selectedTransformItem.setOverlayColor(t.overlay_color,t.overlay_color_intensity)}else this.overlayColorUpdating!=t.updating&&(this.overlayColorUpdating=t.updating,this.overlayColorUpdating?(this.startValue={color:this._selectedTransformItem.overlayColor,intensity:this._selectedTransformItem.overlayColorIntensity},this._selectedTransformItem.createTransition("history_color_overlay"),-1==this.startValue.color&&-1!=t.overlay_color?(UITools.setToolValue("transform","overlay_color_intensity",1),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=this.startValue.color&&-1==t.overlay_color&&(UITools.setToolValue("transform","overlay_color_intensity",0),UITools.updateToolControl("transform_overlay_color"),BFN.ColorPickerPanel.refreshIntensitySlider())):this.startValue.color==this._selectedTransformItem.overlayColor&&this.startValue.intensity==this._selectedTransformItem.overlayColorIntensity||this._selectedTransformItem.registerTransition()),this._selectedTransformItem.overlayColor=t.overlay_color,this._selectedTransformItem.overlayColorIntensity=t.overlay_color_intensity;break;case"tint_color_enabled":if(!t.updating)if(r){var w=BFN.TransformItemGroup.getGroupItemData();if(w.tintColorEnabled!==t.tint_color_enabled&&(i.createTransition(t.tint_color_enabled?"history_tint_on":"history_tint_off"),i.selectedItems.forEach(function(n){n.tintColorEnabled=t.tint_color_enabled,-1===n.tintColor&&(n.tintColor=e.defaultLayerColors.tint,n.tintColorIntensity=1)}),i.registerTransition(),t.tint_color_enabled&&w.tintColorEmpty)){var L=(w=BFN.TransformItemGroup.getGroupItemData()).tintColor&&"mixed"!=w.tintColor?w.tintColor:-1,O=-1;-1!=L&&(O=L),UITools.setControlValue("transform_tint_color",O),UITools.updateToolControl("transform_tint_color")}}else i.tintColorEnabled!==t.tint_color_enabled&&(i.createTransition(t.tint_color_enabled?"history_tint_on":"history_tint_off"),i.tintColorEnabled=t.tint_color_enabled,-1===i.tintColor&&(i.tintColor=this.defaultLayerColors.tint,UITools.setControlValue("transform_tint_color",i.tintColor),UITools.updateToolControl("transform_tint_color")),i.registerTransition());break;case"tint_color":if(this.setDefaultLayerColor("tint",t.tint_color),r){var R=!0;this.tintColorUpdating!=t.updating&&(this.tintColorUpdating=t.updating,this.tintColorUpdating?this._selectedTransformItem.createTransition("tint"):(R=!1,this._selectedTransformItem.setTintColor(t.tint_color),this._selectedTransformItem.registerTransition())),R&&this._selectedTransformItem.setTintColor(t.tint_color)}else this.tintColorUpdating!=t.updating&&(this.tintColorUpdating=t.updating,this.tintColorUpdating?(this.startValue=this._selectedTransformItem.tintColor,this._selectedTransformItem.createTransition("tint")):this.startValue!=this._selectedTransformItem.tintColor&&this._selectedTransformItem.registerTransition()),this._selectedTransformItem.tintColor=t.tint_color;break;case"blend_mode":var A=parseInt(t.blend_mode),V=Object.values(BFN.CONST.BLEND_MODES);isNaN(A)||-1==V.indexOf(A)||(this._selectedTransformItem.createTransition("history_blend_mode"),this._selectedTransformItem.setBlendMode(A),this._selectedTransformItem.registerTransition(!0));break;case"flip_horizontal":this._selectedTransformItem.clearDropShadow(),this._selectedTransformItem.createTransition("history_flip_horizontal"),this._selectedTransformItem.flipHorizontal(),this._selectedTransformItem.registerTransition();break;case"flip_vertical":this._selectedTransformItem.clearDropShadow(),this._selectedTransformItem.createTransition("history_flip_vertical"),this._selectedTransformItem.flipVertical(),this._selectedTransformItem.registerTransition();break;case"create_group":r&&BFN.GroupManager.openCreateGroupModal();break;case"move_backwards":r?this._selectedTransformItem.moveBackwards():(this._selectedTransformItem.createTransition("history_layer_order"),this._selectedTransformItem.moveBackwards()&&this._selectedTransformItem.registerTransition());break;case"move_forwards":r?this._selectedTransformItem.moveForwards():(this._selectedTransformItem.createTransition("history_layer_order"),this._selectedTransformItem.moveForwards()&&this._selectedTransformItem.registerTransition());break;case"align_left":if(r&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.x),this._selectedTransformItem.createTransition(r?"history_selection_align_left":"history_align_left"),this._selectedTransformItem.align="left",(this.startValue!=Math.floor(this._selectedTransformItem.x)||r)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_center":if(r&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.x),this._selectedTransformItem.createTransition(r?"history_selection_align_center":"history_align_center"),this._selectedTransformItem.align="center",(this.startValue!=Math.floor(this._selectedTransformItem.x)||r)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_right":if(r&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.x),this._selectedTransformItem.createTransition(r?"history_selection_align_right":"history_align_right"),this._selectedTransformItem.align="right",(this.startValue!=Math.floor(this._selectedTransformItem.x)||r)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_top":if(r&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.y),this._selectedTransformItem.createTransition(r?"history_selection_align_top":"history_align_top"),this._selectedTransformItem.align="top",(this.startValue!=Math.floor(this._selectedTransformItem.y)||r)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_middle":if(r&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.y),this._selectedTransformItem.createTransition(r?"history_selection_align_middle":"history_align_middle"),this._selectedTransformItem.align="middle",(this.startValue!=Math.floor(this._selectedTransformItem.y)||r)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"align_bottom":if(r&&this._selectedTransformItem.accurateBoundsUpdating)return;this.startValue=Math.floor(this._selectedTransformItem.y),this._selectedTransformItem.createTransition(r?"history_selection_align_bottom":"history_align_bottom"),this._selectedTransformItem.align="bottom",(this.startValue!=Math.floor(this._selectedTransformItem.y)||r)&&this._selectedTransformItem.registerTransition(void 0,!0);break;case"fit_to_canvas":this._selectedTransformItem.transformTool.fitItemToCanvas(!1),this.contextMenu.hide();break;case"fill_canvas":this._selectedTransformItem.transformTool.fitItemToCanvas(!0),this.contextMenu.hide()}BFN.MainUI.requestRender()}else this._selectedTransformItemText&&("delete"!=n&&"duplicate"!=n&&(this.tempTransformItem=this._selectedTransformItemText,this.tempTransformItem.addEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemAfterEditBind)),this._selectedTransformItemText.exitTextEditing());if("menu_popover_button"===n&&t.menu_popover_button){var U=document.getElementById("transform_menu_popover");if(U.hasClass("active"))U.hide();else{var G=document.getElementById("transform_menu_popover_button").getBoundingClientRect(),H=G.top,z=G.height;U.setStyles({top:"".concat(H+z/2-BFN.CSS.topMenuBarHeight-56,"px")}),U.show()}}},$n.prototype.handleLayer=function(){var e=UITools.getToolVO("layer"),t=e.updating_id;if(this._selectedTransformItem){var n=this._selectedTransformItem;if(["texture","frame_texture"].includes(n.type)&&!n.isGoodie)switch(t){case"save_as_image":switch(n.type){case"texture":BFN.UploadSaveShareManager.altSaveTexture=this.selectedTransformItem.itemContent.texture;var i="";try{var r=n.projectItemVO.imageID;i=BFN.ImageLibraryManager.selectedMenuImageVOs[BFN.ImageLibraryManager.getIndex(r)].name||""}catch(e){}BFN.UploadSaveShareManager.setFileName(void 0,"layer",i),BFN.UploadSaveShareManager.handleSaveOrShareImage("save","computer");break;case"frame_texture":var a=[0,12,8,4][n.flippedHorizontal+2*n.flippedVertical],o=n.itemContent,s=new PIXI.Texture(o.baseTexture),l=s.renderClone();s.destroyGC(!1),l.frame=new PIXI.Rectangle(Math.round(o.texture.frame.x),Math.round(o.texture.frame.y),Math.round(o.texture.frame.width),Math.round(o.texture.frame.height));var u=Math.min(l.frame.width/o.frameWidth,l.frame.height/o.height),c=Math.round(o.frameWidth*u),h=Math.round(o.frameHeight*u);l.orig=l.trim=new PIXI.Rectangle(0,0,c,h),l.rotate=a;var d=new PIXI.Container,m=new PIXI.Sprite(l);m.pluginName="blend_picture",m.fillColor=n.itemContent.fillColor||0,m.intensity=n.itemContent.intensity||0,m.tint=n.itemContent.tint,d.addChild(m);var p=new PIXI.Sprite;if(d.addChild(p),n.isShape&&n.hasOwnProperty("itemContentMask")){var g=n.itemContentMask;n.basicShapeVO?n.basicShapeVO.updateTexture(g.texture,c,h,!0):BFN.SVGManager.updateTexture(g.texture,null,null,c,h);var f=g.texture.renderClone();f.rotate=a,p.texture=f,m.mask=p,n.updateShapeTexture()}var v=PIXI.RenderTexture.create(c,h);BFN.Stage.render(d,v);try{m.mask=null,m.texture.destroyGC(!0),m.destroy(!1)}catch(e){}d.removeChild(m);try{p.texture.destroyGC(!0),p.destroy(!1)}catch(e){}d.removeChild(p),BFN.UploadSaveShareManager.destroyAltSaveTextureOnDispose=!0,BFN.UploadSaveShareManager.altSaveTexture=v,BFN.UploadSaveShareManager.setFileName(void 0,"layer","befunky_layer"),BFN.UploadSaveShareManager.handleSaveOrShareImage("save","computer")}break;case"lock_aspect_ratio":break;case"image_cutout":BFN.EditLayerManager.editTransformItemAlternateMenu("cutout",function(){BFN.ImageCutout.readyCallback=function(){requestAnimationFrame(function(){UIToggler.toggleAlternateMenu(!0,"layer_isolator_tool_menu_header","layer_isolator_tool_menu")})}},function(){(BFN.ImageCutout.readyCallback=null,BFN.ImageCutout.exportedItemObject)&&(BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel).addedItem=BFN.ImageCutout.exportedItemObject,delete BFN.ImageCutout.exportedItemObject)});break;case"image_edit_layer":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade(BFN.AppModel.sectionValue("EDITOR","COLLAGE","DESIGNER"),"EDIT_LAYER_UPGRADE","edit_layer"),void BFN.UserActionManager.addUpgradeAction(["Edit Image Layer"]);BFN.EditLayerManager.editTransformItem(),BeFunky.showAnnouncementOnce("edit_layer");break;case"image_open_in_editor":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade(BFN.AppModel.sectionValue("EDITOR","COLLAGE","DESIGNER"),"EDIT_LAYER_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Open Layer Image in Editor"]);n.deselectItem(),BFN.PhotoEditorModel.currentTexture&&BFN.IndexedDB.disabledReason?BeFunky.confirm("confirm_edit_image",{onConfirm:function(){BFN.ImageEditManager.openImageInEditor(n)},onCancel:function(){n.selectItem()},focusConfirmButton:!1}):BFN.ImageEditManager.openImageInEditor(n);break;case"mask_image_crop":"frame_texture"===n.type&&n.transformTool.transformToolFrame.setup(n);break;case"mask_image_replace":(n.type="frame_texture")&&BFN.ImageLibraryManager.uploadImages(function(e){!e.isComplete&&e.menuImageVO&&(BFN.TransformModel.targetTransformItem=n,BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO))},{allowMultiple:!1});break;case"mask_image_open_in_editor":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade(BFN.AppModel.sectionValue("EDITOR","COLLAGE","DESIGNER"),"EDIT_LAYER_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Open Layer Image in Editor"]);n.deselectItem(),BFN.PhotoEditorModel.currentTexture&&BFN.IndexedDB.disabledReason?BeFunky.confirm("confirm_edit_image",{onConfirm:function(){BFN.ImageEditManager.openMaskImageInEditor(n)},onCancel:function(){n.selectItem()},focusConfirmButton:!1}):BFN.ImageEditManager.openMaskImageInEditor(n);break;case"mask_image_crop_lock_aspect_ratio":break;case"mask_image_crop_size":"frame_texture"===n.type&&n.transformTool.transformToolFrame.transformItem===n&&BFN.TransformModel.transformToolFrame.setImageScale(e.mask_image_crop_size/100,e.updating);break;case"mask_image_crop_fit_to_frame":"frame_texture"===n.type&&n.transformTool.transformToolFrame.transformItem===n&&n.resetFrameTexture();break;case"mask_image_crop_fit_to_image":"frame_texture"===n.type&&n.transformTool.transformToolFrame.transformItem===n&&n.fitFrameToImage()}}else if("isolator_display_canvas"===t){var y=e[t];UITools.setToolValue("layer","isolator_display_canvas",y),UITools.updateToolControl("layer_isolator_display_canvas"),BFN.TransformItemIsolator.toggleBackground(y)}else"isolator_edit_complete"===t&&this.isolatorEditComplete()},$n.prototype.isolatorEditComplete=function(){if(BFN.TransformItemIsolator.active&&!BFN.TransformItemIsolator.animating)if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){BeFunky.confirm("apply_changes_leave_editor",{onConfirm:function(){BFN.applyCancelMenu.applyButton.click(),setTimeout(function(){BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&(UIToggler.toggleLoadScreen(!0,{isCancellable:!1}),BeFunky.waitUntil({condition:function(){return!BFN.MainUI.viewportUpdating},onSuccess:function(){UIToggler.toggleLoadScreen(!1),BFN.TransformItemIsolator.releaseTransformItem()},onTimeout:function(){UIToggler.toggleLoadScreen(!1),BFN.TransformItemIsolator.releaseTransformItem()},interval:10,maxAttempts:500}))},0)},confirmText:"yes",cancelText:"no_keep_editing"})}else BFN.TransformItemIsolator.releaseTransformItem()},$n.prototype.setDefaultLayerColor=function(e,t){this.defaultLayerColors[e]&&this.defaultLayerColors[e]!==t&&-1!==t&&"string"==typeof t&&6===t.length&&(this.defaultLayerColors[e]=t)},$n.prototype.updateGroupMenu=function(){var e=this._selectedTransformItem&&"group"==this._selectedTransformItem.type?this._selectedTransformItem:null;UITools.disableControlItem("text_edit_spacing_menu_popover_button",!!e,"button");var t=document.getElementById("text_edit_size");if(!e&&t.mixed&&(t.mixed=!1),e){var n=e.getGroupItemData(),i=UITools.getToolValue("transform","updating_id");UITools.setToolValue("transform","opacity","mixed"==n.opacity?100:n.opacity),UITools.updateToolControl("transform_opacity"),"mixed"==n.blendMode?document.getElementById("transform_blend_mode").setState({isMixed:!0}):(UITools.setToolValue("transform","blend_mode",n.blendMode),UITools.updateToolControl("transform_blend_mode"));var r=document.getElementById("transform_overlay_color_enabled");r.checked=n.overlayColorEnabled?"mixed"===n.overlayColorEnabled?"mixed":"on":"off",r.openWhenChecked=!!n.overlayColorEmpty;var a=n.overlayColor&&"mixed"!=n.overlayColor?n.overlayColor:-1,o=-1,s="mixed"==n.overlayColor?1:0;-1!=a&&"mixed"!=n.overlayColorIntensity&&(o=a,s=n.overlayColorIntensity),UITools.setToolValue("transform","overlay_color",o),UITools.setToolValue("transform","overlay_color_intensity",s),UITools.updateToolControl("transform_overlay_color"),document.getElementById("transform_overlay_color").isMixed="mixed"===n.overlayColor;var l=document.getElementById("transform_tint_color_enabled");l.checked=n.tintColorEnabled?"mixed"===n.tintColorEnabled?"mixed":"on":"off",l.openWhenChecked=!!n.tintColorEmpty;var u=n.tintColor&&"mixed"!=n.tintColor?n.tintColor:-1,c=-1;-1!=u&&(c=u),UITools.setToolValue("transform","tint_color",c),UITools.updateToolControl("transform_tint_color"),document.getElementById("transform_tint_color").isMixed="mixed"===n.tintColor;var h=document.getElementById("transform_image_border_enabled");h.checked=n.borderEnabled?"mixed"===n.borderEnabled?"mixed":"on":"off",h.openWhenChecked=!!n.borderColorEmpty;var d=n.borderColor&&"mixed"!=n.borderColor?n.borderColor:-1,m=-1,p=1;-1!==d&&"mixed"!==n.borderAlpha&&(m=d,p=n.borderAlpha),UITools.setToolValue("transform","image_border_color",m),UITools.setToolValue("transform","image_border_color_intensity",p),UITools.updateToolControl("transform_image_border_color"),document.getElementById("transform_image_border_color").isMixed="mixed"===n.borderColor,UITools.toggleElement("transform_image_border_enabled",!n.borderHide);var g=n.hasOwnProperty("borderThickness")&&"mixed"!==n.borderThickness?n.borderThickness:10;UITools.setToolValue("transform","image_border_thickness",g),UITools.updateToolControl("transform_image_border_thickness"),document.getElementById("transform_image_border_thickness").isMixed=!!n.borderThicknessMixed,this.updateGroupDropShadowControls();var f=document.getElementById("transform_shape_fill_enabled");f.checked=n.shapeFillExists?"mixed"===n.shapeFillExists?"mixed":"on":"off",f.openWhenChecked=!!n.shapeFillBakEmpty;var v=n.shapeFill&&"mixed"!=n.shapeFill?n.shapeFill:-1,y=-1,x=1;-1!=v&&"mixed"!=n.shapeFillAlpha&&(y=v,x=n.shapeFillAlpha),UITools.setToolValue("transform","shape_fill_color",y),UITools.setToolValue("transform","shape_fill_color_intensity",x),UITools.updateToolControl("transform_shape_fill_color"),document.getElementById("transform_shape_fill_color").isMixed="mixed"===n.shapeFill,UITools.toggleElement("transform_shape_fill_enabled",!n.hasOwnProperty("shapeHideFill")||!n.shapeHideFill);var _=document.getElementById("transform_shape_stroke_enabled");_.checked=n.shapeStrokeExists?"mixed"===n.shapeStrokeExists?"mixed":"on":"off",_.openWhenChecked=!!n.shapeStrokeBakEmpty;var I=n.shapeStroke&&"mixed"!=n.shapeStroke?n.shapeStroke:-1,T=-1,b=1;-1!=I&&"mixed"!=n.shapeStrokeAlpha&&(T=I,b=n.shapeStrokeAlpha),UITools.setToolValue("transform","shape_stroke_color",T),UITools.setToolValue("transform","shape_stroke_color_intensity",b),UITools.updateToolControl("transform_shape_stroke_color"),document.getElementById("transform_shape_stroke_color").isMixed="mixed"===n.shapeStroke,UITools.toggleElement("transform_shape_stroke_enabled",!n.hasOwnProperty("shapeHideStroke")||!n.shapeHideStroke);var S=n.hasOwnProperty("shapeStrokeWidth")&&"mixed"!=n.shapeStrokeWidth?n.shapeStrokeWidth:10;UITools.setToolValue("transform","shape_stroke_width",S),UITools.updateToolControl("transform_shape_stroke_width"),document.getElementById("transform_shape_stroke_width").isMixed=!!n.shapeStrokeWidthMixed,this.updateBasicShapeAttributeControls(),UITools.getToolVO("transform").updating_id=i,e.groupType}},$n.prototype.updateGroupDropShadowControls=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.selectedTransformItem===BFN.TransformItemGroup){BFN.TransformItemGroup.updateDropShadowValues();var t=BFN.TransformItemGroup.dropShadowVO.getValues(),n=BFN.TransformItemGroup.dropShadowMixedValues,i=BFN.TransformItemGroup.dropShadowEmpty;for(var r in t){UITools.setToolValue("transform","drop_shadow_".concat(r),t[r]);var a="transform_drop_shadow_".concat(r);UITools.updateToolControl(a);var o=document.getElementById(a);if(o&&("enabled"===r&&e&&(o.openWhenChecked=i),n.includes(r)))switch(r){case"enabled":o.checked="mixed";break;case"color":UITools.setToolValue("transform","drop_shadow_color",-1),UITools.updateToolControl(a),o.isMixed=!0;break;case"blend_mode":o.setState({isMixed:!0});break;default:o.isMixed=!0}}}},$n.prototype.updateBasicShapeAttributeControls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e||(e={type:null}),UITools.toggleControlItem("transform_shape_line_style","line"===e.type),UITools.toggleControlItem("transform_shape_line_segment_width","line"===e.type&&"dashed"===e.attributes.lineStyle),UITools.toggleControlItem("transform_shape_line_gap_size","line"===e.type&&"solid"!==e.attributes.lineStyle),UITools.toggleControlItem("transform_shape_rectangle_corner_rounding","rectangle"===e.type),UITools.toggleControlItem("transform_shape_polygon_sides","polygon"===e.type),UITools.toggleControlItem("transform_shape_polygon_shift_orientation","polygon"===e.type),UITools.toggleControlItem("transform_shape_star_points","star"===e.type),UITools.toggleControlItem("transform_shape_star_inset_weight","star"===e.type),UITools.toggleControlItem("transform_shape_star_shift_orientation","star"===e.type),UITools.toggleControlItem("transform_shape_arrow_style","arrow"===e.type),UITools.toggleControlItem("transform_shape_arrow_weight","arrow"===e.type),UITools.toggleControlItem("transform_shape_arrow_double_sided","arrow"===e.type),e.type){case"line":UITools.setToolValue("transform","shape_line_style",e.attributes.lineStyle),UITools.setToolValue("transform","shape_line_segment_width",Math.round((e.attributes.lineSegmentWidth-1)/9*100)),UITools.setToolValue("transform","shape_line_gap_size",Math.round(50*e.attributes.lineGapSize));break;case"rectangle":UITools.setToolValue("transform","shape_rectangle_corner_rounding",Math.round(100*e.attributes.rectangleCornerRounding));break;case"polygon":UITools.setToolValue("transform","shape_polygon_sides",e.attributes.polygonSides),UITools.setToolValue("transform","shape_polygon_shift_orientation",e.attributes.polygonShiftOrientation);break;case"star":UITools.setToolValue("transform","shape_star_points",e.attributes.starPoints),UITools.setToolValue("transform","shape_star_inset_weight",Math.round(100*e.attributes.starInsetWeight)),UITools.setToolValue("transform","shape_star_shift_orientation",e.attributes.starShiftOrientation);break;case"arrow":UITools.setToolValue("transform","shape_arrow_style",e.attributes.arrowStyle),UITools.setToolValue("transform","shape_arrow_weight",Math.round(100*e.attributes.arrowWeight)),UITools.setToolValue("transform","shape_arrow_double_sided",e.attributes.arrowDoubleSided)}},$n.prototype.removeSelection=function(){if(this.selectedTransformItem){var e=this.selectedTransformItem;"group"==e.type?e.transformLayer.removeItem(e):e.removeItem()}},$n.prototype.handleSelectItemAfterEdit=function(e){this.tempTransformItem.removeEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemAfterEditBind),this.tempTransformItem=null,this.handleTransform()},Object.defineProperty($n.prototype,"selectedTransformItem",{set:function(e){if(this._selectedTransformItem=e,this.dispatchEvent(BFN.TransformModelEvents.TRANSFORM_ITEM_UPDATED),this._selectedGroupType=null,UITools.toggleControlItem("transform_blend_mode",!0),UITools.toggleElement("transform_image_border_enabled",!1),BFN.TransformItemBoundingBoxes.clear(),this._selectedTransformItem){var t=this._selectedTransformItem;if("group"===this._selectedTransformItem.type)switch(this._selectedGroupType=this._selectedTransformItem.groupType,this._selectedGroupType){case"image":UIToggler.toggleAlternateMenu(!0,"image_menu_header","graphic_menu","transform_menu","drop_shadow_menu");break;case"shape":UIToggler.toggleAlternateMenu(!0,"shape_menu_header","shape_menu","transform_menu","drop_shadow_menu"),document.getElementById("shape_menu_header").querySelector("string").setLang("shape_properties_multiple");break;case"graphic":UIToggler.toggleAlternateMenu(!0,"graphic_menu_header","graphic_menu","transform_menu","drop_shadow_menu");break;case"graphic_image_mix":UIToggler.toggleAlternateMenu(!0,"selection_menu_header","graphic_menu","transform_menu","drop_shadow_menu");break;case"text":UIToggler.toggleAlternateMenu(!0,"text_menu_header","text_menu","transform_menu","text_color_menu","drop_shadow_menu");break;case"mixed":default:return UITools.toggleControlItem("transform_blend_mode",!1),void UIToggler.toggleAlternateMenu(!0,"selection_menu_header","transform_menu","drop_shadow_menu")}else{var n=UITools.getToolValue("transform","updating_id");BFN.TransformItemBoundingBoxes.selectItems(t.getAvailableGroupItems()),this.updateGroupMenu();var i=this._selectedTransformItem.basicShapeVO;i&&(document.getElementById("transform_shape_fill_enabled").openWhenChecked=-1===i.fillBak,UITools.setToolValue("transform","shape_fill_enabled",-1!==i.fill),-1===i.fill?(UITools.setToolValue("transform","shape_fill_color",-1),UITools.setToolValue("transform","shape_fill_color_intensity",1)):(UITools.setToolValue("transform","shape_fill_color",i.fill),UITools.setToolValue("transform","shape_fill_color_intensity",i.fillAlpha)),UITools.toggleElement("transform_shape_fill_enabled","line"!==i.type),document.getElementById("transform_shape_stroke_enabled").openWhenChecked=-1===i.strokeBak,UITools.setToolValue("transform","shape_stroke_enabled",-1!==i.stroke),-1===i.stroke?(UITools.setToolValue("transform","shape_stroke_color",-1),UITools.setToolValue("transform","shape_stroke_color_intensity",1)):(UITools.setToolValue("transform","shape_stroke_color",i.stroke),UITools.setToolValue("transform","shape_stroke_color_intensity",i.strokeAlpha)),UITools.toggleElement("transform_shape_stroke_enabled",!["star","arrow"].includes(i.type)),UITools.setToolValue("transform","shape_stroke_width",i.strokeWidth),this.updateBasicShapeAttributeControls(i));var r=this._selectedTransformItem.borderBasicShapeVO;r&&(document.getElementById("transform_image_border_enabled").openWhenChecked=-1===r.stroke,UITools.setToolValue("transform","image_border_enabled",this._selectedTransformItem.borderEnabled),-1===r.stroke?(UITools.setToolValue("transform","image_border_color",-1),UITools.setToolValue("transform","image_border_color_intensity",1)):(UITools.setToolValue("transform","image_border_color",r.stroke),UITools.setToolValue("transform","image_border_color_intensity",r.strokeAlpha)),UITools.setToolValue("transform","image_border_thickness",r.strokeWidth),UITools.toggleElement("transform_image_border_enabled",!0));var a=this._selectedTransformItem.dropShadowVO;if(a){var o=a.getValues();for(var s in o)"color"===s&&(document.getElementById("transform_drop_shadow_enabled").openWhenChecked=-1===o.color),UITools.setToolValue("transform","drop_shadow_".concat(s),o[s])}UITools.setToolValue("transform","opacity",100*this._selectedTransformItem.alpha),document.getElementById("transform_overlay_color_enabled").openWhenChecked=-1===this._selectedTransformItem.overlayColor,UITools.setToolValue("transform","overlay_color_enabled",this._selectedTransformItem.overlayColorEnabled),UITools.setToolValue("transform","overlay_color",this._selectedTransformItem.overlayColor),UITools.setToolValue("transform","overlay_color_intensity",this._selectedTransformItem.overlayColorIntensity),document.getElementById("transform_tint_color_enabled").openWhenChecked=-1===this._selectedTransformItem.tintColor,UITools.setToolValue("transform","tint_color_enabled",this._selectedTransformItem.tintColorEnabled),UITools.setToolValue("transform","tint_color",this._selectedTransformItem.tintColor),UITools.setToolValue("transform","blend_mode",this._selectedTransformItem.itemBlendMode),UITools.updateToolControls("transform"),UITools.getToolVO("transform").updating_id=n;document.getElementById("transform_menu_popover");if("frame_texture"===this._selectedTransformItem.type&&this.transformToolFrame&&this.transformToolFrame.active&&this.transformToolFrame.transformItem===this._selectedTransformItem)UIToggler.toggleAlternateMenu(!0,"mask_image_crop_header","mask_image_crop_menu");else if("text"===this._selectedTransformItem.type)BFN.FabricManager.updateTextMenu(this._selectedTransformItem.getTextStyleData()),UIToggler.toggleAlternateMenu(!0,"text_menu_header","text_menu","transform_menu","text_color_menu","drop_shadow_menu");else if(this._selectedTransformItem.isGoodie)if(i)UIToggler.toggleAlternateMenu(!0,"shape_menu_header","shape_menu","transform_menu","drop_shadow_menu"),document.getElementById("shape_menu_header").querySelector("string").setLang("shape_properties",{shape:BeFunky.LanguageManager.getString(i.type)});else{var l=t.shapeColorMap&&t.shapeColorGroupsNum>(t.shapeObjectFills?0:1);if(l){var u=[];for(var c in t.shapeColorMap){var h=t.shapeColorMap[c];h.objects&&u.push({id:c,color:h.colorHash,intensity:h.colorOpacity})}document.getElementById("transform_graphic_color_group_color").colorGroup.setColorGroupData(u)}l?UIToggler.toggleAlternateMenu(!0,"graphic_menu_header","graphic_menu","graphic_svg_color_menu","transform_menu","drop_shadow_menu"):UIToggler.toggleAlternateMenu(!0,"graphic_menu_header","graphic_menu","transform_menu","drop_shadow_menu")}else"frame_texture"===this._selectedTransformItem.type?(UITools.toggleControlItem("transform_blend_mode",!this._selectedTransformItem.hasOwnProperty("itemContentMask")),UITools.toggleElement("layer_mask_image_replace",!0),UIToggler.toggleAlternateMenu(!0,"mask_image_menu_header","layer_image_menu","graphic_menu","transform_menu","drop_shadow_menu")):(UITools.toggleElement("layer_mask_image_replace",!1),UIToggler.toggleAlternateMenu(!0,"image_menu_header","layer_image_menu","graphic_menu","transform_menu","drop_shadow_menu"))}}else UIToggler.toggleAlternateMenu(!1);BFN.TransformLayerManager.updateSelectedItems()},get:function(){return this._selectedTransformItem}}),Object.defineProperty($n.prototype,"selectedTransformItemText",{set:function(e){this._selectedTransformItemText=null,e&&"text"==e.type&&(this._selectedTransformItemText=e,BFN.TransformItemBoundingBoxes.selectItems(this._selectedTransformItemText.getAvailableGroupItems())),this.dispatchEvent(BFN.TransformModelEvents.TRANSFORM_ITEM_TEXT_UPDATED),this._selectedTransformItemText&&UIToggler.toggleAlternateMenu(!0,"text_menu_header","text_menu","transform_menu","text_color_menu")},get:function(){return this._selectedTransformItemText}}),Object.defineProperty($n.prototype,"selectedGroupType",{get:function(){return this._selectedGroupType}}),Object.defineProperty($n.prototype,"awaitingDrop",{set:function(e){this._awaitingDrop=e,this._focusedTransformItem&&this._focusedTransformItem.hideImageDropState()},get:function(){return this._awaitingDrop}}),Object.defineProperty($n.prototype,"focusedTransformItem",{set:function(e){this._focusedTransformItem&&this._focusedTransformItem!==e&&this._focusedTransformItem.hideImageDropState(),this._focusedTransformItem=e,this._focusedTransformItem&&this._focusedTransformItem.showImageDropState()},get:function(){return this._focusedTransformItem}}),Object.defineProperty($n.prototype,"targetTransformItem",{set:function(e){this._targetTransformItem=e},get:function(){return this._targetTransformItem}}),Object.defineProperty($n.prototype,"transformToolFrame",{get:function(){return this._selectedTransformItem&&"frame_texture"===this._selectedTransformItem.type?this._selectedTransformItem.transformTool.transformToolFrame:null}}),BFN.SingletonQueue.add(function(){BFN.TransformModel=new $n}),BFN.TransformStateModelEvents={TRANSITIONS_UPDATED:new Event("TRANSITIONS_UPDATED")},ei.prototype=Object.create(BFN.EventDispatcher.prototype),ei.prototype.init=function(){BeFunky.log("TransformStateModel Init"),this.initDefaultValues()},ei.prototype.initDefaultValues=function(){this.blockAddedTransitions=!1,this.transitionsHash={},this.transitionIndexHash={},this.directionHash={},this.transitions=null,this.transitionIndex=null,this.batchTransitionID=null,this.safeBaseTextures=[],this.safeThumbImages=[],this.currentBatchID=null,this.nextBatchID=null,this.udc=null},ei.prototype.startBulkTransition=function(e){this.batchTransitionID=e},ei.prototype.stopBulkTransition=function(){this.batchTransitionID=null},ei.prototype.addTransition=function(e){if(!this.blockAddedTransitions){if(e.batchID=this.batchTransitionID,e.transformItem&&(e.transformItem.thumbTexture||e.transformItem.thumbImage||("text"==e.transformItem.type?(e.transformItem.thumbTexture=null,e.transformItem.thumbImage=null):(e.transformItem.thumbTexture=this.getThumb(e.transformItem),e.transformItem.thumbImage=null))),BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR)BFN.PhotoEditorHistoryModel.purgeLaterHistory();else if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER){var t=e.transformItem&&e.transformItem.itemContent.texture.baseTexture?e.transformItem.itemContent.texture.baseTexture:null;BFN.CollageMakerHistoryModel.purgeLaterHistory(t)}if(this.purgeLaterTransitions(e),this.transitions=this.getTransitions(),this.transitions.push(e),this.transitionIndex=this.transitions.length-1,this.setTransitionIndex(this.transitionIndex),this.direction="redo",this.tracePosition(),!e.batchID)if(e.alternateHistoryAction){var n=BFN.formatKeyString(e.id," ",["history"]);BFN.SentryManager.reportBreadcrumb(n,e.alternateHistoryAction,"app_history")}else if(e.batchIDPlaceholder){var i=e.id.includes("selection")&&BFN.SentryManager.getDisplayObjectInfo(BFN.TransformItemGroup)||"";BFN.SentryManager.reportBreadcrumb(i,BFN.formatKeyString(e.id,"_",["history"],!1),"app_history")}else e.transformItem&&BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(e.transformItem),BFN.formatKeyString(e.id,"_",["history"],!1),"app_history");if(!e.batchID&&e.transformItem&&(e.id.includes("history_new")||"replace_image"===e.id)){var r=e.transformItem,a=new BFN.UserActionVO;switch(e.id){case"history_new_text":a.eventID="text_added",a.eventObject={textType:"Freeform"};break;case"history_new_graphic":a.eventID="image_layer_added";var o=r.isShape?r.basicShapeVO?"Basic Shape":"Vector":"Rasterized";a.eventObject={imageLayerTypes:[o],imageLayerSources:[r.assetOrigin]};var s={line:"Outline",solid:"Solid",color:"Multicolor"}[r.projectItemVO.graphicStyle];s&&(a.eventObject.imageLayerGraphicsStyle=[s]);break;case"history_new_image":case"replace_image":a.eventID="image_layer_added";var l=r.isShape?r.basicShapeVO?"Basic Shape":"Vector":"Rasterized";a.eventObject={imageLayerTypes:[l],imageLayerSources:[r.assetOrigin]}}a.actionSection=BFN.AppModel.sectionID,a.actionTimestamp=e.timestamp,a.transformItem=r,a.register()}BFN.TextureHistoryManager.addTextureHistory(e.timestamp,null,e.transformItem?[e.transformItem.itemContent.texture]:[]),this.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED)}},ei.prototype.purgeLaterTransitions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(BFN.UserActionManager.purgeInactiveUserActionVOs(),this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitionIndex<this.transitions.length){this.transitions[this.transitionIndex];var t=[],n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer;t.push.apply(t,v(n.children)),t.includes(BFN.TransformItemGroup)&&t.splice(t.indexOf(BFN.TransformItemGroup),1);for(var i="redo"==this.direction?this.transitionIndex+1:this.transitionIndex,r=[],a=0;a<i;a++){var o=this.transitions[a];r.push(o.timestamp),o.transformItem&&!t.includes(o.transformItem)&&t.push(o.transformItem)}e&&e.transformItem&&!t.includes(e.transformItem)&&t.push(e.transformItem);var s=BFN.TextureHistoryManager.getBaseTextures(BFN.AppModel.viewState,r),l=t.map(function(e){return e.previewImage}),u=t.map(function(e){return e.thumbImage});n.usedBaseTextures=BFN.GlobalHistoryModel.getUsedBaseTextures(n.appViewState);for(var c=i<this.transitions.length?this.transitions[i]:null,h=null!==c?c.endState.creationTime:null,d=[],m=i;m<this.transitions.length;m++){var p=this.transitions[m];p.transformItem&&!d.includes(p.transformItem)&&(p.transformItem.destroyPresetItemThumbTextures(h),d.push(p.transformItem))}for(var g=i;g<this.transitions.length;g++){var f=this.transitions[g];f.previewTexture&&f.previewTexture.destroyGC(!0),f.previewTexture=null,f.previewImage&&!l.includes(f.previewImage)&&(f.previewImage.src=""),f.previewImage=null,f.thumbTexture&&f.thumbTexture.destroyGC(!0),f.thumbTexture=null,f.thumbImage&&!u.includes(f.thumbImage)&&!this.safeThumbImages.includes(f.thumbImage)&&(f.thumbImage.src=""),f.thumbImage=null,f.transformItem&&!t.includes(f.transformItem)&&!f.transformItem.destroyed&&this.hasCreateTransition(f.transformItem)&&(f.transformItem.preventBaseTextureDestroy=!1,e&&e.transformItem&&(f.transformItem.preventBaseTextureDestroy=e.transformItem.itemContent.texture.baseTexture==f.transformItem.itemContent.texture.baseTexture),f.transformItem.preventBaseTextureDestroy||(f.transformItem.preventBaseTextureDestroy=f.transformItem.preventBaseTextureDestroy||s.includes(f.transformItem.itemContent.texture.baseTexture)||this.safeBaseTextures.includes(f.transformItem.itemContent.texture.baseTexture)),f.transformItem.destroyItem(),f.transformItem=null)}this.transitions.splice(i),t.splice(0),this.transitionIndex=this.transitions.length-1,this.setTransitionIndex(this.transitionIndex),this.direction="redo",this.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED)}},ei.prototype.purgeEarlierTransitions=function(e,t,n){var i=0;this.transitions=this.getTransitions(e);for(var r=this.transitions.length;--r>-1;){var a=this.transitions[r];if(a.timestamp<=t){if(a.previewTexture&&a.previewTexture.destroyGC(!0),a.previewTexture=null,a.previewImage&&(a.previewImage.src=""),a.previewImage=null,a.thumbTexture&&a.thumbTexture.destroyGC(!0),a.thumbTexture=null,a.thumbImage&&(a.thumbImage.src=""),a.thumbImage=null,a.transformItem&&!a.transformItem.destroyed){var o=a.transformItem.itemContent.texture.baseTexture;if(!n.includes(o)){var s=!o||o._destroyed;a.transformItem.destroyItem(),s!=(!o||o._destroyed)&&i++}a.transformItem=null}this.transitions.splice(r,1),this.transitionIndex--}}return this.setTransitionIndex(this.transitionIndex),this.direction="redo",i},ei.prototype.undo=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),e||(this.currentBatchID=null,this.nextBatchID=null,this.udc=0),this.transitions.length&&("undo"!=this.direction||this.transitionIndex>0)){var t=!!(this.transitions.length&&this.transitionIndex>0)&&null!=this.transitions[this.transitionIndex-1].batchID;this.directionChanged=!1,"undo"!=this.direction?(this.direction="undo",this.directionChanged=!0):this.setTransitionIndex(--this.transitionIndex);var n=this.transitions[this.transitionIndex];e||!n.batchID&&!n.batchIDPlaceholder||(this.currentBatchID=n.batchIDPlaceholder?n.batchIDPlaceholder:n.batchID),this.transitionIndex>0&&null!=this.transitions[this.transitionIndex-1].batchID&&(this.nextBatchID=this.transitions[this.transitionIndex-1].batchID),BeFunky.log("UNDO",n.batchID,this.currentBatchID),this.repeatAction=this.directionChanged&&n.startState.parent!=n.endState.parent&&!t,n.transformItem&&n.transformItem.setTransition(n),e&&!n.batchID?(this.direction="redo",n.transformItem?n.transformItem.applyTransformItemState(n.endState):n.alternateHistoryAction&&this.performAlternateHistoryAction(n.alternateHistoryAction,n.endState)):n.transformItem?n.transformItem.applyTransformItemState(n.startState):n.alternateHistoryAction&&this.performAlternateHistoryAction(n.alternateHistoryAction,n.startState),this.tracePosition(),(this.repeatAction||this.currentBatchID&&this.nextBatchID&&(n.batchID||n.batchIDPlaceholder)&&this.currentBatchID==this.nextBatchID&&(this.currentBatchID==n.batchID||this.currentBatchID==n.batchIDPlaceholder))&&this.undo(!0)}else++this.udc>10&&BeFunky.log("DIE")},ei.prototype.redo=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),e||(this.currentBatchID=null,this.nextBatchID=null),this.transitions.length&&("redo"!=this.direction||this.transitionIndex<this.transitions.length-1)){"redo"!=this.direction?this.direction="redo":this.setTransitionIndex(++this.transitionIndex);var t=this.transitions[this.transitionIndex];if(!e&&t.batchID&&(this.currentBatchID=t.batchID),this.transitionIndex<this.transitions.length-1){var n=this.transitions[this.transitionIndex+1];null!==n.batchID?this.nextBatchID=n.batchID:n.batchIDPlaceholder===this.currentBatchID&&(this.nextBatchID=n.batchIDPlaceholder)}t.transformItem?(t.transformItem.setTransition(t),t.transformItem.applyTransformItemState(t.endState)):t.alternateHistoryAction&&this.performAlternateHistoryAction(t.alternateHistoryAction,t.endState),this.tracePosition(),this.currentBatchID&&this.nextBatchID&&t.batchID&&this.currentBatchID==this.nextBatchID&&this.currentBatchID==t.batchID?this.redo(!0):"removeall"!=this.currentBatchID||"removeall"!=this.nextBatchID||t.batchID||this.undo()}},ei.prototype.applyAlternate=function(e,t,n){null==e&&(e=-1),null==t&&(t=!1),(null==n||isNaN(n))&&(n=-1),this.transitions=this.getTransitions();var i=!1;if(e>=0)for(var r=0;r<this.transitions.length;r++){if(this.transitions[r].timestamp==e){i=!0,this.setTransitionIndex(r);break}}if(t&&!i)return!1;this.transitionIndex=this.getTransitionIndex();var a=this.transitions[this.transitionIndex];return a.alternateHistoryAction&&a.timestamp>n&&(this.performAlternateHistoryAction(a.alternateHistoryAction,a.endState),BeFunky.log("APPLIED ALTERNATE",a.id)),!0},ei.prototype.clearTransitions=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||BFN.AppModel.viewState;this.transitions=this.getTransitions(e),this.transitionIndex=this.getTransitionIndex(e);for(var t=0;t<this.transitions.length;t++){var n=this.transitions[t];n.transformItem=null,n.previewTexture&&n.previewTexture.destroyGC(!0),n.previewTexture=null,n.previewImage&&(n.previewImage.src=""),n.previewImage=null,n.thumbTexture&&n.thumbTexture.destroyGC(!0),n.thumbTexture=null,n.thumbImage&&(n.thumbImage.src=""),n.thumbImage=null}this.transitions.splice(0),this.setTransitionIndex(0,e),this.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED)},ei.prototype.getTimestamp=function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length?this.transitions[this.transitionIndex].timestamp:NaN},ei.prototype.getLastTimestamp=function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length&&(this.transitions.length>1&&this.transitionIndex>0||0==this.transitionIndex&&"redo"==this.direction)?("undo"==this.direction?this.transitions[this.transitionIndex-1]:this.transitions[this.transitionIndex]).timestamp:0==this.transitionIndex&&"undo"==this.direction?0:NaN},ei.prototype.getNextTimestamp=function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitionIndex<this.transitions.length-1||this.transitionIndex==this.transitions.length-1&&"undo"==this.direction?("redo"==this.direction?this.transitions[this.transitionIndex+1]:this.transitions[this.transitionIndex]).timestamp:NaN},ei.prototype.performAlternateHistoryAction=function(e,t){if(t&&t.collageSettings)switch(e){case"designer_background_color":break;case"collage_settings_updated":BFN.CollageMakerCanvasPhotoGridModel.collageSettings=t.collageSettings;break;case"designer_settings_updated":BFN.DesignerCanvasModel.designerSettings=t.designerSettings}},ei.prototype.getTransitions=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||BFN.AppModel.viewState;return this.transitionsHash.hasOwnProperty(e)||(this.transitionsHash[e]=[]),this.transitionsHash[e]},ei.prototype.getTransitionIndex=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||BFN.AppModel.viewState;return this.transitionIndexHash.hasOwnProperty(e)||(this.transitionIndexHash[e]=0),this.transitionIndexHash[e]},ei.prototype.setTransitionIndex=function(e,t){var n=t||BFN.AppModel.viewState;this.transitionIndexHash[n]=e},ei.prototype.tracePosition=function(){for(var e="",t=0;t<this.transitions.length;t++){var n=this.transitions[t];e+="[",e+=n.batchID?"~":" ",e+=this.transitionIndex==t?"undo"==this.direction?"<":">":" ",e+=n.batchID?"~":" ",e+="]"}e+=" ".concat(this.transitionIndex),BeFunky.log("HISTORY: ",e)},ei.prototype.getThumb=function(e){if(e){if(e.isShape&&e.basicShapeVO&&"graphic"===e.projectItemVO.type){this.thumbBasicShapeVO||(this.thumbBasicShapeVO=new BFN.BasicShapeVO("group",{fill:"FFFFFF",fillAlpha:1,stroke:-1,strokeAlpha:1,strokeWidth:0}),this.thumbBasicShapeVO.resize(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize));var t="line"===e.basicShapeVO.type;this.thumbBasicShapeVO.setValues({type:e.basicShapeVO.type,stroke:t?"FFFFFF":-1,strokeAlpha:t?1:0,strokeWidth:t?BFN.GlobalHistoryModel.globalHistoryMenuThumbSize/5:0});var n="arrow"===e.basicShapeVO.type;this.thumbBasicShapeVO.resize(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,Math.round(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize*(n?.7:1)));var i=PIXI.RenderTexture.create(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize),r=this.thumbBasicShapeVO.getCanvasTexture();return i.copyPixels(r,{x:(i.width-r.width)/2,y:(i.height-r.height)/2}),r.destroyGC(!0),i}if(e.itemContent&&e.itemContent.texture){var a,o=e.isGoodie&&e.isShape&&BFN.SVGManager.textureHasModifiedShapeColors(e.itemContent.texture);o&&e.updateShapeTexture(!0,!0);try{a=BFN.Util.getThumbTexture(e.itemContent.texture,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1)}catch(e){}return o&&e.updateShapeTexture(),a}}var s=PIXI.RenderTexture.create(BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize);return s.fillColor(16711680),s},ei.prototype.hasCreateTransition=function(e){for(var t=0;t<this.transitions.length;t++){var n=this.transitions[t];if(n.transformItem==e&&n.isCreateTransition)return!0}return!1},Object.defineProperty(ei.prototype,"undoIsBatch",{get:function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length&&this.transitionIndex>0?"redo"==this.direction?this.transitions[this.transitionIndex].batchID:this.transitions[this.transitionIndex-1].batchID:null}}),Object.defineProperty(ei.prototype,"redoIsBatch",{get:function(){if(this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length){if(this.transitionIndex<this.transitions.length-1)return"undo"==this.direction?this.transitions[this.transitionIndex].batchID:this.transitions[this.transitionIndex+1].batchID;if("undo"==this.direction&&this.transitionIndex==this.transitions.length-1)return this.transitions[this.transitionIndex].batchID}return null}}),Object.defineProperty(ei.prototype,"undoIsAlternate",{get:function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),!!this.transitions.length&&(this.transitionIndex>0?"redo"==this.direction?null!=this.transitions[this.transitionIndex].alternateHistoryAction:null!=this.transitions[this.transitionIndex-1].alternateHistoryAction:null!=this.transitions[0].alternateHistoryAction)}}),Object.defineProperty(ei.prototype,"redoIsAlternate",{get:function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),!!this.transitions.length&&(this.transitionIndex<this.transitions.length-1?"undo"==this.direction?null!=this.transitions[this.transitionIndex].alternateHistoryAction:null!=this.transitions[this.transitionIndex+1].alternateHistoryAction:null!=this.transitions[this.transitions.length-1].alternateHistoryAction)}}),Object.defineProperty(ei.prototype,"direction",{set:function(e){this.directionHash[BFN.AppModel.viewState]=e},get:function(){return this.directionHash.hasOwnProperty(BFN.AppModel.viewState)||(this.directionHash[BFN.AppModel.viewState]="redo"),this.directionHash[BFN.AppModel.viewState]}}),Object.defineProperty(ei.prototype,"currentTransition",{get:function(){return this.transitions=this.getTransitions(),this.transitionIndex=this.getTransitionIndex(),this.transitions.length?this.transitions[this.transitionIndex]:null}}),BFN.SingletonQueue.add(function(){BFN.TransformStateModel=new ei}),BFN.PhotoEditorHistoryModelEvents={HISTORY_UPDATED:new Event("HISTORY_UPDATED"),HISTORY_INDEX_UPDATED:new Event("HISTORY_INDEX_UPDATED")},ti.prototype=Object.create(BFN.EventDispatcher.prototype),ti.prototype.init=function(){BeFunky.log("PhotoEditorHistoryModel Init"),this.historyVOs=[],this._historyIndex=0},ti.prototype.addTextureToHistory=function(e,t){if(BFN.TransformStateModel.purgeLaterTransitions(),t){for(var n=this.historyVOs.length;--n>this._historyIndex;){var i=this.historyVOs[n];i.imageTexture&&i.imageTexture!=BFN.PhotoEditorModel.sourceTexture&&(i.imageTexture.destroyGC(!0),i.previewTexture&&(i.previewTexture.destroyGC(!0),i.previewTexture=null),i.thumbTexture&&(i.thumbTexture.destroyGC(!0),i.thumbTexture=null)),i.imageTexture=null,i.thumbImage=null,i.previewImage=null,this.historyVOs.splice(n,1)}var r=new BFN.HistoryVO;r.id=this.historyVOs.length,r.name=e,r.historyAction=e,r.imageTexture=t,r.imageW=r.imageTexture.width,r.imageH=r.imageTexture.height,r.previewTexture=BFN.Util.getThumbTexture(t,Math.min(Math.max(t.width,t.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1),r.previewW=r.previewTexture.width,r.previewH=r.previewTexture.height,r.thumbTexture=BFN.Util.getThumbTexture(t,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1),r.thumbW=r.thumbTexture.width,r.thumbH=r.thumbTexture.height,this.historyVOs.push(r),this._historyIndex=this.historyVOs.length-1,this.historyIndex=this.historyIndex,BFN.TextureHistoryManager.addTextureHistory(r.timestamp),this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED);var a="".concat(BFN.formatKeyString(e," ")," ( ").concat(BFN.formatKeyString(BFN.PhotoEditorCanvasModel.viewState,"",["viewing"])," )");return BFN.SentryManager.reportBreadcrumb(a,"image_edited","app_history"),r.timestamp}},ti.prototype.resetHistory=function(){for(var e=this.historyVOs.length;--e>-1;){var t=this.historyVOs[e];t.imageTexture&&t.imageTexture!=BFN.PhotoEditorModel.sourceTexture&&t.imageTexture.destroyGC(!0),t.imageTexture=null;try{t.thumbTexture&&t.thumbTexture.destroyGC(!0)}catch(e){}t.thumbTexture=null,t.thumbImage&&(t.thumbImage.src=""),t.thumbImage=null;try{t.previewTexture&&t.previewTexture.destroyGC(!0)}catch(e){}t.previewTexture=null,t.previewImage&&(t.previewImage.src=""),t.previewImage=null}this.historyVOs.splice(0),this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED)},ti.prototype.purgeLaterHistory=function(){for(var e=this.historyVOs.length;--e>this.historyIndex;){var t=this.historyVOs[e];t.imageTexture&&t.imageTexture.destroyGC(!0),t.imageTexture=null,t.thumbTexture&&t.thumbTexture.destroyGC(!0),t.thumbTexture=null,t.thumbImage&&(t.thumbImage.src=""),t.thumbImage=null,t.previewTexture&&t.previewTexture.destroyGC(!0),t.previewTexture=null,t.previewImage&&(t.previewImage.src=""),t.previewImage=null,this.historyVOs.splice(e,1)}this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED)},ti.prototype.purgeEarlierHistory=function(e,t){for(var n=0,i=this.historyVOs.length;--i>-1;){var r=this.historyVOs[i];if(r.timestamp<=e){if(r.imageTexture&&r.imageTexture!=BFN.PhotoEditorModel.sourceTexture&&!t.includes(r.imageTexture.baseTexture)){var a=r.imageTexture.baseTexture,o=!a||a._destroyed;r.imageTexture.destroyGC(!0),o!=(!a||a._destroyed)&&n++}r.imageTexture=null,r.thumbTexture&&r.thumbTexture.destroyGC(!0),r.thumbTexture=null,r.thumbImage&&(r.thumbImage.src=""),r.thumbImage=null,r.previewTexture&&r.previewTexture.destroyGC(!0),r.previewTexture=null,r.previewImage&&(r.previewImage.src=""),r.previewImage=null,this.historyVOs.splice(i,1),this.historyIndex--}}return n},ti.prototype.undo=function(){if(this.historyVOs.length>1&&this._historyIndex>0){this.historyIndex--;var e=this.historyVOs[this._historyIndex];e.imageTexture?BFN.PhotoEditorModel.updateCurrentTexture(e.imageTexture):this.historyIndex++}},ti.prototype.redo=function(){if(this._historyIndex<this.historyVOs.length-1){this.historyIndex++;var e=this.historyVOs[this._historyIndex];e.imageTexture?BFN.PhotoEditorModel.updateCurrentTexture(e.imageTexture):this.historyIndex--}},ti.prototype.getTimestamp=function(){return this.historyVOs.length?this.historyVOs[this._historyIndex].timestamp:NaN},ti.prototype.getLastTimestamp=function(){return this.historyVOs.length&&this._historyIndex>0?this.historyVOs[this._historyIndex-1].timestamp:NaN},ti.prototype.getNextTimestamp=function(){return this.historyVOs.length&&this._historyIndex<this.historyVOs.length-1?this.historyVOs[this._historyIndex+1].timestamp:NaN},Object.defineProperty(ti.prototype,"historyIndex",{set:function(e){this._historyIndex=Math.max(0,Math.min(this.historyVOs.length-1,e)),this.dispatchEvent(BFN.PhotoEditorHistoryModelEvents.HISTORY_INDEX_UPDATED)},get:function(){return this._historyIndex}}),Object.defineProperty(ti.prototype,"currentHistoryAction",{get:function(){return this.historyVOs.length?this.historyVOs[this._historyIndex].historyAction:null}}),Object.defineProperty(ti.prototype,"lastHistoryAction",{get:function(){return this.historyVOs.length&&this._historyIndex>0?this.historyVOs[this._historyIndex-1].historyAction:null}}),Object.defineProperty(ti.prototype,"nextHistoryAction",{get:function(){return this.historyVOs.length&&this._historyIndex<this.historyVOs.length-1?this.historyVOs[this._historyIndex+1].historyAction:null}}),BFN.SingletonQueue.add(function(){BFN.PhotoEditorHistoryModel=new ti}),BFN.CollageMakerHistoryModelEvents={HISTORY_UPDATED:new Event("CANVAS_SCALE_UPDATED"),HISTORY_INDEX_UPDATED:new Event("CANVAS_SCALING_UPDATED"),APPLY_CURRENT_SNAPSHOT:new Event("ITEM_ADDED")};var ni=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("CollageMakerHistoryModel Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this._ignoreSnapshot=!1,this._ignoreSnapshotApply=!1,this._historyAction=null,this._snapshotVOs=[],this._snapshotIndex=0,this._currentSnapshotVO=null,this._usedBaseTextures=[],this._focusedGridChild=null,this.lastFocusedGridChild=null}},{key:"addPhotoGridSnapshotToHistory",value:function(e){this._focusedGridChild&&this._focusedGridChild===this.lastFocusedGridChild&&this.currentHistoryAction===e.historyAction?this.undo(!1):this.lastFocusedGridChild=null,BFN.TransformStateModel.purgeLaterTransitions();var t=[];if(this._snapshotIndex<this._snapshotVOs.length)for(var n=0;n<=this._snapshotIndex;n++){var i=this._snapshotVOs[n];i.backgroundPatternBaseTexture&&!t.includes(i.backgroundPatternBaseTexture)&&t.push(i.backgroundPatternBaseTexture);for(var r=0;r<i.snapshotChildren.length;r++){var a=i.snapshotChildren[r];a.texture&&a.texture.valid&&!t.includes(a.texture.baseTexture)&&t.push(a.texture.baseTexture)}}if(!this._ignoreSnapshot&&e){for(var o=this._snapshotVOs.length;--o>this._snapshotIndex;){var s=this._snapshotVOs[o];try{s.thumbTexture.destroyGC(!0)}catch(e){}s.thumbTexture=null,s.thumbImage=null;try{s.previewTexture.destroyGC(!0)}catch(e){}s.previewTexture=null,s.previewImage=null,this._snapshotVOs.splice(o,1),this.updateUsedBaseTextures();for(var l=0;l<s.snapshotChildren.length;l++){var u=s.snapshotChildren[l];if(u.texture&&u.texture.valid){var c=this._usedBaseTextures.indexOf(u.texture.baseTexture),h=t.indexOf(u.texture.baseTexture);if(-1===c&&-1===h)try{u.texture.destroyGC(!0),console.log("disposing unused image - [ addPhotoGridSnapshotToHistory ]")}catch(e){}else console.log("avoiding dispose, image still used - [ addPhotoGridSnapshotToHistory ]")}u.texture=null}s.snapshotChildren.splice(0),s.snapshotChildren=null}var d=BFN.formatKeyString(e.historyAction," ");return BFN.SentryManager.reportBreadcrumb(d,"collage_edited","app_history"),this._snapshotVOs.push(e),this._snapshotIndex=this._snapshotVOs.length-1,this.snapshotIndex=this.snapshotIndex,BFN.TextureHistoryManager.addTextureHistory(e.timestamp),this.updateUsedBaseTextures(),t.splice(0),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED),e.timestamp}}},{key:"updateUsedBaseTextures",value:function(){var e=this;this._usedBaseTextures.splice(0);for(var t=0;t<this._snapshotVOs.length;t++)for(var n=this._snapshotVOs[t],i=0;i<n.snapshotChildren.length;i++){var r=n.snapshotChildren[i];r.texture&&r.texture.valid&&-1===this._usedBaseTextures.indexOf(r.texture.baseTexture)&&this._usedBaseTextures.push(r.texture.baseTexture)}if(BFN.PhotoGrid.gridChildren.forEach(function(t){if(!t.content.isEmpty&&t.content.image&&t.content.image.frameSprite&&t.content.image.frameSprite.texture&&t.content.image.frameSprite.texture.baseTexture&&!t.content.image.frameSprite.texture.baseTexture.destroyed){var n=t.content.image.frameSprite.texture.baseTexture;-1===e._usedBaseTextures.indexOf(n)&&e._usedBaseTextures.push(n)}}),BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER)for(var a=BFN.TransformStateModel.getTransitions(),o=0;o<a.length;o++){var s=a[o];s.startState&&s.startState.imageTexture&&s.startState.imageTexture.valid&&-1===this._usedBaseTextures.indexOf(s.startState.imageTexture.baseTexture)&&this._usedBaseTextures.push(s.startState.imageTexture.baseTexture),s.endState&&s.endState.imageTexture&&s.endState.imageTexture.valid&&-1===this._usedBaseTextures.indexOf(s.endState.imageTexture.baseTexture)&&this._usedBaseTextures.push(s.endState.imageTexture.baseTexture)}}},{key:"resetHistory",value:function(){for(var e=BFN.GlobalHistoryModel.getUsedBaseTextures(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER),t=this._snapshotVOs.length;--t>-1;){var n=this._snapshotVOs[t];try{n.thumbTexture.destroyGC(!0)}catch(e){}n.thumbTexture=null,n.thumbImage=null;try{n.previewTexture.destroyGC(!0)}catch(e){}n.previewTexture=null,n.previewImage=null;for(var i=0;i<n.snapshotChildren.length;i++){var r=n.snapshotChildren[i];if(r.texture&&r.texture.valid){if(-1===e.indexOf(r.texture.baseTexture)&&!r.menuImageVO.isPattern)try{r.texture.baseTexture&&r.texture.destroyGC(!0)}catch(e){}r.texture=null}}n.snapshotChildren.splice(0),n.snapshotChildren=null}this._snapshotVOs.splice(0),this.updateUsedBaseTextures(),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED)}},{key:"purgeLaterHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._snapshotVOs.length){var t=BFN.GlobalHistoryModel.getUsedBaseTextures(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER);e&&!t.includes(e)&&t.push(e),BFN.TransformStateModel.safeBaseTextures.forEach(function(e){t.includes(e)||t.push(e)});for(var n=[],i=0;i<=this._snapshotIndex;i++){var r=this._snapshotVOs[i];r.backgroundPatternBaseTexture&&!n.includes(r.backgroundPatternBaseTexture)&&n.push(r.backgroundPatternBaseTexture);for(var a=0;a<r.snapshotChildren.length;a++){var o=r.snapshotChildren[a];o.texture&&o.texture.valid&&!n.includes(o.texture.baseTexture)&&n.push(o.texture.baseTexture)}}for(var s=this._snapshotVOs.length;--s>this._snapshotIndex;){var l=this._snapshotVOs[s];try{l.thumbTexture.destroyGC(!0)}catch(e){}l.thumbTexture=null,l.thumbImage=null;try{l.previewTexture.destroyGC(!0)}catch(e){}l.previewTexture=null,l.previewImage=null;for(var u=0;u<l.snapshotChildren.length;u++){var c=l.snapshotChildren[u];if(c.texture&&c.texture.valid&&c.texture.baseTexture&&!c.texture.baseTexture.isPattern){var h=t.indexOf(c.texture.baseTexture),d=n.indexOf(c.texture.baseTexture);if(-1===h&&-1===d)try{c.texture.destroyGC(!0)}catch(e){}}}l.snapshotChildren.splice(0),l.snapshotChildren=null,this._snapshotVOs.splice(s,1)}n.splice(0),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED)}}},{key:"purgeEarlierHistory",value:function(e,t){var n=!1;if(this._snapshotVOs.length)for(var i=this._snapshotVOs.length;--i>-1;){var r=this._snapshotVOs[i];if(r.timestamp<=e){try{r.thumbTexture.destroyGC(!0)}catch(e){}r.thumbTexture=null,r.thumbImage=null;try{r.previewTexture.destroyGC(!0)}catch(e){}r.previewTexture=null,r.previewImage=null;for(var a=0;a<r.snapshotChildren.length;a++){var o=r.snapshotChildren[a];if(o.texture&&o.texture.baseTexture){var s=o.texture.baseTexture,l=!s||s._destroyed;o.texture.destroyGC(!t.includes(o.texture.baseTexture)),l!=(!s||s._destroyed)&&n++}}r.snapshotChildren.splice(0),r.snapshotChildren=null,this._snapshotVOs.splice(i,1),this._snapshotIndex--}}return n}},{key:"undo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._snapshotVOs.length>1&&this._snapshotIndex>0&&(this.snapshotIndex--,e&&this.applySnapshot())}},{key:"redo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._snapshotIndex<this._snapshotVOs.length-1&&(this.snapshotIndex++,e&&this.applySnapshot())}},{key:"applySnapshot",value:function(){if(!this._ignoreSnapshotApply){var e=this._snapshotVOs[this._snapshotIndex];this._currentSnapshotVO=e,this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.APPLY_CURRENT_SNAPSHOT),this._currentSnapshotVO=null,this.updateUsedBaseTextures()}}},{key:"getTimestamp",value:function(){return this._snapshotVOs.length?this._snapshotVOs[this._snapshotIndex].timestamp:NaN}},{key:"getLastTimestamp",value:function(){return this._snapshotVOs.length&&this._snapshotIndex>0?this._snapshotVOs[this._snapshotIndex-1].timestamp:NaN}},{key:"getNextTimestamp",value:function(){return this._snapshotVOs.length&&this._snapshotIndex<this._snapshotVOs.length-1?this._snapshotVOs[this._snapshotIndex+1].timestamp:NaN}},{key:"textureInUse",value:function(e){return-1!==this._usedBaseTextures.indexOf(e)}},{key:"currentSnapshotVO",get:function(){return this._currentSnapshotVO}},{key:"ignoreSnapshot",set:function(e){this._ignoreSnapshot=e},get:function(){return this._ignoreSnapshot}},{key:"ignoreSnapshotApply",set:function(e){this._ignoreSnapshotApply=e},get:function(){return this._ignoreSnapshotApply}},{key:"usedBaseTextures",get:function(){return this._usedBaseTextures}},{key:"historyAction",set:function(e){this._historyAction=e},get:function(){return this._historyAction}},{key:"focusedGridChild",set:function(e){this._focusedGridChild&&(this.lastFocusedGridChild=this._focusedGridChild),this._focusedGridChild=e},get:function(){return this._focusedGridChild}},{key:"snapshotVOs",get:function(){return this._snapshotVOs}},{key:"snapshotIndex",set:function(e){this._snapshotIndex=Math.max(0,Math.min(this._snapshotVOs.length-1,e)),this.dispatchEvent(BFN.CollageMakerHistoryModelEvents.HISTORY_INDEX_UPDATED)},get:function(){return this._snapshotIndex}},{key:"currentHistoryAction",get:function(){return this._snapshotVOs.length?this._snapshotVOs[this._snapshotIndex].historyAction:null}},{key:"lastHistoryAction",get:function(){return this._snapshotVOs.length&&this._snapshotIndex>0?this._snapshotVOs[this._snapshotIndex-1].historyAction:null}},{key:"nextHistoryAction",get:function(){return this._snapshotVOs.length&&this._snapshotIndex<this._snapshotVOs.length-1?this._snapshotVOs[this._snapshotIndex+1].historyAction:null}}]),n}();BFN.SingletonQueue.add(function(){BFN.CollageMakerHistoryModel=new ni}),BFN.GlobalHistoryModelEvents={HISTORY_UPDATED:new Event("HISTORY_UPDATED"),HISTORY_ID_UPDATED:new Event("HISTORY_ID_UPDATED"),HISTORY_BUTTONS_UPDATED:new Event("HISTORY_BUTTONS_UPDATED"),SELECT_HISTORY_ITEM:new Event("SELECT_HISTORY_ITEM")};var ii=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("GlobalHistoryModel Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this,t=BeFunky.isRetina();this.globalHistoryMenuThumbSize=BFN.CSS.historyMenuThumbSize*(t?2:1),this.globalHistoryMenuPreviewSize=BFN.CSS.historyMenuPreviewSize*(t?1.5:1),this.selectedHistoryID={},this.selectedHistoryID[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR]=null,this.selectedHistoryID[BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER]=null,this.selectedHistoryID[BFN.AppModelViewStates.VIEWING_DESIGNER]=null,this.historyItemPrefixHash={},this.historyItemPrefixHash[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR]="history_item_editor_",this.historyItemPrefixHash[BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER]="history_item_collage_",this.historyItemPrefixHash[BFN.AppModelViewStates.VIEWING_DESIGNER]="history_item_designer_",this.historyItemPrefix=this.historyItemPrefixHash[BFN.AppModel.viewState],this.globalHistoryVOs=[],this.globalHistoryVOHash={},this.historyUpdateQueued=!1,BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewstateUpdated.bind(this)),BFN.TransformStateModel.addEventListener(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED.type,this.handleTransitionsUpdated.bind(this)),BFN.PhotoEditorHistoryModel.addEventListener(BFN.PhotoEditorHistoryModelEvents.HISTORY_UPDATED.type,this.handlePhotoEditorHistoryUpdated.bind(this)),BFN.CollageMakerHistoryModel.addEventListener(BFN.CollageMakerHistoryModelEvents.HISTORY_UPDATED.type,this.handleCollageMakerHistoryUpdated.bind(this)),this.addEventListener(BFN.GlobalHistoryModelEvents.SELECT_HISTORY_ITEM.type,this.handleSelectHistoryItem.bind(this)),setTimeout(function(){BFN.UndoManager.addEventListener(BFN.UndoManagerEvents.TIMESTAMP_UPDATED.type,e.handleUndoManagerTimestampUpdated.bind(e))},50)}},{key:"queueHistoryUpdate",value:function(){var e=this;this.historyUpdateQueued||(this.historyUpdateQueued=!0,setTimeout(function(){BFN.MainUI.addIdleRenderFunction(function(){e.historyUpdateQueued=!1,e.updateHistory()})},200))}},{key:"getTimestamps",value:function(){var e=[];return BFN.TransformStateModel.getTransitions().forEach(function(t){e.push(t.timestamp)}),BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR?BFN.PhotoEditorHistoryModel.historyVOs.forEach(function(t){e.push(t.timestamp)}):e.includes(0)||e.push(0),BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&BFN.CollageMakerHistoryModel.snapshotVOs.forEach(function(t){e.push(t.timestamp)}),e.sort(function(e,t){return e-t}),e}},{key:"updateHistory",value:function(){BFN.TextureHistoryManager.updateTextureHistory(this.getTimestamps()),BFN.TextureHistoryManager.printTextureHistory(),BFN.TextureHistoryManager.cleanupTextureHistory()&&(BFN.TextureHistoryManager.updateTextureHistory(this.getTimestamps()),BFN.TextureHistoryManager.printTextureHistory()),this.globalHistoryVOs.splice(0);var e=BFN.TextureHistoryManager.historyModifiedHash[BFN.AppModel.viewState];if(BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&!e){var t=new BFN.GlobalHistoryVO;t.timestamp=0,BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER?BFN.CollageMakerCanvasPhotoGridModel.freeform&&(t.historyTag="blank_canvas",t.thumbImage=this.blankThumbImage,this.globalHistoryVOs.push(t)):(t.historyTag="new_template",t.thumbImage=this.blankThumbImage,this.globalHistoryVOs.push(t))}for(var n=BFN.TransformStateModel.getTransitions(),i=0;i<n.length;i++){var r=n[i];if(!r.batchID){var a=new BFN.GlobalHistoryVO;a.timestamp=r.timestamp,a.historyTag=r.id,a.thumbImage=null,a.isText=r.transformItem&&"text"==r.transformItem.type,a.useTextIcon=r.useTextIcon,a.isGroup=!(!r.batchIDPlaceholder||r.isSettingsTransition||r.transformItem||a.useTextIcon),a.useGroupIcon=r.useGroupIcon,a.isText||a.useTextIcon||(r.transformItem?(r.transformItem.itemObject.thumbImage&&(r.transformItem.thumbImage=r.transformItem.itemObject.thumbImage,delete r.transformItem.itemObject.thumbImage),!r.transformItem.thumbImage&&r.transformItem.thumbTexture&&(r.transformItem.thumbImage=BFN.Util.getHTMLImage(r.transformItem.thumbTexture,null,!0),r.transformItem.thumbTexture.destroyGC(!0),r.transformItem.thumbTexture=null),!r.thumbImage&&r.transformItem.thumbImage&&(r.thumbImage=r.transformItem.thumbImage),r.thumbImage&&(a.thumbImage=r.thumbImage)):(!r.previewImage&&r.previewTexture&&(r.previewImage=BFN.Util.getHTMLImage(r.previewTexture,null,!0),r.previewTexture.destroyGC(!0),r.previewTexture=null),r.previewImage&&(a.previewImage=r.previewImage),!r.thumbImage&&r.thumbTexture&&(r.thumbImage=BFN.Util.getHTMLImage(r.thumbTexture,null,!0),r.thumbTexture.destroyGC(!0),r.thumbTexture=null),r.thumbImage&&(a.thumbImage=r.thumbImage))),this.globalHistoryVOs.push(a)}}if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR)for(var o=0;o<BFN.PhotoEditorHistoryModel.historyVOs.length;o++){var s=BFN.PhotoEditorHistoryModel.historyVOs[o],l=new BFN.GlobalHistoryVO;l.timestamp=s.timestamp,l.historyTag=s.historyAction,l.thumbImage=null,l.previewImage=null,!s.previewImage&&s.previewTexture&&(s.previewImage=BFN.Util.getHTMLImage(s.previewTexture,null,!0),s.previewTexture.destroyGC(!0),s.previewTexture=null),s.previewImage&&(l.previewImage=s.previewImage),!s.thumbImage&&s.thumbTexture&&(s.thumbImage=BFN.Util.getHTMLImage(s.thumbTexture,null,!0),s.thumbTexture.destroyGC(!0),s.thumbTexture=null),s.thumbImage&&(l.thumbImage=s.thumbImage),this.globalHistoryVOs.push(l)}if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER)for(var u=0;u<BFN.CollageMakerHistoryModel.snapshotVOs.length;u++){var c=BFN.CollageMakerHistoryModel.snapshotVOs[u],h=new BFN.GlobalHistoryVO;h.timestamp=c.timestamp,h.historyTag=c.historyAction,h.thumbImage=null,h.previewImage=null,!c.previewImage&&c.previewTexture&&(c.previewImage=BFN.Util.getHTMLImage(c.previewTexture,null,!0),c.previewTexture.destroyGC(!0),c.previewTexture=null),c.previewImage&&(h.previewImage=c.previewImage),!c.thumbImage&&c.thumbTexture&&(c.thumbImage=BFN.Util.getHTMLImage(c.thumbTexture,null,!0),c.thumbTexture.destroyGC(!0),c.thumbTexture=null),c.thumbImage&&(h.thumbImage=c.thumbImage),this.globalHistoryVOs.push(h)}this.globalHistoryVOs.sort(function(e,t){return e.timestamp-t.timestamp}),this.globalHistoryVOHash={},BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.ids=[],BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.data=[],BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.selectedID=this.selectedHistoryID[BFN.AppModel.viewState];for(var d=0;d<this.globalHistoryVOs.length;d++){var m=this.globalHistoryVOs[d],p=this.historyItemPrefix+m.timestamp;this.globalHistoryVOHash[p]=m,BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.ids.push(p),BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.data.push({id:p,name:m.historyTag,thumb:m.thumbImage,preview:m.previewImage,isText:m.isText,isGroup:m.isGroup,useTextIcon:m.useTextIcon,useGroupIcon:m.useGroupIcon})}this.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED),this.updateGlobalHistoryMenuState(this.globalHistoryVOs.length>0),this.updateGlobalHistoryButtons(),BFN.CollageMakerPatternManager.destroyUnusedPatternBaseTextures();var g=this.selectedHistoryID[BFN.AppModel.viewState];g&&this.globalHistoryVOHash.hasOwnProperty(g)&&(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.data=g,BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED))}},{key:"updateGlobalHistoryMenuState",value:function(){}},{key:"updateGlobalHistoryButtons",value:function(){var e=BFN.UndoManager.undoExists,t=BFN.UndoManager.redoExists;BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS||BFN.ImagePainterUndoManager.imagePainterOpen||(e=!0)),BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED.data={undoExists:e,redoExists:t},BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED)}},{key:"getUsedBaseTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object.values(BFN.ProjectManager.projectImageBaseTextures);t&&Object.values(BFN.PatchManager.clipboardBaseTextures).forEach(function(e){i(e)});function i(e){e&&!n.includes(e)&&n.push(e)}function r(e){e&&i(e.baseTexture)}return Object.values(BFN.AppModelViewStates).forEach(function(t){t!=e&&(BFN.TextureHistoryManager.getBaseTextures(t).forEach(function(e){n.includes(e)||n.push(e)}),BFN.AppModel.getSectionValue(t,BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer.children.filter(function(e){return e instanceof BFN.TransformItem}).forEach(function(e){e.itemContent&&r(e.itemContent.texture),e.itemContentMask&&r(e.itemContentMask.texture)}),BFN.TransformStateModel.getTransitions(t).forEach(function(e){var t=e.transformItem,n=e.startState,i=e.endState;t&&t.itemContentMask&&r(t.itemContentMask.texture),n&&r(n.imageTexture),i&&r(i.imageTexture)}),BFN.CollageMakerCanvasPhotoGrid.pendingAutoCollageBaseTextures.forEach(function(e){n.includes(e)||n.push(e)}))}),e!=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&BFN.CollageMakerHistoryModel.snapshotVOs&&BFN.CollageMakerHistoryModel.snapshotVOs.forEach(function(e){e.snapshotChildren&&e.snapshotChildren.forEach(function(e){r(e.texture)})}),e!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&BFN.PhotoEditorHistoryModel.historyVOs&&BFN.PhotoEditorHistoryModel.historyVOs.forEach(function(e){r(e.imageTexture)}),n}},{key:"handleAppModelViewstateUpdated",value:function(e){this.historyItemPrefix=this.historyItemPrefixHash[BFN.AppModel.viewState],this.queueHistoryUpdate()}},{key:"handleTransitionsUpdated",value:function(e){this.selectedHistoryID[BFN.AppModel.viewState]=null,this.queueHistoryUpdate()}},{key:"handlePhotoEditorHistoryUpdated",value:function(e){this.selectedHistoryID[BFN.AppModel.viewState]=null,BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&this.queueHistoryUpdate()}},{key:"handleCollageMakerHistoryUpdated",value:function(e){this.selectedHistoryID[BFN.AppModel.viewState]=null,BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&this.queueHistoryUpdate()}},{key:"handleSelectHistoryItem",value:function(e){if(e.data&&this.globalHistoryVOHash.hasOwnProperty(e.data)){var t=this.globalHistoryVOHash[e.data];BFN.UndoManager.gotoTimestamp(t.timestamp)}}},{key:"updateSelectedHistoryID",value:function(){this.selectedHistoryID[BFN.AppModel.viewState]=this.historyItemPrefix+BFN.UndoManager.getTimestamp()}},{key:"handleUndoManagerTimestampUpdated",value:function(e){this.updateSelectedHistoryID(),BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.data=this.selectedHistoryID[BFN.AppModel.viewState],BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED),this.updateGlobalHistoryButtons()}},{key:"blankThumbImage",get:function(){return this.blankThumbTexture||(this.blankThumbTexture=PIXI.RenderTexture.create(this.globalHistoryMenuThumbSize,this.globalHistoryMenuThumbSize),this.blankThumbTexture.fillColor(15922165),this._blankThumbImage=BFN.Util.getHTMLImage(this.blankThumbTexture)),this._blankThumbImage}}]),n}();BFN.SingletonQueue.add(function(){BFN.GlobalHistoryModel=new ii}),BFN.PhotoEditorModelEvents={SOURCE_IMAGE_UPDATED:new Event("SOURCE_IMAGE_UPDATED"),CURRENT_IMAGE_UPDATED:new Event("CURRENT_IMAGE_UPDATED"),CURRENT_IMAGE_RESET:new Event("CURRENT_IMAGE_RESET"),EDITOR_IMAGE_LOAD_COMPLETE:new Event("EDITOR_IMAGE_LOAD_COMPLETE"),EDITOR_IMAGE_LOAD_ERROR:new Event("EDITOR_IMAGE_LOAD_ERROR"),PROJECT_UPDATED:new Event("PROJECT_UPDATED")};var ri=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("PhotoEditorModel Init"),this.initDefaultValues(),this.updateProjectVO=BeFunky.debounce(this.updateProjectVO.bind(this),10),this.webcamModal=null}},{key:"initDefaultValues",value:function(){var e=this;this.sourceTexture=BFN.renderTexturesPool[0].texture,this._currentTexture=null,this.currentTextureDimensions={width:-1,height:-1},this.currentTextureBlobSaveTimeout=null,this.currentTextureBlobSaveInProgress=!1,this.currentEXIF=null,this.hasUnsavedChanges=!1,BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,function(){BFN.AppModel.viewingEditor&&BFN.GlobalHistoryModel.globalHistoryVOs.length>1&&(e.hasUnsavedChanges=!0)}),this._projectVO=new BFN.ProjectVO,this._projectVO.version=2,this._projectVO.section="editor"}},{key:"openSampleImage",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(BFN.DeepLinkManager.isNeedToOpenTouchUp=!0),BFN.BfnService.ToJsUrlUploader(e,"BeFunky-sample",!0,"sample"),UIToggler.toggleSampleImagePopover(!1)}},{key:"confirmEditorLoadImage",value:function(e,t){this.currentTexture&&(this.hasUnsavedChanges||BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.PhotoEditorCanvasTools.currentTool)?BeFunky.confirm("confirm_photo_change",{onConfirm:e,onCancel:t,confirmText:"yes",cancelText:"no"}):e()}},{key:"handleEditorLoadImage",value:function(){BFN.MultipleFileUploader.upload(this.onEditorImageUpload.bind(this),{allowMultiple:!1,createMenuImageVO:!1})}},{key:"onEditorImageUpload",value:function(e){var t=e.file;if(t){BFN.BfnService.track("CREATE","UPLOAD","DESKTOP"),BFN.BfnService.trackMediaOpened("image","computer");var n=t.name.replace(/\.[^/.]+$/,"");this.loadBase64OrBlob(t,{filename:n})}}},{key:"loadBase64OrBlob",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.showLoadScreen,r=void 0===i||i,a=n.filename,o=void 0===a?"":a,s=n.callback,l=void 0===s?function(){}:s,u=n.clearLocalAssets,c=void 0===u?!BFN.ImageEditManager.editingImage:u,h=n.saveBlobAsIs,d=void 0!==h&&h,m={textureSize:BFN.maxImageSize},p=!1;r&&BeFunky.showLoadScreen({onCancel:function(){p=!0}}),BFN.TextureUtils.blobOrBase64ToTexture(e,function(n){var i=n.error,a=n.texture,s=n.exif;if(!p){r&&BeFunky.hideLoadScreen();var u=Boolean(a&&a.width),h=e instanceof Blob?e:void 0;if(l({success:u}),!u)return t.handleTextureFileLoaderTextureError(i,h);BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),t.handleTextureLoaded(a,c,d?h:void 0),"string"==typeof o&&(BFN.UploadSaveShareManager.setFileName("editor","image",o),t._projectVO.filename=o),t.currentEXIF=s||null}},m)}},{key:"openWebcamModal",value:function(){this.webcamModal||(this.webcamModal=document.getElementById("webcam_modal"),BFN.UI.webcamModal(this.webcamModal)),this.webcamModal.open()}},{key:"updateCurrentTexture",value:function(e){null!=e&&(this.currentTexture=e,this.dispatchEvent(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED),this.saveCurrentTextureBlob(),this.updateProjectVO(!1))}},{key:"saveCurrentTextureBlob",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,n=arguments.length>1?arguments[1]:void 0;clearTimeout(this.currentTextureBlobSaveTimeout),this.currentTextureBlobSaveTimeout=setTimeout(function(){e.currentTextureBlobSaveInProgress||BFN.ImageEditManager.editingImage||(e.currentTextureBlobSaveInProgress=!0,(n?Promise.resolve(n):e.getCurrentTextureBlob()).then(function(e){return BFN.ProjectService.setLocalAsset("editor","image","editor_canvas_image",e)}).then(function(){e.currentTextureBlobSaveInProgress=!1}).catch(function(n){BeFunky.logError("Unable to autosave editor main image",n),e.currentTextureBlobSaveInProgress=!1,e.currentTexture&&e.currentTexture.valid&&e.saveCurrentTextureBlob(t)}))},t)}},{key:"getCurrentTextureBlob",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=(this.currentTexture||{}).autoSaveID,i=function(){return e.currentTexture?e.currentTexture.valid?e.currentTexture.autoSaveID!==n&&"texture_changed":"invalid_texture":"no_texture"};return new Promise(function(r,a){var o=function(e){if(!t)return e();BFN.MainUI.addIdleRenderFunction(function(){if(i())return a(i());e()})},s=Date.now(),l=function(e){!function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=BeFunky).logFeature.apply(e,["editor_image"].concat(n))}(n,e,Date.now()-s),s=Date.now()};if(i())return a(i());var u=e.currentTexture.determineTransparency();l("check transparency"),o(function(){l("idle");var t=BeFunky.isFirefox?.99:1,n=BFN.TextureUtils.textureToCanvas(e.currentTexture,{isTransparent:u});l("texture -> canvas"),o(function(){l("idle"),n.toBlob(function(t){if(l("canvas -> blob"),"image/jpeg"!==t.type)return r(t);o(function(){l("idle"),BFN.ExifTool.insert(t,e.currentEXIF,void 0,function(e){var n=e.error,o=e.blob;return i()?a(i()):(l("add EXIF"),n?(BeFunky.logError("Unable to add EXIF data to image blob. Falling back to original blob.",n),r(t)):r(o))})})},u?"image/png":"image/jpeg",t)})})})}},{key:"updateProjectVO",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Boolean(this.currentTexture&&this.currentTexture.valid);this._projectVO.projectWidth=n?this.currentTexture.width:0,this._projectVO.projectHeight=n?this.currentTexture.height:0,this._projectVO.editorImageBase64=null,e&&BFN.ProjectManager.updateProjectVOItems(this,BFN.PhotoEditorCanvas.transformLayer),this._projectVO.transformGroups=BFN.GroupManager.getSectionGroupObjects("editor",!0),t&&BFN.ProjectManager.requestLocalSave({sectionID:"editor",allowReset:!n})}},{key:"handleTextureLoaded",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=!this.currentTexture;if(this.currentTexture&&this.currentTexture!==this.sourceTexture&&(this.currentTexture.destroyGC(!0),this.currentTexture=null),this.sourceTexture.baseTexture.maskTexture){try{this.sourceTexture.baseTexture.maskTexture.destroyGC(!0)}catch(e){}delete this.sourceTexture.baseTexture.maskTexture}BFN.ArtsyService.reset(),BFN.BackgroundRemovalManager.reset(),this.sourceTexture.resize(e.frame.width,e.frame.height),this.sourceTexture.copyPixels(e),this.sourceTexture.determineTransparency(),e.resize(1024,1024),this.currentTexture=this.sourceTexture,this.saveCurrentTextureBlob(0,n),this.updateProjectVO(!0);var r=BFN.Util.calculateRes(this.sourceTexture.width,this.sourceTexture.height);BFN.renderTextureResolution=r.small,BFN.renderTextureResolutionLarge=r.large,this.dispatchEvent(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED),this.dispatchEvent(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED),BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME),BFN.PhotoEditorMenuModel.createCurrentImageThumb(this.sourceTexture),BFN.TransformStateModel.clearTransitions(),BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS),BFN.PhotoEditorHistoryModel.resetHistory(),BFN.PhotoEditorHistoryModel.addTextureToHistory("new_image",this.currentTexture),t&&BFN.ProjectService.clearLocalAssets("editor"),UIToggler.toggleMainMenu(!0),UIToggler.toggleZoomMenu(!0),UIToggler.toggleSaveButtons(!0),UIToggler.toggleSampleImagePopover(!1),this.hasUnsavedChanges=!1,BFN.TransformGuides.setTransformGuideData(),this.dispatchEvent(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE),e.destroyGC(!0),e=null,i&&BFN.DeepLinkManager.handleEditorImageDeepLink(function(){BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED)})}},{key:"handleTextureFileLoaderTextureError",value:function(e,t){BeFunky.logError("Unable to generate Photo Editor texture",e),t&&t.name&&BFN.MultipleFileUploader.acknowledgeInvalidImageFiles([{error:e,file:t}]),this.dispatchEvent(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR)}},{key:"projectVO",set:function(e){this._projectVO=e,this.dispatchEvent(BFN.PhotoEditorModelEvents.PROJECT_UPDATED)},get:function(){return this._projectVO}},{key:"currentTexture",set:function(e){if(this._currentTexture=e,this._currentTexture&&(this._currentTexture.autoSaveID=Math.random()),this.currentTextureDimensions.width=this.currentTextureDimensions.height=-1,this._currentTexture){try{this.currentTextureDimensions.width=this._currentTexture.width}catch(e){}try{this.currentTextureDimensions.height=this._currentTexture.height}catch(e){}}},get:function(){return this._currentTexture}}]),n}();function ai(){BFN.EventDispatcher.call(this),this.init()}function oi(){var e=g(["\n            <div>\n                <p>",'</p>\n                <p style="margin-bottom: 0"><a href="https://support.befunky.com/hc/en-us/articles/360040712632}" target="_blank" rel="noopener">',"</a></p>\n            </div>"]);return oi=function(){return e},e}function si(){BFN.EventDispatcher.call(this),this.init()}BFN.SingletonQueue.add(function(){BFN.PhotoEditorModel=new ri}),BFN.PhotoEditorMenuModelEvents={CURRENT_IMAGE_THUMB_UPDATED:new Event("CURRENT_IMAGE_THUMB_UPDATED")},ai.prototype=Object.create(BFN.EventDispatcher.prototype),ai.prototype.init=function(){BeFunky.log("PhotoEditorMenuModel Init"),this.currentImageThumbTexture=null,this.currentImageThumbImage=null;var e=BeFunky.isRetina()?2:1;this.presetItemThumbW=224*e,this.presetItemThumbH=130*e},ai.prototype.createCurrentImageThumb=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(this.currentImageThumbTexture&&(delete this.currentImageThumbTexture.originalBaseTexture,this.currentImageThumbTexture.destroyGC(!0)),this.currentImageThumbImage&&(URL.revokeObjectURL(this.currentImageThumbImage),this.currentImageThumbImage=null),this.currentImageThumbTexture=n?e.renderClone():this.getPresetItemThumbTexture(e),e.originalBaseTexture&&!e.originalBaseTexture._destroyed&&(this.currentImageThumbTexture.originalBaseTexture=e.originalBaseTexture),BFN.Stage.extract.canvas(this.currentImageThumbTexture).toBlob(function(e){t.currentImageThumbImage=window.URL.createObjectURL(e),t.dispatchEvent(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED)},"image/jpeg",.9))},ai.prototype.getPresetItemThumbTexture=function(e){var t=BFN.Util.resizeTexture(e,4*this.presetItemThumbW,4*this.presetItemThumbH,!0);if(!t)return null;var n=BFN.Util.getThumbTexture(t,this.presetItemThumbW,!1);return t.destroyGC(!0),n},BFN.SingletonQueue.add(function(){BFN.PhotoEditorMenuModel=new ai}),BFN.PhotoEditorCanvasModelEvents={VIEWSTATE_UPDATED:new Event("VIEWSTATE_UPDATED"),CANVAS_SCALE_UPDATED:new Event("CANVAS_SCALE_UPDATED"),CANVAS_SCALING_UPDATED:new Event("CANVAS_SCALING_UPDATED"),ITEM_ADDED:new Event("ITEM_ADDED"),FIT_IMAGE_TO_FRAME:new Event("FIT_IMAGE_TO_FRAME"),FIT_IMAGE_TO_FRAME_ANIMATED:new Event("FIT_IMAGE_TO_FRAME_ANIMATED"),OFFSET_ITEMS:new Event("OFFSET_ITEMS"),FLATTEN_ITEMS:new Event("FLATTEN_ITEMS"),CLEAR_ITEMS:new Event("CLEAR_ITEMS"),ITEMS_UPDATED:new Event("ITEMS_UPDATED")},si.prototype=Object.create(BFN.EventDispatcher.prototype),si.prototype.init=function(){BeFunky.log("PhotoEditorCanvasModel Init"),this.initDefaultValues(),this.initContextMenu()},si.prototype.initDefaultValues=function(){this.usePixelGrid=!1,this._viewState=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,this._canvasScale=1,this._canvasScaling=!1,this._addedItem=null,this._itemOffsetPoint=null,this._itemsExist=!1,this.minCanvasScale=1,this.maxCanvasScale=this.usePixelGrid?16:4,this.imageFitPaddingX=40,this.imageFitPaddingY=60,this.disregardScaleRange=!1,BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewstateUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED.type,this.handleCurrentImageUpdated.bind(this))},si.prototype.initContextMenu=function(){this.contextMenu=document.getElementById("context_menu_photo_editor"),BeFunky.contextMenu(this.contextMenu,{open_from_computer:{onClick:function(){document.getElementById("open_project_computer").click()},hasDivider:!0},undo:{onClick:function(){UIHistory.undoButton.click()}},redo:{onClick:function(){UIHistory.redoButton.click()}},reset:{onClick:function(){UIHistory.resetButton.click()},hasDivider:!0},save_to_image_manager:{onClick:function(){UIToggler.toggleLoadScreen(!0,{isCancellable:!1});var e=BFN.PhotoEditorCanvas.getFlattenedImage();BFN.ImageLibraryManager.createMenuImageVOFromTexture(e,function(){UITools.setToolValue("editor_main","image_manager",!0),UITools.applyTool("editor_main"),UITools.setToolValue("editor_main","image_manager",!1),UIToggler.toggleLoadScreen(!1)})}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},si.prototype.handleEditorFlatten=function(){var e,t=this;UITools.getToolValue("editor_flatten","flatten_layers")&&(BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer.hasText()?(e=function(){t.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FLATTEN_ITEMS)},BFN.SettingsManager.getSetting("dismissed_messages").then(function(t){if(t.includes("flatten_layers_warning"))return e();var n=BeFunky.lit,i=n.elem,r=n.lang;BeFunky.acknowledge(i(oi(),r("flatten_layers_warning"),r("learn_more")),{onAcknowledge:e}),BFN.SettingsManager.updateSetting("dismissed_messages",[].concat(v(t),["flatten_layers_warning"]))})):this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FLATTEN_ITEMS))},si.prototype.handleEditorOverlay=function(){var e=UITools.getToolVO("editor_overlay");BFN.OverlaysManager.setupCategoryItems(e.updating_id)},si.prototype.handleUpdateTool=function(e){if(BFN.toolViewstates.hasOwnProperty(e)){var t=BFN.toolViewstates[e],n=null,i=null;switch(e){case"editor_edit":case"editor_touch_up":case"editor_frame":n=(i=UITools.getToolVO(e)).updating_id,BFN.toolViewstates.hasOwnProperty(n)&&(t=BFN.toolViewstates[n])}if("editor_edit"==e&&n&&t==BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT&&(i=UITools.getToolVO(n))&&i.hasOwnProperty("defaultValues")){for(var r in i.defaultValues)i.hasOwnProperty(r)&&UITools.setToolValue(n,r,i.defaultValues[r],!1);UITools.updateToolControls(n)}this.viewState!=t&&(console.log("SET VIEWSTATE : ".concat(t)),this.viewState=t),n&&UITools.applyTool(n)}},si.prototype.exitCurrentEditorTool=function(){BFN.PhotoEditorCanvasModel.viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&(UITools.setToolValue("editor_apply_cancel","cancel",!0),UITools.applyTool("editor_apply_cancel"),UITools.setToolValue("editor_apply_cancel","cancel",!1))},si.prototype.handleAppModelViewstateUpdated=function(e){this.itemsExist=this.itemsExist},si.prototype.handleCurrentImageUpdated=function(e){BFN.ZoomManager.updateZoomRange()},Object.defineProperty(si.prototype,"viewState",{set:function(e){if(this._viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)switch(this._viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP:case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:BFN.EffectManager.reset()}this._viewState=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()},get:function(){return this._viewState}}),Object.defineProperty(si.prototype,"canvasScale",{set:function(e){this._canvasScale=this.disregardScaleRange?e:Math.max(this.minCanvasScale,Math.min(this.maxCanvasScale,e)),this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED);var t=UITools.getToolVO("zoom");t.updating&&"amount"==t.updating_id||(UITools.setToolValue("zoom","amount",100*this._canvasScale),UITools.updateToolControls("zoom"))},get:function(){return this._canvasScale}}),Object.defineProperty(si.prototype,"canvasScaling",{set:function(e){this._canvasScaling=e,BFN.smoothPictureDisabled=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED)},get:function(){return this._canvasScaling}}),Object.defineProperty(si.prototype,"addedItem",{set:function(e){this._addedItem=e,this._addedItem&&this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.ITEM_ADDED)},get:function(){return this._addedItem}}),Object.defineProperty(si.prototype,"itemOffsetPoint",{set:function(e){this._itemOffsetPoint=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.OFFSET_ITEMS),this._itemOffsetPoint=null},get:function(){return this._itemOffsetPoint}}),Object.defineProperty(si.prototype,"itemsExist",{set:function(e){this._itemsExist=e,this.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.ITEMS_UPDATED)},get:function(){return this._itemsExist}}),BFN.SingletonQueue.add(function(){BFN.PhotoEditorCanvasModel=new si}),BFN.CollageMakerModelEvents={PROJECT_UPDATED:new Event("PROJECT_UPDATED")};var li=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("CollageMakerModel Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this._projectVO=new BFN.ProjectVO,this._projectVO.version=2,this._projectVO.section="collage",this._projectVO._wasReset=!0,this.updateProjectVO=BeFunky.debounce(this.updateProjectVO.bind(this),10),this.hasUnsavedChanges=!1,BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,function(){BFN.AppModel.viewingCollage&&BFN.GlobalHistoryModel.globalHistoryVOs.length>1&&(e.hasUnsavedChanges=!0,delete e.projectVO._wasReset)})}},{key:"updateProjectVO",value:function(){this._projectVO.projectWidth=BFN.CollageMakerCanvasPhotoGrid.gridWidth,this._projectVO.projectHeight=BFN.CollageMakerCanvasPhotoGrid.gridHeight,this._projectVO.collageFreeform=BFN.CollageMakerCanvasPhotoGridModel.freeform,this._projectVO.collageBackgroundColor=BFN.CollageMakerCanvasBackground.color,this._projectVO.collageBackgroundPatternBase64=BFN.CollageMakerCanvasPhotoGridModel.backgroundPatternBase64,this._projectVO.collageGridWidth=BFN.PhotoGrid.itemWidth,this._projectVO.collageGridHeight=BFN.PhotoGrid.itemHeight,this._projectVO.collageRounding=100*BFN.PhotoGrid.rounding,this._projectVO.collageGap=100*BFN.PhotoGrid.gap,BFN.ProjectManager.updateProjectVOItems(this,BFN.CollageMakerCanvas.transformLayer),this._projectVO.transformGroups=BFN.GroupManager.getSectionGroupObjects("collage",!0),this._projectVO.collageGridChildren.splice(0);for(var e=0;e<BFN.PhotoGrid.gridChildren.length;e++){var t=BFN.PhotoGrid.gridChildren[e];t.updateRect(),t.updateProjectItemVO();var n=t.projectItemVO,i=t.childContent.image.frameSprite.texture.baseTexture.fabricShape?"svg":"image",r=this._projectVO["".concat(i,"DataKeys")];n.gridCellImageID&&(r.includes(n.gridCellImageID)||(r.push(n.gridCellImageID),BFN.ProjectService.setLocalAsset("collage",i,n.gridCellImageID,void 0,!0))),this._projectVO.collageGridChildren.push(n)}BFN.ProjectManager.requestLocalSave({sectionID:"collage"})}},{key:"projectVO",set:function(e){this._projectVO=e,this.dispatchEvent(BFN.CollageMakerModelEvents.PROJECT_UPDATED)},get:function(){return this._projectVO}}]),n}();BFN.SingletonQueue.add(function(){BFN.CollageMakerModel=new li}),BFN.CollageMakerCanvasModelEvents={CANVAS_SCALE_UPDATED:new Event("CANVAS_SCALE_UPDATED"),CANVAS_SCALING_UPDATED:new Event("CANVAS_SCALING_UPDATED"),ITEM_ADDED:new Event("ITEM_ADDED"),FIT_COLLAGE_TO_FRAME:new Event("FIT_COLLAGE_TO_FRAME"),FIT_COLLAGE_TO_FRAME_ANIMATED:new Event("FIT_COLLAGE_TO_FRAME_ANIMATED"),CLEAR_ITEMS:new Event("CLEAR_ITEMS"),ITEMS_UPDATED:new Event("ITEMS_UPDATED")};var ui=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("CollageMakerCanvasModel Init"),this.initDefaultValues(),this.initContextMenu()}},{key:"initDefaultValues",value:function(){this._canvasScale=1,this._canvasScaling=!1,this._addedItem=null,this._itemsExist=!1,this.minCanvasScale=1,this.maxCanvasScale=1.5,this.collageFitPaddingX=60,this.collageFitPaddingY=60,this.disregardScaleRange=!1}},{key:"initContextMenu",value:function(){this.contextMenu=document.getElementById("context_menu_collage_maker"),BeFunky.contextMenu(this.contextMenu,{undo:{onClick:function(){UIHistory.undoButton.click()}},redo:{onClick:function(){UIHistory.redoButton.click()}},reset:{onClick:function(){UIHistory.resetButton.click()},hasDivider:!0},save_to_image_manager:{onClick:function(){UIToggler.toggleLoadScreen(!0,{isCancellable:!1});var e=BFN.CollageMakerCanvas.getFlattenedImage();BFN.ImageLibraryManager.createMenuImageVOFromTexture(e,function(){UITools.setToolValue("collage_main","image_manager",!0),UITools.applyTool("collage_main"),UITools.setToolValue("collage_main","image_manager",!1),UIToggler.toggleLoadScreen(!1)})}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")}},{key:"handleCollageLayoutsCustom",value:function(){switch(UITools.getToolVO("collage_layouts_custom").updating_id){case"collage_wizard":BFN.CollageWizardModal.open();try{BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD")}catch(e){}break;case"create_your_own":BFN.CollageMakerTemplateModel.dispatchEvent(BFN.CollageMakerTemplateModelEvents.FREEFORM);try{BFN.BfnService.track("CREATE","COLLAGE","CREATE_YOUR_OWN")}catch(e){}}}},{key:"canvasScale",set:function(e){this._canvasScale=this.disregardScaleRange?e:Math.max(this.minCanvasScale,Math.min(this.maxCanvasScale,e)),this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED);var t=UITools.getToolVO("zoom");t.updating&&"amount"===t.updating_id||(UITools.setToolValue("zoom","amount",100*this._canvasScale),UITools.updateToolControls("zoom"))},get:function(){return this._canvasScale}},{key:"canvasScaling",set:function(e){this._canvasScaling=e,BFN.smoothPictureDisabled=e,this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALING_UPDATED)},get:function(){return this._canvasScaling}},{key:"addedItem",set:function(e){this._addedItem=e,this._addedItem&&this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.ITEM_ADDED)},get:function(){return this._addedItem}},{key:"itemsExist",set:function(e){this._itemsExist=e,this.dispatchEvent(BFN.CollageMakerCanvasModelEvents.ITEMS_UPDATED)},get:function(){return this._itemsExist}}]),n}();BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvasModel=new ui}),BFN.CollageMakerCanvasPhotoGridModelEvents={FREEFORM_UPDATED:new Event("FREEFORM_UPDATED"),CORNER_ROUNDING_UPDATED:new Event("CORNER_ROUNDING_UPDATED"),ASPECT_LOCK_CHANGED:new Event("ASPECT_LOCK_CHANGED"),MANUAL_GRID_RESIZE:new Event("MANUAL_GRID_RESIZE"),COLLAGE_SETTINGS_UPDATED:new Event("COLLAGE_SETTINGS_UPDATED"),GRID_SIZE_CHANGED:new Event("GRID_SIZE_CHANGED"),CLEAR_ALL:new Event("CLEAR_ALL"),AUTO_COLLAGE_LAYOUT_OBJECT:new Event("AUTO_COLLAGE_LAYOUT_OBJECT")};var ci=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).init(),r}return a(n,[{key:"init",value:function(){BeFunky.log("CollageMakerCanvasPhotoGridModel Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this._freeform=!1,this._cornerRounding=0,this._collageSettings=null,this._autoCollageLayoutObject=null,this._backgroundPatternTexture=null,this._backgroundPatternBase64=null}},{key:"freeform",set:function(e){this._freeform!==e&&(this._freeform=e,this._freeform,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.FREEFORM_UPDATED))},get:function(){return this._freeform}},{key:"cornerRounding",set:function(e){this._cornerRounding=e,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.CORNER_ROUNDING_UPDATED)},get:function(){return this._cornerRounding}},{key:"collageSettings",set:function(e){this._collageSettings=e},get:function(){return this._collageSettings}},{key:"autoCollageLayoutObject",set:function(e){this._autoCollageLayoutObject=e,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.AUTO_COLLAGE_LAYOUT_OBJECT),this._autoCollageLayoutObject=null},get:function(){return this._autoCollageLayoutObject}},{key:"backgroundPatternTexture",set:function(e){var t=this;if(this._backgroundPatternTexture=e,this._backgroundPatternTexture){var n=this._backgroundPatternTexture.renderClone();BFN.Util.getHTMLImage(n,function(e){t._backgroundPatternBase64=e.src,n.destroyGC(!0),BFN.CollageMakerModel.updateProjectVO()})}else this._backgroundPatternBase64=null,BFN.CollageMakerModel.updateProjectVO()},get:function(){return this._backgroundPatternTexture}},{key:"backgroundPatternBase64",get:function(){return this._backgroundPatternBase64}}]),n}();BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvasPhotoGridModel=new ci}),BFN.CollageMakerTemplateModelEvents={CURRENT_TEMPLATE_UPDATED:new Event("CURRENT_TEMPLATE_UPDATED"),FREEFORM:new Event("FREEFORM")};var hi=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("CollageMakerTemplateModel Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.freeformWidth=2400,this.freeformHeight=1800,this._currentTemplate=null}},{key:"currentTemplate",set:function(e){this._currentTemplate=e,this.dispatchEvent(BFN.CollageMakerTemplateModelEvents.CURRENT_TEMPLATE_UPDATED)},get:function(){return this._currentTemplate}}]),n}();BFN.SingletonQueue.add(function(){BFN.CollageMakerTemplateModel=new hi}),BFN.DesignerModelEvents={PROJECT_UPDATED:new Event("PROJECT_UPDATED")};var di=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("DesignerModel Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this._projectVO=new BFN.ProjectVO,this._projectVO.version=2,this._projectVO.section="designer",this.updateProjectVO=BeFunky.debounce(this.updateProjectVO.bind(this),10),this.hasUnsavedChanges=!1,BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,function(){BFN.AppModel.viewingDesigner&&BFN.GlobalHistoryModel.globalHistoryVOs.length>1&&(e.hasUnsavedChanges=!0,delete e.projectVO._wasReset)})}},{key:"loadBlankProject",value:function(){var e=new BFN.ProjectVO;e.version=2,e.section="designer",e.projectWidth=this.projectVO.projectWidth||2550,e.projectHeight=this.projectVO.projectHeight||3300,e.designerBackgroundColor="FFFFFF";var t=BFN.DesignerTemplateManager.parseDimensions([e.projectWidth,e.projectHeight]);e.printDPI=t?t.dpi:300,e._wasReset=!0,BFN.ProjectManager.loadProject(e)}},{key:"updateProjectVO",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._projectVO.projectWidth=BFN.DesignerCanvas.canvasWidth,this._projectVO.projectHeight=BFN.DesignerCanvas.canvasHeight,this._projectVO.designerBackgroundColor=BFN.DesignerCanvasBackground.color,e&&BFN.ProjectManager.updateProjectVOItems(this,BFN.DesignerCanvas.transformLayer),this._projectVO.transformGroups=BFN.GroupManager.getSectionGroupObjects("designer",!0),BFN.ProjectManager.requestLocalSave({sectionID:"designer"})}},{key:"projectVO",set:function(e){this._projectVO=e,this.dispatchEvent(BFN.DesignerModelEvents.PROJECT_UPDATED)},get:function(){return this._projectVO}}]),n}();function mi(){BFN.EventDispatcher.call(this),this.init()}function pi(){var e=g(["<li>","</li>"]);return pi=function(){return e},e}function gi(){var e=g(["\n        <div>\n            <p>","</p>\n            <ul>\n            ","\n            </ul>\n        </div>\n        "]);return gi=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.DesignerModel=new di}),BFN.DesignerCanvasModelEvents={CANVAS_SCALE_UPDATED:new Event("CANVAS_SCALE_UPDATED"),CANVAS_SCALING_UPDATED:new Event("CANVAS_SCALING_UPDATED"),ITEM_ADDED:new Event("ITEM_ADDED"),FIT_DESIGNER_TO_FRAME:new Event("FIT_DESIGNER_TO_FRAME"),FIT_DESIGNER_TO_FRAME_ANIMATED:new Event("FIT_DESIGNER_TO_FRAME_ANIMATED"),CLEAR_ITEMS:new Event("CLEAR_ITEMS"),ITEMS_UPDATED:new Event("ITEMS_UPDATED"),DESIGNER_SETTINGS_UPDATED:new Event("DESIGNER_SETTINGS_UPDATED")},mi.prototype=Object.create(BFN.EventDispatcher.prototype),mi.prototype.init=function(){BeFunky.log("DesignerCanvasModel Init"),this.initDefaultValues(),this.initContextMenu()},mi.prototype.initDefaultValues=function(){this._canvasScale=1,this._canvasScaling=!1,this._addedItem=null,this._itemsExist=!1,this.minCanvasScale=1,this.maxCanvasScale=4,this.designerFitPaddingX=60,this.designerFitPaddingY=60,this.disregardScaleRange=!1},mi.prototype.initContextMenu=function(){this.contextMenu=document.getElementById("context_menu_designer"),BeFunky.contextMenu(this.contextMenu,{undo:{onClick:function(){UIHistory.undoButton.click()}},redo:{onClick:function(){UIHistory.redoButton.click()}},reset:{onClick:function(){UIHistory.resetButton.click()},hasDivider:!0},save_to_image_manager:{onClick:function(){UIToggler.toggleLoadScreen(!0,{isCancellable:!1});var e=BFN.DesignerCanvas.getFlattenedImage();BFN.ImageLibraryManager.createMenuImageVOFromTexture(e,function(){UITools.setToolValue("designer_main","image_manager",!0),UITools.applyTool("designer_main"),UITools.setToolValue("designer_main","image_manager",!1),UIToggler.toggleLoadScreen(!1)})}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},Object.defineProperty(mi.prototype,"canvasScale",{set:function(e){this._canvasScale=this.disregardScaleRange?e:Math.max(this.minCanvasScale,Math.min(this.maxCanvasScale,e)),this.dispatchEvent(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED);var t=UITools.getToolVO("zoom");t.updating&&"amount"==t.updating_id||(UITools.setToolValue("zoom","amount",100*this._canvasScale),UITools.updateToolControls("zoom"))},get:function(){return this._canvasScale}}),Object.defineProperty(mi.prototype,"canvasScaling",{set:function(e){this._canvasScaling=e,BFN.smoothPictureDisabled=e,this.dispatchEvent(BFN.DesignerCanvasModelEvents.CANVAS_SCALING_UPDATED)},get:function(){return this._canvasScaling}}),Object.defineProperty(mi.prototype,"addedItem",{set:function(e){this._addedItem=e,this._addedItem&&this.dispatchEvent(BFN.DesignerCanvasModelEvents.ITEM_ADDED)},get:function(){return this._addedItem}}),Object.defineProperty(mi.prototype,"itemsExist",{set:function(e){this._itemsExist=e,this.dispatchEvent(BFN.DesignerCanvasModelEvents.ITEMS_UPDATED)},get:function(){return this._itemsExist}}),Object.defineProperty(mi.prototype,"designerSettings",{set:function(e){this._designerSettings=e},get:function(){return this._designerSettings}}),BFN.SingletonQueue.add(function(){BFN.DesignerCanvasModel=new mi});var fi=function(){function t(){i(this,t),this.initDefaultValues(),this.initFileUploadInput()}return a(t,[{key:"initDefaultValues",value:function(){this.uploadQueue=[],this.uploadInput=null,this.thumbSize=BFN.CSS.imageManagerThumbSize*(BeFunky.isRetina()?1.5:1),this.supportedImages=["jpg","jpeg","png","gif","bmp","svg"],(BeFunky.isChromium||BeFunky.firefoxVersion>=65||BeFunky.safariVersion>=14)&&this.supportedImages.push("webp"),(BeFunky.isSafari||BeFunky.isEdgeHTML)&&this.supportedImages.push("tif","tiff"),this.accept={images:!BeFunky.isSafari||"sendBeacon"in navigator?this.supportedImages.map(function(e){return".".concat(e)}).join(", "):"image/*",bfd:".bfd",svg:".svg",imagesAndBFD:this.supportedImages.concat("bfd").map(function(e){return".".concat(e)}).join(", "),imagesExceptSVG:this.supportedImages.filter(function(e){return"svg"!==e}).map(function(e){return".".concat(e)}).join(", "),all:"",fonts:B.map(function(e){return e.extension}).map(function(e){return".".concat(e)}).join(", ")},this.transparentImages=["png","gif","svg","webp"],this.currentCallback=null,this.currentOptions=null,this.currentFailedImageUploads=[],this.progressIndex=0,this.progressTotal=0}},{key:"initFileUploadInput",value:function(){var e=this,t="file_upload_input",n='<input id="'.concat(t,'" type="file" style="display: none;">');BFN.appContainer.insertAdjacentHTML("beforeend",n),this.uploadInput=document.getElementById(t),this.uploadInput.addEventListener("change",function(t){return e.handleUpload(v(t.target.files))})}},{key:"upload",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.allowMultiple,r=void 0===i||i,a=n.fileType,o=void 0===a?"images":a,s=n.createMenuImageVO,l=void 0===s||s,u=n.saveInIndexedDB,c=n.files,h=void 0===c?[]:c,d=n.keepImageTexture,m=void 0!==d&&d,p=n.keepThumbTexture,g=void 0!==p&&p,f=n.thumbnailLongestSide,v=n.onBeforeUpload;if("bfd"===o&&(l=!1),Object.keys(this.accept).includes(o)||(BeFunky.throwError("Invalid fileType passed to MultipleFileUploader"),o="images"),"boolean"!=typeof u&&(u=l),this.currentCallback=t,this.currentOptions={createMenuImageVO:l,keepImageTexture:m,fileType:o,saveInIndexedDB:u,thumbnailLongestSide:f,keepThumbTexture:g,onBeforeUpload:v},this.currentFailedImageUploads=[],h.length)return this.handleUpload(h);try{this.uploadInput.multiple=r}catch(t){throw BeFunky.logError('Unable to set "multiple" property on file upload input'),BeFunky.logError("this.uploadInput",e(this.uploadInput),this.uploadInput),t}this.uploadInput.accept=this.accept[o],this.uploadInput.click()}},{key:"processNextFile",value:function(e){var t=this,n=this.uploadQueue.shift(),i=/^image\/+/.test(n.type),r=/^image\/svg\+xml/.test(n.type)||"svg"===n.name.split(".").pop().toLowerCase(),a=function(i){var r=i?{file:n,menuImageVO:i,isComplete:!1}:{file:n,isComplete:!1};t.progressTotal&&(t.progressIndex++,t.showLoadScreen("uploading","".concat(t.progressIndex," / ").concat(t.progressTotal))),t.uploadQueue.length?(e(r),t.processNextFile(e)):(UIToggler.toggleLoadScreen(!1),e(r),t.uploadProcessingComplete(e))};return this.currentOptions.createMenuImageVO?i?"imagesExceptSVG"===this.currentOptions.fileType&&r?(BeFunky.logError("Uploaded file is an SVG, but SVGs are not supported by this feature",n),this.currentFailedImageUploads.push({error:"SVGs are not supported by this feature",file:n}),a()):void this.createMenuImageVO(n,function(i){var r=i.error,o=i.menuImageVO;if(e===t.currentCallback)return r?(BeFunky.logError("Unable to create MenuImageVO for uploaded image",n,r),t.currentFailedImageUploads.push({error:r,file:n}),a()):a(o)},this.currentOptions):(BeFunky.logError('Uploaded file does not have an "image/*" mimetype',n),this.currentFailedImageUploads.push({error:"Not an image",file:n}),a()):a()}},{key:"uploadProcessingComplete",value:function(e){this.uploadQueue=[],this.acknowledgeInvalidImageFiles(this.currentFailedImageUploads),e({isComplete:!0})}},{key:"createMenuImageVO",value:function(e,t,n){var i=this,r=n.keepImageTexture,a=void 0!==r&&r,o=n.saveInIndexedDB,s=void 0===o||o,l=n.thumbnailLongestSide,u=n.keepThumbTexture,c=new BFN.MenuImageVO;c.createId("computer"),l=parseInt(l)||-1,c.name=e.name.replace(/\.[^/.]+$/,"");var h=BFN.getExtension(e.name),d=this.transparentImages.includes(h);if(c.extension=h,"svg"===h)return c.isSVG=!0,c.isTransparent=!0,BFN.BlobUtils.blobToText(e,function(e){var n=e.error,r=e.text;if(n)return t({error:n});var o=BFN.SVGManager.sanitizeSVG(r);if(!o)return t({error:"Unable to parse SVG"});var s=o.length>1e5;if(!s&&(c.thumbURL=BFN.SVGManager.createDataURI(o),!a))return p(o);BFN.TextureUtils.svgStringToTexture(o,function(e){var n=e.error,r=e.texture;if(n)return t({error:n});if(s){var l=r.width/r.height,u=Math.round(i.thumbSize*(l>1?l:1/l)),h=BFN.Util.getThumbTexture(r,u,!1);c.thumbURL=BFN.TextureUtils.textureToBase64(h),c.thumbWidth=h.width,c.thumbHeight=h.height,h.destroyGC(!0)}a?c.imageTexture=r:r.destroyGC(!0),p(o)})});var m={};function p(e){s?(c.indexedDBKey="svg__".concat(c.id),BFN.IndexedDB.set(c.indexedDBKey,e).then(function(){return t({menuImageVO:c})},function(e){BeFunky.logError("Unable to store SVG string in IndexedDB",e),t({error:e})})):BeFunky.isEdgeHTML?setTimeout(function(){t({menuImageVO:c})},0):t({menuImageVO:c})}a||(m.textureSize=l>0?l:4*this.thumbSize),BFN.TextureUtils.blobOrBase64ToTexture(e,function(n){var r=n.error,o=n.texture,h=n.imageWidth,m=n.imageHeight;if(r)return t({error:r});c.imageWidth=h,c.imageHeight=m;var p=o.width/o.height,g=l>0?l:Math.round(i.thumbSize*(p>1?p:1/p)),f=BFN.Util.getThumbTexture(o,g,!1),v=!!d&&BFN.Util.isTransparent(f);c.thumbURL=BFN.TextureUtils.textureToBase64(f,{isTransparent:v}),c.thumbWidth=f.width,c.thumbHeight=f.height,c.isTransparent=v,u?c.thumbTexture=f:f.destroyGC(!0),a?c.imageTexture=o:o.destroyGC(!0),function(){if(!s)return void(BeFunky.isEdgeHTML?setTimeout(function(){t({menuImageVO:c})},0):t({menuImageVO:c}));c.indexedDBKey="image__".concat(c.id),BFN.IndexedDB.set(c.indexedDBKey,e).then(function(){return t({menuImageVO:c})},function(n){BeFunky.logError('Unable to store blob "'.concat(e.name,'" in IndexedDB'),n),t({error:n})})}()},m)}},{key:"acknowledgeInvalidImageFiles",value:function(e){if(Array.isArray(e)&&e.length&&e.every(function(e){return e.error&&e.file})){var t=BeFunky.lit,n=t.elem,i=t.html,r=t.lang;BeFunky.acknowledge(n(gi(),r("error_invalid_image"),e.map(function(e){var t=e.file.name||"(unknown file name)",n="string"==typeof e.error?"- ".concat(e.error):"";return i(pi(),"".concat(t," ").concat(n))})))}}},{key:"showLoadScreen",value:function(e,t){var n=this;UIToggler.toggleLoadScreen(!0,{message:e,progress:t,showIris:!1,onCancel:function(){UIToggler.toggleLoadScreen(!1),n.uploadProcessingComplete(n.currentCallback)}})}},{key:"handleUpload",value:function(e){var t=this;if(!e.length)return this.uploadProcessingComplete(this.currentCallback);if("function"==typeof this.currentOptions.onBeforeUpload){var n=this.currentOptions.onBeforeUpload;return this.currentOptions.onBeforeUpload=void 0,n(e,this.handleUpload.bind(this))}this.progressIndex=1,this.progressTotal=e.length>1&&this.currentOptions.createMenuImageVO?e.length:0;var i=this.progressTotal?"".concat(BeFunky.LanguageManager.getString("uploading")," ").concat(this.progressIndex," / ").concat(this.progressTotal):"uploading";this.showLoadScreen(i),this.uploadQueue=e,setTimeout(function(){return t.processNextFile(t.currentCallback)},0),this.uploadInput.value=""}}]),t}();function vi(){var e=g(["<string>",'</string> <span class="dropdown__description text-xs">',"</span>"]);return vi=function(){return e},e}function yi(){var e=g(['\n                        <button\n                            @click="','"\n                            .optionValue="','"\n                            class="'," ",'">\n                            ',"\n                        </button>\n                        "]);return yi=function(){return e},e}function xi(){var e=g(['<span class="dropdown__list-header text-sm bold">',"</span>"]);return xi=function(){return e},e}function _i(){var e=g(['\n            <div class="dropdown__list" style="','">\n                ',"\n            </div>\n        "]);return _i=function(){return e},e}function Ii(){var e=g(['<label class="control-item-label">',"</label>"]);return Ii=function(){return e},e}function Ti(){var e=g(["\n            ","\n             <button class="," @focus="," @blur=",' @click="','">\n                <string class="dropdown__selection">',"</string>\n                ","\n             </button>\n             ","\n        "]);return Ti=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.MultipleFileUploader=new fi});var bi=BeFunky.lit,Si=bi.html,Ci=bi.setupState,Bi=bi.render,Fi=bi.lang,Ei=bi.icon;function Pi(e,t){var n=t.onChange,i=t.initialOptions,r=void 0===i?[]:i,a=t.label,o=t.defaultValue,s=t.dropdownMaxHeight,l=t.translateOptionNames,u=void 0===l||l,c=t.isTemplateDropdown,h=void 0!==c&&c;e.addClass("dropdown");var d,m,p={isOpen:!1,isMixed:!1,selectedValue:function(){if(r&&r.length)return r.some(function(e){var t=e.value;return t===o})?o:r[0].value}(),options:r,listStyles:""},g=BeFunky.once(function(){d=e.querySelector(".dropdown__box"),m=e.querySelector(".dropdown__list"),t=0,n=0,m.addEventListener("wheel",function(e){e.deltaY<0?m.scrollTop<=0&&e.preventDefault():(t=t||m.getBoundingClientRect().height,n=n||m.scrollHeight,m.scrollTop+t>=n&&e.preventDefault())});var t,n}),v=BeFunky.debounce(function(){var t;Bi(Si(Ti(),"string"==typeof a?Si(Ii(),Fi(a)):"","dropdown__box button button--white-outline button--has-icon button--fullwidth ".concat(x.isOpen?"button--selected":""),C,B,S,function(){if(x.isMixed)return"—";var e=x.options.find(function(e){return e.value===x.selectedValue});return e?b(e):""}(),Ei("chevron-icon","icon icon--chevron-down"),(t=["button","button--fullwidth button--ellipsis dropdown__item",h?"button--grey-200":"button--transparent"].filter(Boolean).join(" "),Si(_i(),x.listStyles,x.options.map(function(e){return e.isHeader?Si(xi(),Fi(e.name)):Si(yi(),(i=e,function(){_({selectedValue:i.value,isMixed:!1,isOpen:!1}),setTimeout(function(){return d.focus()},100),n(i.value)}),e.value,t,e.value!==x.selectedValue||x.isMixed?"":"button--selected",b(e));var i})))),e),g()},"raf"),y=f(Ci(p,function(e){e.isOpen&&(x.isOpen?(BeFunky.addArrowKeyHandler({callback:F,condition:I}),document.addEventListener("click",E,!0)):(BeFunky.removeArrowKeyHandler({callback:F,condition:I}),document.removeEventListener("click",E,!0))),v()}),2),x=y[0],_=y[1],I=function(e){return e.hasClass("dropdown__item")&&e.parentElement===m},T=function(e){return e===d};return BeFunky.LanguageManager.addLanguageUpdateListener(v),Object.defineProperty(e,"selectedValue",{set:function(t){if(t!==x.selectedValue||x.isMixed){var n=x.options.find(function(e){var n=e.value;return n===t});n?_({selectedValue:t,isMixed:!1}):BeFunky.throwError("Invalid selectedValue set for dropdown_item #".concat(e.id),{_value:t})}},get:function(){return x.selectedValue}}),Object.assign(e,{setState:_}),e;function b(e){return e.name&&e.description?Si(vi(),e.name,e.description):u&&"string"==typeof e.name?Fi(e.name):e.name}function S(){!function(){var t=e.closestParent(function(t){return t!==e&&["hidden","auto","scroll"].includes(getComputedStyle(t).overflowY)}).getBoundingClientRect(),n=d.getBoundingClientRect(),i=t.bottom-n.bottom,r=n.top-t.top,a=32*Math.min(4,x.options.length),o=s||32*Math.min(5,x.options.length);if(i>=a){var l=Math.min(o,i);return void _({listStyles:"height: ".concat(l,"px;")})}var u=Math.min(o,r+n.height+i-16),c=8-i;u+c<n.height&&(c+=n.height-(u+c));_({listStyles:"top: auto; bottom: ".concat(c,"px; height: ").concat(u,"px;")})}(),x.isOpen?_({isOpen:!1}):(_({isOpen:!0}),P())}function C(){BeFunky.addArrowKeyHandler({callback:F,condition:T})}function B(){BeFunky.removeArrowKeyHandler({callback:F,condition:T})}function F(e,t,i){if("keydown"!==i.type&&"left"!==t&&"right"!==t){var r,a=e.hasClass("dropdown__item"),o=[void 0,null];if(a)r=e.optionValue;else if(r=x.selectedValue,o.includes(r))return void _({isOpen:!0,selectedValue:x.options[0].value,isMixed:!1});var s=x.options.findIndex(function(e){return e.value===r});if(-1!==s){for(var l="up"===t?-1:1,u=s+l;x.options[u]&&o.includes(x.options[u].value);)u+=l;if(o.includes(x.options[u]))return _({isOpen:!0,isMixed:!1}),void P();_({isOpen:!1,selectedValue:x.options[u].value,isMixed:!1}),n(x.options[u].value),a&&setTimeout(function(){return d.focus()},100)}}}function E(e){d.contains(e.target)||m.contains(e.target)||_({isOpen:!1})}function P(){setTimeout(function(){var t=e.querySelector(".dropdown__item--selected");t&&t.focus()},100)}}window.UIToolsEvents={UPDATE_TOOL:new Event("UPDATE_TOOL"),UPDATE_TOOL_CONTROL:new Event("UPDATE_TOOL_CONTROL"),UPDATE_TOOL_CONTROLS:new Event("UPDATE_TOOL_CONTROLS"),TOOL_PARAM_UPDATED:new Event("TOOL_PARAM_UPDATED")};var ki=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("UITools Init"),this.initDefaultValues(),this.initUIToolVOs(),this.initToolVOs(BFN.EffectData),this.initToolVOs(BFN.ArtsyData),this.initToolVOs(BFN.TextureData),this.initToolVOs(BFN.LensFlareData.menuData),this.initToolVOs(BFN.FrameData.crop_rotate),this.initToolVOs(BFN.FrameData.crop),this.initToolVOs(BFN.FrameData.full)}},{key:"initDefaultValues",value:function(){this.toolVOs={},this.toolControlIDs={},this.controlToolIDs={},this.controlParamObjects={},this.toolPlusHash={},this.printToolVOs=!1,this.lastClickTime=0}},{key:"initUIToolVOs",value:function(){for(var e in BFN.UIToolData){var t=this.createToolVO(e),n=BFN.UIToolData[e];if(n.hasOwnProperty("controls")){var i=n.controls;for(var r in i){var a=i[r],o=r.replace("".concat(e,"_"),""),s=a.type;this.toolControlIDs[e].push(r),this.controlToolIDs[r]=e,this.controlParamObjects[r]=a;var l=!!a.hasOwnProperty("defaultValue")&&a.defaultValue;switch(this.setToolValue(e,o,l),s){case"color":case"color_item":case"color_palette":case"color_group":a.hasOwnProperty("intensityEnabled")&&a.intensityEnabled&&this.setToolValue(e,"".concat(o,"_intensity"),1),"color_group"===s&&(this.setToolValue(e,"".concat(o,"_index"),0),this.setToolValue(e,"".concat(o,"_group_id"),0))}t.defaultValues[o]=l}}this.toolPlusHash[e]=!!n.hasOwnProperty("isPlus")&&n.isPlus}}},{key:"initToolVOs",value:function(e){for(var t=0;t<e.length;t++)for(var n=e[t],i=0;i<n.presets.length;i++){var r=n.presets[i],a="".concat(n.id,"_").concat(r.id);this.toolPlusHash[a]=!!r.hasOwnProperty("isPlus")&&r.isPlus;for(var o=this.createToolVO(a),s=0;s<r.params.length;s++){var l=r.params[s],u=l.name,c="".concat(a,"_").concat(u),h=l.type;this.toolControlIDs[a].push(c),this.controlToolIDs[c]=a,this.controlParamObjects[c]=l;var d=!!l.hasOwnProperty("defaultValue")&&l.defaultValue;switch(this.setToolValue(a,l.name,d),h){case"color":case"color_item":case"color_palette":case"color_group":l.hasOwnProperty("intensityEnabled")&&l.intensityEnabled&&this.setToolValue(a,"".concat(l.name,"_intensity"),1),"color_group"===h&&(this.setToolValue(a,"".concat(l.name,"_index"),0),this.setToolValue(a,"".concat(l.name,"_group_id"),0))}o.defaultValues[u]=d}}}},{key:"createToolVO",value:function(e){return e?(this.toolVOs.hasOwnProperty(e)||(this.toolVOs[e]={toolID:e,updating:!1,updating_id:null,defaultValues:{}}),this.toolControlIDs.hasOwnProperty(e)||(this.toolControlIDs[e]=[]),this.toolVOs[e]):null}},{key:"removeToolVO",value:function(e){if(e&&(this.toolVOs.hasOwnProperty(e)&&delete this.toolVOs[e],this.toolControlIDs.hasOwnProperty(e))){for(var t=this.toolControlIDs[e],n=t.length;--n>-1;){var i=t[n];this.controlToolIDs.hasOwnProperty(i)&&delete this.controlToolIDs[i],this.controlParamObjects.hasOwnProperty(i)&&delete this.controlParamObjects[i]}delete this.toolControlIDs[e]}}},{key:"getToolVO",value:function(e){return e&&this.toolVOs.hasOwnProperty(e)?this.toolVOs[e]:null}},{key:"setToolValue",value:function(e,t,n,i){var r=this.createToolVO(e);r[t]=n,r.updating=i||!1,r.updating_id=t;var a=new Event(UIToolsEvents.TOOL_PARAM_UPDATED.type);a.data={toolID:e,paramID:t,value:n},this.dispatchEvent(a)}},{key:"getToolValue",value:function(e,t){if(this.toolVOs.hasOwnProperty(e)&&this.toolVOs[e].hasOwnProperty(t))return this.toolVOs[e][t]}},{key:"setControlValue",value:function(e,t,n){if(this.controlToolIDs.hasOwnProperty(e)){var i=this.controlToolIDs[e],r=e.replace("".concat(i,"_"),"");this.setToolValue(i,r,t,n)}}},{key:"getControlValue",value:function(e){if(this.controlToolIDs.hasOwnProperty(e)){var t=this.controlToolIDs[e],n=e.replace("".concat(t,"_"),"");return this.getToolValue(t,n)}}},{key:"getParamObject",value:function(e){return this.controlParamObjects.hasOwnProperty(e)?this.controlParamObjects[e]:null}},{key:"registerControl",value:function(e){if(this.controlParamObjects.hasOwnProperty(e)){var t=this.controlParamObjects[e];if(t.hasOwnProperty("type")){switch(t.type){case"button":this.registerButtonControl(e);break;case"slider":this.registerSliderControl(e);break;case"slider_item":this.registerSliderItemControl(e);break;case"scrubber":this.registerScrubberControl(e);break;case"color":this.registerColorControl(e);break;case"color_item":this.registerColorItemControl(e);break;case"color_palette":this.registerColorPaletteControl(e);break;case"color_group":this.registerColorGroupControl(e);break;case"radio":this.registerRadioControl(e);break;case"checkbox":this.registerCheckBoxControl(e);break;case"checkbox_item":this.registerCheckBoxItemControl(e);break;case"expandable_checkbox":this.registerExpandableCheckBoxControl(e);break;case"toggle_switch":this.registerToggleSwitchControl(e);break;case"dropdown_item":this.registerDropdownItemControl(e);break;case"textinput":this.registerTextInputControl(e);break;case"textarea":this.registerTextAreaControl(e);break;case"toggle_group":this.registerToggleGroupControl(e)}this.updateToolControl(e)}}else BeFunky.log("-- NO DATA ENTRY FOR ELEMENT WITH ID : ".concat(e))}},{key:"registerButtonControl",value:function(e){var t=this.controlParamObjects[e],n=document.getElementById(e);t&&t.hasOwnProperty("allowEvent")&&(n.allowEvent=t.allowEvent),t&&t.hasOwnProperty("interval")?(n.interval=t.interval,n.intervalDelay=t.hasOwnProperty("intervalDelay")?t.intervalDelay:t.interval,n.pressed=!1,n.pressMethod=function(e){this.pressed&&(null==e&&(e=this.interval),UITools.setControlValue(this.id,!0,!0),UITools.applyToolControl(this.id),UITools.setControlValue(this.id,!1,!1),setTimeout(this.pressMethod,e))}.bind(n),n.releaseMethod=function(){UITools.setToolValue("zoom","updating",!1,!1),UITools.applyToolControl(this.id),document.removeEventListener(BeFunky.pointerup,this.releaseMethod),this.pressed=!1}.bind(n),n.addEventListener(BeFunky.pointerdown,function(e){n.disabled||0===e.button&&(document.addEventListener(BeFunky.pointerup,this.releaseMethod),this.pressed=!0,this.pressMethod(this.intervalDelay),this.allowEvent||e.stopImmediatePropagation())}.bind(n))):n.addEventListener("click",function(e){t.preventDeselectOnDoubleClick&&(UITools.lastClickTime=Date.now()),UITools.setControlValue(this.id,!0),UITools.applyToolControl(this.id),UITools.setControlValue(this.id,!1),this.allowEvent||e.stopImmediatePropagation()}.bind(n))}},{key:"registerSliderControl",value:function(e,t){var n=this.getParamObject(e),i={start:n.defaultValue,step:n.step,behaviour:"snap",animationDuration:0,connect:[!0,!1],range:{min:n.min,max:n.max},pips:n.pips,keyboardPageMultiplier:10};var r=t||document.getElementById(e);return BFN.UI.slider(r,i,function(t,n){var i="end"!==t;UITools.setControlValue(e,Math.round(100*parseFloat(n))/100,i),UITools.applyToolControl(e)},n.enableStartEvent),r}},{key:"registerSliderItemControl",value:function(e,t){var n=this.controlToolIDs[e],i=e.replace("".concat(n,"_"),""),r=this.getParamObject(e),a=t||document.getElementById(e);return BFN.UI.sliderItem(a,{toolID:n,paramID:i,controlID:e,paramObject:r})}},{key:"registerScrubberControl",value:function(e){var t=this.getParamObject(e),n=document.getElementById(e);BFN.UI.scrubber(n,t),n.addEventListener("change",function(e){UITools.setControlValue(this.id,this.currentValue,this.updating),UITools.applyToolControl(this.id)}),t.hasOwnProperty("unit")&&(n.unit=t.unit),t.hasOwnProperty("min")&&t.min!==n.minValue&&(n.minValue=t.min),t.hasOwnProperty("max")&&t.max!==n.maxValue&&(n.maxValue=t.max),t.hasOwnProperty("defaultValue")&&t.defaultValue!==n.currentValue&&(n.currentValue=t.defaultValue),t.hasOwnProperty("maxLength")&&(n.maxLength=t.maxLength),t.hasOwnProperty("arrowsAffectInputValue")&&(n.arrowsAffectInputValue=t.arrowsAffectInputValue)}},{key:"registerColorControl",value:function(e){var t=this.getParamObject(e),n=document.getElementById(e),i=BFN.ColorPickerPanel;BFN.UI.colorButton(n),n.intensityEnabled=t.intensityEnabled||!1,n.emptyEnabled=!t.hasOwnProperty("emptyEnabled")||t.emptyEnabled,n.hueLocked=t.hueLocked||!1,n.borderEnabled=!0,n.fineChangeEnabled=t.fineChangeEnabled||!1,n.pickerName=t.hasOwnProperty("pickerName")?t.pickerName:t.hasOwnProperty("name")?t.name:null,n.addEventListener("click",function(){n.ignoreNextClick||(i.hasClass("active")?i.removeClass("active"):(i.colorButton=this,i.addClass("active")))}.bind(n)),n.addEventListener("change",function(){var e=UITools.controlToolIDs[this.id],t=this.id.replace("".concat(e,"_"),"");this.intensityEnabled&&UITools.setToolValue(e,"".concat(t,"_intensity"),this.intensity),UITools.setToolValue(e,t,this.hashColor),UITools.applyToolControl(this.id)}.bind(n)),n.fineChangeEnabled&&n.addEventListener("finechange",function(){var e=UITools.controlToolIDs[this.id],t=this.id.replace("".concat(e,"_"),"");this.intensityEnabled&&UITools.setToolValue(e,"".concat(t,"_intensity"),this.intensity),UITools.setToolValue(e,t,this.hashColor,!0),UITools.applyToolControl(this.id)}.bind(n))}},{key:"registerColorItemControl",value:function(e){var t=this.getParamObject(e);BFN.UI.colorItem(document.getElementById(e),{controlID:e,paramObject:t})}},{key:"registerColorPaletteControl",value:function(e){var t=this.getParamObject(e);BFN.UI.colorPalette(document.getElementById(e),{controlID:e,paramObject:t})}},{key:"registerColorGroupControl",value:function(e){var t=this.getParamObject(e);BFN.UI.colorGroup(document.getElementById(e),{controlID:e,paramObject:t})}},{key:"registerRadioControl",value:function(e){var t=document.getElementById(e),n=this.getParamObject(e);t.buttons=n.buttons,t.value=n.defaultValue,t.addEventListener("change",function(){UITools.setControlValue(e,t.value),UITools.applyToolControl(e)})}},{key:"registerToggleGroupControl",value:function(e){var t=document.getElementById(e);"TOGGLE-GROUP"!==t.nodeName&&BeFunky.logError("".concat(e," is not a <toggle-group>"));var n=this.getParamObject(e);t.buttons=n.buttons,t.value=n.defaultValue,t.addEventListener("change",function(){UITools.setControlValue(this.id,this.value),UITools.applyToolControl(this.id)})}},{key:"registerCheckBoxControl",value:function(e){var t=document.getElementById(e);t||console.log("Checkbox not found",e),t.activeElement=t.dataset.activeElement?document.getElementById(t.dataset.activeElement):null,t.inactiveElement=t.dataset.inactiveElement?document.getElementById(t.dataset.inactiveElement):null;var n=function(e){e.activeElement&&e.activeElement.setStyles({display:e.checked?"block":"none"}),e.inactiveElement&&e.inactiveElement.setStyles({display:e.checked?"none":"block"})};this.updateToolControl(e),n(t),t.addEventListener("change",function(){n(this),UITools.setControlValue(this.id,this.checked),UITools.applyToolControl(this.id)}.bind(t))}},{key:"registerToggleSwitchControl",value:function(e){var t=document.getElementById(e);this.updateToolControl(e),t.addEventListener("change",function(){UITools.setControlValue(this.id,this.checked),UITools.applyToolControl(this.id)}.bind(t))}},{key:"registerCheckBoxItemControl",value:function(e){var t=this.getParamObject(e);BFN.UI.checkboxItem(document.getElementById(e),{controlID:e,paramObject:t})}},{key:"registerExpandableCheckBoxControl",value:function(e){var t=document.getElementById(e);"EXPANDABLE-CHECKBOX"!==t.nodeName&&BeFunky.logError("".concat(e," is not an <expandable-checkbox>"));var n=this.getParamObject(e);t.checked=n.defaultValue?"on":"off",t.isOpen=!1,t.openWhenChecked=!1,t.addEventListener("change",function(){UITools.setControlValue(this.id,"on"===this.checked),UITools.applyToolControl(this.id)})}},{key:"registerDropdownItemControl",value:function(e){var t=this.getParamObject(e),n=document.getElementById(e);Pi(n,{initialOptions:t.data,label:!1===t.useLabel?void 0:t.name,defaultValue:t.defaultValue,onChange:function(t){UITools.setControlValue(e,t),UITools.applyToolControl(e)}});var i=n.selectedValue;this.setControlValue(e,i)}},{key:"registerTextInputControl",value:function(e){var t=document.getElementById(e);t.addEventListener("change",function(){UITools.setControlValue(this.id,this.value,!0),UITools.applyToolControl(this.id)}.bind(t)),t.addEventListener("keyup",function(){UITools.setControlValue(this.id,this.value,!1),UITools.applyToolControl(this.id)}.bind(t))}},{key:"registerTextAreaControl",value:function(e){var t=document.getElementById(e);t.addEventListener("change",function(){UITools.setControlValue(this.id,this.value),UITools.applyToolControl(this.id)}.bind(t))}},{key:"updateToolControls",value:function(e){var t=this;this.toolControlIDs.hasOwnProperty(e)&&this.toolControlIDs[e].forEach(function(e){return t.updateToolControl(e)});UIToolsEvents.UPDATE_TOOL_CONTROLS.data=e,this.dispatchEvent(UIToolsEvents.UPDATE_TOOL_CONTROLS)}},{key:"updateToolControl",value:function(e){if(this.controlParamObjects.hasOwnProperty(e)){var t=this.controlParamObjects[e].type,n=this.getControlValue(e);if(void 0!==t&&void 0!==n)switch(t){case"button":break;case"slider":case"slider_item":var i=document.getElementById(e);if(i&&(i.noUiSlider.set(n),"slider_item"===t))try{i.updateValueLabel()}catch(e){}break;case"scrubber":var r=document.getElementById(e);if(r){var a=this.getParamObject(e);a.hasOwnProperty("min")&&a.min!==r.minValue&&(r.minValue=a.min),a.hasOwnProperty("max")&&a.max!==r.maxValue&&(r.maxValue=a.max),r.currentValue=n}break;case"color":case"color_item":case"color_palette":case"color_group":var o=document.getElementById(e);if(o){if(o.hashColor=n,o.intensityEnabled){var s=this.controlToolIDs[e],l=e.replace("".concat(s,"_"),"");o.intensity=this.getToolValue(s,"".concat(l,"_intensity"))}"color_palette"===t&&o.hasOwnProperty("presetButtons")&&o.presetButtons.updateColorPresetButtons()}break;case"radio":case"toggle_group":var u=document.getElementById(e);u&&u.value!==n&&(u.value=n);break;case"dropdown_item":var c=document.getElementById(e);c&&(c.selectedValue!==n||c.isMixed)&&(c.selectedValue=n);break;case"checkbox":case"checkbox_item":case"toggle_switch":var h=document.getElementById(e);h&&h.checked!==n&&(h.checked=n);break;case"expandable_checkbox":var d=document.getElementById(e),m=n?"on":"off";d&&d.checked!==m&&(d.checked=m);break;case"textinput":var p=document.getElementById(e);p&&p.value!==n&&(p.value=n);break;case"textarea":var g=document.getElementById(e);g&&g.value!==n&&(g.value=n)}UIToolsEvents.UPDATE_TOOL_CONTROL.data=e,this.dispatchEvent(UIToolsEvents.UPDATE_TOOL_CONTROL)}}},{key:"applyToolControl",value:function(e){if(this.controlToolIDs.hasOwnProperty(e)){var t=this.controlToolIDs[e];this.applyTool(t)}}},{key:"applyTool",value:function(e){var t=this.getToolVO(e);if(t){this.printToolVOs&&console.log(Object.keys(t).map(function(e){return"[ ".concat(e,": ").concat(t[e]," ]")}).join(""));var n=new Event(UIToolsEvents.UPDATE_TOOL.type);n.data=e,this.dispatchEvent(n)}}},{key:"setupControlItems",value:function(e,t){e&&t&&e.forEach(function(e){var n=e.toolID,i=e.controlID,r=e.controlName,a=e.controlParamObject,o=BFN.effectPresetMap.hasOwnProperty(n),s=a.customClasses,l=void 0===s?[]:s,u=a.name,c=void 0===u?r:u,h=a.icon,d=a.tooltip,m=a.type,p=a.useLabel,g=a.iconSize,f=void 0===g?20:g,v="";switch(m){case"button":var y=["button","button--fullwidth","reset"===c?"button--grey-outline":"button--blue",h?"button--has-icon button--centered":""].filter(Boolean).join(" ");v+=h?'\n                        <div class="control-item">\n                            <button id="'.concat(i,'" class="').concat(y,'">\n                                ').concat(h?BeFunky.getSvgHtml(h,{classes:"icon icon--".concat(f)}):"",'\n                                <string data-lang="').concat(c,'">').concat(BeFunky.LanguageManager.getString(c),"</string>\n                            </button>\n                        </div>"):'\n                        <div class="control-item">\n                            <button id="'.concat(i,'" class="').concat(y,'" data-lang="').concat(c,'">').concat(BeFunky.LanguageManager.getString(c),"</button>\n                        </div>");break;case"slider":v+='\n                    <div class="control-item control-item--slider '.concat(l.join(" "),'">\n                        <label class="control-item-label" data-lang="').concat(c,'">').concat(BeFunky.LanguageManager.getString(c),'</label>\n                        <div id="').concat(i,'"></div>\n                    </div>');break;case"slider_item":v+='\n                    <div class="control-item control-item--slider '.concat(l.join(" "),'">\n                        <div id="').concat(i,'"></div>\n                    </div>');break;case"color":v+='\n                    <div class="control-item '.concat(l.join(" "),'">\n                        <label class="control-item-label" data-lang="').concat(c,'">').concat(BeFunky.LanguageManager.getString(c),'</label>\n                        <div id="').concat(i,'"></div>\n                    </div>');break;case"color_item":v+='<div class="control-item"><div id="'.concat(i,'"></div></div>');break;case"toggle_group":v+='<div class="control-item">\n                        '.concat(p?'<label class="control-item-label" data-lang="'.concat(c,'">').concat(BeFunky.LanguageManager.getString(c),"</label>"):"",'\n                        <toggle-group id="').concat(i,'"></toggle-group>\n                    </div>');break;case"color_palette":v+='\n                    <div class="control-item">',o||(v+='\n                        <label class="control-item-label color-palette-label" data-lang="color_palette">\n                            '.concat(BeFunky.LanguageManager.getString("color_palette"),"\n                        </label>")),v+='\n                        <div id="'.concat(i,'"></div>\n                    </div>');break;case"color_group":v+='\n                    <div class="control-item">',o||(v+='\n                        <label class="control-item-label color-palette-label" data-lang="color_group">\n                            '.concat(BeFunky.LanguageManager.getString("color_group"),"\n                        </label>")),v+='\n                        <div id="'.concat(i,'"></div>\n                    </div>');break;case"checkbox":var x='\n                    <input type="checkbox" id="'.concat(i,'" />\n                    <label class="button button--white-outline button--toggle button--icon" for="').concat(i,'" ').concat(d?'data-tooltip="'.concat(d,'"'):"",' >\n                        <svg class="icon icon--').concat(f,'">\n                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(h,'"></use>\n                        </svg>\n                    </label>');t.buttonContainer||(t.buttonContainer=document.createElement("div").setClass("control-item button-group ".concat(l.join(" "))),t.appendChild(t.buttonContainer)),t.buttonContainer.insertAdjacentHTML("beforeend",x);break;case"checkbox_item":v+='<div class="control-item"><div id="'.concat(i,'"></div></div>');break;case"dropdown_item":v+='\n                    <div class="control-item">\n                        <div id="'.concat(i,'"></div>\n                    </div>\n                ')}v&&t.insertAdjacentHTML("beforeend",v)})}},{key:"disableControlItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"control-item",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=document.getElementById(e),a=r?r.closestParent(function(e){return e.hasClass(n)}):null;a?(a.toggleClass("control-item-disabled",!!t),a.setStyles({opacity:t&&"number"==typeof i?i:""})):BeFunky.logError("Unable to find control item to disable",{_controlID:e,_class:n})}},{key:"toggleControlItem",value:function(e,t){var n=document.getElementById(e),i=n?n.closestParent(function(e){return e.hasClass("control-item")}):null;if(i){i.hasOwnProperty("activeDisplayMode")||"none"===i.style.display||(i.activeDisplayMode=i.style.display);var r=i.activeDisplayMode||"block";i.setStyles(t?{display:r}:{display:"none"})}}},{key:"toggleElement",value:function(e,t){var n=document.getElementById(e);if(n){n.hasOwnProperty("activeDisplayMode")||"none"===n.style.display||(n.activeDisplayMode=n.style.display);var i=n.activeDisplayMode||"block";n.setStyles(t?{display:i}:{display:"none"})}}},{key:"toggleElement",value:function(e,t){var n=document.getElementById(e);if(n){n.hasOwnProperty("activeDisplayMode")||"none"===n.style.display||(n.activeDisplayMode=n.style.display);var i=n.activeDisplayMode||"block";n.setStyles(t?{display:i}:{display:"none"})}}}]),n}();function Ni(){var e=g(["<button @click=",' class="sample-images__button">\n                <div class="sample-images__hover-container"></div>\n                <img src='," />\n            </button>"]);return Ni=function(){return e},e}function Mi(){var e=g(['\n        <div class="sample-images">\n            <div data-lang="guide_upload_photo" class="sample-images__main-text">','</div>\n            <div class="sample-images__sub-text">\n                <hr><span data-lang="guide_upload_photo_samples" >','</span>\n            </div>\n            <div class="sample-images__container">\n                ',"\n            </div>\n        </div>"]);return Mi=function(){return e},e}BFN.SingletonQueue.add(function(){window.UITools=new ki});var Di=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues(),this.initAlternateMenu()}},{key:"initDefaultValues",value:function(){this.mainMenu=document.getElementById("side_panel_menu_panels"),this.sampleImagePopover=null,this.zoomMenu=document.getElementById("zoom_menu"),this.zoomMenuButtons=v(this.zoomMenu.children).filter(function(e){return"BUTTON"===e.nodeName})}},{key:"initAlternateMenu",value:function(){this.alternateMenu=document.getElementById("alternateMenu"),this.alternateMenuChildren=null,this.isAlternateMenuActive=!1,this.alternateMenuIDs=[],this.alternateMenu.addEventListener("CLOSE",function(){BFN.ColorPickerPanel.colorButton=null;var e=0;BFN.FabricManager.currentTextTransformItem&&(document.getElementById("appViewportBG").dispatchEvent(new Event(BeFunky.pointerdown)),e=10),setTimeout(function(){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);BFN.TransformModel.selectedTransformItem&&e.transformLayer.deselectItem(),BFN.PhotoGrid.gridChildIsolated&&BFN.PhotoGrid.isolateGridChild(null),BFN.StageModel.appStage.focus()},e)})}},{key:"cancelActiveEditorTool",value:function(){(BFN.PhotoEditorCanvasTools.currentTool||BFN.activePresetMenuItem)&&(UITools.setControlValue("editor_apply_cancel_cancel",!0),UITools.applyTool("editor_apply_cancel"),UITools.setControlValue("editor_apply_cancel_cancel",!1))}},{key:"toggleNavBar",value:function(e){document.getElementsByClassName("navbar").setStyles({pointerEvents:e?"all":"none",opacity:e?1:.5})}},{key:"toggleMainMenu",value:function(e){this.mainMenu.toggleClass("side-panel--disabled",!e)}},{key:"toggleZoomMenu",value:function(e){this.zoomMenu.toggleClass("zoom-bar--disabled",!e),this.zoomMenuButtons.forEach(function(t){t.disabled=!e})}},{key:"setupSampleImagePopover",value:function(){var e=BeFunky.lit,t=e.appLang,n=e.elem,i=e.html,r=["blue-vw-van","woman-headshot-pink-coat","venice-sunset"];r.map(function(e){return s(e).largeUrl}).forEach(function(e){return BeFunky.addToServiceWorkerCache("ui-images",e)});var a=n(Mi(),t("guide_upload_photo",!0),t("guide_upload_photo_samples",!0),r.map(function(e){return function(e){var t=s(e),n=t.thumbUrl,r=t.largeUrl;return i(Ni(),function(){return BFN.PhotoEditorModel.openSampleImage(r,"woman-headshot-pink-coat"===e)},n)}(e)})),o=document.getElementById("sample_image_popover");return o.container.appendChild(a),o;function s(e){return{thumbUrl:"".concat(BFN.imagesURL,"app/sample-images/").concat(e,"-thumb.jpg?width=144"),largeUrl:"".concat(BFN.imagesURL,"app/sample-images/").concat(e,"-large.jpg")}}}},{key:"toggleSampleImagePopover",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.sampleImagePopover){if(!e)return;this.sampleImagePopover=this.setupSampleImagePopover()}e?(this.sampleImagePopover.show(),t&&this.sampleImagePopover.bounce()):this.sampleImagePopover.hide(),document.getElementById("appViewport").toggleClass("show-drag-drop-area--initial",e),document.getElementById("canvas_drag_drop_area").toggleClass("drag-drop-area--initial",e)}},{key:"toggleSaveButtons",value:function(e){var t=document.getElementById("editor_save_image_menu");e?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")}},{key:"toggleAlternateMenuInteractivity",value:function(e){var t=this.alternateMenu;e?t.classList.remove("disabled"):t.classList.add("disabled")}},{key:"toggleAlternateMenu",value:function(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var a=this.alternateMenu,o=this.isAlternateMenuActive;if(this.isAlternateMenuActive=e,(e||o)&&!(e&&o&&this.alternateMenuIDs.length===i.length&&this.alternateMenuIDs.every(function(e){return i.includes(e)})))if(this.mainMenu.toggleClass("side-panel--alt-menu-displayed",e),function(){a.onEscape&&document.removeEventListener("keyup",a.onEscape);if(!e)return;a.onEscape=function(e){if(27===e.which&&!BeFunky.isPointerDown)if(i.includes("layer_isolator_tool_menu")){var t=document.getElementById("layer_isolator_tool_menu");t.contains(BFN.applyCancelMenu.cancelButton)?BFN.applyCancelMenu.cancelButton.click():BeFunky.throwError("Unable to cancel layer isolator tool on Escape")}else a.dispatchEvent(new Event("CLOSE"))},document.addEventListener("keyup",a.onEscape)}(),clearTimeout(a.hide),cancelAnimationFrame(a.slide),e){var s;if(this.alternateMenuIDs=i,!this.alternateMenuChildren)this.alternateMenuChildren=v(a.children).filter(function(e){return!e.hasClass("alternate-menu__popovers")}),(s=this.alternateMenuChildren).push.apply(s,v(this.alternateMenuChildren.pop().children));this.alternateMenuChildren.forEach(function(e){var t;t=e,i.includes(t.id)?t.setStyles({display:t.hasClass("panel-header")?"flex":"block"}):t.setStyles({display:"none"})}),i.includes("text_menu")&&BFN.FontManager.preloadFontBGImageSprites(),!i.includes("text_menu")&&BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.hide(!0),a.setStyles({display:"block"}),a.slide=requestAnimationFrame(function(){return a.addClass("active")})}else this.alternateMenuIDs=[],a.dispatchEvent(new Event(BeFunky.pointerdown)),BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.isVisible()&&setTimeout(function(){(!a.hasClass("active")||!t.alternateMenuIDs.includes("text_menu"))&&BFN.FontManager.closeFontMenu()},0),a.removeClass("active"),a.hide=setTimeout(function(){a.slide=requestAnimationFrame(function(){return a.setStyles({display:"none"})})},150)}},{key:"toggleLoadScreen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isCancellable,i=void 0===n||n,r=t.message,a=void 0===r?"":r,o=t.progress,s=void 0===o?"":o,l=t.onCancel,u=t.showIris,c=void 0===u||u;e?BeFunky.showLoadScreen({message:a,showIris:c,progress:s,isCancellable:i,onCancel:l}):BeFunky.hideLoadScreen()}},{key:"showLoadScreenWhileTrue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.testMethods||(this.testMethods=[]),e&&!this.testMethods.includes(e)&&(e.active=!1,setTimeout(function(){e.active=!0},t),this.testMethods.length?this.testMethods.push(e):(this.testMethods.push(e),this.processLoadScreenTestMethods()))}},{key:"processLoadScreenTestMethods",value:function(){if(this.testMethods.length){var e=!1,t=!1;this.testMethods.forEach(function(n){n.active?t=t||n():e=!0}),t||e?(t&&!BeFunky.isLoadScreenActive()?this.toggleLoadScreen(!0,{isCancellable:!1}):!t&&BeFunky.isLoadScreenActive()&&this.toggleLoadScreen(!1),requestAnimationFrame(this.processLoadScreenTestMethods.bind(this))):(this.testMethods.forEach(function(e){delete e.active}),this.testMethods.splice(0),BeFunky.isLoadScreenActive()&&this.toggleLoadScreen(!1))}}}]),e}();function wi(){var e=g(["<div></div>"]);return wi=function(){return e},e}BFN.SingletonQueue.add(function(){window.UIToggler=new Di}),window.UIHistoryEvents={HISTORY_ITEMS_UPDATED:new Event("HISTORY_ITEMS_UPDATED")};var Li=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),e=t.call(this),BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(){e.init()}),e}return a(n,[{key:"init",value:function(){BeFunky.log("UIToggler Init"),this.initDefaultValues(),this.initHistoryPreview(),BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED.data={undoExists:!1,redoExists:!1},BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED)}},{key:"initDefaultValues",value:function(){var e,t=this;this.globalHistoryMenu=document.getElementById("globalHistoryMenu"),BFN.UI.draggablePanel(this.globalHistoryMenu),BFN.HelpClueManager.setup("global_history",{side:"right",positionFactor:.37,left:"-12px",container:function(){return e||(e=BeFunky.lit.elem(wi()),t.panelHeader.insertAdjacentElement("afterend",e),e)}}),this.panelHeader=this.globalHistoryMenu.querySelector("panel-header"),this.panelHeader.addEventListener("CLOSE",function(){UITools.setToolValue("history","toggle_panel",!1,!1),UITools.applyTool("history"),UITools.updateToolControls("history")}),this.globalHistoryMenuButtonIDs=[],this.globalHistoryMenuButtons=[],this.buttonContainer=document.getElementById("global_history_menu_button_container"),this.buttonContainerInner=document.createElement("div").addClass("scrollable-content"),this.buttonContainer.appendChild(this.buttonContainerInner),this.resetButton=document.getElementById("editor_history_action_reset"),this.undoButton=document.getElementById("editor_history_action_undo"),this.redoButton=document.getElementById("editor_history_action_redo"),this.mouseEvent=null,this.updateHistoryAvailable(),this.handleGlobalHistoryIDUpdated=BeFunky.debounce(this.handleGlobalHistoryIDUpdated.bind(this),10),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,this.handleGlobalHistoryUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.type,this.handleGlobalHistoryIDUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_BUTTONS_UPDATED.type,this.handleGlobalHistoryButtonsUpdated.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.updateHistoryAvailable.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.updateHistoryAvailable.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.updateHistoryAvailable.bind(this)),document.getElementById("history_toggle_panel").parentElement.querySelector('label[for="history_toggle_panel"]').preventItemDeselect=!0}},{key:"initHistoryPreview",value:function(){this.handleButtonContainerOverBind=this.handleButtonContainerOver.bind(this),this.handleButtonContainerOutBind=this.handleButtonContainerOut.bind(this),this.handleButtonContainerMoveBind=this.handleButtonContainerMove.bind(this),this.historyPreviewPopover=document.getElementById("history_preview_popover"),this.historyPreviewImage=new Image,this.historyPreviewImage.onload=function(){var e=document.getElementById("history_preview_image_container");e.innerHTML="",e.appendChild(this.historyPreviewImage),this.updateHistoryPreviewPopoverDisplay()}.bind(this),this.buttonContainer.addEventListener(BeFunky.pointerover,this.handleButtonContainerOverBind),this.buttonContainer.addEventListener(BeFunky.pointerout,this.handleButtonContainerOutBind)}},{key:"handleHistory",value:function(){var e=UITools.getToolVO("history");switch(e.updating_id){case"toggle_panel":this.toggleHistoryPanel(e.toggle_panel)}}},{key:"toggleHistoryPanel",value:function(e){var t=this;!function n(){if(!BFN.MainUI.viewportUpdating||!e||e&&t.temporarilyHidePanel)if(e){var i=t.globalHistoryMenu.panelSize,r=BFN.appViewportRect;t.temporarilyHidePanel?(t.temporarilyHidePanel=!1,t.globalHistoryMenu.show()):t.globalHistoryMenu.show(r.x+r.width-i.width-10,r.y+r.height-i.height-10),BFN.HelpClueManager.show("global_history")}else t.hasOwnProperty(t.togglePanelTimeoutID)&&(clearTimeout(t.togglePanelTimeoutID),delete t.togglePanelTimeoutID),t.globalHistoryMenu.hide(),BFN.HelpClueManager.hide("global_history");else t.togglePanelTimeoutID=setTimeout(function(){n()},10)}()}},{key:"updateHistoryAvailable",value:function(){var e=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.active;BFN.AppModel.viewingEditor?e=e&&BFN.PhotoEditorModel.currentTexture:e&&this.temporarilyHidePanel&&(UITools.setToolValue("history","toggle_panel",!0),UITools.applyTool("history"),UITools.updateToolControls("history")),!e&&UITools.getToolValue("history","toggle_panel")?this.temporarilyHidePanel=!0:e&&this.temporarilyHidePanel&&(UITools.setToolValue("history","toggle_panel",!0),UITools.applyTool("history"),UITools.updateToolControls("history")),document.getElementById("history_toggle_panel").disabled=!e,!e&&UITools.getToolValue("history","toggle_panel")&&(UITools.setToolValue("history","toggle_panel",!1),UITools.applyTool("history"),UITools.updateToolControls("history"))}},{key:"updateGlobalHistoryMenuDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&this.globalHistoryMenuButtonIDs.length){var t=!0;v(this.buttonContainerInner.children).forEach(function(n){n.toggleClass("active",t);var i=n.id===e;n.toggleClass("button--selected",i),i&&(t=!1)})}}},{key:"updateHistoryPreviewPopoverDisplay",value:function(){if(this.mouseEvent){var e=this.globalHistoryMenu.getBoundingClientRect(),t=Math.round(this.mouseEvent.pageY);this.historyPreviewPopover.setStyles({top:"".concat(t-e.top,"px")});var n=this.buttonContainer.getBoundingClientRect(),i=t-n.top,r=n.width,a=n.height,o=this.historyPreviewPopover.container.getBoundingClientRect().height,s=i/a,l=Math.min(1,a/o);this.historyPreviewPopover.positionFactor=(1-l)/2+s*l,e.left+r/2>BFN.appRect.width/2?(this.historyPreviewPopover.setStyles({left:"-10px"}),this.historyPreviewPopover.side="right"):(this.historyPreviewPopover.setStyles({left:"".concat(r+10,"px")}),this.historyPreviewPopover.side="left")}}},{key:"handleGlobalHistoryUpdated",value:function(e){var t=this;if(e.ids&&e.data){for(var n=this.globalHistoryMenuButtonIDs.length;--n>-1;){var i=this.globalHistoryMenuButtonIDs[n];-1===e.ids.indexOf(i)&&(this.globalHistoryMenuButtons[n].parentNode.removeChild(this.globalHistoryMenuButtons[n]),this.globalHistoryMenuButtons.splice(n,1),this.globalHistoryMenuButtonIDs.splice(n,1))}var r=document.createDocumentFragment(),a=function(){var i=e.data[n];if(t.globalHistoryMenuButtonIDs.indexOf(i.id)>=0){if(i.hasOwnProperty("thumb")&&i.thumb&&(!i.hasOwnProperty("useGroupIcon")||!i.useGroupIcon)){var a=t.globalHistoryMenuButtons.find(function(e){return e.id===i.id&&e.thumb.src!==i.thumb.src});a&&(a.thumb.src=i.thumb.src,a.previewSRC=i.preview?i.preview.src:"")}var o=document.getElementById(i.id);o&&o.removeClass("button--selected")}else{t.globalHistoryMenuButtonIDs.push(i.id);var s=document.createElement("button").setClass("button button--sm button--fullwidth history-menu__button button--has-icon button--grey-200 active");if(s.id=i.id,i.hasOwnProperty("isGroup")&&i.isGroup||i.hasOwnProperty("useGroupIcon")&&i.useGroupIcon)s.innerHTML='<span class="button__image"><svg class="icon icon--16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#history-group-icon"></use></svg></span>';else if(i.hasOwnProperty("isText")&&i.isText||i.hasOwnProperty("useTextIcon")&&i.useTextIcon)s.innerHTML='<span class="button__image"><svg class="icon icon--16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#text-icon"></use></svg></span>';else if(i.hasOwnProperty("thumb")&&i.thumb){var l=document.createElement("img");l.id="".concat(i.id,"_thumb"),l.addClass("button__image"),l.src=i.thumb.src,s.thumb=l,s.appendChild(l)}i.name||console.log("Invalid dataObject:",JSON.stringify(i)),s.insertAdjacentHTML("beforeend",'<string data-lang="'.concat(i.name,'">').concat(BeFunky.LanguageManager.getString(i.name),"</string>")),s.previewSRC=i.hasOwnProperty("thumb")&&i.preview?i.preview.src:"",s.addEventListener("click",function(){BFN.GlobalHistoryModel.historyUpdateQueued||-1===UIHistory.globalHistoryMenuButtonIDs.indexOf(this.id)||(this.hasClass("button--selected")?BFN.AppModel.viewingEditor&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.ImagePainterUndoManager.currentImagePainter&&document.getElementById("editor_apply_cancel_cancel").click():(BFN.GlobalHistoryModelEvents.SELECT_HISTORY_ITEM.data=this.id,BFN.GlobalHistoryModel.dispatchEvent(BFN.GlobalHistoryModelEvents.SELECT_HISTORY_ITEM),BFN.BfnService.track("CREATE","HISTORYPANEL","LIST")),this.blur())}.bind(s)),s.addEventListener(BeFunky.pointerover,function(){this.previewSRC?(UIHistory.historyPreviewImage.src=this.previewSRC,UIHistory.historyPreviewPopover.show()):UIHistory.historyPreviewPopover.hide()}.bind(s)),s.addEventListener(BeFunky.pointerout,function(){UIHistory.historyPreviewPopover.hide()}),t.globalHistoryMenuButtons.push(s),r.appendChild(s)}};for(n=0;n<e.data.length;n++)a();if(this.buttonContainerInner.appendChild(r),this.globalHistoryMenuButtons.length)this.globalHistoryMenuButtons[this.globalHistoryMenuButtons.length-1].addClass("button--selected");this.buttonContainerInner.scrollTop=this.buttonContainerInner.scrollHeight,this.dispatchEvent(UIHistoryEvents.HISTORY_ITEMS_UPDATED)}}},{key:"handleGlobalHistoryIDUpdated",value:function(e){var t=e.data;if(this.updateGlobalHistoryMenuDisplay(t),this.globalHistoryMenuButtonIDs.length){if(!document.getElementById(t))return;var n=this.buttonContainerInner.scrollTop,i=34*this.globalHistoryMenuButtonIDs.indexOf(t);if(i<n)this.buttonContainerInner.scrollTop=i;else{var r=this.buttonContainerInner.getBoundingClientRect().height;i+34>r+n&&(this.buttonContainerInner.scrollTop=i+34-r)}}}},{key:"handleGlobalHistoryButtonsUpdated",value:function(e){this.undoButton.disabled=!e.data.undoExists,this.redoButton.disabled=!e.data.redoExists;var t=(!BFN.AppModel.viewingEditor||BFN.AppModel.viewingEditor&&BFN.PhotoEditorModel.currentTexture)&&!BFN.TransformItemIsolator.active;this.resetButton.disabled=!t}},{key:"handleButtonContainerOver",value:function(e){this.mouseEvent=e,this.updateHistoryPreviewPopoverDisplay(),this.buttonContainer.addEventListener(BeFunky.pointermove,this.handleButtonContainerMoveBind)}},{key:"handleButtonContainerOut",value:function(e){this.mouseEvent=e,this.buttonContainer.removeEventListener(BeFunky.pointermove,this.handleButtonContainerMoveBind)}},{key:"handleButtonContainerMove",value:function(e){this.mouseEvent=e,this.updateHistoryPreviewPopoverDisplay()}}]),n}();BFN.SingletonQueue.add(function(){window.UIHistory=new Li});var Oi=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("UIMessages Init"),this.initDefaultValues(),this.initMessageScreen()}},{key:"initDefaultValues",value:function(){}},{key:"initMessageScreen",value:function(){this.messageScreen=document.getElementById("messageScreen"),BFN.UI.messageScreen(this.messageScreen)}},{key:"display",value:function(e,t){this.messageScreen.show(e||"< MESSAGE MISSING >",t)}}]),n}();BFN.SingletonQueue.add(function(){window.UIMessages=new Oi});var Ri=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),e=t.call(this),setTimeout(e.init.bind(d(e)),0),e}return a(n,[{key:"init",value:function(){BeFunky.log("UIScreens Init"),this.initTooltipScreen(),this.initDragScreen(),this.initCursorScreen()}},{key:"initTooltipScreen",value:function(){var e=this;this.tooltipScreen=document.getElementById("tooltipScreen"),BFN.UI.tooltipScreen(this.tooltipScreen),BFN.TooltipScreen=this.tooltipScreen,this.tooltipDelay=50,this.tooltipMouseEvent=null,this.attemptToShowTooltip=BeFunky.debounce(function(){if(!e.tooltipScreen.reserved){var t=e.getTooltip(e.tooltipMouseEvent.target),n=t.tooltip,i=t.isAbove,r=t.element,a=t.isBelow;if(n){var o=n.startsWith("shortcut__")?BFN.KeyboardManager.getShortcutTooltip(n.replace("shortcut__","")):BeFunky.LanguageManager.getString(n),s=/^[a-z0-9_!]+$/.test(n)&&o.includes("<");e.tooltipScreen.show(o,!1,!1,s);var l=e.tooltipScreen,u=l.prevY,c=l.prevX,h=r.getBoundingClientRect(),d="CANVAS"===r.nodeName;if(0===h.width&&0===h.height)return;h.y===u&&h.x===c||(e.tooltipScreen.prevTooltip=n,e.tooltipScreen.prevY=h.y,e.tooltipScreen.prevX=h.x,e.tooltipScreen.elementRect={x:i||a?h.x+h.width/2:h.x+h.width,y:d?h.y:h.y+(i?-h.height:h.height/2)},a&&(e.tooltipScreen.elementRect.y=h.bottom),d&&(e.tooltipScreen.elementRect.x=e.tooltipMouseEvent.pageX,e.tooltipScreen.prevX=e.tooltipMouseEvent.pageX));var m=e.tooltipScreen.elementRect,p=m.x,g=m.y;e.tooltipScreen.setPosition(p,g,i,!1,d,a)}}},this.tooltipDelay),this.handleDocumentMouseDown=this.handleDocumentMouseDown.bind(this),this.handleDocumentMouseMove=this.handleDocumentMouseMove.bind(this),this.handleDocumentMouseUp=this.handleDocumentMouseUp.bind(this),this.isMouseListened=!1,this.toggleMouseEvent(!0)}},{key:"toggleMouseEvent",value:function(e){this.isMouseListened!==e&&(this.isMouseListened=e,e?(document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),document.addEventListener(BeFunky.pointerup,this.handleDocumentMouseUp),document.addEventListener(BeFunky.pointermove,this.handleDocumentMouseMove)):(document.removeEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUp),document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMove)))}},{key:"initDragScreen",value:function(){this.dragScreen=document.getElementById("dragScreen"),BFN.UI.dragScreen(this.dragScreen),BFN.DragScreen=this.dragScreen}},{key:"initCursorScreen",value:function(){var e=BFN.StageModel.appStage;BFN.UI.cursorScreen(e),BFN.CursorScreen=e}},{key:"getTooltip",value:function(e){if(!e||!e.getAttribute)return{};if(e===BFN.Stage.view)return BFN.MainUI.tooltip?{tooltip:BFN.MainUI.tooltip,isAbove:!1,element:e}:{};var t=e.getAttribute("data-tooltip");if(t)return{tooltip:t,isAbove:e.hasAttribute("data-tooltip-above"),isBelow:e.hasAttribute("data-tooltip-below"),element:e};var n=e.parentElement;return n&&"bfn-app"!==n.id?this.getTooltip(n):{}}},{key:"handleDocumentMouseDown",value:function(){this.tooltipScreen.reserved||this.tooltipScreen.hide()}},{key:"handleDocumentMouseMove",value:function(e){if(!this.tooltipScreen.reserved&&!BeFunky.isPointerDown){this.tooltipMouseEvent=e;var t=this.getTooltip(this.tooltipMouseEvent.target).tooltip;this.tooltipScreen.hide(t),this.attemptToShowTooltip()}}},{key:"handleDocumentMouseUp",value:function(e){this.tooltipScreen.reserved||BeFunky.isPointerDown||this.tooltipScreen.active&&this.tooltipMouseEvent&&["BUTTON","INPUT"].includes(this.tooltipMouseEvent.target.nodeName)&&(this.tooltipMouseEvent=e,this.attemptToShowTooltip())}}]),n}();function Ai(){var e=g(['<div class="layers-groups__groups"><div class="scrollable-content"></div></div>']);return Ai=function(){return e},e}function Vi(){var e=g(['<div class="layers-groups__layers"><div class="scrollable-content"></div></div>']);return Vi=function(){return e},e}function Ui(){var e=g(['<tabbed-layout class="layers-groups__tabs"></tabbed-layout>']);return Ui=function(){return e},e}function Gi(){var e=g(["<div></div>"]);return Gi=function(){return e},e}function Hi(){var e=g(['<panel-header lang-id="layers_and_groups" modifier="alternate" buttons="help,close" clue-id="layers_groups"></panel-header>']);return Hi=function(){return e},e}function zi(){var e=g(["<input\n            id=",'\n            type="text"\n            class="input"\n            value=',"\n            @click=","\n            @keydown=","\n            @blur=","\n        />"]);return zi=function(){return e},e}function ji(){var e=g(["<button @click=",' class="button button--icon button--transparent layer-item__button--delete" data-tooltip="remove_from_group">\n            ',"\n        </button>"]);return ji=function(){return e},e}function Xi(){var e=g(['<img class="button__image" src='," />"]);return Xi=function(){return e},e}function Wi(){var e=g(['<span class="button__image">',"</span>"]);return Wi=function(){return e},e}function Yi(){var e=g(["<string @click=",' class="layer-item__name">',"</string>"]);return Yi=function(){return e},e}function qi(){var e=g(["\n        <div\n            @click=","\n            @keyup=","\n            @mousedown=","\n            @pointerdown=","\n            .layerObject=","\n            class=",'\n            tabindex="0"\n        >\n            ',"\n            ","\n            ","\n        </div>\n        "]);return qi=function(){return e},e}function Ki(){var e=g(["<string @click=",' class="group-item__header-name" data-tooltip="rename_group">',"</string>"]);return Ki=function(){return e},e}function Qi(){var e=g(["\n        <div @contextmenu="," class=",">\n            <div @click=",' class="','">\n                <button @click='," class="," data-tooltip=",">\n                    ","\n                </button>\n                ","\n                ","\n                <button @click=",' class="button button--icon button--xs button--transparent group-item__header-button--delete" data-tooltip="delete_group">\n                    ',"\n                </button>\n            </div>\n            <div class="," style=",">\n                ","\n            </div>\n        </div>\n        "]);return Qi=function(){return e},e}function Zi(){var e=g(['<p class="layers-groups__no-groups">\n                <img src="','app/illustrations/no-groups.svg" alt="">\n                ',"\n            </p>"]);return Zi=function(){return e},e}function Ji(){var e=g(["\n        <button\n            @click=","\n            @mousedown=","\n            @pointerdown=","\n            .layerObject=","\n            .draggingEnabled=","\n            class=","\n        >\n            ","\n            ","\n        </button>\n        "]);return Ji=function(){return e},e}function $i(){var e=g(['<p class="layers-groups__no-layers">',"</p>"]);return $i=function(){return e},e}function er(){var e=g(["\n            ","\n            ","\n            ","\n        "]);return er=function(){return e},e}function tr(){var e=g(['<div id="layers_groups_panel" class="layers-groups"></div>']);return tr=function(){return e},e}BFN.SingletonQueue.add(function(){window.UIScreens=new Ri});var nr=BeFunky.lit,ir=nr.html,rr=nr.setupState,ar=nr.render,or=nr.appLang,sr=nr.icon,lr=nr.elem;function ur(e){var t,n,i,r,a,o=e.onGroupSelection,s=e.onRemoveGroupMember,l=e.onDeleteGroup,u=e.isLayerSelectedMostRecently,c=e.selectLayer,h=e.onLayerClick,d=e.onLayerPointerDown,m=lr(tr()),p=!0,g=BeFunky.debounce(function(){r&&(p?(ar(F(),n),ar(E(),i),p=!1):"layers"===t.activeTab?ar(F(),n):ar(E(),i),a&&a())},"raf"),y=f(rr({layers:[],groups:[],expandedGroupIDs:[],selectedLayerIDs:[],renamingLayer:null,renamingGroup:null,lastClickedGroupID:null},g),2),x=y[0],_=y[1];BeFunky.LanguageManager.addLanguageUpdateListener(g);var I,T,b=((I=lr(Hi())).addEventListener("CLOSE",function(){UITools.setToolValue("layers","toggle_panel",!1,!1),UITools.applyTool("layers"),UITools.updateToolControls("layers")}),I),S=(T=lr(Gi()),BFN.HelpClueManager.setup("layers_groups",{left:"242px",positionFactor:.3,container:T}),T);!function(){t=lr(Ui());var e=lr(Vi());n=e.firstElementChild;var r=lr(Ai());i=r.firstElementChild,t.tabs={layers:e,groups:r},t.activeTab="layers",t.addEventListener("TAB_CHANGE",O),requestAnimationFrame(function(){t.querySelector(".tabs__nav").addEventListener(BeFunky.pointerdown,function(e){e.stopImmediatePropagation(),BFN.ColorPickerPanel.colorButton&&(BFN.ColorPickerPanel.colorButton=null)},!0)})}(),ar(ir(er(),b,S,t),m),BFN.UI.draggablePanel(m);var C=m.show,B=m.hide;return Object.assign(m,{state:x,setState:_,switchTabs:function(e){t.activeTab=e},show:function(){r=!0,g();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];C.call.apply(C,[m].concat(t)),BFN.HelpClueManager.show("layers_groups")},hide:function(){r=!1,B.call(m)}}),m;function F(){if(!x.layers.length)return ir($i(),or("no_layers"));var e=x.layers.map(function(e){return function(e){var t=e.id,n=e.item,i=["layer-item","button button--grey-200 button--has-image","sortable-list__item",x.selectedLayerIDs.includes(t)?"button--selected":""].filter(Boolean).join(" ");return ir(Ji(),function(t){0===t.detail&&c(e);h(e)},function(t){return R(t,e)},function(t){return R(t,e)},e,null===x.renamingLayer,i,N(n.type,n.thumbImage?n.thumbImage.src:""),k(e))}(e)});return setTimeout(function(){n.isSortableList?n.refreshList():BFN.UI.sortableList(n,{handleTargetIndexUpdated:A,handleOrderUpdated:V})},0),e}function E(){return x.groups.length?x.groups.map(P):ir(Zi(),BFN.imagesURL,or(["no_groups",{learn_more:'<a href="'.concat(BeFunky.Params.blogUrl,'layers-and-groups/" target="_blank" class="tutorial-link">').concat(or("learn_more",!0),"</a>")}]))}function P(e){var t=e.id,n=e.itemIDs,i=n.length>0,r=x.expandedGroupIDs.includes(t),a=i&&n.every(function(e){return x.selectedLayerIDs.includes(e)}),u=n.map(function(e){return x.layers.find(function(t){return t.id===e})});return u.every(Boolean)||(BeFunky.logError("Unable to find layer for group",JSON.stringify({group:e,layers:x.layers.map(function(e){return e&&{id:e.id,name:e.name,item:e.item instanceof BFN.TransformItem?"TransformItem":BeFunky.stringValue(e.item)}})})),u=u.filter(Boolean)),ir(Qi(),function(e){return e.preventDefault()},"group-item ".concat(i?"":"group-item--empty"),function(e){return function(e,t){if(_({lastClickedGroupID:t}),!e.ctrlKey&&!e.metaKey)return o([t]);var n=x.groups.filter(function(e){var t=e.itemIDs;return t.every(function(e){return x.selectedLayerIDs.includes(e)})}).map(function(e){return e.id}).unique();n.includes(t)||o([].concat(v(n),[t]))}(e,t)},"group-item__header button button--grey-200 ".concat(a?"button--selected":""),function(e){return function(e,t){e.stopPropagation(),x.expandedGroupIDs.includes(t)?_({expandedGroupIDs:x.expandedGroupIDs.filter(function(e){return e!==t})}):_({expandedGroupIDs:[].concat(v(x.expandedGroupIDs),[t])})}(e,t)},"button button--icon button--xs button--transparent group-item__header-button group-item__header-button--".concat(r?"collapse":"expand"),r?"collapse":"expand",sr("chevron-icon","icon icon--8"),sr("layers-icon","icon icon--16 group-item__header-icon"),function(e){if(x.renamingGroup===e)return M(e);return ir(Ki(),function(t){return function(e,t){if(e.shiftKey||e.ctrlKey||e.metaKey)return;if(x.lastClickedGroupID!==t.id)return;if(!t.itemIDs.length||!t.itemIDs.every(function(e){return x.selectedLayerIDs.includes(e)}))return;_({renamingGroup:t})}(t,e)},e.name)}(e),function(e){return function(e,t){e.stopPropagation(),l(t)}(e,t)},sr("delete-icon","icon icon--12"),"group-item__members ".concat(r?"":"focus-avoid"),"height: ".concat(r?34*n.length:0,"px"),u.map(function(e){return function(e,t){var n=t.groupID,i=e.id,r=e.item,a=["layer-item","button button--grey-200 button--has-image","button--sm",x.selectedLayerIDs.includes(i)?"button--selected":""].filter(Boolean).join(" ");return ir(qi(),function(t){0===t.detail&&c(e);h(e)},function(e){"Enter"===e.key&&e.target.click()},function(t){return R(t,e)},function(t){return R(t,e)},e,a,N(r.type,r.thumbImage?r.thumbImage.src:""),k(e),function(e,t){return ir(ji(),function(){return s(e,t)},sr("cancel-icon","icon icon--10"))}(n,i))}(e,{groupID:t})}))}function k(e){return x.renamingLayer===e?M(e):ir(Yi(),function(t){return function(e,t){if(e.shiftKey||e.ctrlKey||e.metaKey)return;if(!u(t))return;_({renamingLayer:t})}(t,e)},e.name)}function N(e,t){return"text"===e?ir(Wi(),sr("text-icon","icon icon--16")):ir(Xi(),t)}function M(e){var t=Boolean(e.itemIDs),n="edit_name_".concat(e.id);return!document.getElementById(n)&&requestAnimationFrame(function(){var e=document.getElementById(n);e&&(e.focus(),e.select())}),ir(zi(),n,e.name,function(e){return e.stopPropagation()},function(n){return t?(r=e,void(27===(i=n).keyCode?_({renamingGroup:null}):13===i.keyCode&&L(i,r))):function(e,t){27===e.keyCode?_({renamingLayer:null}):13===e.keyCode&&w(e,t)}(n,e);var i,r},function(n){return t?void L(n,e):function(e,t){w(e,t)}(n,e)})}function D(e,t,n){e.setItemZIndex(t,n),e.transformLayer.lastClickedItem=e,e.transformLayer.transformItems.includes(e)||BeFunky.throwError("TransformItem is in layers & groups panel but not in TransformLayer")}function w(e,t){if(x.renamingLayer===t){var n=e.target.value.trim();n&&t.name!==n?(t.item.itemName=n,_({renamingLayer:null,layers:x.layers.map(function(e){return e.id===t.id&&(e.name=n),e})})):_({renamingLayer:null})}}function L(e,t){if(x.renamingGroup===t){var n=e.target.value.trim();n&&t.name!==n?(BFN.GroupManager.renameGroup(t.id,n),_({renamingGroup:null,groups:x.groups.map(function(e){return e.id===t.id&&(e.name=n),e})})):_({renamingGroup:null})}}function O(){x.lastClickedGroupID?_({lastClickedGroupID:null}):g()}function R(e,n){if(e.type===BeFunky.pointerdown){var i="layers"===t.activeTab&&x.selectedLayerIDs.length>1;return d(e,n,i)}}function A(e,t,n){var i=x.layers.length-n-1;D(e.layerObject.item,i,!0)}function V(e,t,n){var i=x.layers.length-n-1;return D(e.layerObject.item,i,!1),new Promise(function(e){var t=setTimeout(function(){BeFunky.throwError("handleOrderUpdated timed out"),e()},1e3);a=function(){clearTimeout(t),e()}})}}var cr=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){var e=this;window.addEventListener("INIT_COMPLETE",function(){e.initDefaultValues(),e.updateLayersAvailable()})}},{key:"initDefaultValues",value:function(){this.flattenLayersButton=null,this.updateLayersAvailable=BeFunky.debounce(this.updateLayersAvailable.bind(this),10),this.handleItemsUpdated=BeFunky.debounce(this.handleItemsUpdatedImmediately.bind(this),10),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.updateLayersAvailable),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.updateLayersAvailable),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.ITEMS_UPDATED.type,this.updateLayersAvailable),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.ITEMS_UPDATED.type,this.handleItemsUpdated),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.SELECTION_UPDATED.type,this.handleSelectionUpdated.bind(this)),BFN.GroupManager.addEventListener(BFN.GroupManagerEvents.GROUPS_UPDATED.type,this.handleGroupsUpdated.bind(this)),BeFunky.LanguageManager.addLanguageUpdateListener(this.handleLanguageChanged.bind(this)),document.getElementById("layers_toggle_panel").parentElement.querySelector('label[for="layers_toggle_panel"]').preventItemDeselect=!0}},{key:"setupLayersPanel",value:function(){this.layersPanel||(this.layersPanel=ur({onGroupSelection:function(e){return BFN.GroupManager.selectGroups(e)},onRemoveGroupMember:function(e,t){return BFN.GroupManager.removeItemsFromGroup(e,[t])},onDeleteGroup:function(e){return BFN.GroupManager.deleteGroup(e)},isLayerSelectedMostRecently:function(e){var t=e.item;return BFN.TransformModel.selectedTransformItem===t&&t.transformLayer.lastClickedItem===t},onLayerClick:function(e){var t=e.item;t.transformLayer.lastClickedItem=t},selectLayer:function(e){e.item.selectItem()},onLayerPointerDown:function(e,t,n){e.stopPropagation(),BFN.ColorPickerPanel.colorButton&&(BFN.ColorPickerPanel.colorButton=null);var i=t.item,r=i.transformLayer.lastPressedItem,a=i.transformLayer.lastSelectedItem;if(i.transformLayer.lastPressedItem=i,BFN.TransformModel.selectedTransformItem!==i||2===e.button)if(2===e.button&&(i.transformLayer.lastClickedItem=i),2===e.button&&n)BFN.TransformItemGroup.pressItem(e);else if(!e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)i.pressItem(e),i.initiateLongPress();else{if(1===BFN.TransformLayerManager.selectedItems.length&&BFN.TransformLayerManager.selectedItems[0]===i||!r||!a)return void i.pressItem(e);for(var o=v(BFN.TransformLayerManager.selectedItems),s=BFN.TransformLayerManager.transformItems.indexOf(r),l=BFN.TransformLayerManager.transformItems.indexOf(a),u=BFN.TransformLayerManager.transformItems.indexOf(i),c=BFN.TransformLayerManager.transformItems.slice(Math.min(u,s),Math.max(u,s)+1),h=o.length;--h>-1;){var d=o[h];c.includes(d)&&o.splice(h,1)}BFN.TransformLayerManager.transformItems.slice(Math.min(u,l),Math.max(u,l)+1).forEach(function(e){o.includes(e)||o.push(e)}),BFN.GroupManager.selectItems(o)}else i.initiateLongPress()}}),BFN.appContainer.querySelector(".overlays-container").appendChild(this.layersPanel))}},{key:"handleLayers",value:function(){var e=UITools.getToolVO("layers");switch(e.updating_id){case"toggle_panel":this.toggleLayersPanel(e.toggle_panel)}}},{key:"toggleLayersPanel",value:function(e){var t=this;if(!this.layersPanel){if(!e)return;this.setupLayersPanel(),this.handleItemsUpdatedImmediately()}!function n(){if(!BFN.MainUI.viewportUpdating||!e||e&&t.temporarilyHidePanel)if(e){var i=t.layersPanel.panelSize,r=BFN.appViewportRect;t.temporarilyHidePanel?(t.temporarilyHidePanel=!1,t.layersPanel.show()):t.layersPanel.show(r.x+10,r.y+r.height-i.height-10)}else t.hasOwnProperty(t.togglePanelTimeoutID)&&(clearTimeout(t.togglePanelTimeoutID),delete t.togglePanelTimeoutID),t.layersPanel.hide();else t.togglePanelTimeoutID=setTimeout(function(){n()},10)}()}},{key:"updateLayersAvailable",value:function(){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer),t=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&e&&e.itemsExist&&!BFN.TransformItemIsolator.active;BFN.AppModel.viewingEditor&&!t&&UITools.getToolValue("layers","toggle_panel")?this.temporarilyHidePanel=!0:t&&this.temporarilyHidePanel&&(UITools.setToolValue("layers","toggle_panel",!0),UITools.applyTool("layers"),UITools.updateToolControls("layers")),this.layersToggleInput||(this.layersToggleInput=document.getElementById("layers_toggle_panel")),this.flattenLayersButton||(this.flattenLayersButton=document.getElementById("editor_flatten_flatten_layers")),this.layersToggleInput.disabled=!t,this.flattenLayersButton.disabled=!t,this.flattenLayersButton.setStyles({display:BFN.AppModel.viewingEditor?"":"none"}),!t&&UITools.getToolValue("layers","toggle_panel")&&(UITools.setToolValue("layers","toggle_panel",!1),UITools.applyTool("layers"),UITools.updateToolControls("layers"))}},{key:"updateGroups",value:function(){this.layersPanel&&this.layersPanel.setState({groups:BFN.GroupManager.getSectionGroupObjects(null,!0)})}},{key:"switchToGroupsTab",value:function(){this.layersPanel&&this.layersPanel.switchTabs("groups")}},{key:"handleItemsUpdatedImmediately",value:function(){if(this.layersPanel){var e=BFN.TransformLayerManager.transformItems;this.layersPanel.setState({layers:e.slice().reverse().map(function(e){return{id:e.itemID,name:e.itemName,item:e}})}),this.updateGroups(),this.handleSelectionUpdated()}}},{key:"handleSelectionUpdated",value:function(){this.layersPanel&&(this.layersPanel.state.selectedLayerIDs.isIdenticalTo(BFN.TransformLayerManager.selectedItemIDs)||this.layersPanel.setState({selectedLayerIDs:BFN.TransformLayerManager.selectedItemIDs.slice()}))}},{key:"handleGroupsUpdated",value:function(){this.updateGroups()}},{key:"handleLanguageChanged",value:function(){BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.forEach(function(e){e instanceof BFN.TransformItem&&e.refreshItemName()})}}]),e}();BFN.SingletonQueue.add(function(){window.UILayers=new cr});var hr="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",dr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   gl_FragColor = color;\n}\n",mr=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,dr)).padding=0,e}return n}(),pr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float hue;\nuniform float saturation;\nuniform float temperature;\nconst float pi = 3.14159265;\n\nvoid main(void)\n{\n\n   vec4 color = texture2D(uSampler, vTextureCoord);\n\n   //RETURN IF ALPHA 0\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    //UN-PREMULTIPLY\n    color.rgb /= color.a;\n\n    //HUE ADJUST\n    float ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    color.rgb = vec3(dot(color.rgb, weight.xyz), dot(color.rgb, weight.zxy), dot(color.rgb, weight.yzx));\n\n    //SATURATION ADJUST\n    float avg = (color.r + color.g + color.b) / 3.0;\n    if (saturation > 0.0) {\n        color.rgb += (avg - color.rgb) * (1.0 - 1.0 / (1.001 - saturation/2.0));\n    } else {\n        color.rgb += (avg - color.rgb) * (-saturation);\n    }\n\n    //TEMP ADJUST\n    color.r += temperature;\n    color.b -= temperature;\n\n    //PREMULTIPLY\n    color.rgb *= color.a;\n    gl_FragColor = color;\n\n}\n",gr=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){return i(this,n),t.call(this,e,hr,pr)}return a(n,[{key:"applyParams",value:function(e){this.uniforms.hue=this.hue,this.uniforms.saturation=this.saturation,this.uniforms.temperature=this.temperature}},{key:"hue",get:function(){return this._hue},set:function(e){this._hue=e}},{key:"saturation",get:function(){return this._saturation},set:function(e){this._saturation=e}},{key:"temperature",get:function(){return this._temperature},set:function(e){this._temperature=e}}]),n}(),fr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler[2];\nuniform float shadows;\nuniform float highlights;\nuniform float contrast;\nuniform float brightness;\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_0(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat saturation(vec3 col){\n\tfloat colMin = min(min(col.r, col.g), col.b);\n\tfloat colMax = max(max(col.r, col.g), col.b);\n\n\treturn colMax - colMin;\n}\n\nfloat mid(float colMin, float colMid, float colMax, float sat) {\n     return ((colMid - colMin) * sat) / (colMax - colMin);\n}\n\nvec3 saturationBlend(vec3 col, float sat){\n\tfloat colMin = min(min(col.b, col.g), col.r);\n\tfloat colMax = max(max(col.b, col.g), col.r);\n\n\tvec3 outImage = vec3(0.0);\n\n\tif (colMin < colMax) {\n\n\t\tif (col.b == colMax && col.r == colMin) {\n\t\t\toutImage.r = 0.0;\n\t\t\toutImage.g = mid(colMin, col.g, colMax, sat);\n\t\t\toutImage.b = sat;\n\t\t}\n\t\telse if (col.g == colMax && col.r == colMin) {\n\t\t\toutImage.r = 0.0;\n\t\t\toutImage.b = mid(colMin, col.b, colMax, sat);\n\t\t\toutImage.g = sat;\n\t\t}\n\t\telse if (col.b == colMax && col.g == colMin) {\n\t\t\toutImage.g = 0.0;\n\t\t\toutImage.r = mid(colMin, col.r, colMax, sat);\n\t\t\toutImage.b = sat;\n\t\t}\n\t\telse if (col.r == colMax && col.g == colMin) {\n\t\t\toutImage.g = 0.0;\n\t\t\toutImage.b = mid(colMin, col.b, colMax, sat);\n\t\t\toutImage.r = sat;\n\t\t}\n\t\telse if (col.r == colMax && col.b == colMin) {\n\t\t\toutImage.b = 0.0;\n\t\t\toutImage.g = mid(colMin, col.g, colMax, sat);\n\t\t\toutImage.r = sat;\n\t\t}\n\t\telse {\n\t\t\toutImage.b = 0.0;\n\t\t\toutImage.r = mid(colMin, col.r, colMax, sat);\n\t\t\toutImage.g = sat;\n\t\t}\n\n\t}\n\n\treturn outImage;\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler[0], vTextureCoord);\n    vec4 bImage = texture2D(uSampler[1], vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    float adjustedHigh = (highlights > 0.0) ? highlights : highlights*5.0;\n    float adjustedShadow = (shadows<0.0) ? shadows * 5.0 : shadows*0.90;\n\n\tfloat mask = mix(adjustedHigh, adjustedShadow, 1.0 - getLumo_1(bImage.rgb));\n\n\tvec3 outImage = mix(inputImage.rgb, vec3(1.0), mask);\n    vec3 orgMask = mix(vec3(1.0), pow(inputImage.rgb,vec3(1.25)), mask);\n    outImage = max(1.0 - ((1.0 - outImage) / orgMask), 0.0);\n\n    float adjustedBrightness = clamp(brightness+1.0,0.1,2.0);\n\n    outImage = (adjustedBrightness<1.0) ? pow(outImage,vec3(1.0/sqrt(adjustedBrightness))) : pow(outImage,vec3(1.0/pow(adjustedBrightness,2.0)));\n\n    vec3 contrastAm = mix(vec3(0.5), outImage, contrast);\n    outImage = overlayBlend(contrastAm,outImage);\n\n\toutImage = setlum(saturationBlend(inputImage.rgb, saturation(outImage)), getLumo_1(outImage));\n\n\toutImage = outImage * inputImage.a;\n\n    gl_FragColor = vec4(outImage,inputImage.a);\n}\n",vr=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,hr,fr)).channelTextures={0:"def",1:"blurImage"},r}return a(n,[{key:"applyParams",value:function(e){this.uniforms.shadows=this.shadows,this.uniforms.highlights=this.highlights,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness}},{key:"brightness",get:function(){return this._brightness},set:function(e){this._brightness=e}},{key:"contrast",get:function(){return this._contrast},set:function(e){this._contrast=e}},{key:"highlights",get:function(){return this._highlights},set:function(e){this._highlights=e}},{key:"shadows",get:function(){return this._shadows},set:function(e){this._shadows=e}},{key:"blurImage",get:function(){return this._blurImage},set:function(e){this._blurImage=e}}]),n}(),yr="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\n\nvoid main(void){\n\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n    float desat = dot(inputImage.rgb, vec3(0.3086, 0.6094, 0.082));\n    inputImage.rgb = overlayBlend(color,vec3(desat));\n    gl_FragColor = inputImage;\n\n}\n",xr=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,yr)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}}]),n}(),_r="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float shadows;\nuniform float highlights;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec3 invert = 1.0-inputImage.rgb;\n\tfloat adjustedShadows = shadows/200.0;\n\tfloat adjustedHighlights = 1.0+highlights/200.0;\n\tinputImage.rgb = (inputImage.rgb-invert*adjustedShadows)*adjustedHighlights*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Ir=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,_r)).padding=0,e}return a(n,[{key:"highlights",get:function(){return this.uniforms.highlights},set:function(e){this.uniforms.highlights=e}},{key:"shadows",get:function(){return this.uniforms.shadows},set:function(e){this.uniforms.shadows=e}}]),n}(),Tr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler[2];\n\nuniform float intensity;\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler[0], vTextureCoord);\n    vec4 bImage = texture2D(uSampler[1], vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(bImage.rgb);\n\n    float resultLumo = overlayBlendF(1.0-blurLumo.r,origLumo.r);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = vec4(mix(inputImage,vec4(result,inputImage.a),intensity));\n\n}\n\n",br="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n",Sr=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,br,Tr)).channelTextures={0:"def",1:"blurImage"},r}return a(n,[{key:"applyParams",value:function(e){this.uniforms.intensity=this.intensity}},{key:"intensity",get:function(){return this._intensity},set:function(e){this._intensity=e}},{key:"blurImage",get:function(){return this._blurImage},set:function(e){this._blurImage=e}}]),n}(),Cr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform vec4 filterClamp;\nuniform vec4 filterArea;\nuniform float clipPadding;\n\nvoid main(void)\n{\n    vec4 clampVal = vec4(filterClamp.x,filterClamp.y,filterClamp.z,filterClamp.w);\n    clampVal.xy += clipPadding/filterArea.xy;\n    clampVal.zw -= clipPadding/filterArea.xy;\n\n    vec4 color = vec4(0.0);\n\n    vec2 off1 = vec2(1.0) * vec2(strength,0.0);\n    vec2 off2 = vec2(2.0) * vec2(strength,0.0);\n    vec2 off3 = vec2(3.0) * vec2(strength,0.0);\n\n    vec2 coord = vTextureCoord;\n\n    color += texture2D(uSampler, coord) * 0.22;\n    color += texture2D(uSampler, clamp(coord + off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord - off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord + off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord - off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord + off3,clampVal.xy,clampVal.zw))* 0.08;\n    color += texture2D(uSampler, clamp(coord - off3,clampVal.xy,clampVal.zw))* 0.08;\n    gl_FragColor = color;\n\n}\n\n",Br="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",Fr=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r){var a,o;return i(this,n),a=t.call(this,Br,Cr),BFN.Stage.filterManager.shaderCache[a.glShaderKey]||(o=new PIXI.Shader(BFN.Stage.gl,a.vertexSrc,a.fragmentSrc),a.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[a.glShaderKey]=o),a.resolution=r||1,a.strength=e||.5,a.padding=0,a.adjustedStrength=null,a.clipPadding=1,a}return a(n,[{key:"apply",value:function(e,t,n,i){var r=e.getRenderTarget(!0),a=t,o=r;this.uniforms.clipPadding=this.clipPadding;for(var s=0;s<2;s++){0==s?(this.adjustedStrength=10*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.width):(this.adjustedStrength=5*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.width),e.applyFilter(this,a,o,!0);var l=o;o=a,a=l}this.adjustedStrength=2.5*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.width,e.applyFilter(this,t,n,i),e.returnRenderTarget(r)}},{key:"blur",get:function(){return this.strength},set:function(e){this.strength=e}}]),n}(),Er="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform vec4 filterClamp;\nuniform vec4 filterArea;\nuniform float clipPadding;\n\nvoid main(void)\n{\n    vec4 clampVal = vec4(filterClamp.x,filterClamp.y,filterClamp.z,filterClamp.w);\n    clampVal.xy += clipPadding/filterArea.xy;\n    clampVal.zw -= clipPadding/filterArea.xy;\n\n    vec4 color = vec4(0.0);\n\n    vec2 off1 = vec2(1.0) * vec2(0.0,strength);\n    vec2 off2 = vec2(2.0) * vec2(0.0,strength);\n    vec2 off3 = vec2(3.0) * vec2(0.0,strength);\n\n    vec2 coord = vTextureCoord;\n\n    color += texture2D(uSampler, coord) * 0.22;\n    color += texture2D(uSampler, clamp(coord + off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord - off1,clampVal.xy,clampVal.zw))* 0.18;\n    color += texture2D(uSampler, clamp(coord + off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord - off2,clampVal.xy,clampVal.zw))* 0.13;\n    color += texture2D(uSampler, clamp(coord + off3,clampVal.xy,clampVal.zw))* 0.08;\n    color += texture2D(uSampler, clamp(coord - off3,clampVal.xy,clampVal.zw))* 0.08;\n    gl_FragColor = color;\n\n}\n\n",Pr=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r){var a,o;return i(this,n),a=t.call(this,Br,Er),BFN.Stage.filterManager.shaderCache[a.glShaderKey]||(o=new PIXI.Shader(BFN.Stage.gl,a.vertexSrc,a.fragmentSrc),a.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[a.glShaderKey]=o),a.resolution=r||1,a.strength=e||.5,a.padding=0,a.adjustedStrength=null,a.clipPadding=1,a}return a(n,[{key:"apply",value:function(e,t,n,i){var r=e.getRenderTarget(!0),a=t,o=r;this.uniforms.clipPadding=this.clipPadding;for(var s=0;s<2;s++){0==s?(this.adjustedStrength=10*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.height):(this.adjustedStrength=5*this.strength/this.resolution*.75,this.uniforms.strength=this.adjustedStrength/t.size.height),e.applyFilter(this,a,o,!0);var l=o;o=a,a=l}this.adjustedStrength=2.5*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.height,e.applyFilter(this,a,n,i),e.returnRenderTarget(r)}},{key:"blur",get:function(){return this.strength},set:function(e){this.strength=e}}]),n}(),kr=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r,a,o,s){var l;return i(this,n),(l=t.call(this)).blurXFilter=new Fr(e,a),l.blurYFilter=new Pr(e,a),l.kSize=o,l.res1=a||null,l.resolution=a||("large"==o?BFN.renderTextureResolutionLarge:BFN.renderTextureResolution),l.quality=r||1,l.oneDirection=s,s||(l.blur=e||5),l.setParameters(),l}return a(n,[{key:"setInputDimensions",value:function(e,t){if(e>0&&t>0&&(this.inputW!==e||this.inputH!==t)){this.inputW=e,this.inputH=t;var n=BFN.Util.calculateRes(this.inputW,this.inputH);this.resSmall=n.small,this.resLarge=n.large}}},{key:"setParameters",value:function(){this.resolution=this.res1||("large"==this.kSize?this.resLarge||BFN.renderTextureResolutionLarge:this.resSmall||BFN.renderTextureResolution),this.padding=Math.max(.5/this.resolution,1),this.blurXFilter.clipPadding=2*this.padding,this.blurYFilter.clipPadding=2*this.padding,this.oneDirection?"x"==this.oneDirection?this.blurXFilter.resolution=this.resolution:this.blurYFilter.resolution=this.resolution:(this.blurXFilter.resolution=this.resolution,this.blurYFilter.resolution=this.resolution)}},{key:"apply",value:function(e,t,n){if(this.setParameters(),this.oneDirection)"x"==this.oneDirection?this.blurXFilter.apply(e,t,n):this.blurYFilter.apply(e,t,n);else{var i=e.getRenderTarget(!0);this.blurXFilter.apply(e,t,i,!0),this.blurYFilter.apply(e,i,n,!1),e.returnRenderTarget(i)}}},{key:"blur",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}]),n}(),Nr="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",Mr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\n\nvoid main(void)\n{\n         lowp vec4 color = texture2D(uSampler, vTextureCoord);\n         lowp float average = (color.r + color.g + color.b) / 3.0;\n         //lowp float mx = max(color.r, max(color.g, color.b));\n         //lowp float amt = (mx - average) * (-amount * 3.0);\n         color.rgb = mix(color.rgb, vec3(average), amount);\n         gl_FragColor = color;\n\n     // gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n}\n",Dr=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,Nr,Mr)).amount=1,e.padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=e}}]),n}(),wr="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",Lr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\n\nvoid main(void){\n\n    lowp vec4 color = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    //UN-PREMULTIPLY\n    color.rgb /= color.a;\n\n    lowp vec3 invertColor = 1.0 - color.rgb;\n\n    color.rgb = mix(color.rgb, invertColor.rgb, amount);\n\n    //RE-PREMULTIPLY\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n\n}\n",Or=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,wr,Lr)).uniforms.amount=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=e}}]),n}(),Rr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float minInputValue;\nuniform float gamma;\nuniform float maxInputValue;\nuniform float minOutputValue;\nuniform float maxOutputValue;\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nvoid main(void)\n{\n\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    color.rgb /= color.a;\n\n    color.rgb = levelsControl(color.rgb,minInputValue,gamma,maxInputValue,minOutputValue,maxOutputValue)*color.a;\n\n    gl_FragColor = color;\n\n}\n",Ar=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e,r;return i(this,n),e=t.call(this,hr,Rr),BFN.Stage.filterManager.shaderCache[e.glShaderKey]||(r=new PIXI.Shader(BFN.Stage.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[e.glShaderKey]=r),e.minInputValue=0,e.gamma=1,e.maxInputValue=1,e.minOutputValue=0,e.maxOutputValue=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"minInputValue",get:function(){return this.uniforms.minInputValue},set:function(e){this.uniforms.minInputValue=e}},{key:"gamma",get:function(){return this.uniforms.gamma},set:function(e){this.uniforms.gamma=e}},{key:"maxInputValue",get:function(){return this.uniforms.maxInputValue},set:function(e){this.uniforms.maxInputValue=e}},{key:"minOutputValue",get:function(){return this.uniforms.minOutputValue},set:function(e){this.uniforms.minOutputValue=e}},{key:"maxOutputValue",get:function(){return this.uniforms.maxOutputValue},set:function(e){this.uniforms.maxOutputValue=e}}]),n}(),Vr="/*https://github.com/mattdesl/glsl-lut/blob/master/index.glsl*/\nprecision highp float;\n#define GLSLIFY 1\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D iChannel1;\nuniform float intensity;\n\nvoid main(void)\n{\n    vec4 textureColor = texture2D(uSampler, vTextureCoord);\n\n    if (textureColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    textureColor.rgb /= textureColor.a;\n\n    textureColor = clamp(textureColor, 0.0, 1.0);\n\n    mediump float blueColor = textureColor.b * 63.0;\n\n    mediump vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n    mediump vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n    highp vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n   // texPos1.y = 1.0-texPos1.y;\n\n    highp vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n   // texPos2.y = 1.0-texPos2.y;\n\n    lowp vec4 newColor1 = texture2D(iChannel1, texPos1);\n    lowp vec4 newColor2 = texture2D(iChannel1, texPos2);\n\n    lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n\n   // gl_FragColor = newColor;\n\n   // gl_FragColor = texture2D(iChannel1, vTextureCoord);\n   // gl_FragColor.a = intensity;\n\n    if(textureColor.a > 0.0){\n        gl_FragColor = mix(textureColor, vec4(newColor.rgb, textureColor.w), intensity);\n        gl_FragColor.rgb *= gl_FragColor.a;\n\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n\n}\n\n",Ur="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n",Gr=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,Ur,Vr)).intensity=1,e}return a(n,[{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=e}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){e.baseTexture.isPowerOfTwo=!1,this.uniforms.iChannel1=e}}]),n}(),Hr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform float threshold;\nconst float radius = 20.0;\n\nfloat gaussKernel(float size, float variance)\n{\n\tvariance *= -2.0;\n\treturn exp(size * size / variance);\n}\n\n//horizontal pass\n\nvoid main(void)\n{\n\n       vec2 uv = vTextureCoord;\n       vec4 inputImage =  texture2D(uSampler,vTextureCoord);\n\n       if (inputImage.a == 0.0) {\n           gl_FragColor = vec4(0, 0, 0, 0);\n           return;\n       }\n\n       inputImage.rgb /= inputImage.a;\n\n       //convert to lab, we will convert back to rgb in vertical pass shader.\n    //   inputPixel.rgb = rgb2lab(inputPixel);\n       vec3 offset;\n       vec3 accum = vec3(0.0);\n       float denom = 0.0;\n\n       for (float x = -radius; x <= radius; x++)\n       {\n           offset = texture2D(uSampler, clamp(vTextureCoord + vec2(x*strength ,0.0),vec2(0.0,0.0),vec2(clampCoord,1.0))).rgb;\n        //   offset.rgb = rgb2lab(offset);\n\n           float dist = step(distance(offset, inputImage.rgb), threshold);\n           float similarity = dist * gaussKernel(x,radius);\n\n           denom += similarity;\n           accum += similarity * offset;\n       }\n\n        gl_FragColor = vec4(accum / denom*inputImage.a,inputImage.a);\n\n}\n",zr="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",jr=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r,a){var o;return i(this,n),(o=t.call(this,zr,Hr)).threshold=r||.2,o.resolution=a||1,o.strength=e||1,o}return a(n,[{key:"apply",value:function(e,t,n,i){var r=null,a=t.size.width-n.destinationFrame.width;r=0==a?1:1-(a+2+1/this.resolution)/t.size.width,this.uniforms.strength=1/n.size.width*(n.size.width/t.size.width),this.uniforms.strength*=this.strength,this.uniforms.clampCoord=r,e.applyFilter(this,t,n,i)}},{key:"blur",get:function(){return this.strength},set:function(e){this.strength=e}},{key:"threshold",get:function(){return this.uniforms.threshold},set:function(e){this.uniforms.threshold=e}}]),n}(),Xr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform float threshold;\nconst float radius = 20.0;\n\nfloat gaussKernel(float size, float variance)\n{\n\tvariance *= -2.0;\n\treturn exp(size * size / variance);\n}\n\n//vertical pass\n\nvoid main(void)\n{\n\n       float n = 0.0;\n       vec2 uv = vTextureCoord;\n\n       vec4 inputImage =  texture2D(uSampler,vTextureCoord);\n\n       if (inputImage.a == 0.0) {\n           gl_FragColor = vec4(0, 0, 0, 0);\n           return;\n       }\n\n       inputImage.rgb /= inputImage.a;\n\n       vec3 offset;\n       vec3 accum = vec3(0.0);\n       float denom = 0.0;\n\n       for (float x = -radius; x <= radius; x++)\n       {\n           offset = texture2D(uSampler, clamp(vTextureCoord + vec2(0.0,x*strength),vec2(0.0,0.0),vec2(1.0,clampCoord))).rgb;\n\n           float dist = step(distance(offset, inputImage.rgb), threshold);\n           float similarity = dist * gaussKernel(x,radius);\n\n           denom += similarity;\n           accum += similarity * offset;\n       }\n\n       gl_FragColor = vec4(accum / denom*inputImage.a,inputImage.a);\n\n}\n",Wr=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r,a){var o;return i(this,n),(o=t.call(this,zr,Xr)).threshold=r||.2,o.resolution=a||1,o.strength=e||1,o}return a(n,[{key:"apply",value:function(e,t,n,i){var r=null,a=t.size.height-n.destinationFrame.height;r=0==a?1:1-(a+2+1/this.resolution)/t.size.height,this.uniforms.strength=1/n.size.height*(n.size.height/t.size.height),this.uniforms.strength*=this.strength,this.uniforms.clampCoord=r,e.applyFilter(this,t,n,i)}},{key:"blur",get:function(){return this.strength},set:function(e){this.strength=e}},{key:"threshold",get:function(){return this.uniforms.threshold},set:function(e){this.uniforms.threshold=e}}]),n}(),Yr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvoid main(void)\n{\n         vec4 cLab = texture2D(uSampler, vTextureCoord);\n         cLab.rgb = rgb2lab(cLab.rgb);\n\n         gl_FragColor = vec4(cLab.rgb,cLab.a);\n\n}\n",qr="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",Kr=function(e){u(n,PIXI.Filter);var t=p(n);function n(){return i(this,n),t.call(this,qr,Yr)}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}}]),n}(),Qr=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r,a){var o;return i(this,n),(o=t.call(this)).blurXFilter=new jr,o.blurYFilter=new Wr,o.padding=0,o.resolution=a||1,o.blur=e||1,o.threshold=r||.1,o}return a(n,[{key:"apply",value:function(e,t,n){var i=e.getRenderTarget(!0);this.blurXFilter.resolution=this.resolution,this.blurYFilter.resolution=this.resolution,this.blurXFilter.apply(e,t,i,!1),this.blurYFilter.apply(e,i,n,!1),e.returnRenderTarget(i)}},{key:"blur",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}},{key:"threshold",get:function(){return this.blurYFilter.blur},set:function(e){this.blurXFilter.threshold=this.blurYFilter.threshold=e}}]),n}(),Zr="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float intensity;\nuniform float intensityMultiplier;\nuniform float clampX;\nuniform float clampY;\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(bImage.rgb);\n\n    float resultLumo = mix(blurLumo.r, origLumo.r, 1.0 + intensity*intensityMultiplier);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = vec4(result,inputImage.a);\n\n}\n\n",Jr="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n",$r=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=Jr,a=Zr;return(e=t.call(this,r,a)).padding=0,e.intensity=1,e.intensityMultiplier=1.5,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=e}},{key:"intensityMultiplier",get:function(){return this.uniforms.intensityMultiplier},set:function(e){this.uniforms.intensityMultiplier=e}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}}]),n}(),ea="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    if (bImage.a > 0.0) {\n        bImage.rgb /= bImage.a;\n    }\n\n    vec3 blurMinusOrig = clamp(inputImage.rgb-bImage.rgb,0.0,1.0);\n    vec3 OrigMinusBlur = clamp(bImage.rgb-inputImage.rgb,0.0,1.0);\n\n    vec3 details = clamp(inputImage.rgb-OrigMinusBlur+blurMinusOrig,0.0,1.0);\n\n    gl_FragColor = vec4( mix(inputImage.rgb,details,intensity*2.0)*inputImage.a,inputImage.a);\n\n}\n\n",ta="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n",na=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,ta,ea)).padding=0,e.intensity=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=e}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}}]),n}(),ia="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n\n    vec3 hsl = rgb2hsv(inputImage.rgb);\n\n    float adjustVibrance = levelsControl(vec3(hsl.g),0.0,pow(amount+1.0,1.5),1.0,0.0,1.0).r;\n    float adjustSat = overlayBlendF(hsl.g, mix(0.5, adjustVibrance, 1.0 - hsl.g));\n\n    vec3 result = hsv2rgb(vec3(hsl.r,adjustSat,hsl.b));\n\n    result = result * inputImage.a;\n\n    gl_FragColor = vec4(vec3(result),inputImage.a);\n}\n",ra="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",aa=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){return i(this,n),t.call(this,e,ra,ia)}return a(n,[{key:"applyParams",value:function(e){this.uniforms.amount=this.amount}},{key:"amount",get:function(){return this._amount},set:function(e){this._amount=e}}]),n}(),oa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nfloat vividBlendF(float front, float back)\n{\n\n   return mix(max(0.0, 1.0 - min(1.0, (1.0 - back) / (2.0 * front))),\n          min(1.0, back / (2.0 * (1.0 - front))),\n          step(0.5, front));\n}\n\nfloat gammaAdjustF(float inpImage,float amount)\n{\n    return pow(inpImage,amount);\n\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(bImage.rgb);\n\n    float mask = 1.0 - gammaAdjustF(origLumo.r,1.85);\n\n    //highpass filtering\n    float details  = vividBlendF(1.0-blurLumo.r,origLumo.r);\n\n    float maskDetails = mix(0.5, details, mask);\n    float resultLumo = overlayBlendF(maskDetails,origLumo.r);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = mix(inputImage, vec4(vec3(result),inputImage.a),intensity*1.2);\n\n}\n\n",sa="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n\n",la=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,sa,oa)).padding=0,e.intensity=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=e}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}}]),n}(),ua="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float amount;\nuniform float softness;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n        vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n        //center position\n        vec2 position = vTextureCoord  - vec2(0.5*realWidth,0.5*realHeight);\n\n        // keep aspect ratio\n        position.x *= realHeight / realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //avoid divide zero\n        float adjSoftness = clamp(softness,0.001,1.00);\n\n        //smoothstep for smooth results\n        float vignette = smoothstep(adjRadius, adjRadius-adjSoftness, lengthCen);\n\n        //apply with multiply, could be other blend modes though.\n        inputImage.rgb *= vignette;\n\n        gl_FragColor = vec4(inputImage.rgb,inputImage.a);\n\n}\n",ca=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=ua;return(e=t.call(this,r,a)).uniforms.amount=.35,e.uniforms.softness=.6,e.padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height,e.applyFilter(this,t,n,i)}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=e}},{key:"softness",get:function(){return this.uniforms.softness},set:function(e){this.uniforms.softness=e}}]),n}(),ha="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float mode;\n\nuniform bool inverse;\n\nuniform float mapSize;\n\nuniform float centerX;\nuniform float centerY;\n\nuniform float outerRadius;\nuniform float innerRadius;\n\nuniform float strength;\n\nuniform vec2 dimensions;\n\nuniform float opacity;\n\nfloat Circle(vec2 distFromCenter, vec2 halfSize, float radius)\n{\n    float len = length(distFromCenter);\n    float result = smoothstep(radius-(outerRadius-innerRadius),radius,len);\n    return mix(1.0,result,opacity);\n\n}\n\nvoid main(void){\n\n    lowp vec4 color = texture2D(uSampler, vTextureCoord.xy);\n\n    color.rgb /= color.a; // UN-PREMULTIPLY\n\n    //--\n\n    float pixelX = (vTextureCoord.x * mapSize);\n    float pixelY = (vTextureCoord.y * mapSize);\n\n    float dx = (centerX - pixelX);\n    float dy = (centerY - pixelY);\n    float dd = sqrt((dx * dx) + (dy * dy));\n\n    vec4 result = vec4(0.0);\n\n    if(mode == 3.0){\n        //tekin: paint brush new feather\n        vec2 pixelCoord = vTextureCoord  * dimensions;\n        vec2 size = vec2(dimensions.x,dimensions.y);\n        vec2 halfSize = size / 2.0;\n        vec2 rectCenter = size/2.0;\n        vec2 pos = pixelCoord-rectCenter;\n        pos.x *= size.y/size.x;\n        float radiusStroke = (size.y/2.0);\n        float lengthCenter = Circle(pos,halfSize,radiusStroke);\n              //  result = vec4(vec3(lengthCenter),1.0);\n                 result = mix(vec4(color.rgb,1.0), vec4(0.0), lengthCenter);\n\n    } else if ((mode == 0.0 && dd < outerRadius) || mode > 0.0){\n\n        float pixelAlpha = 0.0;\n\n        if (mode == 0.0){ // RADIAL\n\n            pixelAlpha = min(1.0, max(0.0, (dd - innerRadius)) / (outerRadius - innerRadius));\n\n        } else if (mode == 1.0){ // SQUARE\n\n            float cornerRadius = (outerRadius - innerRadius);\n            vec2 cornerCenter = vec2(((pixelX < centerX) ? cornerRadius : (mapSize - cornerRadius)), ((pixelY < centerY) ? cornerRadius : (mapSize - cornerRadius)));\n\n            if ((pixelX < cornerRadius && pixelY < cornerRadius) // TOP LEFT CORNER\n            ||  (pixelX > (mapSize - cornerRadius) && pixelY < cornerRadius) // TOP RIGHT CORNER\n            ||  (pixelX < cornerRadius && (pixelY > mapSize - cornerRadius)) // BOTTOM LEFT CORNER\n            ||  (pixelX > (mapSize - cornerRadius) && (pixelY > mapSize - cornerRadius)) // BOTTOM RIGHT CORNER\n            ){\n\n                dx = (cornerCenter.x - pixelX);\n                dy = (cornerCenter.y - pixelY);\n                dd = sqrt((dx * dx) + (dy * dy));\n\n                pixelAlpha = min(1.0, max(0.0, dd) / cornerRadius);\n\n            }else{\n\n                float xAlpha =  min(1.0, max(0.0, (abs(dx) - innerRadius)) / (outerRadius - innerRadius));\n                float yAlpha =  min(1.0, max(0.0, (abs(dy) - innerRadius)) / (outerRadius - innerRadius));\n                pixelAlpha = max(xAlpha, yAlpha);\n\n            }\n\n        } else if (mode == 2.0){ // LINEAR\n\n            pixelAlpha = min(1.0, max(0.0, (abs(dy) - innerRadius)) / (outerRadius - innerRadius));\n\n        }\n\n        pixelAlpha *= pixelAlpha;\n\n        if (inverse){\n            pixelAlpha += ((1.0 - pixelAlpha) * (1.0 - strength));\n        }\n\n        color.a *= pixelAlpha;\n\n    }\n\n    if (!inverse){\n        color.a = (1.0 - color.a);\n        color.a *= strength;\n    }\n\n    //--\n\n    color.rgb *= color.a;// RE-PREMULTIPLY\n\n    //--\n\n    if(mode == 3.0){\n        gl_FragColor = result;\n    } else {\n        gl_FragColor = color;\n    }\n\n}\n",da="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",ma=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,da,ha)).modes=["radial","square","linear","paint"],r._radius=50,r._hardness=1,r._strength=1,r._opacity=1,r._mode=r.modes.indexOf("radial"),r._inverse=!1,r}return a(n,[{key:"initParams",value:function(){this.uniforms.mode=!1,this.uniforms.inverse=!1,this.uniforms.mapSize=0,this.uniforms.centerX=0,this.uniforms.centerY=0,this.uniforms.outerRadius=1,this.uniforms.innerRadius=1}},{key:"updateBrush",value:function(){this.uniforms.mode=this._mode,this.uniforms.inverse=this._inverse,this.uniforms.mapSize=2*this._radius,this.uniforms.centerX=this._radius,this.uniforms.centerY=this._radius,this.uniforms.outerRadius=this._radius,this.uniforms.innerRadius=Math.max(0,Math.min(this._radius-2,this._radius*this._hardness)),this.uniforms.strength=this._strength,this.uniforms.opacity=this._opacity}},{key:"applyParams",value:function(e){try{this.uniforms.dimensions=[e.width,e.height]}catch(e){this.uniforms.dimensions=[512,512]}this.updateBrush()}},{key:"mode",get:function(){return this._mode},set:function(e){-1!=this.modes.indexOf(e)&&(this._mode=this.modes.indexOf(e))}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius=Math.round(e)}},{key:"hardness",get:function(){this._hardness=Math.max(0,Math.min(1,value))},set:function(e){this._hardness=e}},{key:"strength",get:function(){return this._strength},set:function(e){this._strength=Math.max(0,Math.min(1,e))}},{key:"inverse",get:function(){return this._inverse},set:function(e){this._inverse=e}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity=e}}]),n}(),pa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform float segmentsX;\nuniform float segmentsY;\n\nuniform float textureW;\nuniform float textureH;\n\nuniform float mapW;\nuniform float mapH;\n\nvoid main(void){\n\n    float segmentW = (textureW / segmentsX);\n    float segmentH = (textureH / segmentsY);\n\n    float pixelX = (vTextureCoord.x * mapW);\n    float pixelY = (vTextureCoord.y * mapH);\n\n    lowp vec2 colorSource = vec2((((floor(pixelX / segmentW) * segmentW) + (segmentW / 2.0)) / mapW), (((floor(pixelY / segmentH) * segmentH) + (segmentH / 2.0)) / mapH));\n\n    gl_FragColor = texture2D(uSampler, colorSource.xy);\n\n}\n",ga="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",fa=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,ga,pa)).padding=0,e.resolution=1,e.segmentsX=0,e.segmentsY=0,e.textureW=0,e.textureH=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"segmentsX",get:function(){return this.uniforms.segmentsX},set:function(e){this.uniforms.segmentsX=Math.round(e)}},{key:"segmentsY",get:function(){return this.uniforms.segmentsY},set:function(e){this.uniforms.segmentsY=Math.round(e)}},{key:"textureW",get:function(){return this.uniforms.textureW},set:function(e){this.uniforms.textureW=Math.round(e),this.uniforms.mapW=BFN.FilterHelper.getNextPowerOfTwo(Math.round(e))}},{key:"textureH",get:function(){return this.uniforms.textureH},set:function(e){this.uniforms.textureH=Math.round(e),this.uniforms.mapH=BFN.FilterHelper.getNextPowerOfTwo(Math.round(e))}}]),n}(),va="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform sampler2D topImage;\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 tImage = texture2D(topImage, vTextureCoord * vec2(clampX,clampY));\n\n    gl_FragColor = mix(inputImage,tImage,intensity);\n\n}\n",ya=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,va)).padding=0,e.intensity=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=e}},{key:"topImage",get:function(){return this.uniforms.topImage},set:function(e){this.uniforms.topImage=e}}]),n}(),xa="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\nuniform float clampX;\nuniform float clampY;\nuniform float dotSize;\nuniform vec3 background_color;\nuniform vec3 dot_color;\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\t//return px - mod(px,vec2(dSize,dSize));\n\treturn floor( px / dSize ) * dSize;\n}\n\nvoid main(void)\n{\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec2 onePixel = vec2(1.0/filterArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/clampX-onePixel.x,1.0/clampY-onePixel.y);\n\n    //create dot grid\n\tvec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n\tfloat s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,filterArea);\n\tvec3 texc = texture2D(uSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n    vec3 result = duotone(vec3(s),background_color,dot_color);\n\tgl_FragColor = vec4(result,1.0);\n\n}\n\n",_a=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,xa)).dotSize=1,e.background_color="0xFFFFFF",e.dot_color="0xFF0000",e.padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"dotSize",get:function(){return this.uniforms.dotSize},set:function(e){this.uniforms.dotSize=e}},{key:"background_color",get:function(){return this.uniforms.background_color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.background_color=e}},{key:"dot_color",get:function(){return this.uniforms.dot_color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.dot_color=e}}]),n}(),Ia="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 mapMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMapCoord = (mapMatrix * vec3(aVertexPosition, 1.0)).xy;\n}\n",Ta="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    float alpha = clamp((front.a * intensity), 0.0, 1.0);\n\n    back.rgb *= alpha;\n    back.a = alpha;\n\n    gl_FragColor = back;\n\n}\n",ba="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = back;\n        return;\n    }\n\n    back.a = clamp((back.a - (front.a * intensity)), 0.0, 1.0);\n\n    gl_FragColor = back;\n\n}\n",Sa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 exclusionBlend (vec3 front, vec3 back, float opacity){\n    return (front + back - 2.0 * front * back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(exclusionBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ca="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 differenceBlend (vec3 front, vec3 back, float opacity){\n    return abs(front - back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(differenceBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ba="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 pinlightBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x > 0.5) ? max(back.x, 2.0 * (front.x - 0.5)) : min(back.x, 2.0 * front.x),\n                (front.x > 0.5) ? max(back.y, 2.0 * (front.y - 0.5)) : min(back.y, 2.0 * front.y),\n                (front.z > 0.5) ? max(back.z, 2.0 * (front.z - 0.5)) : min(back.z, 2.0 * front.z)) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(pinlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Fa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 linearLightBlend (vec3 front, vec3 back, float opacity){\n    return (2.0 * front + back - 1.0) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(linearLightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ea="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 vividlightBlend (vec3 front, vec3 back, float opacity){\n\n    return mix(max(vec3(0.0), 1.0 - min(vec3(1.0), (1.0 - back) / (2.0 * front))),\n                     min(vec3(1.0), back / (2.0 * (1.0 - front))),\n                     step(0.5, front))* opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(vividlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Pa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 hardlightBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x <= 0.5) ? (2.0 * front.x * back.x) : (1.0 - 2.0 * (1.0 - front.x) * (1.0 - back.x)),\n                (front.y <= 0.5) ? (2.0 * front.y * back.y) : (1.0 - 2.0 * (1.0 - front.y) * (1.0 - back.y)),\n                (front.z <= 0.5) ? (2.0 * front.z * back.z) : (1.0 - 2.0 * (1.0 - front.z) * (1.0 - back.z))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(hardlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",ka="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 softlightBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x <= 0.5) ? (back.x - (1.0 - 2.0 * front.x) * back.x * (1.0 - back.x)) : (((front.x > 0.5) && (back.x <= 0.25)) ? (back.x + (2.0 * front.x - 1.0) * (4.0 * back.x * (4.0 * back.x + 1.0) * (back.x - 1.0) + 7.0 * back.x)) : (back.x + (2.0 * front.x - 1.0) * (sqrt(back.x) - back.x))),\n                (front.y <= 0.5) ? (back.y - (1.0 - 2.0 * front.y) * back.y * (1.0 - back.y)) : (((front.y > 0.5) && (back.y <= 0.25)) ? (back.y + (2.0 * front.y - 1.0) * (4.0 * back.y * (4.0 * back.y + 1.0) * (back.y - 1.0) + 7.0 * back.y)) : (back.y + (2.0 * front.y - 1.0) * (sqrt(back.y) - back.y))),\n                (front.z <= 0.5) ? (back.z - (1.0 - 2.0 * front.z) * back.z * (1.0 - back.z)) : (((front.z > 0.5) && (back.z <= 0.25)) ? (back.z + (2.0 * front.z - 1.0) * (4.0 * back.z * (4.0 * back.z + 1.0) * (back.z - 1.0) + 7.0 * back.z)) : (back.z + (2.0 * front.z - 1.0) * (sqrt(back.z) - back.z)))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(softlightBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n\n",Na="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform int alphadir;\n\nuniform float clampX;\nuniform float clampY;\n\nvec3 overlayBlend (vec3 front, vec3 back, float opacity, int alphadirection){\n    return vec3((back.x <= 0.5) ? (2.0 * front.x * back.x) : (1.0 - 2.0 * (1.0 - back.x) * (1.0 - front.x)),\n                (back.y <= 0.5) ? (2.0 * front.y * back.y) : (1.0 - 2.0 * (1.0 - back.y) * (1.0 - front.y)),\n                (back.z <= 0.5) ? (2.0 * front.z * back.z) : (1.0 - 2.0 * (1.0 - back.z) * (1.0 - front.z))) * opacity + ((alphadirection == 0) ? back : front) * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    if(back.a == 0.0  && alphadir == 0){\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    vec3 Cb = front.rgb/front.a;\n    vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(overlayBlend(Cb.xyz, Cs.xyz, intensity, alphadir), 0.0, 1.0);\n\n    vec4 res;\n    res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n    res.a = front.a + back.a * (1.0-front.a);\n    gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ma="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 linearDodgeBlend (vec3 front, vec3 back, float opacity){\n    return (front + back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(linearDodgeBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Da="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 colorDodgeBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x == 1.0) ? 1.0 : min(1.0, back.x / (1.0 - front.x)),\n                (front.y == 1.0) ? 1.0 : min(1.0, back.y / (1.0 - front.y)),\n                (front.z == 1.0) ? 1.0 : min(1.0, back.z / (1.0 - front.z))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(colorDodgeBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",wa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 screenBlend (vec3 front, vec3 back, float opacity){\n    return ((front + back) - (front * back)) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(screenBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n\n",La="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 lightenBlend (vec3 front, vec3 back, float opacity){\n    return max(front, back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(lightenBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Oa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 linearBurnBlend (vec3 front, vec3 back, float opacity){\n    return ((front + back) - 1.0) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(linearBurnBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ra="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 colorBurnBlend (vec3 front, vec3 back, float opacity){\n    return vec3((front.x == 0.0) ? 0.0 : (1.0 - ((1.0 - back.x) / front.x)),\n                (front.y == 0.0) ? 0.0 : (1.0 - ((1.0 - back.y) / front.y)),\n                (front.z == 0.0) ? 0.0 : (1.0 - ((1.0 - back.z) / front.z))) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(colorBurnBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Aa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 darkenBlend (vec3 front, vec3 back, float opacity){\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(darkenBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Va="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 multiplyBlend (vec3 front, vec3 back, float opacity){\n    return (front * back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(multiplyBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ua="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 subtractBlend (vec3 front, vec3 back, float opacity){\n    return (back - front) * opacity + back * (1.0 - opacity);\n    //return (max(src+dst-vec3(1.0),vec3(0.0))) * opacity + src * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(subtractBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ga="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 addBlend (vec3 front, vec3 back, float opacity){\n    return (front + back) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    vec3 Cb = front.rgb/front.a;\n    vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(addBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Ha="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nvec3 normalBlend (vec3 front, vec3 back, float opacity){\n    return front * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(normalBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",za="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nfloat lum(vec3 c) {\n    return dot(c, vec3(0.3, 0.59, 0.11));\n}\n\nvec3 clipcolor(vec3 c) {\n    float l = lum(c);\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n\n    if (n < 0.0) {\n        c.r = l + ((c.r - l) * l) / (l - n);\n        c.g = l + ((c.g - l) * l) / (l - n);\n        c.b = l + ((c.b - l) * l) / (l - n);\n    }\n    if (x > 1.0) {\n        c.r = l + ((c.r - l) * (1.0 - l)) / (x - l);\n        c.g = l + ((c.g - l) * (1.0 - l)) / (x - l);\n        c.b = l + ((c.b - l) * (1.0 - l)) / (x - l);\n    }\n\n    return c;\n}\n\nvec3 setlum(vec3 c, float l) {\n    float d = l - lum(c);\n    c = c + vec3(d);\n    return clipcolor(c);\n}\n\nvec3 colorBlend (vec3 front, vec3 back, float opacity){\n    return setlum(front, lum(back)) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(colorBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",ja="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nfloat lum(vec3 c) {\n    return dot(c, vec3(0.3, 0.59, 0.11));\n}\n\nvec3 clipcolor(vec3 c) {\n    float l = lum(c);\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n\n    if (n < 0.0) {\n        c.r = l + ((c.r - l) * l) / (l - n);\n        c.g = l + ((c.g - l) * l) / (l - n);\n        c.b = l + ((c.b - l) * l) / (l - n);\n    }\n    if (x > 1.0) {\n        c.r = l + ((c.r - l) * (1.0 - l)) / (x - l);\n        c.g = l + ((c.g - l) * (1.0 - l)) / (x - l);\n        c.b = l + ((c.b - l) * (1.0 - l)) / (x - l);\n    }\n\n    return c;\n}\n\nvec3 setlum(vec3 c, float l) {\n    float d = l - lum(c);\n    c = c + vec3(d);\n    return clipcolor(c);\n}\n\nfloat sat(vec3 c) {\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n    return x - n;\n}\n\nfloat mid(float cmin, float cmid, float cmax, float s) {\n    return ((cmid - cmin) * s) / (cmax - cmin);\n}\n\nvec3 setsat(vec3 c, float s) {\n    if (c.r > c.g) {\n        if (c.r > c.b) {\n            if (c.g > c.b) {\n                /* g is mid, b is min */\n                c.g = mid(c.b, c.g, c.r, s);\n                c.b = 0.0;\n            } else {\n                /* b is mid, g is min */\n                c.b = mid(c.g, c.b, c.r, s);\n                c.g = 0.0;\n            }\n            c.r = s;\n        } else {\n            /* b is max, r is mid, g is min */\n            c.r = mid(c.g, c.r, c.b, s);\n            c.b = s;\n            c.r = 0.0;\n        }\n    } else if (c.r > c.b) {\n        /* g is max, r is mid, b is min */\n        c.r = mid(c.b, c.r, c.g, s);\n        c.g = s;\n        c.b = 0.0;\n    } else if (c.g > c.b) {\n        /* g is max, b is mid, r is min */\n        c.b = mid(c.r, c.b, c.g, s);\n        c.g = s;\n        c.r = 0.0;\n    } else if (c.b > c.g) {\n        /* b is max, g is mid, r is min */\n        c.g = mid(c.r, c.g, c.b, s);\n        c.b = s;\n        c.r = 0.0;\n    } else {\n        c = vec3(0.0);\n    }\n    return c;\n}\n\nvec3 hueBlend (vec3 front, vec3 back, float opacity){\n    return setlum(setsat(front.rgb, sat(back.rgb)), lum(back.rgb)) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(hueBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Xa="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float intensity;\nuniform float clampX;\nuniform float clampY;\n\nfloat lum(vec3 c) {\n    return dot(c, vec3(0.3, 0.59, 0.11));\n}\n\nvec3 clipcolor(vec3 c) {\n    float l = lum(c);\n    float n = min(min(c.r, c.g), c.b);\n    float x = max(max(c.r, c.g), c.b);\n\n    if (n < 0.0) {\n        c.r = l + ((c.r - l) * l) / (l - n);\n        c.g = l + ((c.g - l) * l) / (l - n);\n        c.b = l + ((c.b - l) * l) / (l - n);\n    }\n    if (x > 1.0) {\n        c.r = l + ((c.r - l) * (1.0 - l)) / (x - l);\n        c.g = l + ((c.g - l) * (1.0 - l)) / (x - l);\n        c.b = l + ((c.b - l) * (1.0 - l)) / (x - l);\n    }\n\n    return c;\n}\n\nvec3 setlum(vec3 c, float l) {\n    float d = l - lum(c);\n    c = c + vec3(d);\n    return clipcolor(c);\n}\n\nvec3 lumoBlend (vec3 front, vec3 back, float opacity){\n    return setlum(back.rgb, lum(front.rgb)) * opacity + back * (1.0 - opacity);\n}\n\nvoid main(void){\n\n    vec4 back = texture2D(uSampler, vTextureCoord);\n    vec4 front = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    if (front.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n     vec3 Cb = front.rgb/front.a;\n        vec3 Cs = vec3(0.0);\n    if (back.a > 0.0) {\n        Cs = back.rgb / back.a;\n    }\n\n    vec3 colour = clamp(lumoBlend(Cb.xyz, Cs.xyz, intensity), 0.0, 1.0);\n\n    vec4 res;\n        res.xyz = (1.0 - front.a) * Cs + front.a * colour;\n        res.a = front.a + back.a * (1.0-front.a);\n        gl_FragColor = vec4(res.xyz * res.a, res.a)*back.a;\n\n}\n",Wa=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=Ha;switch(e){case BFN.CONST.BLEND_MODES.ADD:a=Ga;break;case BFN.CONST.BLEND_MODES.SUBTRACT:a=Ua;break;case BFN.CONST.BLEND_MODES.MULTIPLY:a=Va;break;case BFN.CONST.BLEND_MODES.DARKEN:a=Aa;break;case BFN.CONST.BLEND_MODES.COLOR_BURN:a=Ra;break;case BFN.CONST.BLEND_MODES.LINEAR_BURN:a=Oa;break;case BFN.CONST.BLEND_MODES.LIGHTEN:a=La;break;case BFN.CONST.BLEND_MODES.SCREEN:a=wa;break;case BFN.CONST.BLEND_MODES.COLOR_DODGE:a=Da;break;case BFN.CONST.BLEND_MODES.LINEAR_DODGE:a=Ma;break;case BFN.CONST.BLEND_MODES.OVERLAY:a=Na;break;case BFN.CONST.BLEND_MODES.SOFT_LIGHT:a=ka;break;case BFN.CONST.BLEND_MODES.HARD_LIGHT:a=Pa;break;case BFN.CONST.BLEND_MODES.VIVID_LIGHT:a=Ea;break;case BFN.CONST.BLEND_MODES.LINEAR_LIGHT:a=Fa;break;case BFN.CONST.BLEND_MODES.PIN_LIGHT:a=Ba;break;case BFN.CONST.BLEND_MODES.DIFFERENCE:a=Ca;break;case BFN.CONST.BLEND_MODES.EXCLUSION:a=Sa;break;case BFN.CONST.BLEND_MODES.ERASE:a=ba;break;case BFN.CONST.BLEND_MODES.ALPHA:a=Ta;break;case BFN.CONST.BLEND_MODES.COLOR:a=za;break;case BFN.CONST.BLEND_MODES.HUE:a=ja;break;case BFN.CONST.BLEND_MODES.LUMINOSITY:a=Xa}return(r=t.call(this,Ia,a)).uniforms.intensity=1,e==BFN.CONST.BLEND_MODES.OVERLAY&&(r.alphadir=0),r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=e}},{key:"alphadir",get:function(){return this.uniforms.alphadir},set:function(e){this.uniforms.alphadir=e}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}}]),n}(),Ya="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat gammaAdjustF(float inpImage,float amount)\n{\n    return pow(inpImage,amount);\n\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat bwChannelMixer(vec3 c, vec3 values) {\n\n     return dot(c, vec3(values.r, values.g, values.b));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n   float mask = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.8,0.22).r;\n   float bwImage = bwChannelMixer(inputImage.rgb,vec3(0.25, 0.75, 0.0));\n\n   float brightImage = gammaAdjustF(bwImage,0.60);\n   float contrastAm = mix(0.5, brightImage, 0.5);//\n   brightImage = overlayBlendF(contrastAm,brightImage);\n\n   float darkImage = gammaAdjustF(bwImage,1.5);\n   float result = mix(darkImage,brightImage,mask);//\n   gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);//\n}\n",qa="#define GLSLIFY 1\nfloat bw_red_1540259130(vec3 c) {\n\n     return float(c.r);\n}\n\nfloat bw_green_1604150559(vec3 c) {\n\n     return float(c.g);\n}\n\nfloat bw_blue_1117569599(vec3 c) {\n\n     return float(c.b);\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec3 color;\nuniform float mode;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(overlayBlend(color, vec3((mode == 0.0)? bw_red_1540259130(inputImage.rgb)*inputImage.a : ((mode == 1.0) ? getLumo(inputImage.rgb)*inputImage.a : bw_blue_1117569599(inputImage.rgb)*inputImage.a))),inputImage.a);\n}\n",Ka="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat sigmoidF(float inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat screenBlendF(float front, float back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tfloat result = getLumo(inputImage.rgb);\n\tfloat sigmoidImage = sigmoidF(result,0.77,0.59);\n\tresult = screenBlendF(sigmoidImage,result);\n\tgl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",Qa="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tfloat result = getLumo(inputImage.rgb);\n\tgl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",Za="#define GLSLIFY 1\nfloat bw_blue_1540259130(vec3 c) {\n\n     return float(c.b);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(vec3(bw_blue_1540259130(inputImage.rgb))*inputImage.a,inputImage.a);\n}\n",Ja="#define GLSLIFY 1\nfloat bw_green_1540259130(vec3 c) {\n\n     return float(c.g);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(vec3(bw_green_1540259130(inputImage.rgb))*inputImage.a,inputImage.a);\n}\n",$a="#define GLSLIFY 1\nfloat bw_red_1540259130(vec3 c) {\n\n     return float(c.r);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tgl_FragColor = vec4(vec3(bw_red_1540259130(inputImage.rgb))*inputImage.a,inputImage.a);\n}\n",eo=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=$a;switch(e){case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_2:a=Ja;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_3:a=Za;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4:a=Qa;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_5:a=Ka;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_6:case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_7:a=qa;break;case BFN.CONST.BLACK_WHITE_PRESETS.PRESET_8:a=Ya}return(r=t.call(this,hr,a)).currentPreset=e,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){this.currentPreset==BFN.CONST.BLACK_WHITE_PRESETS.PRESET_8&&(this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height),e.applyFilter(this,t,n,i)}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"mode",get:function(){return this.uniforms.mode},set:function(e){this.uniforms.mode=e}}]),n}(),to="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\n void main() {\n\n    lowp vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n    }\n\n    color.rgb /= color.a;\n\n    color.r = texture2D(iChannel1, vec2(color.r, 0.0)).r;\n    color.g = texture2D(iChannel1, vec2(color.g, 0.0)).g;\n    color.b = texture2D(iChannel1, vec2(color.b, 0.0)).b;\n\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n\n }\n",no=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r,a){var o;return i(this,n),(o=t.call(this,hr,to)).padding=0,e&&r&&a?(o.doFilter(e,r,a),o):m(o)}return a(n,[{key:"doFilter",value:function(e,t,n){this.iChannel1=BFN.FilterHelper.GetCurvesTexture(e,t,n)}},{key:"dispose",value:function(){try{this.iChannel1.destroyGC(!0)}catch(e){}this.iChannel1=null}},{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){null!=e&&(e.baseTexture.isPowerOfTwo=!0,this.uniforms.iChannel1=e)}}]),n}(),io="#define GLSLIFY 1\nfloat bwChannelMixer(vec3 c, vec3 values) {\n\n     return dot(c, vec3(values.r, values.g, values.b));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float redAmount;\nuniform float greenAmount;\nuniform float blueAmount;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   gl_FragColor = vec4(vec3(bwChannelMixer(inputImage.rgb,vec3(redAmount, greenAmount, blueAmount))),inputImage.a);\n}\n",ro=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,io)).padding=0,e}return a(n,[{key:"redAmount",get:function(){return this.uniforms.redAmount},set:function(e){this.uniforms.redAmount=e}},{key:"greenAmount",get:function(){return this.uniforms.greenAmount},set:function(e){this.uniforms.greenAmount=e}},{key:"blueAmount",get:function(){return this.uniforms.blueAmount},set:function(e){this.uniforms.blueAmount=e}}]),n}(),ao="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat sigmoidF(float inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform sampler2D blurImage;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec4 blurredImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    float lumoImage = sigmoidF(getLumo(blurredImage.rgb),0.55,0.74);\n    vec3 screenImage = clamp(screenBlend(vec3(lumoImage),inputImage.rgb),0.0,1.0);\n\n    vec3 result = clamp(textureImage.rgb*screenImage,0.0,1.0);\n\n    result = result.bgr*inputImage.a;\n\n\tgl_FragColor = vec4(result,inputImage.a);\n}\n",oo="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 greenChannel = duotone(vec3(inputImage.g),vec3(0.33,0.66,1.0),vec3(0.04,0.0,0.24));\n\tinputImage.rgb = hardLightBlend(greenChannel,textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",so="#define GLSLIFY 1\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat greenChannel = inputImage.g;\n\tinputImage.rgb = colorBurnBlend(vec3(greenChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",lo="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat blueChannel = inputImage.b;\n\tinputImage.rgb = hardLightBlend(vec3(blueChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",uo="#define GLSLIFY 1\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat blueChannel = inputImage.b;\n\tinputImage.rgb = colorBurnBlend(vec3(blueChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",co="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n\tinputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tfloat blueChannel = inputImage.b;\n\tinputImage.rgb = hardLightBlend(vec3(blueChannel),textureImage.rgb)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",ho=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=co;switch(e){case BFN.CONST.CYANOTYPE_PRESETS.PRESET_2:a=uo;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_3:a=lo;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_4:a=so;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_5:a=oo;break;case BFN.CONST.CYANOTYPE_PRESETS.PRESET_6:a=ao}return(r=t.call(this,hr,a)).currentPreset=e,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}}]),n}(),mo="#define GLSLIFY 1\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float realWidth;\nuniform float realHeight;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n   vec4 maskImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY)); //retro6mask\n\n   float mask = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.8,0.22).r;\n\n   vec3 result = mix(maskImage.rgb,inputImage.rgb,vec3(mask));\n   gl_FragColor = vec4(result,inputImage.a);//\n}\n",po=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,mo)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height,e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}}]),n}(),go="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float detail_level;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (inputImage.a == 0.0) {\n      gl_FragColor = vec4(0, 0, 0, 0);\n      return;\n    }\n\n    //UN-PREMULTIPLY\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo(blurImage.rgb),0.0,1.0);\n\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level,1.0);\n\n    vec3 result = clamp(duotone(bringDetails,color1,color2)*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",fo=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,go)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"blurImage",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"color1",get:function(){return this.uniforms.color1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}},{key:"color2",get:function(){return this.uniforms.color2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}},{key:"detail_level",get:function(){return this.uniforms.detail_level},set:function(e){this.uniforms.detail_level=e}}]),n}(),vo="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec3 color;\nuniform float amount;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   //RETURN IF ALPHA 0\n   if (inputImage.a == 0.0) {\n       gl_FragColor = vec4(0, 0, 0, 0);\n       return;\n   }\n\n   //UN-PREMULTIPLY\n   inputImage.rgb /= inputImage.a;\n\n   vec3 tintimage = tint(inputImage.rgb, color);\n\n   inputImage.rgb = mix(inputImage.rgb, tintimage, amount);\n\n   //RE-PREMULTIPLY\n   inputImage.rgb *= inputImage.a;\n\n   gl_FragColor = inputImage;\n\n}\n",yo=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,vo)).padding=0,e}return a(n,[{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=e}}]),n}(),xo="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nvec3 unsharpMask(vec3 orgInput, vec3 blurInput, float intensity) {\n    vec3 origLumo = rgb2lab(orgInput);\n    vec3 blurLumo = rgb2lab(blurInput);\n\n    float resultLumo = mix(blurLumo.r, origLumo.r, 1.0 + intensity*1.5);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n    return result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurImage;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float clampX;\nuniform float clampY;\nuniform float bwmode;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    float bwResult = getLumo(inputImage.rgb);\n\n    if(bwmode==0.0) {\n        bwResult = inputImage.r;\n    }\n    if(bwmode==2.0) {\n        bwResult = inputImage.b;\n    }\n\n    inputImage.rgb = duotone(vec3(bwResult),color1,color2);\n\n    inputImage.rgb = unsharpMask(inputImage.rgb,bImage.rgb,0.1)*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n",_o=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=xo;return(e=t.call(this,r,a)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"color1",get:function(){return this.uniforms.color1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}},{key:"color2",get:function(){return this.uniforms.color2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},{key:"bwmode",get:function(){return this.uniforms.bwmode},set:function(e){this.uniforms.bwmode=e}}]),n}(),Io="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",To="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",bo="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n\tvec3 fadedImage = mix(inputImage.rgb,vec3(getLumo(inputImage.rgb)),0.6);\n    fadedImage = BContrast(fadedImage,1.0,0.6);\n\n    fadedImage = mix(fadedImage,textureImage.rgb,0.56);\n    vec3 screenImage = screenBlend(fadedImage,inputImage.rgb);\n    screenImage = mix(inputImage.rgb,screenImage,0.7);\n    inputImage.rgb = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",So="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Co="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\tvec3 original = BContrast(inputImage.rgb,1.0,0.6);\n\tvec3 lightenImage = lightenBlend(textureImage.rgb,original);\n\tlightenImage = mix(original,lightenImage,0.55);\n\tvec3 overlayImage = overlayBlend_0(vec3(getLumo(inputImage.rgb)),lightenImage);\n\toverlayImage = mix(lightenImage,overlayImage,0.45);\n    inputImage.rgb = vignette_0(overlayImage,vTextureCoord,realWidth,realHeight,0.55,0.0)*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Bo="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec3 zero2 = vec3(0.87,0.60,0.51);\n\tvec3 softLightImage = softLightBlend(inputImage.rgb,inputImage.rgb);\n\tvec3 exBlend = exclusionBlend(softLightImage,vec3(0.027,0.0,0.258));\n\tvec3 softLightImage2 = softLightBlend(zero2,exBlend);\n\tvec3 exBlend2 = exclusionBlend(softLightImage2,vec3(0.027,0.0,0.26));\n    inputImage.rgb = softLightBlend(inputImage.rgb,exBlend2)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Fo="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tinputImage.rgb = BContrast(inputImage.rgb,1.0,1.0);\n\tinputImage.rgb = exclusionBlend(inputImage.rgb,vec3(0.243,0.0,0.062))*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Eo="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tinputImage.rgb = BContrast(inputImage.rgb,1.0,1.0);\n\tinputImage.rgb = exclusionBlend(inputImage.rgb,vec3(0.0,0.2,0.4))*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",Po="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvec3 exclusionBlend(vec3 front, vec3 back)\n{\n    return (0.5 - 2.0*(back-0.5)*(front-0.5));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tinputImage.rgb = BContrast(inputImage.rgb,1.0,1.0);\n\tinputImage.rgb = exclusionBlend(inputImage.rgb,vec3(0.027,0.0,0.258))*inputImage.a;\n\tgl_FragColor = inputImage;\n}\n",ko=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=Po;switch(e){case BFN.CONST.INSTANT_PRESETS.PRESET_2:a=Eo;break;case BFN.CONST.INSTANT_PRESETS.PRESET_3:a=Fo;break;case BFN.CONST.INSTANT_PRESETS.PRESET_4:a=Bo;break;case BFN.CONST.INSTANT_PRESETS.PRESET_5:a=Co;break;case BFN.CONST.INSTANT_PRESETS.PRESET_6:a=So;break;case BFN.CONST.INSTANT_PRESETS.PRESET_10:a=bo;break;case BFN.CONST.INSTANT_PRESETS.PRESET_11:a=To;break;case BFN.CONST.INSTANT_PRESETS.PRESET_13:a=Io}return(r=t.call(this,hr,a)).currentPreset=e,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){switch(this.currentPreset){case BFN.CONST.INSTANT_PRESETS.PRESET_5:case BFN.CONST.INSTANT_PRESETS.PRESET_6:case BFN.CONST.INSTANT_PRESETS.PRESET_10:case BFN.CONST.INSTANT_PRESETS.PRESET_11:case BFN.CONST.INSTANT_PRESETS.PRESET_13:var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height}e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}}]),n}(),No="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    inputImage.rgb = tint(inputImage.rgb,color)*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Mo=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=No;return(e=t.call(this,r,a)).padding=0,e}return a(n,[{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}}]),n}(),Do="#define GLSLIFY 1\nfloat bw_red_1540259130(vec3 c) {\n\n     return float(c.r);\n}\n\nfloat bw_green_1604150559(vec3 c) {\n\n     return float(c.g);\n}\n\nfloat bw_blue_1117569599(vec3 c) {\n\n     return float(c.b);\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform vec3 color;\nuniform float mode;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n\tvec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwimg = vec3((mode == 0.0)? bw_red_1540259130(inputImage.rgb) : ((mode == 1.0) ? getLumo(inputImage.rgb) : bw_blue_1117569599(inputImage.rgb)));\n    vec3 overlay1 = overlayBlend(textureImage.rgb, bwimg);\n\n\tgl_FragColor = vec4(overlayBlend(color, overlay1)*inputImage.a, inputImage.a);\n}\n",wo=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=Do;return(e=t.call(this,r,a)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"mode",get:function(){return this.uniforms.mode},set:function(e){this.uniforms.mode=e}}]),n}(),Lo="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float contrast;\nuniform float brightness;\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\tinputImage.rgb = BContrast(inputImage.rgb, brightness, contrast);\n\tgl_FragColor = inputImage;\n}\n",Oo=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Lo)).padding=0,e}return a(n,[{key:"brightness",get:function(){return this.uniforms.brightness},set:function(e){this.uniforms.brightness=e}},{key:"contrast",get:function(){return this.uniforms.contrast},set:function(e){this.uniforms.contrast=e}}]),n}(),Ro="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = inputImage;\n\n}\n",Ao="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurImage;\nuniform vec3 color1_1;\nuniform vec3 color1_2;\nuniform vec3 color2_1;\nuniform vec3 color2_2;\nuniform vec3 color3_1;\nuniform vec3 color3_2;\nuniform vec3 color4_1;\nuniform vec3 color4_2;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    // 2nd texture (blur image) four tile\n    vec4 blurImage1 = offsetPixel(blurImage, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage2 = offsetPixel(blurImage, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage3 = offsetPixel(blurImage, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage4 = offsetPixel(blurImage, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    // original four tile\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    //padding does not work for seconnd image, therefore we use original image alpha to clip\n  /*  blurImage1.rgb *= inputImage1.a;\n    blurImage1.a = inputImage1.a;\n    blurImage2.rgb *= inputImage2.a;\n    blurImage2.a = inputImage2.a;\n    blurImage3.rgb *= inputImage3.a;\n    blurImage3.a = inputImage3.a;\n    blurImage4.rgb *= inputImage4.a;\n    blurImage4.a = inputImage4.a;\n*/\n    //final mix test\n    inputImage1.rgb = mix(inputImage1.rgb,duotone(blurImage1.rgb,color1_1,color1_2),0.6)*inputImage1.a;\n    inputImage2.rgb = mix(inputImage2.rgb,duotone(blurImage2.rgb,color2_1,color2_2),0.6)*inputImage2.a;\n    inputImage3.rgb = mix(inputImage3.rgb,duotone(blurImage3.rgb,color3_1,color3_2),0.6)*inputImage3.a;\n    inputImage4.rgb = mix(inputImage4.rgb,duotone(blurImage4.rgb,color4_1,color4_2),0.6)*inputImage4.a;\n\n    //final compose\n   // gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n   //gl_FragColor = vec4(inputImage1.rgb+inputImage2.rgb+inputImage3.rgb+inputImage4.rgb,1.0);\n   //gl_FragColor = vec4(blurImage1.rgb+blurImage2.rgb+blurImage3.rgb+blurImage4.rgb,1.0);\n}\n",Vo="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurImage;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    if (bImage.a > 0.0) {\n        bImage.rgb /= bImage.a;\n    }\n\n    float bwResult = bImage.b;\n    vec3 duotoneImage = duotone(vec3(bwResult),color1,color2);\n    inputImage.rgb = mix(inputImage.rgb,duotoneImage,0.6)*inputImage.a;\n    gl_FragColor = inputImage;\n\n}\n",Uo="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = inputImage;\n\n}\n",Go="#define GLSLIFY 1\nvec3 gammaAdjust_0(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust_0(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 gammaAdjust_1(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust_1(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_0(contrastAm,brightImage);\n }\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 contrastImage = BContrastLeg(inputImage.rgb,1.5,0.66);\n    contrastImage = BContrast(contrastImage,1.0,0.5);\n    float lumoImage = getLumo(contrastImage);\n    vec3 sepiaImage = overlayBlend_1(vec3(0.81,0.78,0.69),vec3(lumoImage));\n    sepiaImage = mix(vec3(lumoImage), sepiaImage, 0.85);\n    gl_FragColor = vec4(sepiaImage*inputImage.a,inputImage.a);\n\n}\n",Ho="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_1(contrastAm,brightImage);\n }\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 contrastImage = BContrast(inputImage.rgb,1.0,1.0);\n    vec3 purpleLight = vec3(0.42, 0.27, 0.53);\n    vec3 purpleDark = vec3(0.32, 0.05, 0.51);\n\n    vec3 screenImage = screenBlend(inputImage.rgb,contrastImage);\n    screenImage = mix(screenImage,lightenBlend(purpleLight,screenImage),0.73);\n    screenImage = mix(screenImage,overlayBlend_0(purpleDark,screenImage),0.60);\n    inputImage.rgb = screenImage*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n",zo=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=Vo,s=!1;switch(e){case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_5:o=Ao;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_6:s=!0,o=Ho;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7:s=!0,o=Go;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8:s=!0,o=Uo;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9:s=!0,o=Ro}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r.isNoClamp=s,r}return a(n,[{key:"apply",value:function(e,t,n,i){if(0==this.isNoClamp){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y}e.applyFilter(this,t,n,i)}},{key:"blurImage",get:function(){return this.uniforms.textureSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},{key:"color1",get:function(){return this.uniforms.color1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}},{key:"color2",get:function(){return this.uniforms.color2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}},{key:"color1_1",get:function(){return this.uniforms.color1_1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1_1=e}},{key:"color1_2",get:function(){return this.uniforms.color1_2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1_2=e}},{key:"color2_1",get:function(){return this.uniforms.color2_1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2_1=e}},{key:"color2_2",get:function(){return this.uniforms.color2_2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2_2=e}},{key:"color3_1",get:function(){return this.uniforms.color3_1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color3_1=e}},{key:"color3_2",get:function(){return this.uniforms.color3_2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color3_2=e}},{key:"color4_1",get:function(){return this.uniforms.color4_1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color4_1=e}},{key:"color4_2",get:function(){return this.uniforms.color4_2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color4_2=e}}]),n}(),jo="#define GLSLIFY 1\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 colorDodgeBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = colorDodgeBlendF(front.r,back.r);\n    result.g = colorDodgeBlendF(front.g,back.g);\n    result.b = colorDodgeBlendF(front.b,back.b);\n    return result;\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float slide_right;\nuniform float slide_left;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 offsetVer = offsetPixel(uSampler, vTextureCoord, vec2(slide_left, 0.05), scaleFactor, clampValues, 1,0, fillColor);\n    vec4 offsetVer1 = offsetPixel(uSampler, vTextureCoord, vec2(slide_right, 0.07), scaleFactor, clampValues, 1,0, fillColor);\n\n    offsetVer1.rgb = colorDodgeBlend(offsetVer.rgb,offsetVer1.rgb);\n    offsetVer1.rgb = colorBurnBlend(offsetVer1.rgb,textureImage.rgb);\n\n    gl_FragColor = offsetVer1;\n}\n",Xo="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float slide_right;\nuniform float slide_left;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 offsetBoth = offsetPixel(uSampler, vTextureCoord, vec2(slide_right, 0.07), scaleFactor, clampValues, 0,0, fillColor);\n\n     vec4 offsetVer = offsetPixel(uSampler, vTextureCoord, vec2(slide_left, 0.05), scaleFactor, clampValues, 1,0, fillColor);\n\n    offsetVer.rgb = hardLightBlend(offsetVer.rgb,offsetBoth.rgb);\n    offsetVer.rgb = clamp(textureImage.rgb*offsetVer.rgb,0.0,1.0);\n    offsetVer.rgb = vignette_0(offsetVer.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    gl_FragColor = offsetVer;\n }\n",Wo="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float slide_vertical;\nuniform float slide_horizontal;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 offsetBoth = offsetPixel(uSampler, vTextureCoord, vec2(0.10, slide_vertical), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 offsetHor = offsetPixel(uSampler, vTextureCoord, vec2(slide_horizontal, 0.0), scaleFactor, clampValues, 1,0, fillColor);\n\n    vec4 blendBd;\n    blendBd.rgb = hardLightBlend(offsetHor.rgb,offsetBoth.rgb);\n    blendBd.a = 1.0;\n    blendBd = vec4(vec3(offsetHor.r,offsetBoth.g,blendBd.b),1.0);\n\n    gl_FragColor = blendBd;\n}\n",Yo="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float slide_vertical;\nuniform float slide_horizontal;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 slide1 = offsetPixel(uSampler, vTextureCoord, vec2(slide_horizontal, slide_vertical), scaleFactor, clampValues, 1,0, fillColor);\n    vec4 slide2 = offsetPixel(uSampler, vTextureCoord, vec2(0.10, 0.10), scaleFactor, clampValues, 1,0, fillColor);\n\n    slide2.rgb = hardLightBlend(slide1.rgb,slide2.rgb);\n    gl_FragColor = slide2;\n}\n\n",qo="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float slide_right;\nuniform float slide_left;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 fillColor = vec4(0.0);\n    vec2 scaleFactor = vec2(1.0,1.0);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 mode6 = offsetPixel(uSampler, vTextureCoord, vec2(slide_left, 0.0), scaleFactor, clampValues, 1,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 mode5 = offsetPixel(uSampler, vTextureCoord, vec2(slide_right, 0.0), scaleFactor, clampValues, 1,0, fillColor);\n\n    mode6.rgb = mode6.rbb;\n    mode5.rgb = mode5.brr;\n\n    mode5.rgb = hardLightBlend(mode6.rgb,mode5.rgb);\n\n  gl_FragColor = mode5;\n}\n",Ko=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=qo;switch(e){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_1:a=qo;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_2:a=Yo;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_3:a=Wo;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_4:a=Xo;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_5:a=jo}return(r=t.call(this,hr,a)).padding=0,r.currentPreset=e,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);switch(this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.currentPreset){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_4:this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height}e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}},{key:"slide_right",get:function(){return this.uniforms.slide_right},set:function(e){this.uniforms.slide_right=e}},{key:"slide_left",get:function(){return this.uniforms.slide_left},set:function(e){this.uniforms.slide_left=e}},{key:"slide_vertical",get:function(){return this.uniforms.slide_vertical},set:function(e){this.uniforms.slide_vertical=e}},{key:"slide_horizontal",get:function(){return this.uniforms.slide_horizontal},set:function(e){this.uniforms.slide_horizontal=e}},{key:"vignette_amount",get:function(){return this.uniforms.vignette_amount},set:function(e){this.uniforms.vignette_amount=e}}]),n}(),Qo="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float sketch_detail;\nuniform float line_width;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,45.0,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n    sThreshold = clamp(textureImage.rgb*sThreshold,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(sThreshold)*inputImage.a,inputImage.a);\n}\n",Zo="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float sketch_detail;\nuniform float line_width;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,45.0,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n    sThreshold = clamp(textureImage.rgb*sThreshold,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(sThreshold)*inputImage.a,inputImage.a);\n}\n",Jo="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float sketch_detail;\nuniform float line_width;\nuniform float line_angle;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,line_angle,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n\n    gl_FragColor = vec4(vec3(sThreshold)*inputImage.a,inputImage.a);\n}\n",$o="#define GLSLIFY 1\nvec3 duotone_2(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_2(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float sketch_detail;\nuniform float line_width;\nuniform float line_angle;\nuniform vec3 color;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,line_angle,vec3(0.5),vec3(1.0));\n    vec3 blendbd = clamp(inputImage.rgb*lines,0.0,1.0);\n    blendbd = BContrastLeg(blendbd,1.0,1.8);\n    vec3 sThreshold = vec3(smoothThresholdLeg(blendbd,sketch_detail/255.0,0.1));\n    sThreshold = duotone_0(sThreshold,vec3(1.0),color);\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.0),vec3(1.0));\n    noiseImg =  mix(vec3(getLumo(inputImage.rgb)),noiseImg,0.6);\n    vec3 duoNoise = duotone_0(noiseImg,vec3(1.0,0.8,0.29),vec3(1.0,1.0,0.74));\n    duoNoise = clamp(duoNoise*sThreshold,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(duoNoise)*inputImage.a,inputImage.a);\n}\n",es=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=$o,o=!0;switch(e){case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_1:a=$o;break;case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_2:a=Jo;break;case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_3:o=!1,a=Zo;break;case BFN.CONST.LINE_ARTOPIA_PRESETS.PRESET_4:o=!1,a=Qo}return(r=t.call(this,hr,a)).currentPreset=e,r.isNoClamp=o,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){if(0==this.isNoClamp){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y}e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"sketch_detail",get:function(){return this.uniforms.sketch_detail},set:function(e){this.uniforms.sketch_detail=e}},{key:"line_width",get:function(){return this.uniforms.line_width},set:function(e){this.uniforms.line_width=e}},{key:"line_angle",get:function(){return this.uniforms.line_angle},set:function(e){this.uniforms.line_angle=e}}]),n}(),ts="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 adaptiveSharpnessImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    gl_FragColor = inputImage;\n}\n",ns=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,ts)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}}]),n}(),is="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float strength;\nuniform float angleDegree;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nconst float radius = 9.0; //must be odd\n\nvoid main(void)\n{\n\n    float radianValue = radians(angleDegree); //clockwise\n    vec2 adjRadius = vec2(radius / filterArea.xy);\n    vec2 velocity = vec2(adjRadius.x*cos(radianValue),adjRadius.y*sin(radianValue));\n    int numSamples = int(floor((radius-1.0)/2.0));\n    vec4 sum = vec4(0.0), avg = vec4(0.0);\n    vec2 dc = vTextureCoord, offset = -velocity;\n\n    for (int i=0; i < int(radius); i++) {\n        sum += texture2D(uSampler, clamp(dc + offset*strength,vec2(0.0,0.0),vec2(clampX,clampY)));\n        offset += velocity / float(numSamples);\n    }\n\n    avg = sum / radius;\n    gl_FragColor = avg;\n}\n",rs=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,is)).padding=0,e.angleDegree=90,e.strength=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=1/r.x,this.uniforms.clampY=1/r.y,e.applyFilter(this,t,n,i)}},{key:"angleDegree",get:function(){return this.uniforms.angleDegree},set:function(e){this.uniforms.angleDegree=e}},{key:"strength",get:function(){return this.uniforms.strength},set:function(e){this.uniforms.strength=e}}]),n}(),as="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float brightness;\nuniform float sharpness;\nuniform float mode; //mode=1.0 returns colored version else lumo\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n   vec3 lumo = (mode==1.0)?inputImage.rgb:vec3(dot(inputImage.rgb, vec3(0.299, 0.587, 0.114)));\n\n   vec3(dot(inputImage.rgb, vec3(0.299, 0.587, 0.114)));\n   float calcSharpness = (2.0+(sharpness*20.0));\n   inputImage.rgb = vec3(brightness / (1.0+exp(calcSharpness*(0.5-lumo))));\n   gl_FragColor = inputImage;\n\n}\n\n",os=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,as)).padding=0,e.mode=0,e}return a(n,[{key:"brightness",get:function(){return this.uniforms.brightness},set:function(e){this.uniforms.brightness=e}},{key:"sharpness",get:function(){return this.uniforms.sharpness},set:function(e){this.uniforms.sharpness=e}},{key:"mode",get:function(){return this.uniforms.mode},set:function(e){this.uniforms.mode=e}}]),n}(),ss="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform int mode;\n\nvoid main(void)\n{\n\n   vec4 c = texture2D(uSampler, vTextureCoord);\n   c.rgb = (mode == 1) ? c.bgr : (mode == 2)? c.gbr : (mode == 3) ? c.gbb : (mode == 4) ? c.gbb : (mode == 5) ? c.brr : (mode == 6) ? c.rbb : (mode == 7) ? c.bgb : (mode == 8) ? c.bgg :  c.bgr;\n   gl_FragColor = c;\n\n}\n",ls=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,ss)).padding=0,e}return a(n,[{key:"mode",get:function(){return this.uniforms.mode},set:function(e){this.uniforms.mode=e}}]),n}(),us="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec4 fisheye(sampler2D sourceImage, vec2 _vTextureCoord, vec4 _filterArea, vec2 _centerPoint, vec2 _resolutionPoint, float _radius){\n\n    float PI = 3.14159265258979;\n\n    vec2 coord = mapCoord(_vTextureCoord,_filterArea);\n\n    vec2 center = vec2(_resolutionPoint.x*_centerPoint.x,_resolutionPoint.y*_centerPoint.y);\n    float aspectRatio = _resolutionPoint.x;\n    vec2 target ;\n\n    vec2 vector  = coord - center;\n    float distance = length(vector) ;\n\n    if ( distance < aspectRatio ){\n        vec2 maximum = center + ( vector / _radius ) ;\n        float ratio     = distance / aspectRatio;\n        float trigRatio = ( cos( ratio * PI) + 1.0 ) / 2.0 ;\n        target = maximum * ( trigRatio ) + coord * ( 1.0 - trigRatio ) ;\n    }\n    else {\n        target = coord;\n    }\n\n    coord = unmapCoord(target,_filterArea);\n    return texture2D(sourceImage, coord);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform float radius;\nuniform float resolutionX;\nuniform float resolutionY;\nuniform vec4 filterArea;\nuniform vec2 centerPoint;\n\nvoid main(void)\n{\n    gl_FragColor = fisheye(uSampler, vTextureCoord, filterArea, centerPoint, vec2(resolutionX, resolutionY), radius);\n\n}\n",cs=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,us)).padding=0,e.radius=1.5,e.centerPoint=[.5,.5],e}return a(n,[{key:"apply",value:function(e,t,n,i){this.uniforms.resolutionX=n.destinationFrame.width,this.uniforms.resolutionY=n.destinationFrame.height,e.applyFilter(this,t,n,i)}},{key:"centerPoint",get:function(){return this.uniforms.centerPoint},set:function(e){this.uniforms.centerPoint=e}},{key:"radius",get:function(){return this.uniforms.radius},set:function(e){this.uniforms.radius=e}}]),n}(),hs="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone(vec3(result),color1,color2);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec3 duocolor1;\nuniform vec3 duocolor2;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(genNoise(vTextureCoord, duocolor1, duocolor2), 1.0);\n}\n",ds=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,hs)).padding=0,e}return a(n,[{key:"duocolor1",get:function(){return this.uniforms.duocolor1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.duocolor1=e}},{key:"duocolor2",get:function(){return this.uniforms.duocolor2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.duocolor2=e}}]),n}(),ms="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   if (inputImage.a == 0.0) {\n    gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n   }\n\n   inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n     bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",ps="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n     gl_FragColor = vec4(0, 0, 0, 0);\n     return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = 1.0-fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.28));\n    bringDetails = hardLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",gs="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n     if (inputImage.a == 0.0) {\n      gl_FragColor = vec4(0, 0, 0, 0);\n      return;\n     }\n\n     inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = 1.0-fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",fs="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n      if (inputImage.a == 0.0) {\n       gl_FragColor = vec4(0, 0, 0, 0);\n       return;\n      }\n\n      inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",vs="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   if (inputImage.a == 0.0) {\n    gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n   }\n\n   inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",ys="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvec3 quantize(vec3 inpImg, float palette, float lightness) {\n\tinpImg = inpImg*lightness;\n\treturn floor(inpImg*floor(float(palette)))/floor(float(palette));\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float color_detail;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n     gl_FragColor = vec4(0, 0, 0, 0);\n     return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n   vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n   vec3 quantImage = quantize(blurImage.rgb,color_detail,1.0);\n   quantImage = hardLightBlend(inputImage.rgb,vec3(getLumo(quantImage)));\n   quantImage = fuzzyBorderMask(quantImage,vTextureCoord,vec2(clampX,clampY),0.35);\n   quantImage = hardLightBlend(quantImage,textureImage.rgb);\n\n   gl_FragColor = vec4(quantImage*inputImage.a,inputImage.a);\n}\n",xs="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n      if (inputImage.a == 0.0) {\n          gl_FragColor = vec4(0, 0, 0, 0);\n          return;\n      }\n\n      inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),vec3(0.0));\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = softLightBlend(bringDetails,textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",_s="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   if (inputImage.a == 0.0) {\n       gl_FragColor = vec4(0, 0, 0, 0);\n       return;\n   }\n\n   inputImage.rgb /= inputImage.a;\n\n   vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n\n    vec3 bringDetails = vec3(smoothThresholdLeg(inputImage.rgb,detail_level,0.1));\n    bringDetails = duotone(bringDetails,vec3(1.0),color);\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    bringDetails = clamp(bringDetails*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(bringDetails)*inputImage.a,inputImage.a);\n\n}\n",Is="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo(blurImage.rgb),0.0,1.0);\n\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level,1.0);\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    vec3 result = clamp(duotone(bringDetails,vec3(1.0),color)*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",Ts="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 fuzzyBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount)\n{\n    vec2 uv = coord*cXcY;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float detail_level;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float inputDesat = getLumo(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo(blurImage.rgb),0.0,1.0);\n\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level,1.0);\n    bringDetails = fuzzyBorderMask(bringDetails,vTextureCoord,vec2(clampX,clampY),0.35);\n    vec3 result = clamp(duotone(bringDetails,vec3(1.0),color)*textureImage.rgb,0.0,1.0);\n\n    gl_FragColor = vec4(vec3(result)*inputImage.a,inputImage.a);\n}\n",bs=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=Ts;switch(e){case BFN.CONST.STENCILER_PRESETS.PRESET_2:o=Is;break;case BFN.CONST.STENCILER_PRESETS.PRESET_3:o=_s;break;case BFN.CONST.STENCILER_PRESETS.PRESET_4:o=xs;break;case BFN.CONST.STENCILER_PRESETS.PRESET_6:o=ys;break;case BFN.CONST.STENCILER_PRESETS.PRESET_7:o=vs;break;case BFN.CONST.STENCILER_PRESETS.PRESET_8:o=fs;break;case BFN.CONST.STENCILER_PRESETS.PRESET_9:o=gs;break;case BFN.CONST.STENCILER_PRESETS.PRESET_10:o=ps;break;case BFN.CONST.STENCILER_PRESETS.PRESET_11:o=ms}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"detail_level",get:function(){return this.uniforms.detail_level},set:function(e){this.uniforms.detail_level=e}},{key:"color_detail",get:function(){return this.uniforms.color_detail},set:function(e){this.uniforms.color_detail=e}},{key:"smooth_amount",get:function(){return this.uniforms.hasOwnProperty("smooth_amount")?this.uniforms.smooth_amount:null},set:function(e){this.uniforms.hasOwnProperty("smooth_amount")&&(this.uniforms.smooth_amount=e)}}]),n}(),Ss="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.14));\n    vec3 channelBd = vec3(inputImage.g, duoToneImg.g, duoToneImg.b);\n\n    gl_FragColor = vec4(darkenBlend(channelBd, textureImage.rgb)*inputImage.a,inputImage.a);\n}\n",Cs="#define GLSLIFY 1\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 shiftbd = inputImage.bgb;\n    vec3 multiplyBlend = vec3(shiftbd * textureImage.rgb);\n\n    gl_FragColor = vec4(hueAdjust(multiplyBlend, 180.0)*inputImage.a,inputImage.a);\n}\n",Bs="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.46));\n\n    gl_FragColor = vec4(hardLightBlend(duoToneImg, textureImage.rgb)*inputImage.a,inputImage.a);\n}\n",Fs="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    gl_FragColor = vec4(overlayBlend(sThreshold,textureImage.rgb)*inputImage.a,inputImage.a);\n}\n",Es="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    gl_FragColor = vec4(vec3(textureImage.rgb * sThreshold)*inputImage.a,inputImage.a);\n}\n",Ps="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.62));\n    gl_FragColor = vec4(hardLightBlend(textureImage.rgb, sThreshold)*inputImage.a,inputImage.a);\n}\n",ks="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_2(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_2(vec3(result),color1,color2);\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_0(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform sampler2D blurImage;\nuniform float detail_level;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,4.0,vec3(0.8),vec3(0.2));\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.75),vec3(0.46));\n\n    vec3 hardlightBD = hardLightBlend(bImage.rgb, perlinN);\n    vec3 hardlightBD2 = hardLightBlend(noiseImg, hardlightBD);\n    vec3 hardlightBD3 = hardLightBlend(hardlightBD2, textureImage.rgb);\n\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,detail_level/255.0,0.55));\n    sThreshold = duotone_1(sThreshold,vec3(1.0),vec3(0.35));\n\n    hardlightBD3 = colorBurnBlend(sThreshold,hardlightBD3);\n\n    gl_FragColor = vec4(hardlightBD3*inputImage.a,inputImage.a);\n}\n",Ns="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.1));\n\n    gl_FragColor = vec4(overlayBlend(textureImage.rgb, sThreshold)*inputImage.a,inputImage.a);\n}\n",Ms="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.74));\n\n    vec3 softBlend = softLightBlend(inputImage.rgb, textureImage.rgb);\n\n    gl_FragColor = vec4(vec3(softBlend * sThreshold)*inputImage.a,inputImage.a);\n}\n",Ds="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwm2 = inputImage.bbb;\n\n    gl_FragColor = vec4(overlayBlend(textureImage.rgb, bwm2)*inputImage.a,inputImage.a);\n}\n",ws="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float shadow_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwm2 = inputImage.bbb;\n\n    vec3 hardlightBD = hardLightBlend(textureImage.rgb, bwm2);\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,shadow_amount/255.0,0.6));\n\n    gl_FragColor = vec4(screenBlend(sThreshold, hardlightBD)*inputImage.a,inputImage.a);\n}\n",Ls="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_0(vec3(result),color1,color2);\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform sampler2D blurImage;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,4.0,vec3(0.8),vec3(0.2));\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.75),vec3(0.46));\n\n    vec3 hardlightBD = hardLightBlend(bImage.rgb, perlinN);\n    vec3 hardlightBD2 = hardLightBlend(noiseImg, hardlightBD);\n    vec3 hardlightBD3 = hardLightBlend(hardlightBD2, textureImage.rgb);\n    hardlightBD3 = hardLightBlend(inputImage.rgb,hardlightBD3);\n\n    gl_FragColor = vec4(hardlightBD3*inputImage.a,inputImage.a);\n}\n",Os="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 hardlightBD = hardLightBlend(inputImage.rgb, textureImage.rgb);\n    vec3 sThreshold = vec3(smoothThreshold(inputImage.rgb,silhouette_amount/255.0,0.5));\n\n    gl_FragColor = vec4(vec3(hardlightBD * sThreshold)*inputImage.a,inputImage.a);\n}\n",Rs=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=Os;switch(e){case BFN.CONST.GRUNGE_PRESETS.PRESET_1:a=Os;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_2:a=Ls;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_3:a=ws;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_4:a=Ds;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_5:a=Ms;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_6:a=Ns;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_9:a=ks;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_10:a=Ps;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_11:a=Es;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_13:a=Fs;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_15:a=Bs;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_16:a=Cs;break;case BFN.CONST.GRUNGE_PRESETS.PRESET_17:a=Ss}return(r=t.call(this,hr,a)).currentPreset=e,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},{key:"silhouette_amount",get:function(){return this.uniforms.silhouette_amount},set:function(e){this.uniforms.silhouette_amount=e}},{key:"shadow_amount",get:function(){return this.uniforms.shadow_amount},set:function(e){this.uniforms.shadow_amount=e}},{key:"detail_level",get:function(){return this.uniforms.detail_level},set:function(e){this.uniforms.detail_level=e}}]),n}(),As="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float grain_amount;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    grain_amount;\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 shiftImg = inputImage.gbb;\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.3),vec3(0.5));\n    vec3 vignetteImage = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.70,0.45);\n    vec3 vignettePerlin = (1.0-vignetteImage)+perlinN;\n\n    vec3 hardOrg = hardLightBlend(vignettePerlin,shiftImg);\n\n    vec3 duoNoise = duotone_0(vignettePerlin,vec3(0.99, 1.00, 0.44),vec3(1.00, 0.42, 0.00));\n\n    hardOrg = overlayBlend(duoNoise,hardOrg);\n    vignetteImage = duotone_0(vignetteImage,vec3(1.0),vec3(0.76, 0.43, 0.06));\n    hardOrg = clamp(hardOrg*vignetteImage,0.0,1.0);\n\n    inputImage.rgb = hardOrg*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Vs="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float grain_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.3),vec3(0.5));\n\n    vec3 hardOrg = hardLightBlend(perlinN,vec3(inputImage.g));\n\n    vec3 vignetteImage = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.70,0.45);\n    vec3 duoVig = duotone_0(vignetteImage,vec3(1.00, 0.99, 0.77),vec3(0.94, 0.44, 0.00));\n\n    vec3 colorB = colorBurnBlend(duoVig,hardOrg);\n    colorB = overlayBlend(colorB,textureImage.rgb);\n\n    inputImage.rgb = colorB*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Us="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float grain_amount;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    grain_amount;\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,0.5,0.5));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.3),vec3(0.5));\n    vec3 vignetteImage = vignette_0(vec3(1.0),vTextureCoord,realWidth,realHeight,0.70,0.45);\n    vignetteImage = (1.0-vignetteImage)+perlinN;\n\n    vec3 hardOrg = hardLightBlend(vignetteImage,sThreshold);\n\n    vec3 duoNoise = duotone_0(vignetteImage,vec3(0.99, 1.00, 0.44),vec3(1.00, 0.42, 0.00));\n\n    hardOrg = overlayBlend(duoNoise,hardOrg);\n\n    inputImage.rgb = hardOrg*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Gs="#define GLSLIFY 1\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float grain_amount;\nuniform float sunburst_amount;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.8),vec3(0.2));\n\n    vec3 firstBlend = hardLightBlend(inputImage.rgb,perlinN);\n    inputImage.rgb = hardLightBlend(inputImage.rgb,firstBlend);\n\n    inputImage.rgb = hardLightBlend(inputImage.rgb,BContrastLeg(textureImage.rgb,1.0-sunburst_amount/100.0,1.0))*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Hs="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord_0( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord_0(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord_1( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\n//size should be max 30\nvec3 sunburstGen(vec2 coord,vec4 fArea, float size, vec3 lineColor, vec3 backColor,vec2 cXcY)\n{\n    //coord = mapCoord(coord,fArea);\n    coord *= cXcY;\n    vec2 center = vec2(0.5);\n    vec2 uv = (coord-center);\n    float len = length(uv);\n    float burst = cos(size*atan(uv.y, uv.x));\n    float r = burst > 0.0 ? smoothstep(0.0,0.4,burst) : smoothstep(0.0,1.0,burst);\n    float temp = r*len*4.0;//(smoothstep(0.03,0.08,len));\n\treturn duotone_0(vec3(temp),backColor,lineColor);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float halftone_size;\nuniform float sunburst_amount;\nuniform vec3 color;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 contrastImage = BContrastLeg(inputImage.rgb,1.0,1.0);\n    vec3 halfImage = halftone(uSampler,vTextureCoord,filterArea,vec2(clampX,clampY),halftone_size,vec3(0.6),vec3(1.0));\n\n    contrastImage = clamp(contrastImage*halfImage,0.0,1.0);\n\n    vec3 sunburstImg = sunburstGen(vTextureCoord,filterArea,sunburst_amount,vec3(1.0,1.0,1.0),color,vec2(clampX,clampY));\n\n    contrastImage = clamp(contrastImage*sunburstImg,0.0,1.0);\n\n    inputImage.rgb = contrastImage*inputImage.a;\n    gl_FragColor = inputImage;\n\n}\n",zs="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float halftone_size;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,(silhouette_amount/2.0)/255.0,0.3));\n    vec3 halfImage = halftone(uSampler,vTextureCoord,filterArea,vec2(clampX,clampY),halftone_size,vec3(0.39),vec3(1.0));\n\n    halfImage = overlayBlend(halfImage,sThreshold);\n    halfImage = darkenBlend(textureImage.rgb,halfImage);\n\n    inputImage.rgb = halfImage*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",js=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=zs,s=!0,l=!1;switch(e){case BFN.CONST.SUNBURST_PRESETS.PRESET_2:o=Hs;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_3:o=Gs;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_4:s=!1,l=!0,o=Us;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_5:l=!0,o=Vs;break;case BFN.CONST.SUNBURST_PRESETS.PRESET_6:s=!1,l=!0,o=As}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r.isClamp=s,r.isWidth=l,r}return a(n,[{key:"apply",value:function(e,t,n,i){if(1==this.isClamp){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y}1==this.isWidth&&(this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height),e.applyFilter(this,t,n,i)}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"halftone_size",get:function(){return this.uniforms.halftone_size},set:function(e){this.uniforms.halftone_size=e}},{key:"silhouette_amount",get:function(){return this.uniforms.silhouette_amount},set:function(e){this.uniforms.silhouette_amount=e}},{key:"sunburst_amount",get:function(){return this.uniforms.sunburst_amount},set:function(e){this.uniforms.sunburst_amount=e}},{key:"grain_amount",get:function(){return this.uniforms.grain_amount},set:function(e){this.uniforms.grain_amount=e}}]),n}(),Xs="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = vec4(vec3(BContrastLeg(inputImage.rgb,1.0,1.8)),inputImage.a);\n}\n",Ws=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Xs)).padding=0,e}return n}(),Ys="#define GLSLIFY 1\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float contrast;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 sigmoidimg = sigmoid(inputImage.rgb, 0.75, contrast);\n    vec3 bwM3 = vec3(getLumo(sigmoidimg));\n    vec3 rbd = vec3(0.81, 0.78, 0.69);\n    vec3 oBlend = overlayBlend(rbd, bwM3) * 0.85 + bwM3 * (1.0 - 0.85);\n\n    gl_FragColor = vec4(oBlend*inputImage.a, inputImage.a);\n}\n",qs="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(duotone(sThreshold, vec3(1.0), vec3(0.21, 0.18, 0.16))*inputImage.a, inputImage.a);\n}\n",Ks="#define GLSLIFY 1\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone(vec3(result),color1,color2);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.8),vec3(1.0));\n    vec3 colorImg = vec3(0.24, 0.18, 0.13);\n    vec3 hlBlend = hardLightBlend(blurImage.rgb, colorImg);\n    vec3 oBlend = overlayBlend(noiseImg, hlBlend);\n\n    gl_FragColor = vec4(lightenBlend(oBlend, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",Qs="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n    sThreshold.r = inputImage.r;\n\n    gl_FragColor = vec4(darkenBlend(sThreshold, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",Zs="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.55, 0.44, 0.24));\n\n    gl_FragColor = vec4(hardLightBlend(duoToneImg, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",Js="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(vec3(textureImage.rgb * sThreshold)*inputImage.a, inputImage.a);\n}\n",$s="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise(n/32.)*0.5875+noise(n/16.)*0.2+noise(n/8.)*0.1\n            +noise(n/4.)*0.05+noise(n/2.)*0.025+noise(n)*0.0125;\n \treturn duotone_1(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 sThreshold = vec3(smoothThresholdLeg(bwmode2,silhouette_amount/255.0,0.1));\n    vec3 duoToneImg = duotone_0(sThreshold, vec3(0.85, 0.65, 0.41), vec3(0.0));\n\n    //use for perlinnoise\n    //perlinNoise(50, 50, 4, 150, true, true, 7, true);\n\n     vec2 uv = mapCoord(vTextureCoord,filterArea);\n     vec3 perlinNoiseImg = perlinNoise(uv,0.6,vec3(0.8),vec3(0.2));\n\n    //vec3 perlinNoiseImg = genNoise(vTextureCoord,vec3(0.0),vec3(1.0));\n    vec3 duoTonePerlinImg = duotone_0(perlinNoiseImg, vec3(0.0), vec3(0.62, 0.33, 0.19));\n\n    gl_FragColor = vec4(overlayBlend(duoTonePerlinImg, duoToneImg)*inputImage.a, inputImage.a);\n}\n",el="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 sThreshold = vec3(smoothThresholdLeg(bwmode2,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(vec3(textureImage.rgb * sThreshold)*inputImage.a, inputImage.a);\n}\n",tl="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 colorDodgeBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = colorDodgeBlendF(front.r,back.r);\n    result.g = colorDodgeBlendF(front.g,back.g);\n    result.b = colorDodgeBlendF(front.b,back.b);\n    return result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 sThreshold = vec3(smoothThresholdLeg(bwmode2,silhouette_amount/255.0,0.3));\n    vec3 duoToneImg = duotone(sThreshold, vec3(1.0), vec3(0.55, 0.44, 0.24));\n\n    gl_FragColor = vec4(colorDodgeBlend(textureImage.rgb, duoToneImg)*inputImage.a, inputImage.a);\n}\n",nl="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwmode2 = inputImage.bbb;\n\n    gl_FragColor = vec4(softLightBlend(textureImage.rgb, bwmode2)*inputImage.a, inputImage.a);\n}\n",il="#define GLSLIFY 1\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_0(vec3(result),color1,color2);\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 softLightBlend(vec3 front, vec3 back)\n{\n    vec3 result;\n    result.r = (front.r > 0.5) ? (1.0-(1.0-back.r)*(1.0-(front.r-0.5))) : (back.r * (front.r + 0.5));\n    result.g = (front.g > 0.5) ? (1.0-(1.0-back.g)*(1.0-(front.g-0.5))) : (back.g * (front.g + 0.5));\n    result.b = (front.b > 0.5) ? (1.0-(1.0-back.b)*(1.0-(front.b-0.5))) : (back.b * (front.b + 0.5));\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.3),vec3(0.6));\n    vec3 bwmode2 = inputImage.bbb;\n    vec3 duoToneImg = duotone_1(bwmode2, vec3(0.93,0.68,0.41), vec3(0.0));\n    //give blur duoToneImg\n    //BlurChange(duotone,3,7,7)\n    vec3 oBlend = overlayBlend(inputImage.rgb, duoToneImg);\n\n    gl_FragColor = vec4(softLightBlend(noiseImg, oBlend)*inputImage.a, inputImage.a);\n}\n",rl="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    vec3 duoToneImg = duotone(sThreshold, vec3(0.93, 0.68, 0.41), vec3(0.0));\n\n    gl_FragColor = vec4(hardLightBlend(duoToneImg, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",al="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n//\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwM1 = inputImage.ggg;\n    vec3 adaptiveContrast = BContrastLeg(bwM1,1.0,1.4);\n\n    gl_FragColor = vec4(hardLightBlend(adaptiveContrast,textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",ol="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float color_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwM3 = vec3(getLumo(inputImage.rgb));\n    vec3 hlBlend = hardLightBlend(textureImage.rgb, bwM3);\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,color_amount/255.0,0.4));\n\n    gl_FragColor = vec4(lightenBlend(blurImage.rgb, lightenBlend(sThreshold, hlBlend))*inputImage.a, inputImage.a);\n}\n",sl="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    vec3 duoToneImg = duotone(sThreshold, vec3(0.85, 0.65, 0.41), vec3(0.0));\n\n    gl_FragColor = vec4(screenBlend(duoToneImg, textureImage.rgb)*inputImage.a, inputImage.a);\n}\n",ll="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nvec3 duotone_2(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_0(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n//uniform sampler2D textureSampler;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 bwmode1 = inputImage.ggg;\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinNoiseImg = perlinNoise(uv,4.0,vec3(1.0),vec3(0.7));\n    vec3 cbBlend = colorBurnBlend(inputImage.rgb, perlinNoiseImg);\n\n    //use normal noise\n    vec3 noiseImg = genNoise(vTextureCoord,vec3(0.73),vec3(0.15));\n    vec3 hardBlend = hardLightBlend(bwmode1, noiseImg);\n\n    hardBlend = hardLightBlend(cbBlend,hardBlend);\n\n    gl_FragColor = vec4(vec3(hardBlend.b)*inputImage.a, inputImage.a);\n}\n",ul="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 genNoise(vec2 coord, vec3 color1, vec3 color2)\n{\n    float noise;\n    float a = 12.9898;\n    float c = 151.7182;\n    float d = 43758.5453;\n    float dt= dot(coord ,vec2(a,c));\n    float sn= mod(dt,3.14);\n    float result = fract(sin(sn) * d);\n    return duotone_1(vec3(result),color1,color2);\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 duotone_2(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat hash(vec2 n)\n{\n    return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);\n}\nfloat noise_0(vec2 n)\n{\n    vec2 fn = floor(n);\n    vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));\n\n    float h1 = mix(hash(fn),hash(fn+vec2(1,0)),sn.x);\n    float h2 = mix(hash(fn+vec2(0,1)),hash(fn+vec2(1)),sn.x);\n    return mix(h1,h2,sn.y);\n}\nvec3 perlinNoise(vec2 n, float amount,vec3 noiseColor, vec3 backColor)\n{\n    n /= amount;\n    float total;\n    total = noise_0(n/32.)*0.5875+noise_0(n/16.)*0.2+noise_0(n/8.)*0.1\n            +noise_0(n/4.)*0.05+noise_0(n/2.)*0.025+noise_0(n)*0.0125;\n \treturn duotone_2(vec3(total),noiseColor,backColor);\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n//uniform sampler2D textureSampler;\nuniform float grain_amount;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n    vec3 perlinN = perlinNoise(uv,grain_amount,vec3(0.8),vec3(0.2));\n    vec3 duoToneImg = duotone_0(perlinN, vec3(0.42, 0.34, 0.24), vec3(0.84, 0.71, 0.50));\n\n    vec3 sThreshold = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.3));\n\n    gl_FragColor = vec4(vec3(duoToneImg * sThreshold)*inputImage.a, inputImage.a);\n}\n",cl=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=ul,o=!1;switch(e){case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_2:o=!1,a=ll;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_4:o=!0,a=sl;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_5:o=!0,a=ol;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_6:o=!0,a=al;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_7:o=!0,a=rl;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_8:o=!1,a=il;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_9:o=!0,a=nl;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_10:o=!0,a=tl;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_11:o=!0,a=el;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_12:o=!1,a=$s;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_13:o=!0,a=Js;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_14:o=!0,a=Zs;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_15:o=!0,a=Qs;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_16:o=!0,a=Ks;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_17:o=!1,a=qs;break;case BFN.CONST.OLD_PHOTO_PRESETS.PRESET_18:o=!1,a=Ys}return(r=t.call(this,hr,a)).isUseClamp=o,r.currentPreset=e,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){if(!1!==this.isUseClamp){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y}e.applyFilter(this,t,n,i)}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"grain_amount",get:function(){return this.uniforms.grain_amount},set:function(e){this.uniforms.grain_amount=e}},{key:"silhouette_amount",get:function(){return this.uniforms.silhouette_amount},set:function(e){this.uniforms.silhouette_amount=e}},{key:"blur_amount",get:function(){return this.uniforms.blur_amount},set:function(e){this.uniforms.blur_amount=e}},{key:"color_amount",get:function(){return this.uniforms.color_amount},set:function(e){this.uniforms.color_amount=e}},{key:"contrast",get:function(){return this.uniforms.contrast},set:function(e){this.uniforms.contrast=e}}]),n}(),hl="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color1;\nuniform vec3 color2;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n\n    vec3 duoImage = duotone(inputImage.rgb, color1, color2);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = vec4(duoImage, inputImage.a);\n}\n",dl=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,hl)).padding=0,e}return a(n,[{key:"color1",get:function(){return this.uniforms.color1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}},{key:"color2",get:function(){return this.uniforms.color2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color2=e}}]),n}(),ml="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 bwimg = inputImage.rrr;\n    vec3 blueColor = vec3(0.43, 0.54, 0.57);\n\n    vec3 screen1 = screenBlend(bwimg, inputImage.rgb) * 0.4 + inputImage.rgb * (1.0 - 0.4);\n    vec3 bwM3 = vec3(getLumo(screen1));\n    vec3 overlayImg = overlayBlend(blueColor, bwM3);\n\n    gl_FragColor = vec4( (screenBlend(textureImage.rgb, overlayImg) * amount + overlayImg * (1.0 - amount))*inputImage.a , inputImage.a);\n}\n",pl="#define GLSLIFY 1\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float frost_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    float adjustedHighlights = 1.0 + 10.0 / 200.0;\n    vec3 bwimg = inputImage.rrr * adjustedHighlights;\n    vec4 normalTextBlend = mix(inputImage,textureImage,frost_amount);\n    vec3 hardBlend = hardLightBlend(bwimg, normalTextBlend.rgb);\n    vec3 blueColor = vec3(0.43, 0.54, 0.57);\n\n    gl_FragColor = vec4(overlayBlend(blueColor, hardBlend)*inputImage.a, inputImage.a);\n}\n",gl=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=pl;switch(e){case BFN.CONST.WINTER_PRESETS.PRESET_2:o=ml}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"frost_amount",get:function(){return this.uniforms.frost_amount},set:function(e){this.uniforms.frost_amount=e}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=e}}]),n}(),fl="#define GLSLIFY 1\nvec3 radialMask(vec2 coord, float amt, vec2 slideXY, vec2 res)\n{\n    vec2 onePixel = 1.0/res;\n    coord = coord + vec2(res.x*slideXY.x,res.y*slideXY.y);\n    float maskAmount = onePixel.x*amt;\n    float d = distance(res*0.5, coord)*maskAmount;\n    d= smoothstep(0.7,1.0,d);\n    return mix(vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0), vec3(d));\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float size;\nuniform float slide_vertical;\nuniform float slide_horizontal;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\nuniform vec2 resolutionXY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (blurImg.a > 0.0) {\n        blurImg.rgb /= blurImg.a;\n    }\n\n    vec2 uv = mapCoord(vTextureCoord,filterArea);\n\n    vec2 slide = vec2(-slide_horizontal,-slide_vertical);\n    vec3 rMask = radialMask(uv, size, slide,resolutionXY);\n\n    inputImage.rgb = mix(inputImage.rgb,blurImg.rgb,rMask)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",vl="#define GLSLIFY 1\nvec3 linearMask(vec2 coord, float amt, vec2 slideXY, float angleDegree)\n{\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord-vec2(0.5);\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord += vec2(0.5);\n    coord = coord + vec2(slideXY);\n    float vignetteAmount = amt;//onePixel.x*amt;\n    vec2 distPoint = vec2(coord.x,0.5);\n    float d = distance(distPoint, coord)*amt;\n    float smoothCalc = 15.425*exp(-0.277*amt);\n    d= smoothstep(0.7+smoothCalc/50.0,1.0,d);\n    return vec3(d);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float size;\nuniform float angle;\nuniform float slide_vertical;\nuniform float clampX;\nuniform float clampY;\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (blurImg.a > 0.0) {\n        blurImg.rgb /= blurImg.a;\n    }\n\n    vec2 slide = vec2(0.0,-slide_vertical);\n    vec3 lMask = linearMask(vTextureCoord*vec2(clampX,clampY), size, slide,angle);\n\n    inputImage.rgb = mix(inputImage.rgb,blurImg.rgb,lMask)*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n",yl=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=vl;switch(e){case BFN.CONST.TILT_SHIFT_PRESETS.PRESET_2:o=fl}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.uniforms.resolutionXY=[n.destinationFrame.width,n.destinationFrame.height],e.applyFilter(this,t,n,i)}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"size",get:function(){return this.uniforms.size},set:function(e){this.uniforms.size=e}},{key:"blur_amount",get:function(){return this.uniforms.blur_amount},set:function(e){this.uniforms.blur_amount=e}},{key:"angle",get:function(){return this.uniforms.angle},set:function(e){this.uniforms.angle=e}},{key:"slide_vertical",get:function(){return this.uniforms.slide_vertical},set:function(e){this.uniforms.hasOwnProperty("slide_vertical")&&(this.uniforms.slide_vertical=e)}},{key:"slide_horizontal",get:function(){return this.uniforms.slide_horizontal},set:function(e){this.uniforms.hasOwnProperty("slide_horizontal")&&(this.uniforms.slide_horizontal=e)}}]),n}(),xl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float red;\nuniform float navy;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (blurImage.a > 0.0) {\n        blurImage.rgb /= blurImage.a;\n    }\n\n    red;navy;\n\n    vec3 color1 = vec3(0.984,0.886,0.647);\n    vec3 color2 = vec3(0.85,0.101,0.129);\n    vec3 color3 = vec3(0.0,0.2,0.298);\n    float whiteThreshold = 0.0;\n    float whiteThreshold2 = 0.0;\n\n    float brightness = (blurImage.r + blurImage.g + blurImage.b) / 3.0;\n\n    vec3 dst = vec3(0.0);\n\n    vec3 layer1 = vec3(0.0);\n    float blackThreshold = red;\n    float blackThreshold2 = navy;\n\n    if (brightness < blackThreshold) {\n        layer1.r = color2.r;\n        layer1.g = color2.g;\n        layer1.b = color2.b;\n        dst = layer1;\n    } else if (brightness > whiteThreshold) {\n        // Above threshold\n        layer1.r = color1.r;\n        layer1.g = color1.g;\n        layer1.b = color1.b;\n        dst = layer1;\n    } else {\n        // Between the threshold\n        layer1.rgb = vec3((brightness - blackThreshold) / (whiteThreshold - blackThreshold));\n        dst = layer1;\n    }\n\n    vec3 layer2 = vec3(0.0);\n    if (brightness < blackThreshold2) {\n        // Below threshold\n        layer2.r = color3.r;\n        layer2.g = color3.g;\n        layer2.b = color3.b;\n        dst=layer2;\n    } else if (brightness > whiteThreshold2) {\n        // Above threshold\n        layer2.r = layer1.r;\n        layer2.g = layer1.g;\n        layer2.b = layer1.b;\n        dst=layer2;\n    } else {\n        // Between the threshold\n        layer2.rgb = vec3((brightness - blackThreshold2) / (whiteThreshold2 - blackThreshold2));\n        dst=layer2;\n    }\n\n    gl_FragColor = vec4(dst.rgb*blurImage.a, blurImage.a);\n}\n",_l="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec2 gridDot(vec2 px, vec2 dSize)\n{\n\treturn floor(mod(px,dSize));\n\t//return floor( px / dSize ) * dSize;\n}\n\nvec4 repeatTexture(sampler2D sourceImage, vec2 sourceCoord, vec4 filterA, float texSize, vec2 clampXY, float tileSize){\n\n    vec2 uv = mapCoord(sourceCoord,filterA);\n    uv = floor(gridDot(uv,vec2(texSize*tileSize))/tileSize);\n    uv = unmapCoord(uv,filterA);\n    return texture2D(sourceImage, uv* vec2(clampXY.x,clampXY.y));\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D starSampler;\n\nuniform float silhouette_amount;\nuniform float color_space;\nuniform float star_size;\n\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 smooth1 = smoothThreshold(inputImage.rgb,silhouette_amount/255.0,150.0/255.0);\n\n    vec4 starImage = repeatTexture(starSampler,vTextureCoord,filterArea,256.0,vec2(clampX,clampY),star_size);\n\n    starImage.rgb = duotone(starImage.rgb,vec3(1.0),vec3(0.98, 0.94, 0.51));\n\n    smooth1 = clamp(smooth1*textureImage.rgb,0.0,1.0);\n\n    smooth1 = clamp(smooth1*starImage.rgb,0.0,1.0);\n\n    inputImage.rgb = smooth1;\n\n    inputImage.rgb = hueAdjust(inputImage.rgb,color_space)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Il="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n    vec3 bwM3 = vec3(getLumo(asImage.rgb));\n   gl_FragColor = vec4(vec3(textureImage.rgb * bwM3)*inputImage.a, inputImage.a);\n}\n",Tl="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n    gl_FragColor = vec4(vec3(textureImage.rgb * asImage.rgb)*inputImage.a, inputImage.a);\n}\n",bl="#define GLSLIFY 1\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord_0( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec3 stripedLines(vec2 coord,vec4 fArea, float size, float degree, vec3 lineColor, vec3 backColor)\n{\n    coord = mapCoord_0(coord,fArea);\n    float radianValue = radians(degree); //clockwise\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord.x = coord.x/size;\n    float temp = mod(coord.x, 1.0);\n    temp = (temp<0.5)?temp=pow(temp,2.5)*2.0:temp = pow(1.0-temp,2.5)*1.0;\n\ttemp = smoothstep(0.00+min(size/1250.0,0.04),0.05,temp);\n\treturn duotone_1(vec3(temp),backColor,lineColor);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord_1( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord_1(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_0(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float halftone_size;\nuniform float line_width;\nuniform float line_angle;\nuniform vec3 line_color;\nuniform vec3 background_color;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 bwM3 = vec3(getLumo_1(inputImage.rgb));\n    vec3 adaptiveContrast = BContrastLeg(bwM3,1.0,3.0);\n\n    vec3 lines = stripedLines(vTextureCoord,filterArea,line_width,line_angle,background_color,line_color);\n    vec3 lineBlend = overlayBlend(lines, adaptiveContrast);\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.6),vec3(1.0));\n\n    gl_FragColor = vec4(overlayBlend(halftoneImg, lineBlend)*inputImage.a, inputImage.a);\n}\n",Sl="#define GLSLIFY 1\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float color_space;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 smooth1 = smoothThreshold(inputImage.rgb,silhouette_amount/255.0,150.0/255.0);\n    vec3 smooth2 = smoothThreshold(inputImage.rgb,165.0/255.0,186.0/255.0);\n\n    smooth1 = duotone(smooth1,vec3(1.0),vec3(0.19, 0.67, 1.00));\n    smooth2 = duotone(smooth2,vec3(1.0),vec3(0.90, 0.47, 0.49));\n\n    inputImage.rgb = clamp(smooth1*smooth2,0.0,1.0);\n    inputImage.rgb = hueAdjust(inputImage.rgb,color_space)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Cl="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nfloat smoothThresholdLeg(vec3 inpImg, float thresholdAmount, float smoothness)\n{\n\tvec3 Lum = vec3(0.2125, 0.7154, 0.0721);\n\tfloat luminance = dot(inpImg, Lum);\n\tfloat thresholdResult = smoothstep(max(thresholdAmount-smoothness,0.0),min(thresholdAmount+smoothness,1.0),luminance);\n\treturn thresholdResult;\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform float silhouette_amount;\nuniform float color_space;\nuniform float clampX;\nuniform float clampY;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    silhouette_amount;color_space;\n\n    vec4 fillColor = vec4(1);\n    vec2 clampValues = vec2(clampX, clampY);\n    vec2 onePixel = 1.0/filterArea.xy;\n\n   vec3 smooth3 = vec3(smoothThresholdLeg(inputImage.rgb,silhouette_amount/255.0,0.2));\n\n   vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.035, 0.0400), vec2(1.0, 1.0), clampValues, 1,0, fillColor);\n   vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(-0.030, -0.022), vec2(1.0, 1.0), clampValues, 1,0, fillColor);\n\n   vec3 smooth1 = vec3(smoothThreshold(inputImage1.rgb,102.0/255.0,0.5));\n   vec3 smooth2 = vec3(smoothThreshold(inputImage2.rgb,102.0/255.0,0.5));\n\n   smooth1 = duotone(smooth1,vec3(1.0),vec3(0.84, 0.92, 1.00));\n   smooth2 = duotone(smooth2,vec3(1.0),vec3(1.00, 0.62, 0.70));\n\n   vec3 result = smooth1*smooth2*smooth3;\n\n   inputImage.rgb = clamp(smooth1*smooth2,0.0,1.0);\n   inputImage.rgb = clamp(inputImage.rgb*smooth3,0.0,1.0);\n   inputImage.rgb = clamp(inputImage.rgb*textureImage.rgb,0.0,1.0);\n   inputImage.rgb = hueAdjust(inputImage.rgb,color_space)*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Bl=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=!0,o=hr,s=Cl;switch(e){case BFN.CONST.PATRIOTIC_PRESETS.PRESET_2:a=!1,s=Sl;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_3:s=bl;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_4:s=Tl;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_5:s=Il;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_6:s=_l;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_7:s=xl}return(r=t.call(this,o,s)).isClamp=a,r.padding=0,r.currentPreset=e,r}return a(n,[{key:"apply",value:function(e,t,n,i){if(1==this.isClamp){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y}e.applyFilter(this,t,n,i)}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"blurImage",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"adaptiveSharpenSampler",get:function(){return this.uniforms.adaptiveSharpenSampler},set:function(e){this.uniforms.adaptiveSharpenSampler=e}},{key:"starSampler",get:function(){return this.uniforms.starSampler},set:function(e){this.uniforms.starSampler=e}},{key:"silhouette_amount",get:function(){return this.uniforms.silhouette_amount},set:function(e){this.uniforms.silhouette_amount=e}},{key:"color_space",get:function(){return this.uniforms.color_space},set:function(e){this.uniforms.color_space=e}},{key:"halftone_size",get:function(){return this.uniforms.halftone_size},set:function(e){this.uniforms.halftone_size=e}},{key:"line_width",get:function(){return this.uniforms.line_width},set:function(e){this.uniforms.line_width=e}},{key:"line_angle",get:function(){return this.uniforms.line_angle},set:function(e){this.uniforms.line_angle=e}},{key:"line_color",get:function(){return this.uniforms.line_color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.line_color=e}},{key:"background_color",get:function(){return this.uniforms.background_color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.background_color=e}},{key:"star_size",get:function(){return this.uniforms.star_size},set:function(e){this.uniforms.star_size=e}},{key:"red",get:function(){return this.uniforms.red},set:function(e){this.uniforms.red=e}},{key:"navy",get:function(){return this.uniforms.navy},set:function(e){this.uniforms.navy=e}}]),n}(),Fl="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 = linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient3(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, float step1, float step2, float step3) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n    vec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n    outputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 linGradImage = linearGradient3(vTextureCoord,vec2(clampX,clampY),180.0,1.0,vec3(0.039,0.0,0.69),vec3(1.0,0.0,0.0),vec3(1.0,0.98,0.0),0.0,0.5,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    gl_FragColor = vec4(overlayBlend(linGradImage, smoothBd), inputImage.a);\n}\n",El="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient4(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, vec3 c4, float step1, float step2, float step3, float step4) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n    vec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n    outputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n    outputColor = mix(outputColor, c4, genSmoothStep(step3, step4, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 halftoneImage = texture2D(halftoneSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 c1 = vec3(0.0,1.0,1.0);\n    vec3 c2 = vec3(0.0,1.0,0.0);\n    vec3 c3 = vec3(1.0,1.0,0.0);\n    vec3 c4 = vec3(1.0,0.0,0.0);\n\n    vec3 linGradImage = linearGradient4(vTextureCoord,vec2(clampX,clampY),90.0,1.0,c1,c2,c3,c4,0.0,0.5,0.75,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    halftoneImage = clamp(halftoneImage,0.0,1.0);\n    vec3 darkenImg = darkenBlend(linGradImage, smoothBd);\n\n    gl_FragColor = vec4(overlayBlend(halftoneImage.rgb, darkenImg) * 0.40 + darkenImg * (1.0 - 0.40), inputImage.a);\n}\n",Pl="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient7(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, vec3 c4, vec3 c5, vec3 c6, vec3 c7,\nfloat step1, float step2, float step3, float step4, float step5, float step6, float step7) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n   \tvec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c4, genSmoothStep(step3, step4, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c5, genSmoothStep(step4, step5, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c6, genSmoothStep(step5, step6, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c7, genSmoothStep(step6, step7, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 c1 = vec3(1.0, 0.0, 0.0);\n    vec3 c2 = vec3(1.0, 0.0, 0.41);\n    vec3 c3 = vec3(1.0, 0.0, 1.0);\n    vec3 c4 = vec3(0.51, 0.0, 1.0);\n    vec3 c5 = vec3(0.0, 0.0, 1.0);\n    vec3 c6 = vec3(0.0, 1.0, 0.0);\n    vec3 c7 = vec3(1.0, 0.54, 0.0);\n\n    vec3 linGradImage = linearGradient7(vTextureCoord,vec2(clampX,clampY),135.0,0.0,c1,c2,c3,c4,c5,c6,c7,0.0,0.15,0.33,0.5,0.66,0.84,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    gl_FragColor = vec4(overlayBlend(linGradImage.rgb, smoothBd), inputImage.a);\n}\n",kl="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient7(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, vec3 c4, vec3 c5, vec3 c6, vec3 c7,\nfloat step1, float step2, float step3, float step4, float step5, float step6, float step7) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n   \tvec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c4, genSmoothStep(step3, step4, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c5, genSmoothStep(step4, step5, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c6, genSmoothStep(step5, step6, coord.y,intrpMode));\n   \toutputColor = mix(outputColor, c7, genSmoothStep(step6, step7, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 c1 = vec3(1.0, 0.0, 0.0);\n    vec3 c2 = vec3(1.0, 0.0, 1.0);\n    vec3 c3 = vec3(0.0, 0.0, 1.0);\n    vec3 c4 = vec3(0.0, 1.0, 1.0);\n    vec3 c5 = vec3(0.0, 1.0, 0.0);\n    vec3 c6 = vec3(1.0, 1.0, 0.0);\n    vec3 c7 = vec3(1.0, 0.0, 0.0);\n\n    vec3 linGradImage = linearGradient7(vTextureCoord,vec2(clampX,clampY),135.0,0.0,c1,c2,c3,c4,c5,c6,c7,0.0,0.15,0.33,0.5,0.66,0.84,1.0);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n\n    gl_FragColor = vec4(darkenBlend(linGradImage, smoothBd), inputImage.a);\n}\n",Nl="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\n//we may want linear interpolation, opengl does hermite. 1.0 = linear else hermite\nfloat genSmoothStep(float edge0, float edge1, float x, float mode) {\n  if(mode==1.0) {\n    return clamp((x - edge0)/(edge1 - edge0), 0.0, 1.0);\n  }\n  else {\n    return smoothstep(edge0,edge1,x);\n  }\n\n}\n\nvec3 linearGradient3(vec2 coord, vec2 clampXY, float angleDegree, float intrpMode, vec3 c1, vec3 c2, vec3 c3, float step1, float step2, float step3) {\n\n    //rotation\n    coord = coord * clampXY;\n    float radianValue = radians(angleDegree); //clockwise\n    coord = coord -0.5;\n    coord *= mat2(cos(radianValue), -sin(radianValue), sin(radianValue), cos(radianValue));\n    coord = coord+0.5;\n\n    vec3 outputColor = mix(c1, c2, genSmoothStep(step1, step2, coord.y,intrpMode));\n    outputColor = mix(outputColor, c3, genSmoothStep(step2, step3, coord.y,intrpMode));\n\n    return outputColor;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float silhouette_amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec3 linGradImage = linearGradient3(vTextureCoord,vec2(clampX,clampY),180.0,1.0,vec3(0.039,0.0,0.69),vec3(1.0,0.0,0.0),vec3(1.0,0.98,0.0),0.0,0.5,1.0);\n    float sAmount = silhouette_amount/255.0;\n    vec3 smoothBd = smoothThreshold(inputImage.rgb,sAmount,1.0);\n    gl_FragColor = vec4(screenBlend(linGradImage, smoothBd)*inputImage.a, inputImage.a);\n}\n",Ml="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nfloat colorBurnBlendF(float front, float back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    return (((2.0 * front) == 0.0) ? (2.0 * front) : max((1.0 - ((1.0 - back) / (2.0 * front))), 0.0));\n}\n\nvec3 colorBurnBlend(vec3 front, vec3 back)\n{\n    //return 1.0 - (1.0 - back) / front;\n    //return (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n      vec3 result;\n        result.r = colorBurnBlendF(front.r,back.r);\n        result.g = colorBurnBlendF(front.g,back.g);\n        result.b = colorBurnBlendF(front.b,back.b);\n        return result;\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n   //vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    if (inputImage1.a > 0.0) {\n        inputImage1.rgb /= inputImage1.a;\n        inputImage2.rgb /= inputImage2.a;\n        inputImage3.rgb /= inputImage3.a;\n        inputImage4.rgb /= inputImage4.a;\n    }\n\n    float sAmount = silhouette_amount/255.0;\n\n    inputImage1.rgb = smoothThreshold(inputImage1.rgb,sAmount,0.5);\n    inputImage2.rgb = smoothThreshold(inputImage2.rgb,sAmount,0.5);\n    inputImage3.rgb = smoothThreshold(inputImage3.rgb,sAmount,0.5);\n    inputImage4.rgb = smoothThreshold(inputImage4.rgb,sAmount,0.5);\n\n    inputImage1.rgb = duotone(inputImage1.rgb,vec3(0.71, 1.0, 0.64),vec3(0.68, 0.20, 0.20));\n    inputImage2.rgb = duotone(inputImage2.rgb,vec3(0.0, 0.90, 1.0),vec3(0.49, 0.11, 0.36));\n    inputImage3.rgb = duotone(inputImage3.rgb,vec3(1.0, 0.97, 0.0),vec3(0.0, 0.47, 0.83));\n    inputImage4.rgb = duotone(inputImage4.rgb,vec3(1.0, 0.48, 0.93),vec3(0.0, 0.47, 0.07));\n\n    inputImage1.rgb = colorBurnBlend(halftoneImage1.rgb, inputImage1.rgb)*inputImage1.a;\n    inputImage2.rgb = colorBurnBlend(halftoneImage2.rgb, inputImage2.rgb)*inputImage2.a;\n    inputImage3.rgb = colorBurnBlend(halftoneImage3.rgb, inputImage3.rgb)*inputImage3.a;\n    inputImage4.rgb = colorBurnBlend(halftoneImage4.rgb, inputImage4.rgb)*inputImage4.a;\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n}\n",Dl="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\n\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputImage1 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 inputImage2 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 inputImage3 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 inputImage4 = offsetPixel(adaptiveSharpenSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    inputImage1.rgb = mix(inputImage1.rgb,duotone(inputImage1.bbb,vec3(0.71, 1.0, 0.64),vec3(0.68, 0.20, 0.20)),1.0)*inputImage1.a;\n    inputImage2.rgb = mix(inputImage2.rgb,duotone(inputImage2.bbb,vec3(0.61, 1.0, 0.96),vec3(0.80, 0.21, 1.0)),1.0)*inputImage2.a;\n    inputImage3.rgb = mix(inputImage3.rgb,duotone(inputImage3.bbb,vec3(1.0, 0.97, 0.49),vec3(0.0, 0.53, 1.0)),1.0)*inputImage3.a;\n    inputImage4.rgb = mix(inputImage4.rgb,duotone(inputImage4.bbb,vec3(1.0, 0.73, 0.96),vec3(0.18, 0.48, 0.0)),1.0)*inputImage4.a;\n\n    inputImage.rgb = inputImage1.rgb + inputImage2.rgb +inputImage3.rgb + inputImage4.rgb;\n\n    gl_FragColor = vec4(inputImage.rgb,(inputImage1.a+inputImage2.a+inputImage3.a+inputImage4.a));\n}\n",wl="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float silhouette_amount;\nuniform vec3 color_value_1;\nuniform vec3 color_value_2;\nuniform vec3 color_value_3;\nuniform vec3 color_value_4;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    vec4 blurImage1 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage2 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage3 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage4 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    float sAmount = silhouette_amount/255.0;\n    vec3 smooth1 = smoothThreshold(blurImage1.rgb,sAmount,0.5);\n    vec3 smooth2 = smoothThreshold(blurImage2.rgb,sAmount,0.5);\n    vec3 smooth3 = smoothThreshold(blurImage3.rgb,sAmount,0.5);\n    vec3 smooth4 = smoothThreshold(blurImage4.rgb,sAmount,0.5);\n\n    inputImage1.rgb = mix(inputImage1.rgb,duotone(smooth1,color_value_1,vec3(0.0)),1.0)*inputImage1.a;\n    inputImage2.rgb = mix(inputImage2.rgb,duotone(smooth2,color_value_2,vec3(0.0)),1.0)*inputImage2.a;\n    inputImage3.rgb = mix(inputImage3.rgb,duotone(smooth3,color_value_3,vec3(0.0)),1.0)*inputImage3.a;\n    inputImage4.rgb = mix(inputImage4.rgb,duotone(smooth4,color_value_4,vec3(0.0)),1.0)*inputImage4.a;\n\n    //inputImage.rgb = duo1 + duo2 + duo3 + duo4;\n    //inputImage.rgb = smooth1 + smooth2 + smooth3 + smooth4;\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n}\n",Ll="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_1(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 gradientImage = texture2D(gradientSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    float sAmount = silhouette_amount/255.0;\n\n    inputImage1.rgb = smoothThreshold(inputImage1.rgb,sAmount,0.5);\n    inputImage2.rgb = smoothThreshold(inputImage2.rgb,sAmount,0.5);\n    inputImage3.rgb = smoothThreshold(inputImage3.rgb,sAmount,0.5);\n    inputImage4.rgb = smoothThreshold(inputImage4.rgb,sAmount,0.5);\n\n//    inputImage1.rgb = duotone(inputImage1.rgb,vec3(0.71, 1.0, 0.64),vec3(0.68, 0.20, 0.20));\n//    inputImage2.rgb = duotone(inputImage2.rgb,vec3(0.0, 0.90, 1.0),vec3(0.49, 0.11, 0.36));\n//    inputImage3.rgb = duotone(inputImage3.rgb,vec3(1.0, 0.97, 0.0),vec3(0.0, 0.47, 0.83));\n//    inputImage4.rgb = duotone(inputImage4.rgb,vec3(1.0, 0.48, 0.93),vec3(0.0, 0.47, 0.07));\n\n    inputImage1.rgb = clamp(inputImage1.rgb*halftoneImage1.rgb,0.0,1.0);\n    inputImage2.rgb = clamp(inputImage2.rgb*halftoneImage2.rgb,0.0,1.0);\n    inputImage3.rgb = clamp(inputImage3.rgb*halftoneImage3.rgb,0.0,1.0);\n    inputImage4.rgb = clamp(inputImage4.rgb*halftoneImage4.rgb,0.0,1.0);\n\n    float onePixelY = 1.0/filterArea.y;\n//    vec3 gradResult = gradientMap(inputImage.rgb,gradientSampler,filterArea,clampX,onePixelY*17.0);\n\n    inputImage1.rgb = gradientMap(inputImage1.rgb,gradientSampler,filterArea,clampX,onePixelY*2.0*clampY)*inputImage1.a;\n    inputImage2.rgb = gradientMap(inputImage2.rgb,gradientSampler,filterArea,clampX,onePixelY*7.0*clampY)*inputImage2.a;\n    inputImage3.rgb = gradientMap(inputImage3.rgb,gradientSampler,filterArea,clampX,onePixelY*12.0*clampY)*inputImage3.a;\n    inputImage4.rgb = gradientMap(inputImage4.rgb,gradientSampler,filterArea,clampX,onePixelY*17.0*clampY)*inputImage4.a;\n\n//    inputImage1.rgb = darkenBlend(inputImage1.rgb, halftoneImage1.rgb);\n//    inputImage2.rgb = darkenBlend(inputImage2.rgb, halftoneImage2.rgb);\n//    inputImage3.rgb = darkenBlend(inputImage3.rgb, halftoneImage3.rgb);\n//    inputImage4.rgb = darkenBlend(inputImage4.rgb, halftoneImage4.rgb);\n\n    //gradient maps\n\n    gl_FragColor = inputImage1+inputImage2+inputImage3+inputImage4;\n}\n",Ol="#define GLSLIFY 1\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvec3 quantize(vec3 inpImg, float palette, float lightness) {\n\tinpImg = inpImg*lightness;\n\treturn floor(inpImg*floor(float(palette)))/floor(float(palette));\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nfloat getLumo_3(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_3(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lumoBlend(vec3 back, vec3 front) {\n\n    return vec3(setlum(back.rgb, getLumo_1(front.rgb)));\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 hueAdjust(vec3 inpImg, float hue)\n{\n    float pi = 3.14159265;\n\tfloat ang = (hue / 180.0) * pi;\n    float s = sin(ang), c = cos(ang);\n    vec3 weight = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n    return vec3(dot(inpImg, weight.xyz), dot(inpImg, weight.zxy), dot(inpImg, weight.yzx));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D halftoneSampler;\nuniform float color_detail;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 halftoneImage = texture2D(halftoneSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    vec4 blurImage1 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage2 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage3 = offsetPixel(blurSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 blurImage4 = offsetPixel(blurSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    blurImage1.rgb = quantize(blurImage1.rgb,color_detail,1.0);\n    blurImage2.rgb = quantize(blurImage2.rgb,color_detail,1.0);\n    blurImage3.rgb = quantize(blurImage3.rgb,color_detail,1.0);\n    blurImage4.rgb = quantize(blurImage4.rgb,color_detail,1.0);\n\n    blurImage1.rgb = lumoBlend(inputImage1.rgb,blurImage1.rgb);\n    blurImage2.rgb = lumoBlend(inputImage2.rgb,blurImage2.rgb);\n    blurImage3.rgb = lumoBlend(inputImage3.rgb,blurImage3.rgb);\n    blurImage4.rgb = lumoBlend(inputImage4.rgb,blurImage4.rgb);\n\n    blurImage1.rgb = hardLightBlend(blurImage1.rgb,halftoneImage1.rgb);\n    blurImage2.rgb = hardLightBlend(blurImage2.rgb,halftoneImage2.rgb);\n    blurImage3.rgb = hardLightBlend(blurImage3.rgb,halftoneImage3.rgb);\n    blurImage4.rgb = hardLightBlend(blurImage4.rgb,halftoneImage4.rgb);\n\n    blurImage1.rgb = hueAdjust(blurImage1.rgb,15.0);\n    blurImage2.rgb = hueAdjust(blurImage2.rgb,65.0);\n    blurImage3.rgb = hueAdjust(blurImage3.rgb,-15.0);\n    blurImage4.rgb = hueAdjust(blurImage4.rgb,160.0);\n\n    inputImage.rgb = blurImage1.rgb+blurImage2.rgb+blurImage3.rgb+blurImage4.rgb;\n\n    gl_FragColor = vec4(inputImage.rgb,(inputImage1.a+inputImage2.a+inputImage3.a+inputImage4.a));\n}\n",Rl="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D halftoneSampler;\nuniform float silhouette_amount;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 halftoneImage = texture2D(halftoneSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n    vec2 scaleFactor = vec2(0.5,0.5);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 halftoneImage1 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage2 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage3 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n    vec4 halftoneImage4 = offsetPixel(halftoneSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,1, fillColor);\n\n    vec4 inputImage1 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage2 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.0), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage3 = offsetPixel(uSampler, vTextureCoord, vec2(0.0, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n    vec4 inputImage4 = offsetPixel(uSampler, vTextureCoord, vec2(0.5, 0.5), scaleFactor, clampValues, 0,0, fillColor);\n\n    float sAmount = silhouette_amount/255.0;\n\n    inputImage1.rgb = smoothThreshold(inputImage1.rgb,sAmount,0.5);\n    inputImage2.rgb = smoothThreshold(inputImage2.rgb,sAmount,0.5);\n    inputImage3.rgb = smoothThreshold(inputImage3.rgb,sAmount,0.5);\n    inputImage4.rgb = smoothThreshold(inputImage4.rgb,sAmount,0.5);\n\n    vec4 grid1 = halftoneImage1*inputImage1;\n    vec4 grid2 = halftoneImage2*inputImage2;\n    vec4 grid3 = halftoneImage3*inputImage3;\n    vec4 grid4 = halftoneImage4*inputImage4;\n\n    grid1.rgb = duotone(grid1.rgb,vec3(0.00, 0.81, 0.00),vec3(0.0));\n    grid2.rgb = duotone(grid2.rgb,vec3(0.00, 0.90, 1.00),vec3(0.0));\n    grid3.rgb = duotone(grid3.rgb,vec3(1.00, 0.97, 0.00),vec3(0.0));\n    grid4.rgb = duotone(grid4.rgb,vec3(1.00, 0.35, 0.56),vec3(0.0));\n\n    inputImage = grid1+grid2+grid3+grid4;\n\n     gl_FragColor = inputImage;\n}\n",Al="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_0(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_0(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform sampler2D gradientSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.5),vec3(1.0));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_2(asImage.rgb)));\n    overlayImg = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n\n    vec2 clampValues = vec2(clampX,clampY);\n    vec3 greenOffset = offsetPixel(uSampler, vTextureCoord, vec2(-0.15*clampX, -0.08*clampY), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    greenOffset = smoothThreshold(greenOffset,0.4,0.5);\n    greenOffset = duotone_1(greenOffset,vec3(1.0),vec3(0.73, 1.00, 1.00));\n\n    vec3 yellowOffset = offsetPixel(uSampler, vTextureCoord, vec2(0.15*clampX, 0.08*clampY), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    yellowOffset = smoothThreshold(yellowOffset,0.4,0.5);\n    yellowOffset = duotone_1(yellowOffset,vec3(1.0),vec3(1.00, 0.61, 0.61));\n\n    overlayImg = hardLightBlend(overlayImg,yellowOffset);\n    overlayImg = clamp(greenOffset*overlayImg,0.0,1.0);\n\n    inputImage.rgb = overlayImg*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Vl="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_0(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_2(asImage.rgb)));\n    vec3 gradResult = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n    gradResult = hardLightBlend(gradResult,textureImage.rgb);\n\n    inputImage.rgb = gradResult*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Ul="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_0(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.5),vec3(1.0));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_1(asImage.rgb)));\n    overlayImg = duotone_1(overlayImg,vec3(1.0),vec3(0.18, 0.38, 0.93));\n\n    vec2 clampValues = vec2(clampX,clampY);\n    vec3 greenOffset = offsetPixel(uSampler, vTextureCoord, vec2(-0.08*clampX, 0.0), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    greenOffset = smoothThreshold(greenOffset,0.4,0.5);\n    greenOffset = duotone_1(greenOffset,vec3(1.0),vec3(0.67, 1.00, 0.87));\n\n    vec3 yellowOffset = offsetPixel(uSampler, vTextureCoord, vec2(0.08*clampX, 0.08*clampY), vec2(1.0), clampValues,0,0,vec4(1.0)).rgb;\n    yellowOffset = smoothThreshold(yellowOffset,0.4,0.5);\n    yellowOffset = duotone_1(yellowOffset,vec3(1.0),vec3(0.87, 1.00, 0.64));\n\n    overlayImg = clamp(yellowOffset*overlayImg,0.0,1.0);\n    overlayImg = clamp(greenOffset*overlayImg,0.0,1.0);\n\n    inputImage.rgb = overlayImg*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",Gl="#define GLSLIFY 1\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 saturation(vec3 inpImg, float satAmount) {\n\n    //SATURATION ADJUST\n    float avg = (inpImg.r + inpImg.g + inpImg.b) / 3.0;\n    if (satAmount > 0.0) {\n     inpImg.rgb += (avg - inpImg.rgb) * (1.0 - 1.0 / (1.001 - satAmount/2.0));\n    } else {\n     inpImg.rgb += (avg - inpImg.rgb) * (-satAmount);\n    }\n    return inpImg;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.5),vec3(1.0));\n    asImage.rgb = saturation(asImage.rgb,0.8);\n\n    asImage.rgb = hardLightBlend(asImage.rgb,halftoneImg);\n    inputImage.rgb = asImage.rgb*inputImage.a;\n    gl_FragColor = inputImage;\n}\n",Hl="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_0(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nuniform float halftone_size;\nuniform float detail_level;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    halftoneImg = smoothThreshold(halftoneImg,117.0/255.0,1.0);\n    halftoneImg = overlayBlend(halftoneImg,inputImage.rgb);\n\n    // Sketch\n    float inputDesat = getLumo_1(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo_1(blurImage.rgb),0.0,1.0);\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level/255.0,1.0);\n    bringDetails = duotone_0(bringDetails,vec3(1.0),vec3(0.42, 0.00, 0.00));\n    bringDetails = clamp(bringDetails*textureImage.rgb,0.0,1.0);\n    bringDetails = darkenBlend(halftoneImg,bringDetails);\n\n    halftone_size;detail_level;\n\n    inputImage.rgb = bringDetails*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",zl="#define GLSLIFY 1\nvec3 duotone_1(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone_1(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_2(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 duotone_0(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D textureSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nuniform float halftone_size;\nuniform float detail_level;\nuniform vec4 filterArea;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_0(asImage.rgb)));\n    vec3 gradResult = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n\n    // Sketch\n    float inputDesat = getLumo_0(inputImage.rgb);\n    float blurDesatInvert = clamp(1.0-getLumo_0(blurImage.rgb),0.0,1.0);\n    float sketch = colorDodgeBlendF(blurDesatInvert,inputDesat);\n    vec3 bringDetails = smoothThreshold(vec3(sketch),detail_level/255.0,1.0);\n    bringDetails = duotone_0(bringDetails,vec3(1.0),vec3(0.42, 0.00, 0.00));\n    bringDetails = clamp(bringDetails*textureImage.rgb,0.0,1.0);\n    bringDetails = overlayBlend(gradResult,bringDetails);\n\n    halftone_size;detail_level;\n\n    gl_FragColor = vec4(bringDetails*inputImage.a, inputImage.a);\n}\n",jl="#define GLSLIFY 1\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec2 gridDot(vec2 px, float dSize)\n{\n\treturn floor( px / dSize ) * dSize;\n}\n\nvec3 halftone(sampler2D inpSampler, vec2 coord, vec4 fArea, vec2 cXcY, float dotSize, vec3 dot_color, vec3 bgColor)\n{\n    vec2 uv = mapCoord(coord,fArea);\n    vec2 onePixel = vec2(1.0/fArea.xy);\n\n    //clamp edges\n    vec2 clampEdges = vec2(1.0/cXcY.x-onePixel.x,1.0/cXcY.y-onePixel.y);\n\n    //create dot grid\n    vec2 pixelateGrid = gridDot(uv,dotSize) + 0.5*dotSize;\n    float s = min(length(uv-pixelateGrid)/((dotSize)*0.5), 1.0);\n\n    //create color grid\n    pixelateGrid = unmapCoord(pixelateGrid,fArea);\n    vec3 texc = texture2D(inpSampler, clamp(pixelateGrid,vec2(0.0),clampEdges)).rgb;\n\n    //get inverse of lumo for dot sizing\n    float lumoImage = 1.0-getLumo_1(texc);\n\n    //calculate dot sizing and smoothness\n    s = smoothstep(min(max(lumoImage,0.2),0.8),max(min(lumoImage+0.1,1.0),0.25),s);\n\n    vec3 result = duotone(vec3(s),bgColor,dot_color);\n\n    return result;\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gradientMap(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX, float yPosition) {\n\n    float lumoImage = clamp(getLumo_2(inpImage),0.0,1.0);\n    float pixelCoord = 255.0/fArea.x;\n    return texture2D(gradSampler,vec2(lumoImage*pixelCoord*clampXX,yPosition)).rgb;\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D gradientSampler;\nuniform sampler2D adaptiveSharpenSampler;\nuniform float halftone_size;\nuniform vec4 filterArea;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 gradientImage = texture2D(gradientSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 asImage = texture2D(adaptiveSharpenSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 halftoneImg = halftone(uSampler, vTextureCoord, filterArea, vec2(clampX, clampY), halftone_size, vec3(0.16),vec3(0.87));\n    vec3 overlayImg = overlayBlend(halftoneImg, vec3(getLumo_0(asImage.rgb)));\n    vec3 gradResult = gradientMap(overlayImg,gradientSampler,filterArea,clampX,0.0);\n\n    gl_FragColor = vec4(gradResult*inputImage.a, inputImage.a);\n}\n",Xl=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=jl,s=!1;switch(e){case BFN.CONST.POPART_PRESETS.PRESET_1:s=!0,o=jl;break;case BFN.CONST.POPART_PRESETS.PRESET_2:s=!0,o=zl;break;case BFN.CONST.POPART_PRESETS.PRESET_3:s=!0,o=Hl;break;case BFN.CONST.POPART_PRESETS.PRESET_4:s=!0,o=Gl;break;case BFN.CONST.POPART_PRESETS.PRESET_5:s=!0,o=Ul;break;case BFN.CONST.POPART_PRESETS.PRESET_6:s=!0,o=Vl;break;case BFN.CONST.POPART_PRESETS.PRESET_7:s=!0,o=Al;break;case BFN.CONST.POPART_PRESETS.PRESET_9:s=!0,o=Rl;break;case BFN.CONST.POPART_PRESETS.PRESET_10:s=!0,o=Ol;break;case BFN.CONST.POPART_PRESETS.PRESET_11:s=!0,o=Ll;break;case BFN.CONST.POPART_PRESETS.PRESET_13:s=!0,o=wl;break;case BFN.CONST.POPART_PRESETS.PRESET_14:s=!0,o=Dl;break;case BFN.CONST.POPART_PRESETS.PRESET_15:s=!0,o=Ml;break;case BFN.CONST.POPART_PRESETS.PRESET_16:s=!0,o=Nl;break;case BFN.CONST.POPART_PRESETS.PRESET_17:s=!0,o=kl;break;case BFN.CONST.POPART_PRESETS.PRESET_18:s=!0,o=Pl;break;case BFN.CONST.POPART_PRESETS.PRESET_19:s=!0,o=El;break;case BFN.CONST.POPART_PRESETS.PRESET_20:s=!0,o=Fl}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r.isClamp=s,r}return a(n,[{key:"apply",value:function(e,t,n,i){if(1==this.isClamp){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y}e.applyFilter(this,t,n,i)}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"adaptiveSharpenSampler",get:function(){return this.uniforms.adaptiveSharpenSampler},set:function(e){this.uniforms.adaptiveSharpenSampler=e}},{key:"gradientSampler",get:function(){return this.uniforms.gradientSampler},set:function(e){this.uniforms.gradientSampler=e}},{key:"halftoneSampler",get:function(){return this.uniforms.halftoneSampler},set:function(e){this.uniforms.halftoneSampler=e}},{key:"silhouette_amount",get:function(){return this.uniforms.hasOwnProperty("silhouette_amount")?this.uniforms.silhouette_amount:null},set:function(e){this.uniforms.hasOwnProperty("silhouette_amount")&&(this.uniforms.silhouette_amount=e)}},{key:"detail_level",get:function(){return this.uniforms.detail_level},set:function(e){this.uniforms.detail_level=e}},{key:"halftone_size",get:function(){return this.uniforms.hasOwnProperty("halftone_size")?this.uniforms.halftone_size:null},set:function(e){this.uniforms.hasOwnProperty("halftone_size")&&(this.uniforms.halftone_size=e)}},{key:"color_detail",get:function(){return this.uniforms.color_detail},set:function(e){this.uniforms.color_detail=e}},{key:"color_value_1",get:function(){return this.uniforms.color_value_1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_1=e}},{key:"color_value_2",get:function(){return this.uniforms.color_value_2},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_2=e}},{key:"color_value_3",get:function(){return this.uniforms.color_value_3},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_3=e}},{key:"color_value_4",get:function(){return this.uniforms.color_value_4},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_value_4=e}}]),n}(),Wl="#define GLSLIFY 1\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float offsetX;\nuniform float offsetY;\n\nuniform float scaleX;\nuniform float scaleY;\n\nuniform float clampX;\nuniform float clampY;\n\nuniform int wrap;\n\nvoid main(void){\n\n    gl_FragColor = offsetPixel(uSampler, vTextureCoord, vec2(offsetX, offsetY), vec2(scaleX, scaleY), vec2(clampX, clampY), wrap, 0, vec4(0.0));\n\n}\n",Yl=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Wl)).padding=0,e.resolution=1,e._offsetX=0,e._offsetY=0,e._scaleX=1,e._scaleY=1,e._wrap=!1,e}return a(n,[{key:"apply",value:function(e,t,n,i){this.uniforms.offsetX=this._offsetX/n.destinationFrame.width,this.uniforms.offsetY=this._offsetY/n.destinationFrame.height,this.uniforms.scaleX=this._scaleX,this.uniforms.scaleY=this._scaleY;var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.uniforms.wrap=this._wrap?1:0,e.applyFilter(this,t,n,i)}},{key:"offsetX",get:function(){return this._offsetX},set:function(e){this._offsetX=e}},{key:"offsetY",get:function(){return this._offsetY},set:function(e){this._offsetY=e}},{key:"scaleX",get:function(){return this._scaleX},set:function(e){this._scaleX=e}},{key:"scaleY",get:function(){return this._scaleY},set:function(e){this._scaleY=e}},{key:"wrap",get:function(){return this._wrap},set:function(e){this._wrap=e}}]),n}(),ql="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_0(inpImage));\n\n}\n\nvec3 duotone(vec3 inpImage, vec3 clr1, vec3 clr2)\n{\n    float v = max(max(inpImage.r, inpImage.g), inpImage.b);\n    return clr1*v+clr2*(1.0-v);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color1;\nuniform vec4 color2;\nuniform float amount;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 effectedImg = vec4(vec3(0.0), inputImage.a);\n\n    if(color2.a == 0.0){\n        effectedImg.rgb = tint(inputImage.rgb, color1);\n    } else {\n        effectedImg.rgb = duotone(inputImage.rgb, color1, color2.rgb);\n    }\n\n    inputImage.rgb *= inputImage.a;\n    effectedImg.rgb *= inputImage.a;\n\n    gl_FragColor = mix(inputImage,effectedImg,amount);\n}\n",Kl=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=ql;return(e=t.call(this,r,a)).padding=0,e}return a(n,[{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=e}},{key:"color1",get:function(){return this.uniforms.color1},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color1=e}},{key:"color2",get:function(){return this.uniforms.color2},set:function(e){e=-1!=e&&"0x-1"!=e?BFN.FilterHelper.hex2rgb(e,!0):[0,0,0,0],this.uniforms.color2=e}}]),n}(),Ql="#define GLSLIFY 1\nfloat overlayBlendF(float front, float back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 saturation(vec3 inpImg, float satAmount) {\n\n    //SATURATION ADJUST\n    float avg = (inpImg.r + inpImg.g + inpImg.b) / 3.0;\n    if (satAmount > 0.0) {\n     inpImg.rgb += (avg - inpImg.rgb) * (1.0 - 1.0 / (1.001 - satAmount/2.0));\n    } else {\n     inpImg.rgb += (avg - inpImg.rgb) * (-satAmount);\n    }\n    return inpImg;\n\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\nvec3 lab2xyz( vec3 c ) {\n    float fy = ( c.x + 16.0 ) / 116.0;\n    float fx = c.y / 500.0 + fy;\n    float fz = fy - c.z / 200.0;\n    return vec3(\n         95.047 * (( fx > 0.206897 ) ? fx * fx * fx : ( fx - 16.0 / 116.0 ) / 7.787),\n        100.000 * (( fy > 0.206897 ) ? fy * fy * fy : ( fy - 16.0 / 116.0 ) / 7.787),\n        108.883 * (( fz > 0.206897 ) ? fz * fz * fz : ( fz - 16.0 / 116.0 ) / 7.787)\n    );\n}\n\nvec3 xyz2rgb( vec3 c ) {\n    vec3 v =  c / 100.0 * mat3(\n        3.2406, -1.5372, -0.4986,\n        -0.9689, 1.8758, 0.0415,\n        0.0557, -0.2040, 1.0570\n    );\n    vec3 r;\n    r.x = ( v.r > 0.0031308 ) ? (( 1.055 * pow( v.r, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.r;\n    r.y = ( v.g > 0.0031308 ) ? (( 1.055 * pow( v.g, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.g;\n    r.z = ( v.b > 0.0031308 ) ? (( 1.055 * pow( v.b, ( 1.0 / 2.4 ))) - 0.055 ) : 12.92 * v.b;\n    return r;\n}\n\nvec3 lab2rgb(vec3 c) {\n    return xyz2rgb( lab2xyz( vec3(100.0 * c.x, 2.0 * 127.0 * (c.y - 0.5), 2.0 * 127.0 * (c.z - 0.5)) ) );\n}\n\nvarying vec2 vTextureCoord;\n//uniform sampler2D uSampler;\n//uniform sampler2D blurSampler;\nuniform sampler2D uSampler[2];\nuniform float amount;\n\n//uniform float clampX;\n//uniform float clampY;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler[0], vTextureCoord);\n    vec4 blurImage = texture2D(uSampler[1], vTextureCoord);\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    blurImage.rgb = blurImage.rgb / blurImage.a;\n\n//    * vec2(clampX,clampY)\n\n    vec3 origLumo = rgb2lab(inputImage.rgb);\n    vec3 blurLumo = rgb2lab(blurImage.rgb);\n\n    float resultLumo = overlayBlendF(1.0-blurLumo.r,origLumo.r);\n    vec3 result = lab2rgb(vec3(resultLumo,origLumo.g,origLumo.b));\n\n    result = result * inputImage.a;\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    vec4 saturationImg = vec4(vec3(saturation(result, 0.2)), inputImage.a);\n\n    gl_FragColor = mix(inputImage,saturationImg,amount);\n//    gl_FragColor = blurImage;\n}\n",Zl=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e,hr,Ql)).channelTextures={0:"def",1:"blurImage"},r}return a(n,[{key:"applyParams",value:function(e){this.uniforms.amount=this.amount}},{key:"amount",get:function(){return this._amount},set:function(e){this._amount=e}},{key:"blurImage",get:function(){return this._blurSampler},set:function(e){this._blurSampler=e}}]),n}(),Jl="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    lowp vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.0) * vec2(strength,0.0);\n    vec2 off2 = vec2(2.0) * vec2(strength,0.0);\n    vec2 off3 = vec2(3.0) * vec2(strength,0.0);\n\n    color += texture2D(uSampler, vTextureCoord);\n    color += texture2D(uSampler, clamp(vTextureCoord + off1,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off1,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off2,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off2,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off3,vec2(0.0),vec2(clampCoord,1.0)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off3,vec2(0.0),vec2(clampCoord,1.0)));\n\n    color /= 7.0;\n    gl_FragColor = color;\n\n}\n",$l="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",eu=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r){var a;return i(this,n),(a=t.call(this,$l,Jl)).resolution=r||1,a.strength=e||8,a.padding=0,a.offsetNextPowerW=null,a.clampX=null,a.adjustedStrength=null,a}return a(n,[{key:"apply",value:function(e,t,n,i){this.offsetNextPowerW=t.size.width-n.destinationFrame.width,0==this.offsetNextPowerW?this.clampX=1:this.clampX=1-(this.offsetNextPowerW+2+1/this.resolution)/t.size.width,this.adjustedStrength=10*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.width,this.uniforms.clampCoord=this.clampX,e.applyFilter(this,t,n,i)}},{key:"blur",get:function(){return this.strength},set:function(e){this.strength=e}}]),n}(),tu="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float strength;\nuniform float clampCoord;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n    lowp vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.0) * vec2(0.0,strength);\n    vec2 off2 = vec2(2.0) * vec2(0.0,strength);\n    vec2 off3 = vec2(3.0) * vec2(0.0,strength);\n\n    color += texture2D(uSampler, vTextureCoord);\n    color += texture2D(uSampler, clamp(vTextureCoord + off1,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off1,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off2,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off2,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord + off3,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n    color += texture2D(uSampler, clamp(vTextureCoord - off3,vec2(0.0,0.0),vec2(1.0,clampCoord)));\n\n    color /= 7.0;\n    gl_FragColor = color;\n\n}\n\n",nu=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r){var a;return i(this,n),(a=t.call(this,$l,tu)).resolution=r||1,a.strength=e||8,a.padding=0,a.offsetNextPowerH=null,a.clampY=null,a.adjustedStrength=null,a}return a(n,[{key:"apply",value:function(e,t,n,i){this.offsetNextPowerH=t.size.height-n.destinationFrame.height,0==this.offsetNextPowerH?this.clampY=1:this.clampY=1-(this.offsetNextPowerH+2+1/this.resolution)/t.size.height,this.adjustedStrength=10*this.strength/this.resolution*.65,this.uniforms.strength=this.adjustedStrength/t.size.height,this.uniforms.clampCoord=this.clampY,e.applyFilter(this,t,n,i)}},{key:"blur",get:function(){return this.strength},set:function(e){this.strength=e}}]),n}(),iu=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r,a,o,s,l){var u;return i(this,n),(u=t.call(this)).blurXFilter=new eu(e,a),u.blurYFilter=new nu(e,a),u.padding=0,u.resolution=a||(s?BFN.renderTextureResolutionLarge:BFN.renderTextureResolution),u.quality=r||1,u.oneDirection=l,l||(u.blur=e||5),u.manageResolution=0!=o,u.largeKernel=1==s,u}return a(n,[{key:"apply",value:function(e,t,n){if(this.oneDirection)"x"==this.oneDirection?(this.blurXFilter.resolution=this.resolution,this.blurXFilter.apply(e,t,n)):(this.blurYFilter.resolution=this.resolution,this.blurYFilter.apply(e,t,n));else{var i=e.getRenderTarget(!0);this.blurXFilter.resolution=this.resolution,this.blurYFilter.resolution=this.resolution,this.blurXFilter.apply(e,t,i,!0),this.blurYFilter.apply(e,i,n,!1),e.returnRenderTarget(i)}}},{key:"blur",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}},{key:"blurx",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},{key:"blury",get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}},{key:"quality",get:function(){},set:function(e){}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}]),n}(),ru=function(){function e(t,n,r,a){i(this,e),this.blur1=new BFN.filters.GaussianBlurFilter(null,null,t,1==r?"large":"small",a),this.outputTexture=null,this.isCreateNewOutput=!1}return a(e,[{key:"apply",value:function(e){return 0==e?[]:(this.blur1.blur=e,[this.blur1])}},{key:"render",value:function(e,t,n,i){this.isCreateNewOutput=i,this.blur1.setInputDimensions(t.width,t.height);var r=null;if(null!=n)r=n.concat(this.apply(e));else{if(0==e)return t;r=this.apply(e)}return this.outputTexture||(this.isCreateNewOutput?this.outputTexture=PIXI.RenderTexture.create(t.width,t.height):this.outputTexture=BFN.Util.getNonUsedRenderTexturePool(t.width,t.height)),BFN.renderTextureHolder.texture=t,BFN.renderTextureHolder.filters=r,BFN.Stage.render(BFN.renderTextureHolder,this.outputTexture),BFN.renderTextureHolder.filters=[],BFN.renderTextureHolder.texture=null,this.outputTexture}},{key:"dispose",value:function(){this.outputTexture&&(this.isCreateNewOutput?(this.outputTexture.destroyGC(!0),this.isCreateNewOutput=!1):BFN.Util.destroyRenderTexturePool(),this.outputTexture=null)}}]),e}(),au="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nvoid main(void){\n\n    lowp vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    lowp vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    if (blurImg.a > 0.0) {\n        blurImg.rgb /= blurImg.a;\n    }\n\n    lowp vec3 inpScreen = screenBlend(inputImage.rgb, inputImage.rgb);\n    lowp vec3 blurScreen = screenBlend(blurImg.rgb, blurImg.rgb);\n\n    inputImage.rgb = inpScreen * blurScreen * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n",ou=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,au)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.uniforms.resolutionXY=[n.destinationFrame.width,n.destinationFrame.height],e.applyFilter(this,t,n,i)}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}}]),n}(),su="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(inputImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n\n    screenImage = hardLightBlend(screenImage,textureImage.rgb);\n    vec3 vignetteImageBlur = vignette_0(blurImage.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    vignetteImageBlur = hardLightBlend(vignetteImageBlur,screenImage);\n\n    inputImage.rgb = vignetteImageBlur*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",lu="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(blurImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n    vec3 screenImage2 = screenBlend(inputLumo.rgb, blurImage.rgb);\n\n    screenImage = textureImage.rgb * screenImage;\n    screenImage2 = textureImage.rgb * screenImage;\n\n    vec3 vignetteImage = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n    vec3 vignetteImageBlur = vignette_0(screenImage2,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    inputImage.rgb = vec3(vignetteImage.b,vignetteImage.r,vignetteImageBlur.g)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",uu="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 textureImage = texture2D(textureSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(blurImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n    vec3 screenImage2 = screenBlend(inputLumo.rgb, blurImage.rgb);\n\n    screenImage = textureImage.rgb * screenImage;\n    screenImage2 = textureImage.rgb * screenImage;\n\n    vec3 vignetteImage = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n    vec3 vignetteImageBlur = vignette_0(screenImage2,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    inputImage.rgb = vec3(vignetteImage.r,vignetteImage.b,vignetteImageBlur.g)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",cu="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(blurImage.rgb));\n    inputLumo = sigmoid(inputLumo,0.75,0.85);\n    vec3 screenImage = screenBlend(inputLumo.rgb, inputImage.rgb);\n\n    vec3 screenImage2 = screenBlend(inputLumo.rgb, blurImage.rgb);\n\n    vec3 vignetteImage = vignette_0(screenImage,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n    vec3 vignetteImageBlur = vignette_0(screenImage2,vTextureCoord,realWidth,realHeight,vignette_amount,0.15);\n\n    inputImage.rgb = vec3(vignetteImage.r,vignetteImage.r,vignetteImageBlur.g)*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",hu="#define GLSLIFY 1\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 vignette_0(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float amount,float _brightness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-amount)*0.5);//clamp(amount,0.0,1.00);\n\n        //smoothstep for smooth results\n       // float vignette = 1.0-clamp(smoothstep(0.0, amount, lengthCen),0.0,1.0);\n        float vignette = clamp(smoothstep(adjRadius, adjRadius-0.2, lengthCen),0.0,1.0);\n\n        //apply with multiply, could be other blend modes though.\n        _inpImage *= mix(vignette,1.0,_brightness);\n\n       return _inpImage;\n\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\n vec3 BContrastLeg(vec3 inpImage, float brightness, float contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,brightness);\n     vec3 contrastAm = ((brightImage - 0.5)*contrast)+ 0.5;\n     return contrastAm;\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float vignette_amount;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 inputLumo = vec3(getLumo(inputImage.rgb));\n    vec3 blurLumo = vec3(getLumo(blurImage.rgb));\n\n    inputLumo = BContrastLeg(inputLumo,1.0,1.5);\n    blurLumo = BContrastLeg(blurLumo,1.0,1.5);\n\n  //  vec3 screenImage = screenBlend(blurImage.rgb, inputImage.rgb);\n    vec3 vignetteImage = vignette_0(inputLumo,vTextureCoord,realWidth,realHeight,vignette_amount,0.3);\n    vec3 vignetteImage2 = vignette_0(blurLumo,vTextureCoord,realWidth,realHeight,vignette_amount,0.3);\n\n    vec3 blendBd = vec3(vignetteImage2.r,vignetteImage.r,vignetteImage2.r);\n\n    inputImage.rgb = blendBd*inputImage.a;\n\n    gl_FragColor = inputImage;\n}\n",du=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hu;switch(e){case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_2:a=cu;break;case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_3:a=uu;break;case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_4:a=lu;break;case BFN.CONST.MOTION_COLOR_PRESETS.PRESET_5:a=su}return(r=t.call(this,hr,a)).currentPreset=e,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height,e.applyFilter(this,t,n,i)}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"vignette_amount",get:function(){return this.uniforms.vignette_amount},set:function(e){this.uniforms.vignette_amount=e}}]),n}(),mu="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec4 fisheye(sampler2D sourceImage, vec2 _vTextureCoord, vec4 _filterArea, vec2 _centerPoint, vec2 _resolutionPoint, float _radius){\n\n    float PI = 3.14159265258979;\n\n    vec2 coord = mapCoord(_vTextureCoord,_filterArea);\n\n    vec2 center = vec2(_resolutionPoint.x*_centerPoint.x,_resolutionPoint.y*_centerPoint.y);\n    float aspectRatio = _resolutionPoint.x;\n    vec2 target ;\n\n    vec2 vector  = coord - center;\n    float distance = length(vector) ;\n\n    if ( distance < aspectRatio ){\n        vec2 maximum = center + ( vector / _radius ) ;\n        float ratio     = distance / aspectRatio;\n        float trigRatio = ( cos( ratio * PI) + 1.0 ) / 2.0 ;\n        target = maximum * ( trigRatio ) + coord * ( 1.0 - trigRatio ) ;\n    }\n    else {\n        target = coord;\n    }\n\n    coord = unmapCoord(target,_filterArea);\n    return texture2D(sourceImage, coord);\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nfloat hardLightBlendF(float front, float back)\n{\n    return (front < 0.5) ? 2.0 * front * back : 1.0 - 2.0 * (1.0 - front) * (1.0 - back);\n}\n\nvec3 hardLightBlend(vec3 front,vec3 back)\n{\n\tvec3 result;\n\tresult.r = hardLightBlendF(front.r,back.r);\n\tresult.g = hardLightBlendF(front.g,back.g);\n\tresult.b = hardLightBlendF(front.b,back.b);\n\treturn result;\n}\n\nuniform sampler2D uSampler;\nuniform sampler2D iChanel1;\nuniform float vignette_amount;\nuniform float fisheye_amount;\n\nvarying vec2 vTextureCoord;\nuniform float resolutionX;\nuniform float resolutionY;\nuniform vec4 filterArea;\nuniform vec2 centerPoint;\nuniform float realWidth;\nuniform float realHeight;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n    vec4 textureImage = texture2D(iChanel1, vTextureCoord * vec2(clampX,clampY));\n    vec4 inputImage = fisheye(uSampler, vTextureCoord, filterArea, centerPoint, vec2(resolutionX, resolutionY), fisheye_amount);\n    vec3 vignetteImage = vignetteSoft(inputImage.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.60);\n    inputImage.rgb = hardLightBlend(vignetteImage, textureImage.rgb);\n    gl_FragColor = inputImage;\n}\n\n",pu="#define GLSLIFY 1\n",gu="#define GLSLIFY 1\n",fu="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec4 fisheye(sampler2D sourceImage, vec2 _vTextureCoord, vec4 _filterArea, vec2 _centerPoint, vec2 _resolutionPoint, float _radius){\n\n    float PI = 3.14159265258979;\n\n    vec2 coord = mapCoord(_vTextureCoord,_filterArea);\n\n    vec2 center = vec2(_resolutionPoint.x*_centerPoint.x,_resolutionPoint.y*_centerPoint.y);\n    float aspectRatio = _resolutionPoint.x;\n    vec2 target ;\n\n    vec2 vector  = coord - center;\n    float distance = length(vector) ;\n\n    if ( distance < aspectRatio ){\n        vec2 maximum = center + ( vector / _radius ) ;\n        float ratio     = distance / aspectRatio;\n        float trigRatio = ( cos( ratio * PI) + 1.0 ) / 2.0 ;\n        target = maximum * ( trigRatio ) + coord * ( 1.0 - trigRatio ) ;\n    }\n    else {\n        target = coord;\n    }\n\n    coord = unmapCoord(target,_filterArea);\n    return texture2D(sourceImage, coord);\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nuniform sampler2D uSampler;\nuniform float vignette_amount;\nuniform float fisheye_amount;\n\nvarying vec2 vTextureCoord;\nuniform float resolutionX;\nuniform float resolutionY;\nuniform vec4 filterArea;\nuniform vec2 centerPoint;\nuniform float realWidth;\nuniform float realHeight;\n\nvoid main(void){\n\n    vec4 inputImage = fisheye(uSampler, vTextureCoord, filterArea, centerPoint, vec2(resolutionX, resolutionY), fisheye_amount);\n    inputImage.rgb = vignetteSoft(inputImage.rgb,vTextureCoord,realWidth,realHeight,vignette_amount,0.60);\n\n    gl_FragColor = inputImage;\n}\n",vu="#define GLSLIFY 1\n",yu=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=vu,s=!0;switch(e){case BFN.CONST.PATRIOTIC_PRESETS.PRESET_2:s=!1,o=fu;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_3:o=gu;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_4:o=pu;break;case BFN.CONST.PATRIOTIC_PRESETS.PRESET_5:o=mu}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r.isUseClamp=s,r.centerPoint=[.5,.5],r}return a(n,[{key:"apply",value:function(e,t,n,i){if(this.uniforms.resolutionX=n.destinationFrame.width,this.uniforms.resolutionY=n.destinationFrame.height,this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height,!1!==this.isUseClamp){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y}e.applyFilter(this,t,n,i)}},{key:"centerPoint",get:function(){return this.uniforms.centerPoint},set:function(e){this.uniforms.centerPoint=e}},{key:"iChanel1",get:function(){return this.uniforms.iChanel1},set:function(e){this.uniforms.iChanel1=e}},{key:"iChanel2",get:function(){return this.uniforms.iChanel2},set:function(e){this.uniforms.iChanel2=e}},{key:"vignette_amount",get:function(){return this.uniforms.vignette_amount},set:function(e){this.uniforms.vignette_amount=e}},{key:"fisheye_amount",get:function(){return this.uniforms.fisheye_amount},set:function(e){this.uniforms.fisheye_amount=e}}]),n}(),xu="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_2(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_0(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_1(inpImage));\n\n}\n\nvec3 overlayBlend_1(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 curves(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX) {\n\n    float pixelCoord = 255.0/fArea.x;\n    inpImage.r = texture2D(gradSampler, vec2(inpImage.r*pixelCoord*clampXX, 0.0)).r;\n    inpImage.g = texture2D(gradSampler, vec2(inpImage.g*pixelCoord*clampXX, 0.0)).g;\n    inpImage.b = texture2D(gradSampler, vec2(inpImage.b*pixelCoord*clampXX, 0.0)).b;\n    return inpImage;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend_0(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend_0(contrastAm,brightImage);\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D gradientSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n  //  vec4 gradientImage = texture2D(gradientSampler, vTextureCoord / vec2(clampX,clampY));\n  //  vec4 imageInp = texture2D(uSampler, vTextureCoord);\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    vec3 curvesImage = curves(BContrast(inputOffset.rgb,0.9,0.0),gradientSampler,filterArea,clampX);\n    vec3 tintImage = tint(inputOffset.rgb,vec3(0.99, 1.0, 0.0));\n    vec3 softBlend = curvesImage*tintImage;\n    inputOffset.rgb = mix(curvesImage,softBlend,0.2);\n\n    vec3 overlayImage = overlayBlend_1(vec3(0.0, 0.55, 0.38),inputOffset.rgb);\n    inputOffset.rgb = mix(inputOffset.rgb,overlayImage,0.7);\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",_u="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat getLumo_3(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_3(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_1(inpImage));\n\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend(contrastAm,brightImage);\n }\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo_0(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = BContrast(inputOffset.rgb,1.0,1.3);\n    vec3 tintImage = inputOffset.rgb*vec3(1.0, 0.96, 0.38);\n    inputOffset.rgb = mix(inputOffset.rgb,tintImage,0.8);\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",Iu="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",Tu="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",bu="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",Su="#define GLSLIFY 1\n\nvec4 offsetPixel(sampler2D sourceImage, vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord, int _wrap, int texture2, vec4 fillColor){\n\n    if(texture2 == 1) {\n        scaleCoord = scaleCoord/clampCoord;\n        offsetCoord = offsetCoord/clampCoord;\n        clampCoord = vec2(1.0,1.0);\n    }\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    if (_wrap == 0 && (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0)){\n\n        return fillColor;\n\n    } else {\n\n        adjustedX = mod((mod(adjustedX, 1.0) + 1.0), 1.0);\n        adjustedY = mod((mod(adjustedY, 1.0) + 1.0), 1.0);\n\n        vec2 targetCoord = vec2((adjustedX / clampCoord.x), (adjustedY / clampCoord.y));\n\n        return texture2D(sourceImage, targetCoord);\n    }\n\n}\n\nvec3 vignetteSoft(vec3 _inpImage, vec2 _coord,float _realWidth, float _realHeight, float _amount,float _softness)\n{\n        vec2 position = _coord  - vec2(0.5*_realWidth,0.5*_realHeight);\n\n        // keep aspect ratio\n        position.x *= _realHeight / _realWidth;\n\n        //length from center\n        float lengthCen = length(position);\n\n        //clamping and adjusting for weird values\n        float adjRadius = _realHeight*(0.5+(1.0-_amount)*0.5);//clamp(_amount,0.0,1.00);\n\n        float adj_softness = clamp(_softness,0.001,1.00);\n\n         float vignette = smoothstep(adjRadius, adjRadius-adj_softness, lengthCen);\n\n        _inpImage *= vignette;\n\n        return _inpImage;\n\n}\n\nvec3 borderMask(vec2 sourceCoord, vec2 offsetCoord, vec2 scaleCoord, vec2 clampCoord){\n\n    float adjustedX = (((sourceCoord.x * clampCoord.x) - offsetCoord.x) / scaleCoord.x);\n    float adjustedY = (((sourceCoord.y * clampCoord.y) - offsetCoord.y) / scaleCoord.y);\n\n    vec3 result;\n\n    if (adjustedX < 0.0 || adjustedX > 1.0 || adjustedY < 0.0 || adjustedY > 1.0){\n\n        result = vec3(0.0);\n    } else {\n\n        result = vec3(1.0);\n    }\n    return result;\n\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvec3 sigmoid(vec3 inpImage,float brightness, float sharpness)\n{\n     float calcSharpness = (2.0+(sharpness*20.0));\n     return brightness / (1.0+exp(calcSharpness*(0.5-inpImage)));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D textureSampler;\nuniform float vignette_amount;\nuniform vec3 border_color;\nuniform float border_thickness;\n\nuniform float clampX;\nuniform float clampY;\nuniform float realWidth;\nuniform float realHeight;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    float borderWidth = border_thickness;\n    float calcScaleX = (dimensions.x - (borderWidth*2.0))/dimensions.x;\n    float adjustedBorderXPad = borderWidth/dimensions.x;\n    float adjustedBorderYPad = ((dimensions.y-dimensions.y*calcScaleX)/2.0)/dimensions.y;\n    vec4 fillColor = vec4(1.0);\n    vec2 scaleFactor = vec2(calcScaleX,calcScaleX);\n    vec2 clampValues = vec2(clampX, clampY);\n\n    vec4 inputOffset = offsetPixel(uSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,0, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 blurOffset = offsetPixel(blurSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n    vec4 textureOffset = offsetPixel(textureSampler, vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues, 0,1, fillColor);//offsetPixel(uSampler,vTextureCoord,slide_left,0.0,clampX,clampY);\n\n    blurOffset.rgb = sigmoid(vec3(getLumo(blurOffset.rgb)),0.75,0.3);\n    inputOffset.rgb = screenBlend(blurOffset.rgb,inputOffset.rgb);\n    inputOffset.rgb = textureOffset.rgb*inputOffset.rgb;\n\n    vec2 realWH = (dimensions/filterArea.xy*scaleFactor);\n    vec3 vignetteImage = vignetteSoft(inputOffset.rgb,vTextureCoord-vec2(adjustedBorderXPad,adjustedBorderYPad)/clampValues,realWidth,realHeight,vignette_amount,0.45);\n    vec3 maskBorder = borderMask(vTextureCoord, vec2(adjustedBorderXPad, adjustedBorderYPad), scaleFactor, clampValues);\n    vignetteImage = mix(border_color,vignetteImage,maskBorder);\n\n    gl_FragColor = vec4(vignetteImage.rgb,1.0);\n\n}\n",Cu=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=Su;switch(e){case BFN.CONST.LOMO_ART_PRESETS.PRESET_2:a=bu;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_3:a=Tu;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_4:a=Iu;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_6:a=_u;break;case BFN.CONST.LOMO_ART_PRESETS.PRESET_7:a=xu}return(r=t.call(this,hr,a)).currentPreset=e,r.padding=0,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,this.uniforms.realWidth=n.destinationFrame.width/t.size.width,this.uniforms.realHeight=n.destinationFrame.height/t.size.height,this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,n,i)}},{key:"textureSampler",get:function(){return this.uniforms.textureSampler},set:function(e){this.uniforms.textureSampler=e}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"gradientSampler",get:function(){return this.uniforms.gradientSampler},set:function(e){this.uniforms.gradientSampler=e}},{key:"vignette_amount",get:function(){return this.uniforms.vignette_amount},set:function(e){this.uniforms.vignette_amount=e}},{key:"border_color",get:function(){return this.uniforms.border_color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.border_color=e}},{key:"border_thickness",get:function(){return this.uniforms.border_thickness},set:function(e){this.uniforms.border_thickness=e}}]),n}(),Bu="#define GLSLIFY 1\nvec3 curves(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX) {\n\n    float pixelCoord = 255.0/fArea.x;\n    inpImage.r = texture2D(gradSampler, vec2(inpImage.r*pixelCoord*clampXX, 0.0)).r;\n    inpImage.g = texture2D(gradSampler, vec2(inpImage.g*pixelCoord*clampXX, 0.0)).g;\n    inpImage.b = texture2D(gradSampler, vec2(inpImage.b*pixelCoord*clampXX, 0.0)).b;\n    return inpImage;\n}\n\nvec3 gammaAdjust(vec3 inpImage,float amount)\n{\n    return pow(inpImage,vec3(amount));\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\n vec3 BContrast(vec3 inpImage, float _brightness, float _contrast) {\n     vec3 brightImage = gammaAdjust(inpImage,_brightness);\n     vec3 contrastAm = mix(vec3(0.5), brightImage, _contrast);\n     return overlayBlend(contrastAm,brightImage);\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_2(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_0(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_1(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D curvesSampler;\nuniform vec3 color;\nuniform float contrast;\nuniform float intensity;\n\nuniform float clampX;\n\nuniform vec4 filterArea;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    if (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    vec4 curvesImage = texture2D(curvesSampler, vTextureCoord);\n\n    vec3 curvesOutput = curves(BContrast(inputImage.rgb,1.0,contrast/100.0),curvesSampler,filterArea,clampX);\n    vec3 tintImage = tint(inputImage.rgb,color);\n    vec3 softBlend = curvesOutput*tintImage;\n    inputImage.rgb = mix(curvesOutput,softBlend,intensity)*inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n",Fu=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Bu)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,e.applyFilter(this,t,n,i)}},{key:"curvesSampler",get:function(){return this.uniforms.curvesSampler},set:function(e){this.uniforms.curvesSampler=e}},{key:"color",get:function(){return this.uniforms.color},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color=e}},{key:"contrast",get:function(){return this.uniforms.contrast},set:function(e){this.uniforms.contrast=e}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=e}}]),n}(),Eu="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n   vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n   vec3 ycbcr = inputImage.rgb * mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312) + vec3(0.0, 0.5, 0.5);\n\n   if ((ycbcr.r >= 80.0/255.0) && (ycbcr.g >= 0.33) && (ycbcr.g <= 0.529) && (ycbcr.b >= 0.529) && (ycbcr.b <= 0.705)){\n       inputImage.rgb = inputImage.rgb;\n   }else{\n       inputImage.a = 0.0;\n   }\n\n   gl_FragColor = inputImage;\n\n}\n",Pu=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Eu)).padding=0,e}return n}(),ku="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 highpass(vec3 orgInput, vec3 blurInput) {\n    return (orgInput.rgb/2.0-blurInput.rgb/2.0)+0.5;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D blurSampler2;\nuniform float clampX;\nuniform float clampY;\nuniform float strength;\n\nvec3 linearLightBlend (vec3 front, vec3 back, float opacity){\n    return clamp((2.0 * front + back - 1.0) * opacity + back * (1.0 - opacity),0.0,1.0);\n}\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n    vec4 blurImage2 = texture2D(blurSampler2, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 highPassImage = highpass(inputImage.rgb,blurImage2.rgb);\n\n    vec3 skinDetails = vec3(getLumo(highPassImage));\n\n    highPassImage = linearLightBlend(skinDetails,blurImage.rgb,0.75);\n\n    highPassImage = mix(inputImage.rgb,highPassImage,strength);\n    gl_FragColor = vec4(highPassImage,inputImage.a);\n\n}\n",Nu="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 teethEyeWhiten(vec3 orgInput, vec3 blurInput) {\n\n    vec3 subtractImage = clamp(orgInput-blurInput,0.0,1.0);\n    return clamp(orgInput+subtractImage,0.0,1.0);\n}\n\n/*\n\t\t\tvar orginalBD:BitmapData = bmdIn.clone();\n\t\t\tvar blurData:BitmapData = bmdIn.clone();\n\t\t\tvar subtractData:BitmapData = bmdIn.clone();\n\n\t\t\t// First Layer blurred-original\n\t\t\tvar filter:BlurFilter = new BlurFilter(bmdIn.width/25,bmdIn.width/25,2);\n\t\t\tblurData.applyFilter(blurData,blurData.rect,new Point(0,0),filter as BitmapFilter);\n\n\t\t\tsubtractData.draw(blurData,null,null,BlendMode.SUBTRACT,null,true);\n\t\t\torginalBD.draw(subtractData,null,null,BlendMode.ADD,null,true);\n\n*/\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float clampX;\nuniform float clampY;\n\nvec3 eyeTeethMask(vec3 inpImg) {\n\n      vec3 intermediateColour = 1.0 - inpImg;\n      float k     = min(min(intermediateColour.r, intermediateColour.g), intermediateColour.b);\n      float k2    = 1.0 / (1.0 - k);\n      float cmy;\n      cmy = (intermediateColour.g - k) * k2;\n      cmy = float(1.0-cmy);\n      cmy = smoothstep(0.5,1.0,cmy);\n      return vec3(cmy);\n\n}\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 maskImage = eyeTeethMask(inputImage.rgb);\n\n    vec3 lumoImage = vec3(getLumo(inputImage.rgb));\n    lumoImage = lightenBlend(inputImage.rgb,lumoImage);\n\n    vec3 unsharpedImage = teethEyeWhiten(lumoImage,blurImg.rgb);\n    inputImage.rgb = mix(inputImage.rgb,unsharpedImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",Mu="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    float strength = 2.0; //is not used in UI, betweeen 1-5 this is parameter\n\n    float reddish = inputImage.r-((inputImage.g+inputImage.b)/strength);\n    float Lum = 0.25*inputImage.r+0.6*inputImage.g+0.15*inputImage.b;\n    float RedLum = max(0.0,((2.0*reddish)-Lum));\n\n    if(RedLum<=0.05) {RedLum = 0.0;}\n\n    inputImage.r = inputImage.r - RedLum * (inputImage.r - min(inputImage.g,inputImage.b));\n\n    gl_FragColor = inputImage;\n\n}\n",Du="#define GLSLIFY 1\nvec3 curves(vec3 inpImage, sampler2D gradSampler, vec4 fArea, float clampXX) {\n\n    float pixelCoord = 255.0/fArea.x;\n    inpImage.r = texture2D(gradSampler, vec2(inpImage.r*pixelCoord*clampXX, 0.0)).r;\n    inpImage.g = texture2D(gradSampler, vec2(inpImage.g*pixelCoord*clampXX, 0.0)).g;\n    inpImage.b = texture2D(gradSampler, vec2(inpImage.b*pixelCoord*clampXX, 0.0)).b;\n    return inpImage;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform sampler2D curvesSampler;\n\nuniform float clampX;\nuniform vec4 filterArea;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 desatBD = vec3(getLumo(inputImage.rgb));\n\n    vec3 coloredBD = mix(desatBD,color_palette,0.5);\n\n    vec3 curvesOutput = curves(desatBD,curvesSampler,filterArea,clampX);\n\n    coloredBD = screenBlend(curvesOutput,coloredBD);\n\n    inputImage.rgb = mix(inputImage.rgb,coloredBD,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",wu="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 teethEyeWhiten(vec3 orgInput, vec3 blurInput) {\n\n    vec3 subtractImage = clamp(orgInput-blurInput,0.0,1.0);\n    return clamp(orgInput+subtractImage,0.0,1.0);\n}\n\n/*\n\t\t\tvar orginalBD:BitmapData = bmdIn.clone();\n\t\t\tvar blurData:BitmapData = bmdIn.clone();\n\t\t\tvar subtractData:BitmapData = bmdIn.clone();\n\n\t\t\t// First Layer blurred-original\n\t\t\tvar filter:BlurFilter = new BlurFilter(bmdIn.width/25,bmdIn.width/25,2);\n\t\t\tblurData.applyFilter(blurData,blurData.rect,new Point(0,0),filter as BitmapFilter);\n\n\t\t\tsubtractData.draw(blurData,null,null,BlendMode.SUBTRACT,null,true);\n\t\t\torginalBD.draw(subtractData,null,null,BlendMode.ADD,null,true);\n\n*/\n\nvec3 lightenBlend(vec3 front, vec3 back)\n{\n    return max(front,back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float clampX;\nuniform float clampY;\n\nvec3 eyeTeethMask(vec3 inpImg) {\n\n      vec3 intermediateColour = 1.0 - inpImg;\n      float k     = min(min(intermediateColour.r, intermediateColour.g), intermediateColour.b);\n      float k2    = 1.0 / (1.0 - k);\n      float cmy;\n      cmy = (intermediateColour.g - k) * k2;\n      cmy = float(1.0-cmy);\n      cmy = smoothstep(0.5,1.0,cmy);\n      return vec3(cmy);\n\n}\n\nvoid main(void){\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 maskImage = eyeTeethMask(inputImage.rgb);\n\n    vec3 lumoImage = vec3(getLumo(inputImage.rgb));\n    lumoImage = lightenBlend(inputImage.rgb,lumoImage);\n\n    vec3 unsharpedImage = teethEyeWhiten(lumoImage,blurImg.rgb);\n    inputImage.rgb = mix(inputImage.rgb,unsharpedImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",Lu="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 tintImage = tint(inputImage.rgb,color_palette);\n    inputImage.rgb = mix(inputImage.rgb,tintImage,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",Ou="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 overlayB = overlayBlend(color_palette,inputImage.rgb);\n    overlayB = mix(inputImage.rgb,overlayB,0.5);\n    inputImage.rgb = mix(inputImage.rgb,overlayB,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",Ru="#define GLSLIFY 1\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 lumoImage = vec3(getLumo(inputImage.rgb));\n    lumoImage = overlayBlend(color_palette,lumoImage);\n\n    inputImage.rgb = mix(inputImage.rgb,lumoImage,strength);\n\n    gl_FragColor = inputImage;\n\n}\n",Au="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform float clampX;\nuniform float clampY;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImg = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 blurSub = clamp(blurImg.rgb - inputImage.rgb,0.0,1.0);\n    blurSub = clamp(inputImage.rgb - blurSub,0.0,1.0);\n    inputImage.rgb = mix(inputImage.rgb,blurSub,strength);\n    gl_FragColor = inputImage;\n\n}\n",Vu="#define GLSLIFY 1\nvec3 skinMask(vec3 inputColor, vec3 targetColor, float accuracy) {\n\n    mat3 ycColor = mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312);\n    vec3 ycbcrInput = inputColor * ycColor + vec3(0.0, 0.5, 0.5);\n    vec3 ycbcrAvg = targetColor * ycColor + vec3(0.0, 0.5, 0.5);\n\n    vec3 rgbDelta = ycbcrInput - ycbcrAvg;\n\n    float colDistance = 1.0-sqrt(rgbDelta.r*rgbDelta.r/20.0 + rgbDelta.g * rgbDelta.g + rgbDelta.b * rgbDelta.b);\n    vec3 result;\n    result = vec3(smoothstep(accuracy,1.0,colDistance));\n    return vec3(result);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec3 averageColor;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 original = inputImage;\n    float nonSkin  = skinMask(inputImage.rgb,averageColor,0.40).r;\n    vec3 aa =  inputImage.rgb*(1.0-nonSkin)+nonSkin * averageColor.rgb;\n    inputImage.rgb = min(aa.rgb, inputImage.rgb);\n    inputImage = mix(original, inputImage, strength);\n\n    gl_FragColor = inputImage;//vec4(vec3(nonSkin),1.0);\n}\n",Uu="#define GLSLIFY 1\nvec3 skinMask(vec3 inputColor, vec3 targetColor, float accuracy) {\n\n    mat3 ycColor = mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312);\n    vec3 ycbcrInput = inputColor * ycColor + vec3(0.0, 0.5, 0.5);\n    vec3 ycbcrAvg = targetColor * ycColor + vec3(0.0, 0.5, 0.5);\n\n    vec3 rgbDelta = ycbcrInput - ycbcrAvg;\n\n    float colDistance = 1.0-sqrt(rgbDelta.r*rgbDelta.r/20.0 + rgbDelta.g * rgbDelta.g + rgbDelta.b * rgbDelta.b);\n    vec3 result;\n    result = vec3(smoothstep(accuracy,1.0,colDistance));\n    return vec3(result);\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec3 averageColor;\nuniform vec3 color_palette;\nuniform float strength; //betweeen 0-1 this is parameter\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec3 blushImage = mix(inputImage.rgb,color_palette,strength*0.72);\n    vec3 maskImage  = skinMask(inputImage.rgb,averageColor,0.85);\n\n    inputImage.rgb = mix(inputImage.rgb,blushImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",Gu="#define GLSLIFY 1\nvec3 skinMask(vec3 inputColor, vec3 targetColor, float accuracy) {\n\n    mat3 ycColor = mat3(0.299, 0.587, 0.114, -0.168736, -0.331264, 0.5, 0.5, -0.418688, -0.081312);\n    vec3 ycbcrInput = inputColor * ycColor + vec3(0.0, 0.5, 0.5);\n    vec3 ycbcrAvg = targetColor * ycColor + vec3(0.0, 0.5, 0.5);\n\n    vec3 rgbDelta = ycbcrInput - ycbcrAvg;\n\n    float colDistance = 1.0-sqrt(rgbDelta.r*rgbDelta.r/20.0 + rgbDelta.g * rgbDelta.g + rgbDelta.b * rgbDelta.b);\n    vec3 result;\n    result = vec3(smoothstep(accuracy,1.0,colDistance));\n    return vec3(result);\n\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 averageColor;\nuniform vec3 color_palette;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec3 bronzeImage = overlayBlend(inputImage.rgb,color_palette);\n    bronzeImage = mix(inputImage.rgb,bronzeImage,strength*0.72);\n\n    vec3 maskImage  = skinMask(inputImage.rgb,averageColor,0.85);\n\n    inputImage.rgb = mix(inputImage.rgb,bronzeImage,maskImage);\n\n    gl_FragColor = inputImage;\n\n}\n",Hu="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nfloat colorDodgeBlendF(float front, float back)\n{\n    //return (((2.0 * (front - 0.5)) == 1.0) ? (2.0 * (front - 0.5)) : min(back / (1.0 - (2.0 * (front - 0.5))), 1.0));\n    return back / (1.0 - front);\n}\n\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\nuniform float clampX;\nuniform float clampY;\nuniform float strength;\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 blurImage = texture2D(blurSampler, vTextureCoord * vec2(clampX,clampY));\n\n    vec3 diffImg = abs(inputImage.rgb-blurImage.rgb);\n\n    float maskB = clamp(dot(diffImg, vec3(0.3086, 0.6094, 0.0820)),0.0,1.0);\n    maskB = smoothstep(0.0,strength,maskB);\n    diffImg = mix(blurImage.rgb,inputImage.rgb,maskB);\n    inputImage.rgb = diffImg;\n\n    gl_FragColor = inputImage;\n\n}\n",zu=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;i(this,n);var a=hr,o=Hu;switch(e){case BFN.CONST.TOUCH_UP_PRESETS.bronzer:o=Gu;break;case BFN.CONST.TOUCH_UP_PRESETS.blush:o=Uu;break;case BFN.CONST.TOUCH_UP_PRESETS.flashspot:o=Vu;break;case BFN.CONST.TOUCH_UP_PRESETS.mascara:o=Au;break;case BFN.CONST.TOUCH_UP_PRESETS.eye_color:o=Lu;break;case BFN.CONST.TOUCH_UP_PRESETS.eye_brighten:o=wu;break;case BFN.CONST.TOUCH_UP_PRESETS.eyebrow_pencil:o=Du;break;case BFN.CONST.TOUCH_UP_PRESETS.fix_redeye:o=Mu;break;case BFN.CONST.TOUCH_UP_PRESETS.lipstick:o=Ru;break;case BFN.CONST.TOUCH_UP_PRESETS.teeth_whiten:o=Nu;break;case BFN.CONST.TOUCH_UP_PRESETS.haircolor:o=Ou;break;case BFN.CONST.TOUCH_UP_PRESETS.perfectskin:o=ku}return(r=t.call(this,a,o)).padding=0,r.currentPreset=e,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"averageColor",get:function(){return this.uniforms.averageColor},set:function(e){this.uniforms.averageColor=e}},{key:"color_palette",get:function(){return this.uniforms.color_palette},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.color_palette=e}},{key:"strength",get:function(){return this.uniforms.strength},set:function(e){this.uniforms.strength=e}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"blurSampler2",get:function(){return this.uniforms.blurSampler2},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler2=e}},{key:"curvesSampler",get:function(){return this.uniforms.curvesSampler},set:function(e){this.uniforms.curvesSampler=e}}]),n}(),ju="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main()\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    inputImage.rgb /= inputImage.a;\n    gl_FragColor = inputImage;\n\n}\n",Xu=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=ju;return(e=t.call(this,r,a)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}}]),n}(),Wu="#define GLSLIFY 1 \n//colorOffset in between -0.4 - 0.4 (100.0/255.0)\nvec3 colorMixer(vec3 inpImage, vec3 colorOffset, float bWhite)\n{\n    inpImage.r = clamp(inpImage.r+colorOffset.r,0.0,1.0);\n    inpImage.g = clamp(inpImage.g+colorOffset.g,0.0,1.0);\n    inpImage.b = clamp(inpImage.b+colorOffset.b,0.0,1.0);\n\n    if(bWhite==1.0) {\n    \tinpImage = vec3(dot(inpImage, vec3(0.299, 0.587, 0.114)));\n    }\n\n    return inpImage;\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float red;\nuniform float green;\nuniform float blue;\nuniform float bw;\n\nvoid main(void)\n{\n\tvec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n\tif (inputImage.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n    return;\n    }\n\n    inputImage.rgb /= inputImage.a;\n\n    inputImage.rgb = colorMixer(inputImage.rgb,vec3(red,green,blue),bw);\n\n    inputImage.rgb *= inputImage.a;\n\n\tgl_FragColor = inputImage;\n}\n",Yu=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){return i(this,n),t.call(this,e,hr,Wu)}return a(n,[{key:"applyParams",value:function(e){this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.bw=this.bw}},{key:"red",get:function(){return this._red},set:function(e){e/=255,this._red=e}},{key:"green",get:function(){return this._green},set:function(e){e/=255,this._green=e}},{key:"blue",get:function(){return this._blue},set:function(e){e/=255,this._blue=e}},{key:"bw",get:function(){return this._bw},set:function(e){this._bw=e}}]),n}(),qu="#define GLSLIFY 1\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float lightness;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 screenImage = screenBlend(bImage.rgb,bImage.rgb);\n    vec3 screenImage2 = screenBlend(inputImage.rgb,inputImage.rgb);\n    screenImage = clamp(screenImage*screenImage2,0.0,1.0);\n    vec3 darkenImage = darkenBlend(inputImage.rgb,screenImage);\n    inputImage.rgb = mix(screenImage,darkenImage,1.0-lightness);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n\n",Ku=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,qu)).padding=0,e.softness=1,e.lightness=1,e}return a(n,[{key:"apply",value:function(e,t,n){var i=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=i.x,this.uniforms.clampY=i.y,e.applyFilter(this,t,n)}},{key:"softness",get:function(){return this.uniforms.softness},set:function(e){this.uniforms.hasOwnProperty("softness")&&(this.uniforms.softness=e)}},{key:"lightness",get:function(){return this.uniforms.lightness},set:function(e){e/=100,this.uniforms.hasOwnProperty("lightness")&&(this.uniforms.lightness=e)}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}}]),n}(),Qu="#define GLSLIFY 1\nvec3 darkenBlend(vec3 front, vec3 back)\n{\n    float r = min(front.r, back.r);\n    float g = min(front.g, back.g);\n    float b = min(front.b, back.b);\n    return vec3(r, g, b);\n}\n\nvec3 overlayBlend(vec3 front, vec3 back)\n{\n    return mix(2.0 * front * back, 1.0 - 2.0 * (1.0 - front) * (1.0-back), step(0.5, back));\n}\n\nvec3 screenBlend(vec3 front, vec3 back)\n{\n    return 1.0 - (1.0 - front) * (1.0 - back);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float amount;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 subtractScalar = (inputImage.rgb+0.5) - bImage.rgb;\n\n    subtractScalar = overlayBlend(1.0 - subtractScalar,inputImage.rgb);\n    inputImage.rgb = mix(inputImage.rgb,subtractScalar,amount);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n\n",Zu=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Qu)).padding=0,e.amount=1,e}return a(n,[{key:"apply",value:function(e,t,n){var i=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=i.x,this.uniforms.clampY=i.y,e.applyFilter(this,t,n)}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=e}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}}]),n}(),Ju="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform sampler2D blurImage;\nuniform float size;\nuniform float shift_horizontal;\nuniform float shift_vertical;\nuniform float clampX;\nuniform float clampY;\n\nvec3 blurBorderMask(vec3 inpImg, vec2 coord,vec2 cXcY, float amount, vec2 slideXY)\n{\n    vec2 uv = (coord*cXcY)-vec2(slideXY);;\n    uv = uv * 2.0 - 1.0;\n    float a = sqrt(pow(abs(uv.x),10.0) + pow(abs(uv.y),10.0));\n    a = smoothstep(0.0,1.0-amount,a);\n    return mix(inpImg,vec3(1.0),a);\n\n}\n\nvoid main(void)\n{\n    size;shift_horizontal;shift_vertical;\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurImage, vTextureCoord * vec2(clampX,clampY));\n\n    inputImage.rgb = inputImage.rgb / inputImage.a;\n    bImage.rgb = bImage.rgb / bImage.a;\n\n    vec3 mask = blurBorderMask(vec3(0.0),vTextureCoord,vec2(clampX,clampY),size,vec2(shift_horizontal,shift_vertical));\n    inputImage.rgb = mix(inputImage.rgb,bImage.rgb,mask);\n\n    inputImage.rgb = inputImage.rgb * inputImage.a;\n\n    gl_FragColor = inputImage;\n\n}\n\n",$u=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Ju)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurImage||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"blurImage",get:function(){return this.uniforms.blurImage},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurImage=e}},{key:"size",get:function(){return this.uniforms.size},set:function(e){e/=101,this.uniforms.size=e}},{key:"shift_vertical",get:function(){return this.uniforms.shift_vertical},set:function(e){e/=100,this.uniforms.shift_vertical=e}},{key:"shift_horizontal",get:function(){return this.uniforms.shift_horizontal},set:function(e){e/=100,this.uniforms.shift_horizontal=e}}]),n}(),ec="#define GLSLIFY 1\nvec3 smoothThreshold(vec3 src,float blackThreshold,float whiteThreshold)\n{\n\n   \tfloat brightness = src.r*0.309+src.g*0.609+src.b*0.082;\n    float threshold = clamp(brightness - blackThreshold,0.0,1.0)/clamp(abs(whiteThreshold - blackThreshold),0.0,1.0);\n    return vec3(clamp(vec3(threshold),0.0,1.0));\n\n}\n\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform sampler2D blurSampler;\n\nuniform vec3 averageColor;\nuniform float clampX;\nuniform float clampY;\n\nvec3 hsvGammaDark(vec3 inputRGB, vec3 blurImage, float gammaInput) {\n\n    vec3 hsv = rgb2hsv(inputRGB);\n    float rxy = (hsv.z*2.0)/(hsv.z+0.4);\n    hsv.z = hsv.z + gammaInput*pow(abs(1.0-(blurImage.z*1.4)),1.5)*(rxy-hsv.z);\n    return hsv2rgb(hsv);\n\n}\nvec3 hsvGammaLight(vec3 inputRGB, vec3 blurImage, float gammaInput) {\n\n    vec3 hsv = rgb2hsv(inputRGB);\n    hsv.z = pow(hsv.z,gammaInput);\n    return hsv2rgb(hsv);\n\n}\n\nvoid main(void){\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n    vec4 bImage = texture2D(blurSampler, vTextureCoord * vec2(clampX, clampY));\n\n    vec3 maskThreshold = smoothThreshold(vec3(inputImage.rgb),averageColor.r,1.0);\n    vec3 result;\n    if(averageColor.r<0.5) {\n        float inputGamma = min(1.0, ((0.5 - averageColor.r) * 2.5));\n        result = hsvGammaDark(inputImage.rgb,bImage.rgb,inputGamma);\n    }\n    else {\n         float inputGamma = (log(0.5) / log(averageColor.r));\n         result = hsvGammaLight(inputImage.rgb,bImage.rgb,inputGamma);\n    }\n\n    inputImage.rgb = mix(result,inputImage.rgb,maskThreshold.r);\n\n    gl_FragColor = inputImage;\n\n}\n",tc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,ec)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n,this.blurSampler||null);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"blurSampler",get:function(){return this.uniforms.blurSampler},set:function(e){e.baseTexture.isPowerOfTwo=!0,this.uniforms.blurSampler=e}},{key:"averageColor",get:function(){return this.uniforms.averageColor},set:function(e){this.uniforms.averageColor=e}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){e=BFN.FilterHelper.normalize(e,0,100),this.uniforms.amount=e}}]),n}(),nc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec3 color;\nuniform float intensity;\nuniform float alpha;\nuniform vec4 filterClamp;\n\nuniform float ignoreTransparency;\nuniform float binaryTransparency;\n\n void main() {\n\n    vec4 pixelColor = texture2D(uSampler, clamp(vTextureCoord,filterClamp.xy, filterClamp.zw));\n\n    if (ignoreTransparency == 1.0){\n\n        if (pixelColor.a == 0.0) {\n            gl_FragColor = vec4((color * intensity * alpha), (intensity * alpha));\n            return;\n        }\n\n        pixelColor.rgb /= pixelColor.a;\n\n        float pixelAlpha = pixelColor.a;\n\n        pixelColor.rgb = mix(pixelColor.rgb, color.rgb, (1.0 - pixelColor.a));\n        pixelColor.a = 1.0;\n\n        pixelColor.rgb = mix(pixelColor.rgb, color.rgb, intensity);\n        pixelColor.a = mix(pixelAlpha, 1.0, intensity);\n\n        pixelColor.rgb *= pixelColor.a;\n\n    }else{\n\n        //RETURN IF ALPHA 0\n        if (pixelColor.a == 0.0) {\n            gl_FragColor = vec4(0, 0, 0, 0);\n            return;\n        }\n\n        //UN-PREMULTIPLY ALPHA\n        pixelColor.rgb /= pixelColor.a;\n\n        if (binaryTransparency == 1.0){\n            pixelColor.a = 1.0;\n        }\n\n        //CROSSFADE COLORS\n        float intensityInverse = (1.0 - intensity);\n\n        pixelColor.r = clamp(((pixelColor.r * intensityInverse) + (color.r * intensity)), 0.0, 1.0);\n        pixelColor.g = clamp(((pixelColor.g * intensityInverse) + (color.g * intensity)), 0.0, 1.0);\n        pixelColor.b = clamp(((pixelColor.b * intensityInverse) + (color.b * intensity)), 0.0, 1.0);\n\n        //RE-PREMULTIPLY ALPHA\n        pixelColor.rgb *= pixelColor.a;\n\n    }\n\n    // SET ALPHA\n    pixelColor.rgba *= alpha;\n\n    gl_FragColor = pixelColor;\n\n }\n",ic=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,nc)).padding=0,e.color=16777215,e.intensity=1,e.alpha=1,e.ignoreTransparency=!1,e.binaryTransparency=!1,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"color",get:function(){return this._color},set:function(e){this._color=Math.max(0,Math.min(16777215,e)),this.uniforms.color=BFN.FilterHelper.hex2rgbFactor(this.color)}},{key:"intensity",get:function(){return this._intensity},set:function(e){this._intensity=e,this.uniforms.intensity=Math.max(0,Math.min(1,this.intensity))}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e,this.uniforms.alpha=Math.max(0,Math.min(1,this.alpha))}},{key:"ignoreTransparency",get:function(){return this._ignoreTransparency},set:function(e){this._ignoreTransparency=e,this.uniforms.ignoreTransparency=this.ignoreTransparency?1:0}},{key:"binaryTransparency",get:function(){return this._binaryTransparency},set:function(e){this._binaryTransparency=e,this.uniforms.binaryTransparency=this.binaryTransparency?1:0}}]),n}(),rc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float redOffset;\nuniform float greenOffset;\nuniform float blueOffset;\n\n void main() {\n\n    lowp vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    //UN-PREMULTIPLY ALPHA\n    pixelColor.rgb /= pixelColor.a;\n\n    //OFFSET COLOR CHANNELS\n    pixelColor.r = clamp((pixelColor.r + redOffset), 0.0, 1.0);\n    pixelColor.g = clamp((pixelColor.g + greenOffset), 0.0, 1.0);\n    pixelColor.b = clamp((pixelColor.b + blueOffset), 0.0, 1.0);\n\n    //RE-PREMULTIPLY ALPHA\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n }\n",ac=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,rc)).padding=0,e.resolution=1,e.redOffset=0,e.greenOffset=0,e.blueOffset=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"redOffset",get:function(){return this._redOffset},set:function(e){this._redOffset=Math.max(-1,Math.min(1,e)),this.uniforms.redOffset=this.redOffset}},{key:"greenOffset",get:function(){return this._greenOffset},set:function(e){this._greenOffset=Math.max(-1,Math.min(1,e)),this.uniforms.greenOffset=this.greenOffset}},{key:"blueOffset",get:function(){return this._blueOffset},set:function(e){this._blueOffset=Math.max(-1,Math.min(1,e)),this.uniforms.blueOffset=this.blueOffset}}]),n}(),oc="#define GLSLIFY 1\n/* Color Difference (Delta E) algorithm between 2 LAB colors. RGB colors should be converted to LAB*/\n/* It uses CIE94 standards https://en.wikipedia.org/wiki/Color_difference  */\nfloat DeltaE1994(vec3 lab1, vec3 lab2) {\n\n\tconst float K1 = 0.045;\n\tconst float K2 = 0.015;\n\tconst float WL = 1.0;\n\tconst float WC = 0.5; // adjusted weight to 0.5 from 1.0\n\tconst float WH = 0.5; // adjusted weight to 0.5 from 1.0\n\n\tfloat CH1 = sqrt(lab1.y * lab1.y + lab1.z * lab1.z);\n\tfloat CH2 = sqrt(lab2.y * lab2.y + lab2.z * lab2.z);\n\n\tfloat deltaA = lab1.y - lab2.y;\n\tfloat deltaB = lab1.z - lab2.z;\n\tfloat deltaC = CH1 - CH2;\n\tfloat deltaH2 = deltaA * deltaA + deltaB * deltaB - deltaC * deltaC;\n\tfloat deltaH = (deltaH2 > 0.0) ? sqrt(deltaH2) : 0.0;\n\tfloat deltaL = lab1.x - lab2.x;\n\n\tfloat sL = 1.0;\n\tfloat sC = 1.0 + K1 * CH1;\n\tfloat sH = 1.0 + K2 * CH1;\n\n\tfloat vL = deltaL / (WL * sL);\n\tfloat vC = deltaC / (WC * sC);\n\tfloat vH = deltaH / (WH * sH);\n\n\treturn sqrt(vL * vL + vC * vC + vH * vH);\n}\n\nvec3 xyz2lab( vec3 c ) {\n    vec3 n = c / vec3( 95.047, 100, 108.883 );\n    vec3 v;\n    v.x = ( n.x > 0.008856 ) ? pow( n.x, 1.0 / 3.0 ) : ( 7.787 * n.x ) + ( 16.0 / 116.0 );\n    v.y = ( n.y > 0.008856 ) ? pow( n.y, 1.0 / 3.0 ) : ( 7.787 * n.y ) + ( 16.0 / 116.0 );\n    v.z = ( n.z > 0.008856 ) ? pow( n.z, 1.0 / 3.0 ) : ( 7.787 * n.z ) + ( 16.0 / 116.0 );\n    return vec3(( 116.0 * v.y ) - 16.0, 500.0 * ( v.x - v.y ), 200.0 * ( v.y - v.z ));\n}\n\nvec3 rgb2xyz( vec3 c ) {\n    vec3 tmp;\n    tmp.x = ( c.r > 0.04045 ) ? pow( ( c.r + 0.055 ) / 1.055, 2.4 ) : c.r / 12.92;\n    tmp.y = ( c.g > 0.04045 ) ? pow( ( c.g + 0.055 ) / 1.055, 2.4 ) : c.g / 12.92,\n    tmp.z = ( c.b > 0.04045 ) ? pow( ( c.b + 0.055 ) / 1.055, 2.4 ) : c.b / 12.92;\n    return 100.0 * tmp *\n        mat3( 0.4124, 0.3576, 0.1805,\n              0.2126, 0.7152, 0.0722,\n              0.0193, 0.1192, 0.9505 );\n}\n\nvec3 rgb2lab(vec3 c) {\n    vec3 lab = xyz2lab( rgb2xyz( c ) );\n    return vec3( lab.x / 100.0, 0.5 + 0.5 * ( lab.y / 127.0 ), 0.5 + 0.5 * ( lab.z / 127.0 ));\n}\n\n//#pragma glslify: hueBlend = require(../helpers/glsls/hueBlend.glsl)\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_2(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_0(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 lumoBlend(vec3 back, vec3 front) {\n\n    return vec3(setlum(back.rgb, getLumo_1(front.rgb)));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 sourceColor;\nuniform vec3 targetColor;\nuniform float targetAlpha;\nuniform float preserveLuminosity;\n\nuniform float tolerance; // between 0-1\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec4 targetResult = vec4(vec3(targetColor*targetAlpha), targetAlpha);\n\n    vec4 result = (inputImage.a == 0.0) ? targetResult : inputImage;\n\n    if (sourceColor.r != -1.0){\n\n       \t//Color to change - LAB\n       \tvec3 sourceColorHSV = rgb2lab(sourceColor);\n\n       \t//Target color - LAB\n       \tvec3 targetColorHSV = rgb2lab(targetColor);\n\n       \t//Input color - LAB\n        //vec4 inputImage = texture2D(uSampler, vTextureCoord);\n       \tvec3 inputImageHSV = rgb2lab(inputImage.rgb);\n\n       \tfloat deltaDist = DeltaE1994(inputImageHSV,sourceColorHSV);\n\n       \tdeltaDist = smoothstep(0.0,tolerance,deltaDist);\n\n        if(preserveLuminosity==1.0) {\n            targetResult.rgb = lumoBlend(targetResult.rgb,inputImage.rgb);\n            targetResult = vec4(vec3(targetResult*targetAlpha), targetAlpha);\n        }\n\n       \tresult = (inputImage.a == 0.0) ? vec4(0.0) : mix(targetResult,inputImage,deltaDist);\n\n    }\n   \tgl_FragColor = result;\n}\n",sc=function(e){u(n,PIXI.Shader);var t=p(n);function n(e){return i(this,n),t.call(this,e,hr,oc)}return a(n,[{key:"applyParams",value:function(e){this.uniforms.sourceColor=this.sourceColor,this.uniforms.targetColor=this.targetColor,this.uniforms.targetAlpha=this.targetAlpha,this.uniforms.tolerance=this.tolerance,this.uniforms.preserveLuminosity=this.preserveLuminosity}},{key:"sourceColor",get:function(){return this._sourceColor},set:function(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this._sourceColor=e}},{key:"targetColor",get:function(){return this._targetColor},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this._targetColor=e}},{key:"targetAlpha",get:function(){return this._targetAlpha},set:function(e){e=Math.max(0,Math.min(1,e)),this._targetAlpha=e}},{key:"tolerance",get:function(){return this._tolerance},set:function(e){this._tolerance=e}},{key:"preserveLuminosity",get:function(){return this._preserveLuminosity},set:function(e){this._preserveLuminosity=e}}]),n}(),lc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float mode;\nuniform float beta;\nuniform float pressure;\n\nuniform float vTextureCoordMax;\n\n void main() {\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    /*\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    */\n\n    //--\n\n    float centerCoord = (vTextureCoordMax / 2.0);\n\n    float dx = (centerCoord - vTextureCoord.x);\n    float dy = (centerCoord - vTextureCoord.y);\n    float dd = sqrt((dx * dx) + (dy * dy));\n\n    float factor = max(0.0, (1.0 - (dd / centerCoord)));\n\n    pressure;\n\n    float offsetStrength = (pressure * factor);\n\n    //--\n\n    float offsetG = 0.0;\n    float offsetB = 0.0;\n\n    if (mode == 0.0){ // SMUDGE\n\n        offsetStrength *= .1;\n\n        offsetG = -(cos(beta));\n        offsetB = -(sin(beta));\n\n    }else if\n        (mode == 1.0){ // GROW\n\n        offsetStrength *= 0.25;\n\n        offsetG = (((1.0 - (vTextureCoord.x / vTextureCoordMax)) * 2.0) - 1.0);\n        offsetB = (((1.0 - (vTextureCoord.y / vTextureCoordMax)) * 2.0) - 1.0);\n\n    }else if\n        (mode == 2.0){ // SHRINK\n\n        offsetStrength *= 0.25;\n\n        offsetG = (((vTextureCoord.x / vTextureCoordMax) * 2.0) - 1.0);\n        offsetB = (((vTextureCoord.y / vTextureCoordMax) * 2.0) - 1.0);\n\n    }else if\n        (mode == 3.0){ // ERASE\n\n        offsetStrength *= 0.25;\n\n        offsetG = (0.5 - pixelColor.g);\n        offsetB = (0.5 - pixelColor.b);\n\n    }\n\n    //--\n\n    if (mode != 3.0){ // NOT ERASING\n\n        float goalG = clamp((pixelColor.g + offsetG), 0.0, 1.0);\n        float goalB = clamp((pixelColor.b + offsetB), 0.0, 1.0);\n\n        float deltaG = abs(goalG - pixelColor.g);\n        float deltaB = abs(goalB - pixelColor.b);\n\n        offsetG *= deltaG;\n        offsetB *= deltaB;\n\n    }\n\n    offsetG *= offsetStrength;\n    offsetB *= offsetStrength;\n\n    //OFFSET COLOR CHANNELS\n    pixelColor.g = clamp((pixelColor.g + offsetG), 0.0, 1.0);\n    pixelColor.b = clamp((pixelColor.b + offsetB), 0.0, 1.0);\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n }\n",uc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,lc)).padding=0,e.resolution=1,e.modes=["smudge","grow","shrink","erase"],e.mode="smudge",e.beta=0,e.pressure=1,e.vTextureCoordMax=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"mode",get:function(){return this._mode},set:function(e){-1!=this.modes.indexOf(e)&&(this._mode=e,this.uniforms.mode=this.modes.indexOf(e))}},{key:"beta",get:function(){return this._beta},set:function(e){this._beta=e,this.uniforms.beta=this.beta}},{key:"pressure",get:function(){return this._pressure},set:function(e){this._pressure=Math.max(0,Math.min(1,e)),this.uniforms.pressure=this.pressure}},{key:"vTextureCoordMax",get:function(){return this._vTextureCoordMax},set:function(e){this._vTextureCoordMax=Math.max(0,Math.min(1,e)),this.uniforms.vTextureCoordMax=this.vTextureCoordMax}}]),n}(),cc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float strength;\n\nuniform float maxDisplacementX;\nuniform float maxDisplacementY;\n\nuniform float vTextureCoordMinX;\nuniform float vTextureCoordMinY;\n\nuniform float vTextureCoordMaxX;\nuniform float vTextureCoordMaxY;\nuniform vec4 filterArea;\n\nvoid main(void)\n{\n\n    vec2 displaceCoord = vec2(((vTextureCoord.x / vTextureCoordMaxX) + vTextureCoordMinX), ((vTextureCoord.y / vTextureCoordMaxY) + vTextureCoordMinY));\n    vec4 displaceColor = texture2D(iChannel1, displaceCoord);\n\n    //--\n\n    float offsetFactorX = (((displaceColor.g - 0.5) * 2.0) * strength);\n    float offsetFactorY = (((displaceColor.b - 0.5) * 2.0) * strength);\n\n    float offsetX = (maxDisplacementX * offsetFactorX);\n    float offsetY = (maxDisplacementY * offsetFactorY);\n\n    vec2 onePixel = 2.0/filterArea.xy;\n\n    vec2 srcCoord = clamp(vec2(vTextureCoord.x + offsetX,vTextureCoord.y + offsetY),onePixel,vec2(vTextureCoordMaxX,vTextureCoordMaxY)*(1.0-onePixel));//vec2(clamp((vTextureCoord.x + offsetX), 0.0025, (vTextureCoordMaxX * 0.9975)), clamp((vTextureCoord.y + offsetY), 0.0025, (vTextureCoordMaxY * 0.9975)));\n\n    vec4 srcColor = texture2D(uSampler, srcCoord);\n\n    gl_FragColor = srcColor;\n\n    // gl_FragColor = displaceColor;\n\n}\n\n",hc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,cc)).padding=0,e.resolution=1,e.isDisplay=!1,e.inputScale=1,e.inputSprite=null,e.strength=1,e}return a(n,[{key:"apply",value:function(e,t,n,i){if(e.applyFilter(this,t,n,i),this.inputSprite&&this.iChannel1)try{var r=this._inputSprite.texture.width*(this._isDisplay?this._inputScale:1),a=this._inputSprite.texture.height*(this._isDisplay?this._inputScale:1);this._mapW=this._isDisplay?t.size.width:BFN.FilterHelper.getNextPowerOfTwo(r),this._mapH=this._isDisplay?t.size.height:BFN.FilterHelper.getNextPowerOfTwo(a);var o=this._inputSprite.getGlobalPosition();this.uniforms.vTextureCoordMinX=this._isDisplay?Math.abs(Math.min(0,o.x))/r:0,this.uniforms.vTextureCoordMinY=this._isDisplay?Math.abs(Math.min(0,o.y))/a:0,this.uniforms.vTextureCoordMaxX=r/this._mapW,this.uniforms.vTextureCoordMaxY=a/this._mapH;var s=Math.round(Math.min(r,a)/16);this.uniforms.maxDisplacementX=s/this._mapW,this.uniforms.maxDisplacementY=s/this._mapH,e.applyFilter(this,t,n,i)}catch(e){}}},{key:"isDisplay",get:function(){return this._isDisplay},set:function(e){this._isDisplay=e}},{key:"inputScale",get:function(){return this._inputScale},set:function(e){this._inputScale=e}},{key:"inputSprite",get:function(){return this._inputSprite},set:function(e){this._inputSprite=e}},{key:"strength",get:function(){return this.uniforms.strength},set:function(e){this.uniforms.strength=Math.max(0,Math.min(1,e))}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}}]),n}(),dc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float mode;\nuniform vec3 color;\n\nfloat getBrightness (vec3 rgb){\n    return sqrt((rgb.r * rgb.r * 0.241) + (rgb.g * rgb.g * 0.691) + (rgb.b * rgb.b * 0.068));\n}\n\n void main() {\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //RETURN IF ALPHA 0\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    float colorBrightness = getBrightness(vec3(color.r, color.g, color.b));\n\n    float pixelBrightness = getBrightness(vec3(pixelColor.r, pixelColor.g, pixelColor.b));\n\n    //--\n\n    if ((mode == 0.0 && pixelBrightness < colorBrightness) || (mode == 1.0 && pixelBrightness > colorBrightness)){ // REPLACE COLORS DARKER OR LIGHTER THAN COLOR WITH COLOR\n\n        pixelColor.r = color.r;\n        pixelColor.g = color.g;\n        pixelColor.b = color.b;\n\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n }\n",mc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,dc)).padding=0,e.resolution=1,e.modes=["darks","lights"],e.mode="darks",e.color=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.uniforms.color=BFN.Util.hex2rgbVec3(this._color)}},{key:"mode",get:function(){return this._mode},set:function(e){-1!=this.modes.indexOf(e)&&(this._mode=e,this.uniforms.mode=this.modes.indexOf(e))}}]),n}(),pc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float vTextureCoordMinX;\nuniform float vTextureCoordMinY;\n\nuniform float vTextureCoordMaxX;\nuniform float vTextureCoordMaxY;\n\nuniform float inverse;\n\nvoid main(void)\n{\n\n    vec2 alphaCoord = vec2(((vTextureCoord.x / vTextureCoordMaxX) + vTextureCoordMinX), ((vTextureCoord.y / vTextureCoordMaxY) + vTextureCoordMinY));\n    vec4 alphaColor = texture2D(iChannel1, alphaCoord);\n\n    //--\n\n    vec4 srcColor = texture2D(uSampler, vTextureCoord);\n\n    srcColor.rgb /= srcColor.a;\n\n    srcColor.a = (inverse == 1.0) ? ((1.0 - alphaColor.a) * srcColor.a) : (alphaColor.a * srcColor.a);\n\n    srcColor.rgb *= srcColor.a;\n\n    //--\n\n    gl_FragColor = srcColor;\n\n}\n\n",gc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,pc)).padding=0,e.resolution=1,e.inverse=!1,e.isDisplay=!1,e.inputScale=1,e.inputSprite=null,e.inputTexture=null,e}return a(n,[{key:"apply",value:function(e,t,n,i){if(this._inputSprite&&this._iChannel1)try{var r=this._inputSprite.texture.width*(this._isDisplay?this._inputScale:1),a=this._inputSprite.texture.height*(this._isDisplay?this._inputScale:1);this._mapW=this._isDisplay?t.size.width:BFN.FilterHelper.getNextPowerOfTwo(r),this._mapH=this._isDisplay?t.size.height:BFN.FilterHelper.getNextPowerOfTwo(a);var o=this._inputSprite.getGlobalPosition();this.uniforms.vTextureCoordMinX=this._isDisplay?Math.abs(Math.min(0,o.x))/r:0,this.uniforms.vTextureCoordMinY=this._isDisplay?Math.abs(Math.min(0,o.y))/a:0,this.uniforms.vTextureCoordMaxX=r/this._mapW,this.uniforms.vTextureCoordMaxY=a/this._mapH,e.applyFilter(this,t,n,i)}catch(e){}}},{key:"inverse",get:function(){return this._inverse},set:function(e){this._inverse=e,this.uniforms.inverse=e?1:0}},{key:"isDisplay",get:function(){return this._isDisplay},set:function(e){this._isDisplay=e}},{key:"inputScale",get:function(){return this._inputScale},set:function(e){this._inputScale=e}},{key:"inputSprite",get:function(){return this._inputSprite},set:function(e){this._inputSprite=e}},{key:"iChannel1",get:function(){return this._iChannel1},set:function(e){this._iChannel1=e,this.uniforms.iChannel1=e}}]),n}(),fc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D blendTexture;\nuniform sampler2D maskTexture;\n\nuniform float vTextureCoordMaxX;\nuniform float vTextureCoordMaxY;\n\nuniform float inverse;\n\nuniform float unmaskedAlpha;\nuniform vec4 blendColor;\nuniform float blendIntensity;\n\nuniform float useBlendColor;\nuniform float useBlendTexture;\nuniform float useMaskTexture;\nuniform float useInputAlpha;\n\nvec4 overlapColors(vec4 backColor, vec4 frontColor) {\n    return vec4((backColor.rgb + (frontColor.rgb * (1.0 - backColor.a))), (backColor.a + (frontColor.a * (1.0 - backColor.a))));\n}\n\nvoid main(void) {\n\n    vec4 srcColor = texture2D(uSampler, vTextureCoord);\n    vec4 dstColor = srcColor;\n\n    if (useBlendColor == 1.0 || useBlendTexture == 1.0){\n\n        vec2 iTextureCoord = vec2((vTextureCoord.x / vTextureCoordMaxX), (vTextureCoord.y / vTextureCoordMaxY));\n\n        vec4 topColor = (mix(srcColor, ((useBlendColor == 1.0) ? blendColor : texture2D(blendTexture, iTextureCoord)), blendIntensity) * unmaskedAlpha);\n\n        if (useMaskTexture == 1.0){\n\n            vec4 maskColor = texture2D(maskTexture, iTextureCoord);\n            dstColor = mix(((useInputAlpha == 1.0) ? overlapColors(srcColor, topColor) : srcColor), topColor, ((inverse == 1.0) ? maskColor.a : (1.0 - maskColor.a)));\n\n        }else{\n\n            dstColor = ((inverse == 1.0) ? ((useInputAlpha == 1.0) ? overlapColors(srcColor, topColor) : srcColor) : topColor);\n\n        }\n\n    }\n\n    gl_FragColor = dstColor;\n\n}\n\n",vc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,fc)).padding=0,e.resolution=1,e.inverse=!1,e.unmaskedAlpha=1,e.blendColor=null,e.blendIntensity=1,e.blendTexture=null,e.maskTexture=null,e.useInputAlpha=!1,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=t.sourceFrame.width,a=t.sourceFrame.height,o=BFN.FilterHelper.getNextPowerOfTwo(r),s=BFN.FilterHelper.getNextPowerOfTwo(a);this.uniforms.vTextureCoordMaxX=r/o,this.uniforms.vTextureCoordMaxY=a/s,e.applyFilter(this,t,n,i)}},{key:"inverse",get:function(){return this._inverse},set:function(e){this._inverse=e,this.uniforms.inverse=e?1:0}},{key:"unmaskedAlpha",get:function(){return this._unmaskedAlpha},set:function(e){this._unmaskedAlpha=Math.max(0,Math.min(1,e)),this.uniforms.unmaskedAlpha=e}},{key:"blendColor",get:function(){return this._blendColor},set:function(e){this._blendColor=e,this.uniforms.blendColor=null===e?[0,0,0,0]:[].concat(v("string"==typeof e&&6===e.length?BFN.FilterHelper.hex2rgb(e):[0,0,0]),[1]),this.uniforms.useBlendColor=null===e?0:1}},{key:"blendIntensity",get:function(){return this._blendIntensity},set:function(e){this._blendIntensity=Math.max(0,Math.min(1,e)),this.uniforms.blendIntensity=e}},{key:"blendTexture",get:function(){return this._blendTexture},set:function(e){this._blendTexture=e||PIXI.Texture.EMPTY,this.uniforms.blendTexture=this._blendTexture,this.uniforms.useBlendTexture=e?1:0}},{key:"maskTexture",get:function(){return this._maskTexture},set:function(e){this._maskTexture=e||PIXI.Texture.EMPTY,this.uniforms.maskTexture=this._maskTexture,this.uniforms.useMaskTexture=e?1:0}},{key:"useInputAlpha",get:function(){return!!this.uniforms.useInputAlpha},set:function(e){this.uniforms.useInputAlpha=e?1:0}}]),n}(),yc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\n\nuniform int quality;\nuniform float intensity;\nuniform float size;\nuniform vec3 color;\n\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nconst float PI = 3.141592653589793;\nconst float PHI = 1.618033988749895; // ((1 + Math.sqrt(5)) / 2)\nconst float TAU = (PI * 2.0);\nconst float OMEGA = (TAU / PHI);\n\nconst int samplesX1 = 16;\nconst int samplesX2 = 32;\nconst int samplesX3 = 48;\nconst int samplesX4 = 64;\nconst int samplesX5 = 80;\nconst int samplesX6 = 96;\nconst int samplesX7 = 112;\nconst int samplesX8 = 128;\n\n//--\n\nfloat getInfluence(vec2 pixelCoord, int i, int samples, int denominator){\n\n    float factor = (float(i) / float(samples - 1));\n\n    float theta = (OMEGA * float(i));\n    float distance = (size * factor);\n\n    vec2 samplePixelCoord = vec2((pixelCoord.x + (cos(theta) * distance)), (pixelCoord.y + (sin(theta) * distance)));\n\n    vec4 samplePixelColor = texture2D(uSampler, clamp(unmapCoord(samplePixelCoord, filterArea), 0.0, 1.0));\n\n    float distanceInfluence = (float(samples - i) / float(denominator));\n    float influence = (distanceInfluence * samplePixelColor.a);\n\n    return influence;\n\n}\n\n//--\n\nfloat getInfluenceQ1(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX1; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX1; i++){\n        influence += getInfluence(pixelCoord, i, samplesX1, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ2(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX2; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX2; i++){\n        influence += getInfluence(pixelCoord, i, samplesX2, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ3(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX3; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX3; i++){\n        influence += getInfluence(pixelCoord, i, samplesX3, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ4(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX4; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX4; i++){\n        influence += getInfluence(pixelCoord, i, samplesX4, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ5(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX5; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX5; i++){\n        influence += getInfluence(pixelCoord, i, samplesX5, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ6(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX6; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX6; i++){\n        influence += getInfluence(pixelCoord, i, samplesX6, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ7(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX7; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX7; i++){\n        influence += getInfluence(pixelCoord, i, samplesX7, denominator);\n    }\n    return influence;\n}\n\nfloat getInfluenceQ8(vec2 pixelCoord){\n    int denominator = 0;\n    for (int i = 1; i <= samplesX8; i++){\n        denominator += i;\n    }\n    float influence = 0.0;\n    for (int i = 0; i < samplesX8; i++){\n        influence += getInfluence(pixelCoord, i, samplesX8, denominator);\n    }\n    return influence;\n}\n\n//--\n\nvoid main(void) {\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, clamp(unmapCoord(pixelCoord, filterArea), 0.0, 1.0));\n\n    //--\n\n    float influence = 0.0;\n\n    if (quality == 1){\n        influence = getInfluenceQ1(pixelCoord);\n    }else if\n        (quality == 2){\n        influence = getInfluenceQ2(pixelCoord);\n    }else if\n        (quality == 3){\n        influence = getInfluenceQ3(pixelCoord);\n    }else if\n        (quality == 4){\n        influence = getInfluenceQ4(pixelCoord);\n    }else if\n        (quality == 5){\n        influence = getInfluenceQ5(pixelCoord);\n    }else if\n        (quality == 6){\n        influence = getInfluenceQ6(pixelCoord);\n    }else if\n        (quality == 7){\n        influence = getInfluenceQ7(pixelCoord);\n    }else if\n        (quality == 8){\n        influence = getInfluenceQ8(pixelCoord);\n    }\n\n    influence = (clamp((influence * (0.5 + (intensity * 2.0))), 0.0, 1.0) * (1.0 - pixelColor.a));\n\n    //--\n\n    gl_FragColor = vec4(mix(pixelColor.rgb, color, influence), max(influence, pixelColor.a));\n\n}\n",xc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,yc)).padding=0,e.quality=4,e.intensity=.5,e.size=20,e.color="FFFFFF",e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=e.getRenderTarget(!0);this.plainFilter||(this.plainFilter=new BFN.filters.PlainFilter),e.applyFilter(this.plainFilter,t,r,!0),e.applyFilter(this,r,n,i),e.returnRenderTarget(r)}},{key:"quality",get:function(){return this.uniforms.quality},set:function(e){this.uniforms.quality=Math.floor(Math.max(1,Math.min(8,e)))}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=Math.max(0,Math.min(1,e))}},{key:"size",get:function(){return this.uniforms.size},set:function(e){this.uniforms.size=Math.max(0,e)}},{key:"color",get:function(){return this.uniforms.color},set:function(e){this.uniforms.color=BFN.FilterHelper.hex2rgbFactor(e)}}]),n}(),_c="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float minInput;\nuniform float maxInput;\nuniform float saturation;\nuniform vec3 tint;\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nvec3 saturation_0(vec3 inpImg, float satAmount) {\n\n    //SATURATION ADJUST\n    float avg = (inpImg.r + inpImg.g + inpImg.b) / 3.0;\n    if (satAmount > 0.0) {\n     inpImg.rgb += (avg - inpImg.rgb) * (1.0 - 1.0 / (1.001 - satAmount/2.0));\n    } else {\n     inpImg.rgb += (avg - inpImg.rgb) * (-satAmount);\n    }\n    return inpImg;\n\n}\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    vec3 result = levelsControl(inputImage.rgb,minInput,1.0,maxInput,0.0,1.0);\n\n    float sat = ((tint.r == -1.0) ? saturation : -1.0);\n\n    result = saturation_0(result, sat);\n\n    vec3 mult = ((tint.r == -1.0) ? vec3(1.0) : saturation_0(tint, saturation));\n\n    result *= mult;\n\n    gl_FragColor = vec4(result, inputImage.a);\n\n}\n",Ic=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,_c)).padding=0,e.minInput=.8,e.maxInput=.85,e.saturation=-.5,e.tint=-1,e}return a(n,[{key:"minInput",get:function(){return this.uniforms.minInput},set:function(e){this.uniforms.minInput=Math.max(0,Math.min(1,e))}},{key:"maxInput",get:function(){return this.uniforms.maxInput},set:function(e){this.uniforms.maxInput=Math.max(0,Math.min(1,e))}},{key:"saturation",get:function(){return this.uniforms.saturation},set:function(e){this.uniforms.saturation=Math.max(-1,Math.min(1,e))}},{key:"tint",get:function(){return this.uniforms.tint},set:function(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.tint=e}}]),n}(),Tc="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\n    vec4 inputImage = texture2D(uSampler, vTextureCoord);\n\n    float lumo = max(inputImage.r,max(inputImage.g,inputImage.b));\n\n    vec4 result = mix(vec4(0.0),inputImage,lumo);\n\n    gl_FragColor = result;\n\n}\n",bc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Tc)).padding=0,e}return n}(),Sc="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform bool monochromatic;\nuniform int distribution;\nuniform float intensity;\nuniform float seed;\n\nconst float staticSeed = 0.546372819564738291;//0.123456789;\n\n//note: uniformly distributed, normalized rand, [0;1[\nfloat nrand( vec2 n ){\n\treturn fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\nfloat n1rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\treturn nrnd0;\n}\nfloat n2rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\treturn (nrnd0+nrnd1) / 2.0;\n}\nfloat n3rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\tfloat nrnd2 = nrand( n + 0.13*t );\n\treturn (nrnd0+nrnd1+nrnd2) / 3.0;\n}\nfloat n4rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\tfloat nrnd2 = nrand( n + 0.13*t );\n\tfloat nrnd3 = nrand( n + 0.17*t );\n\treturn (nrnd0+nrnd1+nrnd2+nrnd3) / 4.0;\n}\n\nfloat n8rand( vec2 n ){\n\tfloat t = fract( (seed / 100.0) + staticSeed );\n\tfloat nrnd0 = nrand( n + 0.07*t );\n\tfloat nrnd1 = nrand( n + 0.11*t );\n\tfloat nrnd2 = nrand( n + 0.13*t );\n\tfloat nrnd3 = nrand( n + 0.17*t );\n\n    float nrnd4 = nrand( n + 0.19*t );\n    float nrnd5 = nrand( n + 0.23*t );\n    float nrnd6 = nrand( n + 0.29*t );\n    float nrnd7 = nrand( n + 0.31*t );\n\n\treturn (nrnd0+nrnd1+nrnd2+nrnd3 +nrnd4+nrnd5+nrnd6+nrnd7) / 8.0;\n}\n\n//alternative Gaussian,\n//thanks to @self_shadow\n//see http://www.dspguide.com/ch2/6.htm\n//note: see also https://www.shadertoy.com/view/MlVSzw for version by @stubbe\nfloat n4rand_ss( vec2 n ){\n\n\tfloat nrnd0 = nrand( n + 0.07*fract( (seed / 100.0) + staticSeed ) );\n\tfloat nrnd1 = nrand( n + 0.11*fract( (seed / 100.0) + staticSeed + 0.573953 ) );\n\treturn 0.23*sqrt(-log(nrnd0+0.00001))*cos(2.0*3.141592*nrnd1)+0.5;\n}\n\nvec4 generateNoiseColor(vec2 fragCoord){\n\n\tfloat noiseLuminance;\n\tif (distribution == 1){\n\t\tnoiseLuminance = n1rand( fragCoord );\n\t}else if\n        (distribution == 2){\n\t\tnoiseLuminance = n2rand( fragCoord );\n\t}else if\n        (distribution == 3){\n\t\tnoiseLuminance = n4rand( fragCoord );\n\t}else if\n        (distribution == 4){\n\t\tnoiseLuminance = n8rand( fragCoord );\n\t}else if\n        (distribution == 5){\n\t\tnoiseLuminance = n4rand_ss( fragCoord );\n\t}\n\n\tfloat rand = nrand( fragCoord );\n\tfloat offsetRand = fract((seed * 0.166) + rand);\n\n\tfloat luminance = 0.8;\n\n\tvec3 noiseColor;\n\tif (monochromatic){\n\t\tnoiseColor = vec3(offsetRand);\n\t}else if\n        (offsetRand < 0.166){\n\t\tnoiseColor = vec3(luminance,0.0,0.0); // RED\n\t}else if\n        (offsetRand < 0.332){\n\t\tnoiseColor = vec3(luminance,luminance,0.0); // YELLOW\n\t}else if\n        (offsetRand < 0.498){\n        noiseColor = vec3(0.0,luminance,0.0); // GREEN\n\t}else if\n        (offsetRand < 0.664){\n\t\tnoiseColor = vec3(0.0,luminance,luminance); // CYAN\n\t}else if\n        (offsetRand < 0.830){\n\t\tnoiseColor = vec3(0.0,0.0,luminance); // BLUE\n\t}else{\n\t\tnoiseColor = vec3(luminance,0.0,luminance); // FUSCHIA\n\t}\n\tnoiseColor = clamp((noiseColor * noiseLuminance * (1.0 + (((intensity * 0.25) + 0.75) * 2.0))), 0.0, 1.0);\n\n\treturn vec4(noiseColor, 1.0);\n\n}\n\nvoid main(void){\n\n\tvec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    pixelColor.rgb /= pixelColor.a;\n\n\tvec2 randCoord = vec2(mod((vTextureCoord.x + pixelColor.r + pixelColor.g), 1.0), mod((vTextureCoord.y + pixelColor.g + pixelColor.b), 1.0));\n\n\tvec4 noiseColor = generateNoiseColor(randCoord);//vTextureCoord);\n\n\tpixelColor.rgb = clamp(mix(pixelColor.rgb, noiseColor.rgb, intensity), 0.0, 1.0)*pixelColor.a;\n\n\tgl_FragColor = pixelColor;\n\n}\n",Cc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Sc)).padding=0,e.intensity=.1,e.distribution=4,e.monochromatic=!1,e.seed=1,e}return a(n,[{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=Math.max(0,Math.min(1,e))}},{key:"distribution",get:function(){return this.uniforms.distribution},set:function(e){this.uniforms.distribution=Math.round(Math.max(0,Math.min(5,e)))}},{key:"seed",get:function(){return this.uniforms.seed},set:function(e){this.uniforms.seed=Math.round(Math.max(0,e))}},{key:"monochromatic",get:function(){return this.uniforms.monochromatic},set:function(e){this.uniforms.monochromatic=!!e}}]),n}(),Bc="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform vec3 lineColor;\nuniform float opacity;\nuniform float spacing;\nuniform bool invert;\n\nvoid main(void){\n\n\tvec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    pixelColor.rgb /= pixelColor.a;\n\n\tfloat pixelY = floor(vTextureCoord.y * filterArea.y);\n\n    bool drawLine = (mod((floor(pixelY / spacing) + (invert ? 1.0 : 0.0)), 2.0) == 0.0);\n\n\tif (drawLine){\n\t    vec4 lColor = vec4(lineColor, 1.0);\n\t    pixelColor = mix(pixelColor, lColor, opacity);\n\t}\n\n\tgl_FragColor = vec4(pixelColor.rgb*pixelColor.a,pixelColor.a);\n\n}\n",Fc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Bc)).padding=0,e.lineColor="000000",e.opacity=.5,e.spacing=2,e}return a(n,[{key:"lineColor",get:function(){return this.uniforms.lineColor},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.lineColor=e}},{key:"opacity",get:function(){return this.uniforms.opacity},set:function(e){this.uniforms.opacity=Math.max(0,Math.min(1,e))}},{key:"spacing",get:function(){return this.uniforms.spacing},set:function(e){this.uniforms.spacing=Math.max(0,e)}},{key:"invert",get:function(){return this.uniforms.invert},set:function(e){this.uniforms.invert=!!e}}]),n}(),Ec="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform vec3 averageColor;\nuniform float pass;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nvec2 mapCoord(vec2 scaleCoord){\n    return clamp(((scaleCoord / scaleDimensions) * pixelDimensions), vec2(0.0), (pixelDimensions - 1.0));\n}\n\nvec2 unmapCoord(vec2 pixelCoord){\n    return ((clamp(pixelCoord, vec2(0.0), (pixelDimensions - 1.0)) / pixelDimensions) * scaleDimensions);\n}\n\nvoid main(void){\n\n    float averageLumo = getLumo(averageColor);\n\n    vec2 pixelOffset = vec2(0.0, 1.0);\n\n    //--\n\n    vec2 pixelCoord = mapCoord(vTextureCoord);\n    vec4 pixelColor = texture2D(uSampler, unmapCoord(pixelCoord));\n    float pixelLumo = getLumo(pixelColor.rgb);\n\n    if (pass == 0.0){\n\n        if (pixelLumo > averageLumo){\n            pixelColor = vec4(1.0);\n        }else{\n            pixelColor = vec4(vec3(averageLumo), 1.0);\n        }\n\n    }else if\n        (pass == 2.0){\n\n        vec2 pixelCoordAbove = (pixelCoord - pixelOffset);\n        vec4 pixelColorAbove = texture2D(uSampler, unmapCoord(pixelCoordAbove));\n        float pixelLumoAbove = getLumo(pixelColorAbove.rgb);\n\n        vec2 pixelCoordBelow = (pixelCoord + pixelOffset);\n        vec4 pixelColorBelow = texture2D(uSampler, unmapCoord(pixelCoordBelow));\n        float pixelLumoBelow = getLumo(pixelColorBelow.rgb);\n\n        if (pixelLumoAbove == 1.0 && pixelLumoBelow == 1.0){\n            pixelColor.rgb = vec3(averageLumo);\n        }\n\n    }else{\n\n        vec2 pixelCoordBelow = (pixelCoord + pixelOffset);\n        vec4 pixelColorBelow = texture2D(uSampler, unmapCoord(pixelCoordBelow));\n        float pixelLumoBelow = getLumo(pixelColorBelow.rgb);\n\n        if (pixelLumoBelow > pixelLumo){\n            float degradeRate = (0.01 + (sin((pixelCoord.x / (pixelDimensions.x - 1.0)) * PIx2 * (pixelDimensions.x * PI)) * 0.005));\n            pixelLumo = clamp((pixelLumoBelow - degradeRate), averageLumo, 1.0);\n            pixelColor.rgb = vec3(pixelLumo);\n        }\n\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",Pc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Ec)).padding=0,e.sourceW=0,e.sourceH=0,e.averageColor=[0,0,0],e.plainFilter=new BFN.filters.PlainFilter,e}return a(n,[{key:"setDimensions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t)&&(this.sourceW=e,this.sourceH=t,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)])}},{key:"apply",value:function(e,t,n,i){var r=e.getRenderTarget(!0),a=e.getRenderTarget(!0);this.plainFilter.apply(e,t,r,!0);for(var o=Math.min(200,this.sourceH)+2,s=0;s<o;s++){this.uniforms.pass=s,e.applyFilter(this,r,a,!0);var l=a;a=r,r=l}this.plainFilter.apply(e,r,n,!0),e.returnRenderTarget(r),e.returnRenderTarget(a)}},{key:"averageColor",get:function(){return this.uniforms.averageColor},set:function(e){this.uniforms.averageColor=e}}]),n}(),kc="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n\n    gl_FragColor = (vec4(1.0) - clamp(texture2D(uSampler, vTextureCoord), vec4(0.0), vec4(1.0)));\n\n}\n",Nc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,kc)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){e.applyFilter(this,t,n,i)}}]),n}(),Mc="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform float spread;\nuniform float direction;\nuniform float blendAlpha;\nuniform float alphaChoke;\n\nconst float w0 = 0.22;\nconst float w1 = 0.18;\nconst float w2 = 0.13;\nconst float w3 = 0.08;\n\nvec2 mapCoord(vec2 scaleCoord){\n    return ((scaleCoord / scaleDimensions) * pixelDimensions);\n}\n\nvec2 unmapCoord(vec2 pixelCoord){\n    return ((pixelCoord / pixelDimensions) * scaleDimensions);\n}\n\nvec2 getOffsetPixelCoord(vec2 pixelCoord, float distanceFactor){\n\n    float distance = (spread * distanceFactor);\n\n    vec2 pixelOffset = vec2((cos(direction) * distance), (sin(direction) * distance));\n    vec2 offsetPixelCoord = (pixelCoord + pixelOffset);\n\n    //--\n\n    vec2 minCoord = vec2(0.0);\n    vec2 maxCoord = (pixelDimensions - vec2(1.0));\n\n    //--\n\n    float adjustFactor = 1.0;\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.x - minCoord.x) / abs(pixelOffset.x)));\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.x - maxCoord.x) / abs(pixelOffset.x)));\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.y - minCoord.y) / abs(pixelOffset.y)));\n    adjustFactor = min(adjustFactor, (abs(pixelCoord.y - maxCoord.y) / abs(pixelOffset.y)));\n\n    //--\n\n    // distance *= adjustFactor; // EDGE PIXELS GET AMPLIFIED\n    distance = ((abs(distance * adjustFactor) - (abs(distance) - abs(distance * adjustFactor))) * (abs(distance) / distance)); // EDGE PIXELS GET REFLECTED\n\n    //--\n\n    pixelOffset = vec2((cos(direction) * distance), (sin(direction) * distance));\n    offsetPixelCoord = clamp((pixelCoord + pixelOffset), minCoord, maxCoord);\n\n    //--\n\n    return offsetPixelCoord;\n\n}\n\nvoid main(void){\n\n    vec2 pixelCoordCC = mapCoord(vTextureCoord);\n\n    vec4 pixelColorCC = (texture2D(uSampler, unmapCoord(pixelCoordCC)) * w0);\n    if (blendAlpha == 0.0 && pixelColorCC.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    //--\n\n    vec2 pixelCoordA1 = getOffsetPixelCoord(pixelCoordCC, -(1.0 / 3.0));\n    vec2 pixelCoordA2 = getOffsetPixelCoord(pixelCoordCC, -(2.0 / 3.0));\n    vec2 pixelCoordA3 = getOffsetPixelCoord(pixelCoordCC, -(3.0 / 3.0));\n\n    vec2 pixelCoordB1 = getOffsetPixelCoord(pixelCoordCC, (1.0 / 3.0));\n    vec2 pixelCoordB2 = getOffsetPixelCoord(pixelCoordCC, (2.0 / 3.0));\n    vec2 pixelCoordB3 = getOffsetPixelCoord(pixelCoordCC, (3.0 / 3.0));\n\n    //--\n\n    vec4 pixelColorA1 = (texture2D(uSampler, unmapCoord(pixelCoordA1)) * w1);\n    vec4 pixelColorA2 = (texture2D(uSampler, unmapCoord(pixelCoordA2)) * w2);\n    vec4 pixelColorA3 = (texture2D(uSampler, unmapCoord(pixelCoordA3)) * w3);\n\n    vec4 pixelColorB1 = (texture2D(uSampler, unmapCoord(pixelCoordB1)) * w1);\n    vec4 pixelColorB2 = (texture2D(uSampler, unmapCoord(pixelCoordB2)) * w2);\n    vec4 pixelColorB3 = (texture2D(uSampler, unmapCoord(pixelCoordB3)) * w3);\n\n    //--\n\n    vec4 result = (pixelColorCC + pixelColorA1 + pixelColorA2 + pixelColorA3 + pixelColorB1 + pixelColorB2 + pixelColorB3);\n\n    if (result.a > 0.0 && blendAlpha == 1.0 && alphaChoke > 0.0){\n        result.a = clamp((result.a + (alphaChoke * result.a)), 0.0, 1.0);\n    }\n\n    //--\n\n    gl_FragColor = result;\n\n}\n",Dc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Mc)).padding=0,e.sourceW=0,e.sourceH=0,e._maxSpread=0,e._maxSpreadCalc=0,e.amount=1,e.direction=0,e.blendAlpha=!1,e.alphaChoke=0,e.iterations=5,e.biDirectional=!1,e.plainFilter=new BFN.filters.PlainFilter,e}return a(n,[{key:"setDimensions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t||this._maxSpread!==n)&&(this.sourceW=e,this.sourceH=t,this.setMaxSpread(n),this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)])}},{key:"setMaxSpread",value:function(e){isNaN(parseInt(e))?this._maxSpread=Math.max(this.sourceW,this.sourceH)/32:this._maxSpread=e,this._maxSpreadCalc=this._maxSpread/this._bleedFactor}},{key:"apply",value:function(e,t,n,i){var r=this,a=e.getRenderTarget(!0),o=e.getRenderTarget(!0);this.plainFilter.apply(e,t,a,!0);for(var s=function(t,n){r.uniforms.spread=t,r.uniforms.direction=n,e.applyFilter(r,a,o,!0);var i=o;o=a,a=i},l=0;l<this._iterations;l++){var u=this._amount*this._maxSpreadCalc/Math.pow(2,l);s(u,this._direction),this.biDirectional&&s(u,this._direction+Math.PI/2)}this.plainFilter.apply(e,a,n,!0),e.returnRenderTarget(a),e.returnRenderTarget(o)}},{key:"amount",get:function(){return this._amount},set:function(e){this._amount=Math.max(0,Math.min(1,e))}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=e}},{key:"blendAlpha",get:function(){return this._blendAlpha},set:function(e){this._blendAlpha=e,this.uniforms.blendAlpha=e?1:0}},{key:"alphaChoke",get:function(){return this._alphaChoke},set:function(e){this._alphaChoke=Math.max(0,Math.min(1,e)),this.uniforms.alphaChoke=this._alphaChoke}},{key:"iterations",get:function(){return this._iterations},set:function(e){this._iterations=e,this._bleedFactor=0;for(var t=0;t<this._iterations;t++)this._bleedFactor+=1/Math.pow(2,t);this.setMaxSpread(this._maxSpread)}},{key:"biDirectional",get:function(){return this._biDirectional},set:function(e){this._biDirectional=e}}]),n}(),wc="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D glitchSrc;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform float seed;\nuniform float noise;\nuniform float strength;\nuniform float chromatic;\nuniform float vShift;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nconst float neutralValue = (128.0 / 255.0);\n\nfloat updateSeed(float seed){\n\treturn mod((seed * 9301.0 + 49297.0), 233280.0);\n}\n\nfloat seededRandom(float seed, float min, float max){\n\treturn (min + ((seed / 233280.0) * (max - min)));\n}\n\nvoid main(void){\n\n    vec4 glitchSrcColor = texture2D(glitchSrc, (vTextureCoord / scaleDimensions));\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n\n    float offsetFactorX = ((glitchSrcColor.r - neutralValue) * 2.0);\n    float offsetFactorY = ((glitchSrcColor.g - neutralValue) * vShift);\n\n    //--\n\n    // NOISE\n    if (noise > 0.0){\n        float seedVar = ((updateSeed(updateSeed(seed + updateSeed(pixelCoord.y))) + updateSeed(seed + pixelCoord.y)) / 2.0);\n        if (seededRandom(seedVar, 0.0, 1.0) < (noise / 2.0)){\n            seedVar = updateSeed(seedVar);\n            float betaOffset = (seededRandom(seedVar, 0.0, 1.0) * PIx2);\n            float betaBase = ((pixelCoord.y / pixelDimensions.y) * PIx2);\n            float trigFactor = ((sin(betaOffset) + sin(betaBase * 4.0) + sin(betaBase * 10.0) + sin(betaBase * 22.0)) / 4.0);\n            offsetFactorX += (trigFactor * noise * offsetFactorX * 2.0);\n        }\n    }\n\n    //--\n\n    vec2 pixelOffset = floor(vec2(offsetFactorX, offsetFactorY) * strength * (shortestSide / 2.0));\n    pixelCoord = mod((pixelCoord + pixelOffset + pixelDimensions), pixelDimensions);\n\n    vec2 scaleCoord = vTextureCoord;\n    scaleCoord = ((pixelCoord / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColor = texture2D(uSampler, scaleCoord);\n\n    //--\n\n    // CHROMATIC ABERRATION\n    if (chromatic > 0.0 || vShift > 0.0){\n\n        float chromaticOffsetMax = floor(shortestSide / 5.0);\n        float chromaticOffsetX = floor(chromatic * chromaticOffsetMax * offsetFactorX * strength);\n        float chromaticOffsetY = floor(chromatic * chromaticOffsetMax * offsetFactorY * strength);\n\n        // RED CHANNEL\n        vec2 pixelCoordR = pixelCoord;\n        pixelCoordR.x = mod((pixelCoordR.x - chromaticOffsetX + pixelDimensions.x), pixelDimensions.x);\n        pixelCoordR.y = mod((pixelCoordR.y - chromaticOffsetY + pixelDimensions.y), pixelDimensions.y);\n        vec2 scaleCoordR = ((pixelCoordR / pixelDimensions) * scaleDimensions);\n        scaleCoordR.y = (((vTextureCoord.y - scaleCoordR.y) * chromatic) + scaleCoordR.y);\n        vec4 pixelColorR = texture2D(uSampler, scaleCoordR);\n        pixelColor.r = pixelColorR.r;\n\n        // BLUE CHANNEL\n        vec2 pixelCoordB = pixelCoord;\n        pixelCoordB.x = mod((pixelCoordB.x + chromaticOffsetX + pixelDimensions.x), pixelDimensions.x);\n        pixelCoordB.y = mod((pixelCoordB.y + chromaticOffsetY + pixelDimensions.y), pixelDimensions.y);\n        vec2 scaleCoordB = ((pixelCoordB / pixelDimensions) * scaleDimensions);\n        scaleCoordB.y = (((vTextureCoord.y - scaleCoordB.y) * chromatic) + scaleCoordB.y);\n        vec4 pixelColorB = texture2D(uSampler, scaleCoordB);\n        pixelColor.b = pixelColorB.b;\n\n    }\n\n//\tgl_FragColor = glitchSrcColor;\n\tgl_FragColor = pixelColor;\n\n}\n",Lc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,wc)).padding=0,e.sourceW=0,e.sourceH=0,e.seed=1,e.strength=.5,e.chromatic=.5,e.noise=.5,e}return a(n,[{key:"setDimensions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t)&&(this.sourceW=e,this.sourceH=t,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.drawGlitchSource())}},{key:"drawGlitchSource",value:function(){var e=this;if(this.glitchSourceTexture||(this.glitchSourceTexture=PIXI.RenderTexture.create(32,32),this.uniforms.glitchSrc=this.glitchSourceTexture),this.sourceW>0&&this.sourceH>0){this.glitchSourceTexture.width!==this.sourceW&&this.glitchSourceTexture.height!==this.sourceH&&this.glitchSourceTexture.resize(this.sourceW,this.sourceH),this.glitchSourceGraphic||(this.glitchSourceGraphic=new PIXI.Graphics);var t=Math.min(this.sourceW,this.sourceH),n=this.seed,i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return n=(9301*n+49297)%233280,Math.round(e+n/233280*(t-e))},r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={r:Math.max(0,Math.min(255,128+Math.round(16*e))),g:Math.max(0,Math.min(255,128+Math.round(16*t))),b:Math.max(0,Math.min(255,128+Math.round(16*n)))};return parseInt("0x"+BFN.ColorUtil.rgbaObjectToHexStringObject(i).hex)},a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8421504,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;arguments.length>6&&void 0!==arguments[6]&&arguments[6]&&e.glitchSourceGraphic.clear(),i<=0||r<=0||(e.glitchSourceGraphic.beginFill(a,o),e.glitchSourceGraphic.drawRect(t,n,i,r),e.glitchSourceGraphic.endFill())},o=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t){t=Math.max(1,Math.round(t));for(var o=Math.floor(t/2),s=0;s<e.sourceH;){var l=t+Math.round((i()/10*2-1)*o),u=i();if(u<2||u>8){var c=Math.abs(u-5)/(u-5),h=Math.round((i(0,6)-3)/3);a(0,s,e.sourceW,l,r(c,h),n)}s=Math.round(s+l)}}},s=Math.max(2,Math.round(t/40)),l=Math.round(s/2),u=!1,c=!1,h=null,d=0,m=0,p=0;a(0,0,this.sourceW,this.sourceH,r(0),1,!0),o(t/10,1),o(t/5,.25),function(){for(var t=0;t<e.sourceH;){if(u){if(c){var n=Math.round(-1===m?d:e.sourceW-d),o=Math.floor(n/l/8*(l/s)),g=i(0,o),f=-1===m?0:d,v=n;if(g){var y=Math.round(g*l*2);v-=y,1===m&&(f+=y)}if(a(f,t,v,l,h),g){f=1===m?f:v-l;for(var x=0;x<g&&!(i(0,9)<5);x++)f=Math.round(f-m*l*2),a(f,t,l,l,h)}}c=!c,p+=l,(i()<=3||p>=1*s)&&(u=!1,c=!1)}else if(l=Math.max(1,Math.round((l+i())%s)),i()<=1){var _=i(),I=Math.abs(_-5)/(_-5)*1;I&&(d=Math.round(i(0,50)/50*e.sourceW),m=i(0,9)<5?-1:1,d+m>0&&d+m<e.sourceW&&(u=!0,c=!0,h=r(I,Math.round((i(0,6)-3)/3)),p=0))}t=Math.round(t+l)}}(),BFN.Stage.render(this.glitchSourceGraphic,this.glitchSourceTexture)}else this.glitchSourceTexture.fillColor(8947848)}},{key:"clearGlitchSource",value:function(){this.glitchSourceGraphic&&(this.glitchSourceGraphic.clear(),this.glitchSourceGraphic=null),this.glitchSourceTexture&&(this.glitchSourceTexture.destroyGC(!0),this.glitchSourceTexture=null),this.sourceW=0,this.sourceH=0}},{key:"seed",get:function(){return this.uniforms.seed},set:function(e){this.uniforms.seed=Math.round(Math.max(0,e))}},{key:"strength",get:function(){return this.uniforms.strength},set:function(e){this.uniforms.strength=Math.max(0,Math.min(1,e))}},{key:"noise",get:function(){return this.uniforms.noise},set:function(e){this.uniforms.noise=Math.max(0,Math.min(1,e))}},{key:"chromatic",get:function(){return this.uniforms.chromatic},set:function(e){this.uniforms.chromatic=Math.max(0,Math.min(1,e))}},{key:"vShift",get:function(){return this.uniforms.vShift},set:function(e){this.uniforms.vShift=Math.max(0,Math.min(1,e))}}]),n}(),Oc="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform sampler2D blurTexture;\nuniform sampler2D artifactTexture;\n\nuniform vec2 artifactDimensions;\n\nuniform float grayscale;\nuniform float phase;\nuniform float length;\nuniform float horizontal;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nconst vec3 maxPixelOffsetFactors = vec3(0.2, 0.2, 0.1);\nconst vec3 verticalSegments = vec3(16.0, 8.0, 32.0);\n\nvoid main(void){\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n\n    vec3 maxPixelOffsetsX = floor(shortestSide * maxPixelOffsetFactors);\n\n    //--\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n    vec2 scaleCoord = ((pixelCoord / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColor = texture2D(uSampler, scaleCoord);\n    if (pixelColor.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    pixelColor.rgb /= pixelColor.a;\n\n    if (grayscale == 1.0){\n        float pixelLumo = getLumo(pixelColor.rgb);\n        pixelColor.rgb = vec3(pixelLumo);\n    }\n\n    //--\n\n    float yFactor = (pixelCoord.y / pixelDimensions.y);\n\n    //-- RED\n\n    float segmentR = max(1.0, (pixelDimensions.y / 12.0));\n    float shiftR = mod(floor((pixelCoord.y + (segmentR * 3.0 * phase)) / segmentR), 2.0);\n\n    float signR = (((sin((((yFactor * (verticalSegments.r / 2.0)) * PIx2) + (phase * PI * 1.5))) > 0.0) ? -1.0 : 0.0) + shiftR);\n\n    vec2 pixelOffsetR = vec2((floor((maxPixelOffsetsX.r * horizontal) + (shortestSide * 0.015)) * signR), 0.0);\n\n    vec2 pixelCoordR = clamp((pixelCoord + pixelOffsetR), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 scaleCoordR = ((pixelCoordR / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColorR = texture2D(uSampler, scaleCoordR);\n    pixelColorR.rgb /= pixelColorR.a;\n\n    if (grayscale == 1.0){\n        float pixelLumoR = getLumo(pixelColorR.rgb);\n        pixelColorR.rgb = vec3(pixelLumoR);\n    }\n\n    pixelColor.r = pixelColorR.r;\n\n    //-- GREEN\n\n    vec2 artifactPixelCoord = mod((pixelCoord + vec2(0.0, (artifactDimensions.y * phase * 20.0))), artifactDimensions);\n    vec2 artifactScaleCoord = (artifactPixelCoord / artifactDimensions);\n    vec4 artifactColor = texture2D(artifactTexture, artifactScaleCoord);\n    artifactColor.rgb /= artifactColor.a;\n    float artifactLumo = getLumo(artifactColor.rgb);\n\n    //--\n\n    float segmentG = max(1.0, (((length * 0.99) + 0.01) * pixelDimensions.y));\n    float shiftG = mod(floor((pixelCoord.y + (segmentG * 3.0 * phase)) / segmentG), 2.0);\n\n    float signG = (((sin((((yFactor * (verticalSegments.g / 2.0)) * PIx2) + (phase * PI * 6.0))) > 0.0) ? -1.0 : 0.0) + shiftG);\n\n    vec2 pixelOffsetG = vec2((floor((maxPixelOffsetsX.g * horizontal) + (shortestSide * 0.005)) * signG), 0.0);\n\n    vec2 pixelCoordG = clamp((pixelCoord + pixelOffsetG), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 scaleCoordG = ((pixelCoordG / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColorG = texture2D(uSampler, scaleCoordG);\n    pixelColorG.rgb /= pixelColorG.a;\n\n    if (grayscale == 1.0){\n        float pixelLumoG = getLumo(pixelColorG.rgb);\n        pixelColorG.rgb = vec3(pixelLumoG);\n    }\n\n    pixelColor.g = mix(pixelColorG.g, pixelColor.g, artifactLumo);\n\n    //-- BLUE\n\n    float signB = ((sin((((yFactor * (verticalSegments.b / 2.0)) * PIx2) + (phase * PI * 3.0))) > 0.0) ? 1.0 : -1.0);\n\n    vec2 pixelOffsetB = vec2((floor(maxPixelOffsetsX.b * horizontal) * signB), 0.0);\n\n    vec2 pixelCoordB = clamp((pixelCoord + pixelOffsetB), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 scaleCoordB = ((pixelCoordB / pixelDimensions) * scaleDimensions);\n\n    vec4 pixelColorB = texture2D(blurTexture, (scaleCoordB / scaleDimensions));\n    pixelColorB.rgb /= pixelColorB.a;\n\n    if (grayscale == 1.0){\n        float pixelLumoB = getLumo(pixelColorB.rgb);\n        pixelColorB.rgb = vec3(pixelLumoB);\n    }\n\n    pixelColor.b = pixelColorB.b;\n\n    //--\n\n    pixelColor.rgb *= pixelColor.a;\n\n    //--\n\n    /* // TESTING\n    if (shiftG == 1.0){\n        pixelColor.rgb = mix(pixelColor.rgb, vec3(1.0, 0.0, 1.0), .2);\n    }\n    if (shiftR == 1.0){\n        pixelColor.rgb = mix(pixelColor.rgb, vec3(0.0, 1.0, 1.0), .2);\n    }\n    */\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",Rc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Oc)).padding=0,e.sourceTexture=null,e.sourceW=0,e.sourceH=0,e.phase=0,e.length=.2,e.horizontal=.2,e.directionalBlurFilter=null,e.directionalBlurTexture=null,e.directionalBlurSprite=new PIXI.Sprite,e}return a(n,[{key:"setSourceTexture",value:function(e){if(e&&e.baseTexture&&e!==this.sourceTexture){this.resetSourceTexture(),this.sourceTexture=e,this.sourceW=e.width,this.sourceH=e.height,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.directionalBlurFilter||(this.directionalBlurFilter=new BFN.filters.DirectionalBlurFilter,this.directionalBlurFilter.amount=.25,this.directionalBlurFilter.direction=0),this.directionalBlurFilter.setDimensions(this.sourceW,this.sourceH),this.directionalBlurSprite.texture=this.sourceTexture,this.directionalBlurSprite.filters=[this.directionalBlurFilter],this.directionalBlurTexture=PIXI.RenderTexture.create(this.sourceW,this.sourceH),BFN.Stage.render(this.directionalBlurSprite,this.directionalBlurTexture),this.uniforms.blurTexture=this.directionalBlurTexture,this.drawArtifactGraphic();var t=this.sourceW*this.sourceH,n=Math.sqrt(t)/20/Math.sqrt(33e3),i=Math.round(100*n),r=Math.round(330*n);this.artifactGraphic.scale.x=i/100,this.artifactGraphic.scale.y=r/330,this.artifactTexture=PIXI.RenderTexture.create(i,r),BFN.Stage.render(this.artifactGraphic,this.artifactTexture),this.uniforms.artifactTexture=this.artifactTexture,this.uniforms.artifactDimensions=[i,r]}}},{key:"resetSourceTexture",value:function(){this.sourceW=0,this.sourceH=0,this.sourceTexture=null;try{this.directionalBlurTexture.destroyGC(!0)}catch(e){}this.directionalBlurTexture=null,this.directionalBlurSprite.texture=PIXI.Texture.EMPTY,this.directionalBlurSprite.filters=[];try{this.artifactTexture.destroyGC(!0)}catch(e){}this.artifactTexture=null}},{key:"drawArtifactGraphic",value:function(){if(!this.artifactGraphic){var e=new PIXI.Graphics;e.beginFill(0),e.drawRect(0,0,100,330),e.endFill(),e.beginFill(16777215),e.drawRect(0,0,37,6),e.drawRect(0,7,37,1),e.drawRect(0,9,37,1),e.drawRect(0,10,5,5),e.drawRect(13,10,24,5),e.drawRect(39,10,8,5),e.drawRect(54,0,11,8),e.drawRect(54,8,6,1),e.drawRect(54,9,11,1),e.drawRect(52,10,13,5),e.drawRect(72,4,7,4),e.drawRect(72,9,7,3),e.drawRect(81,4,11,4),e.drawRect(81,9,11,3),e.drawRect(94,5,1,5),e.drawRect(0,19,14,2),e.drawRect(18,19,19,2),e.drawRect(38,19,27,2),e.drawRect(72,19,7,2),e.drawRect(79,19,2,1),e.drawRect(81,19,19,2),e.drawRect(56,32,5,1),e.drawRect(56,34,5,2),e.drawRect(69,32,1,1),e.drawRect(70,33,4,1),e.drawRect(74,32,23,1),e.drawRect(69,34,28,2),e.drawRect(14,86,10,1),e.drawRect(27,86,10,1),e.drawRect(38,86,17,1),e.drawRect(6,91,5,3),e.drawRect(0,94,14,3),e.drawRect(14,95,23,2),e.drawRect(24,97,3,1),e.drawRect(38,95,17,2),e.drawRect(36,130,1,2),e.drawRect(39,130,26,2),e.drawRect(72,130,12,2),e.drawRect(50,133,44,1),e.drawRect(42,134,58,1),e.drawRect(40,135,54,1),e.drawRect(0,136,21,2),e.drawRect(28,136,6,2),e.drawRect(34,136,3,1),e.drawRect(37,136,28,2),e.drawRect(66,136,24,2),e.drawRect(26,164,12,2),e.drawRect(38,164,12,3),e.drawRect(38,167,14,3),e.drawRect(38,170,12,2),e.drawRect(56,164,23,8),e.drawRect(80,164,7,8),e.drawRect(0,173,22,6),e.drawRect(24,173,26,6),e.drawRect(56,173,20,6),e.drawRect(70,179,6,5),e.drawRect(0,184,22,1),e.drawRect(0,186,22,1),e.drawRect(0,187,8,1),e.drawRect(11,187,11,1),e.drawRect(24,184,26,1),e.drawRect(24,185,14,1),e.drawRect(24,186,26,2),e.drawRect(56,184,7,1),e.drawRect(62,185,1,1),e.drawRect(56,186,7,2),e.drawRect(66,184,10,4),e.drawRect(18,243,30,1),e.drawRect(50,238,9,1),e.drawRect(50,240,9,4),e.drawRect(59,238,3,2),e.drawRect(59,241,3,3),e.drawRect(62,238,9,1),e.drawRect(62,240,9,4),e.drawRect(72,238,16,1),e.drawRect(72,240,16,4),e.drawRect(72,245,13,1),e.drawRect(92,245,8,1),e.drawRect(23,273,66,2),e.drawRect(36,277,36,1),e.drawRect(16,292,22,3),e.drawRect(39,292,26,3),e.drawRect(72,292,7,3),e.drawRect(81,292,11,3),e.endFill(),this.artifactGraphic=e}}},{key:"grayscale",get:function(){return this.uniforms.grayscale},set:function(e){this.uniforms.grayscale=Math.round(Math.max(0,Math.min(1,e)))}},{key:"phase",get:function(){return this.uniforms.phase},set:function(e){this.uniforms.phase=Math.max(0,Math.min(1,e))}},{key:"length",get:function(){return this.uniforms.length},set:function(e){this.uniforms.length=Math.max(0,Math.min(1,e))}},{key:"horizontal",get:function(){return this.uniforms.horizontal},set:function(e){this.uniforms.horizontal=Math.max(0,Math.min(1,e))}}]),n}(),Ac="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform float grayscale;\nuniform float horizontal;\nuniform float vertical;\nuniform float colorCycle;\n\nvoid main(void){\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n\n    float pixelOffsetMax = (shortestSide / 4.0);\n\n    vec2 pixelOffset = vec2(floor(horizontal * pixelOffsetMax), floor(vertical * pixelOffsetMax));\n\n    //--\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n    vec2 pixelCoordA = clamp((pixelCoord + pixelOffset), vec2(0.0), (pixelDimensions - vec2(1.0)));\n    vec2 pixelCoordB = clamp((pixelCoord - pixelOffset), vec2(0.0), (pixelDimensions - vec2(1.0)));\n\n    vec2 scaleCoord = ((pixelCoord / pixelDimensions) * scaleDimensions);\n    vec2 scaleCoordA = ((pixelCoordA / pixelDimensions) * scaleDimensions);\n    vec2 scaleCoordB = ((pixelCoordB / pixelDimensions) * scaleDimensions);\n\n    //--\n\n    vec4 pixelColor = texture2D(uSampler, scaleCoord);\n    if (pixelColor.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n    pixelColor.rgb /= pixelColor.a;\n\n    vec4 pixelColorA = texture2D(uSampler, scaleCoordA);\n    pixelColorA.rgb /= pixelColorA.a;\n\n    vec4 pixelColorB = texture2D(uSampler, scaleCoordB);\n    pixelColorB.rgb /= pixelColorB.a;\n\n    //--\n\n    if (grayscale == 1.0){\n\n        float pixelLumo = getLumo(pixelColor.rgb);\n        float pixelLumoA = getLumo(pixelColorA.rgb);\n        float pixelLumoB = getLumo(pixelColorB.rgb);\n\n        pixelColor.rgb = vec3(pixelLumo);\n        pixelColorA.rgb = vec3(pixelLumoA);\n        pixelColorB.rgb = vec3(pixelLumoB);\n\n    }\n\n    //--\n\n    if (colorCycle == 0.0){\n        pixelColor.r = pixelColorA.r;\n        pixelColor.b = pixelColorB.b;\n    }else if\n        (colorCycle == 1.0){\n        pixelColor.r = pixelColorA.r;\n        pixelColor.g = pixelColorB.g;\n    }else if\n        (colorCycle == 2.0){\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorB.b;\n    }else if\n        (colorCycle == 3.0){\n        pixelColor.r = pixelColorB.r;\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorB.b;\n    }else if\n        (colorCycle == 4.0){\n        pixelColor.r = pixelColorA.r;\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorB.b;\n    }else if\n        (colorCycle == 5.0){\n        pixelColor.r = pixelColorB.r;\n        pixelColor.g = pixelColorA.g;\n        pixelColor.b = pixelColorA.b;\n    }\n\n    //--\n\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n}\n",Vc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Ac)).padding=0,e.sourceW=0,e.sourceH=0,e.horizontal=.1,e.vertical=0,e.colorCycle=0,e}return a(n,[{key:"setDimensions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e>0&&t>0&&(this.sourceW!==e||this.sourceH!==t)&&(this.sourceW=e,this.sourceH=t,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)])}},{key:"grayscale",get:function(){return this.uniforms.grayscale},set:function(e){this.uniforms.grayscale=Math.round(Math.max(0,Math.min(1,e)))}},{key:"horizontal",get:function(){return this.uniforms.horizontal},set:function(e){this.uniforms.horizontal=Math.max(-1,Math.min(1,e))}},{key:"vertical",get:function(){return this.uniforms.vertical},set:function(e){this.uniforms.vertical=Math.max(-1,Math.min(1,e))}},{key:"colorCycle",get:function(){return this.uniforms.colorCycle},set:function(e){this.uniforms.colorCycle=Math.max(0,Math.min(5,e))}}]),n}(),Uc="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform sampler2D loresTexture1;\nuniform vec2 loresDimensions1;\n\nuniform sampler2D loresTexture2;\nuniform vec2 loresDimensions2;\n\nuniform sampler2D loresTexture3;\nuniform vec2 loresDimensions3;\n\nuniform sampler2D loresTexture4;\nuniform vec2 loresDimensions4;\n\nuniform float grayscale;\nuniform float highlights;\nuniform float offset;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\nconst float maxCycles = 100.0;\n\nfloat getLoresLumo(vec2 pixelCoord, sampler2D texture, vec2 dimensions){\n    vec2 pixelSize = (1.0 / dimensions);\n    vec2 coord = ((floor((pixelCoord / pixelDimensions) * dimensions) / dimensions) + (pixelSize / 2.0));\n    vec4 color = texture2D(texture, coord);\n    float lumo = getLumo(color.rgb);\n    return lumo;\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n\n    //--\n\n    float shortestSide = min(pixelDimensions.x, pixelDimensions.y);\n    float maxOffset = (shortestSide / 128.0);\n    float offsetDistance = (offset * maxOffset);\n\n    float lowestResLumo1 = getLoresLumo(pixelCoord, loresTexture4, loresDimensions4);\n    float lowestResLumo2 = getLoresLumo(pixelCoord, loresTexture3, loresDimensions3);\n    float beta = (lowestResLumo1 * lowestResLumo2 * PIx2 * maxCycles);\n\n    vec2 pixelOffset = floor(vec2((cos(beta) * offsetDistance), (sin(beta) * offsetDistance)));\n\n    pixelCoord = mod((pixelCoord + pixelOffset + pixelDimensions), pixelDimensions);\n\n    //--\n\n    vec4 pixelColor = texture2D(uSampler, ((pixelCoord / pixelDimensions) * scaleDimensions));\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    float pixelLumo = getLumo(pixelColor.rgb);\n\n    //--\n\n    float loresLumo1 = getLoresLumo(pixelCoord, loresTexture1, loresDimensions1);\n    float loresLumo2 = getLoresLumo(pixelCoord, loresTexture2, loresDimensions2);\n    float loresLumo3 = getLoresLumo(pixelCoord, loresTexture3, loresDimensions3);\n    float loresLumo4 = getLoresLumo(pixelCoord, loresTexture4, loresDimensions4);\n\n    //--\n\n    float newPixelLumo = min(loresLumo4, min(loresLumo3, min(loresLumo2, min(loresLumo1, pixelLumo))));\n\n    vec4 newPixelColor = vec4(vec3(newPixelLumo), pixelColor.a);\n\n    if (grayscale == 0.0){\n\n        float k = (1.0 - max(pixelColor.r, max(pixelColor.g, pixelColor.b)));\n        float c = ((1.0 - pixelColor.r - k) / (1.0 - k));\n        float m = ((1.0 - pixelColor.g - k) / (1.0 - k));\n        float y = ((1.0 - pixelColor.b - k) / (1.0 - k));\n\n        k = (1.0 - newPixelLumo);\n\n        newPixelColor.r = ((1.0 - c) * (1.0 - k));\n        newPixelColor.g = ((1.0 - m) * (1.0 - k));\n        newPixelColor.b = ((1.0 - y) * (1.0 - k));\n\n        newPixelLumo = getLumo(newPixelColor.rgb);\n\n    }else{\n\n        pixelColor.rgb = vec3(pixelLumo);\n\n    }\n\n    //--\n\n    float highlightsThreshold = (1.0 - highlights);\n\n    if (pixelLumo > newPixelLumo && pixelLumo > highlightsThreshold){\n        float mixValue = ((pixelLumo - highlightsThreshold) / (1.0 - highlightsThreshold)) * highlights;\n        newPixelColor = mix(newPixelColor, pixelColor, mixValue);\n    }\n\n    //--\n\n\tgl_FragColor = newPixelColor;\n\n}\n",Gc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Uc)).padding=0,e.sourceTexture=null,e.sourceW=0,e.sourceH=0,e}return a(n,[{key:"setSourceTexture",value:function(e){e&&e.baseTexture&&e!==this.sourceTexture&&(this.resetSourceTexture(),this.sourceTexture=e,this.sourceW=e.width,this.sourceH=e.height,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.generateLoresTextures())}},{key:"resetSourceTexture",value:function(){this.sourceW=0,this.sourceH=0,this.sourceTexture=null,this.destroyLoresTextures()}},{key:"generateLoresTextures",value:function(){if(this.sourceTexture&&this.sourceW&&this.sourceH){var e=function(e,t,n){t=t||512;var i={x:(n=n||t)/e.width,y:t/e.width},r=PIXI.RenderTexture.create(Math.max(1,Math.min(BFN.maxImageSize,Math.round(e.width*i.x))),Math.max(1,Math.min(BFN.maxImageSize,Math.round(e.height*i.y))));return i.x=r.width/e.width,i.y=r.height/e.height,r.copyPixels(e,void 0,void 0,void 0,i),r};this.loresTexture1||(this.loresTexture1=e(this.sourceTexture,512),this.uniforms.loresTexture1=this.loresTexture1,this.uniforms.loresDimensions1=[this.loresTexture1.width,this.loresTexture1.height]),this.loresTexture2||(this.loresTexture2=e(this.loresTexture1,144),this.uniforms.loresTexture2=this.loresTexture2,this.uniforms.loresDimensions2=[this.loresTexture2.width,this.loresTexture2.height]),this.loresTexture3||(this.loresTexture3=e(this.loresTexture1,64),this.uniforms.loresTexture3=this.loresTexture3,this.uniforms.loresDimensions3=[this.loresTexture3.width,this.loresTexture3.height]),this.loresTexture4||(this.loresTexture4=e(this.loresTexture1,24),this.uniforms.loresTexture4=this.loresTexture4,this.uniforms.loresDimensions4=[this.loresTexture4.width,this.loresTexture4.height])}}},{key:"destroyLoresTextures",value:function(){try{this.loresTexture1.destroyGC(!0)}catch(e){}this.loresTexture1=null;try{this.loresTexture2.destroyGC(!0)}catch(e){}this.loresTexture2=null;try{this.loresTexture3.destroyGC(!0)}catch(e){}this.loresTexture3=null;try{this.loresTexture4.destroyGC(!0)}catch(e){}this.loresTexture4=null}},{key:"grayscale",get:function(){return this.uniforms.grayscale},set:function(e){this.uniforms.grayscale=Math.round(Math.max(0,Math.min(1,e)))}},{key:"highlights",get:function(){return this.uniforms.highlights},set:function(e){this.uniforms.highlights=Math.max(0,Math.min(1,e))}},{key:"offset",get:function(){return this.uniforms.offset},set:function(e){this.uniforms.offset=Math.max(0,Math.min(1,e))}}]),n}(),Hc="#define GLSLIFY 1\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec2 pixelDimensions;\nuniform vec2 scaleDimensions;\n\nuniform sampler2D sweepTexture;\n\nuniform sampler2D loresTexture;\nuniform vec2 loresDimensions;\n\n//uniform sampler2D artifactTexture;\n//uniform vec2 artifactDimensions;\n\nuniform vec3 colorValue;\nuniform float highlights;\nuniform float weight;\nuniform float horizontal;\n\nconst float PI = 3.14159265358979323846264;\nconst float PIx2 = (PI * 2.0);\n\nvec4 getSweepColor(vec2 pixelCoord){\n    vec2 pixelSize = (1.0 / loresDimensions);\n    vec2 coord = ((floor((pixelCoord / pixelDimensions) * loresDimensions) / loresDimensions) + (pixelSize / 2.0));\n    vec4 color = texture2D(sweepTexture, coord);\n    return color;\n}\n\nvec4 getLoresColor(vec2 pixelCoord){\n    vec2 pixelSize = (1.0 / loresDimensions);\n    vec2 coord = ((floor((pixelCoord / pixelDimensions) * loresDimensions) / loresDimensions) + (pixelSize / 2.0));\n    vec4 color = texture2D(loresTexture, coord);\n    return color;\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = ((vTextureCoord / scaleDimensions) * pixelDimensions);\n\n    vec4 pixelColor = texture2D(uSampler, ((pixelCoord / pixelDimensions) * scaleDimensions));\n\n    //--\n\n    vec2 loresPixelSize = (pixelDimensions / loresDimensions);\n    vec2 loresCellSize = (loresPixelSize * 2.0);\n\n    float colIndex = floor(pixelCoord.x / loresCellSize.x);\n    float rowOffset = (mod(colIndex, 2.0) == 0.0) ? 0.0 : loresPixelSize.y;\n\n    float rowIndex = floor((pixelCoord.y + rowOffset) / loresCellSize.y);\n\n    //--\n\n    vec2 cellPixelCoord = vec2(((loresCellSize.x * colIndex)), ((loresCellSize.y * rowIndex)));\n    vec2 cellPixelCoordOffset = vec2(0.0, rowOffset);\n    vec2 offsetCellPixelCoord = (cellPixelCoord + cellPixelCoordOffset);\n\n    vec2 mixValue = mod(((pixelCoord + cellPixelCoordOffset) / loresCellSize), 1.0);\n\n    vec4 loresColorTL = getLoresColor(cellPixelCoord);\n    vec4 loresColorTR = getLoresColor(cellPixelCoord + vec2(loresPixelSize.x, 0.0));\n    vec4 loresColorBL = getLoresColor(cellPixelCoord + vec2(0.0, loresPixelSize.y));\n    vec4 loresColorBR = getLoresColor(cellPixelCoord + loresPixelSize);\n\n    vec4 loresColorT = mix(loresColorTL, loresColorTR, mixValue.x);\n    vec4 loresColorB = mix(loresColorBL, loresColorBR, mixValue.x);\n\n    vec4 loresColor = mix(loresColorT, loresColorB, mixValue.y);\n\n    if (mod(colIndex, 2.0) == 1.0){\n        float loresRow = floor(pixelCoord.y / loresPixelSize.y);\n        if (loresRow == 0.0 || loresRow == (loresDimensions.y - 1.0)){\n            loresColor = loresColorT;\n        }\n    }\n\n    //--\n\n    vec4 loresColorAvg = ((loresColorTL + loresColorTR + loresColorBL + loresColorBR) / 4.0);\n    float loresLumoAvg = getLumo(loresColorAvg.rgb);\n\n    //--\n\n    vec4 sweepColorTL = getSweepColor(cellPixelCoord);\n    vec4 sweepColorTR = getSweepColor(cellPixelCoord + vec2(loresPixelSize.x, 0.0));\n    vec4 sweepColorBL = getSweepColor(cellPixelCoord + vec2(0.0, loresPixelSize.y));\n    vec4 sweepColorBR = getSweepColor(cellPixelCoord + loresPixelSize);\n\n    vec4 sweepColorT = ((sweepColorTL + sweepColorTR) / 2.0);\n    vec4 sweepColorB = ((sweepColorBL + sweepColorBR) / 2.0);\n\n    vec4 sweepColor = ((sweepColorT + sweepColorB) / 2.0);\n\n    if (mod(colIndex, 2.0) == 1.0){\n        float loresRow = floor(pixelCoord.y / loresPixelSize.y);\n        if (loresRow == 0.0 || loresRow == (loresDimensions.y - 1.0)){\n            sweepColor = sweepColorT;\n        }\n    }\n\n    float sweepLumo = getLumo(sweepColor.rgb);\n\n    //--\n\n    float visibleW = (mix((loresCellSize.x * loresLumoAvg), loresCellSize.x, (weight / 2.0)) * sweepLumo);\n    float leftoverW = (loresCellSize.x - visibleW);\n\n    float offsetFactorX = horizontal;\n    float offsetX = (offsetFactorX * leftoverW);\n\n    vec2 relativePosition = mod((pixelCoord + vec2(0.0, rowOffset)), loresCellSize);\n\n    float darkMixX = 1.0;\n    if (relativePosition.x < offsetX || relativePosition.x > (visibleW + offsetX)){\n        darkMixX = 0.0;\n    }\n\n    //--\n\n    float visibleH = (loresCellSize.y * ((sweepLumo * 0.4) + 0.6));\n    float offsetY = ((loresCellSize.y / 2.0) - (visibleH / 2.0));\n\n    float darkMixY = 1.0;\n    if (relativePosition.y < offsetY || relativePosition.y > (visibleH + offsetY)){\n        darkMixY = 0.0;\n    }\n\n    //--\n\n    /*\n    vec2 artifactPixelCoord = mod(pixelCoord, artifactDimensions);\n    vec2 artifactScaleCoord = (artifactPixelCoord / artifactDimensions);\n    vec4 artifactColor = texture2D(artifactTexture, artifactScaleCoord);\n    float artifactLumo = getLumo(artifactColor.rgb);\n    */\n\n    float artifactMix = 1.0;//(1.0 - (artifactLumo * 0.5));\n\n    //--\n\n    // COLUMN BORDERS ( SOFT )\n    /*\n    darkMixX *= sin(mixValue.x * PI);\n    darkMixX = 1.0 - darkMixX;\n    darkMixX *= darkMixX * darkMixX;\n    darkMixX = 1.0 - darkMixX;\n\n    // ROW BORDERS ( SOFT )\n    /*\n    darkMixY *= sin(mixValue.y * PI);\n    darkMixY = 1.0 - darkMixY;\n    darkMixY *= darkMixY * darkMixY;\n    darkMixY = 1.0 - darkMixY;\n    */\n\n    //--\n\n    float colorValueLumo = getLumo(colorValue);\n\n    loresColor.rgb *= (darkMixX * darkMixY * artifactMix);\n\n    float loresLumo = getLumo(loresColor.rgb);\n\n    if (colorValue.r >= 0.0 && colorValue.g >= 0.0 && colorValue.b >= 0.0){\n        loresColor.rgb = vec3(loresLumo) * colorValue;\n    }\n\n    float highlightsThreshold = (1.0 - highlights);\n    if (loresLumo > highlightsThreshold){\n        float mixValue = (((loresLumo - highlightsThreshold) / (1.0 - highlightsThreshold)) * 1.0);\n        loresColor = mix(loresColor, vec4(1.0), mixValue);\n    }\n\n    pixelColor = vec4(loresColor.rgb, 1.0);\n\n    //--\n\n    if (mod(pixelCoord.x, cellPixelCoord.x) < 1.0 || mod((pixelCoord.y + rowOffset), cellPixelCoord.y) < 1.0){\n        pixelColor.rgb = vec3(0.0);\n    }\n\n    //--\n\n\tgl_FragColor = pixelColor;\n\n}\n",zc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Hc)).padding=0,e.colorValue="55CC55",e.highlights=.5,e.weight=.5,e.horizontal=.5,e.sourceTexture=null,e.sourceW=0,e.sourceH=0,e.sweepFilter=null,e}return a(n,[{key:"setSourceTexture",value:function(e){e&&e.baseTexture&&e!==this.sourceTexture&&(this.resetSourceTexture(),this.sourceTexture=e,this.sourceW=e.width,this.sourceH=e.height,this.uniforms.pixelDimensions=[this.sourceW,this.sourceH],this.uniforms.scaleDimensions=[this.sourceW/BFN.FilterHelper.getNextPowerOfTwo(this.sourceW),this.sourceH/BFN.FilterHelper.getNextPowerOfTwo(this.sourceH)],this.generateHelperTextures())}},{key:"resetSourceTexture",value:function(){this.sourceW=0,this.sourceH=0,this.sourceTexture=null,this.destroyHelperTextures()}},{key:"generateHelperTextures",value:function(){if(this.sourceTexture&&this.sourceW&&this.sourceH&&!this.loresTexture){var e=this.sourceW*this.sourceH,t=Math.min(.5,256/Math.sqrt(e)),n={x:t,y:t};this.loresTexture=PIXI.RenderTexture.create(Math.max(1,Math.min(BFN.maxImageSize,Math.round(this.sourceTexture.width*n.x))),Math.max(1,Math.min(BFN.maxImageSize,Math.round(this.sourceTexture.height*n.y)))),n.x=this.loresTexture.width/this.sourceTexture.width,n.y=this.loresTexture.height/this.sourceTexture.height,this.loresTexture.copyPixels(this.sourceTexture,void 0,void 0,void 0,n),this.uniforms.loresTexture=this.loresTexture,this.uniforms.loresDimensions=[this.loresTexture.width,this.loresTexture.height],this.sweepFilter||(this.sweepFilter=new BFN.filters.SweepFilter),this.sweepFilter.setDimensions(this.loresTexture.width,this.loresTexture.height),this.sweepFilter.averageColor=BFN.Util.getTextureAverageColor(this.loresTexture,!1,!0);var i=new PIXI.Sprite(this.loresTexture);i.filters=[this.sweepFilter],this.sweepTexture=PIXI.RenderTexture.create(this.loresTexture.width,this.loresTexture.height),BFN.Stage.render(i,this.sweepTexture),i.filters=[],i.destroy(!1),this.uniforms.sweepTexture=this.sweepTexture}}},{key:"destroyHelperTextures",value:function(){try{this.loresTexture.destroyGC(!0)}catch(e){}this.loresTexture=null;try{this.sweepTexture.destroyGC(!0)}catch(e){}this.sweepTexture=null;try{this.artifactTexture.destroyGC(!0)}catch(e){}this.artifactTexture=null}},{key:"colorValue",get:function(){return this.uniforms.colorValue},set:function(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.colorValue=e}},{key:"highlights",get:function(){return this.uniforms.highlights},set:function(e){this.uniforms.highlights=Math.max(0,Math.min(1,e))}},{key:"weight",get:function(){return this.uniforms.weight},set:function(e){this.uniforms.weight=Math.max(0,Math.min(1,e))}},{key:"horizontal",get:function(){return this.uniforms.horizontal},set:function(e){this.uniforms.horizontal=Math.max(0,Math.min(1,e))}}]),n}(),jc="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float pixelSize;\n\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n    pixelCoord.x = floor(pixelCoord.x);\n    pixelCoord.y = floor(pixelCoord.y);\n\n    float cellSize = ((pixelSize * 3.0) + 1.0);\n\n    float colIndex = floor(pixelCoord.x / cellSize);\n    float rowOffset = (mod(colIndex, 2.0) == 0.0) ? 0.0 : floor((cellSize - 1.0) / 2.0);\n\n    float rowIndex = floor((pixelCoord.y + rowOffset) / cellSize);\n\n    //--\n\n    float cellCenterOffset = ((cellSize - 1.0) / 2.0);\n\n    vec2 cellCenter = vec2(((cellSize * colIndex) + cellCenterOffset), ((cellSize * rowIndex) + cellCenterOffset));\n\n    //-- GET PIXEL COORDINATES FOR CELL\n\n    vec2 pixelCoordTL = unmapCoord(vec2(clamp((cellCenter.x - cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y - cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordTC = unmapCoord(vec2(clamp(cellCenter.x, 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y - cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordTR = unmapCoord(vec2(clamp((cellCenter.x + cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y - cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n\n    vec2 pixelCoordML = unmapCoord(vec2(clamp((cellCenter.x - cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp(cellCenter.y, 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordMC = unmapCoord(vec2(clamp(cellCenter.x, 0.0, (dimensions.x - 1.0)), clamp(cellCenter.y, 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordMR = unmapCoord(vec2(clamp((cellCenter.x + cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp(cellCenter.y, 0.0, (dimensions.y - 1.0))), filterArea);\n\n    vec2 pixelCoordBL = unmapCoord(vec2(clamp((cellCenter.x - cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y + cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordBC = unmapCoord(vec2(clamp(cellCenter.x, 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y + cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 pixelCoordBR = unmapCoord(vec2(clamp((cellCenter.x + cellCenterOffset), 0.0, (dimensions.x - 1.0)), clamp((cellCenter.y + cellCenterOffset), 0.0, (dimensions.y - 1.0))), filterArea);\n\n    //-- GET PIXEL COLORS FOR CELL\n\n    vec4 pixelColorTL = texture2D(uSampler, pixelCoordTL);\n    vec4 pixelColorTC = texture2D(uSampler, pixelCoordTC);\n    vec4 pixelColorTR = texture2D(uSampler, pixelCoordTR);\n\n    vec4 pixelColorML = texture2D(uSampler, pixelCoordML);\n    vec4 pixelColorMC = texture2D(uSampler, pixelCoordMC);\n    vec4 pixelColorMR = texture2D(uSampler, pixelCoordMR);\n\n    vec4 pixelColorBL = texture2D(uSampler, pixelCoordBL);\n    vec4 pixelColorBC = texture2D(uSampler, pixelCoordBC);\n    vec4 pixelColorBR = texture2D(uSampler, pixelCoordBR);\n\n    //-- GET AVERAGE COLOR FOR CELL\n\n    vec4 cellAverageColor = ((pixelColorTL + pixelColorTC + pixelColorTR + pixelColorML + pixelColorMC + pixelColorMR + pixelColorBL + pixelColorBC + pixelColorBR) / 9.0);\n    cellAverageColor.a = 1.0;\n\n    //--\n\n    vec4 color = cellAverageColor;\n\n    float cellColIndex = mod(pixelCoord.x, cellSize);\n    float cellRowIndex = mod((pixelCoord.y + rowOffset), cellSize);\n\n    float lightenFactor = 1.25;\n    float darkenFactor = 2.5;\n\n    if ((cellColIndex == (cellSize - 1.0)) || (cellRowIndex == (cellSize - 1.0))){ // SEPARATOR LINES\n        color.rgb = vec3(0.0);\n    }else{\n        if (cellColIndex < (pixelSize * 1.0)){ // RED\n            color.r = clamp((color.r * lightenFactor), 0.0, 1.0);\n            color.gb /= darkenFactor;\n        }else if\n            (cellColIndex < (pixelSize * 2.0)){ // GREEN\n            color.g = clamp((color.g * lightenFactor), 0.0, 1.0);\n            color.rb /= darkenFactor;\n        }else if\n            (cellColIndex < (pixelSize * 3.0)){ // BLUE\n            color.b = clamp((color.b * lightenFactor), 0.0, 1.0);\n            color.rg /= darkenFactor;\n        }\n    }\n\n    gl_FragColor = color;\n\n}\n",Xc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,jc)).padding=0,e}return a(n,[{key:"pixelSize",get:function(){return this.uniforms.pixelSize},set:function(e){this.uniforms.pixelSize=Math.max(1,e)}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}}]),n}(),Wc="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float distortion;\n\nuniform float focalPointX;\nuniform float focalPointY;\n\nuniform vec2 dimensions;\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n    pixelCoord.x = floor(pixelCoord.x);\n    pixelCoord.y = floor(pixelCoord.y);\n\n    float offsetFactorX = ((pixelCoord.x - (dimensions.x * focalPointX)) / (dimensions.x * 1.0));\n    float offsetFactorY = ((pixelCoord.y - (dimensions.y * focalPointY)) / (dimensions.y * 1.0));\n\n    float maxOffsetX = (dimensions.x / 128.0);\n    float maxOffsetY = (dimensions.y / 128.0);\n\n    float offsetX = (distortion * offsetFactorX * maxOffsetX);\n    float offsetY = (distortion * offsetFactorY * maxOffsetY);\n\n    vec2 offsetCoord1 = unmapCoord(vec2(clamp((pixelCoord.x - (offsetX * 1.0)), 0.0, (dimensions.x - 1.0)), clamp((pixelCoord.y - (offsetY * 1.0)), 0.0, (dimensions.y - 1.0))), filterArea);\n    vec2 offsetCoord2 = unmapCoord(vec2(clamp((pixelCoord.x - (offsetX * 2.0)), 0.0, (dimensions.x - 1.0)), clamp((pixelCoord.y - (offsetY * 2.0)), 0.0, (dimensions.y - 1.0))), filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    pixelColor.rgb /= pixelColor.a;\n\n    vec4 offsetPixelColor1 = texture2D(uSampler, offsetCoord1);\n    vec4 offsetPixelColor2 = texture2D(uSampler, offsetCoord2);\n\n    if (offsetPixelColor1.a > 0.0) {\n        offsetPixelColor1.rgb /= offsetPixelColor1.a;\n    }\n\n    if (offsetPixelColor2.a > 0.0) {\n        offsetPixelColor2.rgb /= offsetPixelColor2.a;\n    }\n\n    pixelColor.g = offsetPixelColor1.g;\n    pixelColor.r = offsetPixelColor2.r;\n\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n}\n",Yc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Wc)).padding=0,e.distortion=1,e}return a(n,[{key:"distortion",get:function(){return this.uniforms.distortion},set:function(e){this.uniforms.distortion=Math.max(0,e)}},{key:"focalPointX",get:function(){return this.uniforms.focalPointX},set:function(e){this.uniforms.focalPointX=Math.max(0,Math.min(1,e))}},{key:"focalPointY",get:function(){return this.uniforms.focalPointY},set:function(e){this.uniforms.focalPointY=Math.max(0,Math.min(1,e))}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}}]),n}(),qc="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float stretch;\nuniform float distortion;\nuniform float vignetteOpacity;\nuniform float edgeBlur;\n\nuniform vec2 dimensions;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId4 = (PI / 4.0);\nconst float PId8 = (PI / 8.0);\nconst float PHI = 1.618033988749895;\nconst float fibonacciBetaStep = (PIx2 / PHI);\n\nvoid main(void){\n\n    //-- GET CURRENT PIXEL COORDINATE\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n    pixelCoord.x = floor(pixelCoord.x);\n    pixelCoord.y = floor(pixelCoord.y);\n\n    //-- DISTORT COORDINATE\n\n    // X-DISTORTION\n\n\tfloat offsetFactor = cos((1.0 - (pixelCoord.x / (dimensions.x - 1.0))) * PI);\n\n\tfloat sourceX = (dimensions.x / 2.0) + ((dimensions.x / 2.0) * offsetFactor);\n\n\tfloat pixelOffsetX = (((pixelCoord.x - sourceX) / 4.0) * stretch);\n\n    // Y-DISTORTION\n\n    float xFactor = (pixelCoord.x / dimensions.x);\n\n    float beta = (PI * xFactor);\n\n    float sinFactor = sin(beta);\n\n    float yFactor = clamp(((dimensions.y / 2.0) - pixelCoord.y) / (dimensions.y / 2.0), -1.0, 1.0);\n\n    float maxDisplacementY = (min(dimensions.x, dimensions.y) / 24.0);\n\n    float pixelOffsetY = (distortion * sinFactor * yFactor * maxDisplacementY);\n\n    //--\n\n    vec2 distortedPixelCoord = vec2((pixelCoord.x + pixelOffsetX), (pixelCoord.y + pixelOffsetY));\n\n    vec2 unmappedDistortedPixelCoord = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n\n    //-- GET CURRENT PIXEL COLOR\n    vec4 pixelColor = texture2D(uSampler, unmappedDistortedPixelCoord);\n\n    //-- DETERMINE ELLIPSE\n\n    bool isLandscape = (dimensions.x > dimensions.y);\n\n    vec2 ellipseFocusCoord1 = (dimensions / 2.0);\n    vec2 ellipseFocusCoord2 = (dimensions / 2.0);\n\n    if (isLandscape){ // LANDSCAPE ORIENTATION\n        ellipseFocusCoord1.x = (dimensions.x * 0.1);\n        ellipseFocusCoord2.x = (dimensions.x * 0.9);\n    }else{ // PORTRAIT ORIENTATION\n        ellipseFocusCoord1.y = (dimensions.y * 0.1);\n        ellipseFocusCoord2.y = (dimensions.y * 0.9);\n    }\n\n    float outerRadius = ((isLandscape ? dimensions.x : dimensions.y) * 1.1); // 1.2\n    float innerRadius = ((isLandscape ? dimensions.x : dimensions.y) * 0.8); // 0.9\n\n    //--\n\n    float dx1 = (pixelCoord.x - ellipseFocusCoord1.x);\n    float dy1 = (pixelCoord.y - ellipseFocusCoord1.y);\n    float dd1 = sqrt(pow(dx1, 2.0) + pow(dy1, 2.0));\n\n    float dx2 = (pixelCoord.x - ellipseFocusCoord2.x);\n    float dy2 = (pixelCoord.y - ellipseFocusCoord2.y);\n    float dd2 = sqrt(pow(dx2, 2.0) + pow(dy2, 2.0));\n\n    float radius = (dd1 + dd2);\n\n    //-- EDGE BLUR\n\n    float blurFactor = 1.0;\n    if (edgeBlur > 0.0 && radius > innerRadius){\n\n        if (radius <= outerRadius){\n            blurFactor = ((radius - innerRadius) / (outerRadius - innerRadius));\n        }\n\n        ///* // FIBONACCI SPIRAL (SUNFLOWER SEED POINT DISTRIBUTION, 18 SAMPLES, PLUS EXISTING CENTER SAMPLE, 19 SAMPLES TOTAL)\n\n        float maxSpread = (outerRadius / 100.0); // 128.0\n        float spread = (maxSpread * blurFactor * edgeBlur);\n        float spreadDistanceStep = (spread / 20.0);\n\n        vec2 pt01 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 2.0) * (spreadDistanceStep * 2.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 2.0) * (spreadDistanceStep * 2.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt02 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 3.0) * (spreadDistanceStep * 3.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 3.0) * (spreadDistanceStep * 3.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt03 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 4.0) * (spreadDistanceStep * 4.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 4.0) * (spreadDistanceStep * 4.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt04 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 5.0) * (spreadDistanceStep * 5.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 5.0) * (spreadDistanceStep * 5.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt05 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 6.0) * (spreadDistanceStep * 6.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 6.0) * (spreadDistanceStep * 6.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt06 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 7.0) * (spreadDistanceStep * 7.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 7.0) * (spreadDistanceStep * 7.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt07 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 8.0) * (spreadDistanceStep * 8.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 8.0) * (spreadDistanceStep * 8.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt08 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 9.0) * (spreadDistanceStep * 9.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 9.0) * (spreadDistanceStep * 9.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt09 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 10.0) * (spreadDistanceStep * 10.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 10.0) * (spreadDistanceStep * 10.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt10 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 11.0) * (spreadDistanceStep * 11.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 11.0) * (spreadDistanceStep * 11.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt11 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 12.0) * (spreadDistanceStep * 12.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 12.0) * (spreadDistanceStep * 12.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt12 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 13.0) * (spreadDistanceStep * 13.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 13.0) * (spreadDistanceStep * 13.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt13 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 14.0) * (spreadDistanceStep * 14.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 14.0) * (spreadDistanceStep * 14.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt14 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 15.0) * (spreadDistanceStep * 15.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 15.0) * (spreadDistanceStep * 15.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt15 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 16.0) * (spreadDistanceStep * 16.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 16.0) * (spreadDistanceStep * 16.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt16 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 17.0) * (spreadDistanceStep * 17.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 17.0) * (spreadDistanceStep * 17.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt17 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 18.0) * (spreadDistanceStep * 18.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 18.0) * (spreadDistanceStep * 18.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pt18 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos(fibonacciBetaStep * 19.0) * (spreadDistanceStep * 19.0))), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin(fibonacciBetaStep * 19.0) * (spreadDistanceStep * 19.0))), 0.0, (dimensions.y - 1.0))), filterArea);\n\n        pixelColor += texture2D(uSampler, pt01);\n        pixelColor += texture2D(uSampler, pt02);\n        pixelColor += texture2D(uSampler, pt03);\n        pixelColor += texture2D(uSampler, pt04);\n        pixelColor += texture2D(uSampler, pt05);\n        pixelColor += texture2D(uSampler, pt06);\n        pixelColor += texture2D(uSampler, pt07);\n        pixelColor += texture2D(uSampler, pt08);\n        pixelColor += texture2D(uSampler, pt09);\n        pixelColor += texture2D(uSampler, pt10);\n        pixelColor += texture2D(uSampler, pt11);\n        pixelColor += texture2D(uSampler, pt12);\n        pixelColor += texture2D(uSampler, pt13);\n        pixelColor += texture2D(uSampler, pt14);\n        pixelColor += texture2D(uSampler, pt15);\n        pixelColor += texture2D(uSampler, pt16);\n        pixelColor += texture2D(uSampler, pt17);\n        pixelColor += texture2D(uSampler, pt18);\n\n        pixelColor /= 19.0;\n\n        //*/\n\n        /* // LAYERED DOUBLE-BOX SPREAD (INNER + OUTER RADIUS, 16 SAMPLES, PLUS EXISTING CENTER SAMPLE, 17 SAMPLES TOTAL)\n\n        float outerSpread = ((outerRadius / 128.0) * blurFactor * edgeBlur);\n        float innerSpread = (outerSpread / 2.0);\n\n        vec2 outerPt1 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 0.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 0.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt2 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 1.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 1.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt3 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 2.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 2.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt4 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 3.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 3.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt5 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 4.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 4.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt6 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 5.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 5.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt7 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 6.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 6.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 outerPt8 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 7.0)) * outerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 7.0)) * outerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n\n        vec2 innerPt1 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 0.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 0.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt2 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 1.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 1.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt3 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 2.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 2.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt4 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 3.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 3.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt5 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 4.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 4.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt6 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 5.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 5.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt7 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 6.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 6.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 innerPt8 = unmapCoord(vec2(clamp((distortedPixelCoord.x + (cos((PId4 * 7.0) + PId8) * innerSpread)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (sin((PId4 * 7.0) + PId8) * innerSpread)), 0.0, (dimensions.y - 1.0))), filterArea);\n\n        //--\n\n        pixelColor += texture2D(uSampler, outerPt1);\n        pixelColor += texture2D(uSampler, outerPt2);\n        pixelColor += texture2D(uSampler, outerPt3);\n        pixelColor += texture2D(uSampler, outerPt4);\n        pixelColor += texture2D(uSampler, outerPt5);\n        pixelColor += texture2D(uSampler, outerPt6);\n        pixelColor += texture2D(uSampler, outerPt7);\n        pixelColor += texture2D(uSampler, outerPt8);\n\n        pixelColor += texture2D(uSampler, innerPt1);\n        pixelColor += texture2D(uSampler, innerPt2);\n        pixelColor += texture2D(uSampler, innerPt3);\n        pixelColor += texture2D(uSampler, innerPt4);\n        pixelColor += texture2D(uSampler, innerPt5);\n        pixelColor += texture2D(uSampler, innerPt6);\n        pixelColor += texture2D(uSampler, innerPt7);\n        pixelColor += texture2D(uSampler, innerPt8);\n\n        pixelColor /= 17.0; // GET AVERAGE COLOR FOR BLURRED PIXEL\n\n        */\n\n        /* // BASIC SQUARE SPREAD (INNER + OUTER RADIUS, 13 SAMPLES)\n\n        //-- GET PIXEL COORDINATES FOR BLUR SOURCE\n\n        float spread = ((outerRadius / 128.0) * blurFactor * edgeBlur);\n\n        vec2 pixelCoordTL = unmapCoord(vec2(clamp((distortedPixelCoord.x - spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordTLi = unmapCoord(vec2(clamp((distortedPixelCoord.x - (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n        vec2 pixelCoordTC = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordTR = unmapCoord(vec2(clamp((distortedPixelCoord.x + spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordTRi = unmapCoord(vec2(clamp((distortedPixelCoord.x + (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y - (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n\n        vec2 pixelCoordML = unmapCoord(vec2(clamp((distortedPixelCoord.x - spread), 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordMC = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordMR = unmapCoord(vec2(clamp((distortedPixelCoord.x + spread), 0.0, (dimensions.x - 1.0)), clamp(distortedPixelCoord.y, 0.0, (dimensions.y - 1.0))), filterArea);\n\n        vec2 pixelCoordBL = unmapCoord(vec2(clamp((distortedPixelCoord.x - spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordBLi = unmapCoord(vec2(clamp((distortedPixelCoord.x - (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n        vec2 pixelCoordBC = unmapCoord(vec2(clamp(distortedPixelCoord.x, 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordBR = unmapCoord(vec2(clamp((distortedPixelCoord.x + spread), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + spread), 0.0, (dimensions.y - 1.0))), filterArea);\n        vec2 pixelCoordBRi = unmapCoord(vec2(clamp((distortedPixelCoord.x + (spread / 2.0)), 0.0, (dimensions.x - 1.0)), clamp((distortedPixelCoord.y + (spread / 2.0)), 0.0, (dimensions.y - 1.0))), filterArea); // INNER\n\n        //-- GET PIXEL COLORS FOR BLUR\n\n        vec4 pixelColorTL = texture2D(uSampler, pixelCoordTL);\n        vec4 pixelColorTLi = texture2D(uSampler, pixelCoordTLi); // INNER\n        vec4 pixelColorTC = texture2D(uSampler, pixelCoordTC);\n        vec4 pixelColorTR = texture2D(uSampler, pixelCoordTR);\n        vec4 pixelColorTRi = texture2D(uSampler, pixelCoordTRi); // INNER\n\n        vec4 pixelColorML = texture2D(uSampler, pixelCoordML);\n        vec4 pixelColorMC = texture2D(uSampler, pixelCoordMC);\n        vec4 pixelColorMR = texture2D(uSampler, pixelCoordMR);\n\n        vec4 pixelColorBL = texture2D(uSampler, pixelCoordBL);\n        vec4 pixelColorBLi = texture2D(uSampler, pixelCoordBLi); // INNER\n        vec4 pixelColorBC = texture2D(uSampler, pixelCoordBC);\n        vec4 pixelColorBR = texture2D(uSampler, pixelCoordBR);\n        vec4 pixelColorBRi = texture2D(uSampler, pixelCoordBRi); // INNER\n\n        //-- GET AVERAGE COLOR FOR BLURRED PIXEL\n\n        pixelColor = ((pixelColorTL + pixelColorTLi + pixelColorTC + pixelColorTR + pixelColorTRi + pixelColorML + pixelColorMC + pixelColorMR + pixelColorBL + pixelColorBLi + pixelColorBC + pixelColorBR + pixelColorBRi) / 13.0);\n\n        */\n\n    }\n\n    //-- VIGNETTE\n\n    float vignetteFactor = 1.0;\n    if (vignetteOpacity > 0.0 && radius > innerRadius){\n        if (radius <= outerRadius){\n            vignetteFactor = ((radius - innerRadius) / (outerRadius - innerRadius));\n        }\n        pixelColor = mix(pixelColor, vec4(vec3(0.0), 1.0), (vignetteOpacity * vignetteFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",Kc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,qc)).padding=0,e.distortion=1,e}return a(n,[{key:"stretch",get:function(){return this.uniforms.stretch},set:function(e){this.uniforms.stretch=Math.max(0,Math.min(1,e))}},{key:"distortion",get:function(){return this.uniforms.distortion},set:function(e){this.uniforms.distortion=Math.max(0,e)}},{key:"vignetteOpacity",get:function(){return this.uniforms.vignetteOpacity},set:function(e){this.uniforms.vignetteOpacity=Math.max(0,Math.min(1,e))}},{key:"edgeBlur",get:function(){return this.uniforms.edgeBlur},set:function(e){this.uniforms.edgeBlur=Math.max(0,Math.min(1,e))}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}},{key:"bloomSrc",get:function(){return this.uniforms.bloomSrc},set:function(e){this.uniforms.bloomSrc=e}},{key:"bloomSrcDimensions",get:function(){return this.uniforms.bloomSrcDimensions},set:function(e){this.uniforms.bloomSrcDimensions=e}}]),n}(),Qc="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float distortion;\nuniform vec2 dimensions;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\n\nvoid main(void){\n\n\tvec2 pixelCoord = mapCoord(vTextureCoord, filterArea); // vec2((vTextureCoord.x * dimensions.x), (vTextureCoord.y * dimensions.y));\n\n\tvec2 adjustedPixelCoord = pixelCoord;\n\n\tvec2 centerCoord = vec2((dimensions.x / 2.0), (dimensions.y / 2.0));\n\n    vec2 deltaCoord = (pixelCoord - centerCoord);\n\n    float distance;\n\n\tvec2 unmappedPixelCoord;\n\n\tif (distortion > 0.0){ // FISHEYE\n\n        distance = sqrt(pow(deltaCoord.x, 2.0) + pow(deltaCoord.y, 2.0));\n\n        float strength = (PIx2 / (2.0 * sqrt(dot(centerCoord, centerCoord)))) * (distortion / 3.0);\n\n\t\tfloat bind = sqrt(dot(centerCoord, centerCoord)); // STICK TO CORNERS\n\n        adjustedPixelCoord = (centerCoord + (normalize(deltaCoord) * tan(distance * strength) * (bind / tan(bind * strength))));\n\n\t}else if\n        (distortion < 0.0){ // ANTI-FISHEYE\n\n        float strength = pow(distortion, 2.0);\n\n\t\tfloat diameter = sqrt(pow(dimensions.x, 2.0) + pow(dimensions.y, 2.0));\n\t\tfloat radius = (diameter / 2.0);\n\n\t\tfloat xFactor = (pixelCoord.x / dimensions.x);\n\t\tfloat yFactor = (pixelCoord.y / dimensions.y);\n\n\t\tfloat longestSide = max(dimensions.x, dimensions.y);\n\t\tfloat maxDisplacementX = ((dimensions.y / 8.0) * strength);\n\t\tfloat maxDisplacementY = ((dimensions.x / 8.0) * strength);\n\n\t\tfloat sinFactorX = sin(xFactor * PI);\n\t\tfloat sinFactorY = sin(yFactor * PI);\n\n\t\tfloat distanceFactorX = (deltaCoord.x / (dimensions.x / 2.0));\n\t\tfloat distanceFactorY = (deltaCoord.y / (dimensions.y / 2.0));\n\n\t\t//—\n\n\t\tfloat offsetX = (maxDisplacementX * sinFactorY * distanceFactorX);\n\t\tfloat offsetY = (maxDisplacementY * sinFactorX * distanceFactorY);\n\n\t\tadjustedPixelCoord.x += offsetX;\n\t\tadjustedPixelCoord.y += offsetY;\n\n\t\t//—\n\n\t\tfloat centerW = (dimensions.x - (maxDisplacementX * 2.0));\n\t\tfloat centerH = (dimensions.y - (maxDisplacementY * 2.0));\n\n\t\tfloat scaleFactor = max(max(1.0, (dimensions.x / centerW)), max(1.0, (dimensions.y / centerH)));\n\n        vec2 adjustedDeltaCoord = (adjustedPixelCoord - centerCoord);\n\n\t\tdistance = sqrt(pow(adjustedDeltaCoord.x, 2.0) + pow(adjustedDeltaCoord.y, 2.0));\n\n\t\tfloat beta = atan(adjustedDeltaCoord.y, adjustedDeltaCoord.x);\n\n\t\tfloat distanceFactor = (distance / radius);\n\n\t\tadjustedPixelCoord = vec2((centerCoord.x + (cos(beta) * ((distanceFactor * radius) / scaleFactor))), (centerCoord.y + (sin(beta) * ((distanceFactor * radius) / scaleFactor))));\n\n\t}\n\n\tunmappedPixelCoord = unmapCoord(adjustedPixelCoord, filterArea); // (adjustedPixelCoord / dimensions.xy);\n\n\tvec4 pixelColor = texture2D(uSampler, unmappedPixelCoord);\n\n\t//—\n\n\tgl_FragColor = pixelColor;\n\n}\n",Zc=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Qc)).padding=0,e.distortion=1,e}return a(n,[{key:"distortion",get:function(){return this.uniforms.distortion},set:function(e){this.uniforms.distortion=Math.max(-1,Math.min(1,e))}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}}]),n}(),Jc="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform sampler2D src;\nuniform vec2 srcDimensions;\nuniform vec2 dimensions;\n\nuniform float tolerance;\n\nuniform vec3 shadowColor;\nuniform vec3 highlightColor;\n\nuniform bool invertColors;\n\nvec2 mapSrcCoord(vec2 srcCoord){\n\treturn vec2(floor(srcCoord.x * srcDimensions.x), floor(srcCoord.y * srcDimensions.y));\n}\n\nvec2 unmapSrcCoord(vec2 srcCoord){\n\treturn vec2((srcCoord.x / srcDimensions.x), (srcCoord.y / srcDimensions.y));\n}\n\nvec4 getSrcPixelColor(vec2 srcCoord){\n\n\tvec2 srcCoord0 = unmapSrcCoord(vec2((srcCoord.x + 0.0), (srcCoord.y + 0.0))); // CENTER\n\tvec2 srcCoord1 = unmapSrcCoord(vec2((srcCoord.x - 1.0), (srcCoord.y + 0.0))); // LEFT\n\tvec2 srcCoord2 = unmapSrcCoord(vec2((srcCoord.x + 1.0), (srcCoord.y + 0.0))); // RIGHT\n\tvec2 srcCoord3 = unmapSrcCoord(vec2((srcCoord.x + 0.0), (srcCoord.y - 1.0))); // TOP\n\tvec2 srcCoord4 = unmapSrcCoord(vec2((srcCoord.x + 0.0), (srcCoord.y + 1.0))); // BOTTOM\n\n\tvec4 srcColor0 = texture2D(src, srcCoord0);\n\tvec4 srcColor1 = texture2D(src, srcCoord1);\n\tvec4 srcColor2 = texture2D(src, srcCoord2);\n\tvec4 srcColor3 = texture2D(src, srcCoord3);\n\tvec4 srcColor4 = texture2D(src, srcCoord4);\n\n\tvec4 avgColor = ((srcColor0 + srcColor1 + srcColor2 + srcColor3 + srcColor4) / 5.0);\n\n\treturn avgColor;\n\n}\n\nfloat getSrcPixelLumo(vec2 srcCoord){\n\n\tvec4 avgColor = getSrcPixelColor(srcCoord);\n\n\treturn getLumo(avgColor.rgb);\n\n}\n\nfloat getPixelColorAmount(vec2 pixelCoord, vec2 originCoord, vec2 srcPixelCoord, float maxRadius){\n\n\tfloat colorAmount = (invertColors ? 0.0 : 1.0);\n\n\tvec2 cellCenterDeltaCoord = (pixelCoord - originCoord);\n\tfloat cellCenterDistance = sqrt(pow(cellCenterDeltaCoord.x, 2.0) + pow(cellCenterDeltaCoord.y, 2.0));\n\tif (cellCenterDistance <= maxRadius){\n\t\tfloat cellLumo = getSrcPixelLumo(srcPixelCoord);\n\t\tcellLumo = invertColors ? (cellLumo / 2.0) : ((1.0 - cellLumo) / 1.5);\n\t\tfloat activeRadius = pow((maxRadius * cellLumo), 1.0);\n\t\tif (cellCenterDistance <= activeRadius){\n\t\t\tcolorAmount = (invertColors ? 1.0 : 0.0);\n\t\t}else if\n            (cellCenterDistance <= activeRadius + 2.0){\n\t\t\tfloat fade = sqrt((cellCenterDistance - activeRadius) / 2.0);\n\t\t\tcolorAmount = (invertColors ? (1.0 - fade) : fade);\n\t\t}\n\t}\n\n\treturn colorAmount;\n\n}\n\nvoid main(void){\n\n    // GET CURRENT PIXEL COORDINATE ON MAIN IMAGE\n\tvec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\tpixelCoord.x = floor(pixelCoord.x);\n\tpixelCoord.y = floor(pixelCoord.y);\n\n    // GET NORMALIZED PIXEL COORDINATE (0.0 - 1.0) ON MAIN IMAGE\n\tvec2 normalizedCoord = (pixelCoord / dimensions);\n\n    // GET CURRENT PIXEL COORDINATE ON SOURCE IMAGE (RESIZED TO HALFTONE DOT RESOLUTION)\n\tvec2 srcPixelCoord = mapSrcCoord(normalizedCoord);\n\n    // DETERMINE IF CURRENT SOURCE PIXEL IS IN A SOURCE-DOT POSITION\n\tbool isSRC = ((mod(srcPixelCoord.x, 2.0) == 0.0 && mod(srcPixelCoord.y, 2.0) == 0.0) || (mod(srcPixelCoord.x, 2.0) != 0.0 && mod(srcPixelCoord.y, 2.0) != 0.0));\n\n    // DETERMINE HOW MANY PIXELS ON THE MAIN IMAGE A SINGLE PIXEL TAKES UP ON THE SOURCE IMAGE\n\tvec2 cellSize = vec2((dimensions.x / srcDimensions.x),  (dimensions.y / srcDimensions.y));\n\n\t// DETERMINE THE MAXIMUM RADIUS OF A HALFTONE DOT\n\tfloat maxRadius = (max(cellSize.x, cellSize.y) * (1.0 + tolerance));//1.5;\n\n\t// GET PIXEL COORINATES ON SOURCE IMAGE TO USE FOR AVERAGE PIXEL COLOR\n\tvec2 srcPt0 = vec2((srcPixelCoord.x + 0.0), (srcPixelCoord.y + 0.0)); // CENTER\n\tvec2 srcPt1 = vec2((srcPixelCoord.x - 1.0), (srcPixelCoord.y + 0.0)); // LEFT\n\tvec2 srcPt2 = vec2((srcPixelCoord.x + 1.0), (srcPixelCoord.y + 0.0)); // RIGHT\n\tvec2 srcPt3 = vec2((srcPixelCoord.x + 0.0), (srcPixelCoord.y - 1.0)); // TOP\n\tvec2 srcPt4 = vec2((srcPixelCoord.x + 0.0), (srcPixelCoord.y + 1.0)); // BOTTOM\n\n    // MODIFY PIXEL COORINATES ON SOURCE IMAGE TO USE FOR AVERAGE PIXEL COLOR (IF CURRENT SOURCE PIXEL SHARES COORDINATES WITH A HALFTONE DOT CENTER)\n\tif (isSRC){\n\t\tsrcPt1.y -= 1.0; // TOP LEFT\n\t\tsrcPt2.y += 1.0; // BOTTOM RIGHT\n\t\tsrcPt3.x += 1.0; // TOP RIGHT\n\t\tsrcPt4.x -= 1.0; // BOTTOM LEFT\n    }\n\n    // GET HALFTONE DOT CENTERS ON MAIN IMAGE\n    vec2 mainImageCellCenterCoord0 = ((unmapSrcCoord(srcPt0) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord1 = ((unmapSrcCoord(srcPt1) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord2 = ((unmapSrcCoord(srcPt2) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord3 = ((unmapSrcCoord(srcPt3) * dimensions) + (cellSize / 2.0));\n    vec2 mainImageCellCenterCoord4 = ((unmapSrcCoord(srcPt4) * dimensions) + (cellSize / 2.0));\n\n\t// DETERMINE WHETHER OR NOT TO INCLUDE THE CURRENT PIXEL IN A HALFTONE DOT\n\n\tfloat colorAmount = (invertColors ? 0.0 : 1.0);\n\n\tif (invertColors){\n\n\t\tif (isSRC){\n\t\t\tcolorAmount = max(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord0, srcPt0, maxRadius));\n\t\t}\n\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord1, srcPt1, maxRadius) + colorAmount));\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord2, srcPt2, maxRadius) + colorAmount));\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord3, srcPt3, maxRadius) + colorAmount));\n\t\tcolorAmount = max(colorAmount, min(1.0, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord4, srcPt4, maxRadius) + colorAmount));\n\n\t}else{\n\n\t\tif (isSRC){\n\t\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord0, srcPt0, maxRadius));\n\t\t}\n\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord1, srcPt1, maxRadius) * colorAmount);\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord2, srcPt2, maxRadius) * colorAmount);\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord3, srcPt3, maxRadius) * colorAmount);\n\t\tcolorAmount = min(colorAmount, getPixelColorAmount(pixelCoord, mainImageCellCenterCoord4, srcPt4, maxRadius) * colorAmount);\n\n\t}\n\n\t// DETERMINE FINAL COLOR\n\n    vec4 originalColor = texture2D(uSampler, vTextureCoord);\n\n    originalColor.rgb /= originalColor.a; // UN-PREMULTIPLY\n\n\tvec4 sColor = vec4(((shadowColor.r == -1.0) ? (originalColor.rgb * 0.5) : shadowColor), 1.0);\n\tvec4 hColor = vec4(((highlightColor.r == -1.0) ? (originalColor.rgb * 1.0) : highlightColor), 1.0);\n\n\tvec4 color = mix(sColor, hColor, colorAmount);\n\tcolor.rgb *= originalColor.a; // RE-PREMULTIPLY\n\tcolor.a = originalColor.a; // RE-PREMULTIPLY\n\n\t//--\n\n    gl_FragColor = color;\n\n}\n",$c=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,Jc)).padding=0,e}return a(n,[{key:"src",get:function(){return this.uniforms.src},set:function(e){this.uniforms.src=e}},{key:"srcDimensions",get:function(){return this.uniforms.srcDimensions},set:function(e){this.uniforms.srcDimensions=e}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}},{key:"tolerance",get:function(){return this.uniforms.tolerance},set:function(e){this.uniforms.tolerance=Math.max(0,Math.min(1,e))}},{key:"invertColors",get:function(){return this.uniforms.invertColors},set:function(e){this.uniforms.invertColors=!!e}},{key:"shadowColor",get:function(){return this.uniforms.shadowColor},set:function(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.shadowColor=e}},{key:"highlightColor",get:function(){return this.uniforms.highlightColor},set:function(e){e=-1==e?[-1,-1,-1]:BFN.FilterHelper.hex2rgb(e),this.uniforms.highlightColor=e}}]),n}(),eh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nfloat getLumo(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec3 shadowColor;\nuniform vec3 midtoneColor;\nuniform vec3 highlightColor;\n\nuniform float shadowIntensity;\nuniform float midtoneIntensity;\nuniform float highlightIntensity;\n\nvec3 softlightBlend (vec3 src, vec3 dst)\n{\n    return vec3((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))),\n           \t\t\t\t(src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))),\n           \t\t\t\t(src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))));\n}\n\nvoid main(void){\n\n    vec4 srcColor = texture2D(uSampler, vTextureCoord);\n\n    if (srcColor.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n\n    srcColor.rgb /= srcColor.a;\n\n    float srcLumo = getLumo(srcColor.rgb);\n\n    //--\n\n    vec3 neutralColor = vec3(0.5);\n\n    vec3 sColor = mix(neutralColor, shadowColor, shadowIntensity);\n    vec3 mColor = mix(neutralColor, midtoneColor, midtoneIntensity);\n    vec3 hColor = mix(neutralColor, highlightColor, highlightIntensity);\n\n    //--\n\n    float mixFactor;\n    vec3 dstColor;\n    if (srcLumo <= 0.5){ // SHADOWS -> MIDTONES\n        mixFactor = (srcLumo * 2.0);\n        dstColor = mix(sColor, mColor, mixFactor);\n    }else{ // MIDTONES -> HIGHLIGHTS\n        mixFactor = ((srcLumo - 0.5) * 2.0);\n        dstColor = mix(mColor, hColor, mixFactor);\n    }\n\n    //--\n\n    vec3 softlightColor = softlightBlend(dstColor, srcColor.rgb);\n\n    vec4 color = vec4(softlightColor*srcColor.a, srcColor.a);\n\n\t//--\n\n    gl_FragColor = color;\n\n}\n",th=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,eh)).padding=0,e}return a(n,[{key:"shadowColor",get:function(){return this.uniforms.shadowColor},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.shadowColor=e}},{key:"midtoneColor",get:function(){return this.uniforms.midtoneColor},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.midtoneColor=e}},{key:"highlightColor",get:function(){return this.uniforms.highlightColor},set:function(e){e=BFN.FilterHelper.hex2rgb(e),this.uniforms.highlightColor=e}},{key:"shadowIntensity",get:function(){return this.uniforms.shadowIntensity},set:function(e){this.uniforms.shadowIntensity=Math.max(0,Math.min(1,e))}},{key:"midtoneIntensity",get:function(){return this.uniforms.midtoneIntensity},set:function(e){this.uniforms.midtoneIntensity=Math.max(0,Math.min(1,e))}},{key:"highlightIntensity",get:function(){return this.uniforms.highlightIntensity},set:function(e){this.uniforms.highlightIntensity=Math.max(0,Math.min(1,e))}}]),n}(),nh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float strength;\nuniform float phase;\nuniform float scale;\nuniform float lightness;\n\nuniform vec2 dimensions;\nuniform vec2 mapDimensions;\n\nconst int blurSamplesNum = 63;\nconst float blurRadiusFactor = 0.01;//0.0125;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId4 = (PI / 4.0);\nconst float PId8 = (PI / 8.0);\nconst float PHI = 1.618033988749895;\nconst float fibonacciBetaStep = (PIx2 / PHI);\n\nvec3 screenBlend (vec3 src, vec3 dst){\n    return (src + dst) - (src * dst);\n}\n\nvec3 multiplyBlend (vec3 src, vec3 dst){\n    return src * dst;\n}\n\n/* discontinuous pseudorandom uniformly distributed in [-0.5, +0.5]^3 */\nvec3 random3(vec3 c) {\n\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\tvec3 r;\n\tr.z = fract(512.0*j);\n\tj *= .125;\n\tr.x = fract(512.0*j);\n\tj *= .125;\n\tr.y = fract(512.0*j);\n\treturn r-0.5;\n}\n\n/* skew constants for 3d simplex functions */\nconst float F3 =  0.3333333;\nconst float G3 =  0.1666667;\n\n/* 3d simplex noise */\nfloat simplex3d(vec3 p) {\n\t /* 1. find current tetrahedron T and it's four vertices */\n\t /* s, s+i1, s+i2, s+1.0 - absolute skewed (integer) coordinates of T vertices */\n\t /* x, x1, x2, x3 - unskewed coordinates of p relative to each of T vertices*/\n\n\t /* calculate s and x */\n\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t vec3 x = p - s + dot(s, vec3(G3));\n\n\t /* calculate i1 and i2 */\n\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t vec3 i1 = e*(1.0 - e.zxy);\n\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\n\t /* x1, x2, x3 */\n\t vec3 x1 = x - i1 + G3;\n\t vec3 x2 = x - i2 + 2.0*G3;\n\t vec3 x3 = x - 1.0 + 3.0*G3;\n\n\t /* 2. find four surflets and store them in d */\n\t vec4 w, d;\n\n\t /* calculate surflet weights */\n\t w.x = dot(x, x);\n\t w.y = dot(x1, x1);\n\t w.z = dot(x2, x2);\n\t w.w = dot(x3, x3);\n\n\t /* w fades from 0.6 at the center of the surflet to 0.0 at the margin */\n\t w = max(0.6 - w, 0.0);\n\n\t /* calculate surflet components */\n\t d.x = dot(random3(s), x);\n\t d.y = dot(random3(s + i1), x1);\n\t d.z = dot(random3(s + i2), x2);\n\t d.w = dot(random3(s + 1.0), x3);\n\n\t /* multiply d by w^4 */\n\t w *= w;\n\t w *= w;\n\t d *= w;\n\n\t /* 3. return the sum of the four surflets */\n\t return dot(d, vec4(52.0));\n}\n\nvoid main(void){\n\n\t//-- GET SIMPLEX NOISE VALUE\n\tfloat scaleFactor = (((scale * 2.0) + 1.0) * 5.0);\n\n    vec2 point = vTextureCoord;//((vTextureCoord * mapDimensions) / dimensions);//mapCoord(vTextureCoord, filterArea) / dimensions;\n\n    // ADJUST PROPORTIONS SO NOISE RATIO REMAINS 1:1\n    point.x *= (mapDimensions.x / mapDimensions.y);\n    point.xy /= scaleFactor;\n\n    // RE-POSITION BASED ON SCALE (SO  NOISE IS SCALED FROM CENTER)\n    point.x += ((1.0 - (1.0 / scaleFactor)) / 2.0) * (dimensions.x / mapDimensions.x);\n    point.y += ((1.0 - (1.0 / scaleFactor)) / 2.0) * (dimensions.y / mapDimensions.y);\n\n\tvec3 point3D = vec3(point, (phase * 0.025));\n\n\tfloat noiseValue = simplex3d(point3D * 32.0);\n\tfloat noiseLumo = clamp(((0.3 + (noiseValue * 0.7)) * strength), 0.0, 1.0);\n\n\t//-- BLUR BASED ON NOISE - FIBONACCI SPIRAL (SUNFLOWER SEED POINT DISTRIBUTION)\n\n\tvec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n\tvec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n\tif (noiseLumo > 0.0){\n\n\t\tfloat maxSpread = (sqrt(pow(dimensions.x, 2.0) + pow(dimensions.y, 2.0)) * blurRadiusFactor);\n\t\tfloat spread = (maxSpread * noiseLumo);\n\t\tfloat spreadDistanceStep = (spread / (float(blurSamplesNum) + 1.0));\n\n\t\tfloat betaOffset = fibonacciBetaStep * noiseLumo * ((pixelCoord.y * dimensions.x) + pixelCoord.x);\n\n\t\tfor (int i = 10; i < (blurSamplesNum + 10); i++){\n\t\t\tvec2 samplePoint = unmapCoord(vec2(clamp((pixelCoord.x + (cos(fibonacciBetaStep * float(i) + betaOffset) * (spreadDistanceStep * float(i)))), 0.0, (dimensions.x - 1.0)), clamp((pixelCoord.y + (sin(fibonacciBetaStep * float(i) + betaOffset) * (spreadDistanceStep * float(i)))), 0.0, (dimensions.y - 1.0))), filterArea);\n\t\t\tpixelColor += texture2D(uSampler, samplePoint);\n\t\t}\n\t\tpixelColor /= (float(blurSamplesNum) + 1.0);\n\n\t\tif (lightness > 0.0){\n\t\t\tvec3 screenColor = screenBlend(pixelColor.rgb, pixelColor.rgb);\n\t\t\tpixelColor.rgb = mix(pixelColor.rgb, screenColor, (noiseLumo * lightness));\n\t\t}else if\n            (lightness < 0.0){\n\t\t\tvec3 multiplyColor = multiplyBlend(pixelColor.rgb, pixelColor.rgb);\n\t\t\tpixelColor.rgb = mix(pixelColor.rgb, multiplyColor, (noiseLumo * abs(lightness)));\n\t\t}\n\n\t}\n\n\t//--\n\n\t//gl_FragColor = vec4(vec3(noiseLumo), 1.0); // SHOWS NOISE MAP\n\tgl_FragColor = pixelColor;\n\n}\n",ih=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,nh)).padding=0,e}return a(n,[{key:"strength",get:function(){return this.uniforms.strength},set:function(e){this.uniforms.strength=e}},{key:"phase",get:function(){return this.uniforms.phase},set:function(e){this.uniforms.phase=e}},{key:"scale",get:function(){return this.uniforms.scale},set:function(e){this.uniforms.scale=Math.max(0,Math.min(1,e))}},{key:"lightness",get:function(){return this.uniforms.lightness},set:function(e){this.uniforms.lightness=Math.max(-1,Math.min(1,e))}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}},{key:"mapDimensions",get:function(){return this.uniforms.mapDimensions},set:function(e){this.uniforms.mapDimensions=e}}]),n}(),rh="#define GLSLIFY 1\n// NONAGON SPECIFIC CONSTANTS\nconst float bladeCount = 9.0;\n\nconst int dotsLayer1 = 9;\nconst int dotsLayer2 = 18;\nconst int dotsLayer3 = 27;\nconst int dotsLayer4 = 27;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",ah="#define GLSLIFY 1\n// OCTAGON SPECIFIC CONSTANTS\nconst float bladeCount = 8.0;\n\nconst int dotsLayer1 = 8;\nconst int dotsLayer2 = 16;\nconst int dotsLayer3 = 24;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",oh="#define GLSLIFY 1\n// HEPTAGON SPECIFIC CONSTANTS\nconst float bladeCount = 7.0;\n\nconst int dotsLayer1 = 7;\nconst int dotsLayer2 = 14;\nconst int dotsLayer3 = 21;\nconst int dotsLayer4 = 21;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",sh="#define GLSLIFY 1\n// HEXAGON SPECIFIC CONSTANTS\nconst float bladeCount = 6.0;\n\nconst int dotsLayer1 = 6;\nconst int dotsLayer2 = 12;\nconst int dotsLayer3 = 18;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",lh="#define GLSLIFY 1\n// PENTAGON SPECIFIC CONSTANTS\nconst float bladeCount = 5.0;\n\nconst int dotsLayer1 = 5;\nconst int dotsLayer2 = 10;\nconst int dotsLayer3 = 15;\nconst int dotsLayer4 = 25;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",uh="#define GLSLIFY 1\n// SQUARE SPECIFIC CONSTANTS\nconst float bladeCount = 4.0;\n\nconst int dotsLayer1 = 8;\nconst int dotsLayer2 = 16;\nconst int dotsLayer3 = 16;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",ch="#define GLSLIFY 1\n// TRIANGLE SPECIFIC CONSTANTS\nconst float bladeCount = 3.0;\n\nconst int dotsLayer1 = 6;\nconst int dotsLayer2 = 9;\nconst int dotsLayer3 = 15;\nconst int dotsLayer4 = 24;\n\n// CALCULATED CONSTANTS\nconst int dotsLayers = (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4);\n\n// TRIGONOMETRIC CONSTANTS\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\n// PASS CONSTANTS\nconst float pass1Radius = 1.0;\nconst float pass1Layers = 1.0;\nconst float pass2Radius = 50.0;\nconst float pass2Layers = 4.0;\nconst float pass3Radius = 20.0;\nconst float pass3Layers = 3.0;\nconst float pass4Radius = 8.5;\nconst float pass4Layers = 2.0;\n\n// UNIFORMS\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec4 filterArea;\n\nuniform float currentPass;\nuniform float radius;\nuniform float aperture;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\n// HELPER METHODS\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\n// SAMPLING METHODS\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    // Returns vec3: x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        return vec3(float(dotIndex), float(dotsLayer1), (radius * 1.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        return vec3(float(dotIndex - dotsLayer1), float(dotsLayer2), (radius * 2.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2), float(dotsLayer3), (radius * 3.0));\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        return vec3(float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3), float(dotsLayer4), (radius * 4.0));\n    }\n\n    return vec3(0.0);\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = dotsLayers;\n\n    if (layersNum < 4.0) dotsTotal -= dotsLayer4;\n    if (layersNum < 3.0) dotsTotal -= dotsLayer3;\n    if (layersNum < 2.0) dotsTotal -= dotsLayer2;\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < dotsLayers; i++){\n\n        if (sampledDots < dotsTotal){\n\n            dotData = getDotData(i, dotsLayer1, dotsLayer2, dotsLayer3, dotsLayer4, triangleSide);\n            sampledDots++;\n\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n\n        }\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\n// MAIN\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    gl_FragColor = pixelColor;\n\n}\n",hh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float radius;\nuniform float aperture;\nuniform float bladeCount;\n\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\nuniform float currentPass;\n\nconst float PI = 3.141592653589793238462;\nconst float PIx2 = (PI * 2.0);\nconst float PId2 = (PI / 2.0);\nconst float PId3 = (PI / 3.0);\n\nuniform float pass1Radius;\nuniform float pass1Layers;\nuniform float pass2Radius;\nuniform float pass2Layers;\nuniform float pass3Radius;\nuniform float pass3Layers;\nuniform float pass4Radius;\nuniform float pass4Layers;\n\n// TRIANGLE\nconst int dotsX3Layer1 = 6;\nconst int dotsX3Layer2 = 9;//12;\nconst int dotsX3Layer3 = 15;//18;\nconst int dotsX3Layer4 = 24;\nconst int dotsX3Total = (dotsX3Layer1 + dotsX3Layer2 + dotsX3Layer3 + dotsX3Layer4);\n\n// SQUARE\nconst int dotsX4Layer1 = 8;//4;\nconst int dotsX4Layer2 = 16;//8;\nconst int dotsX4Layer3 = 16;//12;\nconst int dotsX4Layer4 = 24;//16;\nconst int dotsX4Total = (dotsX4Layer1 + dotsX4Layer2 + dotsX4Layer3 + dotsX4Layer4);\n\n// PENTAGON\nconst int dotsX5Layer1 = 5;\nconst int dotsX5Layer2 = 10;\nconst int dotsX5Layer3 = 15;\nconst int dotsX5Layer4 = 25;//20;\nconst int dotsX5Total = (dotsX5Layer1 + dotsX5Layer2 + dotsX5Layer3 + dotsX5Layer4);\n\n// HEXAGON\nconst int dotsX6Layer1 = 6;\nconst int dotsX6Layer2 = 12;\nconst int dotsX6Layer3 = 18;\nconst int dotsX6Layer4 = 24;\nconst int dotsX6Total = (dotsX6Layer1 + dotsX6Layer2 + dotsX6Layer3 + dotsX6Layer4);\n\n// HEPTAGON\nconst int dotsX7Layer1 = 7;\nconst int dotsX7Layer2 = 14;\nconst int dotsX7Layer3 = 21;\nconst int dotsX7Layer4 = 21;//28;\nconst int dotsX7Total = (dotsX7Layer1 + dotsX7Layer2 + dotsX7Layer3 + dotsX7Layer4);\n\n// OCTAGON\nconst int dotsX8Layer1 = 8;\nconst int dotsX8Layer2 = 16;\nconst int dotsX8Layer3 = 24;\nconst int dotsX8Layer4 = 24;//32;\nconst int dotsX8Total = (dotsX8Layer1 + dotsX8Layer2 + dotsX8Layer3 + dotsX8Layer4);\n\n// NONAGON\nconst int dotsX9Layer1 = 9;\nconst int dotsX9Layer2 = 18;\nconst int dotsX9Layer3 = 27;\nconst int dotsX9Layer4 = 27;\nconst int dotsX9Total = (dotsX9Layer1 + dotsX9Layer2 + dotsX9Layer3 + dotsX9Layer4);\n\nvec2 bokehSampleCoord(vec2 pixelCoord, float dotIndex, float dotsNum, float dotRadius){\n\n    float dotsPerSide = (dotsNum / bladeCount);\n\n    float triangleIndex = floor(dotIndex / dotsPerSide);\n\n    float lensRotation = (((PIx2 / bladeCount) * aperture) + PId2);\n\n    float betaCornerA = ((PIx2 * (triangleIndex / bladeCount)) + lensRotation);\n    float betaCornerB = ((PIx2 * ((triangleIndex + 1.0) / bladeCount)) + lensRotation);\n\n    vec2 coordCornerA = vec2((pixelCoord.x + (cos(betaCornerA) * dotRadius)), (pixelCoord.y + (sin(betaCornerA) * dotRadius)));\n    vec2 coordCornerB = vec2((pixelCoord.x + (cos(betaCornerB) * dotRadius)), (pixelCoord.y + (sin(betaCornerB) * dotRadius)));\n\n    float dotBeta = (((dotIndex / dotsNum) * PIx2) + lensRotation);\n\n    vec2 polygonCoord = mix(coordCornerA, coordCornerB, (mod(dotIndex, dotsPerSide) / dotsPerSide));\n    vec2 circleCoord = vec2((pixelCoord.x + (cos(dotBeta) * dotRadius)), (pixelCoord.y + (sin(dotBeta) * dotRadius)));\n\n    vec2 sampleCoord = mix(polygonCoord, circleCoord, aperture);\n\n    return sampleCoord;\n\n}\n\nvec3 getDotData(int dotIndex, int dotsLayer1, int dotsLayer2, int dotsLayer3, int dotsLayer4, float radius){\n\n    vec3 dotData = vec3(0.0); // x = dotIndex on Layer, y = dots on Layer, z = dot radius from center (if circle)\n\n    if (dotIndex < dotsLayer1){ // LAYER 1\n        dotData.x = float(dotIndex);\n        dotData.y = float(dotsLayer1);\n        dotData.z = (radius * 1.0);\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2)){ // LAYER 2\n        dotData.x = float(dotIndex - dotsLayer1);\n        dotData.y = float(dotsLayer2);\n        dotData.z = (radius * 2.0);\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3)){ // LAYER 3\n        dotData.x = float(dotIndex - dotsLayer1 - dotsLayer2);\n        dotData.y = float(dotsLayer3);\n        dotData.z = (radius * 3.0);\n    }else if\n        (dotIndex < (dotsLayer1 + dotsLayer2 + dotsLayer3 + dotsLayer4)){ // LAYER 4\n        dotData.x = float(dotIndex - dotsLayer1 - dotsLayer2 - dotsLayer3);\n        dotData.y = float(dotsLayer4);\n        dotData.z = (radius * 4.0);\n    }\n\n    return dotData;\n\n}\n\nint getDotsTotal(float layersNum){\n\n    int dotsTotal = 0;\n\n    // TRIANGLE\n    if (bladeCount == 3.0){\n        dotsTotal = dotsX3Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX3Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX3Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX3Layer2;\n    }\n\n    // SQUARE\n    if (bladeCount == 4.0){\n        dotsTotal = dotsX4Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX4Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX4Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX4Layer2;\n    }\n\n    // PENTAGON\n    if (bladeCount == 5.0){\n        dotsTotal = dotsX5Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX5Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX5Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX5Layer2;\n    }\n\n    // HEXAGON\n    if (bladeCount == 6.0){\n        dotsTotal = dotsX6Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX6Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX6Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX6Layer2;\n    }\n\n    // HEPTAGON\n    if (bladeCount == 7.0){\n        dotsTotal = dotsX7Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX7Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX7Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX7Layer2;\n    }\n\n    // OCTAGON\n    if (bladeCount == 8.0){\n        dotsTotal = dotsX8Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX8Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX8Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX8Layer2;\n    }\n\n    // NONAGON\n    if (bladeCount == 9.0){\n        dotsTotal = dotsX9Total;\n        if (layersNum < 4.0) dotsTotal -= dotsX9Layer4;\n        if (layersNum < 3.0) dotsTotal -= dotsX9Layer3;\n        if (layersNum < 2.0) dotsTotal -= dotsX9Layer2;\n    }\n\n    return dotsTotal;\n\n}\n\nvec3 bokehSampleColor(vec2 pixelCoord, float layersNum, float maxRadius){\n\n    vec3 sampleColor = texture2D(uSampler, unmapCoord(pixelCoord, filterArea)).rgb;\n\n    //--\n\n    float triangleHeight = cos(PI / bladeCount) * maxRadius;\n\n    maxRadius -= (((maxRadius - triangleHeight) / 2.0) * aperture);\n\n    //--\n\n\tvec3 acc = vec3(0.0);\n\tvec3 div = vec3(0.0);\n\n\t//--\n\n    vec3 bokeh = pow(sampleColor, vec3(4.0));\n    acc += (sampleColor * bokeh);\n    div += bokeh;\n\n\t//--\n\n    float triangleSide = ((radius * maxRadius) / layersNum);\n\n    //--\n\n    const int maxSamples = dotsX9Total;\n\n    int sampledDots = 0;\n\n    vec3 dotData;\n\n    int dotsTotal = getDotsTotal(layersNum);\n\n    for (int i = 0; i < maxSamples; i++){\n\n        int takeSample = 0;\n\n        // TRIANGLE\n        if (bladeCount == 3.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX3Layer1, dotsX3Layer2, dotsX3Layer3, dotsX3Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // SQUARE\n        if (bladeCount == 4.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX4Layer1, dotsX4Layer2, dotsX4Layer3, dotsX4Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // PENTAGON\n        if (bladeCount == 5.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX5Layer1, dotsX5Layer2, dotsX5Layer3, dotsX5Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // HEXAGON\n        if (bladeCount == 6.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX6Layer1, dotsX6Layer2, dotsX6Layer3, dotsX6Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // HEPTAGON\n        if (bladeCount == 7.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX7Layer1, dotsX7Layer2, dotsX7Layer3, dotsX7Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // OCTAGON\n        if (bladeCount == 8.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX8Layer1, dotsX8Layer2, dotsX8Layer3, dotsX8Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        // NONAGON\n        if (bladeCount == 9.0 && sampledDots < dotsTotal){\n            dotData = getDotData(i, dotsX9Layer1, dotsX9Layer2, dotsX9Layer3, dotsX9Layer4, triangleSide);\n            takeSample = 1;\n            sampledDots++;\n        }\n\n        //--\n\n        if (takeSample == 1){\n            vec2 sampleCoord = bokehSampleCoord(pixelCoord, dotData.x, dotData.y, dotData.z);\n            if (sampleCoord.x >= 1.0 && sampleCoord.x < dimensions.x && sampleCoord.y >= 1.0 && sampleCoord.y < dimensions.y){\n                vec3 sampleColor = texture2D(uSampler, unmapCoord(sampleCoord, filterArea)).rgb;\n                vec3 bokeh = pow(sampleColor, vec3(4.0));\n                acc += (sampleColor * bokeh);\n                div += bokeh;\n            }\n        }\n\n    }\n\n    //--\n\n    return (acc / div);\n\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    //--\n\n    vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n    vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n    float radiusFactor = pow(((maskTextureInverted == 1) ? maskPixelColor.a : (1.0 - maskPixelColor.a)), 3.0);\n\n    //--\n\n    if (currentPass == 0.0){ // 1ST PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass1Layers, (pass1Radius * radiusFactor));\n    }else if\n        (currentPass == 1.0){ // 2ND PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass2Layers, (pass2Radius * radiusFactor));\n    }else if\n        (currentPass == 2.0){ // 3RD PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass3Layers, (pass3Radius * radiusFactor));\n    }else if\n        (currentPass == 3.0){ // 4TH PASS\n        pixelColor.rgb = bokehSampleColor(pixelCoord, pass4Layers, (pass4Radius * radiusFactor));\n    }\n\n    //--\n\n    gl_FragColor = pixelColor;\n\n}\n",dh=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";i(this,n);var a;if(!["","X3","X4","X5","X6","X7","X8","X9"].includes(r))throw new Error("Bokeh Blur Filter Variation Does Not Exist: "+r);switch(r){case"":e=t.call(this,hr,hh);break;case"X3":e=t.call(this,hr,ch);break;case"X4":e=t.call(this,hr,uh);break;case"X5":e=t.call(this,hr,lh);break;case"X6":e=t.call(this,hr,sh);break;case"X7":e=t.call(this,hr,oh);break;case"X8":e=t.call(this,hr,ah);break;case"X9":e=t.call(this,hr,rh)}return BFN.Stage.filterManager.shaderCache[e.glShaderKey]||(a=new PIXI.Shader(BFN.Stage.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[e.glShaderKey]=a),e.variation=r,e.padding=0,e.resolution=1,e.radius=1,e.aperture=0,e.bladeCount=6,e.dimensions=[0,0],m(e)}return a(n,[{key:"amount",get:function(){return this.uniforms.radius},set:function(e){this.uniforms.radius=Math.max(0,Math.min(1,e))}},{key:"aperture",get:function(){return this.uniforms.aperture},set:function(e){this.uniforms.aperture=Math.max(0,Math.min(1,e))}},{key:"bladeCount",get:function(){return""===this.variation?this.uniforms.bladeCount:parseInt(this.variation.replace("X",""))},set:function(e){""===this.variation&&(this.uniforms.bladeCount=Math.max(3,Math.min(9,Math.round(e))))}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}},{key:"maskTexture",get:function(){return this.uniforms.maskTexture},set:function(e){this.uniforms.maskTexture=e}},{key:"maskTextureInverted",get:function(){return!!this.uniforms.maskTextureInverted},set:function(e){this.uniforms.maskTextureInverted=e?1:0}},{key:"currentPass",get:function(){return this.uniforms.currentPass},set:function(e){this.uniforms.currentPass=Math.round(Math.max(0,Math.min(3,e)))}}]),n}(),mh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\nuniform float padding;\n\nuniform float spreadAmount;\nuniform int horizontal;\n\nconst float w0 = 0.22;\nconst float w1 = 0.18;\nconst float w2 = 0.13;\nconst float w3 = 0.08;\n\nvec2 clampPixelCoord(vec2 pixelCoord){\n    return clamp(pixelCoord, vec2(padding), (dimensions - vec2(padding)));\n}\n\nvoid main(void){\n\n    vec2 pixelCoord = clampPixelCoord(mapCoord(vTextureCoord, filterArea));\n\n    //--\n\n    vec4 colorCC = texture2D(uSampler, unmapCoord(pixelCoord, filterArea));\n    if (colorCC.a == 0.0){\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec4 maskColorCC = texture2D(maskTexture, (pixelCoord / dimensions));\n    if ((maskColorCC.a == 1.0 && (maskTextureInverted == 0)) || (maskColorCC.a == 0.0 && (maskTextureInverted == 1))){\n        gl_FragColor = colorCC;\n        return;\n    }\n\n    //--\n\n    float spread = (spreadAmount * ((maskTextureInverted == 1) ? maskColorCC.a : (1.0 - maskColorCC.a)));\n\n    //--\n\n    vec2 sampleCoordA1 = (pixelCoord - vec2(((horizontal == 1) ? (spread * (1.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (1.0 / 3.0)))));\n    vec2 sampleCoordA2 = (pixelCoord - vec2(((horizontal == 1) ? (spread * (2.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (2.0 / 3.0)))));\n    vec2 sampleCoordA3 = (pixelCoord - vec2(((horizontal == 1) ? (spread * (3.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (3.0 / 3.0)))));\n\n    vec2 sampleCoordB1 = (pixelCoord + vec2(((horizontal == 1) ? (spread * (1.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (1.0 / 3.0)))));\n    vec2 sampleCoordB2 = (pixelCoord + vec2(((horizontal == 1) ? (spread * (2.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (2.0 / 3.0)))));\n    vec2 sampleCoordB3 = (pixelCoord + vec2(((horizontal == 1) ? (spread * (3.0 / 3.0)) : 0.0), ((horizontal == 1) ? 0.0 : (spread * (3.0 / 3.0)))));\n\n    //--\n\n    vec4 maskColorA1 = texture2D(maskTexture, (sampleCoordA1 / dimensions));\n    vec4 maskColorA2 = texture2D(maskTexture, (sampleCoordA2 / dimensions));\n    vec4 maskColorA3 = texture2D(maskTexture, (sampleCoordA3 / dimensions));\n\n    vec4 maskColorB1 = texture2D(maskTexture, (sampleCoordB1 / dimensions));\n    vec4 maskColorB2 = texture2D(maskTexture, (sampleCoordB2 / dimensions));\n    vec4 maskColorB3 = texture2D(maskTexture, (sampleCoordB3 / dimensions));\n\n    //--\n\n    vec4 colorA1 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordA1), filterArea));\n    vec4 colorA2 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordA2), filterArea));\n    vec4 colorA3 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordA3), filterArea));\n\n    vec4 colorB1 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordB1), filterArea));\n    vec4 colorB2 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordB2), filterArea));\n    vec4 colorB3 = texture2D(uSampler, unmapCoord(clampPixelCoord(sampleCoordB3), filterArea));\n\n    //--\n\n    colorA1 = mix(colorA1, colorCC, ((maskTextureInverted == 1) ? (1.0 - maskColorA1.a) : maskColorA1.a));\n    colorA2 = mix(colorA2, colorA1, ((maskTextureInverted == 1) ? (1.0 - maskColorA2.a) : maskColorA2.a));\n    colorA3 = mix(colorA3, colorA2, ((maskTextureInverted == 1) ? (1.0 - maskColorA3.a) : maskColorA3.a));\n\n    colorB1 = mix(colorB1, colorCC, ((maskTextureInverted == 1) ? (1.0 - maskColorB1.a) : maskColorB1.a));\n    colorB2 = mix(colorB2, colorB1, ((maskTextureInverted == 1) ? (1.0 - maskColorB2.a) : maskColorB2.a));\n    colorB3 = mix(colorB3, colorB2, ((maskTextureInverted == 1) ? (1.0 - maskColorB3.a) : maskColorB3.a));\n\n    //--\n\n    colorCC *= w0;\n\n    colorA1 *= w1;\n    colorA2 *= w2;\n    colorA3 *= w3;\n\n    colorB1 *= w1;\n    colorB2 *= w2;\n    colorB3 *= w3;\n\n    //--\n\n    vec4 blurColor = (colorCC + colorA1 + colorA2 + colorA3 + colorB1 + colorB2 + colorB3);\n\n    //--\n\n    gl_FragColor = blurColor;\n\n}\n",ph=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e,r;return i(this,n),e=t.call(this,hr,mh),BFN.Stage.filterManager.shaderCache[e.glShaderKey]||(r=new PIXI.Shader(BFN.Stage.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[e.glShaderKey]=r),e.amount=1,e._maxSpread=1,e.plainFilter=new BFN.filters.PlainFilter,e}return a(n,[{key:"apply",value:function(e,t,n,i){this.resolution=this._amount>.5?.25:.5,this.padding=1/this.resolution,this.uniforms.padding=this.padding;var r=e.getRenderTarget(!0),a=e.getRenderTarget(!0);this.plainFilter.apply(e,t,r,!0);for(var o=0;o<6;o++){var s=1/Math.pow(2,Math.floor(o/2));this.uniforms.spreadAmount=this._amount*this._maxSpread*s,this.uniforms.horizontal=o%2?1:0,e.applyFilter(this,r,a,!0);var l=a;a=r,r=l}this.plainFilter.apply(e,r,n,!0),e.returnRenderTarget(r),e.returnRenderTarget(a)}},{key:"amount",get:function(){return this._amount},set:function(e){this._amount=Math.max(0,Math.min(1,e))}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e,this._maxSpread=Math.max(e[0],e[1])/32}},{key:"maskTexture",get:function(){return this.uniforms.maskTexture},set:function(e){this.uniforms.maskTexture=e}},{key:"maskTextureInverted",get:function(){return!!this.uniforms.maskTextureInverted},set:function(e){this.uniforms.maskTextureInverted=e?1:0}}]),n}(),gh="#define GLSLIFY 1\nvec2 mapCoord( vec2 coord, vec4 filterA )\n{\n    coord *= filterA.xy;\n    coord += filterA.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord, vec4 filterA )\n{\n    coord -= filterA.zw;\n    coord /= filterA.xy;\n\n    return coord;\n}\n\nvec3 gammaCorrection(vec3 color, float gamma) {\n\treturn pow(color, 1.0 / vec3(gamma));\n}\n\nvec3 levelsControlInputRange(vec3 color, float minInput, float maxInput) {\n\n  return min(max(color - minInput, 0.0) / (maxInput - minInput+0.0001), 1.0);\n\n}\n\nvec3 levelsControlInput(vec3 color, float minInput, float gamma, float maxInput) {\n\treturn gammaCorrection(levelsControlInputRange(color, minInput, maxInput), gamma);\n\n}\n\nvec3 levelsControlOutputRange(vec3 color, float minOutput, float maxOutput) {\n\treturn mix(vec3(minOutput), vec3(maxOutput), color);\n\n}\n\nvec3 levelsControl(vec3 color, float minInput, float gamma, float maxInput, float minOutput, float maxOutput) {\n\treturn levelsControlOutputRange(levelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput);\n}\n\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\n\nuniform float amount;\nuniform int large;\nuniform vec2 dimensions;\n\nuniform sampler2D maskTexture;\nuniform int maskTextureInverted;\n\nuniform sampler2D bgTexture;\n\nuniform int mode;\n\nuniform float threshold;\nuniform float intensity;\n\n//--\n\nvec3 lightenBlend (vec3 front, vec3 back, float opacity){\n    return max(front, back) * opacity + back * (1.0 - opacity);\n}\n\nvec3 screenBlend (vec3 src, vec3 dst){\n    return (src + dst) - (src * dst);\n}\n\n//--\n\nvec3 gentleBlur(vec3 pixelColor, vec2 pixelCoord){\n\n    vec2 minCoord = vec2(0.0);\n    vec2 maxCoord = dimensions;\n\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // L\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // R\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // T\n    pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // B\n\n    if (large == 1){\n\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // TL\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 2.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // T2\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y - 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // TR\n\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 2.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // L2\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 2.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 0.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // R2\n\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x - 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // BL\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 0.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 2.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // B2\n        pixelColor.rgb += texture2D(uSampler, unmapCoord(vec2(clamp((pixelCoord.x + 1.0), minCoord.x, maxCoord.x), clamp((pixelCoord.y + 1.0), minCoord.y, maxCoord.y)), filterArea)).rgb; // BR\n\n        pixelColor.rgb /= 13.0;\n\n    }else{\n\n        pixelColor.rgb /= 5.0;\n\n    }\n\n    return pixelColor.rgb;\n\n}\n\n//--\n\nvoid main(void){\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    vec2 pixelCoord = mapCoord(vTextureCoord, filterArea);\n\n    //--\n\n    pixelColor.rgb = gentleBlur(pixelColor.rgb, pixelCoord); // GENTLE BLUR\n\n    //--\n\n    if (mode == 1){ // FIRST BOKEH PASS\n\n        pixelColor.rgb = pow(pixelColor.rgb, vec3(threshold));\n\n        float gamma = (1.1 - (0.5 * intensity));\n        float maxInputValue = (1.0 - (0.18 * intensity));\n        pixelColor.rgb = levelsControl(pixelColor.rgb, 0.0, gamma, maxInputValue, 0.0, 1.0);\n\n        //--\n\n        vec2 maskPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0);\n        vec4 maskPixelColor = texture2D(maskTexture, maskPixelCoord);\n\n        maskPixelColor.a = (maskTextureInverted == 1) ? (1.0 - maskPixelColor.a) : maskPixelColor.a;\n\n        pixelColor.rgb = clamp((pixelColor.rgb - vec3(maskPixelColor.a)), vec3(0.0), vec3(1.0));\n\n    }else if\n        (mode == 2){ // LAST BOKEH PASS\n\n        vec3 contrastedPixelColor = (pixelColor.rgb * pixelColor.rgb * (1.0 + (amount * 0.8)));\n        // vec3 contrastedPixelColor = pow(pixelColor.rgb, vec3(threshold));// * 1.5;//1.8;\n\n        pixelColor.rgb = lightenBlend(contrastedPixelColor, pixelColor.rgb, amount);\n\n        //--\n\n        vec2 bgPixelCoord = clamp((pixelCoord / dimensions), 0.0, 1.0); // vTextureCoord;\n        vec4 bgPixelColor = texture2D(bgTexture, bgPixelCoord);\n\n        pixelColor.rgb = screenBlend(pixelColor.rgb, bgPixelColor.rgb);\n\n    }\n\n    //--\n\n\tgl_FragColor = pixelColor;\n\n}\n",fh=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e,r;return i(this,n),e=t.call(this,hr,gh),BFN.Stage.filterManager.shaderCache[e.glShaderKey]||(r=new PIXI.Shader(BFN.Stage.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[e.glShaderKey]=r),e.padding=0,e.large=!1,e.dimensions=[0,0],e.mode=0,e}return a(n,[{key:"large",get:function(){return!!this.uniforms.large},set:function(e){this.uniforms.large=e?1:0}},{key:"amount",get:function(){return this.uniforms.amount},set:function(e){this.uniforms.amount=Math.max(0,Math.min(1,e))}},{key:"dimensions",get:function(){return this.uniforms.dimensions},set:function(e){this.uniforms.dimensions=e}},{key:"mode",get:function(){return this.uniforms.mode},set:function(e){this.uniforms.mode=Math.max(0,Math.min(2,e))}},{key:"threshold",get:function(){return this.uniforms.threshold},set:function(e){this.uniforms.threshold=Math.max(1,e)}},{key:"intensity",get:function(){return this.uniforms.intensity},set:function(e){this.uniforms.intensity=Math.max(0,Math.min(1,e))}},{key:"maskTexture",get:function(){return this.uniforms.maskTexture},set:function(e){this.uniforms.maskTexture=e}},{key:"maskTextureInverted",get:function(){return!!this.uniforms.maskTextureInverted},set:function(e){this.uniforms.maskTextureInverted=e?1:0}},{key:"bgTexture",get:function(){return this.uniforms.bgTexture},set:function(e){this.uniforms.bgTexture=e}}]),n}(),vh="#define GLSLIFY 1\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform float tolerance;\n\nuniform vec2 onePixel;\nuniform vec2 dimensions;\n\nuniform sampler2D unionTexture;\n\nuniform vec3 selectionColor;\n\nvoid main(void){\n\n    vec4 unionColor = texture2D(unionTexture, clamp((vTextureCoord / dimensions), 0.0, 1.0));\n\n    if (unionColor.a < 1.0){\n\n        vec2 cTextureCoord = (dimensions * 0.5); // ADJUSTED CENTER COORDINATE\n        vec2 dTextureCoord = (vTextureCoord - cTextureCoord); // X & Y DISTANCE TO CENTER\n        float centerDistance = sqrt(pow(dTextureCoord.x, 2.0) + pow(dTextureCoord.y, 2.0)); // DIRECT DISTANCE TO CENTER\n\n        float outerRadius = min(cTextureCoord.x, cTextureCoord.y);\n\n        if (centerDistance < outerRadius){\n\n            vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n            vec4 centerColor = texture2D(uSampler, cTextureCoord);\n\n            float colorDistance = distance(pixelColor, centerColor);\n            colorDistance = step(tolerance, colorDistance);\n\n            // EDGE FEATHER FACTOR\n            float innerRadius = (outerRadius - (onePixel.x * 2.0));\n            float edgeFeatherFactor = smoothstep(outerRadius, innerRadius, centerDistance);\n\n            //--\n\n            float unionAlpha = max(unionColor.a, edgeFeatherFactor);\n            unionColor = mix(vec4((selectionColor * unionAlpha), unionAlpha), max(vec4(0.0), unionColor), colorDistance);\n\n        }\n\n    }\n\n\tgl_FragColor = unionColor;\n\n}\n",yh=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this,hr,vh)).padding=0,e.tolerance=.5,e.selectionColor=16711680,e}return a(n,[{key:"apply",value:function(e,t,n,i){this.uniforms.onePixel=[1/t.size.width,1/t.size.height],this.uniforms.dimensions=[t.sourceFrame.width/t.size.width,t.sourceFrame.height/t.size.height],e.applyFilter(this,t,n,!0)}},{key:"tolerance",get:function(){return this.uniforms.tolerance},set:function(e){this.uniforms.tolerance=Math.max(0,Math.min(1,e))}},{key:"selectionColor",get:function(){return this.uniforms.selectionColor},set:function(e){this.uniforms.selectionColor=BFN.FilterHelper.hex2rgbFactor(e)}},{key:"unionTexture",get:function(){return this.uniforms.unionTexture},set:function(e){this.uniforms.unionTexture=e}}]),n}(),xh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n\n   gl_FragColor = texture2D(uSampler, clamp(vTextureCoord,filterClamp.xy,filterClamp.zw));\n\n}\n",_h=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e,r;return i(this,n),e=t.call(this,hr,xh),BFN.Stage.filterManager.shaderCache[e.glShaderKey]||(r=new PIXI.Shader(BFN.Stage.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[e.glShaderKey]=r),e}return n}(),Ih="#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}\n",Th="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec2 onePixel;\nuniform float threshold;\nconst float radius = 11.0;\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void)\n{\n\n       float n = 0.0;\n       vec2 uv = vTextureCoord;\n       vec4 inputPixel =  texture2D(uSampler,vTextureCoord);\n\n       vec4 offset;\n       vec4 accum = vec4(0.0);\n\n      for (float x = -radius; x <= radius; x++)\n        {\n           for (float y = -radius; y <= radius; y++)\n               {\n                    offset = texture2D(uSampler, clamp(vTextureCoord + vec2(x ,y)*onePixel,vec2(0.0,0.0),vec2(clampX,clampY)));\n                    float multiplyDist = step(length(vec2(x,y)), radius);\n                    float multiplyCol = step(distance(offset, inputPixel), threshold);\n\n                    accum += offset * multiplyDist * multiplyCol;\n\n                   n += multiplyDist * multiplyCol;\n               }\n        }\n        gl_FragColor = vec4(accum / n);\n\n}\n",bh=function(e){u(n,PIXI.Filter);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,Ih,Th)).padding=0,r.threshold=e||.1,r}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=1/r.x,this.uniforms.clampY=1/r.y,this.uniforms.onePixel[0]=1/t.size.width,this.uniforms.onePixel[1]=1/t.size.height,e.applyFilter(this,t,n,i)}},{key:"threshold",get:function(){return this.uniforms.threshold},set:function(e){this.uniforms.threshold=e}}]),n}(),Sh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 filterClamp;\n\nvoid main(void){\n\n    vec4 color = texture2D(uSampler, clamp(vTextureCoord,filterClamp.xy,filterClamp.zw));\n\n    vec3 result = mix(vec3(1.0,1.0,1.0),vec3(1.0,0.0,1.0),1.0-color.a);\n\n    gl_FragColor = vec4(result,1.0);\n\n}\n",Ch=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e,r;return i(this,n),e=t.call(this,hr,Sh),BFN.Stage.filterManager.shaderCache[e.glShaderKey]||(r=new PIXI.Shader(BFN.Stage.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[BFN.Stage.CONTEXT_UID]=BFN.Stage.filterManager.shaderCache[e.glShaderKey]=r),e.padding=0,e}return n}(),Bh="#define GLSLIFY 1\n\nfloat getLumo_1(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\n vec3 clipColor(vec3 c) {\n     float l = getLumo_1(c);\n     float n = min(min(c.r, c.g), c.b);\n     float x = max(max(c.r, c.g), c.b);\n\n     if (n < 0.0) {\n          max((c-l)*l / (l-n) + l, 0.0);\n     }\n     if (x > 1.0) {\n          min((c-l) * (1.0-l) / (x-l) + l, 1.0);\n     }\n\n     return c;\n }\n\nfloat getLumo_2(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 setlum(vec3 c, float l) {\n     float d = l - getLumo_2(c);\n     c = c + vec3(d);\n     return clipColor(c);\n}\n\nfloat getLumo_0(vec3 c) {\n\n     return dot(c, vec3(0.299, 0.587, 0.114));\n}\n\nvec3 tint(vec3 inpImage, vec3 _color1) {\n\n    return setlum(_color1, getLumo_0(inpImage));\n\n}\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\n\nvoid main(void){\n\n    vec4 pixelColor = texture2D(uSampler, vTextureCoord);\n\n    if (pixelColor.r > 0.66 && pixelColor.g > 0.66 && pixelColor.b > 0.66){\n        // WHITE -> GREEN\n        pixelColor = vec4(0.0, 1.0, 0.0, .25);\n    }else if\n        (pixelColor.r < 0.33 && pixelColor.g < 0.33 && pixelColor.b < 0.33){\n        // BLACK -> RED\n        pixelColor = vec4(1.0, 0.0, 0.0, .5);\n    }else{\n        // GREY -> FUCHSIA\n        pixelColor = vec4(1.0, 0.0, 1.0, .25);\n    }\n\n    pixelColor.rgb *= pixelColor.a;\n\n    gl_FragColor = pixelColor;\n\n}\n",Fh=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=Bh;return(e=t.call(this,r,a)).padding=0,e}return n}(),Eh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D iChannel1;\n\nuniform float clampX;\nuniform float clampY;\n\nvoid main(void){\n\n    vec4 filtered = texture2D(uSampler, vTextureCoord);\n    vec4 original = texture2D(iChannel1, vTextureCoord * vec2(clampX,clampY));\n\n    gl_FragColor = (filtered * original.a);\n\n}\n",Ph=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=Eh;return(e=t.call(this,r,a)).padding=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){var r=BFN.FilterHelper.calculateFilterClamp(t,n);this.uniforms.clampX=r.x,this.uniforms.clampY=r.y,e.applyFilter(this,t,n,i)}},{key:"iChannel1",get:function(){return this.uniforms.iChannel1},set:function(e){this.uniforms.iChannel1=e}}]),n}(),kh="#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float thickness;\nuniform vec4 outlineColor;\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nvec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\n\nvoid main(void) {\n    const float PI = 3.14159265358979323846264;\n    vec4 ownColor = texture2D(uSampler, vTextureCoord);\n    vec4 curColor;\n    float maxAlpha = 0.;\n     vec2 displaced;\n    for (float angle = 0.; angle < PI * 2.; angle += %_THICKNESS_% ) {\n        displaced.x = vTextureCoord.x + thickness * px.x * cos(angle);\n        displaced.y = vTextureCoord.y + thickness * px.y * sin(angle);\n        curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\n        maxAlpha = max(maxAlpha, curColor.a);\n    }\n    float resultAlpha = max(maxAlpha, ownColor.a);\n    gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha);\n}\n",Nh=function(e){u(n,PIXI.Filter);var t=p(n);function n(e,r){var a;return i(this,n),e=e||1,(a=t.call(this,hr,kh.replace(/%_THICKNESS_%/gi,(1/e).toFixed(7)))).padding=4,a.uniforms.thickness=e,a.uniforms.outlineColor=new Float32Array([0,0,0,1]),r&&(a.color=r),a}return a(n,[{key:"color",get:function(){return PIXI.utils.rgb2hex(this.uniforms.outlineColor)},set:function(e){PIXI.utils.hex2rgb(e,this.uniforms.outlineColor)}}]),n}(),Mh="#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives:enable\n#endif\n\nprecision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 filterArea;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 dimensions;\nuniform vec2 spriteSize;\nuniform float useTexture;\nuniform float getCornerRadiusFromShortestSide;\n\nuniform float strokeWidth;\nuniform float cornerRadius;\nuniform vec4 strokeColor;\nuniform vec4 fillColor;\nuniform float quality;\nuniform float edgePaddingX;\nuniform float edgePaddingY;\n\nfloat RoundRectangle(vec2 distFromCenter, vec2 halfSize, float radius)\n{\n\t\tfloat len = length(max(abs(distFromCenter) - (halfSize - radius), vec2(0.0))) - radius;\n        float delta = 0.0;\n\t\t#ifdef GL_OES_standard_derivatives\n          delta = fwidth(len)*quality;\n        #else\n          delta = 0.5 * quality;\n        #endif\n\n    \tfloat result = 1.0;\n    \tif(radius==0.0) {\n    \t    result = step(min(halfSize.x,halfSize.y)/min(dimensions.x,dimensions.y),len);\n    \t} else {\n    \t    result = smoothstep(-delta,+delta,len);\n    \t}\n    \treturn result;\n\n}\n\nvoid main()\n{\n      //  vec2 exPixels  = 1.0+(expandPixels*2.0/dimensions);\n        vec2 pixelCoord = vTextureCoord  * filterArea.xy;\n\n        //minus edgePadding from coords for edge bleeding, give space for interpolation\n\n        pixelCoord -= vec2(edgePaddingX,edgePaddingY);\n\n        // rectangle 1 stroke\n        //minus edgePadding from size for edge bleeding, give space for interpolation\n        vec2 size = vec2(dimensions.x,dimensions.y)-vec2((edgePaddingX*2.0), (edgePaddingY*2.0));\n        vec2 halfSize = size / 2.0;\n        vec2 rectCenter = size/2.0;\n\n        float scaledCornerRadius = cornerRadius;\n        if (spriteSize.x > 0.0 && spriteSize.y > 0.0){\n            scaledCornerRadius = scaledCornerRadius * min((dimensions.x / spriteSize.x), (dimensions.y / spriteSize.y));\n        }\n\n        if (getCornerRadiusFromShortestSide == 1.0){\n            scaledCornerRadius = min(dimensions.x, dimensions.y) / 2.0;\n        }\n\n        float radius = max(min(min(size.x,size.y)/2.0,scaledCornerRadius),0.0);\n        float genStroke = RoundRectangle(pixelCoord - rectCenter, halfSize, radius);\n\n        // rectangle 2 fill\n        vec2 fillSize = vec2(size.x-strokeWidth*2.0,size.y-strokeWidth*2.0);\n        vec2 fillHalfSize = fillSize / 2.0;\n        vec2 fillRectCenter = vec2(size/2.0);\n        float fillRadius = max(radius-strokeWidth,0.0);\n        float genFill = RoundRectangle(pixelCoord - fillRectCenter, fillHalfSize, fillRadius);\n        vec4 _strokeColor = strokeColor;\n        if(strokeWidth == 0.0) {\n            _strokeColor = vec4(0.0);\n        }\n\n        //--\n\n        // PRE-MULTIPLY ALPHAS\n        vec4 _fillColor = fillColor;\n        _fillColor.rgb *= _fillColor.a;\n        _strokeColor.rgb *= _strokeColor.a;\n\n        //--\n\n        vec4 result =  mix(_strokeColor, vec4(0.0), genStroke);\n\n        if(useTexture == 0.0){\n            result =  mix(_fillColor, result, genFill);\n//            result.rgb *= result.a;\n        } else {\n            vec4 inputImage = texture2D(uSampler, vTextureCoord);\n            result =  mix(inputImage, result, genFill);\n        }\n\n    //    result = mix(vec4(1.0,0.0,0.0,1.0),result,1.0 - genStroke);\n\n        gl_FragColor = result;//texture2D(uSampler, vTextureCoord/exPixels);\n\n}\n",Dh=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=Mh;return(e=t.call(this,r,a)).padding=0,e.cornerRadius=1,e.strokeWidth=4,e.quality=.75,e.edgePadding=1,e.strokeColor=4278190080,e.fillColor=4294967295,e.spriteSize=[0,0],e.useTexture=0,e.getCornerRadiusFromShortestSide=0,e}return a(n,[{key:"apply",value:function(e,t,n,i){0!=this.cornerRadius?this.padding=0:this.padding=1,this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,n,i)}},{key:"useTexture",get:function(){return this.uniforms.useTexture},set:function(e){this.uniforms.useTexture=e}},{key:"spriteSize",get:function(){return this.uniforms.spriteSize},set:function(e){this.uniforms.spriteSize=e}},{key:"cornerRadius",get:function(){return this.uniforms.cornerRadius},set:function(e){this.uniforms.cornerRadius=e}},{key:"getCornerRadiusFromShortestSide",get:function(){return this.uniforms.getCornerRadiusFromShortestSide},set:function(e){this.uniforms.getCornerRadiusFromShortestSide=e}},{key:"strokeWidth",get:function(){return this.uniforms.strokeWidth},set:function(e){this.uniforms.strokeWidth=e}},{key:"quality",get:function(){return this.uniforms.quality},set:function(e){this.uniforms.quality=e}},{key:"edgePadding",get:function(){return this.uniforms.edgePaddingX},set:function(e){this.edgePaddingX=e,this.edgePaddingY=e}},{key:"edgePaddingX",get:function(){return this.uniforms.edgePaddingX},set:function(e){this.uniforms.edgePaddingX=e}},{key:"edgePaddingY",get:function(){return this.uniforms.edgePaddingY},set:function(e){this.uniforms.edgePaddingY=e}},{key:"strokeColor",get:function(){return this.uniforms.strokeColor},set:function(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.strokeColor=e}},{key:"fillColor",get:function(){return this.uniforms.fillColor},set:function(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.fillColor=e}}]),n}(),wh="#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives:enable\n#endif\n\nprecision mediump float;\n#define GLSLIFY 1\n\nuniform vec4 filterArea;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 dimensions;\nuniform float strokeWidth;\nuniform float quality;\nuniform vec4 fillColor;\nuniform vec4 strokeColor;\nuniform float edgePadding;\n\nfloat Circle(vec2 distFromCenter, vec2 halfSize, float radius)\n{\n    float len = length(abs(distFromCenter));\n    float delta = 0.0;\n    #ifdef GL_OES_standard_derivatives\n      delta = fwidth(len)*quality;\n    #else\n      delta = 0.5 * quality;\n    #endif\n    return smoothstep(radius-delta,radius+delta,len);\n\n}\n\nvoid main()\n{\n\n        vec2 pixelCoord = vTextureCoord  * filterArea.xy;\n\n        //minus edgePadding from coords for edge bleeding, give space for interpolation\n\n        pixelCoord -= vec2(edgePadding,edgePadding);\n\n        // rectangle 1 stroke\n        //minus edgePadding from size for edge bleeding, give space for interpolation\n        vec2 size = vec2(dimensions.x,dimensions.y)-vec2(edgePadding*2.0);\n\n        vec2 halfSize = size / 2.0;\n        vec2 rectCenter = size/2.0;\n\n        vec2 pos = pixelCoord-rectCenter;\n        vec2 posFill = pixelCoord-rectCenter;\n\n        //limit stroke width\n        float _strokeWidth = min(size.y/2.0-1.0,strokeWidth);\n\n        //adjust aspect ratio for stroke\n        pos.x *= size.y/size.x;\n\n        //adjust aspect ratio for fill\n        posFill.x *= (size.y-_strokeWidth*2.0)/(size.x-_strokeWidth*2.0);\n\n         //minus edgePadding from radius for edge bleeding, give space for interpolation\n        float radiusStroke = (size.y/2.0);\n\n        float radiusFill = max(radiusStroke-_strokeWidth,0.0);\n\n        //calculate distance for stroke\n        float lengthCenter = Circle(pos,halfSize,radiusStroke);\n\n        //calculate distance for fill\n        float lengthCenter2 = Circle(posFill,halfSize,radiusFill);\n\n        vec4 _strokeColor = strokeColor;\n\n        if(_strokeWidth == 0.0) {\n            _strokeColor = vec4(0.0);\n        }\n\n        //--\n\n        // PRE-MULTIPLY ALPHAS\n        vec4 _fillColor = fillColor;\n        _fillColor.rgb *= _fillColor.a;\n        _strokeColor.rgb *= _strokeColor.a;\n\n        //--\n\n        //fill the colors\n        vec4 result =  mix(_strokeColor, vec4(0.0), lengthCenter);\n        result =  mix(_fillColor, result, lengthCenter2);\n\n//        result = mix(vec4(1.0,0.0,0.0,1.0),result,1.0 - lengthCenter);\n\n        gl_FragColor = result;\n}\n",Lh=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=wh;return(e=t.call(this,r,a)).padding=0,e.strokeWidth=4,e.quality=.75,e.edgePadding=1,e.strokeColor=4278190080,e.fillColor=4294967295,e}return a(n,[{key:"apply",value:function(e,t,n,i){this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,n,i)}},{key:"strokeWidth",get:function(){return this.uniforms.strokeWidth},set:function(e){this.uniforms.strokeWidth=e}},{key:"quality",get:function(){return this.uniforms.quality},set:function(e){this.uniforms.quality=e}},{key:"edgePadding",get:function(){return this.uniforms.edgePadding},set:function(e){this.uniforms.edgePadding=e}},{key:"strokeColor",get:function(){return this.uniforms.strokeColor},set:function(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.strokeColor=e}},{key:"fillColor",get:function(){return this.uniforms.fillColor},set:function(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.fillColor=e}}]),n}(),Oh="#define GLSLIFY 1\nuniform vec4 filterArea;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 dimensions;\n\nuniform float dashSize;\nuniform float direction;\nuniform vec4 fillColor;\nuniform vec4 alternateColor;\n\nfloat lines(float coord, float size) {\n\tfloat result = fract((coord)*size);\n\treturn step(0.5,result);\n}\n\nvoid main()\n{\n         vec2 coord = vTextureCoord*(filterArea.xy/dimensions);\n\n         float lineDirection;\n\n         if(direction==-1.0) {\n             lineDirection = dimensions.x>dimensions.y ? 0.0 : 1.0;\n         }\n         else {\n            lineDirection = direction;\n         }\n\n         float dir;\n         float lineSize;\n\n         if(lineDirection==0.0) {\n            dir = coord.x;\n            lineSize = dimensions.x/dashSize;\n\n         } else {\n            dir = coord.y;\n            lineSize = dimensions.y/dashSize;\n         }\n\n \t     float genLines = lines(dir,lineSize);\n\n \t     vec4 color1 = fillColor;\n \t     vec4 color2 = alternateColor;\n\n         gl_FragColor = mix(color1,color2,genLines);\n\n}\n",Rh=function(e){u(n,PIXI.Filter);var t=p(n);function n(){var e;i(this,n);var r=hr,a=Oh;return(e=t.call(this,r,a)).padding=0,e.dashSize=12,e.fillColor=2516582400,e.alternateColor=2164260863,e.direction=-1,e}return a(n,[{key:"apply",value:function(e,t,n,i){this.uniforms.dimensions[0]=t.sourceFrame.width,this.uniforms.dimensions[1]=t.sourceFrame.height,e.applyFilter(this,t,n,i)}},{key:"direction",get:function(){return this.uniforms.direction},set:function(e){this.uniforms.direction=e}},{key:"dashSize",get:function(){return this.uniforms.dashSize},set:function(e){this.uniforms.dashSize=e}},{key:"fillColor",get:function(){return this.uniforms.fillColor},set:function(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.fillColor=e}},{key:"alternateColor",get:function(){return this.uniforms.alternateColor},set:function(e){e=BFN.FilterHelper.hex32torgba(e),this.uniforms.alternateColor=e}}]),n}();Object.assign(BFN.filters,{RoundedRectFilter:Dh,EllipseFilter:Lh,DashedLineFilter:Rh}),Object.assign(BFN.filters,{NoneFilters:mr,ColorFilter:gr,ExposureFilter:vr,LensTintFilter:xr,HSFilter:Ir,FillLightFilter:Sr,GaussianBlurFilter:kr,GrayFilter:Dr,InvertFilter:Or,LevelsFilter:Ar,LutFilter:Gr,SurfaceBlurFilter:Qr,UnsharpMaskFilter:$r,AdaptiveSharpnessFilter:na,VibranceFilter:aa,RgbToLabFilter:Kr,ClarityFilter:la,VignetteFilter:ca,BrushFilter:ma,PixelateFilter:fa,AlphaBlendFilter:ya,HalftoneFilter:_a,BlendModeFilter:Wa,BlackWhiteFilter:eo,CurvesFilter:no,ChannelMixerFilter:ro,CyanotypeFilter:ho,MaskVignetteFilter:po,CharcoalFilter:fo,SepiaFilter:yo,UnitedColorsFilter:_o,InstantFilter:ko,TintFilter:Mo,TinyTypeFilter:wo,BrightnessContrastFilter:Oo,VintageColorsFilter:zo,HolgaArtFilter:Ko,LineArtopiaFilter:es,HDRFilter:ns,MotionBlurFilter:rs,SigmoidFilter:os,ShiftChannelFilter:ls,FisheyeFilter:cs,NoiseFilter:ds,StencilerFilter:bs,GrungeFilter:Rs,SunburstFilter:js,AdaptiveContrastLegFilter:Ws,OldPhotoFilter:cl,DuoToneFilter:dl,WinterFilter:gl,TiltShiftFilter:yl,PatrioticFilter:Bl,PopArtFilter:Xl,OffsetFilter:Yl,TintDuoFilter:Kl,BeautifyFilter:Zl,FastBlurFilter:iu,FastBlurWrapper:ru,OrtonStyleFilter:ou,MotionColorFilter:du,PinholeFilter:yu,LomoArtFilter:Cu,CrossProcessFilter:Fu,SkinCandidateFilter:Pu,TouchUpFilter:zu,UnPremultiplyFilter:Xu,ColorMixerFilter:Yu,SoftenFilter:Ku,SmoothingFilter:Zu,BlurEdgesFilter:$u,AutoEnhanceFilter:tc,ColorOverlayFilter:ic,ColorOffsetFilter:ac,ColorReplaceFilter:sc,LiquifyBrushFilter:uc,DisplacementFilter:hc,ReplaceFilter:mc,AlphaMaskFilter:gc,MaskBlendFilter:vc,OuterGlowFilter:xc,GlowPrepFilter:Ic,GlowPostFilter:bc,GrainFilter:Cc,ScanLinesFilter:Fc,SweepFilter:Pc,InvertChannelFilter:Nc,DirectionalBlurFilter:Dc,GlitchCorruptedFilter:Lc,GlitchDistortedFilter:Rc,GlitchSegmentedFilter:Vc,GlitchFragmentedFilter:Gc,GlitchDigitizedFilter:zc,TelevisionFilter:Xc,ChromaticAberrationFilter:Yc,AnamorphicFilter:Kc,LensDistortionFilter:Zc,HalftoneDuoFilter:$c,ColorGradingFilter:th,WarpedBlurFilter:ih,BokehBlurFilter:dh,BokehBGBlurFilter:ph,BokehGentleBlurFilter:fh,MagicBrushFilter:yh,PlainFilter:_h,OutlineFilter:Nh,BilateralBlurFilter:bh,BackgroundFillFilter:Ch,TriMapColorFilter:Fh,TransparentBackgroundFixFilter:Ph});var Ah=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.clarityFilter=new BFN.filters.ClarityFilter,this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.4,this.sourceTexture),this.clarityFilter.blurImage=this.blurTexture}},{key:"applyEffect",value:function(e,t){this.clarityFilter.intensity=t.clarity_amount,this.clarityFilter.resolution=1,this.filters=[this.clarityFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}}]),n}();BFN.effects.ClarityEffect=new Ah;var Vh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.colorFilter=BFN.ShaderPool.ColorFilter,this.pluginName="filter_renderer"}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.colorFilter.hue=t.hue,this.colorFilter.saturation=t.saturation,this.colorFilter.temperature=t.temperature,this.bfn_shaders=[this.colorFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.ColorEffect=new Vh;var Uh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.pluginName="filter_renderer",this.replaceColorFilter=BFN.ShaderPool.ColorReplaceFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.replaceColorFilter.sourceColor=t.source_color,this.replaceColorFilter.tolerance=t.tolerance/100,this.replaceColorFilter.preserveLuminosity=t.preserve_luminosity?1:0,-1==t.target_color?(this.replaceColorFilter.targetColor="FFFFFF",this.replaceColorFilter.targetAlpha=0,this.outputTransparent=!0):(this.replaceColorFilter.targetColor=t.target_color,this.replaceColorFilter.targetAlpha=t.target_color_intensity,this.outputTransparent=!1),this.bfn_shaders=[this.replaceColorFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.ReplaceColorEffect=new Uh;var Gh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.ANALOG_PRESETS)this.__filters[BFN.CONST.ANALOG_PRESETS[e]]=new BFN.filters.LutFilter;for(var t in BFN.CONST.BWFX_PRESETS)this.__filters[BFN.CONST.BWFX_PRESETS[t]]=new BFN.filters.LutFilter;for(var n in BFN.CONST.WARMFX_PRESETS)this.__filters[BFN.CONST.WARMFX_PRESETS[n]]=new BFN.filters.LutFilter;this.exposureFilter=new BFN.filters.HSFilter,this.isBlurSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];t.hasOwnProperty("imageURL")&&(this.effectTexture||(this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,512,512))),i.iChannel1=this.effectTexture,i.intensity=1,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,i]):this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBlur",value:function(){this.blurTexture=this.blurFilter.render(.8,this.sourceTexture),this.isBlurSetup=!0}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.isBlurSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}}]),n}();BFN.effects.AnalogEffect=new Gh;var Hh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.exposureFilter=BFN.ShaderPool.ExposureFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.pluginName="filter_renderer"}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.05,this.sourceTexture),this.exposureFilter.blurImage=this.blurTexture}},{key:"applyEffect",value:function(e,t){this.exposureFilter.brightness=t.brightness,this.exposureFilter.contrast=t.contrast,this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.bfn_shaders=[this.exposureFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter.dispose(),this.blurTexture=null,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.ExposureEffect=new Hh;var zh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.fillLightFilter=BFN.ShaderPool.FillLightFilter,this.pluginName="filter_renderer",this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.4,this.sourceTexture),this.fillLightFilter.blurImage=this.blurTexture}},{key:"applyEffect",value:function(e,t){this.fillLightFilter.intensity=t.light_amount,this.bfn_shaders=[this.fillLightFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}}]),n}();BFN.effects.FillLightEffect=new zh;var jh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.gaussianBlurFilter=new BFN.filters.FastBlurWrapper}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){t.blur_amount;BeFunky.log(t.blur_amount);var n=[];n=n.concat(this.gaussianBlurFilter.apply(t.blur_amount)),this.filters=n}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.GaussianBlurEffect=new jh;var Xh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.grayFilter=new BFN.filters.GrayFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.grayFilter.resolution=1,this.grayFilter.amount=t.gray_amount,this.filters=[this.grayFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.GrayEffect=new Xh;var Wh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.invertFilter=new BFN.filters.InvertFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.invertFilter.resolution=e,this.invertFilter.amount=t.invert_amount,this.filters=[this.invertFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.InvertEffect=new Wh;var Yh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.levelsFilter=new BFN.filters.LevelsFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.levelsFilter.minInputValue=t.min_input,this.levelsFilter.gamma=t.gamma,this.levelsFilter.maxInputValue=t.max_input,this.levelsFilter.minOutputValue=t.min_output,this.levelsFilter.maxOutputValue=t.max_output,this.filters=[this.levelsFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.LevelsEffect=new Yh;var qh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilterNormal=new BFN.filters.FastBlurWrapper(null,null,!1),this.blurFilterSmart=new BFN.filters.FastBlurWrapper(null,null,!0),this.unsharpMaskFilter=new BFN.filters.UnsharpMaskFilter,this.sharpenMode=null,this.blurTextureSmart=null,this.blurTextureNormal=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.sharpenMode=null,this.blurTextureSmart=null,this.blurTextureNormal=null}},{key:"applyEffect",value:function(e,t){if(this.sharpenMode!=t.mode)switch(this.sharpenMode=t.mode,this.sharpenMode){case"smart":this.blurTextureSmart||(this.blurTextureSmart=this.blurFilterSmart.render(.3,this.sourceTexture,null,!0)),this.unsharpMaskFilter.intensityMultiplier=1.5,this.unsharpMaskFilter.blurImage=this.blurTextureSmart;break;case"normal":this.blurTextureNormal||(this.blurTextureNormal=this.blurFilterNormal.render(.025,this.sourceTexture,null,!0)),this.unsharpMaskFilter.intensityMultiplier=5,this.unsharpMaskFilter.blurImage=this.blurTextureNormal}this.unsharpMaskFilter.intensity=t.unsharp_amount,this.unsharpMaskFilter.resolution=1,this.filters=[this.unsharpMaskFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.sharpenMode=null,this.blurTextureSmart&&(this.blurTextureSmart=null),this.blurFilterSmart.dispose(),this.blurTextureNormal&&(this.blurTextureNormal=null),this.blurFilterNormal.dispose()}}]),n}();BFN.effects.UnsharpMaskEffect=new qh;var Kh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.vibranceFilter=BFN.ShaderPool.VibranceFilter,this.pluginName="filter_renderer"}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.vibranceFilter.resolution=1,this.vibranceFilter.amount=t.vibrance_amount,this.bfn_shaders=[this.vibranceFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.VibranceEffect=new Kh;var Qh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.vignetteFilter=new BFN.filters.VignetteFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.vignetteFilter.resolution=1,this.vignetteFilter.amount=t.vignette_amount,this.vignetteFilter.softness=t.vignette_softness,this.filters=[this.vignetteFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.VignetteEffect=new Qh;var Zh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.uiControls.push({id:"dotsize",name:"Dot Size",type:"slider",min:3,max:50,step:1,default:10}),this.halftoneFilter=new BFN.filters.HalftoneFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.halftoneFilter.circleSize=t.dotsize,this.filters=[this.halftoneFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.HalftoneEffect=new Zh;var Jh=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.currentPresetID=null,this.bw9Setup=!1,this.bwFilters={},BFN.CONST.BLACK_WHITE_PRESETS)BFN.CONST.BLACK_WHITE_PRESETS[e]==BFN.CONST.BLACK_WHITE_PRESETS.PRESET_9?this.bwFilters[BFN.CONST.BLACK_WHITE_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY):this.bwFilters[BFN.CONST.BLACK_WHITE_PRESETS[e]]=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS[e]);this.exposureFilter=new BFN.filters.HSFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.bwFilters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.bwFilters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);if(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("modeBW")&&t.hasOwnProperty("modeColor")&&(i.mode=t.modeBW,i.color=t.modeColor),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")){if(0!=t.highlights||0!=t.shadows)return this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,void(this.filters=[this.exposureFilter,i])}else this.currentPresetID==BFN.CONST.BLACK_WHITE_PRESETS.PRESET_9&&(this.bw9Setup||(this.setupBw9(),i.iChannel1=this.effectTexture));this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBw9",value:function(){var e=new BFN.filters.ChannelMixerFilter,t=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),n=new PIXI.Sprite;n.texture=this.sourceTexture,e.redAmount=.5,e.greenAmount=.25,e.blueAmount=.25,n.filters=[e],BFN.Stage.render(n,t);var i=new BFN.filters.CurvesFilter([[0,28],[23,48],[68,105],[96,146],[118,180],[145,205],[177,214],[212,225],[255,242]],[[0,29],[21,46],[54,85],[89,137],[107,162],[120,180],[133,189],[197,212],[252,230]],[[0,31],[41,70],[113,168],[148,197],[186,207],[255,229]]),r=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),a=new PIXI.Sprite;a.texture=t,a.filters=[i],BFN.Stage.render(a,r),this.texture=r,this.bw9Setup=!0}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),this.bw9Setup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.BlackWhiteEffect=new Jh;var $h=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.curvesSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.CHROMATIC_PRESETS)switch(BFN.CONST.CHROMATIC_PRESETS[e]){case BFN.CONST.CHROMATIC_PRESETS.PRESET_1:case BFN.CONST.CHROMATIC_PRESETS.PRESET_2:case BFN.CONST.CHROMATIC_PRESETS.PRESET_4:case BFN.CONST.CHROMATIC_PRESETS.PRESET_5:case BFN.CONST.CHROMATIC_PRESETS.PRESET_6:case BFN.CONST.CHROMATIC_PRESETS.PRESET_9:case BFN.CONST.CHROMATIC_PRESETS.PRESET_10:this.__filters[BFN.CONST.CHROMATIC_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_3:case BFN.CONST.CHROMATIC_PRESETS.PRESET_8:this.__filters[BFN.CONST.CHROMATIC_PRESETS[e]]=new BFN.filters.CurvesFilter;break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_7:this.__filters[BFN.CONST.CHROMATIC_PRESETS[e]]=new BFN.filters.MaskVignetteFilter}}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.CHROMATIC_PRESETS.PRESET_1:case BFN.CONST.CHROMATIC_PRESETS.PRESET_6:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol1),i.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_2:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol2),i.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_3:i.doFilter(BFN.CONST.PALETTE_MAPS.retroCol3[0],BFN.CONST.PALETTE_MAPS.retroCol3[1],BFN.CONST.PALETTE_MAPS.retroCol3[2]);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_4:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol4),i.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_5:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol5),i.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_7:this.curvesSetup||(i.iChannel1=this.PRESET_7());break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_8:i.doFilter(BFN.CONST.PALETTE_MAPS.retroCol7[0],BFN.CONST.PALETTE_MAPS.retroCol7[1],BFN.CONST.PALETTE_MAPS.retroCol7[2]);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_9:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.MegaContrast1,BFN.CONST.PALETTE_MAPS.MegaContrast2),i.iChannel1=this.effectTexture);break;case BFN.CONST.CHROMATIC_PRESETS.PRESET_10:this.curvesSetup||(this.setupCurves(BFN.CONST.PALETTE_MAPS.retroCol8),i.iChannel1=this.effectTexture)}this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupCurves",value:function(e,t){this.curvesSetup=!0;var n=3==e.length?new BFN.filters.CurvesFilter(e[0],e[1],e[2]):2==e.length?new BFN.filters.CurvesFilter(e[0],e[1]):new BFN.filters.CurvesFilter(e);this.curvesTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);var i=new PIXI.Sprite;i.texture=this.sourceTexture,i.filters=[n],BFN.Stage.render(i,this.curvesTexture);try{n.dispose()}catch(e){}if(i=null,n=null,null!=t){var r=3==t.length?new BFN.filters.CurvesFilter(t[0],t[1],t[2]):2==t.length?new BFN.filters.CurvesFilter(t[0],t[1]):new BFN.filters.CurvesFilter(t);this.curvesTexture2=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);var a=new PIXI.Sprite;a.texture=this.curvesTexture,a.filters=[r],BFN.Stage.render(a,this.curvesTexture2);try{r.dispose()}catch(e){}try{a.texture.destroyGC(!0)}catch(e){}return a=null,r=null,void(this.texture=this.curvesTexture2)}this.texture=this.curvesTexture}},{key:"PRESET_7",value:function(){var e=new BFN.filters.CurvesFilter(BFN.CONST.PALETTE_MAPS.retroCol6[0],BFN.CONST.PALETTE_MAPS.retroCol6[1],BFN.CONST.PALETTE_MAPS.retroCol6[2]),t=new PIXI.Sprite;t.texture=this.sourceTexture,t.filters=[e],this.curvesTextureBottomP7=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(t,this.curvesTextureBottomP7);try{e.dispose()}catch(e){}t=null,e=null,this.texture=this.curvesTextureBottomP7;var n=new BFN.filters.CurvesFilter(BFN.CONST.PALETTE_MAPS.retro6mask[0],BFN.CONST.PALETTE_MAPS.retro6mask[1],BFN.CONST.PALETTE_MAPS.retro6mask[2]),i=new PIXI.Sprite;i.texture=this.sourceTexture,i.filters=[n],this.curvesTextureTopP7=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(i,this.curvesTextureTopP7);try{n.dispose()}catch(e){}return i=null,n=null,this.curvesSetup=!0,this.curvesTextureTopP7}},{key:"disposeEffect",value:function(){try{this.__filters[this.currentPresetID].dispose()}catch(e){}if(this.sourceTexture=null,this.isSetup=!1,this.curvesSetup=!1,this.currentPresetID=null,null!=this.curvesTextureTopP7&&(this.curvesTextureTopP7.destroyGC(!0),this.curvesTextureTopP7=null),null!=this.curvesTextureBottomP7&&(this.curvesTextureBottomP7.destroyGC(!0),this.curvesTextureBottomP7=null),null!=this.curvesTexture){try{this.curvesTexture.destroyGC(!0)}catch(e){}this.curvesTexture=null}if(null!=this.curvesTexture2){try{this.curvesTexture2.destroyGC(!0)}catch(e){}this.curvesTexture2=null}null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.ChromaticEffect=new $h;var ed=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.CHARCOAL_PRESETS)this.__filters[BFN.CONST.CHARCOAL_PRESETS[e]]=new BFN.filters.CharcoalFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.blurSetup||this.setupBlur(),i.blurImage=this.blurTexture,i.textureSampler=this.effectTexture,i.color1=t.color_value_1,i.color2=t.color_value_2,i.detail_level=t.detail_level,this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBlur",value:function(){this.blurSetup=!0,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.CharcoalEffect=new ed;var td=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.CYANOTYPE_PRESETS)this.__filters[BFN.CONST.CYANOTYPE_PRESETS[e]]=new BFN.filters.CyanotypeFilter(BFN.CONST.CYANOTYPE_PRESETS[e]);this.exposureFilter=new BFN.filters.HSFilter,this.isBlurSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(this.currentPresetID==BFN.CONST.CYANOTYPE_PRESETS.PRESET_6&&(this.isBlurSetup||this.setupBlur(),i.blurImage=this.blurTexture),i.iChannel1=this.effectTexture,0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,i]):this.filters=[i])}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBlur",value:function(){this.blurTexture=this.blurFilter.render(.8,this.sourceTexture),this.isBlurSetup=!0}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.isBlurSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.CyanotypeEffect=new td;var nd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurAmount=null,this._filter=new BFN.filters.OrtonStyleFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("blur_amount")&&(this.blurAmount!=t.blur_amount&&(this.blurTexture=this.blurFilter.render(t.blur_amount,this.sourceTexture)),this._filter.blurSampler=this.blurTexture,this.filters=[this._filter])}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),this.blurAmount=null}}]),n}();BFN.effects.OrtonStyleEffect=new nd;var id=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.exposureFilter=new BFN.filters.HSFilter,this._filter=new BFN.filters.SepiaFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){if(this.resolution=e,this.parameters=t,this.texture,this.sourceTexture,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")){if(this._filter.amount=.85,this._filter.color="0xac7933",0!=t.highlights||0!=t.shadows)return this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,void(this.filters=[this.exposureFilter,this._filter]);this.filters=[this._filter]}}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,null!=this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurTexture=null)}}]),n}();BFN.effects.SepiaEffect=new id;var rd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.VIEWFINDER_PRESETS)switch(BFN.CONST.VIEWFINDER_PRESETS[e]){case BFN.CONST.VIEWFINDER_PRESETS.PRESET_1:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_11:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.HARD_LIGHT);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_2:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_3:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_4:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_6:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_8:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_10:case BFN.CONST.VIEWFINDER_PRESETS.PRESET_12:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_5:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.LIGHTEN);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_7:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY);break;case BFN.CONST.VIEWFINDER_PRESETS.PRESET_9:this.__filters[BFN.CONST.VIEWFINDER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.DARKEN)}this.exposureFilter=new BFN.filters.HSFilter,this.isBlurSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(i.iChannel1=this.effectTexture,this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_1||this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_2||this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_8?(this.isBlurSetup||this.setupBlur(),this.texture=this.blurTexture):this.currentPresetID==BFN.CONST.VIEWFINDER_PRESETS.PRESET_5&&(i.intensity=.5),0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,i]):this.filters=[i])}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBlur",value:function(){var e=1;Math.max(this.sourceTexture.width,this.sourceTexture.height)<512&&(e=Math.max(this.sourceTexture.width,this.sourceTexture.height)/1024),this.blurTexture=this.blurFilter.render(.06*e,this.sourceTexture),this.isBlurSetup=!0}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),this.isBlurSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.destroy(),this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader=null)}}]),n}();BFN.effects.ViewFinderEffect=new rd;var ad=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.__filters={},BFN.CONST.SUMMER_PRESETS)switch(BFN.CONST.SUMMER_PRESETS[e]){case BFN.CONST.SUMMER_PRESETS.PRESET_1:this.__filters[BFN.CONST.SUMMER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY);break;case BFN.CONST.SUMMER_PRESETS.PRESET_2:this.__filters[BFN.CONST.SUMMER_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.SCREEN)}this.exposureFilter=new BFN.filters.HSFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(i.iChannel1=this.effectTexture,0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,i]):this.filters=[i])}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.SummerEffect=new ad;var od=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.UNITED_COLORS_PRESETS)this.__filters[BFN.CONST.UNITED_COLORS_PRESETS[e]]=new BFN.filters.UnitedColorsFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var n=this.__filters[this.currentPresetID];switch(this.blurSetup||this.setupBlur(),this.currentPresetID){case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_1:n.bwmode=0;break;case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_2:case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_4:n.bwmode=3;break;case BFN.CONST.UNITED_COLORS_PRESETS.PRESET_3:n.bwmode=2}n.blurImage=this.blurTexture,n.color1=t.color_value_1,n.color2=t.color_value_2,this.filters=[n]}}},{key:"setupBlur",value:function(){this.blurSetup=!0,this.idealBlur=Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}}]),n}();BFN.effects.UnitedColorsEffect=new od;var sd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.currentPaletteID=null,this.effectTexture=null,this.__filters={},BFN.CONST.INSTANT_PRESETS)switch(BFN.CONST.INSTANT_PRESETS[e]){case BFN.CONST.INSTANT_PRESETS.PRESET_1:case BFN.CONST.INSTANT_PRESETS.PRESET_2:case BFN.CONST.INSTANT_PRESETS.PRESET_3:case BFN.CONST.INSTANT_PRESETS.PRESET_4:case BFN.CONST.INSTANT_PRESETS.PRESET_5:case BFN.CONST.INSTANT_PRESETS.PRESET_6:case BFN.CONST.INSTANT_PRESETS.PRESET_10:case BFN.CONST.INSTANT_PRESETS.PRESET_11:case BFN.CONST.INSTANT_PRESETS.PRESET_13:this.__filters[BFN.CONST.INSTANT_PRESETS[e]]=new BFN.filters.InstantFilter(BFN.CONST.INSTANT_PRESETS[e])}this.exposureFilter=new BFN.filters.HSFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){if(this.currentPresetID=t.presetID,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null);var i=this.__filters[this.currentPresetID],r=!1;switch(t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)&&(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,r=!0),this.currentPresetID){case BFN.CONST.INSTANT_PRESETS.PRESET_1:case BFN.CONST.INSTANT_PRESETS.PRESET_2:case BFN.CONST.INSTANT_PRESETS.PRESET_3:case BFN.CONST.INSTANT_PRESETS.PRESET_4:break;case BFN.CONST.INSTANT_PRESETS.PRESET_5:case BFN.CONST.INSTANT_PRESETS.PRESET_6:case BFN.CONST.INSTANT_PRESETS.PRESET_10:case BFN.CONST.INSTANT_PRESETS.PRESET_11:case BFN.CONST.INSTANT_PRESETS.PRESET_13:i.iChannel1=this.effectTexture}this.filters=1==r?[this.exposureFilter,i]:[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.currentPaletteID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.InstantEffect=new sd;var ld=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filter=new BFN.filters.TintFilter,this.exposureFilter=new BFN.filters.HSFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.__filter.color=t.color,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,this.__filter]):this.filters=[this.__filter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.CoolingEffect=new ld;var ud=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filter=new BFN.filters.TintFilter,this.exposureFilter=new BFN.filters.HSFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.__filter.color=t.color,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows)?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,this.__filter]):this.filters=[this.__filter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.WarmingEffect=new ud;var cd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filter=new BFN.filters.TinyTypeFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){this.resolution=e,this.parameters=t,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading?this.filters=[]:(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.__filter.iChannel1=this.effectTexture,t.hasOwnProperty("modeBW")&&t.hasOwnProperty("modeColor")&&(this.__filter.mode=t.modeBW,this.__filter.color=t.modeColor),this.filters=[this.__filter])}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.TinyTypeEffect=new cd;var hd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.curvesTexture=null,this.isSetupCurves=!1,this.exposureFilter=new BFN.filters.HSFilter,this._filter=new BFN.filters.CrossProcessFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.resolution=e,this.parameters=t,this.texture,this.sourceTexture,t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(this.isSetupCurves||this.setupCurves(BFN.CONST.PALETTE_MAPS[t.curves],t),this._filter.intensity=.2,this._filter.contrast=t.contrast,this._filter.color=t.color,this._filter.curvesSampler=this.curvesTexture,0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,this._filter]):this.filters=[this._filter])}},{key:"setupCurves",value:function(e,t){var n=3==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1],e[2]):2==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1]):BFN.FilterHelper.GetCurvesTexture(e);this.curvesTexture||(this.curvesTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height));var i=new PIXI.Sprite;i.texture=n,BFN.Stage.render(i,this.curvesTexture),n.destroyGC(!0),n=null;try{i.texture.destroyGC(!0)}catch(e){}i=null,this.isSetupCurves=!0}},{key:"cleanValue",value:function(e,t){return Math.min(t,Math.max(-t,e))}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.isSetupCurves=!1,null!=this.curvesTexture&&(this.curvesTexture.destroyGC(!0),this.curvesTexture=null)}}]),n}();BFN.effects.CrossProcessEffect=new hd;var dd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.exposureFilter=new BFN.filters.HSFilter,this.blurFilter=new BFN.filters.SurfaceBlurFilter,this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.blurTexture=null,this.blurTextureHolder=new PIXI.Sprite,this.blurSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.VINTAGE_COLORS_PRESETS)switch(BFN.CONST.VINTAGE_COLORS_PRESETS[e]){case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9:this.__filters[BFN.CONST.VINTAGE_COLORS_PRESETS[e]]=new BFN.filters.LutFilter;break;default:this.__filters[BFN.CONST.VINTAGE_COLORS_PRESETS[e]]=new BFN.filters.VintageColorsFilter(BFN.CONST.VINTAGE_COLORS_PRESETS[e])}}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(1==n||t.imageURL.includes("lut_")?t.imageURL.includes("lut_")?this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,512,512):this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTexture=this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null);var r=!0;switch(this.currentPresetID){case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_1:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_2:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_3:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_4:i.color1=t.color1,i.color2=t.color2;break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_5:for(var a=0;a<4;a++)i["color".concat(a+1,"_1")]=t.color1[a],i["color".concat(a+1,"_2")]=t.color2[a];break;case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_7:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_8:case BFN.CONST.VINTAGE_COLORS_PRESETS.PRESET_9:r=!1,i.intensity=1,i.iChannel1=this.effectTexture}if(r&&(this.blurSetup||this.setupBlur(),i.blurImage=this.blurTexture),t.hasOwnProperty("highlights")&&t.hasOwnProperty("shadows")&&(0!=t.highlights||0!=t.shadows))return this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,void(this.filters=[this.exposureFilter,i]);this.filters=[i]}}},{key:"setupBlur",value:function(){this.blurSetup=!0;var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);this.blurTextureHolder.texture=this.sourceTexture,this.idealBlur=Math.round(Math.max(this.sourceTexture.width,this.sourceTexture.height))/1024*1,this.blurFilter.resolution=.5,this.blurFilter.blur=this.idealBlur,this.blurFilter.threshold=.3,this.blurTextureHolder.filters=[this.blurFilter],BFN.Stage.render(this.blurTextureHolder,e),this.blurTextureHolder.filters=[],this.blurTextureHolder=null,this.blurTextureHolder=new PIXI.Sprite,this.blurTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.blurTextureHolder.texture=this.sourceTexture,this.adaptiveSharpness.blurImage=e,this.blurTextureHolder.filters=[this.adaptiveSharpness],BFN.Stage.render(this.blurTextureHolder,this.blurTexture),e.destroyGC(!0),e=null,this.blurTextureHolder.filters=[]}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurTexture=null),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.VintageColorsEffect=new dd;var md=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.HOLGA_ART_PRESETS)this.__filters[BFN.CONST.HOLGA_ART_PRESETS[e]]=new BFN.filters.HolgaArtFilter(BFN.CONST.HOLGA_ART_PRESETS[e])}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_1:case BFN.CONST.HOLGA_ART_PRESETS.PRESET_5:i.slide_right=t.slide_right,i.slide_left=t.slide_left;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_2:case BFN.CONST.HOLGA_ART_PRESETS.PRESET_3:i.slide_vertical=t.slide_vertical,i.slide_horizontal=t.slide_horizontal;break;case BFN.CONST.HOLGA_ART_PRESETS.PRESET_4:i.slide_right=t.slide_right,i.slide_left=t.slide_left,i.vignette_amount=t.vignette_amount}null!=this.effectTexture&&(i.iChannel1=this.effectTexture),this.filters=[i]}else this.filters=[]}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.HolgaArtEffect=new md;var pd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.LINE_ARTOPIA_PRESETS)this.__filters[BFN.CONST.LINE_ARTOPIA_PRESETS[e]]=new BFN.filters.LineArtopiaFilter(BFN.CONST.LINE_ARTOPIA_PRESETS[e])}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),i.line_width=Math.max(Math.floor(t.line_width*Math.max(this.sourceTexture.width,this.sourceTexture.height)/1024),3),i.sketch_detail=t.sketch_detail,i.color=t.color,this.currentPresetID){case BFN.CONST.HOLGA_ART_PRESETS.PRESET_1:case BFN.CONST.HOLGA_ART_PRESETS.PRESET_2:i.line_angle=t.line_angle}null!=this.effectTexture&&(i.iChannel1=this.effectTexture),this.filters=[i]}else this.filters=[]}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.LineArtopiaEffect=new pd;var gd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.blurTexture=null,this.blurSetup=!1,this.adaptiveTexture=null,this.adaptiveTextureHolder=new PIXI.Sprite,this.adaptiveSetup=!1,this.bwFilter=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.bwTexture=null,this.bwTextureHolder=new PIXI.Sprite,this.bwSetup=!1,this.belndFilter=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY)}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("useFragment"))return this.bwSetup||this.setupBw(),this.blurSetup||this.setupBlur(this.bwTexture),this.adaptiveSetup||this.setupAdaptive(this.bwTexture),this.belndFilter.iChannel1=this.adaptiveTexture,this.belndFilter.intensity=.7,this.belndFilter.alphadir=1,void(this.filters=[this.belndFilter]);this.blurSetup||this.setupBlur(),this.adaptiveSharpness.blurImage=this.blurTexture,this.filters=[this.adaptiveSharpness]}},{key:"setupBlur",value:function(e){this.blurSetup=!0,this.blurTexture=this.blurFilter.render(.8,e||this.sourceTexture)}},{key:"setupAdaptive",value:function(e){this.adaptiveSetup=!0,this.adaptiveTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.adaptiveTextureHolder.texture=e||this.sourceTexture,this.adaptiveSharpness.blurImage=this.blurTexture,this.adaptiveTextureHolder.filters=[this.adaptiveSharpness],BFN.Stage.render(this.adaptiveTextureHolder,this.adaptiveTexture),this.adaptiveTextureHolder.filters=[],this.adaptiveTextureHolder=null,this.adaptiveTextureHolder=new PIXI.Sprite}},{key:"setupBw",value:function(){this.bwSetup=!0,this.bwTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.bwTextureHolder.texture=this.sourceTexture,this.bwTextureHolder.filters=[this.bwFilter],BFN.Stage.render(this.bwTextureHolder,this.bwTexture),this.bwTextureHolder.filters=[],this.bwTextureHolder=null,this.bwTextureHolder=new PIXI.Sprite}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.adaptiveSetup=!1,this.bwSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.adaptiveTexture&&(this.adaptiveTexture.destroyGC(!0),this.adaptiveTexture=null),null!=this.bwTexture&&(this.bwTexture.destroyGC(!0),this.bwTexture=null)}}]),n}();BFN.effects.HDREffect=new gd;var fd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.vignetteFilter=new BFN.filters.VignetteFilter,this.bwFilterM1=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_1),this.bwFilterM4=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.overlayBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY),this.hardlightBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.HARD_LIGHT),this.screenBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.SCREEN),this.multiplyBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.multiplyBlend2=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.motionBlurFilter=new BFN.filters.MotionBlurFilter,this.shiftChannel=new BFN.filters.ShiftChannelFilter,this.sigmoidFilter=new BFN.filters.SigmoidFilter,this.blurFilter=new BFN.filters.FastBlurWrapper,this.fisheyeFilter=new BFN.filters.FisheyeFilter,this.noiseFilter=new BFN.filters.NoiseFilter,this.isBWSetup=!1,this.isSigmoidSetup=!1,this.overlayBlendSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1,this.textureHolder=new PIXI.Sprite,this.textureMap={bwTexture:null,overlayBlendTexture:null,hardlightBlendTexture:null,screenBlendTexture:null,multiplyBlendTexture:null,multiplyBlendTexture2:null,vignetteTexture:null,motionBlurTexture:null,sigmoidTexture:null,fisheyeTexture:null,noiseTexture:null},this.__filters={},BFN.CONST.PINHOLE_PRESETS)BFN.CONST.PINHOLE_PRESETS[e]!=BFN.CONST.PINHOLE_PRESETS.PRESET_2&&BFN.CONST.PINHOLE_PRESETS[e]!=BFN.CONST.PINHOLE_PRESETS.PRESET_5||(this.__filters[BFN.CONST.PINHOLE_PRESETS[e]]=new BFN.filters.PinholeFilter(BFN.CONST.PINHOLE_PRESETS[e]))}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){var i=1;if(n&&(i=.1),this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")){if(this.currentPresetID=t.presetID,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);var r,a;switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.PINHOLE_PRESETS.PRESET_1:this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(null,"bwTexture",this.bwFilterM1)),this.overlayBlendSetup||(this.overlayBlendSetup=!0,this.overlayBlend.iChannel1=this.textureMap.bwTexture,this.renderCustomFilter(this.textureMap.bwTexture,"overlayBlendTexture",this.overlayBlend)),r=!1,this.vignette_amount!=t.vignette_amount&&(this.vignetteFilter.amount=t.vignette_amount,this.renderCustomFilter(this.textureMap.overlayBlendTexture,"vignetteTexture",this.vignetteFilter),this.vignette_amount=t.vignette_amount,r=!0),1!=r&&this.motion_angle==t.motion_angle&&this.motion_amount==t.motion_amount||(this.motion_angle=this.motionBlurFilter.angleDegree=t.motion_angle,this.motion_amount=t.motion_amount,this.motionBlurFilter.strength=this.motion_amount*Math.min(Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,100),this.renderCustomFilter(this.textureMap.vignetteTexture,"motionBlurTexture",this.motionBlurFilter)),this.texture=this.textureMap.vignetteTexture,this.hardlightBlend.iChannel1=this.textureMap.motionBlurTexture,this.filters=[this.hardlightBlend];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_2:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.textureMap.sigmoidTexture,this.shiftChannel.mode=5,this.renderCustomFilter(this.effectTexture,"hardlightBlendTexture",[this.hardlightBlend,this.shiftChannel].concat(this.blurFilter.apply(.05*i)))),this.texture=this.textureMap.hardlightBlendTexture,(a=this.__filters[this.currentPresetID]).vignette_amount=t.vignette_amount,a.fisheye_amount=t.fisheye_amount,this.filters=[a];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_3:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(null,"screenBlendTexture",this.screenBlend)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.screenBlendTexture,this.shiftChannel.mode=4,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",[this.multiplyBlend,this.shiftChannel].concat(this.blurFilter.apply(.1*i)))),this.texture=this.textureMap.multiplyBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_4:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",[this.sigmoidFilter].concat(this.blurFilter.apply(.1*i)))),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(null,"screenBlendTexture",this.screenBlend)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.screenBlendTexture,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",this.multiplyBlend)),r=!1,this.vignette_amount!=t.vignette_amount&&(this.vignetteFilter.amount=t.vignette_amount,this.renderCustomFilter(this.textureMap.multiplyBlendTexture,"vignetteTexture",this.vignetteFilter),this.vignette_amount=t.vignette_amount,this.multiplyBlendSetup2=!1,r=!0),1!=r&&this.motion_angle==t.motion_angle&&this.motion_amount==t.motion_amount||(this.motion_angle=this.motionBlurFilter.angleDegree=t.motion_angle,this.motion_amount=t.motion_amount,this.motionBlurFilter.strength=this.motion_amount*Math.min(Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,100),this.renderCustomFilter(this.textureMap.vignetteTexture,"motionBlurTexture",this.motionBlurFilter),this.multiplyBlendSetup2=!1),this.multiplyBlendSetup2||(this.multiplyBlendSetup2=!0,this.multiplyBlend2.iChannel1=this.textureMap.vignetteTexture,this.renderCustomFilter(this.textureMap.motionBlurTexture,"multiplyBlendTexture2",this.multiplyBlend2),this.overlayBlendSetup=!1),this.isNoiseSetup||(this.isNoiseSetup=!0,this.noiseFilter.duocolor1="0xffffff",this.noiseFilter.duocolor2="0xb8b8b8",this.renderCustomFilter(null,"noiseTexture",this.noiseFilter)),this.overlayBlendSetup||(this.overlayBlendSetup=!0,this.overlayBlend.iChannel1=this.textureMap.noiseTexture,this.renderCustomFilter(this.textureMap.multiplyBlendTexture2,"overlayBlendTexture",this.overlayBlend)),this.texture=this.textureMap.overlayBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_5:this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(null,"bwTexture",this.bwFilterM4)),this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(this.textureMap.bwTexture,"screenBlendTexture",this.screenBlend)),this.texture=this.textureMap.screenBlendTexture,(a=this.__filters[this.currentPresetID]).iChanel1=this.effectTexture,a.vignette_amount=t.vignette_amount,a.fisheye_amount=t.fisheye_amount,this.filters=[a]}}else this.filters=[]}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"renderCustomFilter",value:function(e,t,n){null==this.textureMap[t]&&(this.textureMap[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=n.constructor===Array?n:[n],BFN.Stage.render(this.textureHolder,this.textureMap[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.isBWSetup=!1,this.overlayBlendSetup=!1,this.isSigmoidSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1;var e=this.textureMap;Object.keys(e).forEach(function(t){e.hasOwnProperty(t)&&null!=e[t]&&(e[t].destroyGC(!0),e[t]=null)}),this.blurFilter.dispose(),this.disposeTexture("effectTexture"),this.vignette_amount=null,this.motion_angle=null,this.motion_amount=null,this.fisheye_amount=null}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}}]),n}();BFN.effects.PinholeEffect=new fd;var vd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.colorMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.brightnessContrastFilter=new PIXI.filters.ColorMatrixFilter,this.brightnessContrastFilter.matrix=this.colorMatrix,this.vignetteFilter=new BFN.filters.VignetteFilter,this.bwFilterM1=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_1),this.bwFilterM4=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.overlayBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY),this.hardlightBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.HARD_LIGHT),this.screenBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.SCREEN),this.multiplyBlend=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.multiplyBlend2=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.MULTIPLY),this.motionBlurFilter=new BFN.filters.MotionBlurFilter,this.shiftChannel=new BFN.filters.ShiftChannelFilter,this.sigmoidFilter=new BFN.filters.SigmoidFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.fisheyeFilter=new BFN.filters.FisheyeFilter,this.noiseFilter=new BFN.filters.NoiseFilter,this.isBWSetup=!1,this.isBlurSetup=!1,this.isSigmoidSetup=!1,this.overlayBlendSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1,this.isFisheyeSetup=!1,this.isColoredTextureSetup=!1,this.isSCTextureSetup=!1,this.textureHolder=new PIXI.Sprite,this.textureMap={bwTexture:null,blurTexture:null,overlayBlendTexture:null,hardlightBlendTexture:null,screenBlendTexture:null,multiplyBlendTexture:null,multiplyBlendTexture2:null,vignetteTexture:null,motionBlurTexture:null,sigmoidTexture:null,fisheyeTexture:null,noiseTexture:null,coloredTexture:null,scTexture:null}}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){var i=1;if(n&&(i=.1),this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")){if(this.currentPresetID=t.presetID,t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);switch(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID){case BFN.CONST.PINHOLE_PRESETS.PRESET_1:this.isSigmoidSetup||(this.isSigmoidSetup=!0,this.sigmoidFilter.sharpness=.3,this.sigmoidFilter.brightness=.75,this.renderCustomFilter(null,"sigmoidTexture",this.sigmoidFilter)),this.screenBlendSetup||(this.screenBlendSetup=!0,this.screenBlend.iChannel1=this.textureMap.sigmoidTexture,this.renderCustomFilter(null,"screenBlendTexture",this.screenBlend)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.screenBlendTexture,this.shiftChannel.mode=2,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",[this.multiplyBlend,this.shiftChannel].concat(this.blurFilter.apply(.1*i)))),this.texture=this.textureMap.multiplyBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_2:this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.shiftChannel.mode=3,this.renderCustomFilter(null,"coloredTexture",[this.shiftChannel]),this.multiplyBlend.iChannel1=this.textureMap.coloredTexture,this.renderCustomFilter(this.effectTexture,"multiplyBlendTexture",[this.multiplyBlend].concat(this.blurFilter.apply(.1*i)))),this.texture=this.textureMap.multiplyBlendTexture,this.vignetteFilter.amount=t.vignette_amount,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter,this.vignetteFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_3:this.isSCTextureSetup||(this.isSCTextureSetup=!0,this.shiftChannel.mode=3,this.renderCustomFilter(null,"scTexture",this.shiftChannel)),this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.textureMap.scTexture,this.brightnessContrastFilter.brightness(1,!1),this.brightnessContrastFilter.contrast(.4,!0),this.renderCustomFilter(null,"hardlightBlendTexture",[this.hardlightBlend,this.brightnessContrastFilter])),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.effectTexture,this.renderCustomFilter(this.textureMap.hardlightBlendTexture,"multiplyBlendTexture",this.multiplyBlend)),this.texture=this.textureMap.multiplyBlendTexture,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_4:this.isFisheyeSetup&&this.fisheye_amount==t.fisheye_amount||(this.isFisheyeSetup=!0,this.fisheye_amount=t.fisheye_amount,this.fisheyeFilter.radius=t.fisheye_amount,this.renderCustomFilter(null,"fisheyeTexture",[this.fisheyeFilter].concat(this.blurFilter.apply(.1*i))),this.multiplyBlendSetup=!1,this.hardlightBlendSetup=!1),this.isColoredTextureSetup||this.createColoredTexture(16777215),this.vignette_amount!=t.vignette_amount&&(this.vignette_amount=t.vignette_amount,this.vignetteFilter.amount=t.vignette_amount,this.renderCustomFilter(this.textureMap.coloredTexture,"vignetteTexture",this.vignetteFilter),this.multiplyBlendSetup=!1,this.hardlightBlendSetup=!1),this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.textureMap.fisheyeTexture,this.renderCustomFilter(this.textureMap.vignetteTexture,"hardlightBlendTexture",[this.hardlightBlend]),this.isBWSetup=!1,this.multiplyBlendSetup=!1,this.isBlurSetup=!1),this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(this.textureMap.hardlightBlendTexture,"bwTexture",this.bwFilterM4)),this.isBlurSetup||(this.isBlurSetup=!0,this.textureMap.blurTexture=this.blurFilter.render(.04,this.textureMap.hardlightBlendTexture)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.blurTexture,this.renderCustomFilter(this.textureMap.bwTexture,"multiplyBlendTexture",this.multiplyBlend)),this.texture=this.effectTexture,this.overlayBlend.iChannel1=this.textureMap.multiplyBlendTexture,this.filters=[this.overlayBlend];break;case BFN.CONST.PINHOLE_PRESETS.PRESET_5:this.hardlightBlendSetup||(this.hardlightBlendSetup=!0,this.hardlightBlend.iChannel1=this.sourceTexture,this.renderCustomFilter(null,"hardlightBlendTexture",[this.hardlightBlend])),this.isBWSetup||(this.isBWSetup=!0,this.renderCustomFilter(this.textureMap.hardlightBlendTexture,"bwTexture",this.bwFilterM4)),this.isBlurSetup||(this.isBlurSetup=!0,this.textureMap.blurTexture=this.blurFilter.render(.04,this.textureMap.hardlightBlendTexture)),this.multiplyBlendSetup||(this.multiplyBlendSetup=!0,this.multiplyBlend.iChannel1=this.textureMap.blurTexture,this.renderCustomFilter(this.textureMap.bwTexture,"multiplyBlendTexture",this.multiplyBlend)),this.texture=this.textureMap.multiplyBlendTexture,this.vignetteFilter.amount=t.vignette_amount,this.fisheyeFilter.radius=t.fisheye_amount,this.filters=[this.fisheyeFilter,this.vignetteFilter]}}else this.filters=[]}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"renderCustomFilter",value:function(e,t,n){null==this.textureMap[t]&&(this.textureMap[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=n.constructor===Array?n:[n],BFN.Stage.render(this.textureHolder,this.textureMap[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}},{key:"createColoredTexture",value:function(e,t){this.isColoredTextureSetup=!0;var n=new PIXI.Graphics;n.beginFill(e),n.drawRect(0,0,this.sourceTexture.width,this.sourceTexture.height),n.endFill(),null!=t&&(n.filters=t.constructor===Array?t:[t]),this.textureMap.coloredTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(n,this.textureMap.coloredTexture),n.filters=[],n.clear(),n=null}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.isBWSetup=!1,this.isBlurSetup=!1,this.overlayBlendSetup=!1,this.isSigmoidSetup=!1,this.hardlightBlendSetup=!1,this.screenBlendSetup=!1,this.multiplyBlendSetup=!1,this.multiplyBlendSetup2=!1,this.isNoiseSetup=!1,this.isFisheyeSetup=!1,this.isColoredTextureSetup=!1,this.isSCTextureSetup=!1,this.disposeTexture("effectTexture");var e=this.textureMap;Object.keys(e).forEach(function(t){e.hasOwnProperty(t)&&null!=e[t]&&("blurTexture"!=t&&e[t].destroyGC(!0),e[t]=null)}),this.blurFilter.dispose(),this.vignette_amount=null,this.motion_angle=null,this.motion_amount=null,this.fisheye_amount=null}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}}]),n}();BFN.effects.ColorPinholeEffect=new vd;var yd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.STENCILER_PRESETS)this.__filters[BFN.CONST.STENCILER_PRESETS[e]]=new BFN.filters.StencilerFilter(BFN.CONST.STENCILER_PRESETS[e])}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),!this.blurSetup&&t.hasOwnProperty("useBlur")&&(this.setupBlur(),i.blurSampler=this.blurTexture),i.textureSampler=this.effectTexture,t.hasOwnProperty("color")&&(i.color=t.color),t.hasOwnProperty("detail_level")&&(i.detail_level=t.detail_level),t.hasOwnProperty("color_detail")&&(i.color_detail=t.color_detail),t.hasOwnProperty("smooth_amount")&&(i.smooth_amount=t.smooth_amount),this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBlur",value:function(){this.blurSetup=!0,this.idealBlur=Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.StencilerEffect=new yd;var xd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.GRUNGE_PRESETS)this.__filters[BFN.CONST.GRUNGE_PRESETS[e]]=new BFN.filters.GrungeFilter(BFN.CONST.GRUNGE_PRESETS[e])}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("useBlur")&&(this.blurSetup||this.setupBlur(),i.blurImage=this.blurTexture),i.iChannel1=this.effectTexture,t.hasOwnProperty("silhouette_amount")&&(i.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("detail_level")&&(i.detail_level=t.detail_level),t.hasOwnProperty("shadow_amount")&&(i.shadow_amount=t.shadow_amount),this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBlur",value:function(){this.blurSetup=!0,this.blurTexture=this.blurFilter.render(.85,this.sourceTexture)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.GrungeEffect=new xd;var _d=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurSetup=!1,this.__filters={},BFN.CONST.SUNBURST_PRESETS)this.__filters[BFN.CONST.SUNBURST_PRESETS[e]]=new BFN.filters.SunburstFilter(BFN.CONST.SUNBURST_PRESETS[e])}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("useBlur")&&(this.blurSetup||this.setupBlur(),i.blurSampler=this.blurTexture),i.textureSampler=this.effectTexture,t.hasOwnProperty("color")&&(i.color=t.color),t.hasOwnProperty("halftone_size")&&(i.halftone_size=Math.max(Math.floor(t.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3)),t.hasOwnProperty("silhouette_amount")&&(i.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("sunburst_amount")&&(i.sunburst_amount=t.sunburst_amount),t.hasOwnProperty("grain_amount")&&(i.grain_amount=t.grain_amount),this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupBlur",value:function(){this.blurSetup=!0,this.idealBlur=Math.max(this.sourceTexture.width,this.sourceTexture.height)/4e3,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurSetup=!1,this.currentPresetID=null,null!=this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose(),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.SunburstEffect=new _d;var Id=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.blurFilter=new BFN.filters.FastBlurWrapper,this.exposureFilter=new BFN.filters.HSFilter,this.duotoneFilter=new BFN.filters.DuoToneFilter,this.brightnessContrastFilter=new PIXI.filters.ColorMatrixFilter,this.brightnessContrastFilter.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.__filters={},BFN.CONST.OLD_PHOTO_PRESETS)BFN.CONST.OLD_PHOTO_PRESETS[e]==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19||BFN.CONST.OLD_PHOTO_PRESETS[e]==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_20?this.__filters[BFN.CONST.OLD_PHOTO_PRESETS[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.OVERLAY):this.__filters[BFN.CONST.OLD_PHOTO_PRESETS[e]]=new BFN.filters.OldPhotoFilter(BFN.CONST.OLD_PHOTO_PRESETS[e]);this.blurTexture=null,this.curvesTexture=null,this.isBlurSetup=!1,this.isCurvesSetup=!1,this.blurAmount=null,this.highlights=0,this.shadows=0}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){var i=1;if(n&&(i=.1),this.resolution=e,this.parameters=t,this.texture!=this.sourceTexture&&(this.texture=this.sourceTexture),t.hasOwnProperty("presetID")){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);if(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19||this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_20){r.iChannel1=this.effectTexture;var a=!1;if(t.hasOwnProperty("highlights")&&(0==t.highlights&&0==t.shadows||t.highlights==this.highlights&&t.shadows==this.shadows||(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,a=!0,this.isCurvesSetup=!1),this.highlights=t.highlights,this.shadows=t.shadows),!this.isCurvesSetup){this.disposeTexture("curvesTexture"),this.isCurvesSetup=!0,this.duotoneFilter.color1="0xFFFFFF",this.duotoneFilter.color2=this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19?"0x281c02":"0x0b0802";var o=a?this.renderCustomFilter(null,[this.exposureFilter,this.duotoneFilter]):this.renderCustomFilter(null,[this.duotoneFilter]);this.curvesTexture=this.renderCurves(o,BFN.CONST.PALETTE_MAPS.darkerMap,this.currentPresetID==BFN.CONST.OLD_PHOTO_PRESETS.PRESET_19?BFN.CONST.PALETTE_MAPS.contrast:BFN.CONST.PALETTE_MAPS.contrastHigh)}return r.intensity=.65,this.texture=this.curvesTexture,void(this.filters=[r])}var s=null;t.hasOwnProperty("focal_blur")?s=t.focal_blur:t.hasOwnProperty("blur_amount")&&(s=t.blur_amount),s!=this.blurAmount&&(this.blurAmount=s,1==this.isBlurSetup&&(this.isBlurSetup=!1)),t.hasOwnProperty("useBlur")?(this.isBlurSetup||(this.isBlurSetup=!0,this.blurTexture=this.blurFilter.render(null!=this.blurAmount?this.blurAmount*i:.1*i,this.sourceTexture)),r.blurSampler=this.blurTexture):t.hasOwnProperty("focal_blur")?r.focal_blur=t.focal_blur:t.hasOwnProperty("blur_amount")&&(r.blur_amount=t.blur_amount),null!=this.effectTexture&&(r.textureSampler=this.effectTexture);var l=[];t.hasOwnProperty("grain_amount")&&(r.grain_amount=t.grain_amount),t.hasOwnProperty("silhouette_amount")&&(r.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("color_amount")&&(r.color_amount=t.color_amount),0==t.highlights&&0==t.shadows||(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,l[l.length]=this.exposureFilter),t.hasOwnProperty("brightness")&&(this.brightnessContrastFilter.brightness(t.brightness,!1),l[l.length]=this.brightnessContrastFilter),t.hasOwnProperty("contrast")&&(r.contrast=t.contrast),l[l.length]=r,this.filters=l}else this.filters=[]}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"renderCustomFilter",value:function(e,t){var n=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),i=new PIXI.Sprite(e||this.sourceTexture);return i.filters=t.constructor===Array?t:[t],BFN.Stage.render(i,n),i.filters=[],i=null,n}},{key:"renderCurves",value:function(e,t,n){var i=3==t.length?new BFN.filters.CurvesFilter(t[0],t[1],t[2]):2==t.length?new BFN.filters.CurvesFilter(t[0],t[1]):new BFN.filters.CurvesFilter(t),r=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),a=new PIXI.Sprite;if(a.texture=e,a.filters=[i],BFN.Stage.render(a,r),null!=n){var o=3==n.length?new BFN.filters.CurvesFilter(n[0],n[1],n[2]):2==n.length?new BFN.filters.CurvesFilter(n[0],n[1]):new BFN.filters.CurvesFilter(n),s=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),l=new PIXI.Sprite;return l.texture=r,l.filters=[o],BFN.Stage.render(l,s),r.destroyGC(!0),r=null,s}return r}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.isBlurSetup=!1,this.isCurvesSetup=!1,this.disposeTexture("effectTexture"),this.disposeTexture("curvesTexture"),this.blurFilter.dispose(),this.blurTexture=null,this.blurAmount=null,this.highlights=0,this.shadows=0}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}}]),n}();BFN.effects.OldPhotoEffect=new Id;var Td=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.currentPresetID=null,this.effectTexture=null,this.isTileSetup=!1,this.__filters={},BFN.CONST.WINTER_PRESETS)this.__filters[BFN.CONST.WINTER_PRESETS[e]]=new BFN.filters.WinterFilter(BFN.CONST.WINTER_PRESETS[e])}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var n=this.__filters[this.currentPresetID];t.hasOwnProperty("imageURL")&&(this.effectTexture||(this.effectTexture=BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,512,512))),this.isTileSetup||this.setupTile(),n.textureSampler=this.effectTexture,t.hasOwnProperty("frost_amount")&&(n.frost_amount=t.frost_amount),t.hasOwnProperty("opacity")&&(n.amount=t.opacity),this.filters=[n]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"setupTile",value:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.extras.TilingSprite(this.effectTexture,this.sourceTexture.width,this.sourceTexture.height);BFN.Stage.render(t,e),null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),this.effectTexture=e,this.isTileSetup=!0}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,null!=this.effectTexture&&(this.effectTexture.destroyGC(!0),this.effectTexture=null),this.isTileSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null)}}]),n}();BFN.effects.WinterEffect=new Td;var bd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.__filters={},BFN.CONST.TILT_SHIFT_PRESETS)this.__filters[BFN.CONST.TILT_SHIFT_PRESETS[e]]=new BFN.filters.TiltShiftFilter(BFN.CONST.TILT_SHIFT_PRESETS[e]);this.blurFilter=new BFN.filters.FastBlurWrapper,this.blurTexture=null,this.blurAmount=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var n=this.__filters[this.currentPresetID];t.blur_amount!=this.blurAmount&&(this.blurAmount=t.blur_amount,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),n.blurSampler=this.blurTexture,t.hasOwnProperty("size")&&(n.size=t.size),t.hasOwnProperty("angle")&&(n.angle=t.angle),t.hasOwnProperty("slide_vertical")&&(n.slide_vertical=t.slide_vertical),t.hasOwnProperty("slide_horizontal")&&(n.slide_horizontal=t.slide_horizontal),this.filters=[n]}}},{key:"renderCustomFilter",value:function(e,t){var n=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),i=new PIXI.Sprite(e||this.sourceTexture);return i.filters=t.constructor===Array?t:[t],BFN.Stage.render(i,n),i.filters=[],i=null,n}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.blurFilter.dispose(),this.blurTexture=null,this.blurAmount=null}}]),n}();BFN.effects.TiltShiftEffect=new bd;var Sd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.tiledDownloadedTexture=null,this.tiledTexture=null,this.__filters={},BFN.CONST.PATRIOTIC_PRESETS)this.__filters[BFN.CONST.PATRIOTIC_PRESETS[e]]=new BFN.filters.PatrioticFilter(BFN.CONST.PATRIOTIC_PRESETS[e]);this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.sBlurFilter=new BFN.filters.SurfaceBlurFilter,this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.blurTexture=null,this.blurAmount=null,this.isAdaptiveSetup=!1,this.isTileSetup=!1}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("tileURL")&&(this.tiledDownloadedTexture||(this.tiledDownloadedTexture=BFN.XMLGraphicLoader.getGraphicByName(t.tileURL,256,256))),t.hasOwnProperty("smoothness")&&(t.smoothness!=this.blurAmount&&(this.blurAmount=t.smoothness,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),i.blurImage=this.blurTexture),this.currentPresetID==BFN.CONST.PATRIOTIC_PRESETS.PRESET_4||this.currentPresetID==BFN.CONST.PATRIOTIC_PRESETS.PRESET_5?(this.isAdaptiveSetup||this.setupAdaptiveSharpnes(),i.adaptiveSharpenSampler=this.blurTexture):this.currentPresetID==BFN.CONST.PATRIOTIC_PRESETS.PRESET_6&&(this.isTileSetup||this.setupTile(),i.starSampler=this.tiledTexture),null!=this.effectTexture&&(i.textureSampler=this.effectTexture),t.hasOwnProperty("silhouette_amount")&&(i.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("color_space")&&(i.color_space=t.color_space),t.hasOwnProperty("halftone_size")&&(i.halftone_size=Math.max(Math.floor(t.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3)),t.hasOwnProperty("star_size")&&(i.star_size=t.star_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/2e3),t.hasOwnProperty("red")&&(i.red=t.red),t.hasOwnProperty("navy")&&(i.navy=t.navy),t.hasOwnProperty("line_color")&&(i.line_width=this.sourceTexture.width/3,i.line_angle=this.sourceTexture.width>this.sourceTexture.height?90:0,i.background_color=t.background_color,i.line_color=t.line_color),this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"renderCustomFilter",value:function(e,t){var n=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),i=new PIXI.Sprite(e||this.sourceTexture);return i.filters=t.constructor===Array?t:[t],BFN.Stage.render(i,n),i.filters=[],i=null,n}},{key:"setupAdaptiveSharpnes",value:function(){this.isAdaptiveSetup=!0,this.idealBlur=Math.round(Math.max(this.sourceTexture.width,this.sourceTexture.height))/1024*1,this.sBlurFilter.resolution=.5,this.sBlurFilter.blur=this.idealBlur,this.sBlurFilter.threshold=.3;var e=this.renderCustomFilter(null,this.sBlurFilter);this.adaptiveSharpness.blurImage=e,this.blurTexture=this.renderCustomFilter(null,this.adaptiveSharpness),e.destroyGC(!0),e=null}},{key:"setupTile",value:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.extras.TilingSprite(this.tiledDownloadedTexture,256,256);BFN.Stage.render(t,e),this.disposeTexture("tiledDownloadedTexture"),this.disposeTexture("tiledTexture"),this.tiledTexture=e,this.isTileSetup=!0}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}},{key:"disposeEffect",value:function(){this.currentPresetID!=BFN.CONST.PATRIOTIC_PRESETS.PRESET_4&&this.currentPresetID!=BFN.CONST.PATRIOTIC_PRESETS.PRESET_5||null!=this.blurTexture&&this.blurTexture.destroyGC(!0),this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.disposeTexture("tiledDownloadedTexture"),this.disposeTexture("tiledTexture"),this.blurFilter.dispose(),this.blurTexture=null,this.blurAmount=null,this.isAdaptiveSetup=!1,this.isTileSetup=!1}}]),n}();BFN.effects.PatrioticEffect=new Sd;var Cd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.isTileSetup=!1,this.isHalftoneTileSetup=!1,this.downloadedGradientTexture=null,this.gradientTexture=null,this.__filters={},BFN.CONST.POPART_PRESETS)this.__filters[BFN.CONST.POPART_PRESETS[e]]=new BFN.filters.PopArtFilter(BFN.CONST.POPART_PRESETS[e]);this.sBlurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.adaptiveSharpness=new BFN.filters.AdaptiveSharpnessFilter,this.adaptiveTexture=null,this.isAdaptiveSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurAmount=null,this.halftoneFilter=new BFN.filters.HalftoneFilter,this.downloadedHalftoneTexture=null,this.halftoneTexture=null,this.halftone_size=null,this.textureHolder=new PIXI.Sprite}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){var i=1;if(n&&(i=.1),this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var r=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);if(null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("gradURL")&&(this.isTileSetup||(this.currentPresetID==BFN.CONST.POPART_PRESETS.PRESET_11?this.downloadedGradientTexture=BFN.XMLGraphicLoader.getGraphicByName(t.gradURL,256,20):this.downloadedGradientTexture=BFN.XMLGraphicLoader.getGraphicByName(t.gradURL,256,3),this.setupTile()),null!=this.gradientTexture&&(r.gradientSampler=this.gradientTexture)),t.hasOwnProperty("halftoneURL")){if(!this.isHalftoneTileSetup){var a=BFN.FilterHelper.getNextPowerOfTwo(1/(100/(Math.min(this.sourceTexture.width,this.sourceTexture.height)/8))*100);this.downloadedHalftoneTexture=BFN.XMLGraphicLoader.getGraphicByName(t.halftoneURL,a,a),this.setupHalftoneTile()}null!=this.halftoneTexture&&(r.halftoneSampler=this.halftoneTexture)}var o=t.hasOwnProperty("smooth_amount")?t.smooth_amount*i:.3*i;t.hasOwnProperty("isBlur")&&(o!=this.blurAmount&&(this.blurAmount=o,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),r.blurSampler=this.blurTexture),t.hasOwnProperty("isAdaptive")&&(this.isAdaptiveSetup||this.setupAdaptiveSharpnes(),r.adaptiveSharpenSampler=this.adaptiveTexture),null!=this.effectTexture&&(r.textureSampler=this.effectTexture),t.hasOwnProperty("isGradient")&&(this.gradientTexture||(this.gradientTexture=BFN.FilterHelper.createLinearGradient(t.colors,t.ratios,0,0,this.sourceTexture.width,this.sourceTexture.height,this.sourceTexture.width,this.sourceTexture.height,t.rotation,!0,!0)),r.gradientSampler=this.gradientTexture),t.hasOwnProperty("isHalftone")?(this.halftone_size!=t.halftone_size&&(this.halftone_size=t.halftone_size,this.idealDotSize=Math.max(Math.floor(this.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3),this.halftoneFilter.dotSize=this.idealDotSize,this.halftoneFilter.dot_color="0x808080",this.renderCustomFilter(null,"halftoneTexture",this.halftoneFilter)),r.halftoneSampler=this.halftoneTexture):t.hasOwnProperty("halftone_size")&&(r.halftone_size=Math.max(Math.floor(t.halftone_size*Math.max(this.sourceTexture.width,this.sourceTexture.height)/512),3)),t.hasOwnProperty("silhouette_amount")&&(r.silhouette_amount=t.silhouette_amount),t.hasOwnProperty("color_detail")&&(r.color_detail=t.color_detail),t.hasOwnProperty("detail_level")&&(r.detail_level=t.detail_level),t.hasOwnProperty("color_value_1")&&(r.color_value_1=t.color_value_1),t.hasOwnProperty("color_value_2")&&(r.color_value_2=t.color_value_2),t.hasOwnProperty("color_value_3")&&(r.color_value_3=t.color_value_3),t.hasOwnProperty("color_value_4")&&(r.color_value_4=t.color_value_4),this.filters=[r]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"renderCustomFilter",value:function(e,t,n){null==this[t]&&(this[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=n.constructor===Array?n:[n],BFN.Stage.render(this.textureHolder,this[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}},{key:"setupTile",value:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.Sprite(this.downloadedGradientTexture);BFN.Stage.render(t,e),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.gradientTexture=e,this.isTileSetup=!0}},{key:"setupHalftoneTile",value:function(){null==this.halftoneTexture&&(this.halftoneTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height));var e=new PIXI.extras.TilingSprite(this.downloadedHalftoneTexture,this.sourceTexture.width,this.sourceTexture.height);BFN.Stage.render(e,this.halftoneTexture),this.disposeTexture("downloadedHalftoneTexture"),this.isHalftoneTileSetup=!0}},{key:"setupAdaptiveSharpnes",value:function(){this.isAdaptiveSetup=!0,this.idealBlur=Math.round(Math.max(this.sourceTexture.width,this.sourceTexture.height))/1024*1;var e=this.sBlurFilter.render(.5,this.sourceTexture);this.adaptiveSharpness.intensity=1.5,this.adaptiveSharpness.blurImage=e,this.renderCustomFilter(null,"adaptiveTexture",this.adaptiveSharpness),e=null}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.disposeTexture("adaptiveTexture"),this.disposeTexture("halftoneTexture"),this.disposeTexture("downloadedHalftoneTexture"),this.blurTexture=null,this.blurFilter.dispose(),this.sBlurFilter.dispose(),this.halftone_size=null,this.isTileSetup=!1,this.isHalftoneTileSetup=!1,this.isAdaptiveSetup=!1,this.blurAmount=null}}]),n}();BFN.effects.PopArtEffect=new Cd;var Bd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.tintFilter=new BFN.filters.TintDuoFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("color_1")&&t.hasOwnProperty("color_2"))return this.tintFilter.color1=t.color_1,this.tintFilter.color2=t.color_2,this.tintFilter.amount=t.opacity,void(this.filters=[this.tintFilter]);this.filters=[]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1}}]),n}();BFN.effects.TintEffect=new Bd;var Fd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper,this.beautifyFilter=BFN.ShaderPool.BeautifyFilter,this.pluginName="filter_renderer",this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.5,this.sourceTexture),this.beautifyFilter.blurImage=this.blurTexture}},{key:"applyEffect",value:function(e,t){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("beautify_amount"))return this.beautifyFilter.amount=t.beautify_amount,void(this.bfn_shaders=[this.beautifyFilter]);this.bfn_shaders=[],this.filters=[]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}}]),n}();BFN.effects.BeautifyEffect=new Fd;var Ed=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.__filters={},BFN.CONST.MOTION_COLOR_PRESETS)this.__filters[BFN.CONST.MOTION_COLOR_PRESETS[e]]=new BFN.filters.MotionColorFilter(BFN.CONST.MOTION_COLOR_PRESETS[e]);this.bwMode3=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.exposureFilter=new PIXI.filters.ColorMatrixFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0,"x"),this.blurTexture=null,this.blurAmount=null,this.textureHolder=new PIXI.Sprite}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),null==this.blurTexture&&(this.blurAmount=1,this.exposureFilter.brightness(1,!1),this.exposureFilter.contrast(1.4,!0),this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),i.blurSampler=this.blurTexture,null!=this.effectTexture&&(i.textureSampler=this.effectTexture),t.hasOwnProperty("vignette_amount")&&(i.vignette_amount=t.vignette_amount),this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"renderCustomFilter",value:function(e,t,n){null==this[t]&&(this[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=n.constructor===Array?n:[n],BFN.Stage.render(this.textureHolder,this[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.blurTexture=null,this.blurFilter.dispose()}}]),n}();BFN.effects.MotionColorEffect=new Ed;var Pd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.handleEffectTextureLoaderTextureLoadedBind=this.handleEffectTextureLoaderTextureLoaded.bind(this),this.effectTextureLoader=null,this.effectTexture=null,this.downloadedGradientTexture=null,this.gradientTexture=null,this.isTileSetup=!1,this.__filters={},BFN.CONST.LOMO_ART_PRESETS)this.__filters[BFN.CONST.LOMO_ART_PRESETS[e]]=new BFN.filters.LomoArtFilter(BFN.CONST.LOMO_ART_PRESETS[e]);this.exposureFilter=new BFN.filters.HSFilter,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurAmount=null,this.textureHolder=new PIXI.Sprite}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];if(t.hasOwnProperty("imageURL")&&(this.effectTextureLoader||(this.effectTextureLoader=new BFN.EffectTextureLoader,this.effectTextureLoader.addEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind)),this.effectTexture||this.effectTextureLoader.loading||(this.effectTexture=1==n?BFN.XMLGraphicLoader.getGraphicByName(t.imageURL,this.sourceTexture.width,this.sourceTexture.height):this.effectTextureLoader.getTexture(BFN.originalTextureURl+t.imageURL,this.sourceTexture.width,this.sourceTexture.height))),null!=this.effectTextureLoader&&this.effectTextureLoader.loading)return void(this.filters=[]);null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),t.hasOwnProperty("gradURL")&&(this.isTileSetup||(this.downloadedGradientTexture=BFN.XMLGraphicLoader.getGraphicByName(t.gradURL,256,5),this.setupTile()),null!=this.gradientTexture&&(i.gradientSampler=this.gradientTexture)),null==this.blurTexture&&(this.blurAmount=1,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),i.blurSampler=this.blurTexture,null!=this.effectTexture&&(i.textureSampler=this.effectTexture),t.hasOwnProperty("vignette_amount")&&(i.vignette_amount=t.vignette_amount),t.hasOwnProperty("border_color")&&(i.border_color=t.border_color),t.hasOwnProperty("border_thickness")&&(i.border_thickness=Math.floor(t.border_thickness*Math.max(this.sourceTexture.width,this.sourceTexture.height)/1024)),0!=t.highlights||0!=t.shadows?(this.exposureFilter.highlights=t.highlights,this.exposureFilter.shadows=t.shadows,this.filters=[this.exposureFilter,i]):this.filters=[i]}}},{key:"handleEffectTextureLoaderTextureLoaded",value:function(e){BFN.EffectManager.currentEffect==this?BFN.EffectManager.processEffect():this.applyEffect(this.resolution,this.parameters)}},{key:"renderCustomFilter",value:function(e,t,n){null==this[t]&&(this[t]=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height)),this.textureHolder.texture=e||this.sourceTexture,this.textureHolder.filters=n.constructor===Array?n:[n],BFN.Stage.render(this.textureHolder,this[t]),this.textureHolder.filters=[],this.textureHolder.texture=null}},{key:"setupTile",value:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),t=new PIXI.Sprite(this.downloadedGradientTexture);BFN.Stage.render(t,e),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.gradientTexture=e,this.isTileSetup=!0}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("effectTexture"),this.disposeTexture("downloadedGradientTexture"),this.disposeTexture("gradientTexture"),this.isTileSetup=!1,this.blurTexture=null,this.blurFilter.dispose()}}]),n}();BFN.effects.LomoArtEffect=new Pd;var kd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.currentPresetID=null,this.__filters={},BFN.CONST.TOUCH_UP_PRESETS)this.__filters[BFN.CONST.TOUCH_UP_PRESETS[e]]=new BFN.filters.TouchUpFilter(BFN.CONST.TOUCH_UP_PRESETS[e]);this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurFilter2=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.blurTexture2=null,this.blurAmount=null,this.curvesTexture=null,this.scFilter=new BFN.filters.SkinCandidateFilter,this.averageColor=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID];t.hasOwnProperty("isBlur")&&1==t.isBlur&&(null==this.blurTexture&&(this.blurAmount=this.currentPresetID==BFN.CONST.TOUCH_UP_PRESETS.wrinkles?.25:.4,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),i.blurSampler=this.blurTexture),t.hasOwnProperty("isBlur2")&&1==t.isBlur2&&(null==this.blurTexture2&&(this.blurTexture2=this.blurFilter2.render(.07,this.sourceTexture,null,!0)),i.blurSampler2=this.blurTexture2),t.hasOwnProperty("curves")&&(null==this.curvesTexture&&this.setupCurves(BFN.CONST.PALETTE_MAPS[t.curves],t),i.curvesSampler=this.curvesTexture),null==this.averageColor&&this.setupSkinCandidate(),t.hasOwnProperty("strength")&&(i.strength=t.strength),t.hasOwnProperty("color_palette")&&(i.color_palette=t.color_palette),i.averageColor=this.averageColor,this.filters=[i]}}},{key:"setupCurves",value:function(e,t){var n=3==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1],e[2]):2==e.length?BFN.FilterHelper.GetCurvesTexture(e[0],e[1]):BFN.FilterHelper.GetCurvesTexture(e);this.curvesTexture||(this.curvesTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height));var i=new PIXI.Sprite;i.texture=n,BFN.Stage.render(i,this.curvesTexture),n.destroyGC(!0),n=null;try{i.texture.destroyGC(!0)}catch(e){}i=null,this.isSetupCurves=!0}},{key:"setupSkinCandidate",value:function(){var e=Math.min(1,600/this.sourceTexture.width,600/this.sourceTexture.height),t=PIXI.RenderTexture.create(Math.floor(this.sourceTexture.width*e),Math.floor(this.sourceTexture.height*e)),n=new PIXI.Sprite;n.scale.x=e,n.scale.y=e,n.texture=this.sourceTexture,n.filters=[this.scFilter],BFN.Stage.render(n,t),this.averageColor=BFN.Util.getTextureAverageColor(t,!1,!0),t.destroyGC(!0),t=null,n.texture=null,n=null}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,null!=this.effectTextureLoader&&(this.effectTextureLoader.removeEventListener(BFN.EffectTextureLoaderEvents.TEXTURE_LOADED.type,this.handleEffectTextureLoaderTextureLoadedBind),this.effectTextureLoader.destroy(),this.effectTextureLoader=null),this.currentPresetID=null,this.disposeTexture("curvesTexture"),this.averageColor=null,this.blurTexture=null,this.blurFilter.dispose(),this.blurTexture2=null,this.blurFilter2.dispose()}}]),n}();BFN.effects.TouchUpEffect=new kd;var Nd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.colorMixerFilter=BFN.ShaderPool.ColorMixerFilter,this.pluginName="filter_renderer"}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){this.colorMixerFilter.red=t.red,this.colorMixerFilter.green=t.green,this.colorMixerFilter.blue=t.blue,this.colorMixerFilter.bw=t.bw?1:0,this.bfn_shaders=[this.colorMixerFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();BFN.effects.ColorMixerEffect=new Nd;var Md=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.softenFilter=new BFN.filters.SoftenFilter,this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=null,this.currentSoftness=null}},{key:"applyEffect",value:function(e,t){this.softenFilter.lightness=t.lightness,this.currentSoftness!=t.softness&&(this.blurTexture=this.blurFilter.render(t.softness/200,this.sourceTexture),this.currentSoftness=t.softness),this.softenFilter.blurImage=this.blurTexture,this.filters=[this.softenFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.currentSoftness=null,this.blurFilter.dispose()}}]),n}();BFN.effects.SoftenEffect=new Md;var Dd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.smoothingFilter=new BFN.filters.SmoothingFilter,this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=this.blurFilter.render(.9,this.sourceTexture),this.smoothingFilter.blurImage=this.blurTexture}},{key:"applyEffect",value:function(e,t){this.smoothingFilter.amount=t.smoothing_amount/100,this.filters=[this.smoothingFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.blurFilter.dispose()}}]),n}();BFN.effects.SmoothingEffect=new Dd;var wd=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurEdgesFilter=new BFN.filters.BlurEdgesFilter,this.blurTexture=null}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.blurTexture=null,this.currentBlurAmount=null}},{key:"applyEffect",value:function(e,t){this.blurEdgesFilter.size=t.edge_size,this.blurEdgesFilter.shift_vertical=t.shift_vertical,this.blurEdgesFilter.shift_horizontal=t.shift_horizontal,this.currentBlurAmount!=t.blur_amount&&(this.blurTexture=this.blurFilter.render(t.blur_amount/100,this.sourceTexture),this.currentBlurAmount=t.blur_amount),this.blurEdgesFilter.blurImage=this.blurTexture,this.filters=[this.blurEdgesFilter]}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurTexture&&(this.blurTexture=null),this.currentBlurAmount=null,this.blurFilter.dispose()}}]),n}();BFN.effects.BlurEdgesEffect=new wd;var Ld=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!0),this.blurTexture=null,this.bwFilter=new BFN.filters.BlackWhiteFilter(BFN.CONST.BLACK_WHITE_PRESETS.PRESET_4),this.averageColor=null,this.aeFilter=new BFN.filters.AutoEnhanceFilter,this.aeTexture=null,this._filter=new BFN.filters.AlphaBlendFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t,n){if(this.resolution=e,this.parameters=t,null==this.blurTexture&&(this.blurAmount=.25,this.blurTexture=this.blurFilter.render(this.blurAmount,this.sourceTexture)),null==this.averageColor){this.setupAverageColor(),this.aeFilter.blurSampler=this.blurTexture,this.aeFilter.averageColor=this.averageColor,this.aeTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);var i=new PIXI.Sprite;i.texture=this.sourceTexture,i.filters=[this.aeFilter],BFN.Stage.render(i,this.aeTexture),i.texture=null,i=null}this._filter.intensity=t.intensity/100,this._filter.topImage=this.aeTexture,this.filters=[this._filter]}},{key:"setupAverageColor",value:function(){var e=Math.min(1,512/this.sourceTexture.width,512/this.sourceTexture.height),t=PIXI.RenderTexture.create(Math.floor(this.sourceTexture.width*e),Math.floor(this.sourceTexture.height*e)),n=new PIXI.Sprite;n.scale.x=e,n.scale.y=e,n.texture=this.sourceTexture,n.filters=[this.bwFilter],BFN.Stage.render(n,t),this.averageColor=BFN.Util.getTextureAverageColor(t,!1,!0,!0,!0),t.destroyGC(!0),t=null,n.texture=null,n=null}},{key:"disposeTexture",value:function(e){this[e]&&null!=this[e]&&(this[e].destroyGC(!0),this[e]=null)}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.disposeTexture("aeTexture"),this.averageColor=null,this.blurTexture=null,this.blurFilter.dispose()}}]),n}();BFN.effects.AutoEnhanceEffect=new Ld;var Od=function(e){u(n,PIXI.Sprite);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).initialized=!1,e}return a(n,[{key:"initEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.helperSize=1024,this.helperSprite=new PIXI.Sprite,this.glowSize=0,this.glintSize=0,this.tolerance=0,this.saturation=0,this.tintColor=-1,this.intensityMode="normal",this.applied=!1,this.overlayContainer=new PIXI.Container,this.addChild(this.overlayContainer),this.overlaySprite=new PIXI.Sprite,this.overlayContainer.addChild(this.overlaySprite),this.overlaySpriteX=new PIXI.Sprite,this.overlayContainer.addChild(this.overlaySpriteX),this.overlaySpriteY=new PIXI.Sprite,this.overlayContainer.addChild(this.overlaySpriteY),this.glowPrepFilter=new BFN.filters.GlowPrepFilter,this.glowPostFilter=new BFN.filters.GlowPostFilter,this.glowBlurFilter=new BFN.filters.GaussianBlurFilter,this.glintBlurFilter=new BFN.filters.GaussianBlurFilter}},{key:"setupEffect",value:function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.helperTexture||(this.helperTexture=PIXI.RenderTexture.create(this.helperSize,this.helperSize),this.helperTexture.fillColor(0)),this.overlayTexture||(this.overlayTexture=this.helperTexture.renderClone(),this.overlaySprite.texture=this.overlayTexture),this.overlayTextureX||(this.overlayTextureX=this.helperTexture.renderClone(),this.overlaySpriteX.texture=this.overlayTextureX),this.overlayTextureY||(this.overlayTextureY=this.helperTexture.renderClone(),this.overlaySpriteY.texture=this.overlayTextureY);var t=Math.atan2(this.sourceTexture.height,this.sourceTexture.width)-Math.PI/4,n=Math.sqrt(Math.pow(this.sourceTexture.width,2)+Math.pow(this.sourceTexture.height,2)),i=Math.max(Math.cos(t)*n,Math.sin(t)*n),r=this.helperSize/i;this.helperSprite=new PIXI.Sprite(this.sourceTexture),this.helperSprite.rotation=-Math.PI/4,this.helperSprite.scale.x=this.helperSprite.scale.y=r,this.helperSprite.y=this.helperSize+Math.sin(this.helperSprite.rotation)*this.sourceTexture.height*r,this.helperSprite.filters=[],BFN.Stage.render(this.helperSprite,this.helperTexture,!1),this.helperSprite.texture=this.helperTexture,this.helperSprite.filters=[this.glowPrepFilter,this.glowBlurFilter],this.overlaySprite.anchor.y=this.helperSprite.y/this.helperSize,this.overlaySprite.rotation=Math.PI/4,this.overlaySprite.scale.x=this.overlaySprite.scale.y=1/r,this.overlaySpriteX.anchor.y=this.helperSprite.y/this.helperSize,this.overlaySpriteX.rotation=Math.PI/4,this.overlaySpriteX.scale.x=this.overlaySpriteX.scale.y=1/r,this.overlaySpriteY.anchor.y=this.helperSprite.y/this.helperSize,this.overlaySpriteY.rotation=Math.PI/4,this.overlaySpriteY.scale.x=this.overlaySpriteY.scale.y=1/r,this.helperSprite.rotation=0,this.helperSprite.scale.x=this.helperSprite.scale.y=1,this.helperSprite.y=0,this.texture=this.sourceTexture}},{key:"applyEffect",value:function(e,t){var n=t.intensity_mode;this.intensityMode==n&&this.applied||(this.intensityMode=n,this.overlaySprite.blendMode="intense"==n?PIXI.BLEND_MODES.ADD:PIXI.BLEND_MODES.SCREEN,this.overlaySpriteX.blendMode="intense"==n?PIXI.BLEND_MODES.ADD:PIXI.BLEND_MODES.SCREEN,this.overlaySpriteY.blendMode="intense"==n?PIXI.BLEND_MODES.ADD:PIXI.BLEND_MODES.SCREEN);var i=100-t.tolerance,r=t.saturation,a=t.tint_color;this.tolerance==i&&this.saturation==r&&this.tintColor==a&&this.applied||(this.tolerance=i,this.saturation=r,this.tintColor=a,this.glowPrepFilter.minInput=(i-50)/50*.15+.8,this.glowPrepFilter.maxInput=this.glowPrepFilter.minInput+.05,this.glowPrepFilter.saturation=0,this.glowPrepFilter.tint=a,this.applied=!1);var o=t.glow_size/100;this.overlaySprite.visible=t.glow_size>0,this.overlaySprite.alpha=(o+Math.sin(o*(Math.PI/2)))/2,o>0&&(this.glowSize!=o||!this.applied)&&(this.glowSize=o,this.helperSprite.filters=[this.glowPrepFilter,this.glowPostFilter,this.glowBlurFilter],this.glowBlurFilter.setInputDimensions(this.helperTexture.width,this.helperTexture.height),this.glowBlurFilter.blur=o,this.glowBlurFilter.oneDirection=null,BFN.Stage.render(this.helperSprite,this.overlayTexture));var s=t.glint_size/100;this.overlaySpriteX.visible=this.overlaySpriteY.visible=t.glint_size>0,this.overlaySpriteX.alpha=this.overlaySpriteY.alpha=(s+Math.sin(s*(Math.PI/2)))/2,s>0&&(this.glintSize!=s||!this.applied)&&(this.glintSize=s,this.helperSprite.filters=[this.glowPrepFilter,this.glowPostFilter,this.glintBlurFilter],this.glintBlurFilter.setInputDimensions(this.helperTexture.width,this.helperTexture.height),this.glintBlurFilter.blur=s,this.glintBlurFilter.oneDirection="x",BFN.Stage.render(this.helperSprite,this.overlayTextureX),this.glintBlurFilter.oneDirection="y",BFN.Stage.render(this.helperSprite,this.overlayTextureY)),this.overlayContainer.alpha=t.intensity/100,this.applied=!0}},{key:"disposeEffect",value:function(){this.sourceTexture=null,this.isSetup=!1,this.glowSize=0,this.glintSize=0,this.tolerance=0,this.saturation=0,this.tintColor=-1,this.intensityMode="normal",this.applied=!1,this.helperSprite.filters=[],this.helperTexture&&(this.helperTexture.destroyGC(!0),delete this.helperTexture),this.overlayTextureX&&(this.overlayTextureX.destroyGC(!0),delete this.overlayTextureX),this.overlaySpriteX.texture=PIXI.Texture.EMPTY,this.overlayTextureY&&(this.overlayTextureY.destroyGC(!0),delete this.overlayTextureY),this.overlaySpriteY.texture=PIXI.Texture.EMPTY,this.texture=PIXI.Texture.EMPTY,this.filters=null}}]),n}();function Rd(){PIXI.Sprite.call(this),this.initialized=!1}function Ad(){PIXI.Sprite.call(this),this.initialized=!1}function Vd(){PIXI.Sprite.call(this),this.initialized=!1}function Ud(){PIXI.Sprite.call(this),this.initialized=!1}BFN.effects.GlowEffect=new Od,Rd.prototype=Object.create(PIXI.Sprite.prototype),Rd.prototype.initEffect=function(){this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.useVariations=!0,this.bokehBlurFilter=null,this.bokehBlurFilterFull=null,this.bokehPass=0,this.bokehPasses=0,this.delaying=!1,this.validBokehBladeCounts=[3,4,5,6,7,8,9],this.primeBokehBlurFilters={},this.filterSprite=new PIXI.Sprite,this.plainFilter=null,this.bokehBGBlurFilter=null,this.bokehGentleBlurFilter=null,this.bgBlurApplied=!1,this.gentleBlurApplied=!1,this.bokehBlurApplied=!1,this.emptyTexture=PIXI.RenderTexture.create(2,2),this.emptyTexture.clear(),this.handleImagePainterPaintUpdatedBind=this.handleImagePainterPaintUpdated.bind(this)},Rd.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.countdown=0},Rd.prototype.applyEffect=function(e,t){var n=this;this.resolution=e,this.parameters=t;var i=parseInt(t.hasOwnProperty("blade_count")?t.blade_count:6);if((this.validBokehBladeCounts.includes(i)||this.sourceTexture)&&!this.delaying){var r=function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;t&&(n.countdown=i),n.delaying=!0,BFN.EffectManager.manageLoadScreen=!1,UIToggler.toggleLoadScreen(!0),requestAnimationFrame(function(){--n.countdown>0?e(!1):(n.delaying=!1,UIToggler.toggleLoadScreen(!1),BFN.EffectManager.manageLoadScreen=!0,BFN.EffectManager.currentEffect==n&&BFN.EffectManager.processEffect())})};if(!this.texturesBuilt){this.texturesBuilt=!0;var a=Math.max(this.sourceTexture.width,this.sourceTexture.height);return this.bokehScaleFactor=1024/a,this.bokehSourceW=Math.round(this.sourceTexture.width*this.bokehScaleFactor),this.bokehSourceH=Math.round(this.sourceTexture.height*this.bokehScaleFactor),this.bokehSourceTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bokehSourceTexture.copyPixels(this.sourceTexture,null,null,null,{x:this.bokehSourceW/this.sourceTexture.width,y:this.bokehSourceH/this.sourceTexture.height}),this.bokehSourceSprite=new PIXI.Sprite(this.bokehSourceTexture),this.bgBlurRenderTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bgBlurRenderTexture.clear(),this.gentleBlurRenderTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.gentleBlurRenderTexture.clear(),this.bokehRenderTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bokehRenderTexture.clear(),this.bokehEraserTexture=PIXI.RenderTexture.create(this.bokehSourceW,this.bokehSourceH),this.bokehEraserTexture.clear(),this.effectRenderTexture=this.sourceTexture.renderClone(),this.texture=this.effectRenderTexture,void r(!0,1)}var o=!1;if(this.plainFilter?this.bokehBGBlurFilter?this.bokehGentleBlurFilter?this.useVariations||this.bokehBlurFilterFull?this.useVariations&&!this.primeBokehBlurFilters.hasOwnProperty(i)&&(this.primeBokehBlurFilters[i]=new BFN.filters.BokehBlurFilter("X"+i),o=!0):(this.bokehBlurFilterFull=new BFN.filters.BokehBlurFilter,o=!0):(this.bokehGentleBlurFilter=new BFN.filters.BokehGentleBlurFilter,o=!0):(this.bokehBGBlurFilter=new BFN.filters.BokehBGBlurFilter,o=!0):(this.plainFilter=new BFN.filters.PlainFilter,o=!0),o)r();else{var s=function(){""===n.bokehBlurFilter.variation?(n.bokehPasses=t.hasOwnProperty("passes")?t.passes:1,n.bokehBlurFilter.uniforms.pass1Radius=t.hasOwnProperty("pass1Radius")?t.pass1Radius:1,n.bokehBlurFilter.uniforms.pass1Layers=t.hasOwnProperty("pass1Layers")?t.pass1Layers:1,n.bokehBlurFilter.uniforms.pass2Radius=t.hasOwnProperty("pass2Radius")?t.pass2Radius:50,n.bokehBlurFilter.uniforms.pass2Layers=t.hasOwnProperty("pass2Layers")?t.pass2Layers:4,n.bokehBlurFilter.uniforms.pass3Radius=t.hasOwnProperty("pass3Radius")?t.pass3Radius:20,n.bokehBlurFilter.uniforms.pass3Layers=t.hasOwnProperty("pass3Layers")?t.pass3Layers:3,n.bokehBlurFilter.uniforms.pass4Radius=t.hasOwnProperty("pass4Radius")?t.pass4Radius:8.5,n.bokehBlurFilter.uniforms.pass4Layers=t.hasOwnProperty("pass4Layers")?t.pass4Layers:2):n.bokehPasses=4},l=this.useVariations?this.primeBokehBlurFilters[i]:this.bokehBlurFilterFull;l&&this.bokehBlurFilter!==l?(this.bokehBlurFilter&&this.bokehBlurFilter.maskTexture!==l.emptyTexture&&(this.bokehBlurFilter.maskTexture=this.emptyTexture,this.bokehBGBlurFilter.maskTexture=this.emptyTexture,this.bokehGentleBlurFilter.maskTexture=this.emptyTexture),this.bokehBlurFilter=l,this.bokehEraserTexture&&(this.bokehBlurFilter.maskTexture=this.bokehEraserTexture,this.bokehBGBlurFilter.maskTexture=this.bokehEraserTexture,this.bokehGentleBlurFilter.maskTexture=this.bokehEraserTexture),this.bokehSourceW&&this.bokehSourceH&&(this.bokehBlurFilter.dimensions=[this.bokehSourceW,this.bokehSourceH],this.bokehBGBlurFilter.dimensions=[this.bokehSourceW,this.bokehSourceH],this.bokehGentleBlurFilter.dimensions=[this.bokehSourceW,this.bokehSourceH]),s()):l||this.bokehBlurFilter||(this.bokehBlurFilter=new BFN.filters.BokehBlurFilter,s()),this.listening||(this.listening=!0,BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.addEventListener(BFN.ImageEffectEvents.INVERSE_PAINT.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.addEventListener(BFN.ImageEffectEvents.CLEAR_PAINT.type,this.handleImagePainterPaintUpdatedBind));!function(){var e=t.hasOwnProperty("blur_amount")?t.blur_amount/100:1;if(e>0){if(!n.bgBlurApplied)return n.bgBlurApplied=!0,n.filterSprite.texture=n.bokehSourceTexture,n.bokehBGBlurFilter.amount=e,n.bokehBGBlurFilter.maskTextureInverted=BFN.ImageEffect.inverse,n.filterSprite.filters=[n.bokehBGBlurFilter],BFN.Stage.render(n.filterSprite,n.bgBlurRenderTexture),void r(!0,1);if(!n.gentleBlurApplied)return n.gentleBlurApplied=!0,n.filterSprite.texture=n.bokehSourceTexture,n.bokehGentleBlurFilter.mode=1,n.bokehGentleBlurFilter.amount=e,n.bokehGentleBlurFilter.large=!1,n.bokehGentleBlurFilter.bgTexture=n.emptyTexture,n.bokehGentleBlurFilter.threshold=t.hasOwnProperty("bokeh_intensity")?18*(1-t.bokeh_intensity/100)+2:11,n.bokehGentleBlurFilter.intensity=t.hasOwnProperty("bokeh_intensity")?t.bokeh_intensity/100:.5,n.bokehGentleBlurFilter.maskTextureInverted=BFN.ImageEffect.inverse,n.filterSprite.filters=[n.bokehGentleBlurFilter],BFN.Stage.render(n.filterSprite,n.gentleBlurRenderTexture),void r(!0,1);if(n.bokehBlurApplied||(n.bokehBlurApplied=!0,n.flip=n.gentleBlurRenderTexture,n.flop=n.bokehRenderTexture,n.bokehPass=0,n.bokehBlurFilter.amount=e,n.bokehBlurFilter.aperture=t.hasOwnProperty("blade_curvature")?t.blade_curvature/100:1,n.bokehBlurFilter.bladeCount=t.hasOwnProperty("blade_count")?t.blade_count:6,n.bokehBlurFilter.maskTextureInverted=BFN.ImageEffect.inverse),n.bokehPass<n.bokehPasses){n.filterSprite.texture=n.flip,n.bokehBlurFilter.currentPass=n.bokehPass++,n.filterSprite.filters=[n.bokehBlurFilter],BFN.Stage.render(n.filterSprite,n.flop);var i=n.flop;return n.flop=n.flip,n.flip=i,void r(!0,1)}n.bokehGentleBlurFilter.mode=2,n.bokehGentleBlurFilter.large=!0,n.bokehGentleBlurFilter.bgTexture=n.bgBlurRenderTexture,n.filterSprite.texture=n.flip,n.filterSprite.filters=[n.bokehGentleBlurFilter],BFN.Stage.render(n.filterSprite,n.flop);var a=n.flop;n.flop=n.flip,n.flip=a,n.bokehGentleBlurFilter.mode=0,n.bokehGentleBlurFilter.large=!0,n.bokehGentleBlurFilter.bgTexture=n.emptyTexture;for(var o=0;o<2;o++){n.filterSprite.texture=n.flip,BFN.Stage.render(n.filterSprite,n.flop);var s=n.flop;n.flop=n.flip,n.flip=s}n.effectRenderTexture.copyPixels(n.flip,null,null,null,{x:n.effectRenderTexture.width/n.bokehSourceW,y:n.effectRenderTexture.height/n.bokehSourceH}),n.bgBlurApplied=!1,n.gentleBlurApplied=!1,n.bokehBlurApplied=!1}else n.effectRenderTexture.copyPixels(n.sourceTexture)}()}}},Rd.prototype.handleImagePainterPaintUpdated=function(e){if(BFN.ImagePainterUndoManager.imagePainter&&BFN.ImagePainterUndoManager.imagePainter.texture&&this.bokehEraserTexture){var t=BFN.ImagePainterUndoManager.imagePainter.texture;this.bokehEraserTexture.copyPixels(t,null,null,null,{x:this.bokehEraserTexture.width/t.width,y:this.bokehEraserTexture.height/t.height}),UITools.applyTool("lens_blur")}},Rd.prototype.disposeEffect=function(){this.sourceTexture=null,this.isSetup=!1,this.bokehBlurFilter&&(this.bokehBlurFilter.maskTexture=this.emptyTexture),this.bokehBlurFilter=null;try{this.bokehSourceTexture.destroyGC(!0)}catch(e){}this.bokehSourceTexture=null;try{this.bgBlurRenderTexture.destroyGC(!0)}catch(e){}this.bgBlurRenderTexture=null;try{this.gentleBlurRenderTexture.destroyGC(!0)}catch(e){}this.gentleBlurRenderTexture=null;try{this.bokehRenderTexture.destroyGC(!0)}catch(e){}this.bokehRenderTexture=null,this.flip=null,this.flop=null;try{this.bokehEraserTexture.destroyGC(!0)}catch(e){}this.bokehEraserTexture=null;try{this.effectRenderTexture.destroyGC(!0)}catch(e){}this.effectRenderTexture=null,this.texture=PIXI.Texture.EMPTY;try{this.bokehSourceSprite.filters=[],this.bokehSourceSprite.destroy(!1)}catch(e){}this.bokehSourceSprite=null,this.texturesBuilt=!1,BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.removeEventListener(BFN.ImageEffectEvents.INVERSE_PAINT.type,this.handleImagePainterPaintUpdatedBind),BFN.ImageEffect.removeEventListener(BFN.ImageEffectEvents.CLEAR_PAINT.type,this.handleImagePainterPaintUpdatedBind),this.listening=!1},BFN.effects.BokehBlurEffect=new Rd,Ad.prototype=Object.create(PIXI.Sprite.prototype),Ad.prototype.initEffect=function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filters={},BFN.CONST.CINEMATIC_PRESETS)switch(BFN.CONST.CINEMATIC_PRESETS[e]){case BFN.CONST.CINEMATIC_PRESETS.FILM_GRAIN:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.GrainFilter;break;case BFN.CONST.CINEMATIC_PRESETS.COLOR_GRADING:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.ColorGradingFilter;break;case BFN.CONST.CINEMATIC_PRESETS.ANAMORPHIC:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.AnamorphicFilter;break;case BFN.CONST.CINEMATIC_PRESETS.LENS_DISTORTION:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.LensDistortionFilter;break;case BFN.CONST.CINEMATIC_PRESETS.WARPED_BLUR:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.WarpedBlurFilter;break;case BFN.CONST.CINEMATIC_PRESETS.CHROMATIC_ABERRATION:this.__filters[BFN.CONST.CINEMATIC_PRESETS[e]]=new BFN.filters.ChromaticAberrationFilter}this.filmGrainSeed=1},Ad.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture,this.filmGrainSeed++},Ad.prototype.applyEffect=function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID],r=[i];switch(this.currentPresetID){case BFN.CONST.CINEMATIC_PRESETS.FILM_GRAIN:i.intensity=t.hasOwnProperty("intensity")?t.intensity/800:.1,i.distribution=4,"generate"===t.updating_id&&this.filmGrainSeed++,i.seed=this.filmGrainSeed,i.monochromatic=!!t.hasOwnProperty("monochromatic")&&t.monochromatic;break;case BFN.CONST.CINEMATIC_PRESETS.COLOR_GRADING:i.shadowColor=t.hasOwnProperty("shadows")?t.shadows:"000000",i.midtoneColor=t.hasOwnProperty("midtones")?t.midtones:"808080",i.highlightColor=t.hasOwnProperty("highlights")?t.highlights:"FFFFFF",i.shadowIntensity=t.hasOwnProperty("shadows_intensity")?t.shadows_intensity:1,i.midtoneIntensity=t.hasOwnProperty("midtones_intensity")?t.midtones_intensity:1,i.highlightIntensity=t.hasOwnProperty("highlights_intensity")?t.highlights_intensity:1;break;case BFN.CONST.CINEMATIC_PRESETS.ANAMORPHIC:i.stretch=t.hasOwnProperty("stretch")?t.stretch/100:1,i.distortion=t.hasOwnProperty("distortion")?t.distortion/100:1,i.vignetteOpacity=t.hasOwnProperty("vignette_opacity")?t.vignette_opacity/200:.5,i.edgeBlur=t.hasOwnProperty("edge_blur")?t.edge_blur/400:.25,i.dimensions=[this.sourceTexture.width,this.sourceTexture.height];break;case BFN.CONST.CINEMATIC_PRESETS.LENS_DISTORTION:i.distortion=t.hasOwnProperty("distortion")?t.distortion/100:.5,i.dimensions=[this.sourceTexture.width,this.sourceTexture.height];break;case BFN.CONST.CINEMATIC_PRESETS.WARPED_BLUR:i.strength=t.hasOwnProperty("blur_amount")?t.blur_amount/100:1,i.phase=t.hasOwnProperty("phase")?t.phase/10:0,i.scale=t.hasOwnProperty("scale")?t.scale/100:1,i.lightness=t.hasOwnProperty("lightness")?t.lightness/100:0,i.dimensions=[this.sourceTexture.width,this.sourceTexture.height],i.mapDimensions=[BFN.FilterHelper.getNextPowerOfTwo(this.sourceTexture.width),BFN.FilterHelper.getNextPowerOfTwo(this.sourceTexture.height)];break;case BFN.CONST.CINEMATIC_PRESETS.CHROMATIC_ABERRATION:i.distortion=t.hasOwnProperty("distortion")?t.distortion/100:.5,i.focalPointX=t.hasOwnProperty("focal_point_x")?t.focal_point_x/100:.5,i.focalPointY=t.hasOwnProperty("focal_point_y")?t.focal_point_y/100:.5,i.dimensions=[this.sourceTexture.width,this.sourceTexture.height]}this.filters=r}},Ad.prototype.disposeEffect=function(){this.sourceTexture=null,this.isSetup=!1;try{this.__filters[this.currentPresetID].dispose()}catch(e){}this.currentPresetID=null},BFN.effects.CinematicEffect=new Ad,Vd.prototype=Object.create(PIXI.Sprite.prototype),Vd.prototype.initEffect=function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filters={},BFN.CONST.MULTIMEDIA_PRESETS)switch(BFN.CONST.MULTIMEDIA_PRESETS[e]){case BFN.CONST.MULTIMEDIA_PRESETS.SCAN_LINES:this.__filters[BFN.CONST.MULTIMEDIA_PRESETS[e]]=new BFN.filters.ScanLinesFilter;break;case BFN.CONST.MULTIMEDIA_PRESETS.TELEVISION:this.__filters[BFN.CONST.MULTIMEDIA_PRESETS[e]]=new BFN.filters.TelevisionFilter;break;case BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO:this.__filters[BFN.CONST.MULTIMEDIA_PRESETS[e]]=new BFN.filters.HalftoneDuoFilter}this.halftoneDuoSrc=null},Vd.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture;var t=Math.max(1,Math.min(Math.floor(BFN.minImageSize/2),Math.round(this.sourceTexture.height/240)));UITools.setToolValue("cinematic_scan_lines","spacing",t),UITools.updateToolControls("cinematic_scan_lines"),this.halftoneDensity=-1},Vd.prototype.applyEffect=function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID],r=[i];switch(this.currentPresetID){case BFN.CONST.MULTIMEDIA_PRESETS.SCAN_LINES:i.lineColor=t.hasOwnProperty("line_color")?t.line_color:"000000",i.opacity=t.hasOwnProperty("opacity")?t.opacity/100:.5,i.spacing=t.hasOwnProperty("spacing")?t.spacing:.2,i.invert=!!t.hasOwnProperty("invert")&&t.invert;break;case BFN.CONST.MULTIMEDIA_PRESETS.TELEVISION:var a=Math.max(2,Math.floor(this.sourceTexture.width/800));i.pixelSize=a,i.dimensions=[this.sourceTexture.width,this.sourceTexture.height];break;case BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO:if(this.halftoneDuoSrc||(this.halftoneDuoSrc=PIXI.RenderTexture.create(128,128)),t.hasOwnProperty("density")&&t.density!=this.halftoneDensity){this.halftoneDensity=t.density;var o=(this.halftoneDensity-1)/99,s=(n?75:450*o+50)/Math.max(this.sourceTexture.width,this.sourceTexture.height);this.halftoneDuoSrc.resize(Math.round(this.sourceTexture.width*s),Math.round(this.sourceTexture.height*s)),this.halftoneDuoSrc.copyPixels(this.sourceTexture,null,!0,1,{x:this.halftoneDuoSrc.width/this.sourceTexture.width,y:this.halftoneDuoSrc.height/this.sourceTexture.height}),i.src=this.halftoneDuoSrc,i.srcDimensions=[this.halftoneDuoSrc.width,this.halftoneDuoSrc.height]}i.tolerance=t.hasOwnProperty("tolerance")?t.tolerance/100:.5,i.shadowColor=t.hasOwnProperty("shadow_color")?t.shadow_color:"000000",i.highlightColor=t.hasOwnProperty("highlight_color")?t.highlight_color:"FFFFFF",i.invertColors=!!t.hasOwnProperty("invert")&&t.invert,i.dimensions=[this.sourceTexture.width,this.sourceTexture.height]}this.filters=r}},Vd.prototype.disposeEffect=function(){switch(this.sourceTexture=null,this.isSetup=!1,this.currentPresetID){case BFN.CONST.MULTIMEDIA_PRESETS.HALFTONE_DUO:try{this.halftoneDuoSrc.destroyGC(!0)}catch(e){}this.halftoneDuoSrc=null}try{this.__filters[this.currentPresetID].dispose()}catch(e){}this.currentPresetID=null},BFN.effects.MultimediaEffect=new Vd,Ud.prototype=Object.create(PIXI.Sprite.prototype),Ud.prototype.initEffect=function(){for(var e in this.sourceTexture=null,this.isSetup=!1,this.uiControls=new Array,this.__filters={},BFN.CONST.GLITCH_ART_PRESETS)switch(BFN.CONST.GLITCH_ART_PRESETS[e]){case BFN.CONST.GLITCH_ART_PRESETS.CORRUPTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchCorruptedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.DISTORTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchDistortedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.SEGMENTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchSegmentedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.FRAGMENTED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchFragmentedFilter;break;case BFN.CONST.GLITCH_ART_PRESETS.DIGITIZED:this.__filters[BFN.CONST.GLITCH_ART_PRESETS[e]]=new BFN.filters.GlitchDigitizedFilter}},Ud.prototype.setupEffect=function(e){this.initialized||(this.initialized=!0,this.initEffect()),this.disposeEffect(),this.sourceTexture=e,this.isSetup=!0,this.texture=this.sourceTexture},Ud.prototype.applyEffect=function(e,t,n){if(this.resolution=e,this.parameters=t,t.hasOwnProperty("presetID")&&this.__filters.hasOwnProperty(t.presetID)){this.currentPresetID=t.presetID;var i=this.__filters[this.currentPresetID],r=[i];switch(this.currentPresetID){case BFN.CONST.GLITCH_ART_PRESETS.CORRUPTED:i.setDimensions(this.sourceTexture.width,this.sourceTexture.height),i.seed!==t.phase&&(i.seed=parseInt(t.phase),i.drawGlitchSource()),i.strength=t.hasOwnProperty("strength")?t.strength/100:.5;var a="000"+(t.hasOwnProperty("complexity")?(parseInt(t.complexity)-1).toString(2):"");a=a.substring(a.length-3,a.length),i.vShift=parseInt(a[2]),i.noise=parseInt(a[1]),i.chromatic=parseInt(a[0]);break;case BFN.CONST.GLITCH_ART_PRESETS.DISTORTED:i.setSourceTexture(this.sourceTexture),i.grayscale=t.hasOwnProperty("grayscale")?parseInt(t.grayscale):1,i.phase=t.hasOwnProperty("phase")?t.phase/100:0,i.length=t.hasOwnProperty("length")?t.length/100:.2,i.horizontal=t.hasOwnProperty("slide_horizontal")?t.slide_horizontal/100:.2;break;case BFN.CONST.GLITCH_ART_PRESETS.SEGMENTED:i.setDimensions(this.sourceTexture.width,this.sourceTexture.height),i.grayscale=t.hasOwnProperty("grayscale")?parseInt(t.grayscale):0,i.horizontal=t.hasOwnProperty("slide_horizontal")?t.slide_horizontal/100:.1,i.vertical=t.hasOwnProperty("slide_vertical")?t.slide_vertical/100:.1,i.colorCycle=t.hasOwnProperty("colors")?parseInt(t.colors):0;break;case BFN.CONST.GLITCH_ART_PRESETS.FRAGMENTED:i.setSourceTexture(this.sourceTexture),i.grayscale=t.hasOwnProperty("grayscale")?parseInt(t.grayscale):0,i.highlights=t.hasOwnProperty("highlights")?t.highlights/100:.5,i.offset=t.hasOwnProperty("offset")?t.offset/100:.5;break;case BFN.CONST.GLITCH_ART_PRESETS.DIGITIZED:i.setSourceTexture(this.sourceTexture),i.colorValue=t.hasOwnProperty("color_picker")?t.color_picker:-1,i.highlights=t.hasOwnProperty("highlights")?t.highlights/100:.5,i.weight=t.hasOwnProperty("weight")?t.weight/100:.5,i.horizontal=t.hasOwnProperty("slide_horizontal")?t.slide_horizontal/100:.5}this.filters=r}},Ud.prototype.disposeEffect=function(){switch(this.sourceTexture=null,this.isSetup=!1,this.currentPresetID){case BFN.CONST.GLITCH_ART_PRESETS.GLITCH:try{this.__filters[this.currentPresetID].clearGlitchSource()}catch(e){}break;case BFN.CONST.GLITCH_ART_PRESETS.GLITCH_BW:case BFN.CONST.GLITCH_ART_PRESETS.CYBER_SPACE:try{this.__filters[this.currentPresetID].resetSourceTexture()}catch(e){}}try{this.__filters[this.currentPresetID].dispose()}catch(e){}this.currentPresetID=null},BFN.effects.GlitchArtEffect=new Ud,BFN.effectMap={},BFN.effectMap.analog="AnalogEffect",BFN.effectMap.bwfx="AnalogEffect",BFN.effectMap.warmfx="AnalogEffect",BFN.effectMap.clarity="ClarityEffect",BFN.effectMap.color="ColorEffect",BFN.effectMap.replace_color="ReplaceColorEffect",BFN.effectMap.exposure="ExposureEffect",BFN.effectMap.fill_light="FillLightEffect",BFN.effectMap.gauss_blur="GaussianBlurEffect",BFN.effectMap.blur="GaussianBlurEffect",BFN.effectMap.gray="GrayEffect",BFN.effectMap.desaturate="GrayEffect",BFN.effectMap.invert="InvertEffect",BFN.effectMap.levels="LevelsEffect",BFN.effectMap.sharpen="UnsharpMaskEffect",BFN.effectMap.vibrance="VibranceEffect",BFN.effectMap.vignette="VignetteEffect",BFN.effectMap.bw="BlackWhiteEffect",BFN.effectMap.chromatic="ChromaticEffect",BFN.effectMap.charcoal="CharcoalEffect",BFN.effectMap.cyanotype="CyanotypeEffect",BFN.effectMap.orton_style="OrtonStyleEffect",BFN.effectMap.sepia="SepiaEffect",BFN.effectMap.viewfinder="ViewFinderEffect",BFN.effectMap.summer="SummerEffect",BFN.effectMap.unitedcolors="UnitedColorsEffect",BFN.effectMap.instant="InstantEffect",BFN.effectMap.cooler="CoolingEffect",BFN.effectMap.warmer="WarmingEffect",BFN.effectMap.tinytype="TinyTypeEffect",BFN.effectMap.crossprocess="CrossProcessEffect",BFN.effectMap.vintagecolors="VintageColorsEffect",BFN.effectMap.holgaart="HolgaArtEffect",BFN.effectMap.lineartopia="LineArtopiaEffect",BFN.effectMap.hdr="HDREffect",BFN.effectMap.pinhole="PinholeEffect",BFN.effectMap.colorpinhole="ColorPinholeEffect",BFN.effectMap.stenciler="StencilerEffect",BFN.effectMap.grungefx="GrungeEffect",BFN.effectMap.sunburst="SunburstEffect",BFN.effectMap.oldphotofx="OldPhotoEffect",BFN.effectMap.winterfx="WinterEffect",BFN.effectMap.tiltshiftfx="TiltShiftEffect",BFN.effectMap.patrioticfx="PatrioticEffect",BFN.effectMap.popartfx="PopArtEffect",BFN.effectMap.tint="TintEffect",BFN.effectMap.beautify="BeautifyEffect",BFN.effectMap.motioncolor="MotionColorEffect",BFN.effectMap.lomoart="LomoArtEffect",BFN.effectMap.color_mixer="ColorMixerEffect",BFN.effectMap.soften="SoftenEffect",BFN.effectMap.smoothing="SmoothingEffect",BFN.effectMap.blur_edges="BlurEdgesEffect",BFN.effectMap.auto_enhance="AutoEnhanceEffect",BFN.effectMap.glow="GlowEffect",BFN.effectMap.lens_blur="BokehBlurEffect",BFN.effectMap.cinematic="CinematicEffect",BFN.effectMap.multimedia="MultimediaEffect",BFN.effectMap.glitch_art="GlitchArtEffect",BFN.effectMap.touchup="TouchUpEffect",BFN.effectPresetMap={},BFN.effectIDMap={},BFN.EffectData.forEach(function(e){var t=e.presets,n=e.id;t.forEach(function(e){var t=e.id;BFN.effectPresetMap["".concat(n,"_").concat(t)]=n,BFN.effectIDMap[t]=n})});var Gd=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){BeFunky.log("SentryManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.reportBreadcrumbs=!0,this.displayObjectRegistry={},this.unregisteredDisplayObjects=[],this.invalidSearchTypes=["RenderTexture","Texture","Graphics","Sprite","Container","DisplayObject"],this.validDisplayObjectTypes=["object","function"],this.customDisplayObjectRegistry={},this.topLevelDisplayObjectInstances=[],this.defaultDisplayObjectPropertyNames=null,this.purgeUnregisteredDisplayObjects=BeFunky.debounce(this.purgeUnregisteredDisplayObjects,2e3),this.handleDisplayObjectPointerDownBind=this.handleDisplayObjectPointerDown.bind(this)}},{key:"reportBreadcrumb",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas_interaction";if(BFN.reportAppBreadcrumbs&&"string"==typeof e&&"string"==typeof t&&"string"==typeof n){var i=BFN.AppModel.sectionValue("editor","collage","designer"),r=BFN.ZoomManager.getCanvasData(),a=r.canvasModel,o=r.canvasW,s=r.canvasH,l=["".concat(i,":").concat(o,"x").concat(s,"px@").concat(Math.round(100*a.canvasScale),"%")];t&&l.push(t),e&&l.push(e);var u=l.join(" : ");BeFunky.logFeature(n,u),this.reportBreadcrumbs&&window.Sentry&&Sentry.addBreadcrumb({category:n,message:u,level:Sentry.Severity.Info})}}},{key:"registerDisplayObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(BFN.reportAppBreadcrumbs&&e&&!(!e instanceof PIXI.DisplayObject)){var n=this.topLevelDisplayObjectInstances.includes(e);if(n&&(t=!1),!t||e.interactive){var i=this.unregisteredDisplayObjects.indexOf(e);if(i>=0&&this.unregisteredDisplayObjects.splice(i,1),e.breadcrumbKey&&this.displayObjectRegistry.hasOwnProperty(e.breadcrumbKey)){if(e===this.displayObjectRegistry[e.breadcrumbKey].object)return;delete e.breadcrumbKey}if(!e.breadcrumbKey)for(;e.breadcrumbKey=BeFunky.randomString(10),this.displayObjectRegistry.hasOwnProperty(e.breadcrumbKey););this.displayObjectRegistry[e.breadcrumbKey]={object:e},this.assignDisplayObjectClassName(e),(e.interactive||n)&&e.on("pointerdown",this.handleDisplayObjectPointerDownBind)}}}},{key:"unregisterDisplayObject",value:function(e){if(BFN.reportAppBreadcrumbs&&e&&!(!e instanceof PIXI.DisplayObject)&&e.breadcrumbKey&&(!e.breadcrumbKey||this.displayObjectRegistry.hasOwnProperty(e.breadcrumbKey))){var t=this.getDisplayObjectData(e);t.className&&this.customDisplayObjectRegistry[t.className]===e||this.unregisteredDisplayObjects.includes(e)||(this.unregisteredDisplayObjects.push(e),this.purgeUnregisteredDisplayObjects())}}},{key:"purgeUnregisteredDisplayObjects",value:function(){if(this.unregisteredDisplayObjects.length)for(;this.unregisteredDisplayObjects.length;){var e=this.unregisteredDisplayObjects.shift();e.off("pointerdown",this.handleDisplayObjectPointerDownBind),this.displayObjectRegistry.hasOwnProperty(e.breadcrumbKey)&&delete this.displayObjectRegistry[e.breadcrumbKey]}}},{key:"updateDisplayObjectPath",value:function(t){if(t&&"object"===e(t)&&!(!t instanceof PIXI.DisplayObject)){(!t.breadcrumbKey||t.breadcrumbKey&&!this.displayObjectRegistry.hasOwnProperty(t.breadcrumbKey))&&this.registerDisplayObject(t);var n=this.getDisplayObjectData(t);if(n&&!this.validateDisplayObjectPath(n)){for(var i=[],r=t;r;){this.registerDisplayObject(r);var a=this.assignDisplayObjectClassName(r);if(a&&(i.splice(0,0,{className:a,object:r}),this.customDisplayObjectRegistry[a]===r))break;r=r.parent||null}if(i.length){for(var o=0;o<i.length;o++){var s=i[o];s.displayPath=i.slice(0,o+1),o||(s.objectPath=[{key:"BFN",value:BFN},{key:s.className,value:s.object}])}for(var l=0;l<i.length-1;l++){var u=i[l].object;if(!this.invalidSearchTypes.includes(u.className))for(var c=l+1;c<i.length;c++)if(!i[c].objectPath){var h=i[c].object,d=this.findObjectPath(h,u,this.getDefaultDisplayObjectPropertyNames(),!0,1);d&&(i[c].objectPath=i[l].objectPath?i[l].objectPath.concat(d):d)}}for(var m=0;m<i.length;m++){var p=i[m];if(!p.objectPath&&p.object&&p.object.parent&&m>0){var g=i[m-1];if(g.objectPath){var f=g.object.children;p.objectPath=g.objectPath.concat([{key:"children",value:f},{key:f.indexOf(p.object),value:p.object}])}}var v=this.getDisplayObjectData(p.object);v.pathObjects=v&&p.objectPath?p.objectPath:null}this.validateDisplayObjectPath(n)}}}}},{key:"getDisplayObjectInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;t&&this.updateDisplayObjectPath(e);var i=this.getDisplayObjectData(e);if(t||i&&(!i||i.path)||(this.updateDisplayObjectPath(e),i=this.getDisplayObjectData(e)),i){var r=null;if(e instanceof BFN.TransformItem)r="".concat(e.itemInfo," ( BaseSize:").concat(e.textureDimensions," | LayerSize:").concat(e.itemDimensions," )");else if(e===BFN.TransformItemGroup)r="".concat(e.groupInfoLite," ( ").concat(e.groupDimensions," )");else if(e instanceof BFN.PhotoGridChild){var a="empty";if(e.content&&!e.content.isEmpty&&e.content.image){var o=e.content.image.texture;o&&o.baseTexture&&(a="".concat(o.baseTexture.width,"x").concat(o.baseTexture.height,"px"))}r="( ".concat(a," )")}var s=i.path;n="".concat(s||"*noparent*"," ( ").concat(i.className," )")+(r?" : "+r:""),s?e.displayObjectInfo=n:e.displayObjectInfo&&(n="*noparent* ".concat(e.displayObjectInfo))}else e.displayObjectInfo&&(n="*noparent* ".concat(e.displayObjectInfo));return n}},{key:"getDisplayObjectData",value:function(e){return e&&e.breadcrumbKey&&this.displayObjectRegistry[e.breadcrumbKey]?this.displayObjectRegistry[e.breadcrumbKey]:null}},{key:"validateDisplayObjectPath",value:function(e){if(!e)return!1;if(e.hasOwnProperty("pathObjects")){var t=e.pathObjects;if(!t)return!0;if(!t.length)return delete e.pathObjects,!1;for(var n=t[0].key,i=1;i<t.length;i++){var r=t[i-1],a=t[i],o=r.value instanceof Array&&!isNaN(parseInt(a.key));if(r.value[a.key]!==a.value){if(!o)return delete e.pathObjects,!1;var s=r.value.indexOf(a.value);-1!==s&&(a.key=s)}n+=o?"[".concat(a.key,"]"):".".concat(a.key)}return e.path!==n&&(e.path=n),!0}return!1}},{key:"assignDisplayObjectClassName",value:function(t){var n=this,i=this.getDisplayObjectData(t);if(!i)return null;if(i.className)return i.className;var r=function(){for(var i in n.customDisplayObjectRegistry){var r=n.customDisplayObjectRegistry[i];if("object"===e(r)&&t===r||"function"==typeof r&&t instanceof r)return i}return null},a=r();return a||(!function(){for(var t in BFN){var i=BFN[t];!n.customDisplayObjectRegistry.hasOwnProperty(t)&&i&&n.validDisplayObjectTypes.includes(e(i))&&(i instanceof PIXI.DisplayObject||i.prototype&&i.prototype instanceof PIXI.DisplayObject)&&(n.customDisplayObjectRegistry[t]=i,i instanceof PIXI.DisplayObject&&!n.topLevelDisplayObjectInstances.includes(i)&&n.topLevelDisplayObjectInstances.push(i))}}(),(a=r())||(a=t instanceof PIXI.Sprite?"Sprite":t instanceof PIXI.Container?"Container":"DisplayObject")),i.className=a,a}},{key:"getDefaultDisplayObjectPropertyNames",value:function(){if(!this.defaultDisplayObjectPropertyNames){this.defaultDisplayObjectPropertyNames=[];for(var e=[PIXI.DisplayObject,PIXI.Container,PIXI.Sprite,PIXI.Graphics],t=0;t<e.length;t++){var n=new(0,e[t]);for(var i in n)this.defaultDisplayObjectPropertyNames.hasOwnProperty(i)||this.defaultDisplayObjectPropertyNames.push(i)}}return this.defaultDisplayObjectPropertyNames}},{key:"findObjectPath",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;try{if("object"!==e(t)||"object"!==e(n)||a>0&&o>a)return null;i=i||[];var s=[Object,Array],l=null,u=null;for(var c in n)if(!i.includes(c)){var h=n[c];if(h&&"object"===e(h)&&(!(n.constructor&&n.constructor instanceof Array&&t.constructor)||h instanceof t.constructor)){if(h!==t||l||(l=[{key:c,value:h}]),l&&!r)return l;r&&"object"===e(h)&&s.includes(h.constructor)&&(u||(u={}),u[c]=h)}}if(r)for(var d in u){var m=u[d],p=this.findObjectPath(t,m,i,r,a,o+1);if(p)return[{key:d,value:m}].concat(v(p))}return l}catch(e){return null}}},{key:"getSpecialKeyString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(e&&e instanceof Object))return"";var t=[];return e.ctrlKey&&t.push("Ctrl"),e.metaKey&&t.push("Cmd"),e.altKey&&t.push("Alt"),e.shiftKey&&t.push("Shift"),t.length?" + "+t.join(" + "):""}},{key:"formatString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("string"!=typeof e)return"";var n=e.split("_").join(" ").split(" "),i=[];return n.forEach(function(e){i.push(e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())}),i.join(t)}},{key:"handleDisplayObjectPointerDown",value:function(e){if(e.target===e.currentTarget){var t="pointer_down",n="";if(e.data&&e.data.originalEvent){var i=e.data.originalEvent;2===i.button&&(t+="_right"),n=this.getSpecialKeyString(i)}t+=n,BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(e.target,!0),t)}}}]),t}();BFN.SingletonQueue.add(function(){BFN.SentryManager=new Gd});var Hd=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("ImageEditManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.editingImage=!1,this.targetViewstate=null,this.targetImageItem=null,this.targetMaskImageItem=null,this.targetGridCell=null,this.flattenedImage=null,this.handleAppModelViewStateChangedBind=this.handleAppModelViewStateChanged.bind(this),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.handleSourceImageUpdated.bind(this)),this.disregardSourceImageUpdate=!1,this.imageChangedWhileEditing=!1,this.backButton=document.getElementById("app_goto_edit_source_section"),this.backButtonText=this.backButton.querySelector("string"),this.animatingBackground=document.querySelector(".image-edit__bg"),this.animatingImage=document.querySelector(".image-edit__image"),this.secondaryPanel=document.getElementById("secondary-panel"),this.animatingImage.addEventListener("click",function(){e.targetViewstate&&(BFN.AppModel.viewState=e.targetViewstate)}),this.maxThumbSize=160,this.animatingImageRect={},this.animatingImageAppRect={},this.animatingImageObjectURL=null}},{key:"openImageInEditor",value:function(e){var t=this;if(e&&"texture"===e.type&&e.projectItemVO&&e.projectItemVO.imageID){var n=e.projectItemVO.imageID;if(!BFN.AppModel.sectionValue(null,"collage","designer"))return;UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"Opening image in Photo Editor"});var i=function(n){n instanceof Blob?(t.targetImageItem=e,t.goToEditor(n)):UIToggler.toggleLoadScreen(!1)};if(e.isShape)return void BFN.TextureUtils.textureToBlobWithErrorHandling(e.itemContent,{isTransparent:!0}).catch(function(e){return BeFunky.logError("Unable to convert SVG -> Blob for Open Image in Editor",e)}).then(i);BFN.ProjectService.getLocalAsset("image",n).catch(function(e){return BeFunky.logError("Unable to get asset from IndexedDB for Open Image in Editor",e)}).then(i)}}},{key:"openMaskImageInEditor",value:function(e){var t=this;if(e&&"frame_texture"===e.type&&e.projectItemVO&&e.projectItemVO.maskImageID){var n=e.projectItemVO.maskImageID;if(!BFN.AppModel.sectionValue(null,"collage","designer"))return;UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"opening_image_in_editor"}),BFN.ProjectService.getLocalAsset("image",n).catch(BeFunky.logError).then(function(n){n?(t.targetMaskImageItem=e,t.goToEditor(n)):UIToggler.toggleLoadScreen(!1)})}}},{key:"openGridCellInEditor",value:function(e){var t=this;if(e&&e.menuImageVO){var n=e.menuImageVO.id;UIToggler.toggleLoadScreen(!0,{isCancellable:!1,message:"opening_image_in_editor"});var i=function(n){n?(t.targetGridCell=e,t.goToEditor(n)):UIToggler.toggleLoadScreen(!1)};if(e.menuImageVO.isSVG)return void BFN.TextureUtils.textureToBlobWithErrorHandling(e.menuImageVO.imageTexture,{isTransparent:!0}).catch(function(e){return BeFunky.logError("Unable to convert SVG -> Blob for Open Image in Editor",e)}).then(i);BFN.ProjectService.getLocalAsset("image",n).catch(function(e){return BeFunky.logError("Unable to get asset from IndexedDB for Open Image in Editor",e)}).then(i)}}},{key:"goToEditor",value:function(e){var t=this;BFN.ProjectManager.autoSave.editor.allowAutoSave=!1,this.editingImage=!0,this.targetViewstate=BFN.AppModel.viewState,BFN.AppModel.viewingCollage?(BFN.BfnService.track("CREATE","COLLAGE","OPEN_IMAGE_EDITOR"),this.backButtonText.setLang("back_to_collage")):BFN.AppModel.viewingDesigner&&(BFN.BfnService.track("CREATE","DESIGNER","OPEN_IMAGE_EDITOR"),this.backButtonText.setLang("back_to_designer"));var n=!(!BFN.hasEnteredEditor||!BFN.PhotoEditorModel.currentTexture)||BFN.editorProjectShelved;BFN.editorProjectShelved=!1,this.transitionToEditor(function(i){BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,BFN.editorProjectShelved=n,UIToggler.toggleSampleImagePopover(!1),UITools.setToolValue("editor_main","edit",!1),UITools.applyTool("editor_main"),t.toggleFinishButton(!0),t.disregardSourceImageUpdate=!0,t.imageChangedWhileEditing=!1,BFN.PhotoEditorModel.loadBase64OrBlob(e,{filename:"BeFunky-layer",showLoadScreen:!1,callback:i,clearLocalAssets:!1})})}},{key:"transitionToEditor",value:function(e){var t=this,n=this.animatingBackground,i=this.animatingImage,r=this.getProjectBoundingClientRect(),a=r.width/r.height;i.setStyles({width:"".concat(r.width,"px"),height:"".concat(r.height,"px"),transform:"translateX(".concat(r.left,"px) translateY(").concat(-r.bottom,"px)"),transition:"none",pointerEvents:"none"}),this.animatingImageRect=r,this.animatingImageAppRect=BFN.appRect;var o,s,l,u,c=Math.round(Math.min(Math.max(r.width,r.height),BFN.maxImageSizeLayer));function h(e,t){setTimeout(function(){return requestAnimationFrame(t)},e)}o=c,s=function(o){t.animatingImageObjectURL=o,i.setStyles({backgroundImage:"url(".concat(o,")"),visibility:"visible",outlineWidth:"0"});var s=Math.max(50,Math.min(500,Math.round(Math.pow(c,2)/4e4)));h(s,function(){n.setStyles({opacity:1})}),h(s+30,function(){e(function(e){if(!e.success)return UIToggler.toggleLoadScreen(!1),n.removeAttribute("style"),i.removeAttribute("style"),t.completeEditing(),void(BFN.AppModel.viewState=t.targetViewstate);h(0,function(){UIToggler.toggleLoadScreen(!1);var e=t.maxThumbSize,o=a>1?r.width/e:r.height/e,s=a>1?e:e*a,l=a>1?e/a:e,u="translateX(".concat(16+BFN.CSS.leftMenuBarWidth+BFN.CSS.sideMenuWidth,"px) translateY(-").concat(16+BFN.CSS.footerHeight,"px)");i.setStyles({transform:"".concat(u," scale(").concat(1/o,")"),transition:"transform ".concat(600,"ms ease-in-out")}),n.setStyles({transition:"opacity ".concat(500,"ms ease-in-out ").concat(100,"ms"),opacity:0}),h(700,function(){n.removeAttribute("style"),i.setStyles({width:"".concat(s,"px"),height:"".concat(l,"px"),transform:"",transition:"none"}),h(0,function(){i.setStyles({transition:"",outlineWidth:"",pointerEvents:""}),i.setAttribute("data-tooltip",t.backButtonText.dataset.lang)})})})})})},l=BFN.AppModel.viewingCollage?BFN.CollageMakerCanvas.getFlattenedImage(!0):BFN.DesignerCanvas.getFlattenedImage(),u=BFN.Util.getThumbTexture(l,o),l.destroyGC(!0),BFN.TextureUtils.textureToBlobWithErrorHandling(u,{isTransparent:!0}).catch(function(e){BeFunky.logError("Unable to generate Blob for Open Image in Editor transition",e)}).then(function(e){u.destroyGC(!0);var t=URL.createObjectURL(e||new Blob),n=new Image;n.onload=n.onerror=function(){s(t),n.onerror=void 0},n.src=t})}},{key:"getProjectBoundingClientRect",value:function(){if(BFN.AppModel.viewingCollage){var e=BFN.CollageMakerCanvas.scale.x,t=BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth*e,n=BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight*e,i=BFN.CollageMakerCanvas.canvasContainer.x*e,r=-BFN.CollageMakerCanvas.canvasContainer.y*e;return{width:t,height:n,left:BFN.CollageMakerCanvas.x+i-t/2+BFN.appViewportRect.left,bottom:BFN.CollageMakerCanvas.y+r-n/2+BFN.CSS.footerHeight}}if(!BFN.AppModel.viewingDesigner)throw"Wrong app section";var a=BFN.DesignerCanvas.scale.x,o=BFN.DesignerCanvas.canvasWidth*a,s=BFN.DesignerCanvas.canvasHeight*a,l=BFN.DesignerCanvas.canvasContainer.x*a,u=-BFN.DesignerCanvas.canvasContainer.y*a;return{width:o,height:s,left:BFN.DesignerCanvas.x+l-o/2+BFN.appViewportRect.left,bottom:BFN.DesignerCanvas.y+u-s/2+BFN.CSS.footerHeight}}},{key:"transitionFromEditor",value:function(){var e=this,t=this.animatingBackground,n=this.animatingImage,i=this.animatingImageRect,r=this.animatingImageAppRect;function a(e,t){setTimeout(function(){return requestAnimationFrame(t)},e)}n.setStyles({outlineWidth:"0",pointerEvents:"none",transform:getComputedStyle(n).transform,transition:"none"}),t.setStyles({opacity:1}),requestAnimationFrame(function(){var o=e.maxThumbSize,s=i.width/i.height>1?i.width/o:i.height/o,l=i.left+(BFN.appRect.width-r.width)/2,u=i.bottom+(BFN.appRect.height-r.height)/2;n.setStyles({transform:"translateX(".concat(l,"px) translateY(").concat(-u,"px) scale(").concat(s,")"),transition:"transform ".concat(500,"ms ease-in-out")}),a(500,function(){n.setStyles({opacity:0,transition:"opacity ".concat(300,"ms ease-in-out")}),t.setStyles({opacity:0,transition:"opacity ".concat(300,"ms ease-in-out")}),a(300,function(){t.removeAttribute("style"),n.removeAttribute("style"),e.animatingImageObjectURL&&URL.revokeObjectURL(e.animatingImageObjectURL)})})})}},{key:"completeEditing",value:function(e){BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),this.flattenedImage=e?BFN.PhotoEditorCanvas.getFlattenedImage():null,this.editingImage=!1,this.resetEditor(),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewStateChangedBind)}},{key:"applyEdit",value:function(){if(this.flattenedImage){var e=this.processTexture(this.flattenedImage),t=new PIXI.Point(this.flattenedImage.baseTexture.width,this.flattenedImage.baseTexture.height);if(this.targetImageItem){var n,i,r,a,o=new PIXI.Point(this.targetImageItem.itemContent.texture.baseTexture.width,this.targetImageItem.itemContent.texture.baseTexture.height),s=o.x!=t.x||o.y!=t.y,l=this.targetImageItem;if(s){var u=l.bounds,c=u.width,h=u.height;n=c*l.scale.x,i=h*l.scale.y;var d=Math.sqrt(Math.pow(n,2)+Math.pow(i,2))/2,m=Math.atan2(i/2,n/2);r=l.x+Math.cos(m+l.rotation)*d,a=l.y+Math.sin(m+l.rotation)*d}if(this.targetImageItem.createTransition("edit_image"),this.targetImageItem.projectItemVO.imageID=e.id,this.targetImageItem.itemObject.texture=this.flattenedImage,this.targetImageItem.itemContent.texture=this.flattenedImage,this.targetImageItem.updateContentDimensions(),s){var p=l.bounds,g=p.width,f=p.height,v=g*l.scale.x,y=f*l.scale.y,x=Math.sqrt(Math.pow(v,2)+Math.pow(y,2))/2,_=Math.atan2(y/2,v/2),I=Math.min(n/v,i/y);l.scale.x*=I,l.scale.y*=I,l.x=r+Math.cos(_+Math.PI+l.rotation)*x*I,l.y=a+Math.sin(_+Math.PI+l.rotation)*x*I}this.targetImageItem.registerTransition()}else if(this.targetMaskImageItem){var T=new PIXI.Point(this.targetMaskImageItem.itemContent.texture.baseTexture.width,this.targetMaskImageItem.itemContent.texture.baseTexture.height),b=T.x!=t.x||T.y!=t.y;this.targetMaskImageItem.createTransition("edit_image"),this.targetMaskImageItem.projectItemVO.maskImageID=e.id,this.targetMaskImageItem.itemObject.texture=this.flattenedImage,this.targetMaskImageItem.itemContent.setTexture(this.flattenedImage),b&&(this.targetMaskImageItem.itemContent.textureScale=1,this.targetMaskImageItem.itemContent.offsetFactorX=.5,this.targetMaskImageItem.itemContent.offsetFactorY=.5),this.targetMaskImageItem.itemContent.updateDisplay(),this.targetMaskImageItem.registerTransition()}else if(this.targetGridCell){var S=new PIXI.Point(this.targetGridCell.content.image.frameSprite.texture.baseTexture.width,this.targetGridCell.content.image.frameSprite.texture.baseTexture.height),C=S.x!=t.x||S.y!=t.y;this.targetGridCell.menuImageVO=e,this.targetGridCell.content.setImage(e.imageTexture,C,!1,this.targetGridCell.content.image.frameSprite.rotate)}}this.flattenedImage=null}},{key:"processTexture",value:function(e){switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:UITools.setToolValue("collage_main","image_manager",!1),UITools.applyTool("collage_main");break;case BFN.AppModelViewStates.VIEWING_DESIGNER:UITools.setToolValue("designer_main","image_manager",!1),UITools.applyTool("designer_main")}return BFN.ImageLibraryManager.createMenuImageVOFromTexture(e)}},{key:"resetEditor",value:function(){BFN.PhotoEditorModel.currentTexture&&BFN.PhotoEditorModel.currentTexture!==BFN.PhotoEditorModel.sourceTexture&&BFN.PhotoEditorModel.currentTexture.destroyGC(!0),BFN.PhotoEditorModel.currentTexture=null,BFN.PhotoEditorModel.dispatchEvent(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED),BFN.PhotoEditorModel.dispatchEvent(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED),BFN.ArtsyService.reset(),BFN.BackgroundRemovalManager.reset(),BFN.TransformStateModel.clearTransitions(BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR),BFN.PhotoEditorCanvasModel.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS),BFN.PhotoEditorHistoryModel.resetHistory(),BFN.PhotoEditorModel.sourceTexture.clear(),BFN.PhotoEditorModel.sourceTexture.resize(32,32),showMenuPanel("primary"),BFN.PhotoEditorModel.hasUnsavedChanges=!1}},{key:"overrideSetAppViewState",value:function(e){var t=this;this.targetViewstate=this.targetViewstate||e;var n=function(){var e=BFN.UserActionManager.getSaveData(),n=new BFN.UserActionVO;n.eventID="collage_or_designer_image_edited",n.eventObject={targetSection:BFN.AppModel.getSectionValue(t.targetViewstate,"Photo Editor","Collage Maker","Designer"),imageEditMainFunnel:e.actions,imageEditFontsUsed:e.fonts,imageEditLayerSourcesUsed:e.assets},n.register()};BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?BeFunky.confirm("apply_changes_leave_editor",{onConfirm:function(){BFN.PhotoEditorCanvasTools.applyCurrentTool(),n(),t.completeEditing(!0),t.transitionFromEditor(),BFN.AppModel.viewState=t.targetViewstate},confirmText:"yes",cancelText:"no_keep_editing"}):(n(),t.completeEditing(t.imageChangedWhileEditing||BFN.UndoManager.undoExists),t.transitionFromEditor(),BFN.AppModel.viewState=t.targetViewstate)}},{key:"toggleFinishButton",value:function(e){document.getElementById("app_goto_button").toggleClass("button--hidden",e),this.backButton.toggleClass("button--hidden",!e)}},{key:"handleAppModelViewStateChanged",value:function(){BFN.AppModel.removeEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewStateChangedBind),this.toggleFinishButton(!1),BFN.AppModel.viewState===this.targetViewstate&&(this.flattenedImage&&this.applyEdit(),this.targetImageItem&&this.targetImageItem.selectItem(),this.targetMaskImageItem?this.targetMaskImageItem.selectItem():this.targetGridCell&&(BFN.PhotoGrid.selectedChild=this.targetGridCell,BFN.PhotoGrid.isolateGridChild(this.targetGridCell))),setTimeout(function(){BFN.ProjectManager.autoSave.editor.allowAutoSave=!0},2e3),this.targetViewstate=null,this.targetImageItem=null,this.targetMaskImageItem=null,this.targetGridCell=null,this.flattenedImage=null}},{key:"handleSourceImageUpdated",value:function(e){if(this.editingImage){if(this.disregardSourceImageUpdate)return void(this.disregardSourceImageUpdate=!1);this.imageChangedWhileEditing=!0}}}]),e}();function zd(){var e=g(['<image-gallery\n                class="image-library__gallery"\n                .rowHeight=',"\n                .currentWidth=","\n                .onSelectItem=","\n                .extendItemTemplate=","\n                .emptyState=","\n                .gutterWidth=","\n                .borderWidth=","\n            ></image-gallery>"]);return zd=function(){return e},e}function jd(){var e=g(['\n        <div class="image-library__right-panel">\n            <div class="scrollable-content scrollable-content--modal-right-panel" style=',">\n                ","\n            </div>\n        </div>\n        "]);return jd=function(){return e},e}function Xd(){var e=g(['<span class="loading-spinner"></span>']);return Xd=function(){return e},e}function Wd(){var e=g(["\n            <button @click=",' class="','">\n                <string>',"</string>\n                ","\n            </button>"]);return Wd=function(){return e},e}function Yd(){var e=g(['\n        <div class="image-library__albums">\n            ',"\n        </div>"]);return Yd=function(){return e},e}function qd(){var e=g(["",""]);return qd=function(){return e},e}function Kd(){var e=g(["\n        <button @click="," class=",">\n            ","\n            <string>","</string>\n        </button>\n        ","\n        "]);return Kd=function(){return e},e}function Qd(){var e=g(['<div class="image-library__left-panel">',"</div>"]);return Qd=function(){return e},e}function Zd(){var e=g(['<panel-header lang-id="image_library" modifier="modal" buttons="close"></panel-header>']);return Zd=function(){return e},e}function Jd(){var e=g(["\n            ",'\n            <div class="modal__body image-library__body">\n                ',"\n                ","\n            </div>\n        "]);return Jd=function(){return e},e}function $d(){var e=g(['<div id="image_library" class="modal modal--button-sm image-library"></div>']);return $d=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.ImageEditManager=new Hd});var em=BeFunky.lit,tm=em.html,nm=em.setupState,im=em.render,rm=em.elem,am=em.icon;function om(e){var t,n=e.imageSelectionHandler,i=e.transformImageObject,r=void 0===i?function(e){return e}:i,a=e.extendItemTemplate,o=e.onClose,s=e.initialMode,l=rm($d()),u=1600,c=u-272-48,h={befunky:["befunky_photo","befunky_layer"],facebook:["facebook"],google:["google_photos"]},d={mode:s,currentSection:"befunky",albums:{befunky:[],facebook:[],google:[]},galleryWidth:c},m=BeFunky.debounce(function(){var e;im(tm(Jd(),_,(e=[{section:"befunky",name:"BeFunky"},{section:"facebook",name:"Facebook",albums:y.albums.facebook},{section:"google",name:"Google Photos",albums:y.albums.google}],tm(Qd(),e.map(T))),tm(jd(),"--scrollable-content-width: ".concat(y.galleryWidth,"px"),B(y.currentSection).gallery)),l),t=t||l.querySelector(".scrollable-content--modal-right-panel")},"raf"),p=nm(d,function(e){if(e.currentSection&&k(e.currentSection[0]),e.albums||e.mode){var t=Boolean(e.currentSection);if(!t&&e.albums){var n=f(e.albums.map(function(e){return e[y.currentSection].find(function(e){return e.isSelected})}),2),i=n[0],r=n[1];!r||i&&i.id===r.id||(t=!0)}b(t)}m()}),g=f(p,2),y=g[0],x=g[1];BeFunky.LanguageManager.addLanguageUpdateListener(m);var _=rm(Zd()),I=function(){var e=[{section:"befunky",gallery:i({rowHeight:173,emptyState:{text:"login_load_images",imageUrl:"".concat(BFN.imagesURL,"app/illustrations/log-in-befunky-photos.svg"),buttonText:"sign_in",buttonAction:M}})},{section:"facebook",gallery:i({rowHeight:200,emptyState:{text:"connect_facebook_load_albums",imageUrl:"".concat(BFN.imagesURL,"app/illustrations/connect-facebook-photos.svg"),buttonText:"connect_facebook",buttonAction:D}})},{section:"google",gallery:i({rowHeight:200,emptyState:{text:"connect_google_load_albums",imageUrl:"".concat(BFN.imagesURL,"app/illustrations/connect-google-photos.svg"),buttonText:"connect_google_photos",buttonAction:w}})}];return e.forEach(function(e){Object.assign(e,BeFunky.setupInfiniteScroll(function(){return t},{threshold:400}))}),e;function i(e){var t=e.rowHeight,i=e.emptyState;return rm(zd(),t,c,n,a,i,8,1)}}();return Object.assign(l,{open:function(e){BeFunky.openModal(l,{onOpen:function(){e&&e!==y.currentSection?x({currentSection:e}):k()},onClose:function(){"function"==typeof o&&o()},onWindowResize:L,size:"xxl"})},close:function(){BeFunky.closeModal(l)},selectGalleryItem:S,deselectGalleryItem:function(e){return S(e)},getGalleryConfig:B,setState:x}),l;function T(e){var t=e.section,n=e.name,i=e.albums,r=y.currentSection===t&&i;return tm(Kd(),function(){x({currentSection:t})},"image-library__tab button button--grey-200 button--fullwidth button--has-icon ".concat(t===y.currentSection?"button--selected":""),r&&r.length>0?tm(qd(),am("chevron-icon","icon icon--chevron-down")):"",n,r?function(e,t){return tm(Yd(),t.map(function(t){var n="image-library__album button button--grey-200 button--fullwidth ".concat(t.isSelected?"button--selected":"");return tm(Wd(),function(){return function(e,t){if(t.isSelected)return;var n=N(e);O(e,y.albums[e].map(function(e){return e===t?Object.assign({},e,{isSelected:!0}):e===n?Object.assign({},e,{isSelected:!1}):e}))}(e,t)},n,t.name,t.isLoading?tm(Xd()):"")}))}(t,i):"")}function b(e){var n=y.currentSection,i=y.albums[n]||[];if(i.length){var r=i.find(function(e){return e.isSelected});if(r){var a=r.page,o=r.images,s=r.staggerImageLoading,l=r.scrollPosition,u=r.isLoading,c=r.message,h=r.emptyState,d=r.loadNextPageOfImages,m=B(n),p=m.gallery,g=m.listenForScroll,f="google"===n?30:50;if(o.length||(p.emptyState=h),p.message=c,p.isLoading=u,p.staggerLoading=s,C(n),!u||e){p.images=o.slice(0,a*f);var v=0;e&&(t&&(t.scrollTop=l),l&&requestAnimationFrame(function e(){v++;if(v>2)return;r.isSelected&&0!==l&&0===t.scrollTop&&(p.getBoundingClientRect().height?(console.log("Fixed scroll position"),t.scrollTop=l):requestAnimationFrame(e))})),a*f<o.length?(r.staggerImageLoading=!0,g(function(){return!r.isSelected},function(){r.page++,b(!1)})):!d||u||c||h||d(r)}}}}function S(e){var t=BFN.getImageType(e),n=Object.entries(h).find(function(e){return f(e,2)[1].includes(t)});n&&C(n[0])}function C(e){var t=B(e).gallery,n="IMAGE_MANAGER"===y.mode;t.selectedImageIDs=n?function(e){var t=h[e];return BFN.ImageLibraryManager.selectedMenuImageVOs.filter(function(e){return t.includes(BFN.getImageType(e.id))}).map(function(e){return e.id})}(e):void 0}function B(e){return I.find(function(t){return t.section===e})}function F(){O("befunky",[{id:"DEFAULT",name:"",page:1,images:[],staggerImageLoading:!0,scrollPosition:0,isSelected:!0,isLoading:!1,message:"",emptyState:"",nextAPIPage:1,loadNextPageOfImages:function e(t){var n=t.nextAPIPage,i=t.id;R("befunky",i,{isLoading:!0,message:"",images:1===n?[]:t.images});BeFunky.ImagesService.getPhotosAndLayers(n,function(a){var o=a.data,s=a.totalPages,l=a.error;if(l)return 1===n&&"no_results"===l?R("befunky",i,{isLoading:!1,emptyState:{text:"no_befunky_photos",imageUrl:"".concat(BFN.imagesURL,"app/illustrations/no-search-results-canvas.svg")}}):(BeFunky.logError("Unable to fetch BeFunky images",l),R("befunky",i,{isLoading:!1,message:{isError:!0,text:BeFunky.failureReason(l),buttonText:"try_again",buttonAction:function(){return e(t)}}}));var u=n<s;return R("befunky",i,{isLoading:!1,staggerImageLoading:!0,images:[].concat(v(t.images),v(o.map(r))),nextAPIPage:u?n+1:void 0,loadNextPageOfImages:u?e:void 0})})}}])}function E(){var e=B("facebook").gallery;e.images=[],e.isLoading=!0,e.message="",BeFunky.FacebookAuth.getPhotoAlbums().then(function(t){e.isLoading=!1,O("facebook",t.map(function(e,t){return{id:e.id,name:e.name,page:1,images:e.images.map(r),staggerImageLoading:!0,scrollPosition:0,isSelected:0===t,isLoading:!1,message:"",emptyState:""}}))},function(t){e.isLoading=!1,BeFunky.logError("Unable to fetch Facebook albums",t),e.message={isError:!0,text:BeFunky.failureReason(t),buttonText:"try_again",buttonAction:function(){return E()}}})}function P(){var e=B("google").gallery;e.images=[],e.message="",e.isLoading=!0;var t=Date.now();function n(e){R("google",e.id,{isLoading:!0,message:""});var t="all_photos"===e.id?BeFunky.GooglePhotosManager.getAllMedia(e.nextPageToken):BeFunky.GooglePhotosManager.getAlbumMedia(e.id,e.nextPageToken),i=Date.now();return t.then(function(t){var a=t.mediaItems,o=t.nextPageToken;console.log("Got ".concat(a.length," images from API in ").concat((Date.now()-i)/1e3,"s"),{nextPageToken:o});var s=BeFunky.GooglePhotosManager.mediaItemsToImageObjects(a).map(r);if(!s.length)throw"no_results";R("google",e.id,{isLoading:!1,staggerImageLoading:!0,images:[].concat(v(e.images),v(s)),nextPageToken:o,loadNextPageOfImages:o?n:void 0})}).catch(function(t){R("google",e.id,{isLoading:!1,message:{isError:!0,text:BeFunky.failureReason(t),buttonText:"try_again",buttonAction:function(){return n(e)}}})})}BeFunky.GooglePhotosManager.getAlbums().then(function(i){e.isLoading=!1,console.log("Got ".concat(i.length," albums from API in ").concat((Date.now()-t)/1e3,"s"));var r=function(e,t,i){return{id:e,name:t,page:1,images:[],staggerImageLoading:!0,scrollPosition:0,isSelected:i,isLoading:!1,message:"",emptyState:"",nextPageToken:void 0,loadNextPageOfImages:n}},a=i.filter(function(e){return e.title});O("google",[r("all_photos","All Photos",!1)].concat(v(a.map(function(e,t){return r(e.album_id,e.title,0===t)}))))},function(t){e.isLoading=!1,"cancelled_by_user"!==t&&(BeFunky.logError("Unable to fetch Google albums",t),e.message={isError:!0,text:BeFunky.failureReason(t),buttonText:"try_again",buttonAction:function(){return P()}})})}function k(e){var t=B(y.currentSection).gallery;e&&N(e),console.log("Entered ".concat(y.currentSection," tab")),{befunky:function(){if(BeFunky.isLoggedIn())return y.albums.befunky.length?null===BeFunky.ImagesService.imageData.totalImages?F():b(!0):void F()},facebook:function(){if(BeFunky.FacebookAuth.hasBeenAuthorized)return y.albums.facebook.length?b(!0):void(t.isLoading||E())},google:function(){if(y.albums.google.length)return b(!0)}}[y.currentSection]()}function N(e){var n=y.albums[e].find(function(e){return e.isSelected});if(n)return n.scrollPosition=t.scrollTop,n.staggerImageLoading=!1,n}function M(){BeFunky.isLoggedIn()?F():BeFunky.openLoginPanel("SIGNIN",M)}function D(){E()}function w(){BeFunky.GooglePhotosManager.mightBeAuthorized?P():BeFunky.GooglePhotosManager.login(!1).then(P,function(e){"cancelled_by_user"!==e&&BeFunky.throwError("Unable to authorize with Google Photos",e)})}function L(e){var t=e.availableWidth,n=c+(t-u);I.forEach(function(e){var t=e.gallery,i=e.recalculateScrollPosition;t.currentWidth=n,x({galleryWidth:n}),i()})}function O(e,t){var n=Object.assign({},y.albums,{[e]:t});x({albums:n})}function R(e,t,n){O(e,y.albums[e].map(function(e){return e.id!==t?e:Object.assign({},e,n)}))}}function sm(){var e=g(["<button @click=",' class="button button--icon button--xs button--grey-200 image-library__button image-library__button--delete" data-tooltip="delete">\n                    ',"\n                </button>"]);return sm=function(){return e},e}var lm=BeFunky.lit,um=lm.html,cm=lm.icon,hm=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues(),this.initSampleImages()}},{key:"initDefaultValues",value:function(){var e=this;this.selectedMenuImageVOs=[],this.sampleMenuImageVOs=[],BFN.IndexedDB.get("options__selectedMenuImageVOs").then(function(t){Array.isArray(t)&&t.reverse().forEach(function(t){return e.addImage(t,{useTracking:!1})})}).catch(function(e){BeFunky.logError("Unable to fetch previous session's selectedMenuImageVOs from IndexedDB",e)}),this.imageLibraryModal=null,this.stockSearchModal=document.getElementById("stock_search_modal"),document.getElementById("image_manager_upload_image").addEventListener("click",function(){return e.uploadImages()}),document.getElementById("image_manager_open_image_library").addEventListener("click",function(){return e.openModal()}),document.getElementById("image_manager_search_images").addEventListener("click",function(){return e.openModal("stock_images")}),this.sidebar=document.getElementById("image_manager"),BFN.UI.imageManager(this.sidebar),document.getElementById("image_manager_autofill").addEventListener("click",function(){return e.autofill()}),document.getElementById("image_manager_clear").addEventListener("click",function(){return e.clearCanvas()}),this.initRemoveUnusedButton(),this._mode="IMAGE_MANAGER",this.updateImageStore=BeFunky.debounce(this.updateImageStore,0),this.trackAddImage=BeFunky.debounce(this.trackAddImage,1e3),this.trackRemoveImage=BeFunky.debounce(this.trackRemoveImage,1e3)}},{key:"initSampleImages",value:function(){var e=this;this.sampleMenuImageVOs=[{name:"woman-yellow-bg",thumb:"woman-yellow-bg-thumb.jpg",image:"woman-yellow-bg-large.jpg"},{name:"pink-blue-doors-architecture",thumb:"pink-blue-doors-architecture-thumb.jpg",image:"pink-blue-doors-architecture-large.jpg"},{name:"bicycle-mural-wall",thumb:"bicycle-mural-wall-thumb.jpg",image:"bicycle-mural-wall-large.jpg"},{name:"man-sitting-desert",thumb:"man-sitting-desert-thumb.jpg",image:"man-sitting-desert-large.jpg"},{name:"wedding-couple-pink-wall",thumb:"wedding-couple-pink-wall-thumb.jpg",image:"wedding-couple-pink-wall-large.jpg"},{name:"dog-purple-bg",thumb:"dog-purple-bg-thumb.jpg",image:"dog-purple-bg-large.jpg"}].map(function(e){var t=new BFN.MenuImageVO;return t.name=e.name,t.createId("sample",e.name),t.thumbURL="".concat(BFN.imagesURL,"app/image-manager/").concat(e.thumb,"?width=216"),t.thumbWidth=216,t.thumbHeight=216,t.imageURL="".concat(BFN.imagesURL,"app/image-manager/").concat(e.image),t.isSaved=!0,t.isRemovable=!1,t}),setTimeout(function(){e.sampleMenuImageVOs.slice().forEach(function(t){return e.sidebar.addItem(t,void 0,!0)})},0)}},{key:"initRemoveUnusedButton",value:function(){var e=this;this.removeUnusedButton=document.getElementById("image_manager_remove_unused"),this.removeUnusedButton.addEventListener("click",function(){return e.removeUnused()}),this.updateRemoveUnusedButton=BeFunky.debounce(this.updateRemoveUnusedButton,100);var t=function(){BFN.AppModel.viewingCollage&&e.updateRemoveUnusedButton()};BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,t),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.type,t)}},{key:"setupImageLibraryModal",value:function(){var e=this;this.imageLibraryModal||(this.imageLibraryModal=om({imageSelectionHandler:function(t,n){return n&&"google_photos"===BFN.getImageType(t.id)&&"IMAGE_MANAGER"===e.mode&&(t.indexedDBKey="image__".concat(t.id),BeFunky.GooglePhotosManager.downloadGooglePhoto(t).then(function(n){var i=f(n,2),r=i[0],a=i[1];e.selectedMenuImageVOs.find(function(e){return e.id===t.id})&&(e.updateImage(t.id,{thumbURL:r}),BFN.ProjectService.setLocalAsset("imagemanager","image",t.id,a))}).catch(function(e){BeFunky.throwError("Unable to download Google Photo",e)})),"UPLOAD_MENU"===e.mode?(e.imageLibraryModal.close(),BFN.PhotoEditorModel.confirmEditorLoadImage(function(){e.addImageToPhotoEditorCanvas(t)},function(){e.mode="UPLOAD_MENU",e.imageLibraryModal.open()}),!1):e.handleImageSelection(t,n)},isSelected:function(t){return-1!==e.getIndex(t)},initialMode:this.mode,transformImageObject:function(e){var t=new BFN.MenuImageVO;t.setObject(e);var n=BFN.getImageType(t.id);return"befunky_layer"!==n&&"befunky_photo"!==n||(t.isSaved=!0,!t.name&&e.title&&(t.name=e.title)),t},extendItemTemplate:function(t){var n=BFN.getImageType(t.id);if("befunky_layer"!==n&&"befunky_photo"!==n)return"";return um(sm(),function(n){n.stopPropagation(),e.deleteImage(t.id)},cm("delete-icon","icon icon--14"))},onClose:function(){e.mode="IMAGE_MANAGER"}}))}},{key:"openModal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"IMAGE_MANAGER";if(BeFunky.isInDemoMode()&&"stock_images"!==e)return BeFunky.acknowledgeDemoMode();"stock_images"===e?(this.stockSearchModal.init||BFN.UI.stockSearchModal(this.stockSearchModal),this.stockSearchModal.open()):this.imageLibraryModal?this.imageLibraryModal.open(e):(this.setupImageLibraryModal(),this.imageLibraryModal.open(e||"befunky")),this.mode=t}},{key:"uploadImages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};BFN.MultipleFileUploader.upload(function(n){e.handleImageLoaded(n),t&&t(n)},n)}},{key:"addImage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.cloneObject,r=void 0===i||i,a=n.index,o=void 0===a?0:a,s=n.updateImageGalleryItem,l=void 0===s||s,u=n.useTracking,c=void 0===u||u;if(!e.id)throw"MenuImageVO missing id";if(-1===this.getIndex(e.id)){var h;if(r||e instanceof BFN.MenuImageVO||(r=!0,BeFunky.throwError("MenuImageVO cloning forced on plain object",e)),r?(h=new BFN.MenuImageVO).setObject(e):h=e,this.selectedMenuImageVOs.splice(o,0,h),e.indexedDBKey){var d=e.isSVG?"svg":"image";BFN.ProjectService.setLocalAsset("imagemanager",d,e.id,void 0,!0)}if(requestAnimationFrame(function(){return t.sidebar.addItem(h,o)}),l){var m=["unsplash","pixabay","pexels"].includes(BFN.getImageType(e.id))?this.stockSearchModal:this.imageLibraryModal;m&&m.selectGalleryItem&&m.selectGalleryItem(h.id)}this.updateImageStore(),this.updateRemoveUnusedButton(),c&&this.trackAddImage()}}},{key:"updateImage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.getIndex(e);if(-1!==i){var r=this.selectedMenuImageVOs[i];Object.assign(r,t),n&&0!==i&&(this.selectedMenuImageVOs.splice(i,1),this.selectedMenuImageVOs.unshift(r),this.sidebar.removeItem(r.id),this.sidebar.addItem(r,0)),this.updateImageStore()}}},{key:"removeImage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.updateImageGalleryItem,r=void 0===i||i,a=n.usedBaseTextures,o=void 0===a?null:a,s=this.getIndex(e);if(-1!==s){o||(o=BFN.GlobalHistoryModel.getUsedBaseTextures());var l=this.selectedMenuImageVOs[s];l.imageTexture&&l.imageTexture.valid&&l.imageTexture.baseTexture&&!o.includes(l.imageTexture.baseTexture)&&(l.imageTexture.destroyGC(!0),l.imageTexture=null),this.selectedMenuImageVOs.splice(s,1);var u=l.isSVG?"svg":"image";if(BFN.ProjectService.removeLocalAsset("imagemanager",u,e),requestAnimationFrame(function(){return t.sidebar.removeItem(e)}),r){var c=["unsplash","pixabay","pexels"].includes(BFN.getImageType(l.id))?this.stockSearchModal:this.imageLibraryModal;c&&c.deselectGalleryItem&&c.deselectGalleryItem(e)}this.updateImageStore(),this.updateRemoveUnusedButton(),this.trackRemoveImage()}}},{key:"trackAddImage",value:function(){var e=BFN.AppModel.sectionValue("PHOTOEDITOR","COLLAGE","DESIGNER");BFN.BfnService.track("CREATE",e,"ADD_PHOTOS")}},{key:"trackRemoveImage",value:function(){var e=BFN.AppModel.sectionValue("PHOTOEDITOR","COLLAGE","DESIGNER");BFN.BfnService.track("CREATE",e,"DELETEITEM_BASKET")}},{key:"getIndex",value:function(e){return this.selectedMenuImageVOs.findIndex(function(t){return t.id===e})}},{key:"getSampleIndex",value:function(e){return this.sampleMenuImageVOs.findIndex(function(t){return t.id===e})}},{key:"getMenuImageVO",value:function(e){return("sample"===BFN.getImageType(e)?this.sampleMenuImageVOs:this.selectedMenuImageVOs).find(function(t){return t.id===e})}},{key:"updateImageStore",value:function(){var e=this.selectedMenuImageVOs.map(function(e){return e.getObject()});e.length||BFN.ProjectService.clearLocalAssets("imagemanager"),BFN.IndexedDB.set("options__selectedMenuImageVOs",e).catch(function(e){return BeFunky.logError("Unable to update selectedMenuImageVOs in IndexedDB",e)})}},{key:"autofill",value:function(){var e=this.selectedMenuImageVOs.length?this.selectedMenuImageVOs:this.sampleMenuImageVOs;BFN.CollageMakerCanvasPhotoGrid.autoFill(e);try{BFN.BfnService.track("CREATE","COLLAGE","AUTOFILL")}catch(e){}}},{key:"clearCanvas",value:function(){BFN.CollageMakerHistoryModel.ignoreSnapshot=!0,BFN.PhotoGrid.clearAllGridChildren(),BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,BFN.CollageMakerHistoryModel.historyAction="cells_cleared",BFN.PhotoGrid.getPhotoGridSnapShot();try{BFN.BfnService.track("CREATE","COLLAGE","CLEARALL")}catch(e){}}},{key:"removeUnused",value:function(){var e=this,t=BFN.PhotoGrid.getGridMenuImageVOs().map(function(e){return e.id}),n=this.selectedMenuImageVOs.map(function(e){return e.id}).filter(function(e){return!t.includes(e)});BeFunky.confirm("confirm_remove_unused_images",{onConfirm:function(){var t=BFN.GlobalHistoryModel.getUsedBaseTextures();n.map(function(n){return e.removeImage(n,{usedBaseTextures:t})})},confirmText:"yes",cancelText:"no"});try{BFN.BfnService.track("CREATE","COLLAGE","CLEAR_BASKET")}catch(e){}}},{key:"updateRemoveUnusedButton",value:function(){if(BFN.PhotoGrid){var e=BFN.PhotoGrid.getGridMenuImageVOs().map(function(e){return e.id});this.removeUnusedButton.disabled=!this.selectedMenuImageVOs.find(function(t){var n=t.id;return!e.includes(n)})}}},{key:"addImageToPhotoEditorCanvas",value:function(e){var t=BFN.getImageType(e.id);BFN.BfnService.ToJsUrlUploader(e.imageURL,"",!0,t),[this.imageLibraryModal,this.stockSearchModal].filter(Boolean).map(function(e){return e.id}).filter(BeFunky.getModal).forEach(BeFunky.closeModal)}},{key:"createMenuImageVOFromTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=new BFN.MenuImageVO;i.createId("computer"),i.imageTexture=e;var r=BFN.MultipleFileUploader.thumbSize,a=e.width/e.height,o=r*(a>1?a:1/a),s=BFN.Util.getThumbTexture(e,o,!1,!0);s.renderClone().destroyGC(!0);var l,u=BFN.Util.isTransparent(s);i.isTransparent=u,i.thumbURL=BFN.TextureUtils.textureToBase64(s,{isTransparent:u}),i.thumbWidth=s.width,i.thumbHeight=s.height,s.destroyGC(!0),u?(l=!0,i.imageTexture.isTransparent=!0):l=i.imageTexture.determineTransparency(),i.indexedDBKey="image__".concat(i.id);var c=e.renderClone();return BFN.TextureUtils.textureToBlob(c,{isTransparent:l}).then(function(e){c.destroyGC(!0),t&&t(e),BFN.IndexedDB.set(i.indexedDBKey,e).catch(function(e){i.indexedDBKey=null,BeFunky.logError("Unable to store blob in IndexedDB",e)})}),n&&BFN.ImageLibraryManager.addImage(i,{cloneObject:!1}),i}},{key:"addImageToCanvas",value:function(){var e=n(function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.hasTexture,i=void 0!==n&&n,r=t.initialCenterPosition,a=t.isGoodie,o=void 0!==a&&a,s=t.forceLayer,l=void 0!==s&&s,u=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),c=BFN.AppModel.sectionID;if(e.isSVG&&(o=!0),BFN.TransformModel.awaitingDrop=!1,BFN.TransformModel.focusedTransformItem&&!l&&(BFN.TransformModel.targetTransformItem=BFN.TransformModel.focusedTransformItem,BFN.TransformModel.focusedTransformItem=null),BFN.AppModel.viewingCollage&&!l&&!BFN.CollageMakerCanvasPhotoGridModel.freeform)if(BFN.PhotoGrid.awaitingDrop)if(BFN.PhotoGrid.awaitingDrop=!1,BFN.PhotoGrid.focusedChild)BFN.PhotoGrid.focusedChild.handleDrop(),BFN.PhotoGrid.targetChild=BFN.PhotoGrid.selectedChild,BFN.PhotoGrid.selectedChild=null;else{if(!r)return;var h=BFN.PhotoGrid.getChildUnderPosition(r.x,r.y);if(!h)return;BFN.PhotoGrid.targetChild=h}else if(BFN.PhotoGrid.targetChild||(BFN.PhotoGrid.targetChild=BFN.PhotoGrid.randomEmptyChild),!BFN.PhotoGrid.targetChild)return;if(!i){var d={saveAssetsSectionID:c};if(yield BFN.BfnService.getTexturesForMenuImageVOs([e],d),!e.imageTexture)return void BeFunky.logError("Unable to generate texture for MenuImageVO",e)}try{yield BeFunky.withLoadScreen(BFN.BfnService.storeBlobForMenuImageVO(e,c))}catch(e){return}var m=BFN.TransformModel.targetTransformItem;if(!m||e.isSVG||m.hasDropOptions&&!m.hasDropOptions)if(BFN.AppModel.viewingCollage&&!l&&BFN.PhotoGrid.targetChild){var p=new BFN.UserActionVO;p.eventID="collage_grid_image_added",p.eventObject={cellImageTypes:[e.isSVG?"Vector":"Rasterized"],cellImageSources:[BFN.UserActionManager.getAssetOrigin(e.id)]},p.actionSection="collage",p.actionTimestamp=Date.now(),p.register(),BFN.CollageMakerCanvasPhotoGrid.assignImageToTargetGridChild(e)}else{var g={type:o||e.isSVG?"texture":"frame_texture",texture:e.imageTexture,projectItemAssetID:e.id};o&&(g.isGoodie=!0,g.graphicStyle=e.style),r&&(g.initialCenterPosition=r),u.addedItem=g}else this.replaceTransformItemOnCanvas(m,e)});return function(t){return e.apply(this,arguments)}}()},{key:"replaceTransformItemOnCanvas",value:function(e,t){var n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),r="convert_to_image"+BeFunky.randomString(10),a=["layerName","transformZIndex","transformX","transformY","transformRotation"],o=null,s=null,l=function(){BFN.TransformStateModel.startBulkTransition(r),o=new BFN.ProjectItemVO,a.forEach(function(t){o.hasOwnProperty(t)&&e.projectItemVO.hasOwnProperty(t)&&(o[t]=e.projectItemVO[t])}),e.projectItemVO.dropShadowValues&&(o.dropShadowValues=Object.assign({},e.projectItemVO.dropShadowValues))},u=function(){if(o&&s&&BFN.TransformStateModel.batchTransitionID===r){var a=function(t){BFN.TransformStateModel.safeThumbImages.splice(0),BFN.MainUI.rendering=!0,n.transformLayer.selectItem(t),BeFunky.hideLoadScreen(),BFN.MainUI.requestRender();var i=new BFN.UserActionVO;i.eventID="image_layer_added",i.eventObject={imageLayerTypes:["Rasterized"],imageLayerSources:[t.assetOrigin]},i.actionSection=BFN.AppModel.sectionID,i.actionTimestamp=Date.now(),i.transformItem=t,i.register();var r="text"===e.type?"Text":e.isShape?e.basicShapeVO?"Basic Shape":"Vector":"Rasterized",a=new BFN.UserActionVO;a.eventID="image_layer_masked",a.eventObject={imageLayerMaskedTypes:[r],imageLayerMaskedSources:["text"===e.type?"Text":e.assetOrigin]},a.actionSection=BFN.AppModel.sectionID,a.actionTimestamp=Date.now(),a.transformItem=e,a.register()};"texture"===e.type&&e.isShape&&(e.basicShapeVO&&e.basicShapeVO.isSolidRectangle||(s.readyCallback=function(){BFN.MainUI.addIdleRenderFunction(a)})),BeFunky.showLoadScreen({isCancellable:!1}),BFN.MainUI.rendering=!1,BFN.TransformStateModel.safeBaseTextures.includes(t.imageTexture.baseTexture)||BFN.TransformStateModel.safeBaseTextures.push(t.imageTexture.baseTexture),BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(e,!0),"swap_layer_old","app_action"),e.removeItem(),o.type="mask_image",e.projectItemVO.graphicStyle&&(s.graphicStyle=e.projectItemVO.graphicStyle,o.graphicStyle=e.projectItemVO.graphicStyle),o.maskImageOffsetFactorX=.5,o.maskImageOffsetFactorY=.5,o.maskImageTextureScale={x:1,y:1},o.transformScaleX=1,o.transformScaleY=1,o.maskImageMaskFlippedHorizontal=e.projectItemVO.transformFlippedHorizontal||e.projectItemVO.maskImageMaskFlippedHorizontal,o.maskImageMaskFlippedVertical=e.projectItemVO.transformFlippedVertical||e.projectItemVO.maskImageMaskFlippedVertical,s.projectItemVO=o,BFN.TransformModel.selectItemOnAdd=!1,i.addedItem=s,BFN.TransformModel.selectItemOnAdd=!0;var l=BFN.TransformModel.addedTransformItem;e.projectItemVO.layerName&&(l.layerName=e.projectItemVO.layerName),l.updateThumb();var u=new BFN.TransformItemStateVO;u.imageTexture=l.itemContent.texture,u.parent=n.transformLayer,BFN.ProjectManager.transferProperties(o,u),l.applyTransformItemState(u),l.createTransition("apply_transform_item_state"),l.registerTransition(!0,!1),l.ignoreAccurateBounds=!1,l.updateAccurateBounds(),BFN.TransformStateModel.stopBulkTransition(),BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(l,!0),"swap_layer_new","app_action");var c=new BFN.TransformItemTransitionVO;c.id="convert_to_image",c.batchIDPlaceholder=r,c.transformItem="text"===e.type?null:e,c.useTextIcon="text"===e.type,BFN.TransformStateModel.addTransition(c),BFN.TransformStateModel.safeBaseTextures.splice(0),l.readyCallback||a(l)}};if(e.thumbImage&&e.thumbImage.src&&!BFN.TransformStateModel.safeThumbImages.includes(e.thumbImage)&&BFN.TransformStateModel.safeThumbImages.push(e.thumbImage),"frame_texture"===e.type){var c=function(){e.itemContentMask?e.replaceImage(t.id,t.imageTexture,"replace_image",0,0,!1,null,!0):e.replaceImage(t.id,t.imageTexture)};if(e.isShape||e.itemContentMask)c();else{if(e.isTransparent){return BeFunky.openNebulaDialog({body:"replace_or_mask",buttons:[{text:"replace_image",type:"blue",onClick:c},{text:"use_as_mask",type:"blue",onClick:function(){BeFunky.showLoadScreen({isCancellable:!1}),l(),o.maskImageID=t.id,o.maskImageFrameWidth=e.itemContentW*e.scale.x,o.maskImageFrameHeight=e.itemContentH*e.scale.y,s={type:"frame_texture",texture:t.imageTexture};var n=new PIXI.Texture(e.itemContent.texture.baseTexture);n.frame=e.itemContent.texture.frame;var i=PIXI.RenderTexture.create(Math.round(n.frame.width),Math.round(n.frame.height));i.fillColor(0);var r=new PIXI.Sprite(n);r.pluginName="blend_picture",r.fillColor=16777215,r.intensity=1,r.width=i.width,r.height=i.height,BFN.Stage.render(r,i,!1),r.destroy(!1),BFN.TextureUtils.textureToBlob(i,{isTransparent:!1}).then(function(e){var t=(new BFN.MenuImageVO).createId("alpha_mask");BFN.ProjectService.setLocalAsset("editor","image",t,e).then(function(){o.maskImageMaskID=t,s.maskTexture=i,u()})})}}],modalOptions:{closeOnClickOutside:!0,onClose:function(){BFN.TransformModel.targetTransformItem=null,BFN.TransformModel.focusedTransformItem=null}}})}c()}}else if("texture"===e.type)if(e.isShape){if(l(),o.maskImageID=t.id,o.maskImageMaskID=e.projectItemVO.graphicID,o.maskImageFrameWidth=e.itemContentW*e.scale.x,o.maskImageFrameHeight=e.itemContentH*e.scale.y,s={type:"frame_texture",texture:t.imageTexture},e.basicShapeVO&&e.basicShapeVO.isSolidRectangle||(s.maskTexture=new PIXI.Texture(e.itemContent.texture.baseTexture),s.newShape=!0),e.basicShapeVO&&!e.basicShapeVO.isSolidRectangle){var h=e.basicShapeVO.clone();h.convertToMaskValues(),delete s.newShape,s.maskTexture=PIXI.RenderTexture.create(32,32),s.basicShapeVO=h}u()}else if(l(),o.maskImageID=t.id,o.maskImageFrameWidth=e.itemContentW*e.scale.x,o.maskImageFrameHeight=e.itemContentH*e.scale.y,s={type:"frame_texture",texture:t.imageTexture},e.isTransparent){BeFunky.showLoadScreen({isCancellable:!1});var d=PIXI.RenderTexture.create(e.itemContent.texture.baseTexture.width,e.itemContent.texture.baseTexture.height);d.fillColor(0);var m=new PIXI.Sprite(e.itemContent.texture);m.pluginName="blend_picture",m.fillColor=16777215,m.intensity=1,BFN.Stage.render(m,d,!1),m.destroy(!1),BFN.TextureUtils.textureToBlob(d,{isTransparent:!1}).then(function(e){var t=(new BFN.MenuImageVO).createId("alpha_mask");BFN.ProjectService.setLocalAsset("editor","image",t,e).then(function(){o.maskImageMaskID=t,s.maskTexture=d,u()})})}else u();else if("text"===e.type){if(BFN.FabricManager.isDefaultText(e.iText.text))return;BeFunky.showLoadScreen({isCancellable:!1}),e.getITextMask(function(i){var r=i.boundsRect,a=i.maskTexture;BFN.TextureUtils.textureToBlob(a,{isTransparent:!1,mimeType:"image/jpeg",quality:.5}).then(function(i){var c=(new BFN.MenuImageVO).createId("text_mask");BFN.ProjectService.setLocalAsset("editor","image",c,i).then(function(){l(),o.maskImageID=t.id,o.maskImageMaskID=c,o.maskImageFrameWidth=r.width,o.maskImageFrameHeight=r.height;var i=[0,1,3,2][(e.flippedHorizontal?1:0)+(e.flippedVertical?2:0)],h=n.transformLayer.toLocal(e.textPolygon[i],e),d=new PIXI.Point(h.x,h.y);e.flippedHorizontal&&(d.x-=Math.cos(o.transformRotation)*r.width,d.y-=Math.sin(o.transformRotation)*r.width),e.flippedVertical&&(d.x-=Math.cos(o.transformRotation+Math.PI/2)*r.height,d.y-=Math.sin(o.transformRotation+Math.PI/2)*r.height);var m=r.x*(e.flippedHorizontal?-1:1),p=r.y*(e.flippedVertical?-1:1),g=Math.sqrt(Math.pow(m,2)+Math.pow(p,2)),f=Math.atan2(p,m);d.x+=Math.cos(o.transformRotation+f)*g,d.y+=Math.sin(o.transformRotation+f)*g,o.transformX=d.x,o.transformY=d.y,s={type:"frame_texture",texture:t.imageTexture,maskTexture:a},u()})})})}o||BFN.TransformStateModel.safeThumbImages.splice(0),BFN.TransformModel.targetTransformItem=null}},{key:"saveImageAsLayer",value:function(e){var t=this;if(e.isSaved)BeFunky.logError("Sorry, this image is already saved");else if(BFN.BfnService.userLoggedIn)BFN.BfnService.getTexturesForMenuImageVOs([e]).then(function(){if(!e.imageTexture)return BeFunky.logError("Unable to generate texture for MenuImageVO",e);BFN.UploadSaveShareManager.altSaveTexture=e.imageTexture;var n=e.name||"";BFN.UploadSaveShareManager.setFileName(void 0,"layer",n),BFN.UploadSaveShareManager.handleSaveOrShareImage("save","befunky",function(){e.isSaved=!0,t.updateImageStore();var n=t.getIndex(e.id);t.sidebar.removeItem(e.id),t.sidebar.addItem(e,n),BeFunky.ImagesService.resetImageData()})});else{var n=function n(){BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,n),BFN.BfnService.userLoggedIn&&t.saveImageAsLayer(e)};BeFunky.confirm("confirm_layer_save_login",{onConfirm:function(){BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,n),BFN.BfnService.login(),setTimeout(function(){return BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,n)},1e4)},confirmText:"yes",cancelText:"no"})}}},{key:"deleteImage",value:function(e){var t=this,n=BFN.getImageType(e);if(["befunky_photo","befunky_layer"].includes(n)){var i=e.replace("".concat(n,"_"),""),r="befunky_photo"===n;BeFunky.confirm(r?"confirm_delete_befunky_photo":"confirm_delete_befunky_layer",{onConfirm:function(){BFN.ImageLibraryService.deleteBeFunkyPhoto.bind(BFN.ImageLibraryService)(i,{showLoadScreen:{isCancellable:!1}}).then(function(){t.removeImage(e);var n=t.imageLibraryModal.getGalleryConfig("befunky").gallery;n.images=n.images.filter(function(t){return t.id!==e}),UIMessages.display("deleted"),BeFunky.ImagesService.resetImageData()}).catch(function(e){BeFunky.logError("Unable to delete ".concat(r?"photo":"layer"),e)})},confirmText:"yes",cancelText:"no"})}else BeFunky.logError("Only BeFunky Photos & Layers can be deleted")}},{key:"modifier",value:function(e){return e.replace(/[^0-9a-z-]/gi,"-").replace(/-{2,}/g,"-").replace(/^-|-$/g,"").toLowerCase()}},{key:"handleImageSelection",value:function(e,t){return t?this.addImage(e):this.removeImage(e.id),!0}},{key:"handleImageLoaded",value:function(e){var t=e.menuImageVO,n=(e.file,e.isComplete),i=null,r=null;switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:i=BFN.PhotoEditorCanvasModel,r="editor_main";break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:i=BFN.CollageMakerCanvasModel,r="collage_main";break;case BFN.AppModelViewStates.VIEWING_DESIGNER:i=BFN.DesignerCanvasModel,r="designer_main"}i&&(n?"image_manager"!==UITools.getToolValue(r,"updating_id")&&(UITools.setToolValue(r,"image_manager",!0),UITools.applyTool(r),UITools.setToolValue(r,"image_manager",!1)):t&&this.addImage(t,{updateImageGalleryItem:!1,scrollToBottom:!1}))}},{key:"mode",set:function(e){e&&["IMAGE_MANAGER","UPLOAD_MENU"].includes(e)?e!==this._mode&&(this._mode=e,this.imageLibraryModal&&this.imageLibraryModal.setState({mode:e}),this.stockSearchModal.updateGalleryItemSelectionState&&this.stockSearchModal.updateGalleryItemSelectionState()):BeFunky.logError("Invalid Image Library Manager mode specified")},get:function(){return this._mode}},{key:"bucketBaseTextures",get:function(){for(var e=this.sampleMenuImageVOs.concat(this.selectedMenuImageVOs),t=[],n=0;n<e.length;n++){var i=e[n];i.imageTexture&&i.imageTexture.valid&&t.push(i.imageTexture.baseTexture)}return e.splice(0),e=null,t}}]),e}();function dm(){var e=g(['<image-gallery\n            class="graphic-library__results-gallery"\n            .rowHeight=',"\n            .currentWidth=","\n            .onSelectItem=","\n            .extendItemTemplate=","\n            .selectedImageIDs=","\n            .imagePadding=","\n            .gutterWidth=","\n            .singleRow=","\n        ></image-gallery>"]);return dm=function(){return e},e}function mm(){var e=g(['\n            <div class="graphics-editors-choice__row">\n                <div class="graphics-editors-choice__row-header">\n                    <p class="graphics-editors-choice__row-heading">','</p>\n                    <button class="button button--link button--sm graphics-editors-choice__see-all" @click=',">","</button>\n                </div>\n                ","\n            </div>\n        "]);return mm=function(){return e},e}function pm(){var e=g(['<div class="graphics-editors-choice">',"</div>"]);return pm=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.ImageLibraryManager=new hm});var gm=BeFunky.lit,fm=gm.html,vm=gm.lang,ym=gm.elem;function xm(e,t,n,i,r){var a=1300,o=i,s=e.map(function(e){var t;e.tagID,e.graphicData;return t=BFN.GraphicLibraryManager.selectedGraphics.map(function(e){return e.id}),ym(dm(),120,a,BFN.GraphicLibraryManager.handleGraphicSelection.bind(BFN.GraphicLibraryManager),n,t,16,8,!0)});u(r,i);var l=ym(pm(),e.map(function(e,n){var i=e.title,r=e.tagID;return fm(mm(),vm(i,"modal"),function(){return t({tagID:r,style:o})},vm("view_all","modal"),s[n])}));return l.updateGalleries=u,l;function u(t,n){o=n;var i=BFN.GraphicLibraryManager.selectedGraphics.map(function(e){return e.id});s.forEach(function(r,o){var s=e[o].graphicData;r.images=s[n].slice(0,Math.round(t/a*10)),r.currentWidth=t,r.selectedImageIDs=i})}}function _m(){var e=g(['\n            <div class="badge badge--plus gallery__badge"></div>\n        ']);return _m=function(){return e},e}function Im(){var e=g(['<image-gallery\n            class="graphic-library__results-gallery"\n            .rowHeight=',"\n            .currentWidth=","\n            .onSelectItem=","\n            .extendItemTemplate=","\n            .selectedImageIDs=","\n            .imagePadding=","\n            .gutterWidth=","\n        ></image-gallery>"]);return Im=function(){return e},e}function Tm(){var e=g(['\n            <div class="editors-choice editors-choice--loading">\n                <div><span class="loading-spinner"></span> <string>',"</string></div>\n            </div>\n            "]);return Tm=function(){return e},e}function bm(){var e=g(['\n            <button class="button button--circle button--white-outline button--icon button--xs graphic-library__clear-results" @click=',' data-tooltip="cancel">\n                ',"\n            </button>\n        "]);return bm=function(){return e},e}function Sm(){var e=g(['\n            <div class="graphic-library__results-header">\n                <h3 class="graphic-library__results-heading">',"</h3>\n                ","\n            </div>\n        "]);return Sm=function(){return e},e}function Cm(){var e=g(["<button class=",' @click="','">',"</button>"]);return Cm=function(){return e},e}function Bm(){var e=g(['\n            <div class="panel-header panel-header--modal-section graphic-library__tags-header">\n                <h3 class="panel-header__text panel-header__text--modal-section panel-header__text--wide">','</h3>\n            </div>\n            <div class="graphic-library__tags scrollable-content">\n                <div>\n                    ',"\n                </div>\n            </div>\n        "]);return Bm=function(){return e},e}function Fm(){var e=g(['\n        <div class="graphic-library__editors-choice-buttons-container">\n            <button\n            class="','" @click=',"\n            >",'\n            </button>\n            <button\n            class="','" @click=',"\n            >","\n            </button>\n        </div>\n        "]);return Fm=function(){return e},e}function Em(){var e=g(['\n        <div class="graphic-library__styles-container">\n            <div class="panel-header">\n                <h3 class="panel-header__text panel-header__text--modal-section panel-header__text--wide">','</h3>\n            </div>\n            <div class="graphic-library__styles">\n                <button class="','" @click=',">",'</button>\n                <button class="','" @click=',">",'</button>\n                <button class="','" @click=',">",'</button>\n                <button class="','" @click=',">","</button>\n            </div\n        </div>\n        "]);return Em=function(){return e},e}function Pm(){var e=g(['<div class="graphics-library__search-autocomplete"></div>']);return Pm=function(){return e},e}function km(){var e=g(['<input type="search" class="input search-box__input graphics-library__search-input" required>']);return km=function(){return e},e}function Nm(){var e=g(['\n            <form role="search" class="search-box graphic-library__search-box">\n                ',"\n                ",'\n                <button type="reset" class="button button--icon button--md button--white-outline search-box__clear">\n                    ','\n                </button>\n                <button type="submit" class="button button--icon button--md button--white-outline search-box__submit" @click="','">\n                    ',"\n                </button>\n            </form>\n        "]);return Nm=function(){return e},e}function Mm(){var e=g(['<panel-header lang-id="graphic_library" modifier="modal" buttons="close"></panel-header>']);return Mm=function(){return e},e}function Dm(){var e=g(['\n        <div class="graphic-preview"></div>\n        ','\n        <div class="modal__body graphic-library__body">\n            <div class="graphic-library__left-panel">\n                ','\n                <div class="graphic-library__left-panel-options scrollable-content">\n                    ',"\n                    ","\n                    ",'\n                </div>\n            </div>\n            <div class="graphic-library__right-panel">\n                ','\n                <div class="scrollable-content scrollable-content--modal-right-panel" style=',">\n                    ","\n                </div>\n            </div>\n        </div>\n        "]);return Dm=function(){return e},e}function wm(){var e=g(['<div id="graphic_library" class="modal modal--button-sm graphic-library"></div>']);return wm=function(){return e},e}var Lm=BeFunky.lit,Om=Lm.html,Rm=Lm.setupState,Am=Lm.render,Vm=Lm.lang,Um=Lm.elem,Gm=Lm.icon;function Hm(e){var t,n,i,r,a=Um(wm()),o=["abstract_shapes","geometric_shapes","lines","arrows","social_media","badges","wedding","birthday","ribbons","ornaments","floral","travel","music","food","accessories","weddings","birthdays","animals","speech_bubbles","hearts","emojis","businesses","technology","fashion","sports","nature","real_estate","lifestyle","people","education","infographics"].filter(function(t){return e.includes(t)}),s={mode:"EDITORS_CHOICE",placeholderTags:[],editorsChoiceGraphics:{},searchTerm:"",tagName:"",tagID:"editors_choice",lastSearchTerm:"",lastSearchStyle:"",lastSearchPage:"",searchStyle:"all",currentWidth:1600},l=BeFunky.debounce(function(){var e,n,i;Am(Om(Dm(),g,Om(Nm(),_,I,Gm("cancel-icon","icon icon--12"),b,Gm("search-icon","icon")),Om(Fm(),"button button--grey-200 button--left-align button--fullwidth graphic-library__button ".concat("EDITORS_CHOICE"===c.mode?"button--selected":""),B,Vm("editors_choice","modal"),"button button--grey-200 button--left-align button--fullwidth graphic-library__button ".concat("ALL_GRAPHICS"===c.mode?"button--selected":""),C,Vm("browse_all_graphics","modal")),(i="button button--grey-200 button--left-align button--fullwidth graphic-library__style button--selected",Om(Em(),Vm("style"),"all"===c.searchStyle?i:"button button--grey-200 button--left-align button--fullwidth graphic-library__style",F("all"),Vm("all_graphic_styles"),"line"===c.searchStyle?i:"button button--grey-200 button--left-align button--fullwidth graphic-library__style",F("line"),Vm("outline"),"solid"===c.searchStyle?i:"button button--grey-200 button--left-align button--fullwidth graphic-library__style",F("solid"),Vm("solid"),"color"===c.searchStyle?i:"button button--grey-200 button--left-align button--fullwidth graphic-library__style",F("color"),Vm("multicolor"))),Om(Bm(),Vm("popular_tags"),o.map(function(e){return Om(Cm(),c.searchTerm===e?"chip chip--selected graphic-library__tag":"chip graphic-library__tag",function(e){return function(){E({tagID:e,style:c.searchStyle})}}(e),k(e))})),(e={EDITORS_CHOICE:"editors_choice",SEARCH:["search_results_for",{query:"<strong>".concat(BeFunky.escapeHTML(c.tagName),"</strong>")}],TAG:c.tagName,ALL_GRAPHICS:"all_graphics"},n="SEARCH"===c.mode,e[c.mode]||BeFunky.throwError("Mode not handled!!!",c.mode),Om(Sm(),Vm(e[c.mode],"modal"),n?Om(bm(),S,Gm("cancel-icon","icon icon--10")):"")),"--scrollable-content-width: ".concat(N(),"px"),"EDITORS_CHOICE"===c.mode?c.editorsChoiceGraphics.length?(t?t.updateGalleries(N(),c.searchStyle):t=xm(c.editorsChoiceGraphics,E,P,c.searchStyle,N()),t):Om(Tm(),Vm("loading","modal")):y),a)},"raf"),u=f(Rm(s,l),2),c=u[0],h=u[1],d=BeFunky.setupInfiniteScroll(function(){return a.querySelector(".scrollable-content--modal-right-panel")}),m=d.listenForScroll,p=d.recalculateScrollPosition,g=Um(Mm()),y=(n=BFN.GraphicLibraryManager.selectedGraphics.map(function(e){return e.id}),Um(Im(),150,N(),BFN.GraphicLibraryManager.handleGraphicSelection.bind(BFN.GraphicLibraryManager),P,n,16,8)),x=f((i=Um(km()),r=Um(Pm()),i.setLang("search_graphics","modal"),BeFunky.autocomplete(r,{inputElement:i,minValueLength:3,allowEmpty:!0,generateItem:function(e){return{html:e.length&&"all_items"!==e?BeFunky.LanguageManager.getStringReplacements("search_for",{query:BeFunky.escapeHTML(e)}):BeFunky.LanguageManager.getString("display_all_graphics"),index:0}},options:e.map(function(e){return{id:e,label:k(e)}}),onSelect:function(e){return E({tagID:e.id,tagName:e.label})}}),[i,r]),2),_=x[0],I=x[1],T=null;return y.images=[],BeFunky.LanguageManager.addLanguageUpdateListener(function(){t=!1,l()}),Object.assign(a,{open:function(e){BeFunky.openModal(a,{onOpen:function(){e?E({tagID:e}):"editors_choice"===c.tagID&&B()},onWindowResize:function(e){var t=e.availableWidth;h({currentWidth:t}),y.currentWidth=N(),p()},size:"xxl"})},updateSelectedGraphics:function(){y.selectedImageIDs=BFN.GraphicLibraryManager.selectedGraphics.map(function(e){return e.id}),t&&t.updateGalleries(N(),c.searchStyle)}}),a;function b(e){e&&e.preventDefault(),E({tagName:document.querySelector(".graphics-library__search-input").value.replace(/[`~!@#$%^&*()_|+=?;:'",.<>{}[\]\\/]/gi," ").replace(/ {2,}/g," ").trim()})}function S(){E({tagID:"all_items"})}function C(){E({tagID:"all_items"})}function B(){!function(){if(c.editorsChoiceGraphics.length)return;function e(e,t){return e.isPlus&&!t.isPlus?1:-1}BFN.GraphicLibraryService.getEditorsChoiceGraphics().then(function(t){var n=[];Object.keys(t).forEach(function(i,r){t[i].data.tags.forEach(function(t){var a=t.tag,o=t.title,s=t.items,l={all:[]};0===r?n.push({tagID:a,title:o,graphicData:l}):l=n.find(function(e){var t=e.tagID;return t===a}).graphicData;var u=BFN.GraphicLibraryService.graphicDataToMenuImageVO(s);l[i]=u.shuffle().sort(e),l.all=[].concat(v(l.all),v(u.slice(0,4))).shuffle().sort(e)})}),h({editorsChoiceGraphics:n})})}(),h({mode:"EDITORS_CHOICE",tagID:"editors_choice",lastSearchTerm:"",searchTerm:""}),_.value=""}function F(e){return function(){if("EDITORS_CHOICE"===c.mode)return h({searchStyle:e}),void(t&&t.updateGalleries(N(),e));E({style:e,tagName:c.searchTerm,tagID:c.searchTerm})}}function E(t){var n=t.tagID,i=void 0===n?"":n,r=t.tagName,a=void 0===r?"":r,o=t.style,s=void 0===o?"all":o,l=t.page,u=void 0===l?1:l;if(i||(i=function(e){return""===e?"all_items":e.trim().replace(/[^a-z0-9\s]/gi,"").split(/\s+/).map(function(e){return e.toLowerCase()}).join("_").replace(/_+/g,"_")}(a)),i=e.includes(i)?i:"",a=k(i)||a,!i&&!a)throw new Error("Invalid tag name or ID");var d=i||a,p=s;if(d||(d="all_items"),!(d===c.lastSearchTerm&&p===c.lastSearchStyle&&u===c.lastSearchPage||d.length<=2)){T&&T.abort();var g="SEARCH";i&&"all_items"!==i&&(g="TAG"),i&&"all_items"===i&&(g="ALL_GRAPHICS"),h({lastSearchTerm:d,lastSearchStyle:p,lastSearchPage:u,searchTerm:d,searchStyle:p,tagName:a,tagID:i,mode:g}),_.value="ALL_GRAPHICS"===c.mode?"":a,1===u&&(y.images=[],y.scrollTop=0);var f=BFN.GraphicLibraryService.getGraphics(d,s,u,100);T=f.request,y.message="",y.isLoading=!0;var x=1===u&&"ALL_GRAPHICS"!==c.mode;f.then(function(e){console.log("Got ".concat(e.length," results for page ").concat(u));var t=u;y.isLoading=!1,y.images=[].concat(v(y.images),v(e)),x&&BFN.BfnService.track("GRAPHICS","SEARCH","".concat(s," : ").concat(d));var n=function(){E({tagID:i,tagName:a,style:s,page:++t})};e.length>=100&&m(function(){return d!==c.lastSearchTerm||s!==c.lastSearchStyle||u!==c.lastSearchPage},n)}).catch(function(e){if(y.isLoading=!1,"no_results"===e)y.emptyState={imageUrl:"".concat(BFN.imagesURL,"app/illustrations/no-search-results-canvas.svg"),text:BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'<strong>"'.concat(BeFunky.escapeHTML(c.searchTerm),'"</strong>')})},x&&BFN.BfnService.track("GRAPHICS","EMPTY_SEARCH","".concat(s," : ").concat(c.searchTerm));else{if("request_failed"===e&&f.request.wasAborted)return;y.message={isError:!0,text:BeFunky.failureReason(e),buttonText:"try_again",buttonAction:function(){return E({tagID:i,tagName:a})}},h({lastSearchTerm:null})}})}}function P(e){return!e.isPlus||BFN.BfnService.userIsPlus?"":Om(_m())}function k(e){return e.split("_").map(function(e,t){if(0===t||e.length>2&&"the"!==e||"my"===e)return e.charAt(0).toUpperCase()+e.slice(1);return e}).join(" ").replace("s Day","'s Day").replace("St ","St. ").replace("Youtube","YouTube")}function N(){return c.currentWidth-272-48}}var zm=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.selectedGraphics=[],BFN.IndexedDB.get("options__selectedGraphics").then(function(t){Array.isArray(t)&&t.reverse().forEach(function(t){return e.addGraphic(t,{useTracking:!1})})}).catch(function(e){BeFunky.logError("Unable to fetch previous session's selectedGraphics from IndexedDB",e)}),this.modal=null,document.getElementById("editor_graphic_search").addEventListener("click",function(){return e.openModal()}),this.sidebar=document.getElementById("graphic_manager"),BFN.UI.graphicManager(this.sidebar),this.isCategoryMenuSetup=!1,this.updateGraphicStore=BeFunky.debounce(this.updateGraphicStore,0)}},{key:"handleGraphicCategory",value:function(){var e=UITools.getToolValue("editor_graphic","updating_id");"add_layer"===e?(BFN.ImageLibraryManager.uploadImages(function(e){var t=e.menuImageVO;t&&BFN.ImageLibraryManager.addImageToCanvas(t,{forceLayer:!0})},{allowMultiple:!1}),BFN.BfnService.track("CREATE","GOODIES","ADD_YOUR_OWN")):BFN.GraphicLibraryManager.openModal(e)}},{key:"openModal",value:function(e){var t=this;if(this.modal)return this.modal.open(e);BFN.GraphicLibraryService.getTags().then(function(n){t.modal||(t.modal=Hm(n)),t.modal.open(e)},function(e){return BeFunky.logError("Unable to fetch tags before opening Graphic Search modal",e)})}},{key:"addGraphic",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.cloneObject,a=void 0===r||r,o=i.index,s=void 0===o?0:o,l=i.updateImageGalleryItem,u=void 0===l||l;i.useTracking;if(!e.id)throw"MenuImageVO missing id";-1===this.getIndex(e.id)&&(a||e instanceof BFN.MenuImageVO||(a=!0,BeFunky.throwError("MenuImageVO cloning forced on plain object",e)),a?((t=new BFN.MenuImageVO).setObject(e),t.style=e.style):t=e,this.selectedGraphics.splice(s,0,t),e.indexedDBKey&&BFN.ProjectService.setLocalAsset("graphicmanager","image",e.id,void 0,!0),requestAnimationFrame(function(){n.sidebar.addItem(t,s);var e=n.sidebar.accordion;e.scrollTop=0,e.activeSections.includes("your_graphics")||(e.activeSections=[].concat(v(e.activeSections),["your_graphics"]))}),u&&this.modal&&this.modal.updateSelectedGraphics(this.selectedGraphics),this.updateGraphicStore())}},{key:"removeGraphic",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.updateImageGalleryItem,r=void 0===i||i,a=n.usedBaseTextures,o=void 0===a?null:a,s=this.getIndex(e);if(-1!==s){o||(o=BFN.GlobalHistoryModel.getUsedBaseTextures());var l=this.selectedGraphics[s];l.imageTexture&&l.imageTexture.valid&&l.imageTexture.baseTexture&&!o.includes(l.imageTexture.baseTexture)&&(l.imageTexture.destroyGC(!0),l.imageTexture=null),this.selectedGraphics.splice(s,1),BFN.ProjectService.removeLocalAsset("graphicmanager","image",e),requestAnimationFrame(function(){return t.sidebar.removeItem(e)}),r&&this.modal&&this.modal.updateSelectedGraphics(this.selectedGraphics),this.updateGraphicStore()}}},{key:"getIndex",value:function(e){if(e.startsWith("graphic_"))return this.selectedGraphics.findIndex(function(t){return t.id===e});BeFunky.throwError("Invalid Graphic MenuImageVO ID: ".concat(e))}},{key:"getMenuImageVO",value:function(e){if(e.startsWith("graphic_"))return this.selectedGraphics.find(function(t){return t.id===e});BeFunky.throwError("Invalid Graphic MenuImageVO ID: ".concat(e))}},{key:"updateGraphicStore",value:function(){var e=this.selectedGraphics.map(function(e){return e.getObject()});BFN.IndexedDB.set("options__selectedGraphics",e).catch(function(e){return BeFunky.logError("Unable to update selectedGraphics in IndexedDB",e)})}},{key:"loadTagsAndSetupMenu",value:function(){this.isCategoryMenuSetup||(this.isCategoryMenuSetup=!0,BFN.GraphicLibraryService.getTags().catch(function(e){return BeFunky.logError("Unable to pre-emptively load tags when entering Graphics menu",e)}),BFN.GraphicLibraryService.getEditorsChoiceGraphics().catch(function(e){return BeFunky.logError("Unable to pre-emptively load editors choice graphics when entering Graphics menu",e)}))}},{key:"modifier",value:function(e){return e.replace(/[^0-9a-z-]/gi,"-").replace(/-{2,}/g,"-").replace(/^-|-$/g,"").toLowerCase()}},{key:"handleGraphicSelection",value:function(e,t){return t&&e.isPlus&&!BFN.BfnService.userIsPlus?(BFN.BfnService.upgrade("GOODIES","".concat(e.trackingID,"_UPGRADE")),BFN.UserActionManager.addUpgradeAction(["Add Plus Graphic"],!1),!1):(t?this.addGraphic(e):this.removeGraphic(e.id),!0)}}]),e}();function jm(){var e=BeFunky.LanguageManager.language.app;return BeFunky.openModal("settings_menu",{size:"extra-small",onClose:function(){window.bfn_mp&&BeFunky.LanguageManager.language.app!==e&&window.bfn_mp.track("app_language_changed")}})}BFN.SingletonQueue.add(function(){BFN.GraphicLibraryManager=new zm});var Xm=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("AccountManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.welcomed=!1,this.accountMenu=document.getElementById("account_menu"),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this))}},{key:"handleAccountAction",value:function(){var e=UITools.getToolVO("user_account");if(e)switch(e.updating_id){case"upgrade":BFN.BfnService.upgrade("GLOBALMENU",void 0,"top_nav_bar"),BFN.UserActionManager.addUpgradeAction(["Top Nav Bar"]);break;case"sign_in":BFN.BfnService.login();break;case"sign_up":BFN.BfnService.register();break;case"logout":BFN.BfnService.signOut();break;case"settings":jm();break;case"feedback":this.accountMenu.showFeedbackForm()}}},{key:"handleUserDataChanged",value:function(e){BFN.BfnService.userLoggedIn?(BeFunky.isPlus()?(this.accountMenu.accountMode="plus_user",BFN.applyCancelMenu.upgradeMode=!1):(this.accountMenu.accountMode="free_user",BFN.applyCancelMenu.upgradeMode=!0),this.welcomed||(this.welcomed=!0,setTimeout(function(){BeFunky.waitUntil({condition:function(){return BeFunky.LanguageManager.isTranslated("welcome_user")},onSuccess:function(){requestAnimationFrame(function(){var e=BeFunky.LanguageManager.getStringReplacements("welcome_user",{user:BeFunky.User.username||""});UIMessages.display(e)})},onTimeout:function(){}})},333))):(this.accountMenu.accountMode="non_user",BFN.applyCancelMenu.upgradeMode=!0)}}]),n}();BFN.SingletonQueue.add(function(){BFN.AccountManager=new Xm});var Wm,Ym=pt(function(e){!function(){function t(e,t,n){return e.call.apply(e.bind,arguments)}function n(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function i(e,r,a){return(i=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t:n).apply(null,arguments)}var r=Date.now||function(){return+new Date};function a(e,t){this.a=e,this.o=t||e,this.c=this.o.document}var o=!!window.FontFace;function s(e,t,n,i){if(t=e.c.createElement(t),n)for(var r in n)n.hasOwnProperty(r)&&("style"==r?t.style.cssText=n[r]:t.setAttribute(r,n[r]));return i&&t.appendChild(e.c.createTextNode(i)),t}function l(e,t,n){(e=e.c.getElementsByTagName(t)[0])||(e=document.documentElement),e.insertBefore(n,e.lastChild)}function u(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t,n){t=t||[],n=n||[];for(var i=e.className.split(/\s+/),r=0;r<t.length;r+=1){for(var a=!1,o=0;o<i.length;o+=1)if(t[r]===i[o]){a=!0;break}a||i.push(t[r])}for(t=[],r=0;r<i.length;r+=1){for(a=!1,o=0;o<n.length;o+=1)if(i[r]===n[o]){a=!0;break}a||t.push(i[r])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function h(e,t){for(var n=e.className.split(/\s+/),i=0,r=n.length;i<r;i++)if(n[i]==t)return!0;return!1}function d(e,t,n){function i(){c&&r&&a&&(c(u),c=null)}t=s(e,"link",{rel:"stylesheet",href:t,media:"all"});var r=!1,a=!0,u=null,c=n||null;o?(t.onload=function(){r=!0,i()},t.onerror=function(){r=!0,u=Error("Stylesheet failed to load"),i()}):setTimeout(function(){r=!0,i()},0),l(e,"head",t)}function m(e,t,n,i){var r=e.c.getElementsByTagName("head")[0];if(r){var a=s(e,"script",{src:t}),o=!1;return a.onload=a.onreadystatechange=function(){o||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(o=!0,n&&n(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&r.removeChild(a))},r.appendChild(a),setTimeout(function(){o||(o=!0,n&&n(Error("Script load timeout")))},i||5e3),a}return null}function p(){this.a=0,this.c=null}function g(e){return e.a++,function(){e.a--,v(e)}}function f(e,t){e.c=t,v(e)}function v(e){0==e.a&&e.c&&(e.c(),e.c=null)}function y(e){this.a=e||"-"}function x(e,t){this.c=e,this.f=4,this.a="n";var n=(t||"n4").match(/^([nio])([1-9])$/i);n&&(this.a=n[1],this.f=parseInt(n[2],10))}function _(e){var t=[];e=e.split(/,\s*/);for(var n=0;n<e.length;n++){var i=e[n].replace(/['"]/g,"");-1!=i.indexOf(" ")||/^\d/.test(i)?t.push("'"+i+"'"):t.push(i)}return t.join(",")}function I(e){return e.a+e.f}function T(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function b(e){var t=4,n="n",i=null;return e&&((i=e.match(/(normal|oblique|italic)/i))&&i[1]&&(n=i[1].substr(0,1).toLowerCase()),(i=e.match(/([1-9]00|normal|bold)/i))&&i[1]&&(/bold/i.test(i[1])?t=7:/[1-9]00/.test(i[1])&&(t=parseInt(i[1].substr(0,1),10)))),n+t}function S(e,t){this.c=e,this.f=e.o.document.documentElement,this.h=t,this.a=new y("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function C(e){if(e.g){var t=h(e.f,e.a.c("wf","active")),n=[],i=[e.a.c("wf","loading")];t||n.push(e.a.c("wf","inactive")),c(e.f,n,i)}B(e,"inactive")}function B(e,t,n){e.j&&e.h[t]&&(n?e.h[t](n.c,I(n)):e.h[t]())}function F(){this.c={}}function E(e,t){this.c=e,this.f=t,this.a=s(this.c,"span",{"aria-hidden":"true"},this.f)}function P(e){l(e.c,"body",e.a)}function k(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+_(e.c)+";font-style:"+T(e)+";font-weight:"+e.f+"00;"}function N(e,t,n,i,r,a){this.g=e,this.j=t,this.a=i,this.c=n,this.f=r||3e3,this.h=a||void 0}function M(e,t,n,i,r,a,o){this.v=e,this.B=t,this.c=n,this.a=i,this.s=o||"BESbswy",this.f={},this.w=r||3e3,this.u=a||null,this.m=this.j=this.h=this.g=null,this.g=new E(this.c,this.s),this.h=new E(this.c,this.s),this.j=new E(this.c,this.s),this.m=new E(this.c,this.s),e=k(e=new x(this.a.c+",serif",I(this.a))),this.g.a.style.cssText=e,e=k(e=new x(this.a.c+",sans-serif",I(this.a))),this.h.a.style.cssText=e,e=k(e=new x("serif",I(this.a))),this.j.a.style.cssText=e,e=k(e=new x("sans-serif",I(this.a))),this.m.a.style.cssText=e,P(this.g),P(this.h),P(this.j),P(this.m)}y.prototype.c=function(e){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},N.prototype.start=function(){var e=this.c.o.document,t=this,n=r(),i=new Promise(function(i,a){!function o(){r()-n>=t.f?a():e.fonts.load(function(e){return T(e)+" "+e.f+"00 300px "+_(e.c)}(t.a),t.h).then(function(e){1<=e.length?i():setTimeout(o,25)},function(){a()})}()}),a=null,o=new Promise(function(e,n){a=setTimeout(n,t.f)});Promise.race([o,i]).then(function(){a&&(clearTimeout(a),a=null),t.g(t.a)},function(){t.j(t.a)})};var D={D:"serif",C:"sans-serif"},w=null;function L(){if(null===w){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);w=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return w}function O(e,t,n){for(var i in D)if(D.hasOwnProperty(i)&&t===e.f[D[i]]&&n===e.f[D[i]])return!0;return!1}function R(e){var t,n=e.g.a.offsetWidth,a=e.h.a.offsetWidth;(t=n===e.f.serif&&a===e.f["sans-serif"])||(t=L()&&O(e,n,a)),t?r()-e.A>=e.w?L()&&O(e,n,a)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?A(e,e.v):A(e,e.B):function(e){setTimeout(i(function(){R(this)},e),50)}(e):A(e,e.v)}function A(e,t){setTimeout(i(function(){u(this.g.a),u(this.h.a),u(this.j.a),u(this.m.a),t(this.a)},e),0)}function V(e,t,n){this.c=e,this.a=t,this.f=0,this.m=this.j=!1,this.s=n}M.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=r(),R(this)};var U=null;function G(e){0==--e.f&&e.j&&(e.m?((e=e.a).g&&c(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),B(e,"active")):C(e.a))}function H(e){this.j=e,this.a=new F,this.h=0,this.f=this.g=!0}function z(e,t,n,r,a){var o=0==--e.h;(e.f||e.g)&&setTimeout(function(){var e=a||null,s=r||{};if(0===n.length&&o)C(t.a);else{t.f+=n.length,o&&(t.j=o);var l,u=[];for(l=0;l<n.length;l++){var h=n[l],d=s[h.c],m=t.a,p=h;if(m.g&&c(m.f,[m.a.c("wf",p.c,I(p).toString(),"loading")]),B(m,"fontloading",p),m=null,null===U)if(window.FontFace){p=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var g=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);U=p?42<parseInt(p[1],10):!g}else U=!1;m=U?new N(i(t.g,t),i(t.h,t),t.c,h,t.s,d):new M(i(t.g,t),i(t.h,t),t.c,h,t.s,e,d),u.push(m)}for(l=0;l<u.length;l++)u[l].start()}},0)}function j(e,t){this.c=e,this.a=t}function X(e,t){this.c=e,this.a=t}function W(e,t){this.c=e||Y,this.a=[],this.f=[],this.g=t||""}V.prototype.g=function(e){var t=this.a;t.g&&c(t.f,[t.a.c("wf",e.c,I(e).toString(),"active")],[t.a.c("wf",e.c,I(e).toString(),"loading"),t.a.c("wf",e.c,I(e).toString(),"inactive")]),B(t,"fontactive",e),this.m=!0,G(this)},V.prototype.h=function(e){var t=this.a;if(t.g){var n=h(t.f,t.a.c("wf",e.c,I(e).toString(),"active")),i=[],r=[t.a.c("wf",e.c,I(e).toString(),"loading")];n||i.push(t.a.c("wf",e.c,I(e).toString(),"inactive")),c(t.f,i,r)}B(t,"fontinactive",e),G(this)},H.prototype.load=function(e){this.c=new a(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,function(e,t,n){var i=[],r=n.timeout;!function(e){e.g&&c(e.f,[e.a.c("wf","loading")]),B(e,"loading")}(t);var i=function(e,t,n){var i,r=[];for(i in t)if(t.hasOwnProperty(i)){var a=e.c[i];a&&r.push(a(t[i],n))}return r}(e.a,n,e.c),a=new V(e.c,t,r);for(e.h=i.length,t=0,n=i.length;t<n;t++)i[t].load(function(t,n,i){z(e,a,t,n,i)})}(this,new S(this.c,e),e)},j.prototype.load=function(e){var t=this,n=t.a.projectId,i=t.a.version;if(n){var r=t.c.o;m(this.c,(t.a.api||"https://fast.fonts.net/jsapi")+"/"+n+".js"+(i?"?v="+i:""),function(i){i?e([]):(r["__MonotypeConfiguration__"+n]=function(){return t.a},function t(){if(r["__mti_fntLst"+n]){var i,a=r["__mti_fntLst"+n](),o=[];if(a)for(var s=0;s<a.length;s++){var l=a[s].fontfamily;null!=a[s].fontStyle&&null!=a[s].fontWeight?(i=a[s].fontStyle+a[s].fontWeight,o.push(new x(l,i))):o.push(new x(l))}e(o)}else setTimeout(function(){t()},50)}())}).id="__MonotypeAPIScript__"+n}else e([])},X.prototype.load=function(e){var t,n,i=this.a.urls||[],r=this.a.families||[],a=this.a.testStrings||{},o=new p;for(t=0,n=i.length;t<n;t++)d(this.c,i[t],g(o));var s=[];for(t=0,n=r.length;t<n;t++)if((i=r[t].split(":"))[1])for(var l=i[1].split(","),u=0;u<l.length;u+=1)s.push(new x(i[0],l[u]));else s.push(new x(i[0]));f(o,function(){e(s,a)})};var Y="https://fonts.googleapis.com/css";function q(e){this.f=e,this.a=[],this.c={}}var K={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Q={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Z={i:"i",italic:"i",n:"n",normal:"n"},J=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function $(e,t){this.c=e,this.a=t}var ee={Arimo:!0,Cousine:!0,Tinos:!0};function te(e,t){this.c=e,this.a=t}function ne(e,t){this.c=e,this.f=t,this.a=[]}$.prototype.load=function(e){var t=new p,n=this.c,i=new W(this.a.api,this.a.text),r=this.a.families;!function(e,t){for(var n=t.length,i=0;i<n;i++){var r=t[i].split(":");3==r.length&&e.f.push(r.pop());var a="";2==r.length&&""!=r[1]&&(a=":"),e.a.push(r.join(a))}}(i,r);var a=new q(r);!function(e){for(var t=e.f.length,n=0;n<t;n++){var i=e.f[n].split(":"),r=i[0].replace(/\+/g," "),a=["n4"];if(2<=i.length){var o;if(o=[],s=i[1])for(var s,l=(s=s.split(",")).length,u=0;u<l;u++){var c;if((c=s[u]).match(/^[\w-]+$/))if(null==(d=J.exec(c.toLowerCase())))c="";else{if(c=null==(c=d[2])||""==c?"n":Z[c],null==(d=d[1])||""==d)d="4";else var h=Q[d],d=h||(isNaN(d)?"4":d.substr(0,1));c=[c,d].join("")}else c="";c&&o.push(c)}0<o.length&&(a=o),3==i.length&&(o=[],0<(i=(i=i[2])?i.split(","):o).length&&(i=K[i[0]])&&(e.c[r]=i))}for(e.c[r]||(i=K[r])&&(e.c[r]=i),i=0;i<a.length;i+=1)e.a.push(new x(r,a[i]))}}(a),d(n,function(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,n=[],i=0;i<t;i++)n.push(e.a[i].replace(/ /g,"+"));return t=e.c+"?family="+n.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}(i),g(t)),f(t,function(){e(a.a,a.c,ee)})},te.prototype.load=function(e){var t=this.a.id,n=this.c.o;t?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",function(t){if(t)e([]);else if(n.Typekit&&n.Typekit.config&&n.Typekit.config.fn){t=n.Typekit.config.fn;for(var i=[],r=0;r<t.length;r+=2)for(var a=t[r],o=t[r+1],s=0;s<o.length;s++)i.push(new x(a,o[s]));try{n.Typekit.load({events:!1,classes:!1,async:!0})}catch(e){}e(i)}},2e3):e([])},ne.prototype.load=function(e){var t=this.f.id,n=this.c.o,i=this;t?(n.__webfontfontdeckmodule__||(n.__webfontfontdeckmodule__={}),n.__webfontfontdeckmodule__[t]=function(t,n){for(var r=0,a=n.fonts.length;r<a;++r){var o=n.fonts[r];i.a.push(new x(o.name,b("font-weight:"+o.weight+";font-style:"+o.style)))}e(i.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(e){return e.o.location.hostname||e.a.location.hostname}(this.c)+"/"+t+".js",function(t){t&&e([])})):e([])};var ie=new H(window);ie.a.c.custom=function(e,t){return new X(t,e)},ie.a.c.fontdeck=function(e,t){return new ne(t,e)},ie.a.c.monotype=function(e,t){return new j(t,e)},ie.a.c.typekit=function(e,t){return new te(t,e)},ie.a.c.google=function(e,t){return new $(t,e)};var re={load:i(ie.load,ie)};e.exports?e.exports=re:(window.WebFont=re,window.WebFontConfig&&ie.load(window.WebFontConfig))}()}),qm=pt(function(t,n){t.exports=function(t){var n={};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==e(t)&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)i.d(r,a,function(e){return t[e]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(t,n,i){function r(t){return(r="function"==typeof Symbol&&"symbol"==e(Symbol.iterator)?function(t){return e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)})(t)}var a=i(1),o=i(7),s=o.get,l=(o.deepValue,o.isArray),u=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,a=n.distance,o=void 0===a?100:a,l=n.threshold,u=void 0===l?.6:l,c=n.maxPatternLength,h=void 0===c?32:c,d=n.caseSensitive,m=void 0!==d&&d,p=n.tokenSeparator,g=void 0===p?/ +/g:p,f=n.findAllMatches,v=void 0!==f&&f,y=n.minMatchCharLength,x=void 0===y?1:y,_=n.id,I=void 0===_?null:_,T=n.keys,b=void 0===T?[]:T,S=n.shouldSort,C=void 0===S||S,B=n.getFn,F=void 0===B?s:B,E=n.sortFn,P=void 0===E?function(e,t){return e.score-t.score}:E,k=n.tokenize,N=void 0!==k&&k,M=n.matchAllTokens,D=void 0!==M&&M,w=n.includeMatches,L=void 0!==w&&w,O=n.includeScore,R=void 0!==O&&O,A=n.verbose,V=void 0!==A&&A;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:o,threshold:u,maxPatternLength:h,isCaseSensitive:m,tokenSeparator:g,findAllMatches:v,minMatchCharLength:x,id:I,keys:b,includeMatches:L,includeScore:R,shouldSort:C,getFn:F,sortFn:P,verbose:V,tokenize:N,matchAllTokens:D},this.setCollection(t),this._processKeys(b)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var i=e[t];this._keyWeights[i]=1,this._keyNames.push(i)}else{for(var r=0,a=0,o=e.length;a<o;a+=1){var s=e[a];if(!s.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var l=s.name;if(this._keyNames.push(l),!s.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var u=s.weight;if(u<0||u>1)throw new Error('"weight" property in key must bein the range of [0, 1)');this._keyWeights[l]=u,r+=u}if(r>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),i=n.tokenSearchers,r=n.fullSearcher,a=this._search(i,r);return this._computeScore(a),this.options.shouldSort&&this._sort(a),t.limit&&"number"==typeof t.limit&&(a=a.slice(0,t.limit)),this._format(a)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),i=0,r=n.length;i<r;i+=1)t.push(new a(n[i],this.options));return{tokenSearchers:t,fullSearcher:new a(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,i={},r=[];if("string"==typeof n[0]){for(var a=0,o=n.length;a<o;a+=1)this._analyze({key:"",value:n[a],record:a,index:a},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t});return r}for(var s=0,l=n.length;s<l;s+=1)for(var u=n[s],c=0,h=this._keyNames.length;c<h;c+=1){var d=this._keyNames[c];this._analyze({key:d,value:this.options.getFn(u,d),record:u,index:s},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t})}return r}},{key:"_analyze",value:function(e,t){var n=this,i=e.key,r=e.arrayIndex,a=void 0===r?-1:r,o=e.value,s=e.record,u=e.index,c=t.tokenSearchers,h=void 0===c?[]:c,d=t.fullSearcher,m=t.resultMap,p=void 0===m?{}:m,g=t.results,f=void 0===g?[]:g;!function e(t,r,a,o){if(null!=r)if("string"==typeof r){var s=!1,u=-1,c=0;n._log("\nKey: ".concat(""===i?"--":i));var m=d.search(r);if(n._log('Full text: "'.concat(r,'", score: ').concat(m.score)),n.options.tokenize){for(var g=r.split(n.options.tokenSeparator),v=g.length,y=[],x=0,_=h.length;x<_;x+=1){var I=h[x];n._log('\nPattern: "'.concat(I.pattern,'"'));for(var T=!1,b=0;b<v;b+=1){var S=g[b],C=I.search(S),B={};C.isMatch?(B[S]=C.score,s=!0,T=!0,y.push(C.score)):(B[S]=1,n.options.matchAllTokens||y.push(1)),n._log('Token: "'.concat(S,'", score: ').concat(B[S]))}T&&(c+=1)}u=y[0];for(var F=y.length,E=1;E<F;E+=1)u+=y[E];u/=F,n._log("Token score average:",u)}var P=m.score;u>-1&&(P=(P+u)/2),n._log("Score average:",P);var k=!n.options.tokenize||!n.options.matchAllTokens||c>=h.length;if(n._log("\nCheck Matches: ".concat(k)),(s||m.isMatch)&&k){var N={key:i,arrayIndex:t,value:r,score:P};n.options.includeMatches&&(N.matchedIndices=m.matchedIndices);var M=p[o];M?M.output.push(N):(p[o]={item:a,output:[N]},f.push(p[o]))}}else if(l(r))for(var D=0,w=r.length;D<w;D+=1)e(D,r[D],a,o)}(a,o,s,u)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,i=0,r=e.length;i<r;i+=1){for(var a=e[i],o=a.output,s=o.length,l=1,u=0;u<s;u+=1){var c=o[u],h=c.key,d=n?t[h]:1,m=0===c.score&&t&&t[h]>0?Number.EPSILON:c.score;l*=Math.pow(m,d)}a.score=l,this._log(a)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,function(e,t){if("object"===r(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t},2)),n=null}var i=[];this.options.includeMatches&&i.push(function(e,t){var n=e.output;t.matches=[];for(var i=0,r=n.length;i<r;i+=1){var a=n[i];if(0!==a.matchedIndices.length){var o={indices:a.matchedIndices,value:a.value};a.key&&(o.key=a.key),a.hasOwnProperty("arrayIndex")&&a.arrayIndex>-1&&(o.arrayIndex=a.arrayIndex),t.matches.push(o)}}}),this.options.includeScore&&i.push(function(e,t){t.score=e.score});for(var a=0,o=e.length;a<o;a+=1){var s=e[a];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var l={item:s.item},u=0,c=i.length;u<c;u+=1)i[u](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),e}();t.exports=u},function(e,t,n){var i=n(2),r=n(3),a=n(6),o=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,s=void 0===o?100:o,l=n.threshold,u=void 0===l?.6:l,c=n.maxPatternLength,h=void 0===c?32:c,d=n.isCaseSensitive,m=void 0!==d&&d,p=n.tokenSeparator,g=void 0===p?/ +/g:p,f=n.findAllMatches,v=void 0!==f&&f,y=n.minMatchCharLength,x=void 0===y?1:y,_=n.includeMatches,I=void 0!==_&&_;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:s,threshold:u,maxPatternLength:h,isCaseSensitive:m,tokenSeparator:g,findAllMatches:v,includeMatches:I,minMatchCharLength:x},this.pattern=m?t:t.toLowerCase(),this.pattern.length<=h&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,a=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var o={isMatch:!0,score:0};return a&&(o.matchedIndices=[[0,e.length-1]]),o}var s=this.options,l=s.maxPatternLength,u=s.tokenSeparator;if(this.pattern.length>l)return i(e,this.pattern,u);var c=this.options,h=c.location,d=c.distance,m=c.threshold,p=c.findAllMatches,g=c.minMatchCharLength;return r(e,this.pattern,this.patternAlphabet,{location:h,distance:d,threshold:m,findAllMatches:p,minMatchCharLength:g,includeMatches:a})}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,n),e}();e.exports=o},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,r=new RegExp(t.replace(n,"\\$&").replace(i,"|")),a=e.match(r),o=!!a,s=[];if(o)for(var l=0,u=a.length;l<u;l+=1){var c=a[l];s.push([e.indexOf(c),c.length-1])}return{score:o?.5:1,isMatch:o,matchedIndices:s}}},function(e,t,n){var i=n(4),r=n(5);e.exports=function(e,t,n,a){for(var o=a.location,s=void 0===o?0:o,l=a.distance,u=void 0===l?100:l,c=a.threshold,h=void 0===c?.6:c,d=a.findAllMatches,m=void 0!==d&&d,p=a.minMatchCharLength,g=void 0===p?1:p,f=a.includeMatches,v=void 0!==f&&f,y=s,x=e.length,_=h,I=e.indexOf(t,y),T=t.length,b=[],S=0;S<x;S+=1)b[S]=0;if(-1!==I){var C=i(t,{errors:0,currentLocation:I,expectedLocation:y,distance:u});if(_=Math.min(C,_),-1!==(I=e.lastIndexOf(t,y+T))){var B=i(t,{errors:0,currentLocation:I,expectedLocation:y,distance:u});_=Math.min(B,_)}}I=-1;for(var F=[],E=1,P=T+x,k=1<<(T<=31?T-1:30),N=0;N<T;N+=1){for(var M=0,D=P;M<D;)i(t,{errors:N,currentLocation:y+D,expectedLocation:y,distance:u})<=_?M=D:P=D,D=Math.floor((P-M)/2+M);P=D;var w=Math.max(1,y-D+1),L=m?x:Math.min(y+D,x)+T,O=Array(L+2);O[L+1]=(1<<N)-1;for(var R=L;R>=w;R-=1){var A=R-1,V=n[e.charAt(A)];if(V&&(b[A]=1),O[R]=(O[R+1]<<1|1)&V,0!==N&&(O[R]|=(F[R+1]|F[R])<<1|1|F[R+1]),O[R]&k&&(E=i(t,{errors:N,currentLocation:A,expectedLocation:y,distance:u}))<=_){if(_=E,(I=A)<=y)break;w=Math.max(1,2*y-I)}}if(i(t,{errors:N+1,currentLocation:y,expectedLocation:y,distance:u})>_)break;F=O}var U={isMatch:I>=0,score:0===E?.001:E};return v&&(U.matchedIndices=r(b,g)),U}},function(e,t){e.exports=function(e,t){var n=t.errors,i=void 0===n?0:n,r=t.currentLocation,a=void 0===r?0:r,o=t.expectedLocation,s=void 0===o?0:o,l=t.distance,u=void 0===l?100:l,c=i/e.length,h=Math.abs(s-a);return u?c+h/u:h?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],i=-1,r=-1,a=0,o=e.length;a<o;a+=1){var s=e[a];s&&-1===i?i=a:s||-1===i||((r=a-1)-i+1>=t&&n.push([i,r]),i=-1)}return e[a-1]&&a-i>=t&&n.push([i,a-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,i=0;i<n;i+=1)t[e.charAt(i)]=0;for(var r=0;r<n;r+=1)t[e.charAt(r)]|=1<<n-r-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},i=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},r=function(e){return"string"==typeof e},a=function(e){return"number"==typeof e};e.exports={get:function(e,t){var o=[];return function e(t,s){if(s){var l=s.indexOf("."),u=s,c=null;-1!==l&&(u=s.slice(0,l),c=s.slice(l+1));var h=t[u];if(null!=h)if(c||!r(h)&&!a(h))if(n(h))for(var d=0,m=h.length;d<m;d+=1)e(h[d],c);else c&&e(h,c);else o.push(i(h))}else o.push(t)}(e,t),o},isArray:n,isString:r,isNum:a,toString:i}}])}),Km=(Wm=qm)&&Wm.__esModule&&Object.prototype.hasOwnProperty.call(Wm,"default")?Wm.default:Wm;qm.Fuse;function Qm(){var e=g(['<div class="font-menu__weights-list">',"</div>"]);return Qm=function(){return e},e}function Zm(){var e=g(['<div class="font-menu__weights"></div>']);return Zm=function(){return e},e}function Jm(){var e=g(["<div></div>"]);return Jm=function(){return e},e}function $m(){var e=g(['<panel-header lang-id="choose_font" modifier="secondary" buttons="back,help" clue-id="choose_font"></panel-header>']);return $m=function(){return e},e}function ep(){var e=g(["<input @focus="," @blur="," @keyup="," @change=",' class="filter-box__input input" type="search">']);return ep=function(){return e},e}function tp(){var e=g(['<div class="font-menu__not-found">\n            <img src="','app/illustrations/no-search-results-sidebar.svg" alt="">\n            <p>',"</p>\n        </div>"]);return tp=function(){return e},e}function np(){var e=g(['<a href="https://support.befunky.com/hc/en-us/articles/360001571631" target="_blank" rel="noopener">',"</a>"]);return np=function(){return e},e}function ip(){var e=g(['<div class="','" style="','" @click=',' tabindex="0">\n            ',"\n            ","\n        </div>"]);return ip=function(){return e},e}function rp(){var e=g(['<div class="font-menu__font-image" style=',"></div>"]);return rp=function(){return e},e}function ap(){var e=g(["<button class="," data-tooltip=",">\n                ","\n            </button>\n            ",""]);return ap=function(){return e},e}function op(){var e=g(['\n        <li class="','" style="','" data-font="','" .isRecent=',' tabindex="0">\n            ',"\n            <string>","</string>\n            ","\n            ","\n            ","\n        </li>"]);return op=function(){return e},e}function sp(){var e=g(['<button class="button button--link button--grey-200 font-menu__right-button" style=','><span class="text-xs">',"</span></button>"]);return sp=function(){return e},e}function lp(){var e=g(['<span class="loading-spinner"></span>']);return lp=function(){return e},e}function up(){var e=g(['<div class="font-menu__font-image" style=',"></div>"]);return up=function(){return e},e}function cp(){var e=g(['<div class="font-menu__font-image" style=',"></div>"]);return cp=function(){return e},e}function hp(){var e=g(['\n        <ul class="font-menu__list font-menu__list--search scrollable-content" @click='," @mouseover=",">\n            ","\n        </ul>"]);return hp=function(){return e},e}function dp(){var e=g(['\n        <span class="font-menu__heading">','</span>\n        <ul class="font-menu__list font-menu__list--favorites scrollable-content" @click='," @mouseover=",">\n            ","\n        </ul>"]);return dp=function(){return e},e}function mp(){var e=g(['\n        <span class="font-menu__heading">','</span>\n        <ul class="font-menu__list font-menu__list--recent" @click='," @mouseover=",">\n            ","\n        </ul>"]);return mp=function(){return e},e}function pp(){var e=g(["\n        ",'\n        <span class="font-menu__heading">','</span>\n        <ul class="font-menu__list font-menu__list--all scrollable-content" @click='," @mouseover=",">\n            ","\n        </ul>\n        "]);return pp=function(){return e},e}function gp(){var e=g(['\n                    <button class="button button--icon button--transparent button--sm filter-box__clear" @click=',">\n                        ","\n                    </button>"]);return gp=function(){return e},e}function fp(){var e=g(["\n            ","\n            ",'\n            <div class="font-menu__header">\n                <div class=',">\n                    ","\n                    ","\n                    ","\n                </div>\n                <button @click=",'\n                    class="','"\n                    data-tooltip=',"\n                >\n                ","\n                </button>\n                <button\n                    @click=",' class="font-menu__tab button button--icon button--white-outline button--sm"\n                    data-tooltip="add_fonts"\n                >\n                    ',"\n                </button>\n            </div>\n            ","\n            ","\n            ","\n            ","\n        "]);return fp=function(){return e},e}function vp(){var e=g(['<div class="font-menu focus-trap"></div>']);return vp=function(){return e},e}var yp=BeFunky.lit,xp=yp.html,_p=yp.setupState,Ip=yp.render,Tp=yp.appLang,bp=yp.icon,Sp=yp.elem;function Cp(e,t){var n,i=t.onFontSelection,r=t.onRecentFontsChange,a=t.onFavoriteFontsChange,o=t.isFontLoaded,s=t.loadFont,l=t.openFontManager,u=t.testNewSystemFont,c=Sp(vp()),h=null,d=BeFunky.debounce(function(){!1!==n&&Ip(function(){requestAnimationFrame(G);var e="FAVORITES"===p.mode;return xp(fp(),C,B,"font-menu__search filter-box text-xs ".concat(p.searchInput?"":"filter-box--empty"),bp("search-icon","icon filter-box__icon"),S,p.searchInput?xp(gp(),V,bp("cancel-icon","icon icon--12")):"",A,"font-menu__tab button button--icon button--sm button--white-outline ".concat(e?"button--selected":""),"FAVORITES"===p.mode?"show_all_fonts":"show_favorites",bp(e?"favorite-star-fill-icon":"favorite-star-empty-icon","icon icon--18"),l,bp("plus-icon","icon"),"ALL"===p.mode?(i=p.recent.map(function(e){return p.fonts.find(function(t){var n=t.name;return n===e})}).filter(Boolean),xp(pp(),i.length?xp(mp(),Tp("recent_fonts"),O,L,i.map(function(e){return D(e,!0)})):"",Tp("all_fonts"),O,L,p.fonts.map(function(e){return D(e,!1)}))):"","FAVORITES"===p.mode?(n=p.fonts.filter(function(e){var t=e.name;return p.favorites.includes(t)}),xp(dp(),Tp("favorites"),O,L,n.length?n.map(function(e){return D(e,!1)}):w("no_favorites_message"))):"","SEARCH"===p.mode?(t=p.searchInput?function(){if(h)return h(p.searchInput);var e=new Km(p.fonts,{shouldSort:!0,includeScore:!0,threshold:.25,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["name"]});return(h=function(t){return e.search(t).map(function(e){return e.item})})(p.searchInput)}(p.searchInput):p.fonts,xp(hp(),O,L,t.length?t.map(function(e){return D(e,!1)}):w("font_not_available"))):"",N);var t;var n;var i}(),c)},"raf"),m=f(_p(Object.assign({},{activeFontName:"",activeFontWeight:400,fonts:[],favorites:[],recent:[],loading:[],failedToLoad:[],mode:"ALL",searchInput:""},e),function(e){e.activeFontName&&function(){if(!p.activeFontName)return;var e=v(p.recent),t=e.indexOf(p.activeFontName);if(0===t)return;-1!==t&&e.splice(t,1);e.length>=5&&e.pop();e.unshift(p.activeFontName),g({recent:e}),r(e)}(),e.fonts&&(h=null),d()}),2),p=m[0],g=m[1];BeFunky.LanguageManager.addLanguageUpdateListener(d);var y,x,_,I,T,b={name:"",isRecent:!1},S=(y=!1,x=BeFunky.debounce(function(e){if(y){var t=e.target.value.trim();g({mode:"SEARCH",searchInput:t}),t&&u(t)}},100),(_=Sp(ep(),function(e){y=!0,e.target.value.trim()&&x(e)},function(e){y=!1,e.target.value.trim()||g({mode:"ALL"})},x,x)).setLang("search_fonts"),_),C=((I=Sp($m())).addEventListener("BACK",function(){return c.hide()}),I),B=(T=Sp(Jm()),BFN.HelpClueManager.setup("choose_font",{side:"left",positionFactor:0,left:"calc(100% + .5rem)",top:"1rem",zIndex:1,container:T}),T);c.addEventListener(BeFunky.pointerdown,function(e){return e.stopImmediatePropagation()});var E,k=function(){var e,t=Sp(Zm()),n=BFN.CSS.topMenuBarHeight+24;return{menu:t,showMenu:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=a.name,s=a.type,l=a.weights,u=a.itemYOffset,c=a.item;if(t.setStyles({display:""}),"number"==typeof u){var h=36*l.length,d=l.indexOf(P(l));u-=36*d,u=Math.min(u,BFN.appRect.height-h-2),t.setStyles({top:"".concat(u-n,"px")})}Ip(function(e,t,n){return xp(Qm(),n.map(function(n){return function(e,t,n){var r=F[n],a=["font-menu__item","font-menu__weights-item",e===p.activeFontName&&n===p.activeFontWeight?"font-menu__item--active":"","button","button--transparent","button--fullwidth","button--sm"].filter(Boolean).join(" "),o="",s="";"system"!==t&&"uploaded"!==t||(o='font-family: "'.concat(e,'", sans-serif; font-weight: ').concat(n));if("google"===t){var l="".concat(BFN.imagesURL,"app/fonts/google_v2/").concat(e.replace(/[^a-z0-9-]/gi,""),"-").concat(n,"w.png");o="color: transparent",s=xp(rp(),"background-image: url(".concat(l,")"))}return xp(ip(),a,o,function(){return function(e,t){g({activeFontName:e,activeFontWeight:t}),U(),i(e,t);var n=p.fonts.find(function(t){return t.name===e});M({name:n.name,type:n.type,weights:n.weights})}(e,n)},s,r)}(e,t,n)}))}(o,s,l),t),(e=c)&&e.addClass("font-menu__item--showing-weights");BFN.appContainer.addEventListener(BeFunky.pointerover,r)}};function r(n){t.contains(n.target)||e&&e.contains(n.target)||"UL"!==n.target.nodeName&&(BeFunky.isLoadScreenActive()||n.target.hasClass("upper-canvas")&&BFN.FabricManager.styleChangeRequested||function(){t.setStyles({display:"none"}),e&&(e.removeClass("font-menu__item--showing-weights"),e=void 0);BFN.appContainer.removeEventListener(BeFunky.pointerover,r)}())}}(),N=k.menu,M=k.showMenu;return E=function(e){return e.hasClass("font-menu__item")&&!e.hasClass("font-menu__item--recent")},BeFunky.addArrowKeyHandler({condition:E,callback:function(e,t,n){if("keydown"!==n.type&&"left"!==t&&"right"!==t){var i="up"===t?e.previousElementSibling:e.nextElementSibling;i&&E(i)&&i.click()}}}),Object.assign(c,{setState:g,show:function(){if(n)return;n=!0,d(),c.setStyles({display:""}).toggleClass("font-menu--over-fabric-canvas",UIToggler.alternateMenu.hasClass("alternate-menu--over-fabric-canvas")),requestAnimationFrame(function(){n&&(c.setStyles({opacity:1}),UIToggler.alternateMenu.addClass("disabled"),BFN.HelpClueManager.show("choose_font"))})},hide:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!n)return;n=!1,UIToggler.alternateMenu.removeClass("disabled"),"SEARCH"===p.mode&&(S.value="",g({mode:"ALL",searchInput:""}));if(e)return void c.setStyles({opacity:0,display:"none"});c.setStyles({opacity:0}),setTimeout(function(){n||c.setStyles({display:"none"})},200)},isVisible:function(){return n}}),c;function D(e,t){var n,i=e.name,r=e.type,a=e.bgYOffset,o=e.weights,s=i===p.activeFontName,l=H(o),u=["font-menu__item","font-menu__item--".concat(r),t?"font-menu__item--recent":"",s?"font-menu__item--active":"","button","button--grey-200",l?"button--has-icon":"","button--fullwidth"].filter(Boolean).join(" "),c="";if("number"==typeof a){var h="google"===r?"google-fonts-sprite.".concat(BeFunky.Params.googleFontsSpriteVersion,".png"):"befunky-fonts-sprite.".concat(BeFunky.Params.befunkyFontsSpriteVersion,".png");c=xp(cp(),"background-position-y: -".concat(a,"px; background-image: url(").concat(BFN.imagesURL,"app/fonts/").concat(h,")"))}else if("google"===r){var d="".concat(BFN.imagesURL,"app/fonts/google_v2/").concat(i.replace(/[^a-z0-9-]/gi,""),"-").concat(P(o),".png");c=xp(up(),"background-image: url(".concat(d,")"))}else n='font-family: "'.concat(i,'", sans-serif');var m=p.favorites.includes(i),g=p.loading.includes(i)?xp(lp()):"",f=p.failedToLoad.includes(i)?xp(sp(),p.failedToLoad.includes(i)?"":"display: none",Tp("font_load_retry")):"",v="button button--icon font-menu__favorite-button ".concat(m?"font-menu__favorite-button--selected":"");return xp(op(),u,n,i,t,c,i,g,f,g||f?"":xp(ap(),v,m?"favorites_remove":"favorites_add",bp(m?"favorite-star-fill-icon":"favorite-star-empty-icon","icon font-menu__favorite-icon"),H(o)?bp("chevron-icon","icon icon--chevron-right font-menu__show-weights-icon"):""))}function w(e){var t,n=Tp([e,{learn_more:xp(np(),(t=Tp("learn_more",!0),t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()))}]);return xp(tp(),BFN.imagesURL,n)}function L(e){if("LI"===e.target.nodeName){var t=e.target,n=t.getAttribute("data-font"),i=p.fonts.find(function(e){return e.name===n});if(!i)return BeFunky.throwError("No font object in menu for rendered font",n);if(!i.weights.length)return BeFunky.throwError("No font weights in menu for rendered font",n);if(H(i.weights)){var r=e.pageY-e.offsetY;M({name:i.name,type:i.type,weights:i.weights,itemYOffset:r,item:t})}}}function O(e){if(e.stopPropagation(),"LI"===e.target.nodeName){var t=e.target,n=t.getAttribute("data-font");return R(t,n)}if("BUTTON"===e.target.nodeName){var i=e.target.parentElement.getAttribute("data-font");if(!e.target.hasClass("font-menu__favorite-button"))return R(e.target.parentElement,i);!function(e){p.favorites.includes(e)?g({favorites:p.favorites.filter(function(t){return t!==e})}):g({favorites:[].concat(v(p.favorites),[e])});a(p.favorites)}(i)}}function R(e,t){var n=p.fonts.find(function(e){return e.name===t}),r=e.isRecent?p.recent.indexOf(t):-1,a=function(e,t){if(e.includes(t))return t;var n=t>=600,i=e.filter(function(e){return n?e>=600:e<600});if(i.length)return r=t,i.reduce(function(e,t){return Math.abs(t-r)<Math.abs(e-r)?t:e});var r;if(n)return 700;return P(e)}(n.weights,p.activeFontWeight);if(g({activeFontName:t,activeFontWeight:a}),U(),b={fontName:t,isRecent:e.isRecent},i(t,a),H(n.weights)){var o=e.getBoundingClientRect().top;-1!==r&&(o-=36*r),M({name:n.name,type:n.type,weights:n.weights,itemYOffset:o,item:e})}}function A(){S.value="",g({mode:"FAVORITES"===p.mode?"ALL":"FAVORITES",searchInput:""})}function V(){S.value="",g({mode:"ALL",searchInput:""})}function U(){var e=p.activeFontName;o(e)||p.loading.includes(e)||(g({loading:[].concat(v(p.loading),[e]),failedToLoad:p.failedToLoad.filter(function(t){return t!==e})}),s(e).catch(function(){return g({failedToLoad:[].concat(v(p.failedToLoad),[e])})}).then(function(){return g({loading:p.loading.filter(function(t){return t!==e})})}))}function G(){if(p.activeFontName===b.fontName){var e;e="SEARCH"===p.mode?".font-menu__list--search":"FAVORITES"===p.mode?".font-menu__list--favorites":b.isRecent?".font-menu__list--recent":".font-menu__list--all";var t=c.querySelector("".concat(e,' [data-font="').concat(p.activeFontName,'"]'));t&&t.focus(),b={fontName:"",isRecent:!1}}else b={fontName:"",isRecent:!1}}function H(e){return!(e.length<2)&&!(2===e.length&&e[0]<=500&&e[1]>500)}}function Bp(){var e=g(["<div></div>"]);return Bp=function(){return e},e}function Fp(){var e=g(['<panel-header lang-id="manage_fonts" modifier="modal" buttons="close,help" clue-id="manage_font"></panel-header>']);return Fp=function(){return e},e}function Ep(){var e=g(['\n        <div class="checkbox">\n            <input type="checkbox" id="','" @change='," .checked=",'>\n            <label class="checkbox__label" for="','">\n                <span class="checkbox__box checkbox__box--sm">\n                    ',"\n                </span>\n                <string>","</string>\n            </label>\n        </div>"]);return Ep=function(){return e},e}function Pp(){var e=g(['\n                <button class="button button--icon button--transparent filter-box__clear" @click=',">\n                    ","\n                </button>"]);return Pp=function(){return e},e}function kp(){var e=g(['\n        <div class="font-manager__google-menu">\n            <div class="font-manager__search filter-box">\n                ',"\n                <input @keyup="," @change=",' class="filter-box__input input input--sm" type="search" placeholder=',">\n                ",'\n            </div>\n            <div class="font-manager__google-scroll scrollable-content">\n                <p class="font-manager__sub-heading text-sm bold" style="margin-top: 0.5rem">',"</p>\n                ",'\n                <p class="font-manager__sub-heading text-sm bold">',"</p>\n                ",'\n                <h3 class="font-manager__sub-heading text-sm bold">',"</h3>\n                ","\n            </div>\n        </div>"]);return kp=function(){return e},e}function Np(){var e=g(['\n        <li class="','">\n            <div class="font-manager__font-image" style="','"></div>\n            <string>','</string>\n            <span class="font-manager__style font-manager__style--google text-xs">',"</span>\n            ","\n        </li>"]);return Np=function(){return e},e}function Mp(){var e=g(["<button @click=",' class="button button--icon button--circle button--transparent button--sm font-manager__add-google-font" data-tooltip="add_to_my_fonts">\n                ',"\n            </button>"]);return Mp=function(){return e},e}function Dp(){var e=g(['\n        <li class="','" style="','">\n            ',"\n            ","\n            ","\n        </li>"]);return Dp=function(){return e},e}function wp(){var e=g(["\n            <button @click=",' class="button button--icon button--transparent button--xs font-manager__button">\n                ',"\n            </button>"]);return wp=function(){return e},e}function Lp(){var e=g(['<span class="font-manager__upload-progress">',"%</span>"]);return Lp=function(){return e},e}function Op(){var e=g(["<string>",' <span class="font-manager__style">',"</span></string>"]);return Op=function(){return e},e}function Rp(){var e=g(['<span class="font-manager__error"><string>File: ',"</string>","</span>"]);return Rp=function(){return e},e}function Ap(){var e=g(['\n        <li class="','" style="','">\n            ',"\n            <string>","</string>\n            ","\n            <button @click=",' class="button button--icon button--transparent font-manager__button button--sm" data-tooltip="remove_font">\n                ',"\n            </button>\n        </li>"]);return Ap=function(){return e},e}function Vp(){var e=g(['<div class="font-manager__font-image" style=',"></div>"]);return Vp=function(){return e},e}function Up(){var e=g(['<ul class="font-manager__list">',"</ul>"]);return Up=function(){return e},e}function Gp(){var e=g(['\n            <div class="font-manager__center-contents">\n                <img class="font-manager__illustration" src="','app/illustrations/no-search-results-canvas.svg" alt="">\n                ',"\n            </div>"]);return Gp=function(){return e},e}function Hp(){var e=g(['\n            <div class="font-manager__center-contents">\n                <div><span class="loading-spinner"></span><string>',"</string></div>\n            </div>"]);return Hp=function(){return e},e}function zp(){var e=g(['\n        <div class="font-manager__upload-scroll scrollable-content">\n            <div class="font-manager__list font-manager__list--uploaded">\n                ','\n            </div>\n            <div class="font-manager__upload-button-container">\n                <button @click=',' class="button button--blue button--fullwidth" .disabled=',">","</button>\n            </div>\n        </div>\n        "]);return zp=function(){return e},e}function jp(){var e=g(["\n        <div class="," @click=",'>\n            <img class="font-manager__illustration" src="','app/illustrations/drop-fonts.svg" alt="" />\n            <span>',"</span>\n        </div>\n        ",""]);return jp=function(){return e},e}function Xp(){var e=g(['<ul class="font-manager__list">',"</ul>"]);return Xp=function(){return e},e}function Wp(){var e=g(['\n            <div class="font-manager__center-contents font-manager__no-added-fonts">\n                <img class="font-manager__illustration" src="','app/illustrations/no-fonts-added.svg" alt="" />\n                <p>',"</p>\n            </div>"]);return Wp=function(){return e},e}function Yp(){var e=g(['<a href="https://support.befunky.com/hc/en-us/articles/360001571631" target="_blank" rel="noopener">',"</a>"]);return Yp=function(){return e},e}function qp(){var e=g(["\n        <button @click="," class=",">\n            <string>","</string>\n            ","\n        </button>"]);return qp=function(){return e},e}function Kp(){var e=g(["\n            ","\n            ",'\n            <div class="font-manager__body">\n                <div class="font-manager__left-panel">\n                    ','\n                    <p class="font-manager__sub-heading text-sm bold" style="margin-top: 1.5rem">',"</p>\n                    ","\n                    ","\n                    ",'\n                </div>\n                <div class="font-manager__right-panel">\n                    <div class="scrollable-content" style='," @scroll=",">\n                        ","\n                        ","\n                        ","\n                    </div>\n                </div>\n            </div>\n        "]);return Kp=function(){return e},e}function Qp(){var e=g(['<div id="font_manager" class="font-manager modal"></div>']);return Qp=function(){return e},e}var Zp=BeFunky.lit,Jp=Zp.html,$p=Zp.setupState,eg=Zp.render,tg=Zp.modalLang,ng=Zp.icon,ig=Zp.elem;function rg(e,t){var n,i=t.addGoogleFont,r=t.removeAddedFont,a=t.onFontFilesDropped,o=t.browseForFonts,s=t.uploadFonts,l=t.cancelUpload,u=t.trackFonts,c=t.onGoogleFontListLoaded,h=ig(Qp()),d=BeFunky.debounce(function(){var e,t;!1!==n&&eg((e="UPLOAD"===p.mode?"overflow-y: hidden; display: flex; flex-direction: column;":"",Jp(Kp(),C,B,F("ALL","view_added_fonts"),tg("add_fonts"),F("UPLOAD","add_fonts_computer"),F("GOOGLE","add_fonts_google"),"GOOGLE"===p.mode?(t=Object.entries(E).map(function(e){var t=f(e,2),n=t[0],i=t[1];return[parseInt(n),i]}),Jp(kp(),ng("search-icon","icon filter-box__icon"),I,I,tg("search",!0),p.searchInput?Jp(Pp(),A,ng("cancel-icon","icon icon--10")):"",tg("font_category"),[["serif","font_category_serif"],["sans-serif","font_category_sans_serif"],["display","font_category_display"],["handwriting","font_category_handwriting"],["monospace","font_category_monospace"]].map(function(e){return D("category",e)}),tg("font_thickness"),t.map(function(e){return D("style",e)}),tg("language"),[["latin","latin"],["arabic","arabic"],["cyrillic","cyrillic"],["cyrillic-ext","cyrillic_extended"],["devanagari","devanagari"],["greek","greek"],["greek-ext","greek_extended"],["hebrew","hebrew"],["japanese","japanese"],["khmer","khmer"],["korean","korean"],["latin-ext","latin_extended"],["vietnamese","vietnamese"]].map(function(e){return D("language",e)}))):"","--scrollable-content-width: ".concat(p.availableWidth-272-48,"px; ").concat(e),S,"ALL"===p.mode?function(){if(!p.fonts.length){var e=tg(["no_user_defined_fonts_message",{learn_more:Jp(Yp(),(t=tg("learn_more",!0),t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()))}]);return Jp(Wp(),BFN.imagesURL,e)}var t;return Jp(Xp(),p.fonts.map(k))}():"","UPLOAD"===p.mode?function(){setTimeout(w,0);var e=p.fontsToUpload,t=!1;e.find(function(e){return"number"==typeof e.uploadProgress})?t=!0:e.every(function(e){return e.error})&&(t=!0);var n=tg("drag_drop_fonts"),i="font-manager__center-contents font-manager__drag-message ".concat(0===p.fontsToUpload.length?"":"font-manager__drag-message--has-items");return Jp(jp(),i,L,BFN.imagesURL,n,p.fontsToUpload.length?Jp(zp(),p.fontsToUpload.map(N),R,t,tg("upload_fonts")):"")}():"","GOOGLE"===p.mode?function(){if(!p.googleFontWeights.length)return BeFunky.request("".concat(BFN.assetsURL,"datas/google-fonts.77a7f106cf.json"),{},function(e){var t=e.error,n=e.response;if(t)return BeFunky.logError("Unable to request Google Fonts");var i=n;c(i);var r=b.map(function(e){return e.split(":")[0]}),a=[];i.forEach(function(e){var t=e.name,n=e.weights,i=e.category,o=e.subsets;n.forEach(function(e){a.push({name:t,weight:e,weights:n,category:i,subsets:o,isDefault:r.includes(t)})})}),g({googleFontWeights:a})}),Jp(Hp(),tg("loading"));var e=function(){var e=p.googleFontWeights,t=p.selectedCategories,n=p.selectedWeights,i=p.selectedSubsets,r=p.maxFontsToRender,a=function(e){return e.toLowerCase().replace(/[^a-z0-9 ]/g,"")},o=p.searchInput.split(/\s+/).map(a).filter(Boolean),s=!o.length||1===o.length&&1===o[0].length,l=t.length?function(e){return t.includes(e.category)}:function(){return!0},u=n.length?function(e){return n.some(function(t){return t===e.weight})}:function(){return!0},c=i.length?function(e){return i.some(function(t){return e.subsets.includes(t)})}:function(){return!0},h=s?function(){return!0}:function(e){var t=a(e.name);return o.every(function(e){return t.includes(e)})},d=[];T=!1;for(var m=0;m<e.length;m++){var g=e[m];if(l(g)&&u(g)&&c(g)&&h(g)&&(d.push(g),d.length===r&&m+1!==e.length)){T=!0;break}}return d}();return e.length?Jp(Up(),e.map(M)):Jp(Gp(),BFN.imagesURL,tg(["no_font_results",{input:p.searchInput}]))}():"")),h)},"raf"),m=f($p(Object.assign({},{fonts:[],mode:"ALL",searchInput:"",googleFontWeights:[],selectedCategories:[],selectedWeights:[],selectedSubsets:["latin"],maxFontsToRender:50,fontsToUpload:[],availableHeight:632,availableWidth:646},e),d),2),p=m[0],g=m[1];BeFunky.LanguageManager.addLanguageUpdateListener(d);var y,x,_,I=BeFunky.debounce(function(e){var t=e.target.value.trim();g({searchInput:t,maxFontsToRender:50}),y&&(y.scrollTop=0)},50),T=!1,S={handleEvent:BeFunky.throttle(function(e){if("GOOGLE"!==p.mode)return;if(y=y||e.target,!T)return;var t=34*p.maxFontsToRender+48,n=p.availableHeight-56;t-n-e.target.scrollTop<500&&g({maxFontsToRender:p.maxFontsToRender+50})},50),passive:!0},C=((x=ig(Fp())).addEventListener("CLOSE",function(){return h.hide()}),x),B=(_=ig(Bp()),BFN.HelpClueManager.setup("manage_font",{side:"top",positionFactor:.935,left:"calc(100% - 3.75rem)",top:"0.25rem",zIndex:1,container:_}),_);return Object.assign(h,{state:p,setState:g,show:function(){if(n)return;n=!0,d(),u(!1),BeFunky.openModal(h,{size:[646,632],onOpen:function(){BFN.HelpClueManager.show("manage_font")},onClose:function(){n=!1,u(!0)},onWindowResize:function(e){var t=e.availableHeight,n=e.availableWidth;g({availableHeight:t,availableWidth:n})}})},hide:function(){if(!n)return;n=!1,BeFunky.closeModal(h)}}),h;function F(e,t){return Jp(qp(),function(){return g({mode:e})},"button button--grey-200 button--fullwidth button--has-icon font-manager__tab ".concat(p.mode===e?"button--selected":""),tg(t),ng("chevron-icon","icon icon--chevron-right"))}function k(e){var t=e.name,n=e.type,i=e.weights,a=["font-manager__item","font-manager__item--added","font-manager__item--".concat(n)].filter(Boolean).join(" "),o="google"===n?"":'font-family: "'.concat(t,'", sans-serif; padding-right: 0px;'),s="google"===n?Jp(Vp(),"background-image: url(".concat(BFN.imagesURL,"app/fonts/google_v2/").concat(t.replace(/[^a-z0-9-]/gi,""),"-").concat(P(i),".png)")):"",l="google"===n?ng("google-font-icon","icon font-manager__icon-google","",{tooltip:"added_from_google"}):ng("file-icon","icon icon font-manager__icon-file","",{tooltip:"added_from_computer"});return Jp(Ap(),a,o,s,t,l,function(){return r(t)},ng("delete-icon"))}function N(e){var t,n=e.fontFamily,i=e.fontWeight,r=e.fileName,a=e.uploadProgress,o=e.error,s=["font-manager__item","font-manager__item--uploaded",o?"font-manager__item--error":""].filter(Boolean).join(" "),u=o?Jp(Rp(),r,(t={no_style:"font_not_readable",no_family_name:"font_not_readable",no_weight:"font_not_readable",parse_failed:"font_not_readable",font_type_not_supported:["font_not_supported",{fileType:BFN.getExtension(r).toUpperCase()}],italic_style:"font_italic_not_supported",google_font_conflict:["font_duplicate_google",{fontFamily:n}],already_uploaded:["font_file_already_uploaded",{font:function(){return"".concat(n," ").concat(tg(E[i],!0))}}]}[o])?tg(t):(BeFunky.logError("Unhandled font error:",o),BeFunky.failureReason(o))):Jp(Op(),n,"- ".concat(tg(E[i],!0))),c=100===a,h=!o&&!c&&"number"==typeof a,d="";h&&(d=Jp(Lp(),a));var m=c?ng("checkmark-icon","icon font-manager__icon-selected",{style:"margin-right: 6px"}):Jp(wp(),function(){if(!h)return g({fontsToUpload:p.fontsToUpload.filter(function(t){return t!==e})});l(e)},ng("cancel-icon","icon icon--12"));return Jp(Dp(),s,"",u,d,m)}function M(e){var t,n=e.name,r=e.weights,a=e.weight,o=e.isDefault,s=["font-manager__item","font-manager__item--google"].filter(Boolean).join(" "),l="".concat(BFN.imagesURL,"app/fonts/google_v2/").concat(n.replace(/[^a-z0-9-]/gi,""),"-").concat(a,".png"),u="background-image: url(".concat(l,")");return t=o?ng("checkmark-icon","icon font-manager__icon-selected font-manager__icon-selected--default",{tooltip:"font_already_included"}):p.fonts.find(function(e){return e.name===n&&"google"===e.type})?ng("checkmark-icon","icon font-manager__icon-selected",{tooltip:"added_to_my_fonts"}):Jp(Mp(),function(){return i(n,r)},ng("plus-circle-icon","icon icon--14")),Jp(Np(),s,u,n,tg(E[a]),t)}function D(e,t){var n=f(t,2),i=n[0],r=n[1],a="font_manager_google_".concat(e,"_").concat(i),o={category:V,style:U,language:G},s={category:function(){return p.selectedCategories.includes(i)},style:function(){return p.selectedWeights.includes(i)},language:function(){return p.selectedSubsets.includes(i)}};return Jp(Ep(),a,function(t){return o[e](t,i)},s[e](),a,ng("checkmark-icon","icon icon--12 checkbox__icon"),tg(r))}function w(){BFN.DragAndDropManager.dragDropAreas=BFN.DragAndDropManager.dragDropAreas.filter(function(e){return!e._usedByFontManager});var e=h.querySelector(".font-manager__drag-message");BFN.DragAndDropManager.dragDropAreas.push({_usedByFontManager:!0,visibleElem:e,listeningElem:e,isActive:!1,handler:O,activeClass:"font-manager__drag-message--drop-target"})}function L(e){e.preventDefault(),o()}function O(e){g({mode:"UPLOAD"}),a(e)}function R(){g({fontsToUpload:p.fontsToUpload.filter(function(e){return!e.error})}),s(p.fontsToUpload)}function A(e){e.target.previousElementSibling.value="",g({searchInput:"",maxFontsToRender:50}),y&&(y.scrollTop=0)}function V(e,t){e.target.checked?g({selectedCategories:[].concat(v(p.selectedCategories),[t]).unique(),maxFontsToRender:50}):g({selectedCategories:p.selectedCategories.filter(function(e){return e!==t}),maxFontsToRender:50}),y&&(y.scrollTop=0)}function U(e,t){e.target.checked?g({selectedWeights:[].concat(v(p.selectedWeights),[t]).unique(),maxFontsToRender:50}):g({selectedWeights:p.selectedWeights.filter(function(e){return e!==t}),maxFontsToRender:50}),y&&(y.scrollTop=0)}function G(e,t){e.target.checked?g({selectedSubsets:[].concat(v(p.selectedSubsets),[t]).unique(),maxFontsToRender:50}):g({selectedSubsets:p.selectedSubsets.filter(function(e){return e!==t}),maxFontsToRender:50}),y&&(y.scrollTop=0)}}var ag=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues(),this.initFontsList(),this.initFontMenu()}},{key:"initDefaultValues",value:function(){this.defaultFontFamily="Open Sans",this.defaultFontWeight=400,this._activeFont=this.defaultFontFamily,this._activeFontWeight=this.defaultFontWeight,this.loadedFonts=[],this.fontLoadingPromises=[],this.userDefinedSystemFontsKey="options__userDefinedSystemFonts",this.customFontStylesheet=document.createElement("style"),this.customFontStylesheet.id="bfn_custom_fonts",document.head.appendChild(this.customFontStylesheet),this.fontTestingContext=null,this.monospaceTextWidth=null,this.serifTextWidth=null,this.monospaceFontList=["Andale Mono","Courier","Courier New","GB18030 Bitmap","Lantinghei TC","Monaco","Apple Braille","Cousine"].map(function(e){return e.toLowerCase()}),this.fontTestingText="abcdefghijklmnopqrstuvwxyz0123456789",this.fontTestingSize="72",this.fontMenuComponent=null,this.favorites=[],this.uploadingFonts={},this.limitFontsForDesigners=null,this.saveUserDefinedSystemFonts=BeFunky.debounce(this.saveUserDefinedSystemFonts.bind(this),200),this.fontWeightDetectionFailures=null}},{key:"initFontsList",value:function(){var e=this;this.getUserDefinedSystemFontNames().then(function(t){var n=!1;t.forEach(function(t){var i=e.getFontObject(t);if(i)"system"===i.type?i.isUserDefined=!0:BeFunky.logError('Unable to add user-defined system font "'.concat(t,'" b/c of conflict'),i);else{n=!0;var r=new w(t,"system",[],{isUserDefined:!0});BFN.CONST.FONT_LIST.push(r)}}),n&&BFN.CONST.FONT_LIST.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),(BFN.MainUI?BFN.MainUI.addIdleRenderFunction:requestIdleCallback)(function(){e.testSystemFonts(!0,function(){BFN.CONST.FONT_LIST.filter(function(e){var t=e.isUserDefined,n=e.isAvailable,i=e.type;return t&&"system"===i&&!n}).forEach(function(t){var n=t.name;return e.removeUserDefinedFont(n)})})})})}},{key:"initFontMenu",value:function(){var e=this;window.addEventListener("INIT_COMPLETE",function(){var t=document.getElementById("text_edit_font_button");t.addEventListener("click",function(){e.openFontMenu()}),e.popoverButtonText=t.querySelector("string"),e.popoverButtonText.textContent=e.activeFont,e.getRecentFonts().then(function(t){e.recentFontsFromPriorSession=t;var n=t[0];n&&(e.isLoaded(n)?Promise.resolve():e.load(n)).then(function(){var e=BFN.FabricManager.userStyle.charStyles;e.fontFamily||(e.fontFamily=n)}).catch(function(e){BeFunky.logError("Failed to preload last-used font from prior session",e)})})}),this.preloadFontBGImageSprites=BeFunky.once(function(){["google-fonts-sprite.".concat(BeFunky.Params.googleFontsSpriteVersion,".png"),"befunky-fonts-sprite.".concat(BeFunky.Params.befunkyFontsSpriteVersion,".png")].forEach(function(e){(new Image).src="".concat(BFN.imagesURL,"app/fonts/").concat(e)})})}},{key:"setupFontMenuComponent",value:function(){var e=this;if(!this.fontMenuComponent){BFN.FontManager.testSystemFonts();var t=BeFunky.debounce(function(e){BFN.IndexedDB.set("options__recentFontFamilies",e).catch(function(e){return BeFunky.logError("Unable to update recentFontFamilies in IndexedDB",e)})},1e3),n={fonts:this.getFontObjectsForFontMenu(),activeFontName:this.activeFont,activeFontWeight:this.activeFontWeight,recent:this.recentFontsFromPriorSession||[],favorites:this.favorites};this.fontMenuComponent=Cp(n,{onFontSelection:function(t,n){UITools.setToolValue("text_edit","weight",n),UITools.setToolValue("text_edit","font",t),UITools.applyTool("text_edit"),e.activeFont=t,e.activeFontWeight=n,BFN.BfnService.track("CREATE","FONTS",t.replace(" ","_").toUpperCase())},onRecentFontsChange:t,onFavoriteFontsChange:function(e){BFN.SettingsManager.updateSetting("fonts_fav",e)},isFontLoaded:function(t){return e.isLoaded(t)},loadFont:function(t){return e.load(t)},openFontManager:function(){return e.openFontManagerModal()},testNewSystemFont:function(t){if(!(t.length<3||BFN.FontManager.findSimilarFont(t))){var n=t===t.toLowerCase()?BFN.toTitleCase(t):t,i=new w(n,"system",[]);BFN.FontManager.testFonts([i]),i.isAvailable&&e.addUserDefinedSystemFont(n,!0)}}}),BFN.appContainer.appendChild(this.fontMenuComponent),this.preloadUploadedFonts()}}},{key:"setupFontManagerComponent",value:function(){var e=this;if(this.fontManagerComponent)return!0;if(!BFN.BfnService.userIsPlus)return BeFunky.openTeaserModal("font_management"),!1;var t,n={fonts:BFN.CONST.FONT_LIST.filter(function(e){return e.isUserDefined&&"system"!==e.type})};return this.fontManagerComponent=rg(n,{addGoogleFont:function(e,t){BFN.SettingsManager.getSetting("fonts_added").then(function(n){var i=n.find(function(t){return t.name===e});if(i)throw i;BFN.SettingsManager.updateSetting("fonts_added",[].concat(v(n),[{name:e,type:"google",weights:t}]))})},removeAddedFont:function(e){BFN.SettingsManager.getSetting("fonts_added").then(function(t){BFN.SettingsManager.updateSetting("fonts_added",t.filter(function(t){return t.name!==e}))})},onFontFilesDropped:this.handleUserFontFiles.bind(this),browseForFonts:this.browseForFonts.bind(this),uploadFonts:this.uploadUserFonts.bind(this),cancelUpload:this.cancelUserFontUpload.bind(this),onGoogleFontListLoaded:function(t){var n=[];BFN.CONST.FONT_LIST.filter(function(e){var t=e.type,n=e.isUserDefined;return"google"===t&&n}).forEach(function(i){var r=t.find(function(e){return e.name===i.name});r&&!r.weights.isIdenticalTo(i.weights)&&(console.log("Updating weights for user-saved Google font",i.name,i.weights," -> ",r.weights),i.weights=v(r.weights),e.load(i.name),n.push({name:i.name,weights:i.weights}))}),n.length&&(e.updateFontUI(),BFN.SettingsManager.getSetting("fonts_added").then(function(e){var t=e.map(function(e){var t=n.find(function(t){return t.name===e.name});return t?Object.assign({},e,{weights:t.weights}):e});BFN.SettingsManager.updateSetting("fonts_added",t,{updateUI:!1})}))},trackFonts:function(e){var n=BFN.CONST.FONT_LIST.filter(function(e){return e.isUserDefined&&"system"!==e.type}).reduce(function(e,t){return Object.assign(e,{[t.name]:t.type})},{});if(e){var i=Object.keys(n).filter(function(e){return!t[e]}),r=Object.keys(t).filter(function(e){return!n[e]}),a=[].concat(v(i.map(function(e){return n[e]})),v(r.map(function(e){return t[e]}))).unique().map(function(e){return"google"===e?"Google":"User"}),o=new BFN.UserActionVO;o.eventID="font_manager_opened",o.eventObject={},i.length&&(o.eventObject.fontManagerFontsAdded=i),r.length&&(o.eventObject.fontManagerFontsRemoved=r),a.length&&(o.eventObject.fontManagerFontSources=a),console.log(o),o.track()}else t=n}}),this.preloadUploadedFonts(),!0}},{key:"isLoaded",value:function(e){return this.loadedFonts.includes(e)}},{key:"getFontObject",value:function(e){return BFN.CONST.FONT_LIST.find(function(t){return t.name===e})}},{key:"isInList",value:function(e){return BFN.CONST.FONT_LIST.some(function(t){return t.name===e})}},{key:"findSimilarFont",value:function(e){if(this.isInList(e))return e;var t=S[e];if(t)return t;var n=function(e){return e.toLowerCase().replace(/[^a-z \u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]/g,"").trim().replace(/ (ot|tt|ofl)$/,"").replace(/ /g,"")},i=n(e),r=BFN.CONST.FONT_LIST.find(function(e){return n(e.name)===i});return!!r&&r.name}},{key:"load",value:function(e){var t=this;if(this.fontLoadingPromises[e])return this.fontLoadingPromises[e];var n=BFN.FontManager.getFontObject(e);if(!n){var i='Font "'.concat(e,'" not found in FONT_LIST');return BeFunky.throwError(i),Promise.reject(i)}var r=n.type,a=n.weights,o=n.isAvailable,s=n.fileName,l=n.files,u=new Promise(function(i,u){if("system"===r)return o?i(e):(t.testFonts([n]),n.isAvailable?(t.testFontWeights([n]),i(e)):u("System font is unavailable"));var c=function(){var o=a.length||1,s=[],l=[],c=function(r,a){var c=100*parseInt(a.replace(/[^\d]/g,""));if(r?s.push(c):l.push(c),s.length+l.length-o==0)return s.length?l.length?(BeFunky.logError("Loaded ".concat(s.length," / ").concat(o,' font weights for font "').concat(e,'"'),{weightsLoaded:s,weightsNotLoaded:l}),s.length>=l.length?i(e):u("Failed to load ".concat(l.length,' font weight(s) for "').concat(e,'"'))):(console.log("Loaded ".concat(1===o?"one weight":"all ".concat(o," weights"),' for font "').concat(e,'"')),t.loadedFonts.push(n.name),i(e)):u('Failed to load font "'.concat(e,'"'))},h={classes:!1,fontactive:function(e,t){c(!0,t)},fontinactive:function(e,t){c(!1,t)}},d=function(){if("google"===r)return{google:{families:["".concat(e,":").concat(a.join(","))]}};var t=a.length?":".concat(a.map(function(e){return"n".concat(e/100)}).join(",")):"";return{custom:{families:["".concat(e).concat(t)]}}}();Ym.load(Object.assign(h,d))};if(t.unloadFont(e,r),"google"===r)return c();if("befunky"===r){var h="".concat(BFN.assetsURL,"fonts/").concat(s);return t.injectFontFace(e,["url('".concat(h,".woff2') format('woff2')"),"url('".concat(h,".woff') format('woff')")]),c()}return"uploaded"===r?(l.forEach(function(n){var i=n.weight,r=n.fileName,a=BFN.getExtension(r),o=(B.find(function(e){return e.extension===a})||{}).cssFormat;if(!o)return BeFunky.throwError('Unsupported font type: "'.concat(a,'"'),r);var s="url('".concat(BeFunky.Params.userFontsPath).concat(r,"') format('").concat(o,"')");t.injectFontFace(e,[s],i)}),c()):void 0});this.fontLoadingPromises[e]=u;var c=function(){var n=t.fontLoadingPromises[e].needsReloadedCallback;if(delete t.fontLoadingPromises[e],n){var i=t.getFontObject(e);if(!i||"uploaded"!==i.type)return;t.loadUploadedFont(e,n)}};return u.then(c).catch(c),u}},{key:"loadUploadedFont",value:function(e,t){this.fontLoadingPromises[e]?this.fontLoadingPromises[e].needsReloadedCallback=t:this.load(e).then(t)}},{key:"unloadFont",value:function(e,t){var n=this;if(["google","befunky","uploaded"].includes(t)){var i=this.isLoaded(e);if(i&&(this.loadedFonts=this.loadedFonts.filter(function(t){return t!==e})),"uploaded"===t||"befunky"===t){var r=0;v(this.customFontStylesheet.sheet.cssRules).forEach(function(t,i){N(t.cssText.match(/font-family:([^;]+);/)[1].trim())===e&&(n.customFontStylesheet.sheet.deleteRule(i-r),r++)}),0===r&&i&&BeFunky.throwError("Unable to find @font-face rule for ".concat(t," font ").concat(e))}else{var a="https://fonts.googleapis.com/css?family=".concat(e.split(" ").join("+"),":"),o='link[rel="stylesheet"][href^="'.concat(a,'"]'),s=[];try{s=v(document.head.querySelectorAll(o))}catch(e){BeFunky.throwError("Invalid Google Font stylesheet selector",o)}s.forEach(function(e){return e.parentElement.removeChild(e)})}}else BeFunky.throwError("Invalid unloadFont type",t)}},{key:"testSystemFonts",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=BFN.CONST.FONT_LIST.filter(function(e){return"system"===e.type}),r=function(){return i.filter(function(e){return null===e.isAvailable})},a=function(){return i.filter(function(e){return e.isAvailable&&!e.weights.length})};if(!t)return this.testFonts(r()),this.testFontWeights(a()),this.fontWeightDetectionFailures&&(BeFunky.reportWarning("Font weight detection failures",this.fontWeightDetectionFailures),this.fontWeightDetectionFailures=null),void n();var o=function t(i){var r=a();if(!r.length)return e.fontWeightDetectionFailures&&(BeFunky.reportWarning("Font weight detection failures",e.fontWeightDetectionFailures),e.fontWeightDetectionFailures=null),void n();e.testFontWeights(r,i),requestIdleCallback(t)};requestIdleCallback(function t(n){var i=r();if(!i.length)return o(n);e.testFonts(i,n),requestIdleCallback(t)})}},{key:"setupFontTestingCanvasContext",value:function(){var e=document.createElement("canvas");this.fontTestingContext=e.getContext("2d"),BeFunky.isSafariMojave&&(e.id="system_font_detection_canvas",e.setStyles({display:"none"}),BFN.appContainer.appendChild(e)),this.fontTestingContext.font="".concat(this.fontTestingSize,"px monospace"),this.monospaceTextWidth=this.fontTestingContext.measureText(this.fontTestingText).width,this.fontTestingContext.font="".concat(this.fontTestingSize,"px serif"),this.serifTextWidth=this.fontTestingContext.measureText(this.fontTestingText).width}},{key:"testFonts",value:function(e,t){this.fontTestingContext||this.setupFontTestingCanvasContext();var n,i=_(e);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.name;if(t&&t.timeRemaining()<=1)break;var o=this.monospaceFontList.includes(a.toLowerCase()),s=o?"serif":"monospace",l=o?this.serifTextWidth:this.monospaceTextWidth;this.fontTestingContext.font="".concat(this.fontTestingSize,"px ").concat(M(a),", ").concat(s);var u=this.fontTestingContext.measureText(this.fontTestingText).width;r.isAvailable=u!==l,r.isAvailable&&(r.originalMeasuredTextSize=u,!BeFunky.isChromeOS||1548!==u&&1555.453125!==u||1548!==l&&1555.453125!==l||(BeFunky.logWarning("Marking font ".concat(a," as unavailable in ChromeOS"),r),r.isAvailable=!1))}}catch(e){i.e(e)}finally{i.f()}}},{key:"testFontWeights",value:function(e,t){var n=this;this.fontTestingContext||this.setupFontTestingCanvasContext();var i,r=_(e);try{var a=function(){var e=i.value,r=e.name;if(t&&t.timeRemaining()<=1)return"break";if(!e.isAvailable)return BeFunky.throwError("Font ".concat(M(r)," is not available or has not been tested"),e),"continue";var a=n.monospaceFontList.includes(r.toLowerCase()),o=a?"serif":"monospace",s=a?n.serifTextWidth:n.monospaceTextWidth,l={},u=function(t){if(l[t])return l[t];n.fontTestingContext.font="".concat(t," ").concat(n.fontTestingSize,"px ").concat(M(r),", ").concat(o);var i=n.fontTestingContext.measureText(n.fontTestingText).width;return s===i&&(n.fontWeightDetectionFailures=n.fontWeightDetectionFailures||{},n.fontWeightDetectionFailures[r]=n.fontWeightDetectionFailures[r]||[],n.fontWeightDetectionFailures[r].push(t),n.debugFontWeightDetection({message:"Font weight detection failed for ".concat(M(r)),shouldReport:!1,fontObject:e,weight:t,measuredTextSize:i,baselineFont:o,baselineTextSize:s})),l[t]=i,i};e.weights=function(){if(u(100)===u(900))return[400];if(u(100)===u(500)&&u(600)===u(900))return[400,700];for(var e={},t=100;t<=900;t+=100){var n=u(t);e[n]?e[n].push(t):e[n]=[t]}var i=[400,700];return Object.values(e).map(function(t){if(1===t.length)return t[0];var n=i.find(function(e){return t.includes(e)});if(n)return n;t.every(function(e,n){return 0===n||e-t[n-1]==100})||BeFunky.reportWarning("Weights for font are not consecutive",r,t,e);var a=Math.max.apply(Math,v(t)),o=Math.min.apply(Math,v(t));return a<400?o:a}).filter(Boolean).sort()}()};e:for(r.s();!(i=r.n()).done;){switch(a()){case"break":break e;case"continue":continue}}}catch(e){r.e(e)}finally{r.f()}}},{key:"debugFontWeightDetection",value:function(e){for(var t=e.message,n=e.shouldReport,i=void 0===n||n,r=e.fontObject,a=e.weight,o=e.measuredTextSize,s=e.baselineFont,l=e.baselineTextSize,u={},c=100;c<=900;c+=100)this.fontTestingContext.font="".concat(c," ").concat(this.fontTestingSize,"px ").concat(s),u[c]=this.fontTestingContext.measureText(this.fontTestingText).width;for(var h={},d=100;d<=900;d+=100)this.fontTestingContext.font="".concat(d," ").concat(this.fontTestingSize,"px ").concat(M(r.name),", ").concat(s),h[d]=this.fontTestingContext.measureText(this.fontTestingText).width;var m="monospace"===s?"serif":"monospace",p="monospace"===s?this.serifTextWidth:this.monospaceTextWidth;this.fontTestingContext.font="".concat(this.fontTestingSize,"px ").concat(M(r.name),", ").concat(s);var g=this.fontTestingContext.measureText(this.fontTestingText).width;this.fontTestingContext.font="".concat(this.fontTestingSize,"px monospace");var f=this.fontTestingContext.measureText(this.fontTestingText).width;this.fontTestingContext.font="".concat(this.fontTestingSize,"px serif");var v=this.fontTestingContext.measureText(this.fontTestingText).width,y={name:r.name,weight:a,measuredTextSize:o,baselineFont:s,baselineTextSize:l,baselineSizes:JSON.stringify(u),fontSizes:JSON.stringify(h),altBaseLineFont:m,altBaseLineFontSize:p,originalMeasuredTextSize:r.originalMeasuredTextSize,textSizeAtDefaultSize:g,monospaceWidthChanged:f!==this.monospaceTextWidth?"Yes, from ".concat(this.monospaceTextWidth," to ").concat(f):"No",serifWidthChanged:v!==this.serifTextWidth?"Yes, from ".concat(this.serifTextWidth," to ").concat(v):"No"};i?BeFunky.reportWarning(t,y):BeFunky.logWarning(t,y)}},{key:"addUserDefinedSystemFont",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=N(e);var n=this.getFontObject(e);if(n)return BeFunky.throwError("Attempted to add user-defined system font when one already existed",n),!1;var i=new w(e,"system",[],{isUserDefined:!0});if(t)i.isAvailable=!0;else if(this.testFonts([i]),!i.isAvailable)return!1;return this.testFontWeights([i]),console.log("Adding user-defined system font:",i),BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.concat([i]).sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),this.updateFontUI(),this.saveUserDefinedSystemFonts(),!0}},{key:"addUserDefinedFontFromSettings",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.weights,a=i.files,o=new w(e,t,r,{isUserDefined:!0,files:a}),s=this.getFontObject(e);if(s)if(s.isUserDefined)if("system"===s.type)o.replacedDefaultFont=s;else{if(s.type!==t)return BeFunky.throwError("Can't replace ".concat(s.type," font with ").concat(t," font")),!1;var l=s.weights.isIdenticalTo(r),u=JSON.stringify(s.files)===JSON.stringify(a);if("google"===t){if(l)return;s.weights=r}if("uploaded"===t){if(l&&u)return;s.weights=r,s.files=a}}else o.replacedDefaultFont=s;return o.replacedDefaultFont?(BFN.CONST.FONT_LIST.splice(BFN.CONST.FONT_LIST.indexOf(s),1,o),console.log("Replacing ".concat(s.type," font with user-defined font:"),o)):s||(BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.concat([o]).sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1})),(this.fontMenuComponent||this.fontManagerComponent)&&("google"===t?this.updateFontUI():this.loadUploadedFont(e,function(){return n.updateFontUI()})),!0}},{key:"removeUserDefinedFont",value:function(e){console.log("Removing user-defined font:",e);var t=this.getFontObject(e);if(!t||!t.isUserDefined)return BeFunky.throwError('User-defined font "'.concat(e,'" is not in list.'),t),!1;BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.filter(function(e){return e!==t});var n=t.replacedDefaultFont;return n&&(BFN.CONST.FONT_LIST=BFN.CONST.FONT_LIST.concat([n]).sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),"system"===n.type&&(this.testFonts([n]),n.isAvailable&&this.testFontWeights([n]))),this.updateFontUI(),"system"===t.type?this.saveUserDefinedSystemFonts():this.unloadFont(e,t.type),!0}},{key:"getUserDefinedSystemFontNames",value:function(){return BFN.IndexedDB.get(this.userDefinedSystemFontsKey).catch(function(e){BeFunky.logError("Unable to get user-defined system font names",e)}).then(function(e){return Array.isArray(e)?e.filter(function(e){return e&&"string"==typeof e}):[]})}},{key:"saveUserDefinedSystemFonts",value:function(){BFN.IndexedDB.set(this.userDefinedSystemFontsKey,BFN.CONST.FONT_LIST.filter(function(e){return e.isUserDefined&&"system"===e.type}).map(function(e){return e.name})).catch(function(e){BeFunky.logError("Unable to save user-defined system font names",e)})}},{key:"getRecentFonts",value:function(){var e=this;return BFN.IndexedDB.get("options__recentFontFamilies").catch(function(e){return BeFunky.logError("Unable to get recent font families from IndexedDB",e),[]}).then(function(t){return Array.isArray(t)?t.map(function(t){return e.findSimilarFont(t)}).filter(Boolean):[]})}},{key:"injectFontFace",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";this.customFontStylesheet.sheet.insertRule("\n            @font-face {\n                font-family: ".concat(M(e),";\n                src: ").concat(t.join(",\n"),";\n                font-weight: ").concat(n,";\n                font-style: normal;\n            }\n        "),0)}},{key:"preloadUploadedFonts",value:function(){var e=this,t=BFN.CONST.FONT_LIST.filter(function(t){var n=t.type,i=t.name;return"uploaded"===n&&!e.isLoaded(i)}).map(function(e){var t=e.name;return BFN.FontManager.load(t).catch(function(e){BeFunky.logError('Unable to preload user-uploaded font "'.concat(t,'"'),e)})});t.length&&Promise.all(t).then(function(){e.updateFontUI()})}},{key:"getFontObjectsForFontMenu",value:function(){return null===this.limitFontsForDesigners&&(this.limitFontsForDesigners=Boolean(BeFunky.getLocal("exclude_system_fonts"))),this.limitFontsForDesigners?BFN.CONST.FONT_LIST.filter(function(e){return!e.isUserDefined&&("google"===e.type||"befunky"===e.type)}):BFN.CONST.FONT_LIST.filter(function(e){return!1!==e.isAvailable})}},{key:"openFontMenu",value:function(){this.setupFontMenuComponent(),this.fontMenuComponent.show()}},{key:"closeFontMenu",value:function(){this.fontMenuComponent&&this.fontMenuComponent.hide()}},{key:"updateFontUI",value:function(){this.fontMenuComponent&&this.fontMenuComponent.setState({fonts:this.getFontObjectsForFontMenu()}),this.fontManagerComponent&&this.fontManagerComponent.setState({fonts:BFN.CONST.FONT_LIST.filter(function(e){return e.isUserDefined&&"system"!==e.type})})}},{key:"openFontManagerModal",value:function(){BFN.FabricManager.currentTextTransformItem&&BFN.FabricManager.currentTextTransformItem.exitTextEditing(),this.setupFontManagerComponent()&&(this.fontManagerComponent.show(),BeFunky.showAnnouncementOnce("font_management"))}},{key:"browseForFonts",value:function(){var e=this,t=[];BFN.MultipleFileUploader.upload(function(n){var i=n.file;if(n.isComplete)return e.handleUserFontFiles(t);t.push(i)},{fileType:"fonts",createMenuImageVO:!1})}},{key:"handleUserFontFiles",value:function(e){var t=this;if(this.setupFontManagerComponent()){var n=this.fontManagerComponent.state.fontsToUpload;n.find(function(e){return 100===e.uploadProgress})&&this.fontManagerComponent.setState({fontsToUpload:n.filter(function(e){return 100!==e.uploadProgress})});var i=this.fontManagerComponent.state.fontsToUpload.map(function(e){return e.fileName});BeFunky.showLoadScreen(),this.processFontFiles(e,i).then(function(e){var n=t.fontManagerComponent.state.fontsToUpload,i=50-n.length,r=[];if(i>0){var a=function(e,t){var n=e.fontFamily,i=e.fontWeight,r=e.fileName,a=e.error;return n?t.fontFamily===n&&t.fontWeight===i&&t.error===a:t.fileName===r&&t.error===a};e.forEach(function(e){i-r.length<=0||n.find(function(t){return a(e,t)})||r.find(function(t){return a(e,t)})||r.push(e)}),t.fontManagerComponent.setState({fontsToUpload:[].concat(r,v(t.fontManagerComponent.state.fontsToUpload))})}t.fontManagerComponent.setState({mode:"UPLOAD"}),t.openFontManagerModal(),BeFunky.hideLoadScreen()})}}},{key:"processFontFiles",value:function(e,t){return(e=e.filter(function(e){return!t.includes(e.name)}).filter(function(e){return BFN.DragAndDropManager.fontExtensions.includes(BFN.getExtension(e.name))}).slice(0,50)).length?BFN.RequestUtils.loadScript("opentype.0.8.0.min.js",function(){return window.opentype}).then(function(){return Promise.all(e.map(n))}).catch(function(e){return"request_failed"===e?BeFunky.logError("Unable to load OpenType.js"):BeFunky.throwError("Font processing failed",e),[]}):Promise.resolve([]);function n(e){return function(e){var t=BFN.getExtension(e.name);if(!B.map(function(e){return e.extension}).includes(t))return Promise.reject("font_type_not_supported");return function(e){return new Promise(function(t,n){BFN.BlobUtils.blobToArrayBuffer(e,function(e){var i=e.error,r=e.arrayBuffer;if(i)return n(i);t(r)})})}(e).then(i)}(e).then(function(t){var n,i=t.fontFamily,a=t.fontStyle,o=t.fontWeight;t.isItalic&&(n="italic_style");var s=BFN.CONST.FONT_LIST.find(function(e){return e.name===i});s&&"google"===s.type&&(n="google_font_conflict"),s&&"uploaded"===s.type&&s.files.find(function(e){return e.weight===o})&&(n="already_uploaded");var l=e.name;return{fontFamily:i,fontStyle:a,fontWeight:o,file:e,fileName:l,fileNameToUpload:r(Object.assign({fileName:l},t)),uploadProgress:null,error:n}}).catch(function(t){return{fileName:e.name,error:t}})}function i(e){var t;try{t=window.opentype.parse(e)}catch(e){throw BeFunky.logError("Unable to parse font file:",e),"parse_failed"}var n=[],i=function(){var e=t.getEnglishName("preferredSubfamily")||t.getEnglishName("fontSubfamily")||"Regular";n.push(e);var i=(t.getEnglishName("postScriptName")||"").split("-"),r=2===i.length?i[1]:"";if(r&&e&&"italic"!==l(e)&&l(r)!==l(e)){n.push(r);if({Reg:"Regular",Lt:"Light",Med:"Medium",SmBd:"Semibold"}[r]===e)return e;var a=t.getEnglishName("fullName")||"",o=a.includes(e),s=a.includes(r);return o&&!s?(BeFunky.logError("Font style (".concat(e,") does not match postScriptName (").concat(r,"). Choosing the former: ").concat(e,"."),t.names),e):(BeFunky.logError("Font style (".concat(e,") does not match postScriptName (").concat(r,"). Choosing the later: ").concat(r,"."),t.names),r)}return e}();if(!i)throw"no_style";var r=function(){var e=t.getEnglishName("preferredFamily");if(e)return e;var r=new RegExp(n.map(function(e){return e.trim().replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}).join("|"),"ig"),a=["fullName","fontFamily"].map(function(e){return t.getEnglishName(e)}).filter(Boolean).map(function(e){return e.replace(r,"").replace(/italic( |$)/i,"").replace(/\s+/g," ").replace(/(^-+)|(-+$)/g,"").trim()});if(!a.length)return"";if(1===a.length)return a[0];(function(e,t){return e=l(e).replace(/italic|condensed|extended|oblique/g,""),t=l(t).replace(/italic|condensed|extended|oblique/g,""),e===t}).apply(void 0,v(a))||BeFunky.throwError("Font family detection should be improved",{fontStyle:i,options:a},t.names);return a[0].length>=a[1].length?a[0]:a[1]}().replace(/'s( |$)/g,"’s$1");if(!r)throw"no_family_name";var a=function(){var e=["italic","condensed","extended","oblique","no\\.? \\d+","caps"],n=i.toLowerCase().trim();n=n.includes(" ")?n.replace(new RegExp("(^| )".concat(e.join("|"),"( |$)"),"g"),""):n.replace(new RegExp(e.join("|"),"g"),"");var a=s(n),o=Object.entries(F).map(function(e){var t=f(e,2),n=t[0],i=t[1];return[n,s(i)]}),u={demibold:"semibold",hairline:"thin"};u[a]&&(a=u[a]);var c=o.find(function(e){var t=f(e,2),n=t[1];return n===a});if(c)return parseInt(c[0]);if(!(/bold/i.test(i)||/light/i.test(i)||/thin/i.test(i)))return"italic"!==l(i)&&BeFunky.logError("Unable to get weight for font. Defaulting to 400.",{fontStyle:i,fontFamily:r}),400;BeFunky.throwError("Font weight matching should be improved",t.names)}();if(!a)throw"no_weight";var o=/italic/i.test(i);return console.log({fontFamily:r,fontStyle:i,fontWeight:a,isItalic:o}),{fontFamily:r,fontStyle:i,fontWeight:a,isItalic:o};function s(e){return e.toLowerCase().replace(/[^a-z]/g,"")}function l(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}}function r(e){var t=e.fileName,n=e.fontFamily,i=e.fontStyle,r=e.fontWeight,a=BFN.getExtension(t),o=n.replace(/[^a-z0-9-]/gi,""),s=i.replace(/[^a-z0-9-]/gi,""),l=BFN.getDateParts().slice(0,3).join(""),u=BeFunky.randomString(10);return"".concat(o,"-").concat(s,"-").concat(r,"-").concat(l,"-").concat(u,".").concat(a)}}},{key:"uploadUserFonts",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];function i(e){var t=BFN.getExtension(e.name),n=(B.find(function(e){return e.extension===t})||{}).mimeType;return n||BeFunky.throwError('Unsupported font type "'.concat(t,'"'),e.name),n}e.forEach(function(e){var r=e.fileNameToUpload,a=e.file,o=e.fontFamily,s=e.fontWeight;t.uploadingFonts[r]?BeFunky.throwError("Duplicate font file upload attempt"):(t.updateFontUploadProgress(e,0,n),t.uploadingFonts[r]=BeFunky.uploadFileToS3(a,{bucket:"user-fonts",contentType:i(a),fileName:r,progressHandler:function(i,r){var a=Math.round(100*i/r);t.updateFontUploadProgress(e,a,n)}}),t.uploadingFonts[r].then(function(){var i,a,l;t.updateFontUploadProgress(e,100,n),i=o,a=s,l=r,BFN.SettingsManager.getSetting("fonts_added").then(function(e){var t={name:i,type:"uploaded",weight:a,fileName:l};BFN.SettingsManager.updateSetting("fonts_added",[].concat(v(e),[t]))})}).catch(function(n){t.uploadingFonts[r].wasCancelled?BeFunky.logError("Font upload cancelled:",r):(BeFunky.logError("Font upload failed:",n),e.error=n),t.updateFontUploadProgress(e,null)}).then(function(){delete t.uploadingFonts[r]}))})}},{key:"cancelUserFontUpload",value:function(e){var t=e.fileNameToUpload;this.uploadingFonts[t].cancelUpload(),this.uploadingFonts[t].wasCancelled=!0}},{key:"updateFontUploadProgress",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.uploadProgress=t,n&&(this.fontManagerComponent.state.fontsToUpload.includes(e)||BeFunky.throwError("Font not in fontsToUpload"),this.fontManagerComponent.setState({fontsToUpload:v(this.fontManagerComponent.state.fontsToUpload)}))}},{key:"activeFont",get:function(){return this._activeFont},set:function(e){(e=N(e))!==this._activeFont&&(this._activeFont=e,this.fontMenuComponent&&this.fontMenuComponent.setState({activeFontName:e}),this.popoverButtonText&&(this.popoverButtonText.textContent=this.activeFont))}},{key:"activeFontWeight",get:function(){return this._activeFontWeight},set:function(e){k(e)?e!==this._activeFontWeight&&(this._activeFontWeight=e,this.fontMenuComponent&&this.fontMenuComponent.setState({activeFontWeight:e})):BeFunky.throwError("Invalid font weight:",e)}}]),n}();BFN.SingletonQueue.add(function(){BFN.FontManager=new ag});var og=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("FabricManager Init"),this.initDefaultValues(),this.initFabricCanvas(),this.initDefaultFont()}},{key:"initDefaultValues",value:function(){var e=this;this.$fabricCanvas=document.getElementById("fabricCanvas"),fabric.Object.prototype.transparentCorners=!1,this.textChanged=!1,this.styleChanged=!1,this.styleUpdating=!1,this.globalStylesUpdating=!1,this.styleChangeRequested=!1,this.desiredStyle=null,this.lastSelectionStart=-1,this.lastSelectionEnd=-1,this.mixedCharacter="—",this.userStyle={globalStyles:{},charStyles:{},itemStyles:{}},this.defaultBackgroundColor="FF0000",this.defaultOutlineColor="6666FF",this.defaultHighlightColor="FFFF66",this.startValues={},this.globalStyles=["textAlign","charSpacing","lineHeight"],this.itemStyles=["backgroundEnabled","backgroundColor","backgroundIntensity","backgroundPadding","outlineEnabled","highlightEnabled"],this.handleTextChangedBind=this.handleTextChanged.bind(this),this.handleTextSelectionChangedBind=this.handleTextSelectionChanged.bind(this),this.handleTextEditingExitedBind=this.handleTextEditingExited.bind(this),this.handleTextRightClickBind=this.handleTextRightClick.bind(this),this.handleTextDisplayUpdatedBind=this.handleTextDisplayUpdated.bind(this),this.handleBGMouseDownBind=this.handleBGMouseDown.bind(this),this.handleStageDimensionsUpdatedBind=this.handleStageDimensionsUpdated.bind(this),this.handleMainUIRenderedBind=this.handleMainUIRendered.bind(this),this.handleTextDeselectedBind=this.handleTextDeselected.bind(this),this.addStyleChangesToHistoryDebounced=BeFunky.debounce(this.addStyleChangesToHistoryDebounced.bind(this),200),document.addEventListener("keydown",this.handleDocumentKeyPress.bind(this),!0),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,function(){return setTimeout(BFN.FabricManager.updateStageDimensions.bind(e),0)}),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.CUSTOM_RESIZE_EVENT.type,function(){return setTimeout(BFN.FabricManager.updateStageDimensions.bind(e),0)})}},{key:"initFabricCanvas",value:function(){this.updateStageDimensions(),this.fabricCanvas=new fabric.Canvas("fabricCanvas",{enableRetinaScaling:2===window.bfn_resolution,fireRightClick:!0,stopContextMenu:!0}),this.fabricCanvas.selection=!1,this.fabricCanvasContext=this.fabricCanvas.getContext(),this.$fabricCanvas.setStyles({display:"none"})}},{key:"updateStageDimensions",value:function(){var e={width:BFN.appRect.width-BFN.CSS.leftMenuBarWidth,height:BFN.appRect.height-BFN.CSS.topMenuBarHeight};e.width<1&&e.height<1||(this.fabricCanvas?this.fabricCanvas.width===e.width&&this.fabricCanvas.height===e.height||(this.fabricCanvas.setWidth(e.width),this.fabricCanvas.setHeight(e.height)):(this.$fabricCanvas.setAttribute("width",e.width),this.$fabricCanvas.setAttribute("height",e.height)))}},{key:"initDefaultFont",value:function(){var e=this;this.activeFontFamily=null,this.activeFontWeight=null,setTimeout(function(){e.loadFont(e.defaultFontFamily,e.defaultFontWeight)},100)}},{key:"handleTextEditSelection",value:function(){var e=this;if("text"===BFN.TransformModel.selectedGroupType){var t=UITools.getToolVO("text_edit"),n=function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t.updating?(e.styleUpdating||(e.styleUpdating=!0,BFN.TransformItemGroup.clearDropShadow(),BFN.TransformItemGroup.createTransition(n),i&&i()),!1):(e.styleUpdating||(BFN.TransformItemGroup.clearDropShadow(),BFN.TransformItemGroup.createTransition(n),i&&i()),e.styleUpdating=!1,!0)},i=function(){BFN.TransformItemGroup.transformLayer.transformTool.updateDisplay(),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.increase()},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;for(var a in t){var o=t[a];e.setUserStyle(a,o)}BFN.TransformItemGroup.selectedItems.forEach(function(e){e.setITextStyle(n?n(e):t)}),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.decrease(),BFN.TransformItemGroup.strokeRectanglePool.clear(),BFN.TransformItemGroup.registerTransition(r,!0,!0,i,!0)};switch(t.updating_id){case"spacing_menu_popover_button":if(!t.updating){var a=document.getElementById("text_edit_".concat(t.updating_id.replace("_button","")));a.hasClass("active")?a.hide():a.show()}return;case"font":if(n(this.activeFontFamily===t.font?"history_font_weight":"history_font_family")){var o=N(t.font);this.setUserStyle("fontFamily",o),this.loadFont(o,t.weight)}break;case"size":n("history_font_size")&&(BFN.TransformItemGroup.selectedItems.forEach(function(n){var i=n.iText,r=i.charSpacing,a=n.textBackgroundPadding,o=t.size/(n.scale.x*n.textScale);for(var s in e.setStyle(i,"fontSize",o),n.conformITextToSmallestFontSize(),n.textScale/=n.fontSizeNormalizeFactor,i.styles){var l=i.styles[s];for(var u in l){var c=l[u];c.hasOwnProperty("strokePercent")&&c.hasOwnProperty("fontSize")&&(c.strokeWidth=c.strokePercent*c.fontSize)}}var h=null;for(var d in i.styles){var m=i.styles[d];for(var p in m){var g=m[p];g.hasOwnProperty("fontSize")&&(null===h||g.fontSize<h)&&(h=g.fontSize)}}var f=1;null!==h&&(f=h/BFN.TransformItemTextBaseFontSize),i.charSpacing=Math.round(r*f),n.textBackgroundPadding=a*f,n.updateITextBackgroundDisplay(),i.__skipDimension=!1,i.initDimensions(),n.setTextWidth(n.iText.width*n.textScale*n.scale.x)}),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.decrease(),BFN.TransformItemGroup.strokeRectanglePool.clear(),BFN.TransformItemGroup.registerTransition(void 0,!0,!0,i,!0));break;case"spacing":n("history_letter_spacing")&&r({charSpacing:100*t.spacing});break;case"line_height":n("history_text_line_height")&&r({lineHeight:t.line_height/100});break;case"bold":if(n("history_text_bold"))r({fontWeight:t.bold?this.getBoldWeight(t.font):this.getNormalWeight(t.font)},null,!0);break;case"italic":if(n("history_text_italic"))r({fontStyle:t.italic?"italic":""},null,!0);break;case"underline":if(n("history_text_underline"))r({underline:t.underline},null,!0);break;case"align":n("history_text_align")&&r({textAlign:t.align},null,!0);break;case"text_color":if(n("history_text_color",function(){var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.fill&&"#00000000"!==e.fill||-1==t.text_color)&&-1!=t.text_color||(UITools.setToolValue("text_edit","text_color_intensity",1,!1),UITools.updateToolControl("text_edit_text_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}))r({fill:-1==t.text_color?"#00000000":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.text_color,alpha:t.text_color_intensity})});break;case"background_enabled":if(n(t.background_enabled?"history_text_background_on":"history_text_background_off")&&(r({backgroundEnabled:t.background_enabled}),t.background_enabled&&!this.userStyle.itemStyles.hasOwnProperty("backgroundColor")&&this.setUserStyle("backgroundColor",this.defaultBackgroundColor),document.getElementById("text_edit_background_enabled").isOpen)){var s=BFN.TransformItemGroup.getTextGroupStyleData(),l=s.backgroundColor&&"mixed"!==s.backgroundColor?s.backgroundColor:-1;-1!=l&&"mixed"!==s.backgroundIntensity?(UITools.setToolValue("text_edit","background_color",l),UITools.setToolValue("text_edit","background_color_intensity",s.backgroundIntensity)):(UITools.setToolValue("text_edit","background_color",-1),UITools.setToolValue("text_edit","background_color_intensity",1)),UITools.setToolValue("text_edit","background_padding",s.hasOwnProperty("backgroundPadding")&&"mixed"!==s.backgroundPadding?s.backgroundPadding:0),UITools.updateToolControl("text_edit_background_color"),UITools.updateToolControl("text_edit_background_padding"),document.getElementById("text_edit_background_padding").isMixed="mixed"===s.backgroundPadding}break;case"background_color":n("history_text_background_color",function(){var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.backgroundColor&&-1!==e.backgroundColor&&"mixed"!==e.backgroundIntensity||-1==t.background_color)&&-1!=t.background_color||(UITools.setToolValue("text_edit","background_color_intensity",1,!1),UITools.updateToolControl("text_edit_background_color"),BFN.ColorPickerPanel.refreshIntensitySlider())})&&r({backgroundColor:t.background_color,backgroundIntensity:t.background_color_intensity});break;case"background_padding":n("history_text_background_padding")&&r({backgroundPadding:t.background_padding});break;case"stroke_enabled":if(n(t.stroke_enabled?"history_text_outline_on":"history_text_outline_off")){if(r({outlineEnabled:t.stroke_enabled}),t.stroke_enabled&&!this.userStyle.itemStyles.hasOwnProperty("stroke")){var u=this.userStyle.charStyles,c=u.stroke?u.stroke:BFN.ColorUtil.hexStringObjectToRGBAString({hex:this.defaultOutlineColor,alpha:1});this.setUserStyle("stroke",c)}if(document.getElementById("text_edit_stroke_enabled").isOpen){var h=BFN.TransformItemGroup.getTextGroupStyleData(),d=h.stroke&&"mixed"!==h.stroke?h.stroke:"";if(""!==d){var m=BFN.ColorUtil.rgbaStringToHexStringObject(d);UITools.setToolValue("text_edit","stroke_color",m.hex),UITools.setToolValue("text_edit","stroke_color_intensity",m.alpha)}else UITools.setToolValue("text_edit","stroke_color",-1),UITools.setToolValue("text_edit","stroke_color_intensity",0);var p=h.strokePercent&&"mixed"!==h.strokePercent?h.strokePercent:BFN.TransformItemTextStrokePercentDefault;UITools.setToolValue("text_edit","stroke_width",Math.round(99*this.textStrokePercentToFactor(p))+1),UITools.updateToolControl("text_edit_stroke_color"),UITools.updateToolControl("text_edit_stroke_width"),document.getElementById("text_edit_stroke_width").isMixed="mixed"===h.strokePercent}}break;case"stroke_color":if(n("history_text_outline_color",function(){var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.stroke&&""!==e.stroke||-1==t.stroke_color)&&-1!=t.stroke_color||(UITools.setToolValue("text_edit","stroke_color_intensity",1,!1),UITools.updateToolControl("text_edit_stroke_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}))r({stroke:-1==t.stroke_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.stroke_color,alpha:t.stroke_color_intensity})});break;case"stroke_width":if(n("history_text_outline_width"))r({strokePercent:this.factorToTextStrokePercent((t.stroke_width-1)/99)});break;case"highlight_enabled":if(n(t.highlight_enabled?"history_text_highlight_on":"history_text_highlight_off")){if(r({highlightEnabled:t.highlight_enabled}),t.highlight_enabled&&!this.userStyle.itemStyles.hasOwnProperty("textBackgroundColor")){var g=this.userStyle.charStyles,f=g.textBackgroundColor?g.textBackgroundColor:BFN.ColorUtil.hexStringObjectToRGBAString({hex:this.defaultHighlightColor,alpha:1});this.setUserStyle("textBackgroundColor",f)}if(document.getElementById("text_edit_highlight_enabled").isOpen){var v=BFN.TransformItemGroup.getTextGroupStyleData(),y=v.textBackgroundColor&&"mixed"!==v.textBackgroundColor?v.textBackgroundColor:"";if(""!==y){var x=BFN.ColorUtil.rgbaStringToHexStringObject(y);UITools.setToolValue("text_edit","highlight_color",x.hex),UITools.setToolValue("text_edit","highlight_color_intensity",x.alpha)}else UITools.setToolValue("text_edit","highlight_color",-1),UITools.setToolValue("text_edit","highlight_color_intensity","mixed"===v.textBackgroundColor?1:0);UITools.updateToolControl("text_edit_highlight_color")}}break;case"highlight_color":if(n("history_text_highlight_color",function(){var e=BFN.TransformItemGroup.getTextGroupStyleData();("mixed"!==e.textBackgroundColor&&""!==e.textBackgroundColor||-1==t.stroke_color)&&-1!=t.stroke_color||(UITools.setToolValue("text_edit","highlight_color_intensity",1,!1),UITools.updateToolControl("text_edit_highlight_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}))r({textBackgroundColor:-1==t.highlight_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.highlight_color,alpha:t.highlight_color_intensity})})}}}},{key:"handleTextEdit",value:function(){var e=this;if("text"!==BFN.TransformModel.selectedGroupType){var t=UITools.getToolVO("text_edit"),n=this.textTransformItem;if(this.updateLastTransitionIfGlobal=!1,n){this.textChanged&&(this.textChanged=!1,n.setTextWidth(n.iText.width*n.textScale*n.scale.x),n.registerTransition(!1,!1)),this.styleChanged=!1;var i=n.iText;switch(t.updating_id){case"spacing_menu_popover_button":if(!t.updating){var r=document.getElementById("text_edit_".concat(t.updating_id.replace("_button","")));r.hasClass("active")?r.hide():r.show()}return;case"font":var a=this.activeFontFamily!==t.font,o=this.activeFontWeight!==t.weight;if(!a&&!o)return;a?this.createTransformItemTransition(n,"history_font_family"):this.createTransformItemTransition(n,"history_font_weight");var s=N(t.font);return this.loadFont(s,t.weight),this.setUserStyle("fontFamily",s),void this.setUserStyle("fontWeight",t.weight);case"size":var l=function(){e.startValues.charSpacing=i.charSpacing,e.startValues.textBackgroundPadding=n.textBackgroundPadding,e.createTransformItemTransition(n,"history_font_size")};t.updating?this.styleUpdating||(this.styleUpdating=!0,l()):(this.styleUpdating||l(),this.styleUpdating=!1,this.styleChanged=!0);var u=t.size/(n.scale.x*n.textScale);if(this.setStyle(i,"fontSize",u),this.setUserStyle("fontSize",u),"global"===this.textModifyMode)for(var c in this.styleUpdating||(n.conformITextToSmallestFontSize(),n.textScale/=n.fontSizeNormalizeFactor),i.styles){var h=i.styles[c];for(var d in h){var m=h[d];m.hasOwnProperty("strokePercent")&&m.hasOwnProperty("fontSize")&&(m.strokeWidth=m.strokePercent*m.fontSize)}}else if("selection"===this.textModifyMode){var p=u*this.factorToTextStrokePercent((t.stroke_width-1)/99);this.setStyle(i,"strokeWidth",p)}var g=null;for(var f in i.styles){var v=i.styles[f];for(var y in v){var x=v[y];x.hasOwnProperty("fontSize")&&(null===g||x.fontSize<g)&&(g=x.fontSize)}}var _=1;null!==g&&(_=g/BFN.TransformItemTextBaseFontSize),i.charSpacing=Math.round(this.startValues.charSpacing*_),n.textBackgroundPadding=this.startValues.textBackgroundPadding*_,n.updateITextBackgroundDisplay(),"selection"===this.textModifyMode&&this.styleUpdating&&(this.styleChanged=!1,this.fabricCanvasContext.lineJoin="round",this.fabricCanvas.renderAll());break;case"spacing":t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"history_letter_spacing")):(this.styleUpdating||this.createTransformItemTransition(n,"history_letter_spacing"),this.styleUpdating=!1),this.setStyle(i,"charSpacing",100*t.spacing,!0),this.setUserStyle("charSpacing",100*t.spacing);break;case"line_height":t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"history_text_line_height")):(this.styleUpdating||this.createTransformItemTransition(n,"history_text_line_height"),this.styleUpdating=!1),this.setStyle(i,"lineHeight",t.line_height/100,!0),this.setUserStyle("lineHeight",t.line_height/100);break;case"bold":this.createTransformItemTransition(n,"history_text_bold");var I=this.isBoldWeight(this.getStyle(i,"fontWeight"))?this.getNormalWeight(t.font):this.getBoldWeight(t.font);this.setStyle(i,"fontWeight",I),this.setUserStyle("fontWeight",I),BFN.FontManager.activeFontWeight=this.getWeightNumber(I),this.updateLastTransitionIfGlobal=!0,t.weight!==I&&UITools.setControlValue("text_edit_weight",I);break;case"italic":this.createTransformItemTransition(n,"history_text_italic");var T="italic"===this.getStyle(i,"fontStyle");this.setStyle(i,"fontStyle",T?"":"italic"),this.setUserStyle("fontStyle",T?"":"italic"),this.updateLastTransitionIfGlobal=!0;break;case"underline":this.createTransformItemTransition(n,"history_text_underline");var b=this.getStyle(i,"underline")||!1;this.setStyle(i,"underline",!b),this.setUserStyle("underline",!b),this.updateLastTransitionIfGlobal=!0;break;case"align":t.align!=i.textAlign&&(this.createTransformItemTransition(n,"history_text_align"),this.setStyle(i,"textAlign",t.align,!0),this.setUserStyle("textAlign",t.align)),this.updateLastTransitionIfGlobal=!0;break;case"text_color":if(t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"global"===this.textModifyMode?"history_text_color":"history_text_color_selection")):(this.styleUpdating||this.createTransformItemTransition(n,"global"===this.textModifyMode?"history_text_color":"history_text_color_selection"),this.styleUpdating=!1),"text_color"===t.updating_id){var S=this.getStyle(i,"fill");-1==t.text_color&&"#00000000"!==S?(UITools.setToolValue("text_edit","text_color_intensity",0),UITools.updateToolControl("text_edit_text_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=t.text_color&&"#00000000"===S&&(UITools.setToolValue("text_edit","text_color_intensity",1),UITools.updateToolControl("text_edit_text_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}var C=-1==t.text_color?"#00000000":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.text_color,alpha:t.text_color_intensity});this.setStyle(i,"fill",C),this.setUserStyle("fill",C);break;case"background_enabled":t.updating||n.textBackgroundEnabled===t.background_enabled||(this.createTransformItemTransition(n,t.background_enabled?"history_text_background_on":"history_text_background_off"),n.textBackgroundEnabled=t.background_enabled,-1===n.textBackgroundColor&&(n.textBackgroundColor=this.defaultBackgroundColor,n.textBackgroundIntensity=1,UITools.setToolValue("text_edit","background_color",n.textBackgroundColor),UITools.setToolValue("text_edit","background_intensity",n.textBackgroundIntensity),UITools.updateToolControl("text_edit_background_color")),n.updateITextBackgroundDisplay(),this.setUserStyle("backgroundEnabled",t.background_enabled),t.background_enabled&&!this.userStyle.itemStyles.hasOwnProperty("backgroundColor")&&this.setUserStyle("backgroundColor",this.defaultBackgroundColor),this.styleChanged=!0);break;case"background_color":if(t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"history_text_background_color")):(this.styleUpdating||this.createTransformItemTransition(n,"history_text_background_color"),this.styleUpdating=!1),"background_color"===t.updating_id){var B=n.textBackgroundColor;-1==t.background_color&&-1!=B?(UITools.setToolValue("text_edit","background_color_intensity",0),UITools.updateToolControl("text_edit_background_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=t.background_color&&-1==B&&(UITools.setToolValue("text_edit","background_color_intensity",1),UITools.updateToolControl("text_edit_background_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}n.textBackgroundColor=t.background_color,n.textBackgroundIntensity=t.background_color_intensity,n.updateITextBackgroundDisplay(),this.setUserStyle("backgroundColor",t.background_color),this.setUserStyle("backgroundIntensity",t.background_color_intensity),this.styleChanged=!0;break;case"background_padding":t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"history_text_background_padding")):(this.styleUpdating||this.createTransformItemTransition(n,"history_text_background_padding"),this.styleUpdating=!1),n.textBackgroundPadding=t.background_padding,n.updateITextBackgroundDisplay(),this.setUserStyle("backgroundPadding",t.background_padding),this.styleChanged=!0;break;case"stroke_enabled":if(!t.updating&&n.textOutlineEnabled!==t.stroke_enabled){if(this.setUserStyle("outlineEnabled",t.stroke_enabled),this.createTransformItemTransition(n,t.stroke_enabled?"history_text_outline_on":"history_text_outline_off"),n.textOutlineEnabled=t.stroke_enabled,n.textOutlineEnabled&&i.styleIsEmpty("stroke")){var F=this.userStyle.charStyles,E=F.stroke?F.stroke:BFN.ColorUtil.hexStringObjectToRGBAString({hex:this.defaultOutlineColor,alpha:1});this.setStyle(i,"stroke",E,(i.selectionStart||0)===(i.selectionEnd||0)),this.userStyle.itemStyles.hasOwnProperty("stroke")||this.setUserStyle("stroke",E);var P=BFN.ColorUtil.rgbaStringToHexStringObject(E);UITools.setToolValue("text_edit","stroke_color",P.hex),UITools.setToolValue("text_edit","stroke_color_intensity",P.alpha),UITools.updateToolControl("text_edit_stroke_color")}this.styleChanged=!0}break;case"stroke_color":if(t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"history_text_outline_color")):(this.styleUpdating||this.createTransformItemTransition(n,"history_text_outline_color"),this.styleUpdating=!1),"stroke_color"===t.updating_id){var k=this.getStyle(i,"stroke");-1==t.stroke_color&&""!=k?(UITools.setToolValue("text_edit","stroke_color_intensity",0),UITools.updateToolControl("text_edit_stroke_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=t.stroke_color&&""==k&&(UITools.setToolValue("text_edit","stroke_color_intensity",1),UITools.updateToolControl("text_edit_stroke_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}var M=-1==t.stroke_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.stroke_color,alpha:t.stroke_color_intensity});this.setStyle(i,"stroke",M),-1!=t.stroke_color&&this.setUserStyle("stroke",M);break;case"stroke_width":t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"history_text_outline_width")):(this.styleUpdating||this.createTransformItemTransition(n,"history_text_outline_width"),this.styleUpdating=!1);var D=this.factorToTextStrokePercent((t.stroke_width-1)/99);if(this.setStyle(i,"strokePercent",D),this.setUserStyle("strokePercent",D),"global"===this.textModifyMode)for(var w in i.styles){var L=i.styles[w];for(var O in L){var R=L[O];R.hasOwnProperty("strokePercent")&&R.hasOwnProperty("fontSize")&&(R.strokeWidth=Math.max(R.strokePercent*R.fontSize,1/(n.textScale*n.scale.x)))}}else if("selection"===this.textModifyMode){var A=Math.max(this.getStyle(i,"fontSize")*D,1/(n.textScale*n.scale.x));this.setStyle(i,"strokeWidth",A),this.setUserStyle("strokeWidth",A)}break;case"highlight_enabled":if(!t.updating&&n.textHighlightEnabled!==t.highlight_enabled){if(this.setUserStyle("highlightEnabled",t.highlight_enabled),this.createTransformItemTransition(n,t.highlight_enabled?"history_text_highlight_on":"history_text_highlight_off"),n.textHighlightEnabled=t.highlight_enabled,n.textHighlightEnabled&&i.styleIsEmpty("textBackgroundColor")){var V=this.userStyle.charStyles,U=V.textBackgroundColor?V.textBackgroundColor:BFN.ColorUtil.hexStringObjectToRGBAString({hex:this.defaultHighlightColor,alpha:1});this.setStyle(i,"textBackgroundColor",U,(i.selectionStart||0)===(i.selectionEnd||0)),this.userStyle.itemStyles.hasOwnProperty("textBackgroundColor")||this.setUserStyle("textBackgroundColor",U);var G=BFN.ColorUtil.rgbaStringToHexStringObject(U);UITools.setToolValue("text_edit","highlight_color",G.hex),UITools.setToolValue("text_edit","highlight_color_intensity",G.alpha),UITools.updateToolControl("text_edit_highlight_color")}this.styleChanged=!0}break;case"highlight_color":if(t.updating?this.styleUpdating||(this.styleUpdating=!0,this.createTransformItemTransition(n,"history_text_highlight_color")):(this.styleUpdating||this.createTransformItemTransition(n,"history_text_highlight_color"),this.styleUpdating=!1),"highlight_color"===t.updating_id){var H=this.getStyle(i,"textBackgroundColor");-1==t.highlight_color&&""!=H?(UITools.setToolValue("text_edit","highlight_color_intensity",0),UITools.updateToolControl("text_edit_highlight_color"),BFN.ColorPickerPanel.refreshIntensitySlider()):-1!=t.highlight_color&&""==H&&(UITools.setToolValue("text_edit","highlight_color_intensity",1),UITools.updateToolControl("text_edit_highlight_color"),BFN.ColorPickerPanel.refreshIntensitySlider())}var z=-1==t.highlight_color?"":BFN.ColorUtil.hexStringObjectToRGBAString({hex:t.highlight_color,alpha:t.highlight_color_intensity});this.setStyle(i,"textBackgroundColor",z),-1!=t.highlight_color&&this.setUserStyle("textBackgroundColor",z)}}var j=!1;if(!t.updating)switch(t.updating_id){case"highlight_color":case"text_color":case"stroke_color":j=!0}this.applyStyleChange(t.updating_id,j)}else this.handleTextEditSelection()}},{key:"createTransformItemTransition",value:function(e,t){!this.styleChangeRequested&&e&&t&&(e.clearDropShadow(),e.createTransition(t))}},{key:"createNewText",value:function(){BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel).addedItem={type:"text"}}},{key:"editText",value:function(e,t,n){var i=this;this.currentTextTransformItem=e,this.currentTextTransformItem.visible=!1,BFN.MainUI.requestRender(),this.textChanged=!1,this.currentTextTransformItem.clearDropShadow(),this.currentTextTransformItem.createTransition("history_text_content");var r=e.iText;r.backupStyle={};try{var a=r.getSelectionStyles(0,0,!0);a.length&&Object.assign(r.backupStyle,a[0])}catch(e){}if(this.isDefaultText(this.currentTextTransformItem.iText.text))for(var o in r.text="",r.styles)delete r.styles[o];r.onDeselect!=this.handleTextDeselectedBind&&(r.onDeselectBak=r.onDeselect,r.onDeselect=this.handleTextDeselectedBind),r.backgroundColor="rgba(170,170,221,.5)",this.$fabricCanvas.setStyles({display:"block"}),this.conformITextToTransformItem(e),this.fabricCanvas.add(r),document.getElementById("appViewportBG").addClass("active"),document.getElementById("appViewport").addClass("active"),UIToggler.alternateMenu.addClass("alternate-menu--over-fabric-canvas"),BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.addClass("font-menu--over-fabric-canvas"),UIToggler.toggleMainMenu(!1),this.fabricCanvas.setActiveObject(r);var s=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,screenX:t,screenY:n,clientX:t,clientY:n}),l=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,screenX:t,screenY:n,clientX:t,clientY:n});r.fire("mousedown",{e:s}),r.fire("mouseup",{e:l}),r.fire("mousedown",{e:s}),r.fire("mouseup",{e:l}),document.getElementById("appViewportBG").addEventListener(BeFunky.pointerdown,this.handleBGMouseDownBind),requestAnimationFrame(function(){i.currentTextTransformItem&&(i.currentTextTransformItem.iText.onClick(),i.currentTextTransformItem.iText.selectAll(),i.currentTextTransformItem.iText.hiddenTextarea&&i.currentTextTransformItem.iText.hiddenTextarea.setStyles({lineHeight:"10px",opacity:1}),r.on("changed",i.handleTextChangedBind),r.on("selection:changed",i.handleTextSelectionChangedBind),r.on("editing:exited",i.handleTextEditingExitedBind),r.on("mousedown",i.handleTextRightClickBind),i.handleTextSelectionChangedBind(),i.fabricCanvasContext.lineJoin="round",i.fabricCanvas.renderAll(),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,i.handleStageDimensionsUpdatedBind),BFN.PhotoEditorCanvas.handleCanvasMouseOut(),BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(i.currentTextTransformItem),"enter_edit_text"))})}},{key:"conformITextToTransformItem",value:function(e){if(e){var t=e.iText,n=e.canvasScale*e.textScale*e.scale.x;t.scaleX=t.scaleY=n,t.flipX=e.flippedHorizontal,t.flipY=e.flippedVertical,t.rotate(e.rotation*(180/Math.PI)),t.left=e.transform.worldTransform.tx-BFN.MainUI.x,t.top=e.transform.worldTransform.ty-BFN.MainUI.y}}},{key:"applyStyleChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.textTransformItem;if(n&&this.styleChanged){this.styleChanged=!1;var i=n.iText;if(t)i.__skipDimension=!1,i.initDimensions();else switch(e){case"font":case"size":case"spacing":case"line_height":case"bold":case"italic":case"underline":case"align":case"stroke_width":i.__skipDimension=!1,i.initDimensions()}n.ignoreAccurateBounds=this.styleUpdating,n.setTextWidth(n.iText.width*n.textScale*n.scale.x,!1,!1),"global"===this.textModifyMode&&(this.globalStylesUpdating||(this.globalStylesUpdating=!0,this.showTransformItemIText(n))),this.styleUpdating||(this.styleChangeRequested=!0,n.preventEditText=!0,this.addStyleChangesToHistoryDebounced(n)),"global"===this.textModifyMode?n.transformTool.updateDisplay():!this.styleUpdating&&i.hiddenTextarea&&i.hiddenTextarea.focus(),this.fabricCanvasContext.lineJoin="round",this.fabricCanvas.requestRenderAll()}}},{key:"addStyleChangesToHistoryDebounced",value:function(e){var t=this;this.styleChangeRequested=!1,e.preventEditText=!1,e.setTextWidth(e.iText.width*e.textScale*e.scale.x,!1,!0),this.globalStylesUpdating&&(this.globalStylesUpdating=!1,requestAnimationFrame(function(){t.globalStylesUpdating||t.hideTransformItemIText(e)}));var n=this.updateLastTransitionIfGlobal&&"global"===this.textModifyMode;e.registerTransition(n,!1),n||e.createTransition("history_text_content")}},{key:"showTransformItemIText",value:function(e){this.showingTransformItemIText=!0,this.$fabricCanvas.setStyles({display:"block"}),document.getElementById("appViewport").addClass("active"),e.toggleHiResText(!0),BFN.MainUI.renderCanvas(),this.conformITextToTransformItem(e),this.fabricCanvas.add(e.iText),this.fabricCanvasContext.lineJoin="round",this.fabricCanvas.renderAll()}},{key:"hideTransformItemIText",value:function(e){var t=this;this.showingTransformItemIText=!1;var n=function(){t.showingTransformItemIText||(BFN.HiResTextManager.useHiResText||BFN.MainUI.renderCanvas(),t.removeAllFabricCanvasObjects(),t.$fabricCanvas.setStyles({display:"none"}),document.getElementById("appViewport").removeClass("active"))};e?e.updateHiResTextBounds(!0,n):n()}},{key:"removeAllFabricCanvasObjects",value:function(){for(var e=this.fabricCanvas.getObjects(),t=0;t<e.length;t++)this.fabricCanvas.remove(e[t]);this.fabricCanvas.clear()}},{key:"updateTextMenu",value:function(e){var t=this;if(e&&e.hasOwnProperty("fontSizeStart")){for(var n in e)if(void 0===e[n])return;var i=!BFN.TransformModel.selectedTransformItem&&this.currentTextTransformItem&&this.currentTextTransformItem.iText.isEditing,r=!0;if(i){var a=this.currentTextTransformItem.iText;a._updateTextarea(),r=0===a.hiddenTextarea.selectionStart&&a.hiddenTextarea.selectionEnd===a.hiddenTextarea.value.length}var o={},s=function(e,t){o[e]=t};s("font","mixed"===e.fontFamily?this.mixedCharacter:N(e.fontFamily)),s("size","mixed"===e.fontSize?"mixed"===e.fontSizeStart?e.fontSizeMin:e.fontSizeStart:e.fontSize),s("size_mixed","mixed"===e.fontSize),s("weight",this.getWeightNumber(e.fontWeight)),s("bold",this.isBoldWeight(e.fontWeight)),s("italic","italic"===e.fontStyle),s("underline",!!e.underline&&"mixed"!==e.underline),s("spacing","mixed"===e.charSpacing?0:e.charSpacing/100),s("line_height",100*("mixed"===e.lineHeight?BFN.TransformItemTextBaseLineHeight:e.lineHeight)),s("align",e.textAlign);var l=e.fill&&"mixed"!==e.fill?e.fill:"#00000000";if("#00000000"!==l){var u=BFN.ColorUtil.rgbaStringToHexStringObject(l);s("text_color",u.hex),s("text_color_intensity",u.alpha)}else s("text_color",-1),s("text_color_intensity","mixed"===e.fill?1:0);var c=e.backgroundColor&&"mixed"!==e.backgroundColor?e.backgroundColor:-1;-1!=c&&"mixed"!==e.backgroundIntensity?(s("background_color",c),s("background_color_intensity",e.backgroundIntensity)):(s("background_color",-1),s("background_color_intensity",1)),s("background_padding",e.hasOwnProperty("backgroundPadding")&&"mixed"!==e.backgroundPadding?e.backgroundPadding:0);var h=e.stroke&&"mixed"!==e.stroke?e.stroke:"";if(""!==h){var d=BFN.ColorUtil.rgbaStringToHexStringObject(h);s("stroke_color",d.hex),s("stroke_color_intensity",d.alpha)}else s("stroke_color",-1),s("stroke_color_intensity",0);var m=e.strokePercent&&"mixed"!==e.strokePercent?e.strokePercent:BFN.TransformItemTextStrokePercentDefault;s("stroke_width",Math.round(99*this.textStrokePercentToFactor(m))+1);var p=e.textBackgroundColor&&"mixed"!==e.textBackgroundColor?e.textBackgroundColor:"";if(""!==p){var g=BFN.ColorUtil.rgbaStringToHexStringObject(p);s("highlight_color",g.hex),s("highlight_color_intensity",g.alpha)}else s("highlight_color",-1),s("highlight_color_intensity","mixed"===e.textBackgroundColor?1:0);["font","weight","size","bold","italic","underline","spacing","line_height","align","text_color","text_color_intensity","background_color","background_color_intensity","background_padding","stroke_color","stroke_color_intensity","stroke_width","highlight_color","highlight_color_intensity"].forEach(function(e){o.hasOwnProperty(e)||BeFunky.throwError("Style Data Object Parameter Missing",e),"font"===e?(t.activeFontFamily=o.font===t.mixedCharacter?null:o.font,BFN.FontManager.activeFont=N(o.font)):"weight"===e&&(t.activeFontWeight=BFN.FontManager.activeFontWeight=o.weight),UITools.setToolValue("text_edit",e,o[e])}),UITools.updateToolControls("text_edit"),document.getElementById("text_edit_size").mixed=!!o.size_mixed,document.getElementById("text_edit_background_padding").isMixed="mixed"===e.backgroundPadding,document.getElementById("text_edit_stroke_width").isMixed="mixed"===e.strokePercent,document.getElementById("text_edit_text_color").isMixed="mixed"===e.fill,document.getElementById("text_edit_background_color").isMixed="mixed"===e.backgroundColor,document.getElementById("text_edit_stroke_color").isMixed="mixed"===e.stroke,document.getElementById("text_edit_highlight_color").isMixed="mixed"===e.textBackgroundColor;var f=document.getElementById("text_edit_background_enabled");f.checked=e.backgroundEnabled?"mixed"===e.backgroundEnabled?"mixed":"on":"off",f.openWhenChecked=e.backgroundColorEmpty;var v=document.getElementById("text_edit_stroke_enabled");v.checked=e.outlineEnabled?"mixed"===e.outlineEnabled?"mixed":"on":"off",v.openWhenChecked=e.strokeEmpty;var y=document.getElementById("text_edit_highlight_enabled");y.checked=e.highlightEnabled?"mixed"===e.highlightEnabled?"mixed":"on":"off",y.openWhenChecked=e.textBackgroundColorEmpty,document.getElementById("text_edit_stroke_color").emptyEnabled=i&&!r,document.getElementById("text_edit_highlight_color").emptyEnabled=i&&!r}}},{key:"loadFont",value:function(e,t){var n=this;k(t)||(BeFunky.logError("Invalid font weight for ".concat(e,":"),t),t=this.defaultFontWeight),this.activeFontFamily=e,this.activeFontWeight=t;var i=this.isBoldWeight(this.activeFontWeight);if(UITools.getControlValue("text_edit_bold")!==i&&(UITools.setControlValue("text_edit_bold",i),UITools.updateToolControl("text_edit_bold")),BFN.FontManager.isLoaded(e))return this.handleWebFontLoaded(e,t);BFN.TransformModel.addEventListener(BFN.TransformModelEvents.TRANSFORM_ITEM_UPDATED.type,function e(){n.activeFontFamily=null,BFN.TransformModel.removeEventListener(BFN.TransformModelEvents.TRANSFORM_ITEM_UPDATED.type,e)}),BFN.FontManager.load(e).then(function(){return n.handleWebFontLoaded(e,t)}).catch(this.handleWebFontLoadError.bind(this))}},{key:"setUserStyle",value:function(e,t){"fontFamily"===e&&(t=M(t)),this.itemStyles.includes(e)?this.userStyle.itemStyles[e]=t:this.globalStyles.includes(e)?this.userStyle.globalStyles[e]=t:this.userStyle.charStyles[e]=t,this.currentTextTransformItem&&this.currentTextTransformItem.iText&&this.currentTextTransformItem.iText.backupStyle&&(this.currentTextTransformItem.iText.backupStyle[e]=t)}},{key:"setStyle",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"fontFamily"===t&&(n=M(n));var r={};if(r[t]=n,e.setSelectionStyles&&e.isEditing&&!i){var a=e.selectionStart||0,o=e.selectionEnd||0;a===o?(this.desiredStyle||(this.desiredStyle={}),this.desiredStyle[t]=n):e.setSelectionStyles(r,a,o)}else if(this.globalStyles.includes(t))e[t]=n;else{e.__skipDimension=-1!=["textBackgroundColor","fill","stroke"].indexOf(t);for(var s=0;s<e.text.length;s++)e._extendStyles(s,r)}this.styleChanged||(this.styleChanged=!0)}},{key:"getStyle",value:function(e,t){var n="";if(e.getSelectionStyles&&e.isEditing){var i=e.selectionStart||0,r=i+1;e.text.length&&e.selectionStart>0&&(i===e.text.length||e.selectionStart===e.selectionEnd)&&(i--,r--);var a=e.getSelectionStyles(i,r,!0);n=a.length&&a[0].hasOwnProperty(t)?a[0][t]:""}else n=e.styles.hasOwnProperty("0")&&e.styles[0].hasOwnProperty("0")?e.styles[0][0][t]:e[t];return n}},{key:"factorToTextStrokePercent",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*(BFN.TransformItemTextStrokePercentMax-BFN.TransformItemTextStrokePercentMin)+BFN.TransformItemTextStrokePercentMin}},{key:"textStrokePercentToFactor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BFN.TransformItemTextStrokePercentMin;return((e=Math.max(BFN.TransformItemTextStrokePercentMin,Math.min(BFN.TransformItemTextStrokePercentMax,e)))-BFN.TransformItemTextStrokePercentMin)/(BFN.TransformItemTextStrokePercentMax-BFN.TransformItemTextStrokePercentMin)}},{key:"handleWebFontLoaded",value:function(e,t){if(this.activeFontFamily===e&&this.activeFontWeight===t)if("text"===BFN.TransformModel.selectedGroupType)BFN.TransformItemGroup.selectedItems.forEach(function(n){n.setITextStyle({fontFamily:e,fontWeight:t})}),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.decrease(),BFN.TransformItemGroup.strokeRectanglePool.clear(),BFN.TransformItemGroup.registerTransition(void 0,!0,!0,function(){BFN.TransformItemGroup.transformLayer.transformTool.updateDisplay(),BFN.TransformItemGroup.transformLayer.transformTool.fadeAnimator.increase()},!0);else{var n=this.textTransformItem;n&&(this.setStyle(n.iText,"fontFamily",e,"global"===this.textModifyMode),this.setStyle(n.iText,"fontWeight",t,"global"===this.textModifyMode),this.applyStyleChange("font"))}}},{key:"handleWebFontLoadError",value:function(e){BeFunky.logError(e)}},{key:"handleTextChanged",value:function(){var e=!this.textChanged;if(this.textChanged||(this.textChanged=!0,e=!0),this.lastSelectionStart=-1,this.lastSelectionEnd=-1,this.currentTextTransformItem){var t=this.currentTextTransformItem.iText;t.__skipDimension=!1,t.text.length||(this.lastSelectionStart=0,this.lastSelectionEnd=0,t.inputErase||Object.assign(t.backupStyle,this.userStyle.charStyles));for(var n=t.getSelectionStyles(0,t.textLength||t.text.length,!0),i=Object.assign({},t.backupStyle),r=0;r<n.length;r++)n[r].hasOwnProperty("strokePercent")&&void 0!==n[r].strokePercent?i=Object.assign({},n[r]):i&&(this.desiredStyle&&Object.assign(i,this.desiredStyle),t.setSelectionStyles(i,r,r+1));e=e||1===t.text.length,this.desiredStyle&&t.selectionStart>0&&t.selectionStart===t.selectionEnd?t.setSelectionStyles(this.desiredStyle,t.selectionStart-1,t.selectionStart):e&&t.backupStyle&&1===t.selectionStart&&t.selectionStart===t.selectionEnd&&t.setSelectionStyles(t.backupStyle,t.selectionStart-1,t.selectionStart),t.text.length&&t.selectionStart===t.selectionEnd&&(n=t.selectionStart>0?t.getSelectionStyles(t.selectionStart-1,t.selectionStart,!0):t.getSelectionStyles(t.selectionStart,t.selectionStart+1,!0)).length&&Object.assign(t.backupStyle,n[0]),this.updateTextMenu(this.currentTextTransformItem.getTextStyleData())}this.desiredStyle=null}},{key:"handleTextSelectionChanged",value:function(){if(this.currentTextTransformItem){var e=this.currentTextTransformItem.iText;if(e.getSelectionStyles&&e.isEditing){if(e.selectionStart===this.lastSelectionStart&&e.selectionEnd===this.lastSelectionEnd&&e.selectionStart===e.selectionEnd)return;this.lastSelectionStart=e.selectionStart,this.lastSelectionEnd=e.selectionEnd}}if(this.desiredStyle=null,this.currentTextTransformItem){var t=this.currentTextTransformItem.iText;if(t.getSelectionStyles&&t.isEditing&&t.text.length){var n=t.selectionStart||0,i=n+1,r=t.getSelectionStyles(n,i,!0);r&&r.length&&Object.assign(t.backupStyle,r[0])}this.updateTextMenu(this.currentTextTransformItem.getTextStyleData()),t.cursorColor="#FF0000"}}},{key:"handleTextEditingExited",value:function(e){if(document.getElementById("appViewportBG").removeEventListener(BeFunky.pointerdown,this.handleBGMouseDownBind),BFN.StageModel.removeEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdatedBind),document.getElementById("appViewportBG").removeClass("active"),document.getElementById("appViewport").removeClass("active"),this.currentTextTransformItem){BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this.currentTextTransformItem),"exit_edit_text");var t=this.currentTextTransformItem.iText;t.backgroundColor="",t.off("changed",this.handleTextChangedBind),t.off("selection:changed",this.handleTextSelectionChangedBind),t.off("editing:exited",this.handleTextEditingExitedBind),t.off("mousedown",this.handleTextRightClickBind),t.onDeselectBak&&t.onDeselect!==t.onDeselectBak&&(t.onDeselect=t.onDeselectBak),this.currentTextTransformItem.refreshItemName(),this.currentTextTransformItem.addEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleTextDisplayUpdatedBind),this.currentTextTransformItem.setTextWidth(this.currentTextTransformItem.iText.width*this.currentTextTransformItem.textScale*this.currentTextTransformItem.scale.x/this.currentTextTransformItem.fontSizeNormalizeFactor)}}},{key:"handleTextRightClick",value:function(e){var t=e.target;if(t&&t.isEditing&&3===e.button){BFN.TooltipScreen.setPosition(e.e.pageX,e.e.pageY,!1,!0);var n=BeFunky.LanguageManager.getStringReplacements("guide_copy_paste",{copyShortcut:BFN.shortcutText("C"),pasteShortcut:BFN.shortcutText("V")}),i='<div style="line-height: 1.5; margin: 0 .25rem">'.concat(n,"</div>");BFN.TooltipScreen.show(i,!0,!1,!0),setTimeout(function(){BFN.TooltipScreen.reserved=!1,t.hiddenTextarea&&t.hiddenTextarea.focus()},500)}}},{key:"handleTextDisplayUpdated",value:function(){this.currentTextTransformItem.removeEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleTextDisplayUpdatedBind),this.currentTextTransformItem.selectItem(),this.currentTextTransformItem.transformTool.conformItemToBounds(),this.currentTextTransformItem.transformTool.updateDisplayForTextResize(),this.textChanged&&(this.textChanged=!1,this.currentTextTransformItem.registerTransition(!1,!1)),this.currentTextTransformItem.visible=!0,this.currentTextTransformItem.updateHiResTextBounds(!0,null,!0),BFN.MainUI.addEventListener(BFN.MainUIEvents.RENDERED.type,this.handleMainUIRenderedBind),BFN.MainUI.requestRender()}},{key:"handleMainUIRendered",value:function(){BFN.MainUI.removeEventListener(BFN.MainUIEvents.RENDERED.type,this.handleMainUIRenderedBind),this.$fabricCanvas.setStyles({display:"none"}),this.removeAllFabricCanvasObjects(),this.currentTextTransformItem&&(delete this.currentTextTransformItem.iText.backupStyle,this.currentTextTransformItem=null),BFN.TransformModel.selectedTransformItemText=null,UIToggler.alternateMenu.removeClass("alternate-menu--over-fabric-canvas"),BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.removeClass("font-menu--over-fabric-canvas"),UIToggler.toggleMainMenu(!0)}},{key:"handleBGMouseDown",value:function(){var e=this;BFN.SentryManager.reportBreadcrumb("appViewportBG","pointer_down"),setTimeout(function(){e.currentTextTransformItem&&e.currentTextTransformItem.exitTextEditing()},0)}},{key:"handleStageDimensionsUpdated",value:function(){BFN.SentryManager.reportBreadcrumb("","stage_dimensions_updated"),this.currentTextTransformItem&&this.currentTextTransformItem.exitTextEditing()}},{key:"handleTextDeselected",value:function(){var e=this;BFN.SentryManager.reportBreadcrumb("","text_deselected"),setTimeout(function(){e.currentTextTransformItem&&e.currentTextTransformItem.exitTextEditing()},0)}},{key:"handleDocumentKeyPress",value:function(e){this.iTextEditing&&this.currentTextTransformItem&&this.currentTextTransformItem.iText&&this.currentTextTransformItem.iText.hiddenTextarea&&!BeFunky.isTextBoxFocused()&&this.currentTextTransformItem.iText.hiddenTextarea.focus(),90===e.keyCode&&this.iTextEditing&&(e.ctrlKey||e.metaKey)&&(e.stopImmediatePropagation(),e.preventDefault())}},{key:"isBoldWeight",value:function(e){return"bold"===e||parseInt(e)>=600}},{key:"getWeightNumber",value:function(e){var t=parseInt(e);return k(t)?t:"bold"===e?700:400}},{key:"getFontWeights",value:function(e){if(e===this.mixedCharacter)return[];var t=BFN.FontManager.getFontObject(e);return t?(t.weights.length||BFN.FontManager.testFontWeights([t]),t.weights):(BeFunky.throwError("Unable to get font object for font",e),[])}},{key:"getNormalWeight",value:function(e){var t=this.getFontWeights(e);return[400,500,300,200,100].find(function(e){return t.includes(e)})||""}},{key:"getBoldWeight",value:function(e){var t=this.getFontWeights(e);return[700,800,900,600].find(function(e){return t.includes(e)})||"bold"}},{key:"isDefaultText",value:function(e){return e.trim()===BeFunky.LanguageManager.getString("click_when_selected")}},{key:"textTransformItem",get:function(){return!this.currentTextTransformItem&&BFN.TransformModel.selectedTransformItem&&"text"===BFN.TransformModel.selectedTransformItem.type?BFN.TransformModel.selectedTransformItem:this.currentTextTransformItem&&!BFN.TransformModel.selectedTransformItem?this.currentTextTransformItem:null}},{key:"textModifyMode",get:function(){return!this.currentTextTransformItem&&BFN.TransformModel.selectedTransformItem&&"text"===BFN.TransformModel.selectedTransformItem.type?"global":this.currentTextTransformItem&&!BFN.TransformModel.selectedTransformItem?"selection":null}},{key:"iTextEditing",get:function(){return"block"===this.$fabricCanvas.style.display}},{key:"defaultFontFamily",get:function(){return BFN.FontManager.defaultFontFamily}},{key:"defaultFontWeight",get:function(){return BFN.FontManager.defaultFontWeight}}]),e}();function sg(){BFN.EventDispatcher.call(this),this.init()}function lg(){var e=g(['\n        <div class="google-photos-albums__dropdown button-group">\n            ',"\n            <button @click=",' class="button button--icon button--white-outline" style="margin-left: .25rem;" data-tooltip="create_album">',"</button>\n        </div>"]);return lg=function(){return e},e}function ug(){var e=g(["<div></div>"]);return ug=function(){return e},e}function cg(){var e=g(['\n            <div class="google-photos-albums__dropdown">\n                <button @click=',' class="button button--has-icon button--grey-outline">'," <string>","</string></button>\n            </div>"]);return cg=function(){return e},e}function hg(){var e=g(['\n            <div class="google-photos-albums__loading">\n                <div class="loading-spinner"></div> <string>',"</string>\n            </div>"]);return hg=function(){return e},e}function dg(){var e=g(['\n        <div class="checkbox">\n            <input type="checkbox" id="toggle_google_photos_album" @change='," .checked=",'>\n            <label class="checkbox__label" for="toggle_google_photos_album">\n                <span class="checkbox__box checkbox__box--sm">\n                    ',"\n                </span>\n                <string>","</string>\n            </label>\n        </div>\n        ","\n        "]);return dg=function(){return e},e}function mg(){var e=g(['<div class="google-photos-albums control-item"></div>']);return mg=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.FabricManager=new og}),sg.prototype=Object.create(BFN.EventDispatcher.prototype),sg.prototype.init=function(){BeFunky.log("OverlaysManager Init"),this.initDefaultValues()},sg.prototype.initDefaultValues=function(){this.isDataLoaded=!1,this.loadedItemCategories=[]},sg.prototype.loadCategories=function(){var e=this;this.isDataLoaded||BFN.OverlaysDataLoader.load(function(){if(!e.isDataLoaded&&!Object.keys(BFN.OverlaysData).length)return BeFunky.logError("Unable to get overlays data");e.isDataLoaded=!0,e.setupCategoryMenu()})},sg.prototype.setupCategoryMenu=function(){var e=this;BFN.UIMenuData.categoryMenus.editor_overlay.forEach(function(e){var t=e.id,n=e.name,i=t.replace("editor_overlay_","");if(!BFN.OverlaysData.hasOwnProperty(i)||!BFN.OverlaysData[i].freeOverlays.length&&!BFN.OverlaysData[i].plusOverlays.length){var r=document.getElementById(t);r.parentNode.removeChild(r)}BFN.OverlaysData.hasOwnProperty(i)&&(BFN.OverlaysData[i].langId=n,BFN.OverlaysData[i].englishName=BeFunky.LanguageManager.getString(n,"en"))}),v(document.getElementById("editor_overlay_category_menu").children).forEach(function(e){e.disabled=!1}),this.overlayMenuData=[],this.overlayMenuDataHash={},this.overlayCategoryIDMap={},this.overlayPresetMap={},this.overlayIDMap={};var t=function(t){var n=BFN.OverlaysData[t],i={id:n.id,name:n.name,englishName:n.englishName,langId:n.langId,presets:[]},r=function(t,n){t.forEach(function(t){var r=i.id+(n?"_plus_":"_free_")+t,a="".concat(BeFunky.LanguageManager.getString(i.englishName)," ").concat(i.presets.length+1),o=[i.langId,{suffix:(i.presets.length+1).toString()}],s={id:r,name:a,isPlus:n,categoryID:i.id,categoryName:i.name,usePaint:!1,lang:o,params:[{type:"static",name:"overlayID",defaultValue:r},{type:"static",name:"overlayName",defaultValue:a},{type:"static",name:"overlayLang",defaultValue:o},{type:"static",name:"categoryID",defaultValue:i.id},{type:"static",name:"categoryName",defaultValue:i.name}]};BFN.toolViewstates["".concat(i.id,"_").concat(s.id)]=BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY,i.presets.push(s),e.overlayCategoryIDMap["".concat(i.id,"_").concat(s.id)]=s.id,e.overlayIDMap[s.id]=i.id,e.overlayPresetMap[s.id]=s})};r(n.freeOverlays,!1),r(n.plusOverlays,!0),e.overlayMenuData.push(i),e.overlayMenuDataHash[t]=i};for(var n in BFN.OverlaysData)t(n);UITools.initToolVOs(this.overlayMenuData)},sg.prototype.setupCategoryItems=function(e){if(!this.loadedItemCategories.includes(e)&&(this.loadedItemCategories.push(e),this.overlayMenuDataHash.hasOwnProperty(e))){var t=this.overlayMenuDataHash[e];document.getElementById("editor_tool_menu_container").insertAdjacentHTML("beforeend",'\n        <div id="overlay_'.concat(e,'_menu" class="tool-menu">\n            <panel-header lang-id="').concat(t.langId,'" buttons="back" modifier="tertiary" clue-id="effect_basic_settings"></panel-header>\n            <div class="popover-placeholder"></div>\n            <div class="menu-content scrollable-content"></div>\n        </div>\n    '));var n=document.getElementById("overlay_".concat(e,"_menu")),i=n.querySelector("panel-header"),r=n.querySelector(".popover-placeholder");i.addEventListener("BACK",function(){UIToggler.cancelActiveEditorTool(),showMenuPanel("secondary")});var a=document.createDocumentFragment(),o=document.getElementById("overlay_generic_menu"),s=document.getElementById("editor_apply_cancel_menu");t.presets.forEach(function(e){var n=document.createElement("div");n.id="".concat(e.id,"_menu");var l="".concat(t.id,"_").concat(e.id),u=e.useGeneric,c=void 0===u||u,h=e.useBasicAmount,d=void 0===h||h,m=e.usePaint,p=void 0===m||m;BFN.UI.presetMenuItem(n,{presetID:l,presetLang:e.lang,presetObject:e,useGeneric:c,usePaint:p,useFavoriteIcon:!1,useBatchProcessingIcon:!1,genericMenu:o,brushMenu:void 0,applyCancelMenu:s,imageThumbnailSrc:"",useProcessedThumb:!0,useBasicAmount:d,presetAmountSliderID:"overlay_generic_opacity",helpClueID:"effect_basic_settings",helpCluePlaceholder:r,paintModeHelpClueID:void 0,categoryHeader:i}),BFN.EDITOR_MENU.presetGenericMenuIDs[l]="overlay_generic_menu",BFN.EDITOR_MENU.presetBrushMenuIDs[l]=null,BFN.EDITOR_MENU.applyCancelMenuIDs[l]="editor_apply_cancel_menu",a.appendChild(n)}),n.querySelector(".menu-content").appendChild(a)}},BFN.SingletonQueue.add(function(){BFN.OverlaysManager=new sg});var pg=BeFunky.lit,gg=pg.html,fg=pg.setupState,vg=pg.render,yg=pg.elem,xg=pg.appLang,_g=pg.icon;function Ig(e){var t,n=e.fetchAlbums,i=e.createAlbum,r=e.onToggle,a=yg(mg()),o=BeFunky.debounce(function(){return vg(gg(dg(),h,l.isEnabled,_g("checkmark-icon","icon checkbox__icon icon--12"),xg("save_to_album"),l.isEnabled?l.isLoading?gg(hg(),xg("loading")):l.writeableAlbums.length?(t=t||Pi(yg(ug()),{onChange:function(){},initialOptions:l.writeableAlbums.map(function(e){var t=e.album_id;return{name:e.title,value:t}}),translateOptionNames:!1}),gg(lg(),t,d,_g("plus-icon","icon icon--16"))):gg(cg(),d,_g("plus-icon","icon"),xg("create_album")):""),a)},"raf"),s=f(fg({isEnabled:!1,isLoading:!1,writeableAlbums:[]},function(e){e.isEnabled&&function(){l.isEnabled&&c&&m();r(l.isEnabled)}(),e.writeableAlbums&&function(){if(!t)return;var e=l.writeableAlbums.map(function(e){var t=e.album_id,n=e.title;return{name:n,value:t}});if(!e.length)return;t.setState({options:e}),t.selectedValue=e[0].value}(),o()}),2),l=s[0],u=s[1];BeFunky.LanguageManager.addLanguageUpdateListener(o);var c=!1;return m(),Object.assign(a,{getSelectedAlbum:function(){return l.isEnabled&&!l.isLoading&&t&&t.selectedValue?t.selectedValue:void 0}}),a;function h(e){u({isEnabled:e.target.checked})}function d(){var e=BeFunky.createFormModalContainer("album"),t=BeFunky.formModal(e,{title:"create_album",fields:[{name:"albumname",label:"album_name",maxLength:500,sanitize:function(e){return e.replace(/[^a-zA-Z0-9 !@#$%^&*(){}[\]:;,'"./?\-_+=™©®]/g,"")}}],button:"create",onSubmit:function(t){var n,r=t.albumname;r=r.trim(),(n=r,u({isLoading:!0}),i(n).then(function(e){u({isLoading:!1,writeableAlbums:[e].concat(v(l.writeableAlbums))})}).catch(function(e){"cancelled_by_user"!==e&&BeFunky.throwError("Unable to create Google Photos album",n,e),u({isLoading:!1,isEnabled:!1})})).then(function(){BeFunky.closeModal(e)})}}).teardown;BeFunky.openFormModal(e,t)}function m(){c=!1,u({isLoading:!0}),n().then(function(e){var t=e.filter(function(e){var t=e.title,n=e.isWritable;return t&&n});u({isLoading:!1,writeableAlbums:t})}).catch(function(e){"cancelled_by_user"!==e&&BeFunky.throwError("Unable to load Google Photos albums",e),u({isLoading:!1,isEnabled:!1}),c=!0})}}var Tg=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.handleWatermarkUpdatedBind=this.handleWatermarkUpdated.bind(this),this.handleUserDataChangedBind=this.handleUserDataChanged.bind(this),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChangedBind,!1,0,!0),this.saveShareMenu=document.getElementById("sas_menu"),BFN.UI.saveShareModal(this.saveShareMenu),this.saveTexture=null,this.flattenedImage=null,this.altSaveTexture=null,this.saveCanvas=null,this.saveCanvasMimeType=null,this.previewCanvas=null,this.previewCanvasMimeType=null,this.previewRAF=null,this.watermarkTimestamp=null,this.destroyAltSaveTextureOnDispose=!1,this.imageQualityKey="options__saveImageQuality",window.addEventListener("INIT_COMPLETE",function(){e.getImageQualityFromIndexedDB()}),setTimeout(function(){var e="true"===BeFunky.getLocal("disable_save_complete_modal");e&&UITools.setControlValue("sas_disable_save_complete_modal",e)},1e3),this.fileNames={editor:{image:"",project:"",layer:""},collage:{image:"",project:"",layer:""},designer:{image:"",project:"",layer:""}},this.fileNamesKey="options__saveFileNames",setTimeout(function(){return e.getFileNamesFromIndexedDB()},1e3),this.saveShareMenu.filenameInput.addEventListener("change",this.saveLastTypedFileName.bind(this)),this.lastImageBlob=null,this.isGeneratingImageBlob=!1,this.imageBlobDebug=0,this.imageSizeCache={},this.imageSizeText=document.getElementById("sas_image_size"),this.lastPDFBlob=null,this.lastFileName="",this.updateImageSize=BeFunky.debounce(this.updateImageSize.bind(this),0),this.updatePreviewImage=BeFunky.debounce(this.updatePreviewImage.bind(this),0),this.updateQualityGuide=BeFunky.debounce(this.updateQualityGuide.bind(this),"raf"),this.toggleImagePDFQuality=BeFunky.debounce(this.toggleImagePDFQuality.bind(this),"raf"),this.persistFileNames=BeFunky.debounce(this.persistFileNames.bind(this),200),this.persistImageQuality=BeFunky.debounce(this.persistImageQuality.bind(this),200),this.saveToComputerCount=0,this.pdfWorker=null,this.pdfCallback=function(){},this.googlePhotosAlbumsComponent=null}},{key:"handleUserDataChanged",value:function(){UITools.getToolValue("editor_save_image","befunky")&&BFN.BfnService.userLoggedIn&&(BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChangedBind),this.handleSave())}},{key:"handleUploadImage",value:function(){var e=UITools.getToolValue("editor_load_image","updating_id");if(["befunky","google_drive","google_photos","facebook","dropbox"].includes(e)&&BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();switch(e){case"computer":this.handleEditorLoadImageOrProject();break;case"befunky":BFN.ImageLibraryManager.openModal("befunky","UPLOAD_MENU");break;case"google_drive":BFN.BfnService.importGoogleDriveImage();break;case"google_photos":BFN.ImageLibraryManager.openModal("google","UPLOAD_MENU");break;case"stock_images":BFN.ImageLibraryManager.openModal("stock_images","UPLOAD_MENU");break;case"facebook":BFN.ImageLibraryManager.openModal("facebook","UPLOAD_MENU");break;case"dropbox":BFN.PhotoEditorModel.confirmEditorLoadImage(function(){return BFN.BfnService.importDropBoxImage()});break;case"webcam":BFN.PhotoEditorModel.openWebcamModal()}}},{key:"handleOpenProject",value:function(){if("computer"===UITools.getToolValue("open_project","updating_id")){if(BFN.AppModel.viewingEditor)return BFN.UploadSaveShareManager.handleEditorLoadImageOrProject();return BFN.MultipleFileUploader.upload(function(e){var t=e.file;if(t){var n=BFN.getExtension(t.name);console.log("User opened file:",{name:t.name,size:BeFunky.formatBytes(t.size),section:BFN.AppModel.sectionID}),BFN.MultipleFileUploader.supportedImages.includes(n)?setTimeout(function(){BFN.ImageLibraryManager.uploadImages(null,{files:[t]})},0):BFN.ProjectManager.loadFile(t)}},{fileType:"bfd",allowMultiple:!1,createMenuImageVO:!1})}BeFunky.SavedProjectManager.openProjectModal()}},{key:"handleEditorLoadImageOrProject",value:function(){var e={fileType:BeFunky.isIPadOS?"all":"imagesAndBFD",allowMultiple:!1,createMenuImageVO:!1};BFN.MultipleFileUploader.upload(function(e){var t=e.file;if(t){var n=BFN.getExtension(t.name);console.log("User opened file:",{name:t.name,size:BeFunky.formatBytes(t.size),section:BFN.AppModel.sectionID}),"bfd"===n?BFN.ProjectManager.loadFile(t):BFN.MultipleFileUploader.supportedImages.includes(n)?BFN.PhotoEditorModel.confirmEditorLoadImage(function(){return BFN.PhotoEditorModel.onEditorImageUpload({file:t})}):BeFunky.logError("User uploaded unsupported file type")}},e)}},{key:"handleSave",value:function(){if(!BeFunky.isPaywallEnabled()||BeFunky.isPlus()){var e=UITools.getToolValue("editor_save_image","updating_id");switch(e){case"befunky":if(BFN.BfnService.userLoggedIn)BFN.UploadSaveShareManager.handleSaveOrShareImage("save","befunky");else{var t=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");BFN.BfnService.track("CREATE",t,"SavePanelEmailRegister"),BFN.BfnService.login(BFN.UploadSaveShareManager.handleSave)}break;case"computer":case"google_drive":case"dropbox":case"project":BFN.UploadSaveShareManager.handleSaveOrShareImage("save",e);break;case"google_photos":if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();BeFunky.GooglePhotosManager.mightBeAuthorized?(BFN.UploadSaveShareManager.setupGooglePhotosAlbums(),BFN.UploadSaveShareManager.handleSaveOrShareImage("save",e)):BeFunky.GooglePhotosManager.login(!1).then(function(){BFN.UploadSaveShareManager.setupGooglePhotosAlbums(),BFN.UploadSaveShareManager.handleSaveOrShareImage("save",e)},function(e){"cancelled_by_user"!==e&&BeFunky.throwError("Unable to open Save to Google Photos",e)});break;case"facebook":case"pinterest":case"twitter":if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();if(!BFN.BfnService.userLoggedIn)return void BeFunky.confirm("confirm_sharing_login",{onConfirm:function(){return BFN.BfnService.login(BFN.UploadSaveShareManager.handleShare)}});BFN.UploadSaveShareManager.handleSaveOrShareImage("share",e)}}else BeFunky.openTeaserModal("paywall")}},{key:"handleSaveOrShareImage",value:function(e,t,n){if(!BeFunky.isPaywallEnabled()||BeFunky.isPlus()){var i="save"===e&&"complete"===t;if(!(this.altSaveTexture&&this.altSaveTexture.valid||i)){try{this.flattenedImage.destroyGC(!0)}catch(e){}if(this.flattenedImage=null,BFN.AppModel.viewingEditor){if(!BFN.PhotoEditorModel.currentTexture)return;if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.PhotoEditorCanvasTools.currentTool){if(BFN.PhotoEditorCanvasTools.premiumWatermark.showing)return void BFN.PhotoEditorCanvasTools.applyCurrentTool("EDITOR_SAVE");BFN.PhotoEditorCanvasTools.applyCurrentTool(),BFN.PhotoEditorCanvasModel.exitCurrentEditorTool()}}var r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);if(this.flattenedImage=r.getFlattenedImage(),!this.flattenedImage)return void BeFunky.logError("Unable to create flattened image")}if(i||this.saveShareMenu.hidePreviewImage(),this.panelName=t,this.saveShareMenu.mode=[e,t],!i){this.onSaveCallback=n;var a=BFN.AppModel.sectionID,o=this.saveShareMenu.filenameInput;if("project"===t?o.value=this.fileNames[a].project||"BeFunky-project":this.altSaveTexture?o.value=this.fileNames[a].layer||"BeFunky-layer":o.value=this.fileNames[a].image||"BeFunky-".concat(BFN.AppModel.sectionValue("photo","collage","design")),"computer"===t&&this.preloadPDFWorker(),this.updateSaveTexture(!0),this.saveTexture)this.saveShareMenu.dimensions.textContent="".concat(this.saveTexture.width," × ").concat(this.saveTexture.height);else if(BFN.AppModel.viewingEditor){var s=BFN.PhotoEditorModel.currentTextureDimensions,l=s.width,u=s.height;this.saveShareMenu.dimensions.textContent="".concat(l," × ").concat(u)}else{var c=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).projectVO;this.saveShareMenu.dimensions.textContent="".concat(c.projectWidth," × ").concat(c.projectHeight)}BFN.WatermarkManager.removeEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind),BFN.WatermarkManager.addEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind),this.saveShareMenu.watermarkControl.sourceTexture=this.altSaveTexture||this.flattenedImage,BFN.WatermarkManager.activate()}}else BeFunky.openTeaserModal("paywall")}},{key:"handleSaveAndShareModal",value:function(){var e=this,t=UITools.getToolValue("sas","updating_id"),n=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&BFN.AppModel.viewingEditor&&(BFN.PhotoEditorModel.hasUnsavedChanges=!1),e.saveShareMenu.close()},i=function(i){if(BeFunky.hideLoadScreen(),i){if("cancel"===i)return;"string"==typeof i?BeFunky.logError("Save/share error:",i):(BeFunky.logError("Save/share failed:"),BeFunky.throwError(i)),"not_login"===i&&(i="not_logged_in"),"not_logged_in"===i&&e.saveShareMenu.close();var r="error_invalid_response";BeFunky.LanguageManager.isTranslated("error_".concat(i))?r="error_".concat(i):BeFunky.LanguageManager.isTranslated(i)&&(r=i),UIMessages.display(r,1e3)}else"save"===t?(n(!0),"computer"===e.panelName?UITools.getControlValue("sas_disable_save_complete_modal")?e.showUpgradePromptAfterSaving():e.handleSaveOrShareImage("save","complete"):UIMessages.display("project"===e.panelName?"project_saved":"image_saved")):("twitter"!==e.panelName&&"tumblr"!==e.panelName||UIMessages.display("image_shared"),n());!i&&e.onSaveCallback&&e.onSaveCallback()};if("save"===t||"share"===t){var r={computer:"Computer",befunky:"BeFunky",facebook:"Facebook",pinterest:"Pinterest",google_drive:"Google Drive",google_photos:"Google Photos",dropbox:"Drop Box",twitter:"Twitter",tumblr:"Tumblr"},a=null,o=null,s=!1;if("project"===this.panelName?(a="Project",o=r[UITools.getToolValue("sas","project_location")]):(["computer","befunky","google_photos"].includes(this.panelName)?(a=this.getImageType().toUpperCase(),s=BFN.WatermarkManager.watermarkActive):a="JPG",o=r[this.panelName]),a&&o){var l=BFN.UserActionManager.getSaveData(),u=new BFN.UserActionVO;u.eventID="media_saved",u.eventObject={mediaSaveType:a,mediaSaveLocation:o,mediaSaveWatermark:s,mediaSaveMainFunnel:l.actions,mediaSaveFontsUsed:l.fonts,mediaSaveLayerSourcesUsed:l.assets,mediaSaveGraphicsUsed:l.graphicFileNames,mediaSaveGraphicsStyleUsed:l.graphicStyles},BFN.AppModel.viewingDesigner&&BFN.DesignerModel.projectVO.sourceTemplateID&&(u.eventObject.templateID=BFN.DesignerModel.projectVO.sourceTemplateID),u.peopleObject={lastMediaSaveDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaSaveCount:1,lifetimeImagesSaveCount:1},u.track()}else BeFunky.throwError("Save/share not tracked",{mediaSaveType:a,mediaSaveLocation:o,panelName:this.panelName})}switch(t){case"image_type":return UITools.disableControlItem("sas_image_quality","jpg"!==this.getImageType()),this.updateImageSize(),this.updatePreviewImage(),this.updateQualityGuide(),void this.toggleImagePDFQuality();case"image_quality":case"pdf_quality":return void(UITools.getToolVO("sas").updating?this.isGeneratingImageBlob||this.imageSizeText.addClass("save-image__size-text--updating"):(this.updateImageSize(),this.updatePreviewImage(),this.updateQualityGuide()));case"cancel":return void this.saveShareMenu.close();case"save":if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();var c=!1;BeFunky.showLoadScreen({onCancel:function(){c=!0}});var h={text:this.saveShareMenu.getText(),texture:this.saveTexture};return h.text?(["computer","befunky","google_photos"].includes(this.panelName)&&"jpg"===this.getImageType()&&this.persistImageQuality(),void{computer:function(){var t=h.text||(e.altSaveTexture?"Befunky-layer":"Befunky-photo");BFN.BfnService.track("CREATE",BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER"),"SAVE_DESKTOP"),e.getImageBlobForSaving(function(){return c}).then(function(n){e.saveToComputer(t,n,i)}).catch(function(){c||i("error_invalid_response")})},befunky:function(){e.getImageBlobForSaving(function(){return c}).then(function(e){delete h.texture,h.blob=e,h.isPublic=!1,h.mimeType=e.type,BFN.BfnService.saveToBeFunky(h,function(e){i(e),e||BeFunky.ImagesService.resetImageData()})},function(){c||i("error_invalid_response")})},google_drive:function(){return BFN.BfnService.saveToGoogleDrive(h,i)},google_photos:function(){e.getImageBlobForSaving(function(){return c}).then(function(t){var n=e.googlePhotosAlbumsComponent.getSelectedAlbum();BeFunky.GooglePhotosManager.uploadMedia(t,h.text,n).then(function(){return i()},function(e){return i(e)})},function(){c||i("error_invalid_response")})},dropbox:function(){return BFN.BfnService.saveToDropBox(h,i)},project:function(){var t=UITools.getToolValue("sas","project_location");if("befunky"===t&&!BFN.BfnService.userLoggedIn)return BeFunky.hideLoadScreen(),BFN.BfnService.login();var n=h.text.replace(/\.bfd$/i,"")||"Befunky-project";BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).projectVO.filename=n;var r=BFN.AppModel.sectionID;(BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage?BFN.ProjectManager.getOpenImageInEditorProject():BFN.ProjectManager.requestLocalSave({isLazy:!1,createThumbnail:!0}).then(function(){return BFN.ProjectService.getLocalProject(r,{logLevel:"throw"})})).then(function(n){if("befunky"===t)return BFN.ProjectManager.createThumbnail(r,"blob",!0).then(function(t){e.saveProjectToBeFunky(n,t,i),BFN.BfnService.track("CREATE",BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER"),"SAVE_PROJECT_BEFUNKY")});e.saveProjectToComputer(n,i),BFN.BfnService.track("CREATE",BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER"),"SAVE_PROJECT_COMPUTER")}).catch(function(e){var t=e&&e.name?e.name:e;BeFunky.throwError("Failed to save project: ".concat(t),e),"invalid_editor_image_blob"!==e&&"missing_editor_image_blob"!==e||BFN.PhotoEditorModel.saveCurrentTextureBlob(0),i(e)})}}[this.panelName]()):void i("please_enter_text");case"share":BeFunky.showLoadScreen();var d={text:this.saveShareMenu.getText(),texture:this.saveTexture,apptype:this.panelName.toUpperCase()};return d.text?void{twitter:function(){return BFN.BfnService.shareToFacebookOrPinterest(d,i)},facebook:function(){return BFN.BfnService.shareToFacebookOrPinterest(d,i)},pinterest:function(){return BFN.BfnService.shareToFacebookOrPinterest(d,i)}}[this.panelName]():void i("please_enter_text");case"download_again":BeFunky.showLoadScreen(),this.saveToComputer(this.lastFileName,this.lastPDFBlob||this.lastImageBlob,function(){BeFunky.hideLoadScreen(),e.handleSaveOrShareImage("save","complete")});var m=BFN.AppModel.sectionValue("SAVE","SAVE_COLLAGE","SAVE_DESIGNER");return void BFN.BfnService.track("CREATE",m,"SAVE_DESKTOP_AGAIN");case"disable_save_complete_modal":var p=UITools.getToolValue("sas","disable_save_complete_modal");BeFunky.setLocal("disable_save_complete_modal",p)}}},{key:"getImageBlobForSaving",value:function(e){var t=this;return new Promise(function(n,i){var r=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).projectVO.printDPI;function a(){BeFunky.logError("webglTextureSize:",window.webglTextureSize),BeFunky.logError("Texture Memory: ".concat(BFN.Util.getTotalTextureMemory()," MB")),navigator.deviceMemory&&BeFunky.logError("Device Memory: ".concat(navigator.deviceMemory," GB")),BeFunky.logError("appRect:","".concat(BFN.appRect.width," x ").concat(BFN.appRect.height))}BeFunky.waitUntil({condition:function(){return!t.isGeneratingImageBlob&&!e()},onSuccess:function(){var i,o=t.getImageType();if(BFN.AppModel.viewingEditor&&!t.altSaveTexture&&BFN.PhotoEditorModel.currentEXIF&&(i=BFN.PhotoEditorModel.currentEXIF),"png"!==o)if("pdf"!==o)BFN.ExifTool.insert(t.lastImageBlob,i,r,function(e){var i=e.error,r=e.blob;if(i)return BeFunky.logError("Unable to add EXIF data to image blob. Falling back to original blob.",i),n(t.lastImageBlob),void a();n(r)});else{var s=t.saveTexture,l=s.width,u=s.height,c="print"===UITools.getControlValue("sas_pdf_quality")?r||300:72,h=Math.round(72*l/c),d=Math.round(72*u/c);t.createPDF(t.lastImageBlob,h,d,function(i){var r=i.pdfBlob,a=i.error;if(!e())return r?(t.lastPDFBlob=r,n(r)):void BeFunky.throwError("Unable to create PDF",a);BeFunky.logError("Save cancelled while converting image blob to PDF")})}else BFN.ExifTool.changeDPIForPNG(t.lastImageBlob,r,i).then(n)},onTimeout:function(){e()||(a(),BeFunky.throwError("Unable to generate blob for saving image in ".concat(20," seconds. Stalled at ").concat(t.imageBlobDebug))),i()},interval:200,maxAttempts:100})})}},{key:"updateSaveTexture",value:function(e){if(this.altSaveTexture||this.flattenedImage){try{this.saveTexture&&this.saveTexture.destroyGC(!0),this.saveTexture=(this.altSaveTexture||this.flattenedImage).renderClone()}catch(e){return void(this.saveTexture=null)}["computer","befunky","google_photos"].includes(this.panelName)&&BFN.WatermarkManager.drawWatermark(this.saveTexture);var t,n=this.saveTexture;if(["computer","befunky","google_photos"].includes(this.panelName)){(t=n.determineTransparency())&&e&&this.setImageType("png");var i=document.getElementById("sas_image_type");i||console.log("Missing toggle group?",document.querySelector(".save-image__image-type")&&document.querySelector(".save-image__image-type").innerHTML),i.buttons="computer"===this.panelName?[{value:"jpg",langID:"JPG"},{value:"png",langID:"PNG"},{value:"pdf",langID:"PDF"}]:[{value:"jpg",langID:"JPG"},{value:"png",langID:"PNG"}],"computer"!==this.panelName&&"pdf"===this.getImageType()&&this.setImageType(t?"png":"jpg"),this.imageSizeCache={},this.lastImageBlob=null,this.lastPDFBlob=null,this.updateImageSize(!0)}this.updatePreviewImage(n,t),"dropbox"===this.panelName&&(BeFunky.showLoadScreen(),BFN.BfnService.prepareDropboxSave(n,function(){BeFunky.hideLoadScreen()}))}}},{key:"updatePreviewImage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.saveTexture,n=arguments.length>1?arguments[1]:void 0;if(t&&t.valid){cancelAnimationFrame(this.previewRAF);var i=.92,r=!1;["computer","befunky","google_photos"].includes(this.panelName)&&(r="png"===this.getImageType(),i=this.getImageQuality()),"project"===this.panelName&&("boolean"!=typeof n&&(n=t.determineTransparency()),r=n);var a=r?"image/png":"image/jpeg";if(!this.previewCanvas||this.previewCanvasMimeType!==a){var o=this.saveShareMenu.maxPreviewImageWidth,s=this.saveShareMenu.maxPreviewImageHeight,l=window.previewRatio||2,u=o*l,c=s*l,h=Math.min(1,u/t.width,c/t.height),d=Math.round(t.width*h),m=Math.round(t.height*h),p=BFN.Util.resizeTexture(t,4*d,4*m);if(!p)return void BeFunky.throwError("Unable to create preview",{previewW:d,previewH:m,scale:h,maxRenderedWidth:o,maxRenderedHeight:s});var g=BFN.Util.getThumbTexture(p,Math.max(d,m));p.destroyGC(!0),this.previewCanvas=BFN.TextureUtils.textureToCanvas(g,{isTransparent:r}),g.destroyGC(!0)}var f=this.previewCanvas.toDataURL(a,i);this.previewCanvasMimeType=a,this.previewRAF=requestAnimationFrame(function(){e.previewCanvas&&e.saveShareMenu.setPreviewImageSrc(f,e.previewCanvas.width,e.previewCanvas.height,r)})}}},{key:"updateQualityGuide",value:function(){var e=this.saveShareMenu.qualityGuide,t=this.getImageType();if("png"===t)return e.setLang("image_quality_best"),void e.setStyles({color:"var(--success-500)"});if("pdf"===t){var n="print"===UITools.getControlValue("sas_pdf_quality");return e.setLang(n?"pdf_print_quality":"pdf_web_quality"),void e.setStyles({color:"var(--success-500)"})}var i=this.getImageQuality();i>=.8?(e.setStyles({color:"var(--success-500)"}),BeFunky.isFirefox?e.setLang(i>=.95?"image_quality_high":"image_quality_good"):BeFunky.isEdgeHTML?e.setLang("image_quality_suggest_png"):e.setLang(1===i?"image_quality_high":"image_quality_good")):i>=.5?(e.setLang("image_quality_low"),e.setStyles({color:"var(--warning-500)"})):(e.setLang("image_quality_worst"),e.setStyles({color:"var(--error-500)"}))}},{key:"toggleImagePDFQuality",value:function(){this.imageQualitySlider=this.imageQualitySlider||document.querySelector(".save-image__image-quality"),this.pdfQualityButtons=this.pdfQualityButtons||document.querySelector(".save-image__pdf-quality");var e="pdf"===this.getImageType();this.imageQualitySlider.setStyles({display:e?"none":""}),this.pdfQualityButtons.setStyles({display:e?"":"none"})}},{key:"saveAndShareModalDispose",value:function(){if(console.log("disposing Save/Share textures after modal close..."),BFN.WatermarkManager.removeEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,this.handleWatermarkUpdatedBind),this.saveShareMenu.watermarkControl.sourceTexture=null,this.destroyAltSaveTextureOnDispose){this.destroyAltSaveTextureOnDispose=!1;try{this.altSaveTexture.destroyGC(!0)}catch(e){}}this.altSaveTexture=null,this.flattenedImage&&(this.flattenedImage.destroyGC(!0),this.flattenedImage=null),this.saveTexture&&(this.saveTexture.destroyGC(!0),this.saveTexture=null),this.saveCanvas=null,this.saveCanvasMimeType=null,this.previewCanvas=null,this.previewCanvasMimeType=null}},{key:"showUpgradePromptAfterSaving",value:function(){if(!BFN.BfnService.userIsPlus&&(this.saveToComputerCount++,this.saveToComputerCount%3==0)){var e=BFN.AppModel.sectionID;BeFunky.openTeaserModal("save_".concat(e))}}},{key:"getBlob",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.quality,i=t.mimeType,r=arguments.length>1?arguments[1]:void 0,a="image/png"===i;this.imageBlobDebug=2,this.saveCanvas&&this.saveCanvasMimeType===i||(this.saveCanvas=BFN.TextureUtils.textureToCanvas(this.saveTexture,{isTransparent:a}),this.saveCanvasMimeType=i),this.imageBlobDebug=3,this.saveCanvas.toBlob(function(t){e.imageBlobDebug=4,r({blob:t})},i,n)}},{key:"updateImageSize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=function(){if(!e.saveTexture)return!1;var t=e.getImageQuality(),n=e.getMimeType();return!e.lastImageBlob||t!==e.lastImageBlob.quality||n!==e.lastImageBlob.mimeType||e.watermarkTimestamp!==e.lastImageBlob.watermarkTimestamp};t&&this.saveTexture||n()?function t(){e.imageSizeText.addClass("save-image__size-text--updating");var i=e.getImageQuality(),r=e.getMimeType(),a="image/png"===r?"image/png":r+i,o=e.watermarkTimestamp;e.imageSizeCache[a]&&(e.imageSizeText.textContent=e.imageSizeCache[a]),e.isGeneratingImageBlob||(e.isGeneratingImageBlob=!0,e.imageBlobDebug=1,setTimeout(function(){e.saveTexture?e.getBlob({quality:i,mimeType:r},function(s){var l=s.blob;if(null===l)return BeFunky.logError("Unable to extract Blob from canvas. Trying again..."),e.isGeneratingImageBlob=!1,t();e.imageBlobDebug=5,l.quality=i,l.mimeType=r,l.watermarkTimestamp=o,e.lastImageBlob=l,e.isGeneratingImageBlob=!1;var u,c,h=(u=l.size,c=u<Math.pow(1024,2)?0:1,BeFunky.formatBytes(u,c));e.imageSizeCache[a]=h,n()?t():(e.imageSizeText.textContent=h,e.imageSizeText.removeClass("save-image__size-text--updating"))}):e.isGeneratingImageBlob=!1},0))}():this.imageSizeText.toggleClass("save-image__size-text--updating",this.isGeneratingImageBlob)}},{key:"saveToComputer",value:function(e,t,n){"string"==typeof e&&e||(e="BeFunky-artwork"),e=e.trim().replace(/(\.(jpe?g|png|pdf))+$/,"");var i="";"image/jpeg"===t.type&&(i=".jpg"),"image/png"===t.type&&(i=".png"),"application/pdf"===t.type&&(i=".pdf"),e+=i,this.lastFileName=e,this.flattenedImage&&(this.flattenedImage.destroyGC(!0),this.flattenedImage=null),this.saveTexture&&(this.saveTexture.destroyGC(!0),this.saveTexture=null);var r=!0;function a(){window.removeEventListener("blur",a),r=!1}function o(){window.removeEventListener("focus",o),r||n()}window.addEventListener("blur",a),window.addEventListener("focus",o),saveAs(t,e),setTimeout(function(){r&&(window.removeEventListener("blur",a),window.removeEventListener("focus",o),n())},888)}},{key:"saveProjectToComputer",value:function(e,t){BFN.ProjectManager.getCompressedBlob(e).then(function(n){saveAs(n,"".concat(e.filename,".bfd")),t()}).catch(t)}},{key:"saveProjectToBeFunky",value:function(e,t,n){BFN.SavedProjectService.getAllProjects().catch(function(e){if("no_results"===e)return[];throw e}).then(function(i){var r=function(i,r){BeFunky.showLoadScreen({message:"uploading"});var a={bfdBlob:i,thumbnailBlob:t,uploadProgressHandler:function(e,t){BeFunky.updateLoadScreenProgress("uploading",100*e/t)},projectObject:e,date:r};BFN.SavedProjectService.saveBfdFileToBeFunky(a,function(e){var t=e.error;e.data;if(t)return n(t);BFN.SavedProjectService.resetProjectData(),BFN.DesignerTemplateManager.recentProjectsComponent&&BFN.DesignerTemplateManager.recentProjectsComponent.fetchProjects();var i=document.querySelector("dashboard-projects");i&&i.fetchProjects(),n()})},a=i.find(function(t){return t.filename===e.filename});a?BeFunky.confirm("confirm_project_overwrite",{onConfirm:function(){BFN.ProjectManager.getCompressedBlob(e).then(function(e){BFN.SavedProjectService.deleteBfdFile(a.templateid,function(t){var i=t.error;t.data;if(i)return BeFunky.logError(i),n("Unable to delete existing project with the same name");r(e,a.date)})}).catch(n)},onCancel:function(){return n("cancel")},confirmText:"yes",cancelText:"no",focusConfirmButton:!1}):BFN.ProjectManager.getCompressedBlob(e).then(r).catch(n)}).catch(function(e){return"string"!=typeof e&&BeFunky.throwError(e),n(e)})}},{key:"getFileNamesFromIndexedDB",value:function(){var t=this;BFN.IndexedDB.get(this.fileNamesKey).then(function(n){"object"===e(n)&&Object.entries(t.fileNames).forEach(function(e){var t=f(e,2),i=t[0],r=t[1];n[i]&&Object.entries(r).forEach(function(e){var t=f(e,2),a=t[0];if(!t[1]){var o=n[i][a];r[a]="string"==typeof o?o:""}})})}).catch(function(e){return BeFunky.logError("Unable to get file names config from IndexedDB",e)})}},{key:"setFileName",value:function(e,t,n){return e=e||BFN.AppModel.sectionID,["editor","collage","designer"].includes(e)?["image","project","layer"].includes(t)?"string"!=typeof n?BeFunky.logError("Invalid file name",n):(this.fileNames[e][t]=n,void this.persistFileNames()):BeFunky.logError("Invalid file type",t):BeFunky.logError("Invalid sectionID",e)}},{key:"persistFileNames",value:function(){BFN.IndexedDB.set(this.fileNamesKey,this.fileNames).catch(function(e){return BeFunky.logError("Unable to save file names config to IndexedDB",e)})}},{key:"getImageQualityFromIndexedDB",value:function(){var e=this;BFN.IndexedDB.get(this.imageQualityKey).then(function(t){t=parseInt(t),Number.isNaN(t)||t<0||t>100?e.updateQualityGuide():(document.getElementById("sas_image_quality").noUiSlider.set(t),UITools.setControlValue("sas_image_quality",t,!1),UITools.applyToolControl("sas_image_quality"))}).catch(BeFunky.logError)}},{key:"persistImageQuality",value:function(){BFN.IndexedDB.set(this.imageQualityKey,100*this.getImageQuality()).catch(function(e){return BeFunky.logError("Unable to image quality to IndexedDB",e)})}},{key:"setupGooglePhotosAlbums",value:function(){this.googlePhotosAlbumsComponent||(this.googlePhotosAlbumsComponent=Ig({fetchAlbums:function(){return BeFunky.GooglePhotosManager.getAlbums()},createAlbum:function(e){return BeFunky.GooglePhotosManager.createAlbum(e)},onToggle:function(e){BFN.IndexedDB.set("options__saveToGooglePhotosAlbum",e)}}),document.getElementById("sas_google_photos_albums").appendChild(this.googlePhotosAlbumsComponent))}},{key:"getImageType",value:function(){return UITools.getToolValue("sas","image_type")}},{key:"setImageType",value:function(e){if(!["jpg","png","pdf"].includes(e))throw new Error('Invalid image type "'.concat(e,'"'));UITools.setControlValue("sas_image_type",e),UITools.updateToolControl("sas_image_type"),UITools.applyToolControl("sas_image_type")}},{key:"getImageQuality",value:function(){var e;return e="pdf"===this.getImageType()?"print"===UITools.getToolValue("sas","pdf_quality")?100:98:parseInt(UITools.getToolValue("sas","image_quality")),Number.isNaN(e)&&(e=100),Math.max(1,Math.min(100,e))/100}},{key:"getMimeType",value:function(){return["jpg","pdf"].includes(this.getImageType())?"image/jpeg":"image/png"}},{key:"saveLastTypedFileName",value:function(e){var t=e.target.value;if(t){var n="project"===BFN.UploadSaveShareManager.panelName?"project":this.altSaveTexture?"layer":"image";this.setFileName(void 0,n,t)}}},{key:"handleWatermarkUpdated",value:function(){this.previewCanvas=null,this.saveCanvas=null,this.watermarkTimestamp=BFN.WatermarkManager.useWatermark?Date.now():null,this.updateSaveTexture(!1)}},{key:"preloadPDFWorker",value:function(){var e=this;this.pdfWorker||(this.pdfWorker=new Worker("".concat(BFN.jsURL,"pdf-worker-v3.min.js")),this.pdfWorker.addEventListener("message",function(t){var n=t.data;return"success"===n.type&&n.content instanceof Blob?e.pdfCallback({pdfBlob:n.content}):e.pdfCallback({error:n})}),this.pdfWorker.addEventListener("error",function(e){BeFunky.throwError("PDF Worker error",e)}))}},{key:"createPDF",value:function(e,t,n,i){var r=this;this.pdfCallback=function(e){r.pdfCallback=function(){},i(e)},this.pdfWorker.postMessage({image:e,width:t,height:n})}}]),t}();BFN.SingletonQueue.add(function(){BFN.UploadSaveShareManager=new Tg});var bg=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("AppManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){UITools.addEventListener(UIToolsEvents.UPDATE_TOOL.type,this.handleUpdateTool.bind(this))}},{key:"handleUpdateTool",value:function(e){var t=e.data,n=UITools.getToolVO(t);if((BFN.PhotoEditorCanvasTools.currentTool||UITools.toolPlusHash[t])&&BFN.toolViewstates.hasOwnProperty(t)&&(BFN.PremiumWatermark.currentToolID=t,BFN.PremiumWatermark.updateDisplay()),n.updating&&!BFN.smoothPictureDisabled?BFN.smoothPictureDisabled=!0:!n.updating&&BFN.smoothPictureDisabled&&(BFN.smoothPictureDisabled=!1),n)switch(t){case"app_goto":BFN.AppModel.handleAppGoto();break;case"user_account":BFN.AccountManager.handleAccountAction();break;case"user_settings":BFN.SettingsManager.handleSettingUpdate();break;case"language":var i=UITools.getToolValue("language","select");BeFunky.LanguageManager.handleUserUpdateLanguage(i);break;case"editor_history_action":BFN.UndoManager.handleEditorHistoryAction();break;case"editor_apply_cancel":BFN.PhotoEditorCanvasTools.handleEditorApplyCancel();break;case"editor_load_image":BFN.UploadSaveShareManager.handleUploadImage();break;case"designer_open":BFN.DesignerTemplateManager.handleOpen();break;case"editor_save_image":BFN.UploadSaveShareManager.handleSave();break;case"open_project":BFN.UploadSaveShareManager.handleOpenProject();break;case"sas":BFN.UploadSaveShareManager.handleSaveAndShareModal();break;case"upload_to_web_cam":BFN.PhotoEditorModel.handleWebCamAction();break;case"editor_flatten":BFN.PhotoEditorCanvasModel.handleEditorFlatten();break;case"editor_effect":BFN.FeaturedManager.handleEffectCategory(),BFN.FavoritesManager.handleEffectCategory();break;case"editor_artsy":BFN.FeaturedManager.handleArtsyCategory(),BFN.FavoritesManager.handleArtsyCategory();break;case"editor_frame":BFN.FeaturedManager.handleFrameCategory(),BFN.PhotoEditorCanvasModel.handleUpdateTool("editor_frame");break;case"editor_overlay":BFN.PhotoEditorCanvasModel.handleEditorOverlay();break;case"editor_texture":BFN.FeaturedManager.handleTextureCategory();break;case"text_edit":BFN.FabricManager.handleTextEdit();break;case"editor_graphic":BFN.GraphicLibraryManager.handleGraphicCategory();break;case"zoom":BFN.ZoomManager.handleZoom();break;case"transform":BFN.TransformModel.handleTransform();break;case"layer":BFN.TransformModel.handleLayer();break;case"layers":UILayers.handleLayers();break;case"alignment":BFN.AlignmentOptionsManager.handleAlignmentUpdate();break;case"history":UIHistory.handleHistory();break;case"paint_brush":BFN.ImagePaintBrush.handlePaintBrush();break;case"clone":BFN.ImageClone.handleClone();break;case"blemish_fix":BFN.ImageBlemish.handleBlemish();break;case"background":BFN.ImageBackground.handleBackground();break;case"background_brush":BFN.ImageBackground.handleBackgroundBrush();break;case"matting":BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING&&BFN.ImageMatting.handleMatting();break;case"cutout":BFN.ImageCutout.handleCutout();break;case"touch_up_brush":BFN.ImageTouchUp.handleTouchUpBrush();break;case"effect_generic":BFN.ImageEffect.handleEffectGeneric();break;case"effect_brush":BFN.ImageEffect.handleEffectBrush();break;case"artsy_generic":BFN.ImageArtsy.handleArtsyGeneric();break;case"artsy_brush":BFN.ImageArtsy.handleArtsyBrush();break;case"frame_border":BFN.ImageBorder.handleBorder();break;case"frame_drop_shadow":BFN.ImageDropShadow.handleDropShadow();break;case"frame_crop_rotate_generic":BFN.ImageFrame.handleFrameCropRotateGeneric();break;case"frame_crop_generic":BFN.ImageFrame.handleFrameCropGeneric();break;case"frame_full_generic":BFN.ImageFrame.handleFrameFullGeneric();break;case"texture_generic":BFN.ImageTexture.handleTextureGeneric();break;case"texture_brush":BFN.ImageTexture.handleTextureBrush();break;case"overlay_generic":BFN.ImageOverlay.handleOverlayGeneric();break;case"lens_flare_generic":BFN.ImageLensFlare.handleLensFlareGeneric();break;case"crop":BFN.ImageCrop.handleCrop();break;case"rotate":BFN.ImageRotator.handleRotate();break;case"resize":BFN.ImageResize.handleResize();break;case"slimming":BFN.ImageSlimming.handleSlimming();break;case"reshape":BFN.ImageReshape.handleReshape();break;case"tilt":BFN.ImageTilter.handleTilt();break;case"funky_focus":BFN.ImageFocus.handleFocus();break;case"funky_vignette":BFN.ImageVignette.handleVignette();break;case"color_picker_panel":BFN.ColorPickerPanel.handleIntensitySliderUpdate();break;case"watermark":BFN.WatermarkManager.handleWatermark();break;case"batch_processing":BFN.BatchProcessingManager.handleBatchProcessing();break;case"batch_resize":BFN.BatchProcessingManager.handleBatchResize();break;case"batch_crop":BFN.BatchProcessingManager.handleBatchCrop();break;case"batch_effect":BFN.BatchProcessingManager.handleBatchEffect();break;case"collage_customize":BFN.CustomizeManager.handleCustomize();break;case"collage_layouts_custom":BFN.CollageMakerCanvasModel.handleCollageLayoutsCustom();break;case"collage_layouts":BFN.CollageMakerTemplateManager.handleTemplateCategory();break;case"collage_patterns":BFN.CollageMakerPatternManager.handlePatternCategory();break;case"collage_image":BFN.CollageMakerCanvas.handleCollageImage();break;default:BFN.PhotoEditorCanvasModel.handleUpdateTool(t),BFN.ImageTouchUp.handleUpdateTool(t),BFN.ImageEffect.handleUpdateTool(t),BFN.ImageArtsy.handleUpdateTool(t),BFN.ImageFrame.handleUpdateTool(t),BFN.ImageTexture.handleUpdateTool(t),BFN.ImageOverlay.handleUpdateTool(t),BFN.ImageLensFlare.handleUpdateTool(t)}}}]),n}();BFN.SingletonQueue.add(function(){BFN.AppManager=new bg}),BFN.ImagePainterUndoManagerEvents={IMAGE_PAINTER_UPDATED:new Event("IMAGE_PAINTER_UPDATED"),PAINT_UPDATED:new Event("PAINT_UPDATED"),ALT_TEXTURE_UPDATED:new Event("ALT_TEXTURE_UPDATED")};var Sg=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("ImagePainterUndoManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.originPoint=new PIXI.Point,this.maxStoredPixels=5*Math.pow(BFN.maxImageSize,2),this.imagePainter=null,this.regionVOs=[],this.regionIndex=-1,this.direction="redo",this.memoryFreed=!1,this.regionSprite=new PIXI.Sprite,this.handlePaintUpdatedBind=this.handlePaintUpdated.bind(this)}},{key:"setImagePainter",value:function(e){this.reset(!1),this.imagePainter=e,this.imagePainter&&(this.imagePainter.addEventListener(BFN.ImagePainterEvents.PAINT_UPDATED.type,this.handlePaintUpdatedBind),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.IMAGE_PAINTER_UPDATED)),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}},{key:"reset",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.imagePainter&&(this.imagePainter.removeEventListener(BFN.ImagePainterEvents.PAINT_UPDATED.type,this.handlePaintUpdatedBind),this.imagePainter=null,this.clearRegionVOs(),this.direction="redo",e&&this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.IMAGE_PAINTER_UPDATED)),this.memoryFreed=!1,BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}},{key:"addRegionVO",value:function(){var e=null;if(this.imagePainter&&this.imagePainter.texture&&this.imagePainter.paintBounds.width&&this.imagePainter.paintBounds.height){if(this.redoExists)switch(this.direction){case"undo":this.clearRegionVOs(this.regionIndex);break;case"redo":this.clearRegionVOs(this.regionIndex+1)}var t=this.regionVOs.length?this.regionVOs[this.regionVOs.length-1]:null;(e=new BFN.ImagePainterRegionVO).originPoint.x=this.imagePainter.paintBounds.left,e.originPoint.y=this.imagePainter.paintBounds.top,e.undoRegionTexture=PIXI.RenderTexture.create(this.imagePainter.paintBounds.width,this.imagePainter.paintBounds.height),e.undoRegionTexture.copyPixels(this.imagePainter.prevTexture,{x:-e.originPoint.x,y:-e.originPoint.y}),e.undoRegionTexture.subjectIsolated=!!t&&!!t.redoRegionTexture.subjectIsolated,e.redoRegionTexture=PIXI.RenderTexture.create(this.imagePainter.paintBounds.width,this.imagePainter.paintBounds.height),e.redoRegionTexture.subjectIsolated=this.currentImagePainter.subjectIsolated;try{this.imagePainter.altTexture.width,e.redoRegionTexture.copyPixels(this.imagePainter.altTexture,{x:-e.originPoint.x,y:-e.originPoint.y})}catch(t){e.redoRegionTexture.copyPixels(this.imagePainter.texture,{x:-e.originPoint.x,y:-e.originPoint.y})}e.totalPixels=this.imagePainter.paintBounds.width*this.imagePainter.paintBounds.height*2,this.regionVOs.push(e),this.regionIndex=this.regionVOs.length-1,this.direction="redo",this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED),this.logPosition()}var n=this.freeMemory();if(e){var i="".concat(this.imagePainter.paintBounds.width,"x").concat(this.imagePainter.paintBounds.height,"px [Count:").concat(this.regionVOs.length,", Memory:").concat(n,"%]");BFN.SentryManager.reportBreadcrumb(i,"paint_applied","paint_history")}BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}},{key:"clearRegionVOs",value:function(e){if(null==e&&(e=0),e>=0&&e<this.regionVOs.length){for(var t=e;t<this.regionVOs.length;t++){var n=this.regionVOs[t];n.undoRegionTexture&&n.undoRegionTexture.destroyGC(!0),n.redoRegionTexture&&n.redoRegionTexture.destroyGC(!0),n.undoRegionTexture=null,n.redoRegionTexture=null}this.regionVOs.splice(e),this.regionIndex=this.regionVOs.length-1}}},{key:"freeMemory",value:function(){for(var e,t=0,n=0;n<this.regionVOs.length;n++)t+=(e=this.regionVOs[n]).totalPixels;for(BeFunky.log("~~~"),BeFunky.log("FREE MEMORY:");t>this.maxStoredPixels&&this.regionVOs.length;)(e=this.regionVOs[0]).undoRegionTexture&&e.undoRegionTexture.destroyGC(!0),e.redoRegionTexture&&e.redoRegionTexture.destroyGC(!0),e.undoRegionTexture=null,e.redoRegionTexture=null,BeFunky.log("Removing",e.totalPixels,"Pixels"),t-=e.totalPixels,this.regionIndex=Math.max(0,this.regionIndex-1),this.regionVOs.splice(0,1),this.memoryFreed=!0;var i=Math.round(t/this.maxStoredPixels*1e5)/1e3;return BeFunky.log("Using:",i,"%"),i}},{key:"undo",value:function(){if(this.imagePainter&&this.imagePainter.texture&&this.undoExists){this.imagePainter.preUndoCallback&&this.imagePainter.preUndoCallback(),"undo"===this.direction?this.regionIndex--:this.direction="undo";var e=this.regionVOs[this.regionIndex];switch(this.regionSprite.x=e.originPoint.x,this.regionSprite.y=e.originPoint.y,this.direction){case"undo":this.regionSprite.texture=e.undoRegionTexture;break;case"redo":this.regionSprite.texture=e.redoRegionTexture}try{this.imagePainter.altTexture.width,this.imagePainter.altTexture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.altTexture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}catch(e){this.imagePainter.texture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.texture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}this.regionSprite.texture=null,this.imagePainter.updateComplete(),BFN.MainUI.requestRender(),this.logPosition(),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}this.imagePainter&&this.imagePainter.texture&&!this.undoExists&&(this.imagePainter.paintApplied=!1)}},{key:"redo",value:function(){if(this.imagePainter&&this.imagePainter.texture&&this.redoExists){this.imagePainter.preRedoCallback&&this.imagePainter.preRedoCallback(),"redo"===this.direction?this.regionIndex++:this.direction="redo";var e=this.regionVOs[this.regionIndex];switch(this.regionSprite.x=e.originPoint.x,this.regionSprite.y=e.originPoint.y,this.direction){case"undo":this.regionSprite.texture=e.undoRegionTexture;break;case"redo":this.regionSprite.texture=e.redoRegionTexture}try{this.imagePainter.altTexture.width,this.imagePainter.altTexture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.altTexture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}catch(e){this.imagePainter.texture.clearRect(this.regionSprite.x,this.regionSprite.y,this.regionSprite.texture.width,this.regionSprite.texture.height),BFN.Stage.render(this.regionSprite,this.imagePainter.texture,!1),this.dispatchEvent(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED)}this.regionSprite.texture=null,this.imagePainter.updateComplete(),BFN.MainUI.requestRender(),this.logPosition(),BFN.GlobalHistoryModel.updateGlobalHistoryButtons()}this.imagePainter&&this.imagePainter.texture&&(this.imagePainter.paintApplied=!0)}},{key:"logPosition",value:function(){BeFunky.log("TRACE");for(var e="",t=0;t<this.regionVOs.length;t++){this.regionVOs[t];e+="[",e+=this.regionIndex==t?"undo"===this.direction?"<":">":" ",e+="]"}e+=" ".concat(this.regionIndex),BeFunky.log(e)}},{key:"handlePaintUpdated",value:function(e){this.addRegionVO()}},{key:"undoExists",get:function(){return"undo"===this.direction&&this.regionIndex>0||"redo"===this.direction&&this.regionIndex>=0}},{key:"redoExists",get:function(){return"redo"===this.direction&&this.regionIndex<this.regionVOs.length-1||"undo"===this.direction&&this.regionIndex<=this.regionVOs.length-1}},{key:"imagePainterOpen",get:function(){return!!this.imagePainter}},{key:"currentImagePainter",get:function(){return this.imagePainter}}]),n}();BFN.SingletonQueue.add(function(){BFN.ImagePainterUndoManager=new Sg}),BFN.UndoManagerEvents={TIMESTAMP_UPDATED:new Event("TIMESTAMP_UPDATED")};var Cg=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("UndoManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.batchHistoryActions=["layers_flattened","crop","rotate","resize","cutout","convert_to_image","resize_item_layer"],this.updating=!1,this.collageSnapshotRequired=!1}},{key:"handleEditorHistoryAction",value:function(){var e=UITools.getToolVO("editor_history_action");if(!BFN.GlobalHistoryModel.historyUpdateQueued)switch(e.updating_id){case"undo":this.undo();break;case"redo":this.redo();break;case"reset":this.reset()}}},{key:"undo",value:function(){if(BFN.ZoomRegion.hide(),this.updating=!0,!this.alternateHistoryAction("undo")){var e=BFN.TransformStateModel.getTimestamp(),t=BFN.TransformStateModel.getLastTimestamp(),n=BFN.PhotoEditorHistoryModel.getTimestamp(),i=(BFN.PhotoEditorHistoryModel.getLastTimestamp(),BFN.CollageMakerHistoryModel.getTimestamp()),r=BFN.CollageMakerHistoryModel.getLastTimestamp(),a="layers_flattened"===BFN.PhotoEditorHistoryModel.currentHistoryAction,o=this.batchHistoryActions.includes(BFN.PhotoEditorHistoryModel.currentHistoryAction),s=BFN.TransformStateModel.undoIsBatch&&(a&&"removeall"===BFN.TransformStateModel.undoIsBatch||!a&&BFN.TransformStateModel.undoIsBatch.includes("offset_items"));BFN.AppModel.viewingEditor&&o&&s?(BFN.PhotoEditorHistoryModel.undo(),BFN.TransformStateModel.undo()):BFN.AppModel.viewingEditor&&!isNaN(n)&&(isNaN(t)||isNaN(e)||t<n)?BFN.PhotoEditorHistoryModel.undo():BFN.AppModel.viewingCollage?(BFN.CollageMakerCanvasPhotoGridModel.collageSettings=null,BFN.CollageMakerCanvasPhotoGridModel.freeform||isNaN(r)||!(isNaN(t)||!isNaN(t)&&t<i)?BFN.TransformStateModel.undo():(BFN.CollageMakerHistoryModel.undo(!1),this.collageSnapshotRequired=!0,BFN.TransformStateModel.undoIsAlternate&&t>r&&BFN.TransformStateModel.applyAlternate(t,!1,BFN.CollageMakerHistoryModel.getLastTimestamp())&&(BFN.TransformStateModel.direction="redo")),BFN.CollageMakerHistoryModel.ignoreSnapshotApply||this.updateCollage()):(BFN.TransformStateModel.undo(),this.updateDesigner())}this.dispatchEvent(BFN.UndoManagerEvents.TIMESTAMP_UPDATED),this.updating=!1}},{key:"redo",value:function(){if(BFN.ZoomRegion.hide(),this.updating=!0,!this.alternateHistoryAction("redo")){var e=BFN.TransformStateModel.getTimestamp(),t=BFN.TransformStateModel.getNextTimestamp(),n=(BFN.PhotoEditorHistoryModel.getTimestamp(),BFN.PhotoEditorHistoryModel.getNextTimestamp()),i=(BFN.CollageMakerHistoryModel.getTimestamp(),BFN.CollageMakerHistoryModel.getNextTimestamp()),r="layers_flattened"===BFN.PhotoEditorHistoryModel.nextHistoryAction,a=this.batchHistoryActions.includes(BFN.PhotoEditorHistoryModel.nextHistoryAction),o=BFN.TransformStateModel.redoIsBatch&&(r&&"removeall"==BFN.TransformStateModel.redoIsBatch||!r&&BFN.TransformStateModel.redoIsBatch.includes("offset_items"));BFN.AppModel.viewingEditor&&a&&o?(BFN.PhotoEditorHistoryModel.redo(),BFN.TransformStateModel.redo()):BFN.AppModel.viewingEditor&&!isNaN(n)&&(isNaN(t)||isNaN(e)||n<t)?BFN.PhotoEditorHistoryModel.redo():BFN.AppModel.viewingCollage?(BFN.CollageMakerCanvasPhotoGridModel.collageSettings=null,BFN.CollageMakerCanvasPhotoGridModel.freeform||isNaN(i)||!(isNaN(t)||!isNaN(t)&&i<t)?BFN.TransformStateModel.redo():(BFN.CollageMakerHistoryModel.redo(!1),this.collageSnapshotRequired=!0),BFN.CollageMakerHistoryModel.ignoreSnapshotApply||this.updateCollage()):(BFN.TransformStateModel.redo(),this.updateDesigner())}this.dispatchEvent(BFN.UndoManagerEvents.TIMESTAMP_UPDATED),this.updating=!1}},{key:"gotoTimestamp",value:function(e){if(BFN.AppModel.viewingCollage&&UIToggler.alternateMenuIDs.length&&(UIToggler.alternateMenuIDs.indexOf("collage_image_menu")>=0||UIToggler.alternateMenuIDs.indexOf("collage_pattern_menu")>=0)&&BFN.PhotoGrid.gridIsolator.gridChild)return BFN.PhotoGrid.gridIsolator.revertChanges(),void BFN.PhotoGrid.isolateGridChild(null);for(this.collageSnapshotRequired=!1,BFN.CollageMakerHistoryModel.ignoreSnapshotApply=!0;;)if(0==e){if(isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction){BeFunky.log("done");break}this.undo()}else{var t=this.getTimestamp();if(isNaN(t)&&t==e){BeFunky.log("breakNaN",t!=e);break}if(t>e)this.undo(),BeFunky.log("undo ~");else{if(!(t<e)){if("undo"==BFN.TransformStateModel.direction&&BFN.TransformStateModel.getTimestamp()==t||isNaN(t)){this.redo();continue}BeFunky.log("break");break}this.redo(),BeFunky.log("redo ~")}}BFN.CollageMakerHistoryModel.ignoreSnapshotApply=!1,this.updateCollage(),this.updateDesigner(),this.dispatchEvent(BFN.UndoManagerEvents.TIMESTAMP_UPDATED)}},{key:"alternateHistoryAction",value:function(e){if(BFN.ImageCutout.alternateHistoryAction())return!0;if(BFN.ImagePainterUndoManager.imagePainterOpen)switch(e){case"undo":if(BFN.ImagePainterUndoManager.undoExists)return BFN.ImagePainterUndoManager.undo(),!0;break;case"redo":if(BFN.ImagePainterUndoManager.redoExists)return BFN.ImagePainterUndoManager.redo(),!0;if(BFN.ImagePainterUndoManager.undoExists)return!0}if((BFN.AppModel.viewingEditor||BFN.TransformItemIsolator.active)&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)return BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),!0;if(BFN.AppModel.viewingCollage&&UIToggler.alternateMenuIDs.length&&(UIToggler.alternateMenuIDs.indexOf("collage_image_menu")>=0||UIToggler.alternateMenuIDs.indexOf("collage_pattern_menu")>=0))return BFN.PhotoGrid.gridIsolator.gridChild?(BFN.PhotoGrid.gridIsolator.revertChanges(),BFN.PhotoGrid.isolateGridChild(null)):BFN.CollageMakerHistoryModel.applySnapshot(),!0;if(BFN.TransformItemIsolator.animating)return!0;if(BFN.TransformItemIsolator.active){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e&&console.log(e),BFN.TransformItemIsolator.releaseTransformItem(),!0},n="undo"===e,i=!n;if(n&&!this.undoExists)return t();if(i&&!this.redoExists)return!0;if(n&&BFN.TransformStateModel.undoIsBatch||i&&BFN.TransformStateModel.redoIsBatch)return t();BFN.GlobalHistoryModel.updateSelectedHistoryID();var r=BFN.GlobalHistoryModel.globalHistoryVOHash[BFN.GlobalHistoryModel.selectedHistoryID[BFN.AppModel.viewState]],a=BFN.GlobalHistoryModel.globalHistoryVOs.indexOf(r)+(i?1:0);if(n&&a<0)return t();if(i&&a>=BFN.GlobalHistoryModel.globalHistoryVOs.length)return!0;var o=BFN.GlobalHistoryModel.globalHistoryVOs[a].timestamp,s=n?BFN.TransformStateModel.getLastTimestamp():BFN.TransformStateModel.getNextTimestamp(),l=[void 0,null,NaN];if(n&&(l.includes(o)||l.includes(s)||0===s))return t();if(i&&(l.includes(o)||l.includes(s)))return!0;if(o!==s)return t();var u=BFN.TransformStateModel.getTransitions(),c=BFN.TransformStateModel.getTransitionIndex(),h=u[c],d=h;n&&"undo"===BFN.TransformStateModel.direction?d=u[c-1]:i&&"redo"===BFN.TransformStateModel.direction&&(d=u[c+1]);var m=BFN.TransformItemIsolator.isolatedTransformItem;if(d.transformItem!==m)return t();if(["edit_image","replace_image"].includes(d.id))return t();var p=n?"redo"===BFN.TransformStateModel.direction?h.startState:d.startState:"undo"===BFN.TransformStateModel.direction?h.endState:d.endState,g=m.itemContent.texture?m.itemContent.texture.baseTexture:null,f=p.imageTexture?p.imageTexture.baseTexture:null;if(!g||!f)return t();if(!f.backgroundSpritePosition)return t();if(g===f)return t()}return!1}},{key:"updateCollage",value:function(){BFN.AppModel.viewingCollage&&(this.collageSnapshotRequired&&(this.collageSnapshotRequired=!1,BFN.CollageMakerHistoryModel.applySnapshot()),BFN.CollageMakerCanvasPhotoGridModel.collageSettings&&(BFN.CollageMakerCanvasPhotoGridModel.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.COLLAGE_SETTINGS_UPDATED),BFN.CollageMakerCanvasPhotoGridModel.collageSettings=null))}},{key:"updateDesigner",value:function(){BFN.AppModel.viewingDesigner&&BFN.DesignerCanvasModel.designerSettings&&(BFN.DesignerCanvasModel.dispatchEvent(BFN.DesignerCanvasModelEvents.DESIGNER_SETTINGS_UPDATED),BFN.DesignerCanvasModel.designerSettings=null)}},{key:"reset",value:function(){BFN.ImageCutout.alternateHistoryAction()||BeFunky.confirm("confirm_reset",{onConfirm:function(){if(BFN.TransformGuides.setTransformGuideData(),BFN.TransformGuides.saveGuides(!1),BFN.AppModel.viewingEditor)return delete BFN.ProjectManager.savedCanvasThumbs.editor,(BFN.PhotoEditorCanvasTools.currentTool||BFN.activePresetMenuItem)&&document.getElementById("editor_apply_cancel_cancel").click(),UIToggler.toggleMainMenu(!1),UIToggler.toggleZoomMenu(!1),UIToggler.toggleSampleImagePopover(!0),UIToggler.toggleSaveButtons(!1),BFN.ImageEditManager.resetEditor(),BFN.ProjectService.clearLocalAssets("editor"),BFN.ProjectService.removeLocalProject("editor"),BFN.ProjectManager.autoSave.editor.cancelLazySave(),BFN.GroupManager.clearGroups("editor"),void BFN.PhotoEditorModel.updateProjectVO(!0,!1);if(BFN.AppModel.viewingCollage)return delete BFN.ProjectManager.savedCanvasThumbs.collage,BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerCanvasPhotoGridModel.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.CLEAR_ALL),BFN.ProjectService.clearLocalAssets("collage"),BFN.GroupManager.clearGroups("collage"),void(BFN.CollageMakerModel.projectVO._wasReset=!0);BFN.AppModel.viewingDesigner&&(delete BFN.ProjectManager.savedCanvasThumbs.designer,BFN.GroupManager.clearGroups("designer"),BFN.DesignerModel.loadBlankProject())},confirmText:"yes",cancelText:"no"})}},{key:"getTimestamp",value:function(){var e="redo"==BFN.TransformStateModel.direction?BFN.TransformStateModel.getTimestamp():BFN.TransformStateModel.getLastTimestamp();if(BFN.AppModel.viewingEditor)if(isNaN(e)||BFN.TransformStateModel.undoIsBatch)e=BFN.PhotoEditorHistoryModel.getTimestamp();else{var t=BFN.PhotoEditorHistoryModel.getTimestamp();isNaN(t)||(e=Math.max(e,t))}else if(BFN.AppModel.viewingCollage&&!BFN.CollageMakerCanvasPhotoGridModel.freeform)if(isNaN(e)||BFN.TransformStateModel.undoIsBatch)e=BFN.CollageMakerHistoryModel.getTimestamp();else{var n=BFN.CollageMakerHistoryModel.getTimestamp();isNaN(n)||(e=Math.max(e,n))}else BFN.AppModel.viewingDesigner&&isNaN(e)&&(e=0);return e}},{key:"undoExists",get:function(){if(BFN.ImagePainterUndoManager.imagePainterOpen||BFN.TransformItemIsolator.active)return!0;if(BFN.AppModel.viewingEditor){var e=isNaN(BFN.PhotoEditorHistoryModel.getLastTimestamp()),t=isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction;return!(e&&t)}if(BFN.AppModel.viewingCollage){var n=isNaN(BFN.CollageMakerHistoryModel.getLastTimestamp()),i=isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction;return!(n&&i)}return!(isNaN(BFN.TransformStateModel.getLastTimestamp())||0==BFN.TransformStateModel.getLastTimestamp()&&"undo"==BFN.TransformStateModel.direction)}},{key:"redoExists",get:function(){return BFN.ImagePainterUndoManager.imagePainterOpen?BFN.ImagePainterUndoManager.redoExists:BFN.AppModel.viewingEditor?!(isNaN(BFN.TransformStateModel.getNextTimestamp())&&isNaN(BFN.PhotoEditorHistoryModel.getNextTimestamp())):BFN.AppModel.viewingCollage?!(isNaN(BFN.TransformStateModel.getNextTimestamp())&&isNaN(BFN.CollageMakerHistoryModel.getNextTimestamp())):!isNaN(BFN.TransformStateModel.getNextTimestamp())}},{key:"isBatchHistoryAction",get:function(){return this.batchHistoryActions.includes(BFN.PhotoEditorHistoryModel.currentHistoryAction)}}]),n}();BFN.SingletonQueue.add(function(){BFN.UndoManager=new Cg}),BFN.EffectManagerEvents={EFFECT_UPDATED:new Event("EFFECT_UPDATED"),EFFECT_COMPLETE:new Event("EFFECT_COMPLETE")};var Bg=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("EffectManager Init"),this.changingImageMaxSize=1e3,this.resolution=1,this.changingResolution=1,this.somethingChanged=!1,this.intervalRunning=!1,this.selectedEffectID=null,this.effectChanging=!1,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite=new PIXI.Sprite,this.currentEffect=null,this.currentComponent=null,this.autoProcess=!0,this.useThumbs=!1,this.manageLoadScreen=!0,this.associatedPresetMenuItem=null,this.handleUserEffectCancelBind=this.handleUserEffectCancel.bind(this),this.transparentBackgroundFixer=new BFN.filters.TransparentBackgroundFixFilter,this.effectTexture=null,this.effectSprite=new PIXI.Sprite,this.effectSprite.filters=[this.transparentBackgroundFixer]}},{key:"setSourceTexture",value:function(e){this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.sourceTexture&&(this.transparentBackgroundFixer.iChannel1=this.sourceTexture);var t=Math.min(1,this.changingImageMaxSize/this.sourceTexture.width,this.changingImageMaxSize/this.sourceTexture.height);this.changingResolution=1,t<1&&(this.changingResolution=.5,t<.5&&(this.changingResolution=.25,t<.25&&(this.changingResolution=.125,t<.125&&(this.changingResolution=.0625)))),BeFunky.log("CHANGING RESOLUTION:",this.changingResolution,", ACTUAL:",t)}},{key:"setRenderTexture",value:function(e){this.renderTexture=e,this.autoProcess&&this.processEffect()}},{key:"setupEffect",value:function(){if(this.currentEffect){this.currentEffect.disposeEffect(),this.currentEffect=null;try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){BeFunky.log("ERR FILTER MANAGER DESTROY: ",e)}}this.sourceTexture&&this.selectedEffectID&&BFN.effectMap.hasOwnProperty(this.selectedEffectID)&&BFN.effects.hasOwnProperty(BFN.effectMap[this.selectedEffectID])&&(this.currentEffect=BFN.effects[BFN.effectMap[this.selectedEffectID]],this.currentEffect.setupEffect(this.sourceTexture)),this.dispatchEvent(BFN.EffectManagerEvents.EFFECT_UPDATED),this.effectParameters=null,this.autoProcess&&this.processEffect()}},{key:"processEffectTimeout",value:function(){this.effectChanging?(this.somethingChanged&&(this.somethingChanged=!1,this.processEffect()),this.intervalRunning=!0,setTimeout(this.processEffectTimeout.bind(this),BFN.frameInterval)):this.intervalRunning=!1}},{key:"processEffect",value:function(){var e=null;this.currentEffect&&this.currentEffect.isSetup?(this.resolution=this.effectChanging?this.changingResolution:1,this.effectParameters||this.effectID&&UITools.getToolVO(this.effectID)&&(this.effectParameters=UITools.getToolVO(this.effectID)),this.effectParameters&&this.currentEffect.applyEffect(this.resolution,this.effectParameters,this.useThumbs),e=this.currentEffect):e=this.sourceSprite;var t=this.useThumbs;this.currentEffect&&this.effectParameters&&this.effectParameters.hasOwnProperty("imageURL")?this.currentEffect.effectTexture&&(t=!0):t=!0,t?(this.sourceTexture&&this.renderTexture&&(this.sourceTexture.width!==this.renderTexture.width||this.sourceTexture.height!==this.renderTexture.height)&&this.renderTexture.resize(this.sourceTexture.width,this.sourceTexture.height),this.effectParameters&&this.effectParameters.fixTransparency?(this.effectTexture||(this.effectTexture=PIXI.RenderTexture.create(16,16),this.effectSprite.texture=this.effectTexture),!this.renderTexture||this.effectTexture.width===this.renderTexture.width&&this.effectTexture.height===this.renderTexture.height||this.effectTexture.resize(this.renderTexture.width,this.renderTexture.height),BFN.Stage.render(e,this.effectTexture),BFN.Stage.render(this.effectSprite,this.renderTexture)):BFN.Stage.render(e,this.renderTexture),this.dispatchEvent(BFN.EffectManagerEvents.EFFECT_COMPLETE),!this.useThumbs&&this.manageLoadScreen&&(this.associatedPresetMenuItem?(this.associatedPresetMenuItem.setLoading(!1),this.associatedPresetMenuItem=null):UIToggler.toggleLoadScreen(!1),BeFunky.isLoadScreenActive()&&(BeFunky.reportWarning("Load screen still visible after effect complete"),BeFunky.hideLoadScreen()))):!this.useThumbs&&this.manageLoadScreen&&(this.associatedPresetMenuItem&&(BeFunky.reportWarning("associatedPresetMenuItem not cleaned up"),this.associatedPresetMenuItem.setLoading(!1),this.associatedPresetMenuItem=null),BFN.activePresetMenuItem?(this.associatedPresetMenuItem=BFN.activePresetMenuItem,this.associatedPresetMenuItem.setLoading(!0)):UIToggler.toggleLoadScreen(!0,{onCancel:this.handleUserEffectCancelBind}))}},{key:"reset",value:function(){if(this.resolution=1,this.changingResolution=1,this.effectParameters=null,this.somethingChanged=!1,this.intervalRunning=!1,this.selectedEffectID=null,this.effectChanging=!1,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY,this.effectTexture&&this.effectTexture.resize(16,16),this.transparentBackgroundFixer.iChannel1=PIXI.Texture.EMPTY,this.currentEffect){this.currentEffect.disposeEffect(),this.currentEffect=null;try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){BeFunky.log("ERR FILTER MANAGER DESTROY: ",e)}}this.dispatchEvent(BFN.EffectManagerEvents.EFFECT_UPDATED)}},{key:"handleUserEffectCancel",value:function(){document.getElementById("editor_apply_cancel_cancel").click()}},{key:"effectID",set:function(e){this.selectedEffectID=e,this.setupEffect()},get:function(){return this.selectedEffectID}},{key:"parameters",set:function(e){this.effectParameters=e,this.effectParameters&&(this.somethingChanged=!0,this.intervalRunning||this.processEffectTimeout())},get:function(){return this.effectParameters}},{key:"changing",set:function(e){this.effectChanging=e,BFN.StageModel.setRefreshFactor(this.effectChanging?.25:1),this.processEffect()},get:function(){return this.effectChanging}}]),n}();BFN.SingletonQueue.add(function(){BFN.EffectManager=new Bg}),BFN.ArtsyManagerEvents={ARTSY_UPDATED:new Event("ARTSY_UPDATED"),ARTSY_COMPLETE:new Event("ARTSY_COMPLETE")};var Fg=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("ArtsyManager Init"),this.processing=!1,this.selectedArtsyID=null,this.artsyAmount=1,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite=new PIXI.Sprite,this.transparentBackgroundFixer=new BFN.filters.TransparentBackgroundFixFilter,this.artsySprite=new PIXI.Sprite,this.artsySprite.filters=[this.transparentBackgroundFixer],BFN.ArtsyService.addEventListener(BFN.ArtsyServiceEvents.FAILED.type,this.handleArtsyServiceFailed.bind(this)),BFN.ArtsyService.addEventListener(BFN.ArtsyServiceEvents.COMPLETED.type,this.handleArtsyServiceCompleted.bind(this)),BFN.ArtsyService.addEventListener(BFN.ArtsyServiceEvents.CANCELLED.type,this.handleArtsyServiceCancelled.bind(this))}},{key:"setSourceTexture",value:function(e){this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.sourceTexture&&(this.transparentBackgroundFixer.iChannel1=this.sourceTexture)}},{key:"setRenderTexture",value:function(e){this.renderTexture=e}},{key:"setupArtsy",value:function(){}},{key:"processArtsy",value:function(){this.sourceTexture&&!this.processing&&(BFN.ArtsyService.currentTexture!==this.sourceTexture&&(BFN.ArtsyService.reset(),BFN.ArtsyService.currentTexture=this.sourceTexture),this.processing=!0,UIToggler.toggleLoadScreen(!0,{onCancel:this.cancel.bind(this)}),BeFunky.log("PROCESS IMAGE"),BFN.ArtsyService.processImage())}},{key:"cancel",value:function(){this.processing=!1,BFN.ArtsyService.cancel(),this.reset()}},{key:"reset",value:function(){this.selectedArtsyID=null,this.sourceTexture=null,this.renderTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY,this.transparentBackgroundFixer.iChannel1=PIXI.Texture.EMPTY,this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_UPDATED)}},{key:"handleArtsyServiceFailed",value:function(e){this.processing=!1,BFN.Stage.render(this.sourceSprite,this.renderTexture),BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_COMPLETE)}},{key:"handleArtsyServiceCancelled",value:function(e){this.processing=!1,BFN.Stage.render(this.sourceSprite,this.renderTexture),BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_COMPLETE)}},{key:"handleArtsyServiceCompleted",value:function(e){if(null!=this.renderTexture||this.processing){this.processing=!1;var t=BFN.Util.resizeTexture(e.data,this.renderTexture.width,this.renderTexture.height);t&&(this.artsySprite.texture=t,BFN.Stage.render(this.artsySprite,this.renderTexture),this.artsySprite.texture=PIXI.Texture.EMPTY,t.destroyGC(!0)),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.ArtsyManagerEvents.ARTSY_COMPLETE)}}},{key:"artsyID",set:function(e){this.selectedArtsyID=e,this.setupArtsy()},get:function(){return this.selectedArtsyID}},{key:"parameters",set:function(e){this.artsyParameters=e,this.artsyParameters&&(BFN.ArtsyService.currentArtsyParams=this.artsyParameters,this.processArtsy())},get:function(){return this.artsyParameters}}]),n}();BFN.SingletonQueue.add(function(){BFN.ArtsyManager=new Fg}),BFN.LensFlareManagerEvents={ASSETS_LOADED:new Event("ASSETS_LOADED"),THUMBS_LOADED:new Event("THUMBS_LOADED")};var Eg=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).init(),r}return a(n,[{key:"init",value:function(){BeFunky.log("LensFlareManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.assetLoader=new BFN.GraphicLoader,this.assetLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleAssetLoaderLoadingComplete.bind(this)),this.thumbLoader=new BFN.GraphicLoader,this.thumbLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleThumbLoaderLoadingComplete.bind(this))}},{key:"loadAssets",value:function(e){var t=!1;if(this.assetLoader.reset(),e)for(var n=0;n<e.length;n++){var i=e[n];if(BFN.LensFlareData.assets.hasOwnProperty(i)){var r=BFN.LensFlareData.assets[i];!r.imageTexture&&r.imageURL&&(t=!0,this.assetLoader.graphicsData[i]=r.imageURL)}}t?(UIToggler.toggleLoadScreen(!0),this.assetLoader.loadGraphics()):this.dispatchEvent(BFN.LensFlareManagerEvents.ASSETS_LOADED)}},{key:"loadAssetThumbs",value:function(e){var t=!1;if(this.thumbLoader.reset(),e)for(var n=0;n<e.length;n++){var i=e[n];if(BFN.LensFlareData.assets.hasOwnProperty(i)){var r=BFN.LensFlareData.assets[i];!r.thumbTexture&&r.thumbURL&&(t=!0,this.thumbLoader.graphicsData[i]=r.thumbURL)}}t?this.thumbLoader.loadGraphics():this.dispatchEvent(BFN.LensFlareManagerEvents.THUMBS_LOADED)}},{key:"handleAssetLoaderLoadingComplete",value:function(e){for(var t in this.assetLoader.graphics){var n=this.assetLoader.graphics[t];if(BFN.LensFlareData.assets.hasOwnProperty(t)){var i=BFN.LensFlareData.assets[t];i.imageTexture||n===this.assetLoader.missingTexture||(i.imageTexture=n.renderClone())}}this.assetLoader.reset(),UIToggler.toggleLoadScreen(!1),this.dispatchEvent(BFN.LensFlareManagerEvents.ASSETS_LOADED)}},{key:"handleThumbLoaderLoadingComplete",value:function(e){for(var t in this.thumbLoader.graphics){var n=this.thumbLoader.graphics[t];if(BFN.LensFlareData.assets.hasOwnProperty(t)){var i=BFN.LensFlareData.assets[t];i.thumbTexture||n===this.thumbLoader.missingTexture||(i.thumbTexture=n.renderClone())}}this.thumbLoader.reset(),this.dispatchEvent(BFN.LensFlareManagerEvents.THUMBS_LOADED)}}]),n}();BFN.SingletonQueue.add(function(){BFN.LensFlareManager=new Eg}),BFN.PresetMenuItemThumbManagerEvents={PROCESSING_QUEUE_UPDATED:new Event("PROCESSING_QUEUE_UPDATED")};var Pg=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(e){var r;return i(this,n),(r=t.call(this,e)).init(),r}return a(n,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.queuedPresetMenuItems=[],this.isProcessingQueue=!1,this.currentPresetMenuItem=null,this.presetMenuItemObjectURLs=[],this.lastProcessedItems=null,this.sourceTexture=null,this.thumbSourceTexture=null,this.thumbRenderTexture=null,this.thumbGraphicLoader=new BFN.GraphicLoader,this.thumbTransformSprite=new PIXI.Sprite,this.lensFlareThumbTextures={},this.frameDisplay=new BFN.FrameDisplay;var e=BeFunky.isRetina()?2:1;this.frameThumbPadding=12*e,this.handleEffectCompletedBind=this.handleEffectCompleted.bind(this),this.handleThumbGraphicLoadedBind=this.handleThumbGraphicLoaded.bind(this),this.handleLensFlareElementsAddedBind=this.handleLensFlareElementsAdded.bind(this),this.handleOverlayThumbsLoadedBind=this.handleOverlayThumbsLoaded.bind(this),this.handleFrameDisplayFrameLoadedBind=this.handleFrameDisplayFrameLoaded.bind(this),BFN.PhotoEditorMenuModel.addEventListener(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED.type,this.handleCurrentImageThumbUpdated.bind(this))}},{key:"processItems",value:function(e){if(this.thumbSourceTexture&&this.thumbRenderTexture){this.lastProcessedItems=e;for(var t=0;t<e.length;t++){var n=e[t];this.queuedPresetMenuItems.push(n)}this.isProcessingQueue||(this.isProcessingQueue=!0,this.dispatchEvent(BFN.PresetMenuItemThumbManagerEvents.PROCESSING_QUEUE_UPDATED),this.processQueue())}}},{key:"processQueue",value:function(){var e=this;if(this.queuedPresetMenuItems.length&&this.thumbSourceTexture&&this.thumbRenderTexture)if(this.currentPresetMenuItem=this.queuedPresetMenuItems.shift(),this.currentPresetMenuItem.thumbProcessed||!this.currentPresetMenuItem.useProcessedThumb)this.processQueue();else{var t=this.currentPresetMenuItem.presetID;switch(BFN.toolViewstates[t]){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:if(BFN.effectPresetMap.hasOwnProperty(t)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[t])){var n=BFN.effectPresetMap[t];if(n){var i=UITools.getToolVO(t);BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.useThumbs=!0,BFN.EffectManager.setSourceTexture(i.useHiResThumb&&this.sourceTexture?this.sourceTexture:this.thumbSourceTexture),BFN.EffectManager.setRenderTexture(this.thumbRenderTexture),BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectCompletedBind),BFN.EffectManager.effectID=n,BFN.EffectManager.effectParameters=i.defaultValues;BFN.XMLGraphicLoader.loadEffectsThumbnailsJson().catch(function(e){BeFunky.logWarning("Red effect thumbnail shown to user",n,e)}).then(function(){BFN.EffectManager.processEffect(),BFN.EffectManager.autoProcess=!0,BFN.EffectManager.useThumbs=!1})}}break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE:var r=UITools.getToolVO(t).defaultValues;BFN.XMLGraphicLoader.loadTexturesThumbnailsXml().catch(function(e){BeFunky.logWarning("Red texture thumbnail shown to user",t,e)}).then(function(){e.blendTexture(BFN.XMLGraphicLoader.getGraphicByName(r.texture),r.blendMode,r.alpha),e.assignProcessedThumb()});break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY:var a=this.currentPresetMenuItem.presetObject.categoryID;BFN.OverlaysThumbLoader.addEventListener(BFN.OverlaysThumbLoaderEvents.LOADED.type,this.handleOverlayThumbsLoadedBind),BFN.OverlaysThumbLoader.load(a);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME:var o=UITools.getToolVO(t),s=BFN.PhotoEditorMenuModel.presetItemThumbW-2*this.frameThumbPadding,l="".concat(BFN.remoteImagesURL,"app/frames/").concat(o.texture_category,"/png/images/").concat(o.texture,".png?width=").concat(s);this.frameDisplay.addEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,this.handleFrameDisplayFrameLoadedBind);this.frameDisplay.setupFrame(this.thumbSourceTexture,l,o.texture_data,s,1e3,s,1e3,!0,s);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE:if(this.lensFlareThumbTextures.hasOwnProperty(t))this.handleLensFlareElementsAdded();else{var u=UITools.getToolVO(t),c=u.presetID;if(BFN.LensFlareData.presets.hasOwnProperty(c)){var h=this,d=function(){for(var e=BFN.LensFlareData.presets[c].elementVOs,t=[],n=0;n<e.length;n++){var i=e[n];t.push(i.clone())}h.lensFlareDisplay.addEventListener(BFN.LensFlareDisplayEvents.ELEMENTS_ADDED.type,h.handleLensFlareElementsAddedBind),h.lensFlareDisplay.addElements(t);for(var r=null,a=1;a<=5;a++)u.hasOwnProperty("color_value_".concat(a))&&(r||(r={}),r[a]=u["color_value_".concat(a)]);r&&h.lensFlareDisplay.setGlobalColors(r)};if(void 0!==this.lensFlareDisplay&&void 0!==this.lensFlareDisplay.addEventListener)d();else var m=setInterval(function(){if(void 0!==e.lensFlareDisplay&&void 0!==e.lensFlareDisplay.addEventListener){try{clearInterval(m)}catch(e){}m=null,d()}},10)}else this.processQueue()}break;default:this.processQueue()}}else BFN.EffectManager.reset(),this.isProcessingQueue=!1,this.dispatchEvent(BFN.PresetMenuItemThumbManagerEvents.PROCESSING_QUEUE_UPDATED)}},{key:"blendTexture",value:function(e,t,n){this.thumbTransformSprite.texture=e,this.thumbTransformSprite.scale.x=this.thumbTransformSprite.scale.y=Math.max(this.thumbRenderTexture.width/e.width,this.thumbRenderTexture.height/e.height),this.thumbTransformSprite.x=(this.thumbRenderTexture.width-this.thumbTransformSprite.texture.width*this.thumbTransformSprite.scale.x)/2,this.thumbTransformSprite.y=(this.thumbRenderTexture.height-this.thumbTransformSprite.texture.height*this.thumbTransformSprite.scale.y)/2,BFN.Stage.render(this.thumbTransformSprite,this.thumbRenderTexture);try{e.destroyGC(!0),e=null}catch(e){}this.blendModeSprite.setBlendMode(t),this.blendModeSprite.setBlendIntensity(n),this.blendModeSprite.renderDisplay(),BFN.Stage.render(this.blendModeSprite,this.thumbRenderTexture)}},{key:"assignProcessedThumb",value:function(){var e=this;if(this.thumbRenderTexture.width!==this.thumbSourceTexture.width||this.thumbRenderTexture.height!==this.thumbSourceTexture.height){var t=BFN.PhotoEditorMenuModel.getPresetItemThumbTexture(this.thumbRenderTexture);this.thumbRenderTexture.resize(this.thumbSourceTexture.width,this.thumbSourceTexture.height),this.thumbRenderTexture.copyPixels(t,void 0,void 0,void 0,{x:this.thumbRenderTexture.width/t.width,y:this.thumbRenderTexture.height/t.height}),t.destroyGC(!0)}BFN.Stage.extract.canvas(this.thumbRenderTexture).toBlob(function(t){var n=window.URL.createObjectURL(t);e.presetMenuItemObjectURLs.push(n),e.currentPresetMenuItem.setBackground(n,!0),e.currentPresetMenuItem=null,e.processQueue()},"image/jpeg",.9)}},{key:"handleCurrentImageThumbUpdated",value:function(){var e=this;this.presetMenuItemObjectURLs.forEach(function(e){return URL.revokeObjectURL(e)}),this.presetMenuItemObjectURLs=[],this.thumbSourceTexture=BFN.PhotoEditorMenuModel.currentImageThumbTexture;try{this.sourceTexture.destroyGC(!0)}catch(e){}if(this.sourceTexture=null,this.thumbSourceTexture&&this.thumbSourceTexture.originalBaseTexture){var t=new PIXI.Texture(this.thumbSourceTexture.originalBaseTexture);this.sourceTexture=BFN.Util.getThumbTexture(t,1024),t.destroy(!1)}else BFN.PhotoEditorModel.sourceTexture&&(this.sourceTexture=BFN.Util.getThumbTexture(BFN.PhotoEditorModel.sourceTexture,1024));if(!this.thumbRenderTexture||this.thumbRenderTexture&&(this.thumbRenderTexture.width!==this.thumbSourceTexture.width||this.thumbRenderTexture.height!==this.thumbSourceTexture.height)){try{this.thumbRenderTexture.destroyGC(!0)}catch(e){}this.thumbRenderTexture=PIXI.RenderTexture.create(this.thumbSourceTexture.width,this.thumbSourceTexture.height),this.thumbRenderTexture.clear()}if(this.hasOwnProperty("blendModeSprite")||(this.blendModeSprite=new BFN.BlendModeSprite(!1)),this.blendModeSprite.setBaseTexture(this.thumbSourceTexture),this.blendModeSprite.setBlendTexture(this.thumbRenderTexture),this.hasOwnProperty("lensFlareDisplay")||(this.lensFlareDisplay=new BFN.LensFlareDisplay(!0)),this.lensFlareDisplay.itemWidth!==this.thumbSourceTexture.width||this.lensFlareDisplay.itemHeight!==this.thumbSourceTexture.height){this.lensFlareDisplay.setDisplayDimensions(this.thumbSourceTexture.width,this.thumbSourceTexture.height);var n=Math.min(this.lensFlareDisplay.itemWidth,this.lensFlareDisplay.itemHeight)/4;this.lensFlareDisplay.setSourcePoint(n,-n),this.lensFlareDisplay.setCenterPoint(0,0),this.lensFlareDisplay.x=this.lensFlareDisplay.itemWidth/2,this.lensFlareDisplay.y=this.lensFlareDisplay.itemHeight/2}this.lastProcessedItems&&setTimeout(function(){e.processItems(e.lastProcessedItems)},0)}},{key:"handleEffectCompleted",value:function(){BFN.EffectManager.removeEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectCompletedBind),this.assignProcessedThumb()}},{key:"handleThumbGraphicLoaded",value:function(){this.thumbGraphicLoader.removeEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleThumbGraphicLoadedBind);var e=this.currentPresetMenuItem.presetID,t=UITools.getToolVO(e).defaultValues;this.blendTexture(this.thumbGraphicLoader.graphics[e],t.blendMode,t.alpha),this.assignProcessedThumb()}},{key:"handleOverlayThumbsLoaded",value:function(){BFN.OverlaysThumbLoader.removeEventListener(BFN.OverlaysThumbLoaderEvents.LOADED.type,this.handleOverlayThumbsLoadedBind);var e=this.currentPresetMenuItem.presetObject.categoryID,t=this.currentPresetMenuItem.presetObject.id;BFN.OverlaysThumbLoader.getImage(e,t,!0,this.handleOverlayThumbLoaded.bind(this))}},{key:"handleOverlayThumbLoaded",value:function(e){var t=this.currentPresetMenuItem.presetObject.categoryID;this.thumbRenderTexture.copyPixels(this.thumbSourceTexture);var n=new PIXI.Graphics;n.beginFill(16777215,.9),n.drawRect(0,0,this.thumbSourceTexture.width,this.thumbSourceTexture.height),n.endFill(),BFN.Stage.render(n,this.thumbRenderTexture,!1);var i=new PIXI.Sprite(this.thumbSourceTexture),r=new PIXI.Sprite(e),a=new PIXI.Container;if(a.addChild(i),a.addChild(r),r.scale.x=r.scale.y=this.thumbSourceTexture.height/e.height*.9,r.anchor.x=r.anchor.y=.5,i.mask=r,"patterns"===t)for(var o=-1;o<=1;o++)for(var s=-1;s<=1;s++)r.x=this.thumbSourceTexture.width/2+e.width*o*r.scale.x,r.y=this.thumbSourceTexture.height/2+e.height*s*r.scale.y,BFN.Stage.render(a,this.thumbRenderTexture,!1);else r.x=this.thumbSourceTexture.width/2,r.y=this.thumbSourceTexture.height/2,BFN.Stage.render(a,this.thumbRenderTexture,!1);a.removeChild(i),a.removeChild(r),i.texture=null,r.texture=null,e.destroyGC(!0),this.assignProcessedThumb()}},{key:"handleFrameDisplayFrameLoaded",value:function(){var e=this;this.frameDisplay.removeEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,this.handleFrameDisplayFrameLoadedBind);var t=this.currentPresetMenuItem.presetID,n=UITools.getToolVO(t).defaultValues;this.frameDisplay.setBlendMode(n.hasOwnProperty("blendMode")?n.blendMode:BFN.CONST.BLEND_MODES.NORMAL),BFN.Stage.render(this.frameDisplay,this.thumbRenderTexture,!0),setTimeout(function(){BFN.Stage.render(e.frameDisplay,e.thumbRenderTexture,!0),setTimeout(function(){e.thumbRenderTexture.fillColor(16316667),e.frameDisplay.x=e.thumbRenderTexture.width/2-e.frameDisplay.itemWidth/2,e.frameDisplay.y=e.frameThumbPadding,BFN.Stage.render(e.frameDisplay,e.thumbRenderTexture,!1),e.assignProcessedThumb()},0)},0)}},{key:"handleLensFlareElementsAdded",value:function(){this.lensFlareDisplay.removeEventListener(BFN.LensFlareDisplayEvents.ELEMENTS_ADDED.type,this.handleLensFlareElementsAddedBind);var e=this.currentPresetMenuItem.presetID;this.lensFlareThumbTextures.hasOwnProperty(e)||(this.lensFlareThumbTextures[e]=PIXI.RenderTexture.create(this.lensFlareDisplay.itemWidth,this.lensFlareDisplay.itemHeight),BFN.Stage.render(this.lensFlareDisplay,this.lensFlareThumbTextures[e])),this.thumbRenderTexture.copyPixels(this.lensFlareThumbTextures[e]),this.blendModeSprite.setBlendMode(BFN.CONST.BLEND_MODES.SCREEN),this.blendModeSprite.setBlendIntensity(1),this.blendModeSprite.renderDisplay(),BFN.Stage.render(this.blendModeSprite,this.thumbRenderTexture),this.assignProcessedThumb()}}]),n}();BFN.SingletonQueue.add(function(){BFN.PresetMenuItemThumbManager=new Pg});var kg=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("FeaturedManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.featuredIDs=[],this.featuredEffectIDs=BFN.FeaturedData.effect,this.featuredArtsyIDs=BFN.FeaturedData.artsy,this.featuredFrameIDs=BFN.FeaturedData.frame,this.featuredTextureIDs=BFN.FeaturedData.texture,this.featuredIDs.concat(this.featuredEffectIDs,this.featuredArtsyIDs),this.effectPresetItems=[],this.artsyPresetItems=[],this.framePresetItems=[],this.texturePresetItems=[],BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_COMPLETE.type,this.handleAppComplete.bind(this))}},{key:"initFeaturedMenus",value:function(){}},{key:"handleEffectCategory",value:function(){this.returnPresetItems(this.effectPresetItems,this.effectMenu),"effect_featured"===UITools.getToolValue("editor_effect","updating_id")&&this.borrowPresetItems(this.featuredEffectIDs,BFN.effectIDMap,this.effectPresetItems,this.effectMenu)}},{key:"handleArtsyCategory",value:function(){}},{key:"handleFrameCategory",value:function(){this.returnPresetItems(this.framePresetItems,this.frameMenu),"frame_featured"===UITools.getToolValue("editor_frame","updating_id")&&this.borrowPresetItems(this.featuredFrameIDs,BFN.frameIDMap,this.framePresetItems,this.frameMenu)}},{key:"handleTextureCategory",value:function(){this.returnPresetItems(this.texturePresetItems,this.textureMenu),"texture_featured"===UITools.getToolValue("editor_texture","updating_id")&&this.borrowPresetItems(this.featuredTextureIDs,BFN.textureIDMap,this.texturePresetItems,this.textureMenu)}},{key:"borrowPresetItems",value:function(e,t,n,i){var r=document.createDocumentFragment();if(e.length){for(var a=0;a<e.length;a++){var o=e[a],s=t.hasOwnProperty(o)?t[o]:"null",l="".concat(s,"_").concat(o,"_menu"),u=document.getElementById(l);if(u){if(!document.getElementById("".concat(l,"_placeholder"))){var c=document.createElement("div");c.id="".concat(l,"_placeholder"),u.insertAdjacentElement("afterend",c)}r.appendChild(u),n.push(u)}}i.appendChild(r)}else i.innerHTML='<p class="tool-menu__message"></p>'}},{key:"returnPresetItems",value:function(e,t){if(e&&t){for(var n=0;n<e.length;n++){var i=e[n];if(t.querySelector("#".concat(i.id))){var r=document.getElementById("".concat(i.id,"_placeholder"));r.insertAdjacentElement("afterend",i),r.parentNode.removeChild(r)}}e.splice(0),t.innerHTML=""}}},{key:"handleAppComplete",value:function(e){this.initFeaturedMenus()}},{key:"effectMenu",get:function(){return document.getElementById("effect_featured_menu").querySelector(".menu-content")}},{key:"frameMenu",get:function(){return document.getElementById("frame_featured_menu").querySelector(".menu-content")}},{key:"textureMenu",get:function(){return document.getElementById("texture_featured_menu").querySelector(".menu-content")}}]),e}();BFN.SingletonQueue.add(function(){BFN.FeaturedManager=new kg});var Ng=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("FavoritesManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.favoriteStars={},this.favoriteEffectIDs=[],this.favoriteArtsyIDs=[],this.effectPresetItems=[],this.artsyPresetItems=[],this._effectMenu=null,this._artsyMenu=null,this.favoriteRemoved=!1,this.NOT_ALLOWED_FAVS=["ART_0020","ART_0022","ART_0021","ART_0023"],BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_COMPLETE.type,this.handleAppComplete.bind(this))}},{key:"handleEffectCategory",value:function(){if(this.returnPresetItems(this.effectPresetItems,this.effectMenu),"effect_favorites"===UITools.getToolValue("editor_effect","updating_id"))if(this.favoriteEffectIDs.length){for(var e=document.createDocumentFragment(),t=0;t<this.favoriteEffectIDs.length;t++){var n=this.favoriteEffectIDs[t],i=BFN.effectIDMap.hasOwnProperty(n)?BFN.effectIDMap[n]:"null",r="".concat(i,"_").concat(n,"_menu"),a=document.getElementById(r);if(a){if(!document.getElementById("".concat(r,"_placeholder"))){var o=document.createElement("div");o.id="".concat(r,"_placeholder"),a.insertAdjacentElement("afterend",o)}e.appendChild(a),this.effectPresetItems.push(a)}}this.effectMenu.appendChild(e),this.effectPresetItems.forEach(function(e){return e.generateItem()}),BFN.PresetMenuItemThumbManager.processItems(this.effectPresetItems)}else this.effectMenu.innerHTML='<div class="tool-menu__empty-state"><img class="tool-menu__empty-state-image" src="'.concat(BFN.imagesURL,'app/illustrations/no-favorites.svg" /><p class="tool-menu__message" data-lang="no_favorites">').concat(BeFunky.LanguageManager.getString("no_favorites"),"</p></div>")}},{key:"handleArtsyCategory",value:function(){if(this.returnPresetItems(this.artsyPresetItems,this.artsyMenu),"artsy_favorites"===UITools.getToolVO("editor_artsy").updating_id){var e=document.createDocumentFragment();if(this.favoriteArtsyIDs.length){for(var t=0;t<this.favoriteArtsyIDs.length;t++){var n=this.favoriteArtsyIDs[t],i=BFN.artsyIDMap.hasOwnProperty(n)?BFN.artsyIDMap[n]:"null",r="".concat(i,"_").concat(n,"_menu"),a=document.getElementById(r);if(a){if(!document.getElementById("".concat(r,"_placeholder"))){var o=document.createElement("div");o.id="".concat(r,"_placeholder"),a.insertAdjacentElement("afterend",o)}e.appendChild(a),this.artsyPresetItems.push(a)}}this.artsyMenu.appendChild(e),this.artsyPresetItems.forEach(function(e){return e.generateItem()}),BFN.PresetMenuItemThumbManager.processItems(this.artsyPresetItems)}else this.artsyMenu.innerHTML='<div class="tool-menu__empty-state"><img class="tool-menu__empty-state-image" src="'.concat(BFN.imagesURL,'app/illustrations/no-favorites.svg" /><p class="tool-menu__message" data-lang="no_favorites">').concat(BeFunky.LanguageManager.getString("no_favorites"),"</p></div>")}}},{key:"updateFavoriteMenuButtons",value:function(){var e=BFN.BfnService.userLoggedIn?"flex":"none";document.getElementById("editor_effect_effect_favorites").setStyles({display:e}),document.getElementById("editor_artsy_artsy_favorites").setStyles({display:e})}},{key:"returnPresetItems",value:function(e,t){if(e&&t){for(var n=0;n<e.length;n++){var i=e[n];if(i===BFN.activePresetMenuItem&&document.getElementById("editor_apply_cancel_cancel").click(),t.querySelector("#".concat(i.id))){var r=document.getElementById("".concat(i.id,"_placeholder"));r.insertAdjacentElement("afterend",i),r.parentNode.removeChild(r)}}e.splice(0),t.innerHTML=""}}},{key:"registerFavoriteStar",value:function(e){e&&e.favoriteID?(this.favoriteStars[e.favoriteID]=e,e.selected=this.favoriteIDs.includes(e.favoriteID),e.addEventListener("click",function(){if(BFN.BfnService.userLoggedIn){if(!BFN.toolViewstates.hasOwnProperty(e.presetID))return BeFunky.throwError("BFN.toolViewstates missing favorite star presetID",e.presetID),void UIMessages.display("Error");var t=null,n=null,i=null;switch(BFN.toolViewstates[e.presetID]){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:t="effect",n="effects_fav",i=BFN.FavoritesManager.favoriteEffectIDs.slice(0);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY:t="artsy",n="artsy_fav",i=BFN.FavoritesManager.favoriteArtsyIDs.slice(0)}n&&(e.selected?(BFN.FavoritesManager.favoriteRemoved=!0,i.splice(i.indexOf(e.favoriteID),1),UIMessages.display("favorite_removed")):(i.push(e.favoriteID),UIMessages.display("favorite_added")),BFN.SettingsManager.updateSetting(n,i),BFN.SettingsManager.getSetting(n).then(function(e){BFN.FavoritesManager.handleFavoritesLoaded(t,e)}))}else UIMessages.display("error_not_logged_in",1500)})):BeFunky.throwError("Invalid favorite star registered",e)}},{key:"updateFavoriteStars",value:function(){var e=this;Object.entries(this.favoriteStars).forEach(function(t){var n=f(t,2),i=n[0];n[1].selected=e.favoriteIDs.includes(i)})}},{key:"handleAppComplete",value:function(e){this.updateFavoriteMenuButtons(),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this))}},{key:"handleUserDataChanged",value:function(e){this.updateFavoriteMenuButtons()}},{key:"handleFavoritesLoaded",value:function(e,t){var n,i,r=this;switch(e){case"artsy":n=this.favoriteArtsyIDs,i=this.handleArtsyCategory.bind(this);break;case"effect":n=this.favoriteEffectIDs,i=this.handleEffectCategory.bind(this)}if(!n)return BeFunky.logError("Invalid Favorites category",e);n.splice(0),t.filter(function(e){return!r.NOT_ALLOWED_FAVS.includes(e)}).forEach(function(e){n.push(e)}),this.updateFavoriteStars(),this.favoriteRemoved&&BFN.PhotoEditorCanvasTools.currentTool&&(this.favoriteRemoved=!1),i()}},{key:"favoriteIDs",get:function(){return[].concat(v(this.favoriteEffectIDs),v(this.favoriteArtsyIDs))}},{key:"effectMenu",get:function(){return this._effectMenu||(this._effectMenu=document.querySelector("#effect_favorites_menu .menu-content")),this._effectMenu}},{key:"artsyMenu",get:function(){return this._artsyMenu||(this._artsyMenu=document.querySelector("#artsy_favorites_menu .menu-content")),this._artsyMenu}}]),e}();BFN.SingletonQueue.add(function(){BFN.FavoritesManager=new Ng});var Mg=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.buttons={},this.panelHeaders={}}},{key:"registerButtonIcon",value:function(e){var t=this;e&&e.batchToolID?this.buttons[e.batchToolID]?BeFunky.throwError("Batch processing button icon already registered for batchToolID",e.batchToolID):(this.buttons[e.batchToolID]=e,e.selected=this.isSelected(e.batchToolID),e.addEventListener("click",function(){t.showHelpClue(function(){var t=e.getBoundingClientRect();return{left:"".concat(t.right+30,"px"),top:"".concat(Math.round(t.top+t.height/2),"px")}}).then(function(n){if(n){var i=e.closest(".preset-menu-item");i&&i.helpClueID&&BFN.HelpClueManager.hide(i.helpClueID)}t.handleIconClick(e.batchToolID,n)})})):BeFunky.throwError("Invalid batch processing button icon registered",e)}},{key:"updateButtonIcons",value:function(){var e=this;Object.entries(this.buttons).forEach(function(t){var n=f(t,2),i=n[0];n[1].selected=e.isSelected(i)})}},{key:"registerPanelHeader",value:function(e,t){var n=this;if(e&&t)if(this.panelHeaders[t])BeFunky.throwError("Batch processing Panel Header icon already registered for batchToolID",e,t);else if(Object.values(this.panelHeaders).includes(e))BeFunky.throwError("Batch processing Panel Header icon already registered for a different batchToolID",e,t);else{this.panelHeaders[t]=e;var i=this.isSelected(t);e.toggleButtons({batch_add:!i,batch_remove:i},!1),e.addEventListener("BATCH",function(){n.showHelpClue(function(){var t=e.getBoundingClientRect();return{left:"".concat(t.right+12,"px"),top:"".concat(t.top+t.height/2+4,"px")}}).then(function(e){n.handleIconClick(t,e)})})}else BeFunky.throwError("Invalid batch processing panel header registered",e,t)}},{key:"updatePanelHeaders",value:function(){var e=this;Object.entries(this.panelHeaders).forEach(function(t){var n=f(t,2),i=n[0],r=n[1],a=e.isSelected(i);a!==r.buttons.includes("batch_remove")&&r.toggleButtons({batch_add:!a,batch_remove:a},!1)})}},{key:"showHelpClue",value:function(e){return BFN.HelpClueManager.wasClueDismissed("batch_icon").then(function(t){if(t)return!1;var n=e(),i=n.top,r=n.left,a=document.getElementById("batch_icon_walkthrough");return BFN.HelpClueManager.show("batch_icon",{force:!0,renderOptions:{side:"left",positionFactor:0,strong:!1,top:i,left:r,zIndex:"10",container:a,button:{langID:"try_it_now",onClick:function(){return BFN.BatchProcessingManager.openModal()}}}}),requestAnimationFrame(function(){var e=a.firstElementChild,t=e.container.getBoundingClientRect(),n=t.bottom-BFN.appRect.bottom;n<-16||(e.positionFactor+=(n+16)/(t.height-32-e.arrowBase))}),!0})}},{key:"isSelected",value:function(e){return BFN.BatchToolManager.selectedIDs.includes(e)}},{key:"handleIconClick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=BFN.BatchToolManager.selectedIDs.slice(0),i=this.isSelected(e);i&&t||(i?(n.splice(n.indexOf(e),1),UIMessages.display("batch_tool_removed")):(n.push(e),UIMessages.display("batch_tool_added")),BFN.BatchToolManager.selectedIDs=n)}}]),e}();BFN.SingletonQueue.add(function(){BFN.BatchIconManager=new Mg});var Dg=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("ZoomManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.zoomWheelActive=!1,this.zoomWheelTimer=0,this.zoomSlider=null,this.zoomPercentLabel=null,this.addZoomInputListeners(),BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewstateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),UITools.addEventListener(UIToolsEvents.TOOL_PARAM_UPDATED.type,this.handleZoomAmountChange.bind(this))}},{key:"handleZoom",value:function(){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),t=UITools.getToolVO("zoom");if(e.canvasScaling!==t.updating&&(e.canvasScaling=t.updating),e.canvasScaling){var n=t.stagger_factor;"minus"===t.updating_id?e.canvasScale*=1-.2*n:"plus"===t.updating_id?e.canvasScale*=1+.25*n:e.canvasScale!==t.amount/100&&(e.canvasScale=t.amount/100)}if(UITools.getToolValue("zoom","exact_fit"))switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:e.dispatchEvent(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME);break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:e.dispatchEvent(BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME);break;case BFN.AppModelViewStates.VIEWING_DESIGNER:e.dispatchEvent(BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME)}UITools.getToolValue("zoom","full_screen")&&BFN.AppModel.toggleFullscreen(),BFN.ZoomRegion.show()}},{key:"handleZoomAmountChange",value:function(e){"zoom"===e.data.toolID&&"amount"===e.data.paramID&&(this.zoomPercentLabel||(this.zoomPercentLabel=document.getElementById("zoom_percent_label")),this.zoomPercentLabel.value=Math.round(e.data.value))}},{key:"addZoomInputListeners",value:function(){this.zoomPercentLabel||(this.zoomPercentLabel=document.getElementById("zoom_percent_label")),this.zoomPercentLabel.addEventListener("keydown",function(e){if(["Enter","Backspace","ArrowRight","ArrowLeft"].includes(e.key))return!1;/^[0-9\n]+$/.test(e.key)?this.previousElementSibling.setStyles({display:"none"}):e.preventDefault()}),this.zoomPercentLabel.addEventListener("change",function(e){var t=document.getElementById("zoom_amount").noUiSlider,n=t.options.range,i=n.max,r=n.min,a=e.target.value;if(this.previousElementSibling.setStyles({display:"block"}),a>i&&(a=i),a<r&&(a=r),t){var o=t.get();if(!a)return void(e.target.value=Math.round(o));if(o===a)return;t.set(a),t.target.update("start",a),t.target.update("end",a)}else e.target.value=Math.round(a)})}},{key:"updateZoomRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getCanvasData(),n=t.canvasModel,i=t.canvasW,r=t.canvasH;if(n&&i>0&&r>0){var a=BFN.StageModel.stageW,o=BFN.StageModel.stageH;n.minCanvasScale=.4*Math.min(1,a/i,o/r);var s=Math.round(100*n.minCanvasScale),l=Math.round(100*n.maxCanvasScale);if(this.zoomSlider=this.zoomSlider||document.getElementById("zoom_amount").noUiSlider,!this.zoomSlider)return;var u=this.zoomSlider.get();this.zoomSlider.updateOptions({range:{min:s,max:l}}),e?(UITools.setToolValue("zoom","amount",100*n.canvasScale),UITools.updateToolControl("zoom_amount")):u<s&&(this.zoomSlider.set(s),n.canvasScaling=!0,n.canvasScale=s/100,n.canvasScaling=!1,BFN.MainUI.requestRender())}}},{key:"getCanvasData",value:function(){var e=null,t=0,n=0;switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:e=BFN.PhotoEditorCanvasModel,BFN.PhotoEditorModel.currentTexture&&(t=BFN.PhotoEditorModel.currentTexture.width,n=BFN.PhotoEditorModel.currentTexture.height,BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(t=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,n=BFN.PhotoEditorCanvasTools.currentTool.itemHeight));break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:e=BFN.CollageMakerCanvasModel,t=BFN.CollageMakerCanvasPhotoGrid.gridWidth,n=BFN.CollageMakerCanvasPhotoGrid.gridHeight;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:e=BFN.DesignerCanvasModel,t=BFN.DesignerCanvas.canvasWidth,n=BFN.DesignerCanvas.canvasHeight}return BFN.TransformItemIsolator.active&&(t=BFN.TransformItemIsolator.itemWidth,n=BFN.TransformItemIsolator.itemHeight),{canvasModel:e,canvasW:t,canvasH:n}}},{key:"handleAppReady",value:function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_WHEEL.type,this.handleMainUIMouseWheel.bind(this))}},{key:"handleAppViewstateUpdated",value:function(){this.updateZoomRange(!0)}},{key:"handleStageDimensionsUpdated",value:function(){this.updateZoomRange()}},{key:"handleMainUIMouseWheel",value:function(e){BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture||BFN.ImageCutout.cutoutActive||BeFunky.isPointerDown||BFN.ImagePainterUndoManager&&BFN.ImagePainterUndoManager.currentImagePainter&&BFN.ImagePainterUndoManager.currentImagePainter.mouseDown||(this.zoomWheelTimer=20,this.zoomWheelActive||(this.zoomWheelActive=!0,this.tickZoomWheelTimer()),UITools.setToolValue("zoom","stagger_factor",Math.abs(e.deltaY/100)),e.deltaY<0?UITools.setToolValue("zoom","plus",!1,!0):e.deltaY>0&&UITools.setToolValue("zoom","minus",!1,!0),UITools.applyTool("zoom"))}},{key:"tickZoomWheelTimer",value:function(){--this.zoomWheelTimer<=0?(this.zoomWheelActive=!1,UITools.setToolValue("zoom","stagger_factor",1),UITools.setToolValue("zoom","amount",UITools.getToolValue("zoom","amount"),!1),UITools.applyTool("zoom")):setTimeout(this.tickZoomWheelTimer.bind(this),0)}}]),e}();BFN.SingletonQueue.add(function(){BFN.ZoomManager=new Dg});var wg=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=document.getElementById("collage_customize_menu");this.panelHeader=e.querySelector("panel-header"),this.collageControls=e.querySelector(".collage-controls"),this.designerControls=e.querySelector(".designer-controls"),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewstateUpdated.bind(this))}},{key:"handleCustomize",value:function(){switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:BFN.CollageMakerCanvas.handleCustomize();break;case BFN.AppModelViewStates.VIEWING_DESIGNER:BFN.DesignerCanvas.handleCustomize()}}},{key:"updateMenuDisplay",value:function(){switch(BFN.AppModel.viewState){case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:UITools.setToolValue("collage_customize","background_color",BFN.CollageMakerCanvasBackground.color),UITools.updateToolControls("collage_customize"),this.collageControls.setStyles({display:"block"}),this.designerControls.setStyles({display:"none"}),this.panelHeader.toggleButtons&&this.panelHeader.toggleButtons({help:!1});break;case BFN.AppModelViewStates.VIEWING_DESIGNER:UITools.setToolValue("collage_customize","background_color",BFN.DesignerCanvasBackground.color),UITools.updateToolControls("collage_customize"),this.collageControls.setStyles({display:"none"}),this.designerControls.setStyles({display:"block"}),this.panelHeader.toggleButtons&&this.panelHeader.toggleButtons({help:!0})}}},{key:"handleAppViewstateUpdated",value:function(){this.updateMenuDisplay()}}]),e}();BFN.SingletonQueue.add(function(){BFN.CustomizeManager=new wg});var Lg=function(){function e(){i(this,e),this.isNeedToOpenTouchUp=!1,this.category=null}return a(e,[{key:"openPhotoEditorSideMenu",value:function(e){if(e&&BFN.PhotoEditorModel.currentTexture){switch(this.category=null,e){case"edit-photo":this.category={main:"editor_main",sub:"edit"};break;case"touch-up":this.category={main:"editor_main",sub:"touch_up"};break;case"photo-effects":this.category={main:"editor_main",sub:"effect"};break;case"photo-to-art":this.category={main:"editor_main",sub:"artsy"};break;case"frames":this.category={main:"editor_main",sub:"frame"};break;case"graphics":this.category={main:"editor_main",sub:"graphic"};break;case"overlay":this.category={main:"editor_main",sub:"overlay"};break;case"text-editor":this.category={main:"editor_main",sub:"text"};break;case"textures":this.category={main:"editor_main",sub:"texture"};break;case"crop-photo":case"recortar-fotos":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"crop"};break;case"resize-image":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"resize"};break;case"background-remover":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"background"};break;case"cutout":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"cutout"};break;case"blur-image":case"difuminar-fotos":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"blur"};break;case"replace-color":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"replace_color"};break;case"hair-color":this.category={first_main:"editor_main",first_sub:"touch_up",main:"editor_touch_up",sub:"hair_color"};break;case"effect-pop-art":this.category={first_main:"editor_main",first_sub:"effect",main:"editor_effect",sub:"popartfx"};break;case"effect-glitch-art":this.category={first_main:"editor_main",first_sub:"effect",main:"editor_effect",sub:"glitch_art"};break;case"effect-featured":case"effect-chromatic":case"effect-black&white":case"effect-charcoal":case"effect-color-pinhole":case"effect-cooler":case"effect-cross-process":case"effect-cyanotype":case"effect-grunge":case"effect-hdr":case"effect-holga-art":case"effect-instant":case"effect-line-artopia":case"effect-lomo-art":case"effect-motion-color":case"effect-old-photo":case"effect-orton-style":case"effect-patriotic":case"effect-pinhole":case"effect-sepia":case"effect-stenciler":case"effect-summer":case"effect-sunburst":case"effect-tilt-shift":case"effect-tin-type":case"effect-united-colors":case"effect-warmer":case"effect-viewfinder":case"effect-vintage-colors":case"effect-winter":var t=e.replace("effect-","").replace("-","").replace("fx","");"black&white"===t?t="bw":"tintype"===t&&(t="tinytype"),this.category={first_main:"editor_main",first_sub:"effect",main:"editor_effect",sub:t};break;case"lens-flare":this.category={first_main:"editor_main",first_sub:"effect",main:"editor_effect",sub:"lens_flares"};break;case"cartoonizer":case"digital-art":case"gouache":case"impressionist":case"inkify":case"mosaic":case"oil-painting":case"pastel":case"pen-art":case"pointillism":case"poly-art":case"sketcher":case"underpainting":case"watercolor":this.category={first_main:"editor_main",first_sub:"artsy",main:"editor_artsy",sub:e.replace("-","")};break;case"photo-enhancer":this.category={first_main:"editor_main",first_sub:"edit",main:"editor_edit",sub:"edit_dlx"};break;case"fathers-day":this.category={first_main:"editor_main",first_sub:"graphic",main:"editor_graphic",sub:"holiday_fathers_day"}}if(this.category){if(this.category.hasOwnProperty("first_main")&&(UITools.setToolValue(this.category.first_main,this.category.first_sub,!1),UITools.applyTool(this.category.first_main)),this.category.hasOwnProperty("sub")){if("edit_dlx"===this.category.sub){var n=document.getElementById("editor_edit_accordion_menu");return void(n.activeSections.includes("enhance_dlx")||(n.activeSections=["enhance_dlx"].concat(v(n.activeSections))))}if("edit"===this.category.sub&&this.isNeedToOpenTouchUp&&(this.category.sub="touch_up"),UITools.setToolValue(this.category.main,this.category.sub,!1),UITools.applyTool(this.category.main),"editor_effect"===this.category.main&&!BFN.PresetMenuItemThumbManager.thumbSourceTexture){var i=this.category.sub;BFN.PhotoEditorMenuModel.addEventListener(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED.type,BeFunky.once(function(){var e=document.getElementById("".concat(i,"_menu"));if(e&&e.hasClass("active")){var t=e.querySelectorAll(".preset-menu-item");BFN.PresetMenuItemThumbManager.processItems(t)}}))}}this.category=null,this.isNeedToOpenTouchUp=!1}}}},{key:"handleEditorDeepLink",value:function(){var e=window.currentDeepLinkParameters.type;return"batch"!==e||BeFunky.ignoreDeepLinkAction?"settings"!==e||BeFunky.ignoreDeepLinkAction?void(BFN.PhotoEditorModel.currentTexture&&this.handleEditorImageDeepLink()):(BeFunky.ignoreDeepLinkAction=!0,jm()):(BeFunky.ignoreDeepLinkAction=!0,BFN.BatchProcessingManager.openModal())}},{key:"handleEditorImageDeepLink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=window.currentDeepLinkParameters.type,n=window.currentDeepLinkParameters.tag;if("batch"!==t||BeFunky.ignoreDeepLinkAction||(BeFunky.ignoreDeepLinkAction=!0,BFN.BatchProcessingManager.openModal()),"settings"!==t||BeFunky.ignoreDeepLinkAction||(BeFunky.ignoreDeepLinkAction=!0,jm()),"graphics"===t&&n&&!BeFunky.ignoreDeepLinkAction&&BFN.GraphicLibraryManager.openModal(n),"photoeditor"===t||BeFunky.ignoreDeepLinkAction){if(BFN.mainMenuStates.editor.secondary)return e();t="edit-photo"}["collage","designer"].includes(t)&&(BeFunky.reportWarning("Invalid editor deep link type: ".concat(t)),t="edit-photo"),BFN.DeepLinkManager.openPhotoEditorSideMenu(t),setTimeout(function(){BeFunky.waitUntil({condition:function(){return!BFN.MainUI.viewportUpdating},onSuccess:e,onTimeout:function(){BeFunky.reportWarning("viewportUpdating timed out"),e()},interval:100,maxAttempts:50})},0),BeFunky.ignoreDeepLinkAction=!0}},{key:"getDesignerDeepLinkData",value:function(){var e=window.currentDeepLinkParameters,t=e.tag,n=e.template;return BeFunky.ignoreDeepLinkAction||!n&&!t?{deepLinkTagID:null,deepLinkTemplateID:null,deepLinkTemplateRoute:null}:{deepLinkTagID:t||null,deepLinkTemplateID:n||null,deepLinkTemplateRoute:BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1]}}},{key:"handleDesignerDeepLink",value:function(){if(!BeFunky.ignoreDeepLinkAction){var e=this.getDesignerDeepLinkData(),t=e.deepLinkTagID,n=e.deepLinkTemplateID,i=e.deepLinkTemplateRoute;t?BFN.DesignerTemplateManager.openModal(t):n?BFN.DesignerTemplateManager.openDeepLinkTemplatePreview(n,i):BFN.DesignerModel.projectVO._wasReset&&BFN.DesignerTemplateManager.openModal()}}}]),e}();function Og(){var e=g(['<panel-header lang-id="','" modifier="tertiary" buttons="back" @BACK=',"></panel-header>"]);return Og=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.DeepLinkManager=new Lg});var Rg=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.isDataLoaded=!1,this.loadedPatternCategories=[],this.menuImageVOs=[],this.usedPatternBaseTextures=[]}},{key:"handlePatternCategory",value:function(){var e=UITools.getToolValue("collage_patterns","updating_id");if(!this.loadedPatternCategories.includes(e)){this.loadedPatternCategories.push(e);var t=[],n=function(n){return function(i){t.push({isPlus:n,id:"patterns_".concat(e,"_").concat(n?"plus":"free","_").concat(i),num:i})}},i=BFN.PatternsData["patterns_".concat(e)];i.freePatterns.forEach(n(!1)),i.plusPatterns.forEach(n(!0)),this.createTertiaryMenu(e,i.name,t)}}},{key:"loadCategories",value:function(){var e=this;this.isDataLoaded||BFN.PatternsDataLoader.load(function(){if(!e.isDataLoaded&&!Object.keys(BFN.PatternsData).length)return BeFunky.logError("Unable to get pattern category data");e.isDataLoaded=!0,v(document.getElementById("collage_patterns_category_menu").children).forEach(function(e){return e.disabled=!1})})}},{key:"createTertiaryMenu",value:function(e,t,n){var i=this,r="collage_patterns_".concat(e,"_menu"),a=document.createElement("div"),o="featured"===e?"featured":"pattern_".concat(e);a.id=r,a.addClass("tool-menu");var s=BeFunky.lit.elem(Og(),o,function(){return showMenuPanel("secondary")}),l=document.createElement("div");l.addClass("scrollable-content");var u=document.createElement("div");u.addClass("tertiary-grid"),n.forEach(function(e){var n=document.createElement("button"),r=e.id;n.categoryName=t,n.id=r,n.isPlus=e.isPlus,n.className="button tertiary-grid__item tertiary-grid__item--pattern",n.dataset.tooltip="drag_or_double_click_pattern",n.isPlus&&n.addClass("tertiary-grid__item--is-plus");var a=document.createElement("span");if(a.className="tertiary-grid__image tertiary-grid__image--pattern",n.appendChild(a),e.isPlus){var o=document.createElement("span");o.className="tertiary-grid__badge badge badge--plus",n.appendChild(o)}u.appendChild(n);var s=i.getMenuImageVO(r);s.name="".concat(t," Pattern ").concat(e.num),s.thumbURL="".concat(BFN.imagesURL,"app/collage-patterns/").concat(r,".png?auto=webp"),s.imageURL="".concat(BFN.remoteImagesURL,"app/graphics/patterns/02FEB18/").concat(t.split(" ").join("-"),"/").concat(r,".png?io=off"),n.menuImageVO=s;var c='url("'.concat(s.thumbURL,'") 0 0 repeat'),h="".concat(22,"px");n.setStyles({background:c,backgroundSize:h}),BFN.UI.draggableElement(n,l),n.addEventListener("dblclick",i.handleItemDoubleClick),n.addEventListener("dragstarted",i.handleItemDragStarted),n.addEventListener("dragstopped",i.handleItemDragStopped)}),a.appendChild(s),a.appendChild(l),l.appendChild(u),document.getElementById("editor_tool_menu_container").appendChild(a)}},{key:"doubleBlobDimensions",value:function(e,t,n){BFN.TextureUtils.blobOrBase64ToTexture(t,function(t){var i=t.error,r=t.texture;if(i)return n({error:i});var a=BFN.Util.getTextureAverageColor(r,!0),o=PIXI.RenderTexture.create(2*r.width,2*r.height);o.copyPixels(r,new PIXI.Point(0,0)),o.copyPixels(r,new PIXI.Point(r.width,0),!1),o.copyPixels(r,new PIXI.Point(0,r.height),!1),o.copyPixels(r,new PIXI.Point(r.width,r.height),!1),r.destroyGC(!0),(r=o).baseTexture.averageColor=a,r.baseTexture.isPattern=!0,e.imageTexture=r,BFN.TextureUtils.textureToBlobWithErrorHandling(r,{isTransparent:!1}).then(function(e){return n({blob:e})},function(e){return n({error:e})})})}},{key:"destroyUnusedPatternBaseTextures",value:function(){this.updateUsedPatternBaseTextures(),this.destroyPatternBaseTextures(this.usedPatternBaseTextures)}},{key:"updateUsedPatternBaseTextures",value:function(){var e=this,t=function(t){t&&t.isPattern&&!e.usedPatternBaseTextures.includes(t)&&e.usedPatternBaseTextures.push(t)};this.usedPatternBaseTextures.splice(0),Object.values(BFN.AppModelViewStates).forEach(function(e){BFN.TransformStateModel.getTransitions(e).forEach(function(e){t(e.startState.collageSettings.backgroundPatternBaseTexture),t(e.endState.collageSettings.backgroundPatternBaseTexture),t(e.startState.imageTexture?e.startState.imageTexture.baseTexture:null),t(e.endState.imageTexture?e.endState.imageTexture.baseTexture:null)})}),BFN.CollageMakerCanvas.transformLayer.transformItems.forEach(function(e){t(e.itemContent.texture?e.itemContent.texture.baseTexture:null)}),BFN.CollageMakerHistoryModel.snapshotVOs.forEach(function(e){t(e.backgroundPatternBaseTexture),e.snapshotChildren.forEach(function(e){t(e.texture?e.texture.baseTexture:null)})})}},{key:"destroyPatternBaseTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.menuImageVOs.forEach(function(t){if(t.imageTexture&&t.imageTexture.baseTexture&&!e.includes(t.imageTexture.baseTexture)){try{t.imageTexture.destroyGC(!0)}catch(e){}t.imageTexture=null}})}},{key:"getMenuImageVO",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.startsWith("patterns_"))return BeFunky.logError("Invalid Pattern MenuImageVO ID: ".concat(e));var n=this.menuImageVOs.find(function(t){return t.id===e});if(n||!t)return n;var i=new BFN.MenuImageVO;return i.id=e,i.indexedDBKey="image__".concat(e),i.isPattern=!0,this.menuImageVOs.push(i),i}},{key:"handleItemDoubleClick",value:function(e){var t=e.target;if(t.isPlus&&!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("COLLAGE","PATTERN_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Add Plus Pattern"]);var n=t.menuImageVO;BFN.BfnService.getTexturesForMenuImageVOs([n],{saveAssetsSectionID:"collage"}).then(function(){n.imageTexture&&(BFN.CollageMakerCanvasPhotoGrid.createHistoryTransition("background_pattern"),BFN.CollageMakerCanvasPhotoGrid.setPatternBackgroundTexture(n.imageTexture),BFN.CollageMakerCanvasPhotoGrid.registerHistoryTransition())})}},{key:"handleItemDragStarted",value:function(e){var t=e.target;BFN.DragScreen.show(t.menuImageVO.thumbURL),BFN.AppModel.viewState!==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER||BFN.CollageMakerCanvasPhotoGridModel.freeform||(BFN.PhotoGrid.awaitingDrop=!0),BFN.TransformModel.awaitingDrop=!0}},{key:"handleItemDragStopped",value:function(e){var t=e.target,n=e.detail.canvasCoordinates;if(t.isPlus&&!BFN.BfnService.userIsPlus)return BFN.PhotoGrid.awaitingDrop=!1,BFN.BfnService.upgrade("COLLAGE","PATTERN_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Add Plus Pattern"]);n?BFN.ImageLibraryManager.addImageToCanvas(t.menuImageVO,{initialCenterPosition:n}):BFN.PhotoGrid.awaitingDrop=!1}}]),e}();function Ag(){var e=g(['<span class="tertiary-grid__badge tertiary-grid__badge--layout badge badge--plus"></span>']);return Ag=function(){return e},e}function Vg(){var e=g(["\n            <button class="," .templateVO="," @click=",'>\n                <span class="tertiary-grid__image tertiary-grid__image--layout" style=',"></span>\n                ","\n            </button>\n            "]);return Vg=function(){return e},e}function Ug(){var e=g(['\n        <div id="','" class="tool-menu">\n            <panel-header lang-id="','" modifier="tertiary" buttons="back" @BACK=','></panel-header>\n            <div class="scrollable-content">\n                <div class="tertiary-grid">\n                    ',"\n                </div>\n            </div>\n        </div>\n        "]);return Ug=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.CollageMakerPatternManager=new Rg});var Gg=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.loadedTemplateCategories=[],this.spriteHasLoaded=!1,this.spriteLoadAttempt=0,BFN.CollageMakerTemplateModel.addEventListener(BFN.CollageMakerTemplateModelEvents.CURRENT_TEMPLATE_UPDATED.type,function(){var e="tertiary-grid__item--selected",t=document.querySelectorAll(".tertiary-grid__item--layout.tertiary-grid__item--".concat(BFN.CollageMakerTemplateModel.currentTemplate.name)),n=document.querySelectorAll(".tertiary-grid__item--layout.".concat(e));requestAnimationFrame(function(){n.removeClass(e),t.forEach(function(t){return t.addClass(e)})})})}},{key:"handleTemplateCategory",value:function(){var e=UITools.getToolValue("collage_layouts","updating_id"),t="collage_layout_".concat(e,"_menu");if(!this.loadedTemplateCategories.includes(e)){this.loadedTemplateCategories.push(e);var n=BFN.CollageMakerTemplateData.templateCategoryVOs.find(function(t){return t.id===e}),i=n.templateVOs,r=BeFunky.lit,a=r.elem,o=r.html,s=(r.icon,r.styleMap),l=a(Ug(),t,n.name,function(){return showMenuPanel("secondary")},i.map(function(e){var t="button tertiary-grid__item tertiary-grid__item--layout";e.isPlus&&(t+=" tertiary-grid__item--is-plus");BFN.CollageMakerTemplateModel.currentTemplate===e&&(t+=" tertiary-grid__item--selected");t+=" tertiary-grid__item--".concat(e.name);var n={backgroundPosition:e.spritePosition,backgroundSize:e.spriteSize,imageRendering:BeFunky.isChromium?"pixelated":BeFunky.isFirefox?"-moz-crisp-edges":""};return o(Vg(),t,e,u,s(n),function(e){return e.isPlus?o(Ag()):""}(e))}));document.getElementById("editor_tool_menu_container").appendChild(l)}function u(e){var t=e.target.templateVO;if(t.isPlus&&!BFN.BfnService.userIsPlus){BFN.BfnService.upgrade("TEMPLATES","".concat(t.name.toUpperCase(),"_UPGRADE"),"template");var n=null;return BFN.CollageMakerTemplateData.templateCategories.forEach(function(e){n||t.categoryID!==e.id||(n=e.name)}),void(n&&BFN.UserActionManager.addUpgradeAction(["Select Plus Layout",n,t.name]))}BFN.CollageMakerTemplateModel.currentTemplate=t}}}]),e}();function Hg(){var e=g(['\n        <panel-header class="recent-projects__header" lang-id="recent_projects" modifier="tertiary" buttons="view_all" @VIEW_ALL=','></panel-header>\n        <div class="scrollable-content">\n            <div class="recent-projects__content">\n                <image-gallery\n                    .images=',"\n                    .isLoading=","\n                    .message=","\n                    .onSelectItem=","\n                    .emptyState=","\n                    .currentWidth=","\n                    .gutterWidth=","\n                    .borderWidth=","\n                    .rowHeight=","\n                />\n            </div>\n        </div>"]);return Hg=function(){return e},e}function zg(){var e=g(['<div class="recent-projects"></div>']);return zg=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.CollageMakerTemplateManager=new Gg});var jg=BeFunky.lit,Xg=jg.html,Wg=jg.setupState,Yg=jg.render,qg=(jg.lang,jg.icon,jg.elem);function Kg(){var e=qg(zg()),t=BeFunky.debounce(function(){return Yg((t=i.isLoggedIn?i.isLoading?{isLoading:!0}:i.fetchProjectsError?{message:{isError:!0,text:BeFunky.failureReason(i.fetchProjectsError),buttonText:"try_again",buttonAction:function(){return l()}}}:i.projects.length?{images:(i.projects,m=BeFunky.isRetina()?202:101,p={width:m,height:m,fit:"crop",auto:"webp"},i.projects.map(function(e){e.id=e.templateid;var t=new BFN.MenuImageVO;return t.createId("befunky_project",e.id),t.name=e.filename,t.thumbURL=BeFunky.addParamsToURL(e.thumburl,p),t.thumbWidth=m,t.thumbHeight=m,t.isTransparent=/\.png($|\?)/.test(e.thumburl),t})),onSelectItem:function(e){var t=e.id.replace(/^befunky_project_/,""),n=i.projects.find(function(e){return e.id===t});BeFunky.SavedProjectManager.openUserSavedProject(n).catch(function(e){BeFunky.logError("Failed to open recent project",e)})}}:{emptyState:{imageUrl:"".concat(BFN.imagesURL,"app/illustrations/no-projects-sidebar.svg"),text:"no_saved_projects",linkText:"learn_more",linkHref:"https://support.befunky.com/hc/en-us/articles/360003279091-How-Do-I-Save-My-Project-So-I-Can-Edit-It-Later-"}}:{emptyState:{imageUrl:"".concat(BFN.imagesURL,"app/illustrations/no-projects-sidebar.svg"),text:"login_load_projects",buttonText:"sign_in",buttonAction:s}},n=t.isLoading,r=void 0!==n&&n,a=t.images,u=void 0===a?[]:a,c=t.message,h=t.emptyState,d=t.onSelectItem,Xg(Hg(),o,u,r,c,d,h,224,8,1,108)),e);var t,n,r,a,u,c,h,d,m,p},"raf"),n=f(Wg({isLoggedIn:!1,isLoading:!1,fetchProjectsError:"",projects:[]},t),2),i=n[0],r=n[1];return BeFunky.LanguageManager.addLanguageUpdateListener(t),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,a),a(),Object.assign(e,{fetchProjects:l}),e;function a(){var e=BeFunky.isLoggedIn(),t=i.isLoggedIn;r({isLoggedIn:e}),e&&!t&&l()}function o(){if(!i.isLoggedIn)return BFN.BfnService.login(function(){return BeFunky.SavedProjectManager.openProjectModal()});BeFunky.SavedProjectManager.openProjectModal()}function s(){return BFN.BfnService.login()}function l(){r({isLoading:!0}),BFN.SavedProjectService.getFirst100Projects().then(function(e){r({isLoading:!1,fetchProjectsError:"",projects:e.slice(0,10)})}).catch(function(e){r({isLoading:!1,fetchProjectsError:"no_results"===e?"":e,projects:[]})})}}function Qg(){var e=g(['\n                    <p class="template-preview__sign-in">\n                        ','\n                        <button class="button button--link" @click=',">","</button>\n                    </p>\n                "]);return Qg=function(){return e},e}function Zg(){var e=g(['\n                    <button class="template-preview__button button button--blue button--sm" @click=',">","</button>\n                "]);return Zg=function(){return e},e}function Jg(){var e=g(['\n                    <p class="template-preview__description">','</p>\n                    <button class="template-preview__button button button--blue button--sm" @click=',">","</button>\n                "]);return Jg=function(){return e},e}function $g(){var e=g(['\n            <div class="template-preview__left-column">\n                <div class="template-preview__image-outer">\n                    <div class="template-preview__image-inner" style=','>\n                        <div class="template-preview__image-placeholder" style=','></div>\n                    </div>\n                </div>\n            </div>\n            <div class="modal__body template-preview__content">\n                <div class="template-preview__header">\n                    <h3 class="template-preview__name">','</h3>\n                    <p class="template-preview__dimensions">',"</p>\n                </div>\n                ","\n                ","\n            </div>\n        "]);return $g=function(){return e},e}function ef(){var e=g(['<div id="template_preview" class="modal template-preview"></div>']);return ef=function(){return e},e}var tf=BeFunky.lit,nf=tf.html,rf=tf.setupState,af=tf.render,of=tf.lang,sf=tf.elem;function lf(){var e=sf(ef()),t={templateID:"",thumbURL:"",imageURL:"",imageWidth:100,imageHeight:100,isTemplatePlus:!1,name:"",dimensions:"",version:void 0,trackSearchTerm:"",prevImageURL:"",nextImageURL:"",onPrev:void 0,onNext:void 0},n={isLoggedIn:BeFunky.isLoggedIn(),isPlus:BFN.BfnService.userIsPlus,imageToRender:"",maxImageSize:[400,400],isFreeTrialEnabled:BeFunky.getFreeTrialEnabled()},i={},r=Object.assign({},t,n),a=BeFunky.debounce(function(){return af((t=s.isTemplatePlus&&!BFN.BfnService.userIsPlus,n=[s.imageToRender?"background-image: url(".concat(s.imageToRender,")"):"","padding-bottom: ".concat(100/(s.imageWidth/s.imageHeight),"%")].filter(Boolean).join("; "),i=BFN.DesignerTemplateManager.parseDimensions(s.dimensions),r=i.printSize,a=i.pixelSize,nf($g(),"width: ".concat(function(){if(!s.imageURL)return 100;var e=s.imageWidth/s.imageHeight,t=s.maxImageSize[0]/s.maxImageSize[1];return e>=t?100:100*e/t}(),"%"),n,s.name,r?"".concat(a," (").concat(r,")"):a,t?nf(Jg(),g("designer_template_upgrade"),c,g(s.isFreeTrialEnabled?"start_free_trial":"upgrade")):nf(Zg(),h,g("use_template")),s.isLoggedIn?"":nf(Qg(),g("teaser_modal_have_an_account"),u,g("sign_in")))),e);var t,n,i,r,a},"raf"),o=f(rf(r,function(e){!function(e){if(!e.imageURL)return;if(!s.imageURL)return l({imageToRender:""});function t(e){return!0===i[e]?Promise.resolve():i[e]instanceof Promise?i[e]:(i[e]=new Promise(function(t,n){var r=new Image;r.src=e,r.onload=function(){t(),i[e]=!0},r.onerror=function(){n(),delete i[e]}}),i[e])}l({imageToRender:s.thumbURL||s.imageURL}),t(s.imageURL).then(function(){requestIdleCallback(function(){l({imageToRender:s.imageURL})})}).catch(function(){BeFunky.logError("Failed to preload Template preview",s.imageURL)}).then(function(){[s.nextImageURL,s.prevImageURL].filter(Boolean).map(t)})}(e),a()}),2),s=o[0],l=o[1];return BeFunky.LanguageManager.addLanguageUpdateListener(a),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,function(){l({isLoggedIn:BeFunky.isLoggedIn(),isPlus:BFN.BfnService.userIsPlus})}),BeFunky.onFreeTrialEnabledChange(function(e){return l({isFreeTrialEnabled:e})},!1),Object.assign(e,{open:function(){BeFunky.openModal(e,{addCloseButton:!0,onArrowClick:d,onOpen:function(){var t=f(BeFunky.getModal(e.id).arrowButtons,2),n=t[0],i=t[1];n.disabled=!s.onPrev,i.disabled=!s.onNext},onClose:function(){l(t)},onWindowResize:p})},close:m,setState:l}),e;function u(){BeFunky.openLoginPanel("SIGNIN")}function c(){BFN.UserActionManager.addUpgradeAction(["Select Plus Template",BFN.UserActionManager.translateToReadable(s.templateID)]),BFN.BfnService.upgrade("DESIGNER_TEMPLATE",s.templateID.replace(/ /g,"_").toUpperCase(),"designer_templates")}function h(){BFN.BfnService.track("CREATE","DESIGNER_TEMPLATE",s.templateID.replace(" ","_").toUpperCase());var e=s.imageURL;return BFN.ProjectManager.confirmLoadNewProject({onConfirm:function(){BFN.DesignerTemplateManager.applyTemplate({id:s.templateID,name:s.name,version:s.version,isPlusTemplate:s.isTemplatePlus,trackingData:{id:s.templateID,name:s.name,searchTerm:s.trackSearchTerm}}),setTimeout(function(){requestAnimationFrame(function(){m(),BeFunky.closeModal("template_library",!1)})},100)},projectSection:"designer",getNewProjectThumbnail:function(){return Promise.resolve({image:e})}})}function d(e){"left"===e?s.onPrev():s.onNext()}function m(){BeFunky.closeModal(e)}function p(t){var n=t.availableWidth,i=t.availableHeight,r=Math.min(n,944),a=Math.min(688,Math.max(400,i));e.setStyles({width:"".concat(r,"px"),height:"".concat(a,"px")});var o=[r-320-48,a-48];o.isIdenticalTo(s.maxImageSize)||l({maxImageSize:o})}function g(e){return of(e,"app")}}function uf(){var e=g(['<image-gallery\n            class="template-library__results-gallery"\n            .currentWidth=',"\n            .rowHeight=","\n            .extendItemTemplate=","\n            .onSelectItem=","\n            .gutterWidth=","\n            .borderWidth=","\n            .singleRow=","\n        ></image-gallery>"]);return uf=function(){return e},e}function cf(){var e=g(['\n            <div class="badge badge--plus template-editors-choice__badge-plus"></div>\n        ']);return cf=function(){return e},e}function hf(){var e=g(['\n            <div class="template-editors-choice__row">\n                <div class="template-editors-choice__row-header">\n                    <p class="template-editors-choice__row-heading text-sm">','</p>\n                    <button class="button button--link button--sm template-editors-choice__see-all" @click=',">","</button>\n                </div>\n                ","\n            </div>\n        "]);return hf=function(){return e},e}function df(){var e=g(['<div class="template-editors-choice">',"</div>"]);return df=function(){return e},e}var mf=BeFunky.lit,pf=mf.html,gf=(mf.icon,mf.lang),ff=mf.elem;function vf(e,t,n,i,r){var a=1280,o={"Facebook & Instagram Stories":.9375*i,"Facebook & Instagram Posts":1.16*i,"Facebook Page Covers":1.6*i,"YouTube Channel Art":1.3*i,"YouTube Thumbnails":1.3*i,"Twitter Headers":1.6*i,Invitations:1.2*i,"Business Cards":1.2*i,Infographics:.6666*i},s=e.map(function(e){var t=e.title;e.tagID,e.templateData;return function(e){var t=o[e]||i,n=r/t;return ff(uf(),a,n,u,c,8,1,!0)}(t)});h();var l=ff(df(),e.map(function(e,n){var i=e.title,r=e.tagID;return e.templateData,pf(hf(),gf(i,"modal"),function(){return t({tagID:r})},gf("view_all","modal"),s[n])}));return l.updateGalleries=h,l;function u(e){return!e.isPlus||BFN.BfnService.userIsPlus?"":pf(cf())}function c(t){var n,i;e.forEach(function(e){var r=e.templateData;r.find(function(e){return e.id===t.id})&&(n=r.findIndex(function(e){return e.id===t.id}),i=r)});var r=t.isPlus,a=t.projectFileName,o=t.dimensions,s=t.displayName,l=t.imageWidth,u=t.imageHeight,h=t.imageURL,d=t.lastRenderedThumb,m=t.version,p=a.replace(".bfd",""),g=0!==n,f=n!==i.length-1;BFN.DesignerTemplateManager.openPreviewModal({templateID:p,thumbURL:d?d.url:h,imageURL:h,imageWidth:l,imageHeight:u,name:s,dimensions:o,trackSearchTerm:"editors_choice",version:m,isTemplatePlus:r,prevImageURL:g&&i[n-1].imageURL,nextImageURL:f&&i[n+1].imageURL,onPrev:g?function(){c(i[n-1])}:void 0,onNext:f?function(){c(i[n+1])}:void 0})}function h(){s.forEach(function(t,n){var i=e[n].templateData;t.images=i,t.currentWidth=r})}}function yf(){var e=g(['<div id="template_library_custom_template_height" class="scrubber"></div>']);return yf=function(){return e},e}function xf(){var e=g(['<div id="template_library_custom_template_width" class="scrubber"></div>']);return xf=function(){return e},e}function _f(){var e=g(['\n            <div class="blank-canvas__template-description">\n                <p class="blank-canvas__template-title">','</p>\n                <p class="blank-canvas__template-dimensions">',"</p>\n            </div>\n            "]);return _f=function(){return e},e}function If(){var e=g(["<image-gallery\n            class=","\n            .rowHeight=","\n            .currentWidth=","\n            .onSelectItem=","\n            .extendItemTemplate=","\n            .imagePadding=","\n            .gutterWidth=","\n            .images=","\n        ></image-gallery>"]);return If=function(){return e},e}function Tf(){var e=g(['\n            <div class="blank-canvas__row-header">\n                <p class="bold">','</p>\n            </div>\n            <div class="blank-canvas__gallery-row">\n                ',"\n            </div>\n        "]);return Tf=function(){return e},e}function bf(){var e=g(['\n            <div class="template-library__left-panel">\n                <p class="blank-canvas__custom-heading">','</p>\n                <div class="control-item-columns blank-canvas__dimensions-scrubber">\n                    <div class="control-item">\n                        <label class="control-item-label">',"</label>\n                            ",'\n                    </div>\n                    <button class="button button--icon button--white-outline blank-canvas__swap-dimensions" @click="','">\n                        ','\n                    </button>\n                    <div class="control-item">\n                        <label class="control-item-label">',"</label>\n                            ",'\n                    </div>\n                </div>\n                <button class="modal__button blank-canvas__button button button--blue" @click="','">','</button>\n            </div>\n            <div class="template-library__right-panel">\n                <div class="scrollable-content scrollable-content--modal-right-panel" style=',">\n                    ","\n                </div>\n            </div>\n        "]);return bf=function(){return e},e}function Sf(){var e=g(['<div class="blank-canvas__section"></div>']);return Sf=function(){return e},e}var Cf=BeFunky.lit,Bf=Cf.html,Ff=Cf.render,Ef=Cf.lang,Pf=Cf.elem,kf=Cf.icon;function Nf(e){var t,n,i={social:[{dimensions:"1024px x 768px",title:"Presentation (4:3)",image:"social-presentation-4x3"},{dimensions:"1920px x 1080px",title:"Presentation (16:9)",image:"social-presentation-16x9"},{dimensions:"1080px x 1920px",title:"Social Media Story",image:"social-social-media-story"},{dimensions:"1080px x 1080px",title:"Instagram Post",image:"social-social-media-post"},{dimensions:"1200px x 1200px",title:"Facebook Post",image:"social-social-media-post"},{dimensions:"1702px x 630px",title:"Facebook Cover",image:"social-facebook-cover"},{dimensions:"1640px x 624px",title:"Facebook Page Cover",image:"social-facebook-page-cover"},{dimensions:"1920px x 1080px",title:"Facebook Event Cover",image:"social-facebook-event-cover"},{dimensions:"2560px x 1440px",title:"YouTube Channel Art",image:"social-youtube-channel-art"},{dimensions:"1280px x 720px",title:"YouTube Thumbnail",image:"social-youtube-thumbnail"},{dimensions:"1200px x 675px",title:"Twitter Post",image:"social-twittter-post"},{dimensions:"1500px x 500px",title:"Twitter Header",image:"social-twitter-header"},{dimensions:"1000px x 1500px",title:"Pinterest Pin ",image:"social-pinterest-pin"},{dimensions:"3360px x 840px",title:"Etsy Big Banner",image:"social-etsy-big-banner"},{dimensions:"3360px x 448px",title:"Etsy Mini Banner",image:"social-etsy-mini-banner"},{dimensions:"760px x 100px",title:"Etsy Order Receipt Banner",image:"social-etsy-receipt-banner"}],print:[{dimensions:"3300px x 3300px",title:"Square",image:"print-square"},{dimensions:"1050px x 600px",title:"Business Card",image:"print-business-card"},{dimensions:"1500px x 900px",title:"Thank You Card",image:"print-thank-you-card"},{dimensions:"1800px x 1200px",title:"Postcard",image:"print-postcard"},{dimensions:"2100px x 1500px",title:"Greeting Card",image:"print-greeting-card"},{dimensions:"1650px x 2550px",title:"Half Letter",image:"print-half-letter"},{dimensions:"1200px x 2700px",title:"Rack Card",image:"print-rack-card"},{dimensions:"2550px x 3300px",title:"Letter",image:"print-letter"},{dimensions:"2481px x 3507px",title:"A4",image:"print-a4"},{dimensions:"2640px x 4080px",title:"Poster",image:"print-poster"}],ad:[{dimensions:"1200px x 628px",title:"Facebook Ad",image:"ad-facebook"},{dimensions:"120px x 600px",title:"Skyscraper",image:"ad-skyscraper"},{dimensions:"160px x 600px",title:"Wide Skyscraper",image:"ad-wide-skyscraper"},{dimensions:"728px x 90px",title:"Leaderboard",image:"ad-leaderboard"},{dimensions:"728px x 210px",title:"Large Leaderboard",image:"ad-large-leaderboard"},{dimensions:"300px x 250px",title:"Medium Rectangle",image:"ad-medium-rectangle"},{dimensions:"336px x 280px",title:"Large Rectangle",image:"ad-large-rectangle"},{dimensions:"300px x 600px",title:"Half Page",image:"ad-half-page"},{dimensions:"320px x 100px",title:"Large Mobile",image:"ad-large-mobile"}]},r=Pf(Sf()),a=["social","print","ad"].map(function(t){return function(t){return Pf(If(),"image-gallery blank-canvas__gallery blank-canvas__gallery--".concat(t),180,e,function(e){var n=i[t][e.imageIndex],r=n.dimensions,a=n.title,o=BFN.DesignerTemplateManager.parseDimensions(r),s=o.width,l=o.height;u(s,l,a)},function(e){var n=i[t][e.imageIndex],r=n.dimensions,a=n.title,o=BFN.DesignerTemplateManager.parseDimensions(r),s=o.pixelSize,l=o.printSize;return Bf(_f(),a,l||s)},8,8,function(e){return i[e].map(function(e,t){var n=new BFN.MenuImageVO;return n.createId("designer_template",e.image),n.thumbURL="".concat(BFN.imagesURL,"app/blank-templates-v2/").concat(e.image,".svg"),n.isSVG=!0,n.isGraphic=!0,n.imageIndex=t,n})}(t))}(t)});t=Pf(xf()),n=Pf(yf()),BFN.UI.scrubber(t),BFN.UI.scrubber(n),t.unit=n.unit="px",t.minValue=n.minValue=BFN.minImageSize,t.maxValue=n.maxValue=BFN.maxImageSize,t.currentValue=BFN.DesignerModel.projectVO.projectWidth||300,n.currentValue=BFN.DesignerModel.projectVO.projectHeight||300;var o=function(){return Ff(Bf(bf(),Ef("create_your_own_canvas","modal"),Ef("width","modal"),t,s,kf("switch-icon","icon icon--18"),Ef("height","modal"),n,l,Ef("create","modal"),"--scrollable-content-width: ".concat(e),["social_media","print","online_advertising"].map(function(e,t){return Bf(Tf(),Ef(e,"modal"),a[t])})),r)};return o(),BeFunky.LanguageManager.addLanguageUpdateListener(o),r.updateScrubberDimensions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;t.currentValue=e,n.currentValue=i},r.blankCanvasGalleries=a,r;function s(){var e=n.currentValue,i=t.currentValue;t.currentValue=e,n.currentValue=i}function l(){u(t.currentValue,n.currentValue)}function u(e,t,n){var i,r=new BFN.ProjectVO;if(r.version=2,r.section="designer",r.projectWidth=e,r.projectHeight=t,r.designerBackgroundColor="FFFFFF",n){r.sourceTemplateID="blank_".concat((i=n,i.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/(^_+)|(_+$)/g,"")),"_").concat(e,"_").concat(t)}BFN.ProjectManager.confirmLoadNewProject({onConfirm:function(){var i=n?{type:"Preset",name:"Blank ".concat(n),id:r.sourceTemplateID}:{type:"Custom",name:"Blank Custom"};BFN.ProjectManager.loadProject(r,!0,i),BeFunky.closeModal("template_library");var a="".concat(e," x ").concat(t).toUpperCase().replace(/ /g,"_").replace("_X_","x");BFN.BfnService.track("CREATE","DESIGNER_TEMPLATE","CUSTOM_".concat(a))},projectSection:"designer",getNewProjectThumbnail:function(){return Promise.resolve({aspectRatio:e/t})}})}}function Mf(){var e=g(['<div class="template-library__tags"></div>']);return Mf=function(){return e},e}function Df(){var e=g(['<div class="template-library__search-autocomplete"></div>']);return Df=function(){return e},e}function wf(){var e=g(['<input type="search" id="template_library_search" class="input template-library__search-input search-box__input" required>']);return wf=function(){return e},e}function Lf(){var e=g(['<div class="badge badge--plus gallery__badge"></div>']);return Lf=function(){return e},e}function Of(){var e=g(['<image-gallery\n            class="gallery template-library__results-gallery"\n            .images=',"\n            .message=","\n            .emptyState=","\n            .isLoading=","\n            .onSelectItem=","\n            .rowHeight=","\n            .gutterWidth=","\n            .currentWidth=","\n            .viewport=","\n            .debug=","\n            .extendItemTemplate=","\n            .borderWidth=","\n        ></image-gallery>"]);return Of=function(){return e},e}function Rf(){var e=g(['\n        <div class="template-library__right-panel">\n            ','\n            <div class="scrollable-content scrollable-content--modal-right-panel" style=',">\n            ","\n            </div>\n        </div>"]);return Rf=function(){return e},e}function Af(){var e=g(['\n            <button class="button button--circle button--white-outline button--icon button--xs template-library__clear-results" @click="','" data-tooltip="cancel">\n                ',"\n            </button>\n        "]);return Af=function(){return e},e}function Vf(){var e=g(['\n            <div class="template-library__results-header template-library__results-header--left">\n                <h3 class="template-library__results-heading text-lg">',"</h3>\n                ","\n            </div>\n        "]);return Vf=function(){return e},e}function Uf(){var e=g(['\n        <div class="template-library__left-panel">\n            <form role="search" class="search-box template-library__search-box" @submit=',">\n                ","\n                ",'\n                <button type="reset" class="button button--icon button--md button--white-outline search-box__clear">\n                    ','\n                </button>\n                <button type="submit" class="button button--icon button--md button--white-outline search-box__submit">\n                    ','\n                </button>\n            </form>\n            <div class="template-library__buttons">\n                <button\n                    class="','"\n                    @click="','"\n                    >','\n                </button>\n                <button\n                    class="','"\n                    id="designer_view_all_templates"\n                    @click="','"\n                    >',"\n                </button>\n            </div>\n            ","\n        </div>\n        ","\n        "]);return Uf=function(){return e},e}function Gf(){var e=g(['\n            <div class="template-library__tabs">\n                <toggle-group id="template-library-view" .buttons=',' .value="','" @change="','"></toggle-group>\n                <div class="template-library__popover-placeholder"></div>\n            </div>\n        ']);return Gf=function(){return e},e}function Hf(){var e=g(['<panel-header lang-id="start_a_design" modifier="modal" buttons="close"></panel-header>']);return Hf=function(){return e},e}function zf(){var e=g(["\n            ","\n            ",'\n            <div class="modal__body template-library__body">\n                ',"\n            </div>\n        "]);return zf=function(){return e},e}function jf(){var e=g(['<div id="template_library" class="modal modal--button-sm template-library"></div>']);return jf=function(){return e},e}var Xf=BeFunky.lit,Wf=Xf.html,Yf=Xf.setupState,qf=Xf.render,Kf=Xf.lang,Qf=Xf.elem,Zf=Xf.icon;function Jf(e){var t=Qf(jf()),n=[],i=1600,r=i-272-48,a={viewBlankCanvas:!1,mode:"EDITORS_CHOICE",lastSearchTerm:"",lastSearchPage:-1,searchTerm:"",tagID:"editors_choice",tagName:"",editorsChoiceTemplates:[],targetAspectRatio:6,currentWidth:i,images:[],isLoading:!1,message:null,emptyState:null,viewport:void 0},o=!0,s=BeFunky.debounce(function(){var e,n,r;qf(Wf(zf(),b,Wf(Gf(),[{value:!1,langID:"templates"},{value:!0,langID:"blank_canvas"}],c.viewBlankCanvas,function(e){return h({viewBlankCanvas:e.target.value})}),c.viewBlankCanvas?(g=g||Nf(i-80),C=!1,g.blankCanvasGalleries.forEach(function(e){e.currentWidth=c.currentWidth-272-48}),g):Wf(Uf(),N,I,T,Zf("cancel-icon","icon icon--12"),Zf("search-icon","icon"),"button button--grey-200 button--fullwidth template-library__button ".concat("EDITORS_CHOICE"===c.mode?"button--selected":""),E,Kf("editors_choice","modal"),"button button--grey-200 button--fullwidth template-library__button ".concat("ALL_TEMPLATES"===c.mode?"button--selected":""),k,Kf("browse_all_templates","modal"),S,(r=c.currentWidth-272-48,Wf(Rf(),(e={EDITORS_CHOICE:"editors_choice",SEARCH:["search_results_for",{query:"<strong>".concat(BeFunky.escapeHTML(c.tagName),"</strong>")}],ALL_TEMPLATES:"all_templates",TAG:BeFunky.escapeHTML(c.tagName)},n="SEARCH"===c.mode,e[c.mode]||BeFunky.throwError("Mode not handled!!!",c.mode),Wf(Vf(),Kf(e[c.mode],"modal"),n?Wf(Af(),E,Zf("cancel-icon","icon icon--10")):"")),"--scrollable-content-width: ".concat(r,"px"),"EDITORS_CHOICE"===c.mode?vf(c.editorsChoiceTemplates,F,0,c.targetAspectRatio,r):function(e){return Wf(Of(),c.images,c.message,c.emptyState,c.isLoading,M,215,8,e,c.viewport,!1,B,1)}(r))))),t),function(e){e&&(requestAnimationFrame(function(){BeFunky.isAndroid||c.viewBlankCanvas||"EDITORS_CHOICE"!==c.mode||(I.focus(),T.hide())}),BFN.HelpClueManager.show("template_library",{renderOptions:{positionFactor:.155,side:"top",zIndex:"1",container:function(){return document.querySelector(".template-library__popover-placeholder")}}}));C||c.viewBlankCanvas||(C=BeFunky.listenForScroll(t.querySelector(".scrollable-content--modal-right-panel"),D).recalculateScrollPosition)}(o),o=!1},"raf"),l=Yf(a,function(e){e.tagID&&n.forEach(function(e){var t=f(e,3),n=t[0],i=t[1],r=t[2],a=n===c.tagID;r.toggleClass("button--selected",a),a&&!S.activeSections.includes(i)&&(S.activeSections=[].concat(v(S.activeSections),[i]))}),s()}),u=f(l,2),c=u[0],h=u[1];BeFunky.LanguageManager.addLanguageUpdateListener(s),P();var d,m,p,g,y,x=function(){var t,n=e.map(function(e){return{id:e,label:w(e)}}),i=/(^holiday|holiday$|cards?$)/;(t=[]).concat.apply(t,v(e.map(function(e){if(e.includes("_and_"))return!1;var t=e.match(i);return!!t&&[e,t[0]]}).filter(Boolean).map(function(e){var t=f(e,2),n=t[0],i=t[1];return[i,n.replace(i,"").replace(/(^_|_$)/g,"")]}))).unique().filter(function(t){return!e.includes(t)}).forEach(function(e){n.push({id:e,label:w(e)})}),n.sort(function(e,t){var n=e.id.length-t.id.length;return n>0?1:n<0?-1:e.id.charAt(0)<t.id.charAt(0)?-1:1});var r=/^id=([a-z0-9_.]+)$/,a=Qf(wf());a.setLang("search_templates","modal");var o=Qf(Df());return BFN.UI.autocomplete(o,{inputElement:a,minValueLength:3,options:n,generateItem:function(e){var t=e.trim().match(r);return t?{html:"Template ID = ".concat(t[1]),index:0}:{html:BeFunky.LanguageManager.getStringReplacements("search_for",{query:BeFunky.escapeHTML(e)},"modal"),index:0}},onSelect:function(e){F({tagID:e.id,tagName:e.label})}}),[a,o]}(),_=f(x,2),I=_[0],T=_[1],b=Qf(Hf()),S=(d=Qf(Mf()),m=function(e,t,n){return'<button class="button button--grey-200 button--fullwidth template-library__tag" data-tag="'.concat(e,'" data-section="').concat(n,'">\n            ').concat(w(t),"\n        </button>")},p=function(e,t){return t.map(function(t){return Array.isArray(t)?m.apply(void 0,v(t).concat([e])):m(t,t,e)}).join("")},BFN.UI.accordionLayout(d,{sections:{social_media:{isOpen:!1,content:p("social_media",[["social_media","all_social_media"],"instagram_posts","instagram_stories","facebook_covers","facebook_page_covers","facebook_event_covers","facebook_stories","facebook_posts","twitter_headers","twitter_posts","youtube_thumbnails","youtube_channel_art","pinterest_graphics","etsy_big_banners","etsy_mini_banners","etsy_order_receipt_banners","blog_images"])},business_marketing:{isOpen:!1,content:p("business_marketing",[["business_marketing","all_business_marketing"],"business_cards","posters","flyers","brochures","postcards","letterhead","menus"])},online_advertising:{isOpen:!1,content:p("online_advertising",[["online_advertising","all_online_advertising"],"facebook_ads","skyscrapers","leaderboards","medium_rectangles","large_rectangles","half_pages","large_mobile"])},events_and_cards:{isOpen:!1,content:p("events_and_cards",[["events_and_cards","all_events_and_cards"],["invitations","all_invitations"],["greeting_cards","all_cards"],"birthdays","wedding_sets","valentines_day","mothers_day","winter_holiday"])}}}),(n=v(d.querySelectorAll(".template-library__tag")).map(function(e){return[e.getAttribute("data-tag"),e.getAttribute("data-section"),e]})).forEach(function(e){var t=f(e,3),n=t[0];t[1],t[2].addEventListener("click",function(){F({tagID:n})})}),d),C=!1;return Object.assign(t,{open:function(e){if(!window.isAppOpen)return void BeFunky.logError("Not opening template library on site");BeFunky.openModal(t,{onOpen:function(){e||o&&(e="editors_choice");var t="blank_canvas"===e;h({viewBlankCanvas:t}),e&&!t&&F({tagID:e})},onWindowResize:function(e){var t=e.availableWidth,n=r+(t-i),a=6*n/r;h({currentWidth:t,targetAspectRatio:a}),"function"==typeof C&&C()},size:"xxl",closeOnEscape:function(){var e=document.activeElement;return"template_library_search"===e.id?(e.value?e.value="":e.blur(),!1):!I.contains(e)||(e.value="",e.focus(),!1)}})}}),t;function B(e){return!e.isPlus||BeFunky.isPlus()?"":Wf(Lf())}function F(t){var n=t.tagID,i=void 0===n?"":n,r=t.tagName,a=void 0===r?"":r,o=t.page,s=void 0===o?1:o,l=t.fetchAllTags,u=void 0!==l&&l;if(i||(i=function(e){return e.trim().replace(/[^a-z0-9\s]/gi,"").split(/\s+/).map(function(e){return e.toLowerCase()}).join("_").replace(/_+/g,"_")}(a)),i=e.includes(i)?i:"",a=w(i)||a,!i&&!a)throw new Error("Invalid tag name or ID");if("editors_choice"===i)return E();var d=i||a;if(!(d===c.lastSearchTerm&&s===c.lastSearchPage||d.length<=2)){y=void 0;var m=d.match(/^id=([a-z0-9_.]+)$/),p=m?m[1]:void 0,g="SEARCH";i&&(g="TAG"),u&&(g="ALL_TEMPLATES"),h({mode:g,tagName:a,tagID:i,searchTerm:d,lastSearchTerm:d,lastSearchPage:s,images:1===s?[]:c.images,message:null,isLoading:!0}),I.value=u?"":a;var f=1===s&&!p,x=function(){return d!==c.lastSearchTerm||s!==c.lastSearchPage};(p?BFN.DesignerTemplateService.getTemplate(p).then(function(e){return[e]}):BFN.DesignerTemplateService.getTemplates(d,s,100,u)).then(function(e){if(!x()){var t=BFN.DesignerTemplateService.templateObjectsToMenuImageVOs(e),n=s;h({isLoading:!1,images:[].concat(v(c.images),v(t))}),"function"==typeof C&&C(),f&&BFN.BfnService.track("TEMPLATES","SEARCH",d);t.length>=100&&(y=function(){console.log("Load next page of results",i,n+1),F({tagID:i,tagName:a,page:++n,fetchAllTags:u})})}},function(e){x()||(BeFunky.logError("Unable to fetch templates",e),"no_results"===e?(h({isLoading:!1,emptyState:{imageUrl:"".concat(BFN.imagesURL,"app/illustrations/no-search-results-canvas.svg"),text:["no_results_for",{query:'"<strong>'.concat(BeFunky.escapeHTML(c.searchTerm),'</strong>"')}]}}),f&&BFN.BfnService.track("TEMPLATES","EMPTY_SEARCH",d)):h({isLoading:!1,message:{isError:!0,text:BeFunky.failureReason(e),buttonText:"try_again",buttonAction:function(){return F({tagID:i,tagName:a,fetchAllTags:u})}},lastSearchTerm:""}))})}}function E(){h({mode:"EDITORS_CHOICE",tagID:"editors_choice",lastSearchTerm:""}),I.value="",c.editorsChoiceTemplates.length||P()}function P(){BFN.DesignerTemplateService.getEditorsChoiceTemplates().then(function(e){var t=e.map(function(e){var t=e.tag,n=e.items;return{tagID:t,title:e.title,templateData:BFN.DesignerTemplateService.templateObjectsToMenuImageVOs(n)}});h({editorsChoiceTemplates:t})})}function k(){F({tagID:"",tagName:BeFunky.LanguageManager.getString("all_templates","modal"),fetchAllTags:!0})}function N(e){e&&e.preventDefault();var t=I.value.replace(/[`~!@#$%^&*()_|+=?;:'",.<>{}[\]\\/]/gi," ").replace(/ {2,}/g," ").trim();t.length<3||F({tagName:t})}function M(e,t,n){var i,r,a,o=e.id.replace("designer_template_",""),s=e.version,l=e.dimensions,u=e.displayName,h=e.imageURL,d=e.imageWidth,m=e.imageHeight,p=e.isPlus,g=e.lastRenderedThumb,f=c.images.findIndex(function(t){return t.id===e.id}),v=x(c.images,f,-1),y=x(c.images,f,1);return BFN.DesignerTemplateManager.openPreviewModal({templateID:o,thumbURL:n||(g?g.url:h),imageURL:h,imageWidth:d,imageHeight:m,isTemplatePlus:p,name:u,dimensions:l,version:s,trackSearchTerm:(i=BFN.DeepLinkManager.getDesignerDeepLinkData(),r=i.deepLinkTagID,a=i.deepLinkTemplateRoute,"TAG"===c.mode&&c.tagID===r&&a?a:c.lastSearchTerm),prevImageURL:v&&v.imageURL,nextImageURL:y&&y.imageURL,onPrev:v?function(){M(v)}:void 0,onNext:y?function(){M(y)}:void 0}),!1;function x(e,t,n){for(;e[t+n];){var i=e[t+n];if(!i.isBlank)return i;t+=n}}}function D(e){var t=e.scrollHeight,n=e.offsetHeight,i=e.scrollTop;if(c.images.length&&(h({viewport:[i,i+n]}),y)){t-n-i<=800&&y()}}function w(e){return e.split("_").map(function(e,t){if(0===t||e.length>2&&"the"!==e||"my"===e)return e.charAt(0).toUpperCase()+e.slice(1);return e}).join(" ").replace("s Day","'s Day").replace("St ","St. ").replace("Youtube","YouTube")}}var $f=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues(),this.initCustomTemplate()}},{key:"initDefaultValues",value:function(){var e=this;this.isDataLoaded=!1,this.loadedTemplateCategories=[],this.selectedTemplateButton=null,document.addEventListener("keyup",this.handleKeyUp),document.getElementById("designer_search_templates").addEventListener("click",function(){return e.openModal()})}},{key:"initCustomTemplate",value:function(){var e=this,t=document.getElementById("resize_template_modal");document.getElementById("designer_create_custom_template").addEventListener("click",function(){e.openModal("blank_canvas")}),document.getElementById("designer_resize_template").addEventListener("click",function(){t.open||BFN.UI.resizeTemplateModal(t),t.open()})}},{key:"handleOpen",value:function(){var e=UITools.getToolValue("designer_open","updating_id");"blank_canvas"===e?this.openModal("blank_canvas"):"template"===e&&this.openModal()}},{key:"preloadTags",value:function(){var e=BFN.DesignerTemplateService.tags;Array.isArray(e)&&e.length||BFN.DesignerTemplateService.getTags().catch(function(e){"request_failed"!==e&&BeFunky.throwError("Unable to preload tags")})}},{key:"setupRecentProjects",value:function(){this.recentProjectsComponent||(this.recentProjectsComponent=Kg(),document.getElementById("designer_templates_menu").appendChild(this.recentProjectsComponent))}},{key:"openPreviewModal",value:function(e){this.previewModalComponent||(this.previewModalComponent=lf()),this.previewModalComponent.setState(e),this.previewModalComponent.open()}},{key:"getTemplateImages",value:function(e){var t=e.id,n=e.dimensions,i=e.version,r=e.isRetina,a=this.parseDimensions(n);if(!a)return BeFunky.throwError("Template ".concat(t," has invalid dimensions string")),{};var o,s,l,u=a.width,c=a.height,h=r?1.75:1,d=300*h,m=Math.max(200,Math.min(d,c)),p=u*(m/c),g=I(t,{height:m,version:i}),v=Math.round(600*h),y=Math.round(600*h),x=u/v,_=c/y;if(x<=1&&_<=1){u<480&&c<480?u>c?(o=480,s=Math.floor(c*(480/u))):(o=Math.floor(480*u/c),s=480):(o=u,s=c),l=I(t,{width:o,version:i})}else x>_?(o=v,s=Math.floor(c/x),l=I(t,{width:v,version:i})):(o=Math.floor(u/_),s=y,l=I(t,{height:y,version:i}));return{thumbWidth:p,thumbHeight:m,thumbURL:g,imageWidth:o,imageHeight:s,imageURL:l,getImageURL:function(e){return function(e,t){var n="".concat(BFN.designerTemplatePreviewsUrl).concat(e,"_preview.jpg"),r={auto:"webp",width:(a=t,20*Math.ceil(a/20))};var a;"number"==typeof i&&(r.nocache=i);return BeFunky.addParamsToURL(n,r)}(t,e*(BeFunky.isRetina()?1.75:1))}};function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(BFN.designerTemplatePreviewsUrl).concat(e,"_preview.jpg");t.auto="webp","number"==typeof t.version&&(t.nocache=t.version,delete t.version);var i=Object.entries(t).map(function(e){var t=f(e,2),n=t[0],i=t[1];return"".concat(n,"=").concat(encodeURIComponent(i))}).join("&");return"".concat(n,"?").concat(i)}}},{key:"openModal",value:function(e){var t=this;if(this.modal)return this.modal.open(e);BFN.DesignerTemplateService.getTags().then(function(n){t.modal||(t.modal=Jf(n)),t.modal.open(e)},function(e){return BeFunky.logError("Unable to fetch tags before opening Designer Template Search modal",e)})}},{key:"applyTemplate",value:function(e){var t=this,n=e.id,i=e.version,r=e.isPlusTemplate,a=e.name,o=void 0===a?"BeFunky-project":a,s=e.trackingData,l=void 0===s?null:s,u="".concat(BFN.designerSourceTemplateURL).concat(n,".bfd");"number"==typeof i&&(u+="?nocache=".concat(i)),BFN.SavedProjectService.fetchBFD(u).then(function(e){return BFN.ParseBFD.objectToProjectVO(e).then(function(e){if(e.sourceTemplateID=n,e.filename=o,e.isPlusTemplate=r,!e.printDPI){var i=t.parseDimensions([e.projectWidth,e.projectHeight]);e.printDPI=i?i.dpi:300}BFN.ProjectManager.loadProject(e,!0,l)})}).catch(function(e){BeFunky.logError(e),BeFunky.hideLoadScreen()})}},{key:"loadTemplateForTesting",value:function(e){var t=this;console.log("Testing > Designer template:",e),BFN.DesignerTemplateService.getTemplate(e).then(function(n){var i=n.version;t.applyTemplate({id:e,version:i})})}},{key:"openDeepLinkTemplatePreview",value:function(e,t){var n=this;BFN.AppModel.viewingDesigner||BeFunky.throwError("Template preview requested while not in Designer"),BFN.DesignerTemplateService.getTemplate(e).then(function(i){var r=BFN.DesignerTemplateService.templateObjectsToMenuImageVOs([i])[0],a=r.displayName,o=r.dimensions,s=r.isPlus,l=r.version,u=r.imageURL,c=r.imageWidth,h=r.imageHeight;n.openPreviewModal({templateID:e,imageURL:u,imageWidth:c,imageHeight:h,isTemplatePlus:s,name:a,dimensions:o,version:l,trackSearchTerm:"Deep Link: ".concat(t)})},function(t){return BeFunky.throwError("Unable to get template ".concat(e," by ID"),t)})}},{key:"parseDimensions",value:function(e){var t,n;if("string"==typeof e){var i=e.match(/(\d+)px x (\d+)px/);if(!i)return!1;var r=f(i.map(function(e){return parseInt(e)}),3);t=r[1],n=r[2]}else if(Array.isArray(e)){var a=f(e,2);t=a[0],n=a[1]}if(![t,n].every(function(e){return e&&"number"==typeof e}))return!1;var o={"3300,3300":{size:'11 × 11"',name:"Square"},"1050,600":{size:'3.5 × 2"',name:"Business Card"},"1500,900":{size:'5 × 3"',name:"Thank You Card"},"1800,1200":{size:'6 × 4"',name:"Postcard"},"1500,2100":{size:'5 × 7"',name:"Greeting Card"},"2100,1500":{size:'7 × 5"',name:"Greeting Card"},"1650,1260":{size:'5.5 × 4.2"',name:"Postcard"},"1650,2550":{size:'5.5 × 8.5"',name:"Half Letter"},"1200,2700":{size:'4 × 9"',name:"Rack Card"},"2550,3300":{size:'8.5 × 11"',name:"Letter"},"3300,2550":{size:'11 × 8.5"',name:"Letter"},"2481,3507":{size:"21 × 29.7cm",name:"A4"},"2640,4080":{size:'11 × 17"',name:"Poster",dpi:240}}["".concat(t,",").concat(n)]||{};return{width:t,height:n,pixelSize:"".concat(t," × ").concat(n,"px"),printSize:o.size,printName:o.name,storedSize:"".concat(t,"px x ").concat(n,"px"),dpi:o.dpi||300}}},{key:"handleKeyUp",value:function(e){function t(e){e&&BeFunky.logError(e)}BFN.AppModel.viewingDesigner&&69===e.which&&e.ctrlKey&&e.shiftKey&&BFN.ProjectManager.requestLocalSave({isLazy:!1}).then(function(){return BFN.ProjectService.getLocalProject("designer")}).then(function(e){e.filename=e.sourceTemplateID||"unknown_template",BFN.UploadSaveShareManager.saveProjectToComputer(e,t)}).catch(t)}}]),e}();BFN.SingletonQueue.add(function(){BFN.DesignerTemplateManager=new $f});var ev=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){var e;this.initDefaultValues(),this.initDragDropAreaIllustrations(),("draggable"in(e=document.createElement("div"))||"ondragstart"in e&&"ondrop"in e)&&window.addEventListener("INIT_COMPLETE",this.initDragDropAreas.bind(this))}},{key:"initDefaultValues",value:function(){this.fontExtensions=["dfont","eot","otc","otf","svg","ttc","ttf","woff","woff2"]}},{key:"initDragDropAreaIllustrations",value:function(){var e=document.getElementById("canvas_drag_drop_area"),t=document.createElement("img");t.src="".concat(BFN.imagesURL,"app/illustrations/drop-project-images.svg"),e.prepend(t);var n=document.getElementById("image_manager_drag_drop_area"),i=document.createElement("img");i.src="".concat(BFN.imagesURL,"app/illustrations/drop-images-sidebar.svg"),n.prepend(i);var r=document.getElementById("batch_processing_drag_drop_area"),a=document.createElement("img");a.src="".concat(BFN.imagesURL,"app/illustrations/drop-images-canvas.svg"),r.prepend(a)}},{key:"initDragDropAreas",value:function(){var e=this;["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){return BFN.appContainer.addEventListener(e,function(e){e.target.draggable||(e.preventDefault(),e.stopPropagation())})}),this.dragDropAreas=[{visibleElem:document.getElementById("canvas_drag_drop_area"),listeningElem:BFN.Stage.view,isActive:!1,handler:this.handleCanvasDrop.bind(this)},{visibleElem:document.getElementById("image_manager_drag_drop_area"),listeningElem:document.getElementById("editor_image_manager_menu"),isActive:!1,handler:this.handleImageManagerDrop.bind(this)},{visibleElem:document.getElementById("batch_processing_drag_drop_area"),listeningElem:document.getElementById("batch_processing_images_scroll_container"),isActive:!1,handler:this.handleBatchProcessingDrop.bind(this)},{visibleElem:document.getElementById("watermark_upload_drop_area"),listeningElem:document.getElementById("watermark_upload"),isActive:!1,handler:this.handleWatermarkUploadDrop.bind(this)}];var t=function(t){if(!BFN.isSortableListDragActive){var n=e.dragDropAreas.find(function(e){return!e.isActive&&e.listeningElem.contains(t.target)});if(n){n.isActive=!0;var i=n.activeClass||"drag-drop-area--active";n.listeningElem.addClass("drag-drop-listener"),"canvas_drag_drop_area"===n.visibleElem.id?(document.getElementById("appViewport").addClass("show-drag-drop-area--dragging"),BeFunky.wait(["raf","raf"],function(){n.isActive&&(n.visibleElem.addClass(i),BFN.TransformGuides.visible&&n.visibleElem.addClass("drag-drop-area--canvas-guides"))})):n.visibleElem.addClass(i)}}},n=function(t){if(!BFN.isSortableListDragActive){var n=e.dragDropAreas.find(function(e){return e.isActive&&t.target===e.listeningElem});if(n){n.isActive=!1;var i=n.activeClass||"drag-drop-area--active";n.visibleElem.removeClass(i),n.listeningElem.removeClass("drag-drop-listener"),"canvas_drag_drop_area"===n.visibleElem.id&&setTimeout(function(){n.isActive||(document.getElementById("appViewport").removeClass("show-drag-drop-area--dragging"),n.visibleElem.removeClass("drag-drop-area--canvas-guides"))},300)}}};BFN.appContainer.addEventListener("dragenter",t),BFN.appContainer.addEventListener("dragover",t),BFN.appContainer.addEventListener("dragleave",n),BFN.appContainer.addEventListener("dragend",n),BFN.appContainer.addEventListener("drop",n),BFN.appContainer.addEventListener("drop",function(t){var n;try{n=v(t.dataTransfer.files)}catch(e){BeFunky.throwError(e,{event:t})}if(n&&n.length){n.forEach(function(e){e.extension=BFN.getExtension(e.name)});var i=e.dragDropAreas.find(function(e){return e.listeningElem===t.target});i&&i.handler(n,t)}})}},{key:"handleCanvasDrop",value:function(e,t){var n=this;if(BFN.TransformModel.selectedTransformItem){var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);i&&i.transformLayer&&i.transformLayer.deselectItem()}var r=e[0];return"bfd"===r.extension?this.handleBFD(r):BFN.MultipleFileUploader.supportedImages.includes(r.extension)?void(BFN.AppModel.viewingEditor?this.handleEditorImage(r):BFN.AppModel.viewingCollage?this.handleCollageImage(r,t):this.handleDesignerImage(r,t)):e.some(function(e){return n.fontExtensions.includes(e.extension)})?BFN.FontManager.handleUserFontFiles(e):BeFunky.logError("Unsupported file type:",r.name)}},{key:"handleImageManagerDrop",value:function(e){var t=e.filter(function(e){return/^image\/+/.test(e.type)});t.length&&this.handleImageManagerImages(t)}},{key:"handleBatchProcessingDrop",value:function(e){var t=e.filter(function(e){return/^image\/+/.test(e.type)&&!e.type.includes("svg")});t.length&&this.handleBatchProcessingImages(t)}},{key:"handleWatermarkUploadDrop",value:function(e){if(e.filter(function(e){return/^image\/+/.test(e.type)&&!e.type.includes("svg")}).length){var t=e[0];this.handleWatermarkImage(t)}}},{key:"handleBFD",value:function(e){var t={files:[e],createMenuImageVO:!1};BFN.MultipleFileUploader.upload(function(e){var t=e.file;t&&BFN.ProjectManager.loadFile(t)},t)}},{key:"handleImageManagerImages",value:function(e){BFN.ImageLibraryManager.uploadImages(function(){},{files:e})}},{key:"handleBatchProcessingImages",value:function(e){BFN.BatchProcessingManager.loadImages(e)}},{key:"handleWatermarkImage",value:function(e){BFN.WatermarkManager.uploadWatermark(e)}},{key:"handleEditorImage",value:function(e){var t=BFN.PhotoEditorModel.onEditorImageUpload.bind(BFN.PhotoEditorModel),n={files:[e],createMenuImageVO:!1};BFN.PhotoEditorModel.confirmEditorLoadImage(function(){return BFN.MultipleFileUploader.upload(t,n)})}},{key:"handleCollageImage",value:function(e,t){var n={files:[e],keepImageTexture:!0},i={initialCenterPosition:BFN.getCanvasCoordinates(t.pageX,t.pageY,BFN.CollageMakerCanvas),hasTexture:!0};BFN.ImageLibraryManager.uploadImages(function(e){var t=e.menuImageVO;t&&(BFN.AppModel.viewingCollage&&!BFN.CollageMakerCanvasPhotoGridModel.freeform&&(BFN.PhotoGrid.awaitingDrop=!0),BFN.ImageLibraryManager.addImageToCanvas(t,i))},n)}},{key:"handleDesignerImage",value:function(e,t){var n={files:[e],keepImageTexture:!0},i={initialCenterPosition:BFN.getCanvasCoordinates(t.pageX,t.pageY,BFN.DesignerCanvas),hasTexture:!0};BFN.ImageLibraryManager.uploadImages(function(e){var t=e.menuImageVO;t&&BFN.ImageLibraryManager.addImageToCanvas(t,i)},n)}}]),e}();BFN.SingletonQueue.add(function(){BFN.DragAndDropManager=new ev});var tv=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){BeFunky.log("SVGManager Init"),this.initDefaultValues(),this.initFabricStaticCanvas()}},{key:"initDefaultValues",value:function(){this.processing=!1,this.shapeObjects=null,this.svgData=null,this.callback=null,this.queuedShapeObjects=null,this.combinedSVGKey=null,this.cachedCombinedSVGs={},this.cachedCombinedShapes={},this.updatingTexture=null,this.updatingShape=null,this.idleCanvasSize=16,this.svgContainer=document.createElement("div"),this.svgContainer.id="svg_measurement",BFN.appContainer.appendChild(this.svgContainer)}},{key:"initFabricStaticCanvas",value:function(){var e=this;setTimeout(function(){e.fabricStaticCanvasElement=document.createElement("canvas"),e.fabricStaticCanvasElement.width=e.idleCanvasSize,e.fabricStaticCanvasElement.height=e.idleCanvasSize,e.debugFabricCanvas=!1,e.debugFabricCanvas&&(e.fabricStaticCanvasElement.setStyles({zIndex:1e11,pointerEvents:"none",background:"rgba(175,175,255,.4)",position:"absolute",left:"320px",top:"55px",display:"block"}),BFN.appContainer.appendChild(e.fabricStaticCanvasElement)),fabric.Object.NUM_FRACTION_DIGITS=10,e.fabricStaticCanvas=new fabric.StaticCanvas(e.fabricStaticCanvasElement,{enableRetinaScaling:!1}),e.fabricStaticCanvas.renderOnAddRemove=!1,e.fabricStaticCanvas.renderAll()},0)}},{key:"sanitizeSVG",value:function(e){if("string"!=typeof e)return"";this.svgContainer.innerHTML=e;var t=this.svgContainer.firstElementChild;if("function"!=typeof t.getBBox)return"";var n=["x","y","width","height","viewBox"].reduce(function(e,n){return e[n]=t.getAttribute(n),e},{});t.removeAttribute("x"),t.removeAttribute("y"),t.removeAttribute("viewBox"),v(t.querySelectorAll("image")).forEach(function(e){e.hasAttribute("xlink:href")&&!e.getAttribute("xlink:href").startsWith("data:")&&(BeFunky.logError("Removed externally-linked image tag in SVG"),e.parentElement.removeChild(e))});var i=0;v(t.querySelectorAll(["altGlyph","circle","ellipse","path","polygon","polyline","rect","text","textPath","tref","tspan"].join(","))).forEach(function(e){if(e.hasAttribute("stroke-width"))i=Math.max(i,parseInt(e.getAttribute("stroke-width"))||0);else{var t=parseInt(getComputedStyle(e).strokeWidth)||0;if(t){i=Math.max(i,t);var n=e.getAttribute("style");n&&n.includes("stroke-width")||e.setAttribute("stroke-width",t)}}});var r=function(e){return Math.round(100*e)/100},a=t.getBBox(),o=a.x,s=a.y,l=a.width,u=a.height;return BeFunky.isFirefox&&o<-1e4&&(BeFunky.logError("Not trusting Firefox getBBox for SVG",{x:o,y:s,width:l,height:u}),o=parseFloat(n.x)||0,s=parseFloat(n.y)||0,l=parseFloat(n.width)||parseFloat(n.viewBox.split(" ")[2]),u=parseFloat(n.height)||parseFloat(n.viewBox.split(" ")[3]),console.log("Using these values instead:",{x:o,y:s,width:l,height:u})),t.setAttribute("viewBox","".concat(r(o-i/2)," ").concat(r(s-i/2)," ").concat(r(l+i)," ").concat(r(u+i))),BeFunky.isFirefox&&(t.setAttribute("width",l),t.setAttribute("height",u)),v(t.querySelectorAll("style")).forEach(function(e){e.textContent||(BeFunky.logError("Removing empty style tag from SVG"),e.parentElement.removeChild(e))}),e=(new XMLSerializer).serializeToString(t),this.svgContainer.innerHTML="",e=e.replace(/>\s+</g,"><")}},{key:"createDataURI",value:function(e){if("string"!=typeof e)return"";var t={whitespace:/\s+/g,urlHexPairs:/%[\dA-F]{2}/g};function n(e){switch(e){case"%20":return" ";case"%3D":return"=";case"%3A":return":";case"%2F":return"/";default:return e.toLowerCase()}}65279===e.charCodeAt(0)&&(e=e.slice(1));var i=e.trim().replace(t.whitespace," ");return"data:image/svg+xml,".concat(encodeURIComponent(i).replace(t.urlHexPairs,n))}},{key:"clearCache",value:function(){for(var e in this.cachedCombinedSVGs)this.cachedCombinedSVGs[e]=null,delete this.cachedCombinedSVGs[e];for(var t in this.cachedCombinedShapes)this.cachedCombinedShapes[t]=null,delete this.cachedCombinedShapes[t]}},{key:"combineSVGs",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.processing)BeFunky.logError("Already Processing - BFN.SVGManager.combineSVGs()");else{if(this.combinedSVGKey=null,e.length){this.combinedSVGKey="";for(var a=0;a<e.length;a++){var o=e[a];this.combinedSVGKey+="".concat(a?"_":"").concat(o.svgID,"_").concat(o.scaleX.toString()).concat(o.scaleY.toString()).concat(o.x.toString()).concat(o.y.toString()).concat(o.rotation.toString()).concat(o.alpha.toString())}}if(this.combinedSVGKey=this.combinedSVGKey?"template_svg_".concat(BeFunky.hash(this.combinedSVGKey).toString(36)):null,this.combinedSVGKey&&this.cachedCombinedSVGs.hasOwnProperty(this.combinedSVGKey))n(this.combinedSVGKey,this.cachedCombinedSVGs[this.combinedSVGKey]);else{this.processing=!0,this.shapeObjects=e,this.svgData=t,this.callback=n,this.makeWhite=i,this.resetCoords=r,this.queuedShapeObjects=[];for(var s=0;s<this.shapeObjects.length;s++)this.queuedShapeObjects.push(this.shapeObjects[s]);this.processShapeObjectQueue()}}}},{key:"processShapeObjectQueue",value:function(){var e=this;if(this.queuedShapeObjects&&this.queuedShapeObjects.length){var t=this.queuedShapeObjects.shift();this.svgData.hasOwnProperty(t.svgID)?(t.svgData=this.svgData[t.svgID],this.getSVGShape(t.svgData,function(n){t.svgShape=n,e.processShapeObjectQueue()})):this.processShapeObjectQueue()}else this.createCombinedSVG()}},{key:"createCombinedSVG",value:function(){for(var e=this,t=[],n={},i=0;i<this.shapeObjects.length;i++){var r=this.shapeObjects[i];if(r.svgID&&r.svgShape){var a=r.svgShape,o="shape_".concat(i+1);a.id=o,a.scaleX=r.scaleX,a.scaleY=r.scaleY,a.left=r.x,a.top=r.y,a.angle=r.rotation*(180/Math.PI),a.opacity=r.alpha,t.push(a),n[o]=a}}this.clearCanvas();var s=null;if(t.length){var l=new fabric.Group(t);this.resetCoords&&(l.left=0,l.top=0);var u=l.left,c=l.width,h=l.top,d=l.height;this.fabricStaticCanvasElement.width=Math.round(u+c),this.fabricStaticCanvasElement.height=Math.round(h+d),this.fabricStaticCanvasElement.setStyles({width:"".concat(this.fabricStaticCanvasElement.width,"px"),height:"".concat(this.fabricStaticCanvasElement.height,"px")}),this.fabricStaticCanvas.width=this.fabricStaticCanvasElement.width,this.fabricStaticCanvas.height=this.fabricStaticCanvasElement.height,this.fabricStaticCanvas.add(l),this.fabricStaticCanvas.renderAll();var m=new DOMParser,p=new XMLSerializer;s=(s=this.fabricStaticCanvas.toSVG({suppressPreamble:!0,width:c,height:d,viewBox:{x:0,y:0,width:c,height:d}},function(t){var i=m.parseFromString('<svg xmlns="http://www.w3.org/2000/svg">'.concat(t,"</svg>"),"image/svg+xml").documentElement.firstElementChild,r=i.getAttribute("id");if(r&&r in n){var a=n[r];if(i.style.opacity=a.opacity,e.makeWhite){i.style.fill="rgb(255,255,255)";for(var o=i.getElementsByTagName("*"),s=0;s<o.length;s++)o[s].style.fill="rgb(255,255,255)"}return p.serializeToString(i).replace('xmlns="http://www.w3.org/2000/svg"',"")}return t})).replace(/\n?<desc>[^>]+>/,"").replace(/\n?<defs>[^>]+>/,""),this.resetCanvas(),t.splice(0),t=null}else this.combinedSVGKey=null;var g=this.callback;this.processing=!1,this.shapeObjects=null,this.svgData=null,this.callback=null,this.queuedShapeObjects=null,this.combinedSVGKey&&!this.cachedCombinedSVGs.hasOwnProperty(this.combinedSVGKey)&&(this.cachedCombinedSVGs[this.combinedSVGKey]=s),g(this.combinedSVGKey)}},{key:"getSVGShape",value:function(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r&&this.cachedCombinedShapes.hasOwnProperty(r)?n(this.cachedCombinedShapes[r]):fabric.loadSVGFromString(t,function(t,o){var s=fabric.util.groupSVGElements(t,o);s.objectCaching=!0,a?s.set({left:0,top:0}).setCoords():s.set({left:Math.max(0,s.left),top:Math.max(0,s.top)}).setCoords(),s.baseScaleX=s.scaleX,s.baseScaleY=s.scaleY,r&&!i.cachedCombinedShapes.hasOwnProperty(r)&&(i.cachedCombinedShapes[r]=s),s.baseBoundingRect=s.getBoundingRect(),s.containsObjectFills=!1;for(var l=[],u=[],c={},h=0;h<t.length;h++){var d=t[h];if(d.fill)if("string"==typeof d.fill&&d.fill.length){var m=new fabric.Color(d.fill).toHex();d.fill="#"+m,l.includes(m)||(l.push(m),u.push(h));var p=u[l.indexOf(m)];c.hasOwnProperty(p)||(c[p]={colorHash:m,colorOpacity:0,objects:[],fillObject:null}),c[p].colorOpacity=Math.max(c[p].colorOpacity,d.opacity),c[p].objects.push(d),d.opacityOriginal=d.opacity}else if("object"===e(d.fill)){s.containsObjectFills=!0;var g=d.fill;l.includes(g)||(l.push(g),u.push(h));var f=u[l.indexOf(g)];c.hasOwnProperty(f)||(c[f]={colorHash:-1,colorOpacity:0,objects:[],fillObject:g}),c[f].colorOpacity=Math.max(c[f].colorOpacity,d.opacity),c[f].objects.push(d),d.opacityOriginal=d.opacity}}s.colorMap=c,n(s)})}},{key:"getTexture",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.colorMap;if(r){var a=function(t){var n=r[t];n.objects&&n.objects.forEach(function(t){var i=n.fillObject?n.fillObject:"#"+n.colorHash;t.fill!==i&&(t.fill=i,e.dirty=!0);var r=n.colorOpacity;t.opacity!==r&&(t.opacity=r,e.dirty=!0)})};for(var o in r)a(o)}if(i&&i.x&&i.y){var s=e.baseBoundingRect.left+e.baseBoundingRect.width,l=e.baseBoundingRect.top+e.baseBoundingRect.height,u=Math.min(1,BFN.maxImageSize/i.x,BFN.maxImageSize/i.y),c=i.x/s*u,h=i.y/l*u,d=c*e.baseScaleX,m=h*e.baseScaleY,p=e.baseBoundingRect.left*c,g=e.baseBoundingRect.top*h;e.scaleX=d,e.scaleY=m,e.left=p,e.top=g}else e.scaleX=e.baseScaleX?e.baseScaleX:1,e.scaleY=e.baseScaleY?e.baseScaleY:1,e.left=e.baseBoundingRect?e.baseBoundingRect.left:0,e.top=e.baseBoundingRect?e.baseBoundingRect.top:0;e.dirty=!0,this.fabricStaticCanvas.add(e),this.fabricStaticCanvas.renderAll(),this.clearCanvas();var f=e.getBoundingRect();this.fabricStaticCanvasElement.width=Math.round(f.left+f.width),this.fabricStaticCanvasElement.height=Math.round(f.top+f.height),this.fabricStaticCanvasElement.setStyles({width:"".concat(this.fabricStaticCanvasElement.width,"px"),height:"".concat(this.fabricStaticCanvasElement.height,"px")}),this.fabricStaticCanvas.width=this.fabricStaticCanvasElement.width,this.fabricStaticCanvas.height=this.fabricStaticCanvasElement.height,this.fabricStaticCanvas.add(e),this.fabricStaticCanvas.renderAll();var v=new PIXI.Texture(new PIXI.BaseTexture(this.fabricStaticCanvasElement));if(v.baseTexture.mipmap=!1,v.baseTexture.fabricShape=e,r)for(var y in v.baseTexture.fabricShapeColorMap={},r){var x=r[y];v.baseTexture.fabricShapeColorMap[y]={colorHash:x.fillObject?-1:x.colorHash,colorHashOriginal:x.fillObject?-1:x.colorHash,colorOpacity:x.colorOpacity,colorOpacityOriginal:x.colorOpacity,objects:x.objects,fillObject:x.fillObject}}return v.baseTexture.drawPeriod=0,BFN.Stage.uploadTextureData(v.baseTexture,function(){t.resetCanvas(),n&&n()}),v}},{key:"textureHasModifiedShapeColors",value:function(e){var t=!1;if(e&&e.baseTexture&&e.baseTexture.fabricShapeColorMap){var n=e.baseTexture.fabricShapeColorMap;if(n)for(var i in n)if(!t){var r=n[i];t=r.colorHash!==r.colorHashOriginal||r.colorOpacity!==r.colorOpacityOriginal}}return t}},{key:"updateTexture",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(this.updatingTexture&&this.updatingTexture==e||(this.clearCanvas(),e.baseTexture.hasOwnProperty("fabricShape")&&(this.updatingTexture=e,this.updatingShape=e.baseTexture.fabricShape,this.updatingShape.dirty=!0,this.fabricStaticCanvas.add(this.updatingShape))),this.updatingTexture&&this.updatingShape){var l=this.updatingTexture.baseTexture.fabricShapeColorMap;if(l){var u=function(e){var t=l[e];t.objects&&t.objects.forEach(function(e){var n;if(n=t.fillObject&&-1===t.colorHashOriginal&&(-1===t.colorHash||s)?t.fillObject:"#"+(s?t.colorHashOriginal:t.colorHash),e.fill!==n&&(e.fill=n,i.updatingShape.dirty=!0),t.colorOpacityOriginal>0){var r=s?e.opacityOriginal:e.opacityOriginal*(t.colorOpacity/t.colorOpacityOriginal);e.opacity!==r&&(e.opacity=r,i.updatingShape.dirty=!0)}})};for(var c in l)u(c)}var h=this.updatingShape.baseBoundingRect.left+this.updatingShape.baseBoundingRect.width,d=this.updatingShape.baseBoundingRect.top+this.updatingShape.baseBoundingRect.height;t=null!=r?r/h:t,n=null!=a?a/d:n;var m=null!=r?r:h*t,p=null!=a?a:d*n,g=Math.min(1,BFN.maxImageSize/m,BFN.maxImageSize/p);n*=g;var f=(t*=g)*this.updatingShape.baseScaleX,v=n*this.updatingShape.baseScaleY,y=this.updatingShape.baseBoundingRect.left*t,x=this.updatingShape.baseBoundingRect.top*n,_=this.updatingShape.dirty;if((_=(_=(_=(_=_||this.updatingShape.scaleX!==f)||this.updatingShape.scaleY!==v)||this.updatingShape.left!==y)||this.updatingShape.top!==x)||s){var I=performance.now();this.updatingShape.scaleX=f,this.updatingShape.scaleY=v,this.updatingShape.left=y,this.updatingShape.top=x,this.fabricStaticCanvasElement.width=Math.round(h*t),this.fabricStaticCanvasElement.height=Math.round(d*n),this.fabricStaticCanvasElement.setStyles({width:"".concat(this.fabricStaticCanvasElement.width,"px"),height:"".concat(this.fabricStaticCanvasElement.height,"px")}),this.fabricStaticCanvas.width=this.fabricStaticCanvasElement.width,this.fabricStaticCanvas.height=this.fabricStaticCanvasElement.height,this.fabricStaticCanvas.renderAll(),e.update(),o&&!this.debugFabricCanvas&&this.resetCanvas(),e.baseTexture.drawPeriod=Math.ceil(performance.now()-I)}return{x:t,y:n}}return{x:1,y:1}}},{key:"clearCanvas",value:function(){for(var e=this.fabricStaticCanvas.getObjects(),t=0;t<e.length;t++)this.fabricStaticCanvas.remove(e[t]);this.fabricStaticCanvas.clear(),this.updatingTexture=null,this.updatingShape=null}},{key:"resetCanvas",value:function(){this.clearCanvas(),this.fabricStaticCanvasElement.width=this.idleCanvasSize,this.fabricStaticCanvasElement.height=this.idleCanvasSize,this.fabricStaticCanvasElement.setStyles({width:"".concat(this.idleCanvasSize,"px"),height:"".concat(this.idleCanvasSize,"px")}),this.fabricStaticCanvas.width=this.idleCanvasSize,this.fabricStaticCanvas.height=this.idleCanvasSize}}]),t}();function nv(){var e=g(["<li>"," → ","</li>"]);return nv=function(){return e},e}function iv(){var e=g(["\n                <div>\n                    <p>","</p>\n                    <ul >\n                        ",'\n                    </ul>\n                    <a href="https://support.befunky.com/hc/en-us/articles/360033317211" target="_blank" rel="noopener">',"</a>\n                </div>\n            "]);return iv=function(){return e},e}function rv(){var e=g(['<div class="side-by-side__image-box">\n                    ','\n                    <string style="margin-top: 0.5rem">',"</string>\n                </div>"]);return rv=function(){return e},e}function av(){var e=g(['<div class="side-by-side__image-box">\n                    <div style=',">\n                        <div style=","></div>\n                    </div>\n                </div>"]);return av=function(){return e},e}function ov(){var e=g(['<div class="side-by-side__image-box" style=',"></div>"]);return ov=function(){return e},e}function sv(){var e=g(['\n                <div>\n                    <div class="side-by-side">\n                        <div class="side-by-side__column">\n                            <h3 class="side-by-side__heading">',"</h3>\n                            ","\n                        </div>\n                        ",'\n                        <div class="side-by-side__column">\n                            <h3 class="side-by-side__heading">',"</h3>\n                            ","\n                        </div>\n                    </div>\n                    <p>","</p>\n                </div>"]);return sv=function(){return e},e}function lv(){var e=g(['<div id="project_bounds"></div>']);return lv=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.SVGManager=new tv});var uv=BeFunky.lit,cv=uv.elem,hv=uv.html,dv=uv.icon,mv=uv.appLang,pv=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){BeFunky.log("ProjectManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.projectLoading=!1,this.resolveProjectLoading=function(){},this.rejectProjectLoading=function(){},this.transformItemsPending=!1,this.transformItemsPending=!1,this.queuedProjectVO=null,this.queuedProjectItemVOs=null,this.sourceTemplateLoading=!1,this.trackingData=null,this.savedCanvasThumbs={},this.projectImageBaseTextures={},this.handleEditorImageLoadCompleteBind=this.handleEditorImageLoadComplete.bind(this),this.handleEditorImageLoadErrorBind=this.handleEditorImageLoadError.bind(this),this.autoSave={editor:{lastSaveLocation:"",allowAutoSave:!0,cancelLazySave:function(){},saveQueue:[]},collage:{lastSaveLocation:"",allowAutoSave:!0,cancelLazySave:function(){},saveQueue:[]},designer:{lastSaveLocation:"",allowAutoSave:!0,cancelLazySave:function(){},saveQueue:[]}},this.autoSaveInterval=1e3,window.onbeforeunload=function(){return e.isFullyAutoSaved()?null:"You are about to leave BeFunky. If you do not save your changes, they will be lost."}}},{key:"loadProject",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(r,a){if(t.projectLoading)throw new Error("Attempting to open new project while an existing project is loading");if(t.projectLoading=!0,t.resolveProjectLoading=r,t.rejectProjectLoading=a,BFN.TransformGuides.setTransformGuideData(),t.queuedProjectVO=e,t.queuedProjectItemVOs=[].concat(v(e.collageGridChildren),v(e.transformGraphics),v(e.transformImages),v(e.transformMaskImages),v(e.transformLabels)),t.sourceTemplateLoading=n,t.trackingData=i,t.projectImageBaseTextures={},Object.keys(e.imageData).forEach(function(e){var n;switch(BFN.getImageType(e)){case"graphic":n=BFN.GraphicLibraryManager.getMenuImageVO(e);break;case"patterns":n=BFN.CollageMakerPatternManager.getMenuImageVO(e);break;default:n=BFN.ImageLibraryManager.getMenuImageVO(e)}n&&n.hasUsableTexture()&&!t.projectImageBaseTextures.hasOwnProperty(e)&&(t.projectImageBaseTextures[e]=n.imageTexture.baseTexture)}),"editor"===e.section){BFN.AppModel.viewingEditor||(BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR);var o="string"==typeof e.editorImageBase64&&e.editorImageBase64.startsWith("data:")?BFN.BlobUtils.base64ToBlob(e.editorImageBase64):e.editorImageBase64;if(!(o instanceof Blob))throw t.projectLoading=!1,new Error("Unable to get blob for main Photo Editor image");BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),BFN.ImageEditManager.resetEditor(),UITools.setToolValue("editor_main","edit",!0),UITools.applyTool("editor_main"),UITools.setToolValue("editor_main","edit",!1),BeFunky.showLoadScreen({isCancellable:!1}),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE.type,t.handleEditorImageLoadCompleteBind),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR.type,t.handleEditorImageLoadErrorBind);var s=!BeFunky.isSafari||!o.idbKeyName;BFN.PhotoEditorModel.loadBase64OrBlob(o,{filename:e.filename||"",showLoadScreen:!1,clearLocalAssets:!1,saveBlobAsIs:s})}else"collage"===e.section?(BFN.AppModel.viewingCollage||(BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER),BeFunky.showLoadScreen({isCancellable:!1}),e.collageBackgroundPatternBase64?BFN.TextureUtils.blobOrBase64ToTexture(e.collageBackgroundPatternBase64,function(n){var i=n.texture;!n.error&&i&&(i.baseTexture.isPattern=!0,i.baseTexture.averageColor=BFN.Util.getTextureAverageColor(i,!0),e.collageBackgroundPatternTexture=i),t.processQueuedProjectItemVOs()}):t.processQueuedProjectItemVOs(),BFN.CollageMakerModel.hasUnsavedChanges=!1):"designer"===e.section&&(BFN.AppModel.viewingDesigner||(BFN.AppModel.viewState=BFN.AppModelViewStates.VIEWING_DESIGNER),BFN.DesignerModel.hasUnsavedChanges=!1,BeFunky.showLoadScreen({isCancellable:!1}),t.processQueuedProjectItemVOs());BFN.UploadSaveShareManager.setFileName(e.section,"image",e.filename||""),BFN.UploadSaveShareManager.setFileName(e.section,"project",e.filename||"")})}},{key:"handleEditorImageLoadComplete",value:function(e){BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE.type,this.handleEditorImageLoadCompleteBind),BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR.type,this.handleEditorImageLoadErrorBind),this.processQueuedProjectItemVOs()}},{key:"handleEditorImageLoadError",value:function(){this.projectLoading=!1,this.rejectProjectLoading("Unable to load Editor image"),BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_COMPLETE.type,this.handleEditorImageLoadCompleteBind),BFN.PhotoEditorModel.removeEventListener(BFN.PhotoEditorModelEvents.EDITOR_IMAGE_LOAD_ERROR.type,this.handleEditorImageLoadErrorBind),BeFunky.hideLoadScreen();var e=BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture;throw UIToggler.toggleSampleImagePopover(e),UIToggler.toggleSaveButtons(!e),showMenuPanel("primary"),"invalid image data"}},{key:"processQueuedProjectItemVOs",value:function(){var e=this;if(this.queuedProjectVO&&this.queuedProjectItemVOs&&this.queuedProjectItemVOs.length){var t=this.queuedProjectItemVOs.shift();switch(t.type){case"grid_cell":return this.processGridCell(t,function(){return e.processQueuedProjectItemVOs()});case"graphic":return this.processGraphic(t,function(){return e.processQueuedProjectItemVOs()});case"image":return this.processImage(t,function(){return e.processQueuedProjectItemVOs()});case"mask_image":return this.processMaskImage(t,function(){return e.processQueuedProjectItemVOs()});default:return this.processQueuedProjectItemVOs()}}else{var n=this.queuedProjectVO;if(this.queuedProjectVO=null,this.queuedProjectItemVOs=null,BFN.SVGManager.clearCache(),this.fabricShapeBaseTextures){for(var i in this.fabricShapeBaseTextures)delete this.fabricShapeBaseTextures[i];delete this.fabricShapeBaseTextures}["editor","collage","designer"].includes(n.section)?this.addProject(n):(this.projectLoading=!1,this.rejectProjectLoading("Invalid project section"))}}},{key:"processGridCell",value:function(e,t){var n=this,i=e.gridCellImageID,r=this.queuedProjectVO,a=r.imageData,o=r.svgData;if(!i)return t();if(this.projectImageBaseTextures.hasOwnProperty(i))return e.gridCellTexture=new PIXI.Texture(this.projectImageBaseTextures[i]),this.assignTextureToMenuImageVO(i,e.gridCellTexture),t();var s=function(r){var a=r.error,o=r.texture;return a?BeFunky.logError('Unable to generate texture from grid cell "'.concat(i,'" image or SVG data')):("patterns"===BFN.getImageType(i)&&(o.baseTexture.isPattern=!0),n.projectImageBaseTextures[i]=o.baseTexture,e.gridCellTexture=o,n.assignTextureToMenuImageVO(i,e.gridCellTexture)),t()};return a.hasOwnProperty(i)?BFN.TextureUtils.blobOrBase64ToTexture(a[i],s):o.hasOwnProperty(i)?BFN.TextureUtils.svgStringToTexture(o[i],s):(BeFunky.logError("Project grid cell missing image/SVG data"),void t())}},{key:"processGraphic",value:function(e,t){var n=this;if(e.basicShapeValues)t();else{var i=e.graphicID,r=this.queuedProjectVO.svgData;if(!i)return BeFunky.logError("Project graphic missing ID"),t();if(!r.hasOwnProperty(i))return BeFunky.logError("Project graphic missing SVG data"),t();this.fabricShapeBaseTextures&&this.fabricShapeBaseTextures[i]?(e.graphicTexture=new PIXI.Texture(this.fabricShapeBaseTextures[i]),t()):BFN.TextureUtils.svgStringToTexture(r[i],function(r){var a=r.error,o=r.texture;a?BeFunky.logError("Unable to convert graphic SVG string to texture"):(n.fabricShapeBaseTextures=n.fabricShapeBaseTextures||{},n.fabricShapeBaseTextures[i]=o.baseTexture,e.graphicTexture=o),t()})}}},{key:"processImage",value:function(e,t){var n=this,i=e.imageID,r=this.queuedProjectVO.imageData,a=function(t){e.transformWidth>0&&e.transformHeight>0&&(e.transformScaleX=e.transformWidth/t.width,e.transformScaleY=e.transformHeight/t.height)};return i?r.hasOwnProperty(i)?this.projectImageBaseTextures.hasOwnProperty(i)?(e.imageTexture=new PIXI.Texture(this.projectImageBaseTextures[i]),this.assignTextureToMenuImageVO(i,e.imageTexture),a(e.imageTexture.baseTexture),t()):void BFN.TextureUtils.blobOrBase64ToTexture(r[i],function(r){var o=r.texture;r.error?BeFunky.logError("Unable to generate texture from project image data"):("patterns"===BFN.getImageType(i)&&(o.baseTexture.isPattern=!0),n.projectImageBaseTextures[i]=o.baseTexture,e.imageTexture=o,n.assignTextureToMenuImageVO(i,e.imageTexture),a(e.imageTexture.baseTexture)),t()}):(BeFunky.logError("Project image missing image data"),t()):(BeFunky.logError("Project image missing ID"),t())}},{key:"processMaskImage",value:function(e,t){var n=this,i=e.maskImageID,r=this.queuedProjectVO,a=r.svgData,o=r.imageData;if(!i)return BeFunky.logError("Project mask image missing ID"),t();if(!o.hasOwnProperty(i))return BeFunky.logError("Project mask image missing image data"),t();var s=function(){if(!e.maskImageMaskID)return t();if(a.hasOwnProperty(e.maskImageMaskID))BFN.SVGManager.getSVGShape(a[e.maskImageMaskID],function(n){e.maskImageMaskTexture=BFN.SVGManager.getTexture(n,t)},e.maskImageMaskID,!0);else{if(!o.hasOwnProperty(e.maskImageMaskID))return t();BFN.TextureUtils.blobOrBase64ToTexture(o[e.maskImageMaskID],function(n){var i=n.error,r=n.texture;return i?(BeFunky.logError("Unable to generate texture from project image data"),t()):(e.maskImageMaskTexture=r,t())})}};if(this.projectImageBaseTextures.hasOwnProperty(i))return e.maskImageTexture=new PIXI.Texture(this.projectImageBaseTextures[i]),this.assignTextureToMenuImageVO(i,e.maskImageTexture),s();BFN.TextureUtils.blobOrBase64ToTexture(o[i],function(r){var a=r.error,o=r.texture;return a?(BeFunky.logError("Unable to generate texture from project image data"),t()):("patterns"===BFN.getImageType(i)&&(o.baseTexture.isPattern=!0),n.projectImageBaseTextures[i]=o.baseTexture,e.maskImageTexture=o,n.assignTextureToMenuImageVO(i,e.maskImageTexture),s())})}},{key:"addProject",value:function(t){var n=this,i=null,r=null,a=null,o=null;switch(t.section){case"editor":i=BFN.PhotoEditorModel,r=BFN.PhotoEditorCanvasModel,a=BFN.PhotoEditorCanvas,o=t.section;break;case"collage":i=BFN.CollageMakerModel,r=BFN.CollageMakerCanvasModel,a=BFN.CollageMakerCanvas,o=t.section,BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerHistoryModel.resetHistory(),BFN.CollageMakerCanvasPhotoGridModel.freeform=t.collageFreeform,BFN.CollageMakerCanvasPhotoGridModel.freeform?(BFN.CollageMakerCanvasPhotoGrid.updateToolVO(t.projectWidth,t.projectHeight,0,0,t.collageBackgroundColor,!1,!1,!1),BFN.CollageMakerCanvasPhotoGrid.preparePhotoGrid(t.projectWidth,t.projectHeight,0,0)):(BFN.CollageMakerCanvasPhotoGrid.updateToolVO(t.projectWidth,t.projectHeight,t.collageGap,t.collageRounding,t.collageBackgroundColor,!1,!0,!0),BFN.CollageMakerCanvasPhotoGrid.preparePhotoGrid(t.collageGridWidth,t.collageGridHeight,t.collageGap/100,t.collageRounding/100)),BFN.CollageMakerCanvasPhotoGrid._gridWidth=t.projectWidth,BFN.CollageMakerCanvasPhotoGrid._gridHeight=t.projectHeight,BFN.CollageMakerCanvasBackground.color!==t.collageBackgroundColor&&(BFN.CollageMakerCanvasBackground.color=t.collageBackgroundColor),t.hasOwnProperty("collageBackgroundPatternTexture")?(BFN.CollageMakerCanvasPhotoGrid.setPatternBackgroundTexture(t.collageBackgroundPatternTexture),delete t.collageBackgroundPatternTexture):(BFN.CollageMakerCanvasPhotoGrid.setPatternBackgroundTexture(null),BFN.PhotoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color),BFN.CollageMakerCanvasPhotoGridModel.freeform||(BFN.CollageMakerHistoryModel.ignoreSnapshot=!0,t.collageGridChildren.forEach(function(e){var t=BFN.PhotoGrid.addGridChild(e.gridCellRect.x,e.gridCellRect.y,e.gridCellRect.width,e.gridCellRect.height);if(e.gridCellImageID)if(e.gridCellTexture){var n=BFN.ImageLibraryManager.getSampleIndex(e.gridCellImageID),i=BFN.ImageLibraryManager.getIndex(e.gridCellImageID),r=null;if(-1!==n)r=BFN.ImageLibraryManager.sampleMenuImageVOs[n];else if(-1!==i)r=BFN.ImageLibraryManager.selectedMenuImageVOs[i];else{(r=new BFN.MenuImageVO).id=e.gridCellImageID;var a=e.gridCellTexture,o=BFN.MultipleFileUploader.thumbSize,s=a.width/a.height,l=o*(s>1?s:1/s),u=BFN.Util.getThumbTexture(a,l,!1,!0);u.renderClone().destroyGC(!0),r.isTransparent=e.gridCellTexture.determineTransparency(),r.thumbURL=BFN.TextureUtils.textureToBase64(u,{isTransparent:r.isTransparent}),r.thumbWidth=u.width,r.thumbHeight=u.height,u.destroyGC(!0)}r.imageTexture=e.gridCellTexture,delete e.gridCellTexture,t.menuImageVO=r,r.imageTexture&&r.imageTexture.valid&&t.content.setImage(r.imageTexture),t.content.image.frameSprite.offsetFactorX=e.gridCellTextureOffsetFactorX,t.content.image.frameSprite.offsetFactorY=e.gridCellTextureOffsetFactorY,t.content.image.frameSprite.rotate=e.gridCellTextureRotate,t.content.image.frameSprite.textureScale=e.gridCellTextureScale,t.content.image.frameSprite.offsetFactorX=e.gridCellTextureOffsetFactorX,t.content.image.frameSprite.offsetFactorY=e.gridCellTextureOffsetFactorY,t.content.image.frameSprite.updateDisplay()}else e.gridCellImageID=null,e.gridCellTextureOffsetFactorX=.5,e.gridCellTextureOffsetFactorY=.5,e.gridCellTextureRotate=0,e.gridCellTextureScale=1;t.updateProjectItemVO()}),BFN.CollageMakerHistoryModel.ignoreSnapshot=!1),BFN.CollageMakerCanvasPhotoGrid.updateSettings(),BFN.CollageMakerCanvasPhotoGridModel.freeform||(BFN.CollageMakerHistoryModel.historyAction="new_grid_template",BFN.CollageMakerCanvasPhotoGrid.photoGrid.getPhotoGridSnapShot());break;case"designer":i=BFN.DesignerModel,r=BFN.DesignerCanvasModel,a=BFN.DesignerCanvas,o=t.section,BFN.DesignerCanvasModel.dispatchEvent(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS),BFN.DesignerCanvas.setSize(t.projectWidth,t.projectHeight),BFN.DesignerCanvasBackground.color=t.designerBackgroundColor,UITools.setToolValue("collage_customize","background_color",t.designerBackgroundColor),UITools.updateToolControls("collage_customize"),BFN.ZoomManager.updateZoomRange(),BFN.DesignerCanvas.fitDesignerToFrame()}if(i&&r&&a&&o){this.transformItemsPending=!0,i.projectVO=t,BeFunky.showLoadScreen({isCancellable:!1}),BFN.GroupManager.clearGroups(t.section),BFN.GroupManager.addGroups(t.section,t.transformGroups),BFN.TransformStateModel.blockAddedTransitions=!0,BFN.TransformModel.selectItemOnAdd=!1;var s=[];t.transformGraphics.filter(function(e){return e.graphicTexture||e.basicShapeValues}).forEach(function(e){e.graphicTexture?r.addedItem={type:"texture",texture:e.graphicTexture,isGoodie:!0,projectItemVO:e,projectVO:t,graphicStyle:e.graphicStyle}:e.basicShapeValues&&(r.addedItem={type:"texture",texture:null,isGoodie:!0,projectItemVO:e,projectVO:t,basicShapeVO:new BFN.BasicShapeVO(e.basicShapeValues.type,e.basicShapeValues)});var i=BFN.TransformModel.addedTransformItem,o=new BFN.TransformItemStateVO;e.hasOwnProperty("graphicTexture")&&e.graphicTexture&&(o.imageTexture=e.graphicTexture,delete e.graphicTexture),o.parent=a.transformLayer,n.transferProperties(e,o),i.applyTransformItemState(o,!1),s.push({zIndex:o.zIndex,item:i,state:o})});for(var l=t.transformImages.length;--l>-1;){var u=t.transformImages[l];if(!u.isGoodie&&u.hasOwnProperty("imageTexture")){t.transformImages.splice(l,1),u.maskImageTexture=u.imageTexture,delete u.imageTexture,u.type="mask_image",u.maskImageID=u.imageID,u.imageID=null;var c=u.maskImageTexture.baseTexture;u.maskImageFrameWidth=u.transformScaleX*c.width,u.maskImageFrameHeight=u.transformScaleY*c.height;var h=Math.max(u.maskImageFrameWidth/c.width,u.maskImageFrameHeight/c.height),d=c.width*h,m=c.height*h;u.maskImageTextureScale={x:u.maskImageFrameWidth/d,y:u.maskImageFrameHeight/m},u.transformScaleX=1,u.transformScaleY=1,t.transformMaskImages.push(u)}}if(t.transformImages.filter(function(e){return e.imageTexture}).forEach(function(e){var i={type:"texture",texture:e.imageTexture,projectItemVO:e,projectVO:t,graphicStyle:e.graphicStyle};e.isGoodie&&(i.isGoodie=!0),r.addedItem=i;var o=BFN.TransformModel.addedTransformItem,l=new BFN.TransformItemStateVO;l.imageTexture=e.imageTexture,delete e.imageTexture,l.parent=a.transformLayer,n.transferProperties(e,l),o.applyTransformItemState(l,!1),s.push({zIndex:l.zIndex,item:o,state:l})}),t.transformMaskImages.filter(function(e){return e.maskImageTexture}).forEach(function(i){if(i.hasOwnProperty("maskImageFlashVars")){var o=i.maskImageTexture.baseTexture;if(i.maskImageFrameWidth=i.maskImageFlashVars.maskImageWidth,i.maskImageFrameHeight=i.maskImageFlashVars.maskImageHeight,i.maskImageFlashVars.maskImageScaleX=Math.round(100*i.maskImageFlashVars.maskImageScaleX)/100,i.maskImageFlashVars.maskImageScaleY=Math.round(100*i.maskImageFlashVars.maskImageScaleY)/100,i.maskImageFlashVars.maskImageScaleX===i.maskImageFlashVars.maskImageScaleY){var l=Math.min(o.width*i.maskImageFlashVars.maskImageScaleX/i.maskImageFrameWidth,o.height*i.maskImageFlashVars.maskImageScaleY/i.maskImageFrameHeight),u=Math.max(0,o.width*i.maskImageFlashVars.maskImageScaleX-i.maskImageFlashVars.maskImageWidth),c=Math.max(0,o.height*i.maskImageFlashVars.maskImageScaleY-i.maskImageFlashVars.maskImageHeight);i.maskImageOffsetFactorX=u?Math.abs(i.maskImageFlashVars.maskImageX)/u:.5,i.maskImageOffsetFactorY=c?Math.abs(i.maskImageFlashVars.maskImageY)/c:.5,i.maskImageTextureScale=l}delete i.maskImageFlashVars}var h={x:1,y:1};"object"===e(i.maskImageTextureScale)&&i.maskImageTextureScale.hasOwnProperty("x")&&i.maskImageTextureScale.hasOwnProperty("y")?(h.x=i.maskImageTextureScale.x,h.y=i.maskImageTextureScale.y):"number"==typeof i.maskImageTextureScale&&(h.x=i.maskImageTextureScale,h.y=i.maskImageTextureScale),i.maskImageTextureScale=h;var d=null;i.hasOwnProperty("maskImageMaskTexture")&&i.maskImageMaskTexture?d=i.maskImageMaskTexture:i.basicShapeValues&&(d=PIXI.RenderTexture.create(32,32));var m={type:"frame_texture",texture:i.maskImageTexture,maskTexture:d,projectItemVO:i,projectVO:t};if(i.graphicStyle&&(m.graphicStyle=i.graphicStyle),i.basicShapeValues){var p=new BFN.BasicShapeVO(i.basicShapeValues.type,i.basicShapeValues);p.convertToMaskValues(),p.isSolidRectangle?(i.basicShapeValues=null,m.maskTexture&&m.maskTexture!==i.maskImageMaskTexture&&(m.maskTexture.destroyGC(!0),m.maskTexture=null)):(m.basicShapeVO=p,i.basicShapeValues=p.getValues())}r.addedItem=m;var g=BFN.TransformModel.addedTransformItem,f=new BFN.TransformItemStateVO;f.imageTexture=i.maskImageTexture,delete i.maskImageTexture,i.hasOwnProperty("maskImageMaskTexture")&&delete i.maskImageMaskTexture,f.parent=a.transformLayer,n.transferProperties(i,f),g.applyTransformItemState(f,!1),s.push({zIndex:f.zIndex,item:g,state:f})}),t.transformLabels.length&&(BFN.UndoManager.updating=!0,t.transformLabels.forEach(function(e){var i=e.labelTextStyles.styles;BFN.ParseBFD.forEachCharacterStyle(i,function(e){e.hasOwnProperty("desiredStrokeWidth")&&(!e.hasOwnProperty("strokePercent")&&e.hasOwnProperty("fontSize")&&(e.strokePercent=Math.max(BFN.TransformItemTextStrokePercentMin,Math.min(BFN.TransformItemTextStrokePercentMax,e.desiredStrokeWidth/Math.max(.001,e.fontSize)))),delete e.desiredStrokeWidth)});for(var o={fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,fill:"rgb(0,0,0,1)",textBackgroundColor:"",stroke:"",strokeWidth:1,strokePercent:BFN.TransformItemTextStrokePercentDefault},l={},u=e.labelTextStyles.styles,c=e.labelText.split("\n"),h=0;h<c.length;h++){h<c.length-1&&(c[h]+="\n"),l[h]={};for(var d=0;d<c[h].length;d++)u&&u[h]&&u[h][d]&&(o=Object.assign({},u[h][d])),l[h][d]=Object.assign({},o)}e.labelTextStyles.styles=l,r.addedItem={type:"text",projectItemVO:e,projectVO:t};var m=BFN.TransformModel.addedTransformItem,p=new BFN.TransformItemStateVO;m.updateStateVO(p),p.parent=a.transformLayer,n.transferProperties(e,p),m.applyTransformItemState(p,!1),s.push({zIndex:p.zIndex,item:m,state:p})}),BFN.MainUI.rendering=!0,BFN.MainUI.renderCanvas(),BFN.MainUI.rendering=!1,BFN.UndoManager.updating=!1),this.trackingData&&"designer"===t.section){var p=this.trackingData.type;p||(p=this.trackingData.id?"Preset":"Custom");var g=new BFN.UserActionVO;g.eventID="design_layout_selected",g.eventObject={templateType:p,templateName:this.trackingData.name||"Custom",templateID:this.trackingData.id||"custom",templateSearchKeyword:this.trackingData.searchTerm||""},g.track()}this.sourceTemplateLoading=!1,this.trackingData=null,BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.transformLayer&&BFN.TransformModel.selectedTransformItem.transformLayer.deselectItem(),BFN.MainUI.renderCanvas(),s.forEach(function(e){var t=e.item;t.ignoreAccurateBounds=!0,t.visible=!1}),BFN.MainUI.renderCanvas();var f=!1;setTimeout(function e(){if(!BFN.updatingShapeQueue.length&&!BFN.updatingTextQueue.length&&(f||(f=!0,s.length&&(s.sort(function(e,t){return e.zIndex-t.zIndex}),s.forEach(function(e,t){var n=e.item,i=e.state;n.parent.setChildIndex(n,t),setTimeout(function(){n.updateShapeTexture()},t),i.zIndex=t,n.ignoreAccurateBounds=!1,n.updateAccurateBounds(),n.setTransitionStartState(),n.setTransitionEndState()}))),!BFN.accurateBoundsQueue.length)){s.forEach(function(e,t){var n=e.item;n.visible=!0,n.preloadThumbnail(5*t+50),n.refreshItemName(),"text"!==n.type||n.iText.wordBreaksEnabled||(n.iText.wordBreaksEnabled=!0)}),BFN.MainUI.requestRender(),BFN.TransformStateModel.blockAddedTransitions=!1,BFN.TransformModel.selectItemOnAdd=!0,BeFunky.hideLoadScreen();var i=0;return"editor"===o&&BFN.PhotoEditorHistoryModel.historyVOs.length&&(i=BFN.PhotoEditorHistoryModel.historyVOs[0].timestamp),BFN.TextureHistoryManager.addTextureHistory(i),Object.keys(n.projectImageBaseTextures).forEach(function(e){delete n.projectImageBaseTextures[e]}),n.projectImageBaseTextures={},n.transformItemsPending=!1,BFN.TransformLayerManager.updateTransformItems(),BFN.TransformGuides.setTransformGuideData(t.transformGuides,t.transformGuidesLocked),n.projectLoading=!1,n.resolveProjectLoading(),n.saveProjectAssets(t),void n.requestLocalSave()}setTimeout(e,0)},0)}else BeFunky.throwError("Unable to add project",t.section),this.projectLoading=!1,this.rejectProjectLoading("Unable to add project")}},{key:"saveProjectAssets",value:function(e){var t,n;BeFunky.testingFlags.includes("add_screenshot_mask")&&requestIdleCallback(this.createScreenshotMask);var i=!!e._isLocalProject;delete e._isLocalProject;var r=e.section,a={image:e.imageData,svg:e.svgData};e.imageData={},e.svgData={};var o=Object.keys(a.image),s=Object.keys(a.svg);e.imageDataKeys.splice(0),e.svgDataKeys.splice(0),(t=e.imageDataKeys).push.apply(t,v(o)),(n=e.svgDataKeys).push.apply(n,v(s));var l=[].concat(v(o.map(function(e){return"image__".concat(e)})),v(s.map(function(e){return"svg__".concat(e)})));i&&l.push("image__".concat(r,"_thumb")),"editor"===r&&l.push("image__editor_canvas_image");(BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage?Promise.resolve():BFN.ProjectService.clearLocalAssets(r,l)).then(function(){if(!i)[].concat(v(o.map(function(t){return e(t,"image")})),v(s.map(function(t){return e(t,"svg")})));function e(e,t){var n=a[t][e];if("image"===t&&"string"==typeof n)try{n=BFN.BlobUtils.base64ToBlob(n)}catch(t){BeFunky.logError("Unable to convert project image ".concat(e," from base64 -> blob before saving in IndexedDB"))}return BFN.ProjectService.setLocalAsset(r,t,e,n).catch(function(t){BeFunky.logError("Unable to save project asset",e,t)})}})}},{key:"createScreenshotMask",value:function(){var e;BeFunky.waitUntil({condition:function(){var t,n,i,r,a;return BFN.AppModel.viewingEditor?(t=BFN.PhotoEditorCanvas.scale.x,n=BFN.PhotoEditorCanvasImage.imageWidth*t,i=BFN.PhotoEditorCanvasImage.imageHeight*t,r=BFN.PhotoEditorCanvas.canvasContainer.x*t,a=-BFN.PhotoEditorCanvas.canvasContainer.y*t,e={width:n,height:i,left:BFN.PhotoEditorCanvas.x+r-n/2+BFN.appViewportRect.left,bottom:BFN.PhotoEditorCanvas.y+a-i/2+BFN.CSS.footerHeight}):e=BFN.ImageEditManager.getProjectBoundingClientRect(),e.width>1},onTimeout:function(){BeFunky.logError("Unable to get template dimensions")},onSuccess:function(){!function(){var t=document.getElementById("project_bounds");t||(t=BeFunky.lit.elem(lv()),document.body.appendChild(t));t.setStyles({position:"absolute",width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"".concat(e.left,"px"),bottom:"".concat(e.bottom,"px")}),console.log("Testing > Positioned project_bounds div over canvas","".concat(e.width," x ").concat(e.height))}()},interval:500,maxAttempts:6})}},{key:"getProjectVO",value:function(e){var t=this,n=new BFN.ProjectVO;return Object.assign(n,e),n.collageGridChildren=[],n.transformGraphics=[],n.transformImages=[],n.transformMaskImages=[],n.transformLabels=[],n.transformGroups=[],e.collageGridChildren.forEach(function(e){return n.collageGridChildren.push(t.getProjectItemVO(e))}),e.transformGraphics.forEach(function(e){return n.transformGraphics.push(t.getProjectItemVO(e))}),e.transformImages.forEach(function(e){return n.transformImages.push(t.getProjectItemVO(e))}),e.transformMaskImages.forEach(function(e){return n.transformMaskImages.push(t.getProjectItemVO(e))}),e.transformLabels.forEach(function(e){return n.transformLabels.push(t.getProjectItemVO(e))}),e.transformGroups&&e.transformGroups.forEach(function(e){return n.transformGroups.push(t.getTransformItemGroupVO(e))}),n.svgData={},Object.entries(e.svgData).forEach(function(e){var t=f(e,2),i=t[0],r=t[1];n.svgData[i]=r.startsWith("<")?r:atob(r)}),n}},{key:"getProjectItemVO",value:function(e){if(e.hasOwnProperty("transformOverlayColorEnabled")||(e.transformOverlayColorEnabled=e.hasOwnProperty("transformOverlayColor")&&-1!=e.transformOverlayColor),e.hasOwnProperty("transformTintColorEnabled")||(e.transformTintColorEnabled=e.hasOwnProperty("transformTintColor")&&-1!=e.transformTintColor),e.hasOwnProperty("borderEnabled")||(e.borderEnabled=e.hasOwnProperty("borderColor")&&-1!=e.borderColor),e.hasOwnProperty("labelTextBackgroundEnabled")||(e.labelTextBackgroundEnabled=e.hasOwnProperty("labelTextBackgroundColor")&&-1!=e.labelTextBackgroundColor),"label"===e.type&&e.labelTextStyles&&e.labelTextStyles.styles&&(!e.hasOwnProperty("labelTextOutlineEnabled")||!e.hasOwnProperty("labelTextHighlightEnabled"))){var t=!1,n=!1,i=e.labelTextStyles.styles;for(var r in i){var a=i[r];for(var o in a){var s=a[o];!t&&s.stroke&&(t=!0),!n&&s.textBackgroundColor&&(n=!0)}}e.labelTextOutlineEnabled=t,e.labelTextHighlightEnabled=n}var l=new BFN.ProjectItemVO;return Object.assign(l,e),e.gridCellRect&&(l.gridCellRect=new BFN.Rectangle(e.gridCellRect.x,e.gridCellRect.y,e.gridCellRect.width,e.gridCellRect.height)),l}},{key:"getTransformItemGroupVO",value:function(e){var t=new BFN.TransformItemGroupVO;return Object.assign(t,e),t}},{key:"getProjectObject",value:function(e){var t=this,n={};return Object.assign(n,e),n.collageGridChildren=[],n.transformGraphics=[],n.transformImages=[],n.transformMaskImages=[],n.transformLabels=[],e.collageGridChildren.forEach(function(e){return n.collageGridChildren.push(t.getProjectItemObject(e))}),e.transformGraphics.forEach(function(e){return n.transformGraphics.push(t.getProjectItemObject(e))}),e.transformImages.forEach(function(e){return n.transformImages.push(t.getProjectItemObject(e))}),e.transformMaskImages.forEach(function(e){return n.transformMaskImages.push(t.getProjectItemObject(e))}),e.transformLabels.forEach(function(e){return n.transformLabels.push(t.getProjectItemObject(e))}),n}},{key:"getProjectItemObject",value:function(e){var t={};return Object.assign(t,e),t.gridCellRect&&(t.gridCellRect={x:t.gridCellRect.x,y:t.gridCellRect.y,width:t.gridCellRect.width,height:t.gridCellRect.height}),delete t.graphicTexture,delete t.imageTexture,delete t.maskImageTexture,delete t.maskImageMaskTexture,delete t.gridCellTexture,t}},{key:"transferProperties",value:function(e,t){t.basicShapeValues=e.basicShapeValues,t.shapeColorMap=e.shapeColorMap,t.borderEnabled=e.borderEnabled,t.borderValues=e.borderValues,t.dropShadowValues=e.dropShadowValues,t.zIndex=e.transformZIndex,t.locked=e.transformLocked,t.x=e.transformX,t.y=e.transformY,t.scaleX=e.transformScaleX,t.scaleY=e.transformScaleY,t.rotation=e.transformRotation,t.opacity=e.transformOpacity,t.blendMode=e.transformBlendMode,t.flippedHorizontal=e.transformFlippedHorizontal,t.flippedVertical=e.transformFlippedVertical,t.overlayColorEnabled=e.transformOverlayColorEnabled,t.overlayColor=e.transformOverlayColor,t.overlayColorIntensity=e.transformOverlayColorIntensity,t.tintEnabled=e.transformTintColorEnabled,t.tint=e.transformTintColor,t.maskImageFrameWidth=e.maskImageFrameWidth,t.maskImageFrameHeight=e.maskImageFrameHeight,t.maskImageOffsetFactorX=e.maskImageOffsetFactorX,t.maskImageOffsetFactorY=e.maskImageOffsetFactorY,t.maskImageTextureScale=e.maskImageTextureScale,t.text=e.labelText,t.textStyle=e.labelTextStyles,t.textWidth=e.labelWidth,t.textScale=e.labelTextScale,t.textItemScale=e.labelTextItemScale,t.textBackgroundEnabled=e.labelTextBackgroundEnabled,t.textBackgroundColor=e.labelTextBackgroundColor,t.textBackgroundIntensity=e.labelTextBackgroundIntensity,t.textBackgroundPadding=e.labelTextBackgroundPadding,t.textOutlineEnabled=e.labelTextOutlineEnabled,t.textHighlightEnabled=e.labelTextHighlightEnabled}},{key:"assignTextureToMenuImageVO",value:function(e,t){var n;switch(BFN.getImageType(e)){case"graphic":n=BFN.GraphicLibraryManager.getMenuImageVO(e);break;case"patterns":t.baseTexture.isPattern=!0,n=BFN.CollageMakerPatternManager.getMenuImageVO(e);break;default:n=BFN.ImageLibraryManager.getMenuImageVO(e)}n&&(!n.imageTexture||n.imageTexture&&!n.imageTexture.baseTexture||n.imageTexture&&n.imageTexture.baseTexture&&n.imageTexture.baseTexture._destroyed)&&(n.imageTexture=new PIXI.Texture(t.baseTexture))}},{key:"updateProjectVOItems",value:function(e,t){if(!this.projectLoading){e.projectVO.imageDataKeys.splice(0),e.projectVO.svgDataKeys.splice(0),e.projectVO.transformGraphics.splice(0),e.projectVO.transformImages.splice(0),e.projectVO.transformMaskImages.splice(0),e.projectVO.transformLabels.splice(0);var n="editor";e===BFN.CollageMakerModel&&(n="collage"),e===BFN.DesignerModel&&(n="designer"),t.children.filter(function(e){return"group"!==e.type&&e.projectItemVO}).forEach(function(i){var r=i.projectItemVO;switch(r.transformZIndex=t.children.indexOf(i),r.type){case"graphic":r.graphicID?(e.projectVO.svgDataKeys.includes(r.graphicID)||(e.projectVO.svgDataKeys.push(r.graphicID),BFN.ProjectService.setLocalAsset(n,"svg",r.graphicID,void 0,!0)),e.projectVO.transformGraphics.push(r)):r.basicShapeValues&&e.projectVO.transformGraphics.push(r);break;case"image":r.imageID&&(e.projectVO.imageDataKeys.includes(r.imageID)||(e.projectVO.imageDataKeys.push(r.imageID),BFN.ProjectService.setLocalAsset(n,"image",r.imageID,void 0,!0)),e.projectVO.transformImages.push(r));break;case"mask_image":if(r.maskImageID&&(e.projectVO.imageDataKeys.includes(r.maskImageID)||(e.projectVO.imageDataKeys.push(r.maskImageID),BFN.ProjectService.setLocalAsset(n,"image",r.maskImageID,void 0,!0)),e.projectVO.transformMaskImages.push(r)),r.maskImageMaskID)i.itemContentMask&&!i.isShape?e.projectVO.imageDataKeys.includes(r.maskImageMaskID)||(e.projectVO.imageDataKeys.push(r.maskImageMaskID),BFN.ProjectService.setLocalAsset(n,"image",r.maskImageMaskID,void 0,!0)):e.projectVO.svgDataKeys.includes(r.maskImageMaskID)||(e.projectVO.svgDataKeys.push(r.maskImageMaskID),BFN.ProjectService.setLocalAsset(n,"svg",r.maskImageMaskID,void 0,!0));break;case"label":e.projectVO.transformLabels.push(r)}})}}},{key:"validateProject",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.allowReset,r=void 0!==i&&i,a=n.logLevel,o=void 0===a?"none":a,s=n.requireEditorMainImage,l=void 0===s||s;if(!t||"object"!==e(t))return u("Not an object"),!1;if(!["editor","collage","designer"].includes(t.section))return u("Invalid section"),!1;if("number"!=typeof t.version)return u("Invalid version: not a number"),!1;if("number"!=typeof t.projectWidth||"number"!=typeof t.projectHeight)return u("Invalid projectWidth/projectHeight: not a number"),!1;if(!r){if(t.projectWidth<=0||t.projectHeight<=0)return u("Invalid projectWidth/projectHeight: not greater than zero"),!1;if("editor"===t.section&&l&&!t.editorImageBase64)return u("Missing editorImageBase64"),!1}return!0;function u(e){if("none"!==o){var n="projectVO failed validation: ".concat(e);return"console"===o?BeFunky.logError(n,t):"throw"===o?BeFunky.throwError(n,t):BeFunky.logError("Invalid log level",o)}}}},{key:"requestLocalSave",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.sectionID,i=void 0===n?BFN.AppModel.sectionID:n,r=t.isLazy,a=void 0===r||r,o=t.allowReset,s=void 0!==o&&o,l=t.createThumbnail,u=this.autoSave[i],c=BFN.toTitleCase(i),h=function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=BeFunky).logFeature.apply(e,["autosave"].concat(n))},d=Date.now();if(u.cancelLazySave(),!a){var m=v(i);return this.validateProject(m,{allowReset:s,logLevel:"throw",requireEditorMainImage:!1})?f(m,"boolean"!=typeof l||l):Promise.reject("".concat(c," projectVO failed validation"))}if(BFN.ZoomRegion&&BFN.ZoomRegion.updatePreview(),u.allowAutoSave){var p=!1;y();var g=setTimeout(function(){return BFN.MainUI.addIdleRenderFunction(function(){if(u.allowAutoSave&&!p){var t=v(i);if(!e.validateProject(t,{allowReset:s,logLevel:"console",requireEditorMainImage:!1}))return BeFunky.logError("".concat(c," lazy save cancelled b/c projectVO failed validation")),void x();f(t,!t._wasReset&&e.checkThumbnailAvailability(i).isAvailable).catch(function(e){BeFunky.logError("".concat(c," lazy save failed:"),e)})}else x()})},this.autoSaveInterval);u.cancelLazySave=function(){clearTimeout(g),p=!0,x()}}function f(e,t){y(),h("Saving",i,{isLazy:a,needsThumbnail:t});var n=t?function(){var e=Date.now();return BFN.ProjectManager.createThumbnail(i,"blob",!1).then(function(t){return h("Thumbnail created",Date.now()-e),e=Date.now(),BFN.ProjectService.setLocalAsset(i,"image","".concat(i,"_thumb"),t)}).then(function(){h("Thumbnail saved",Date.now()-e)})}():Promise.resolve(),r=Date.now();return BFN.ProjectService.saveLocalProject(i,BFN.ProjectManager.getProjectObject(e)).then(function(e){var t=e.store;h("Project saved in ",Date.now()-r),u.lastSaveLocation=t}).then(function(){return n}).then(function(){return x()},function(e){throw x(),e})}function v(e){var t={editor:BFN.PhotoEditorModel,collage:BFN.CollageMakerModel,designer:BFN.DesignerModel}[e].projectVO;return t.thumbBase64=null,t.editorImageBase64=null,t}function y(){u.saveQueue.push(d),u.saveQueue=u.saveQueue.unique()}function x(){u.saveQueue=u.saveQueue.filter(function(e){return e!==d})}}},{key:"isFullyAutoSaved",value:function(){var e=Object.values(BFN.ProjectManager.autoSave),t=e.every(function(e){return"memory"!==e.lastSaveLocation}),n=e.every(function(e){return 0===e.saveQueue.length});return t&&n}},{key:"checkThumbnailAvailability",value:function(e){return BFN.openedSections.includes(e)||"editor"===e&&BFN.ImageEditManager.editingImage?"editor"===e&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?{isAvailable:!1,reason:"not_viewing_canvas"}:BFN.FabricManager.showingTransformItemIText?{isAvailable:!1,reason:"fabric_canvas_showing"}:BFN.TransformItemIsolator.active||BFN.TransformItemIsolator.animating?{isAvailable:!1,reason:"transform_item_isolated"}:BFN.PhotoGrid.gridIsolator.gridChild?{isAvailable:!1,reason:"grid_item_isolated"}:{isAvailable:!0,reason:"all_is_well"}:{isAvailable:!1,reason:"section_has_not_been_opened"}}},{key:"createThumbnail",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blob",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.checkThumbnailAvailability(e),o=a.isAvailable,s=a.reason;if(!o)return Promise.reject(s);switch(e){case"editor":t=BFN.PhotoEditorCanvas.getFlattenedImage();break;case"collage":t=BFN.CollageMakerCanvas.getFlattenedImage();break;case"designer":t=BFN.DesignerCanvas.getFlattenedImage()}if(!t)return Promise.reject("no_flattened_image");var l,u,c=t.width/t.height;if(r){var h=c>=1?c:1/c,d=Math.round(720*h),m=f(BFN.TextureUtils.getScaledDimensions(t,{maxWidth:d,maxHeight:d}),2);l=m[0],u=m[1]}else{var p=f(BFN.TextureUtils.getScaledDimensions(t,{maxWidth:300,maxHeight:200}),2);l=p[0],u=p[1]}var g=t.width===l&&t.height===u?t:BFN.Util.getThumbTexture(t,Math.max(l,u)),v=!!r&&BFN.Util.isTransparent(g),y=r?1:.9,x="base64"===i?Promise.resolve(BFN.TextureUtils.textureToBase64(g,{isTransparent:v,quality:y})):BFN.TextureUtils.textureToBlobWithErrorHandling(g,{isTransparent:v,quality:y}),_=g.width,I=g.height,T=t.width,b=t.height;return x.then(function(t){var r=function(t){n.savedCanvasThumbs.hasOwnProperty(e)||(n.savedCanvasThumbs[e]={});var i=n.savedCanvasThumbs[e];i.thumbID=BeFunky.randomString(10),i.thumbSRC=t,i.thumbW=_,i.thumbH=I,i.canvasW=T,i.canvasH=b,BFN.ZoomRegion.updatePreview()};"base64"===i?r(t):BFN.BlobUtils.blobToBase64(t).then(r)}),t.destroyGC(!0),g.destroyGC(!0),x}},{key:"getThumbnailHtmlForDialog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.width,i=t.height;return function(){if("string"==typeof e&&e.startsWith("data:image/"))return Promise.resolve(e);if(e instanceof Blob)return BFN.BlobUtils.blobToBase64(e);return Promise.reject("no_blob")}().then(function(e){var t="contain";if(n&&i){var r=BFN.TextureUtils.getScaledDimensions({width:n,height:i},{maxWidth:300,maxHeight:200}),a=f(r,2),o=a[0],s=a[1];t="".concat(o," ").concat(s)}return'<div style="background: var(--image-bg); margin-bottom: 1rem">\n                <div style="background: url(\''.concat(e,"') no-repeat center; background-size: ").concat(t,'; height: 200px; width: 300px; margin: 0 auto;"></div>\n            </div>')})}},{key:"getOpenImageInEditorProject",value:function(){var e=this;return BFN.PhotoEditorModel.getCurrentTextureBlob().then(function(t){var n=BFN.PhotoEditorModel.projectVO;if(n.editorImageBase64=t,!e.validateProject(n,{logLevel:"throw"}))throw"Invalid Open in Editor project";var i=e.getProjectObject(n),r=BFN.ProjectManager.createThumbnail("editor","base64",!1).then(function(e){i.thumbBase64=e}),a=BFN.ProjectService.addImagesToProject(i);return Promise.all([r,a]).then(function(){return i})})}},{key:"loadFile",value:function(t){var n=this;if("bfd"!==BFN.getExtension(t.name))return BeFunky.logError("User attempted to load non-BFD file as a project",t&&t.name);BeFunky.showLoadScreen({isCancellable:!1}),BFN.SavedProjectService.decodeProjectFile(t,function(i){var r=i.data,a=i.error;if(a)return BeFunky.hideLoadScreen(),BeFunky.logError("Unable to decode BFD file \n",a);BFN.ObjectCompressor.decompress(r).catch(function(e){BeFunky.logError("Unable to decompress project file",e)}).then(function(i){BeFunky.hideLoadScreen(),"object"===e(i)&&n.openProject(i,{filename:t.name.replace(/\.bfd$/i,""),source:"computer"}).catch(function(e){"user_not_plus"!==e?BeFunky.logError("Unable to open project file",e):BeFunky.openTeaserModal("plus_templates")})})})}},{key:"openProject",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.filename,r=n.source,a=n.thumbnail;return new Promise(function(n,a){if(e.isPlusTemplate&&!BFN.BfnService.userIsPlus)throw"user_not_plus";e.thumbRect&&(e.version=e.version||"1.0",e.section=e.section||"designer");var s=e.section;if(!["editor","collage","designer"].includes(s))return a("Invalid project section: ".concat(BeFunky.stringValue(s)));t.confirmLoadNewProject({onConfirm:function(){return function(t){return BFN.ParseBFD.objectToProjectVO(e).then(function(e){return BFN.ProjectManager.confirmSwapFonts().then(function(){if(i&&(e.filename=i),BFN.BfnService.trackMediaOpened("project",r),BFN.AppModel.sectionID===t)return BFN.ProjectManager.loadProject(e);BeFunky.projectToOpenInSection[t]={projectVO:e};var n={editor:BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,collage:BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,designer:BFN.AppModelViewStates.VIEWING_DESIGNER};return BFN.AppModel.viewState=n[t],"pending_section_change"})}).catch(function(e){return"cancelled_by_user"===e?Promise.reject(e):new Promise(function(n){BFN.ProjectManager.handleOpenProjectError(e,t,i,function(){return n(e)})})})}(s).then(n,a)},onCancel:function(){return a("cancelled_by_user")},projectSection:s,getNewProjectThumbnail:o})});function o(){if(a)return Promise.resolve({image:a});var t=e.version,n=e.thumbBase64,i=e.thumbRect;return new Promise(function(e){"1.0"===t?BFN.ByteArrayUtil.AS3ByteArrayToPixel(n,i.width,i.height,function(t){var n=t.src;e({image:n})}):e({image:n})})}}},{key:"confirmLoadNewProject",value:function(e){var t=e.onConfirm,n=e.onCancel,i=e.projectSection,r=void 0===i?BFN.AppModel.sectionID:i,a=e.getNewProjectThumbnail;if(r===BFN.AppModel.sectionID&&!("editor"===r?BFN.PhotoEditorModel.hasUnsavedChanges:"collage"===r?BFN.CollageMakerModel.hasUnsavedChanges:BFN.DesignerModel.hasUnsavedChanges)&&l())return console.log("Replacing ".concat(r," project without asking")),t();var o=!1;function s(e){var t,n,i=e.image,r=e.aspectRatio;return!i&&r?Promise.resolve((t=BFN.CSS.sideBySideImageWidth/BFN.CSS.sideBySideImageHeight,n=r>t?"100%":"".concat(BFN.CSS.sideBySideImageHeight*r,"px"),hv(av(),"width: ".concat(n,";"),"padding-bottom: ".concat(100/r,"%; background: var(--secondary-000);")))):"string"==typeof i&&i.length>5?Promise.resolve(a(i)):i instanceof Blob?BFN.BlobUtils.blobToBase64(i).then(function(e){return a(e)}).catch(function(){return o()}):Promise.resolve(o());function a(e){return hv(ov(),"background-image: url('".concat(e,"');"))}function o(){return hv(rv(),dv("folder-icon","icon",{style:"width: 5rem; height: 4rem;"}),mv("no_thumbnail"))}}function l(){return BFN.openedSections.includes(r)}BeFunky.showLoadScreen({onCancel:function(){o=!0}}),(l()?Promise.resolve():BFN.SettingsManager.getSetting("autosave").then(function(e){if("no"===e)throw"start_new_mode"})).then(function(){return BFN.ProjectService.getAutosavedProjectThumbnail(r)}).then(function(e){return{image:e}}).then(function(e){return o?n():(BeFunky.hideLoadScreen(),a().then(function(i){!function(e,i){Promise.all([e,i].map(s)).then(function(e){var i=f(e,2),a=i[0],o=i[1],s=cv(sv(),mv("current_project"),a,dv("arrow-icon","icon icon--20 side-by-side__arrow"),mv("new_project"),o,mv(["confirm_project_change",{app_section:mv(({editor:"photo_editor",collage:"collage_maker",designer:"designer"},{editor:"photo_editor",collage:"collage_maker",designer:"designer"}[r]))}]));BeFunky.confirm(s,{onConfirm:t,onCancel:n,confirmText:"yes",cancelText:"no",size:"medium"})})}(e,i)}))},function(){if(o)return n();BeFunky.hideLoadScreen(),t()})}},{key:"handleOpenProjectError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(function(i){BeFunky.logError("Unable to open ".concat(t," project"),e),BeFunky.hideLoadScreen();var r=BeFunky.LanguageManager.getStringReplacements("error_opening_project",{app_section:BeFunky.LanguageManager.getString({editor:"photo_editor",collage:"collage_maker",designer:"designer"}[t]),project_name:n?'"'.concat(n,'"'):""}).replace(/\s+/," ");BeFunky.acknowledge(r,{onAcknowledge:i})})}},{key:"confirmSwapFonts",value:function(){return new Promise(function(e,t){var n=Object.entries(BFN.ParseBFD.swappedFonts);if(!n.length)return e();var i=cv(iv(),mv("confirm_swap_fonts"),n.map(function(e){var t=f(e,2),n=t[0],i=t[1];return hv(nv(),n,i)}),mv("learn_more"));BeFunky.confirm(i,{onConfirm:function(){return e()},onCancel:function(){return t("cancelled_by_user")},confirmText:"continue",cancelText:"cancel_install_fonts"})})}},{key:"getCompressedBlob",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.layerImageQuality,i=void 0===n?.95:n,r=t.compressSmallLayers,a=void 0!==r&&r,o=t.compressStyles,s=void 0===o||o,l=Object.assign({},e);return new Promise(function(e,t){var n=0,r=0;s&&(l.transformLabels=JSON.parse(JSON.stringify(l.transformLabels)),l.transformLabels.forEach(function(e){e.labelTextStyles.compressedStyles=BFN.ParseBFD.compressCharacterStyles(e.labelTextStyles.styles),delete e.labelTextStyles.styles})),l.editorImageBase64 instanceof Blob&&(n+=1,BFN.BlobUtils.blobToBase64(l.editorImageBase64).then(function(e){l.editorImageBase64=e,++r===n&&c()},function(e){return BeFunky.logError("Unable to convert editorImageBase64 Blob (from IndexedDB) to base64. Trying again...",e),BFN.PhotoEditorModel.getCurrentTextureBlob().then(function(e){return BFN.BlobUtils.blobToBase64(e)}).then(function(e){l.editorImageBase64=e,++r===n&&c()},function(e){BeFunky.throwError("Unable to get editorImageBase64 for saving",e),t(e)})})),l.thumbBase64 instanceof Blob&&(n+=1,BFN.BlobUtils.blobToBase64(l.thumbBase64).catch(function(e){return BeFunky.logError("Unable to convert project thumbnail to base64",e),""}).then(function(e){l.thumbBase64=e,++r===n&&c()}));var o=Object.keys(l.imageData).filter(function(e){return l.imageData[e]instanceof Blob}),u=Math.max(l.projectWidth,l.projectHeight,BFN.maxImageSizeLayer);if(n+=o.length,o.forEach(function(e){BFN.BlobUtils.downsizeImageBlob(l.imageData[e],{maxSize:u,quality:i,skipSmallImages:!a}).catch(function(t){return"skipped_small_image"!==t&&BeFunky.logError("Unable to downsize project blob",t),l.imageData[e]}).then(function(e){return BFN.BlobUtils.blobToBase64(e)}).catch(function(e){return BeFunky.logError("Unable to convert project blob to base64",e),""}).then(function(t){l.imageData[e]=t,++r===n&&c()})}),!n)return c();function c(){return BFN.ObjectCompressor.compress(l).then(function(t){e(new Blob([t],{type:"text/plain;charset=utf-8"}))})}})}}]),t}();BFN.SingletonQueue.add(function(){BFN.ProjectManager=new pv});var gv=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("TextureHistoryManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.validViewStates=[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,BFN.AppModelViewStates.VIEWING_DESIGNER],this.historyHash={},this.historyModifiedHash={},this.validViewStates.forEach(function(t){e.historyModifiedHash[t]=!1}),this.allowedTextureMegaBytes=BFN.sectionMemoryLimitMB,this.minHistoryStates=2,BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS.type,this.handlePhotoEditorCanvasModelClearItems.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS.type,this.handleCollageMakerCanvasModelClearItems.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS.type,this.handleDesignerCanvasModelClearItems.bind(this))}},{key:"addTextureHistory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t=t||BFN.AppModel.viewState,this.validViewStates.includes(t)){this.historyHash.hasOwnProperty(t)||(this.historyHash[t]={});var i=new BFN.TextureHistoryVO(e),r=this.historyHash[t];r.hasOwnProperty(e)&&(r[e].clear(),delete r[e]),r[e]=i,n.forEach(function(e){i.addUsedTexture(e)}),BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.filter(function(e){return e instanceof BFN.TransformItem}).forEach(function(e){return i.addUsedTexture(e.itemContent.texture)}),BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&BFN.PhotoEditorModel.currentTexture&&i.addUsedTexture(BFN.PhotoEditorModel.currentTexture),BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&(BFN.PhotoGrid.gridChildren.forEach(function(e){e.menuImageVO&&i.addUsedTexture(e.menuImageVO.imageTexture)}),i.addUsedTexture(BFN.CollageMakerCanvasPhotoGridModel.backgroundPatternTexture))}}},{key:"updateTextureHistory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t=t||BFN.AppModel.viewState,this.validViewStates.includes(t)){this.historyHash.hasOwnProperty(t)||(this.historyHash[t]={});var n=this.historyHash[t];for(var i in n)e.includes(parseInt(i))||(n[i].clear(),delete n[i])}}},{key:"getTextureHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e=e||BFN.AppModel.viewState,this.validViewStates.includes(e)?(this.historyHash.hasOwnProperty(e)||(this.historyHash[e]={}),Object.assign({},this.historyHash[e])):{}}},{key:"getBaseTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e=e||BFN.AppModel.viewState,!this.validViewStates.includes(e)||!this.historyHash.hasOwnProperty(e))return[];var n=[],i=this.historyHash[e];if(t.length)t.forEach(function(e){i.hasOwnProperty(e)&&i[e].baseTextures.forEach(function(e){e._destroyed||n.includes(e)||n.push(e)})});else for(var r in i){i[r].baseTextures.forEach(function(e){e._destroyed||n.includes(e)||n.push(e)})}return n}},{key:"getTextureHistoryStatus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e=e||BFN.AppModel.viewState,this.validViewStates.includes(e)){this.historyHash.hasOwnProperty(e)||(this.historyHash[e]={});var t=this.getTextureHistory(e),n=[];for(var i in t)n.push(parseInt(i));n.sort(function(e,t){return e-t});var r=this.getBaseTextures(e),a=r.reduce(function(e,t){return e+(t._destroyed?0:t.width*t.height)},0);return{textureHistory:t,timestamps:n,baseTextures:r,megabytes:Math.round(4*a/Math.pow(1024,2)*100)/100}}}},{key:"printTextureHistory",value:function(){}},{key:"cleanupTextureHistory",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=t||BFN.AppModel.viewState;var n=!1;if(this.validViewStates.includes(t)){var i=this.getTextureHistoryStatus(t);i.megabytes>this.allowedTextureMegaBytes&&i.timestamps.length>this.minHistoryStates&&function(){for(var r=[],a=i.timestamps.length;--a>=i.timestamps.length-e.minHistoryStates;)r.push(i.timestamps[a]);var o=e.getBaseTextures(null,r),s=v(e.validViewStates);s.splice(s.indexOf(t),1),s.forEach(function(t){e.getBaseTextures(t).forEach(function(e){o.includes(e)||o.push(e)})});var l=-1;for(a=i.timestamps.length-e.minHistoryStates;--a>-1;){var u=i.timestamps[a],c=e.getBaseTextures(t,[u]);if(c.length)if("break"===function(){var e=!0;if(c.forEach(function(t){e&&!o.includes(t)&&(e=!1)}),!e)return l=u,"break"}())break}if(t===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&i.timestamps.length>1){var h=BFN.PhotoEditorHistoryModel.getTimestamp(),d=BFN.PhotoEditorHistoryModel.getLastTimestamp(),m=i.timestamps[i.timestamps.length-1];isNaN(m)||isNaN(h)||!isNaN(d)||m!=h||(l=i.timestamps[i.timestamps.length-2])}if(l>=0){e.purgeEarlierTextureHistory(t,l,o);n=!0,e.historyModifiedHash[t]=!0}}()}return n}},{key:"purgeEarlierTextureHistory",value:function(e,t,n){var i=0;return i+=BFN.TransformStateModel.purgeEarlierTransitions(e,t,n),e===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&(i+=BFN.PhotoEditorHistoryModel.purgeEarlierHistory(t,n)),e===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&(i+=BFN.CollageMakerHistoryModel.purgeEarlierHistory(t,n)),i}},{key:"handlePhotoEditorCanvasModelClearItems",value:function(e){this.historyModifiedHash[BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR]=!1}},{key:"handleCollageMakerCanvasModelClearItems",value:function(e){this.historyModifiedHash[BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER]=!1}},{key:"handleDesignerCanvasModelClearItems",value:function(e){this.historyModifiedHash[BFN.AppModelViewStates.VIEWING_DESIGNER]=!1}}]),e}();BFN.SingletonQueue.add(function(){BFN.TextureHistoryManager=new gv});var fv=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BFN.ShaderPool={},this.cnt=0,this.setupFilters=[{key:"ColorFilter",cls:BFN.filters.ColorFilter},{key:"ExposureFilter",cls:BFN.filters.ExposureFilter},{key:"FillLightFilter",cls:BFN.filters.FillLightFilter},{key:"BeautifyFilter",cls:BFN.filters.BeautifyFilter},{key:"VibranceFilter",cls:BFN.filters.VibranceFilter},{key:"ColorMixerFilter",cls:BFN.filters.ColorMixerFilter},{key:"BrushFilter",cls:BFN.filters.BrushFilter},{key:"ColorReplaceFilter",cls:BFN.filters.ColorReplaceFilter},{key:"GaussianBlurFilter",cls:BFN.filters.GaussianBlurFilter,type:"filter"},{key:"LevelsFilter",cls:BFN.filters.LevelsFilter,type:"filter"}]}},{key:"createShaderPool",value:function(e){if(null!==(BFN&&void 0!==BFN.ObjectRenderer&&void 0!==BFN.ObjectRenderer.gl?BFN.ObjectRenderer.gl:BFN&&void 0!==BFN.Stage&&void 0!==BFN.Stage.gl?BFN.Stage.gl:null))if(this.cnt<this.setupFilters.length){var t=this.setupFilters[this.cnt];BFN.ShaderPool[t.key]=void 0!==t.type&&"filter"==t.type?new t.cls:new t.cls(BFN.ObjectRenderer.gl),this.cnt++,requestAnimationFrame(function(){this.createShaderPool(e)}.bind(this))}else e();else e()}}]),e}();BFN.ShaderManager=new fv;var vv=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this._settings={autosave:"ask",language:BeFunky.LanguageManager.language.app,artsy_fav:[],effects_fav:[],texture_fav:[],watermarks:[],batch_processing_fav:[],fonts_fav:[],fonts_added:[],colors_recent:[],color_library:[],use_case:"",snapping:"yes",display_distances:"no",guides:"no",dismissed_messages:[],trialing:"",theme_color:sn(),canvas_bg_color:mn().name};var t=Object.keys(this._settings);this.nonLocalSettings=["language","artsy_fav","effects_fav","texture_fav","watermarks","fonts_added","trialing","color_library","theme_color","canvas_bg_color"],this.localSettings={},this.remoteSettings={},this.allowLocalSaving=!1,this.allowRemoteSaving=!1,this.getLocalSettings=Promise.all(t.filter(function(t){return!e.nonLocalSettings.includes(t)}).map(function(t){return BFN.IndexedDB.get("options__".concat(t)).then(function(n){e.localSettings[t]=n},function(){})})),this.getRemoteSettings=new Promise(function(t){if(BFN.BfnService.userLoggedIn)return t(e.fetchRemoteSettings());t(),e.handleLoginBind=e.handleLogin.bind(e),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,e.handleLoginBind)}),this.settingsReady=Promise.all([this.getLocalSettings,this.getRemoteSettings]),this.settingsReady.then(function(){e.allowLocalSaving=!0,t.forEach(function(t){if(e.isValid(t,e.remoteSettings[t])){if("language"===t)return;e.updateSetting(t,e.remoteSettings[t],{updateUI:!1,source:"API"})}else e.isValid(t,e.localSettings[t])&&e.updateSetting(t,e.localSettings[t],{updateUI:!1,source:"IndexedDB"});var n=JSON.parse(JSON.stringify(e._settings[t]));e.updateUI(t,n)})}),this.uiReady=!1,this.queuedUiUpdates={},window.addEventListener("INIT_COMPLETE",function(){BFN.MainUI.addIdleRenderFunction(function(){e.uiReady=!0,Object.values(e.queuedUiUpdates).forEach(function(e){return e()})})}),this.persistSettings=BeFunky.debounce(this.persistSettings.bind(this),1e3),this.persistToAPILazyTimeout=null,un(function(t){e.updateSetting("theme_color",t,{updateUI:!1})},!1),gn(function(t){var n=t.name;e.updateSetting("canvas_bg_color",n,{updateUI:!1})})}},{key:"handleSettingUpdate",value:function(){var e=UITools.getToolValue("user_settings","updating_id"),t=UITools.getControlValue("user_settings_".concat(e));this.updateSetting(e,t,{source:"Settings Modal"})}},{key:"handleLogin",value:function(){var e=this;BFN.BfnService.userLoggedIn&&(BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleLoginBind),this.settingsReady=new Promise(function(t){e.fetchRemoteSettings().then(function(){e.log("Fetched user settings from API"),Object.keys(e._settings).forEach(function(t){if("language"!==t&&e.isValid(t,e.remoteSettings[t])){if("batch_processing_fav"===t){var n=!e.remoteSettings[t].length,i=!e._settings[t].isIdenticalTo(BFN.BatchToolManager.defaultBatchToolIDs);if(n||i)return void e.updateSetting(t,[].concat(v(e._settings[t]),v(e.remoteSettings[t])).unique(),{source:"Local + API"})}if("dismissed_messages"===t){var r=function(e){return e.endsWith("_clue")},a=!e.remoteSettings[t].find(r),o=e._settings[t].filter(r);if(a&&o.length)return void e.updateSetting(t,[].concat(v(e.remoteSettings[t]),v(o)).unique(),{source:"Migrated help clues"})}e.updateSetting(t,e.remoteSettings[t],{source:"API"})}}),t()}).catch(function(e){BeFunky.throwError("Unable to fetch remote settings after user login",e),t()})}))}},{key:"isValidID",value:function(e){return this._settings.hasOwnProperty(e)}},{key:"isValid",value:function(e,t){return BeFunky.SettingsService.isValid(e,t)}},{key:"getSetting",value:function(e){var t=this;if(!this.isValidID(e))throw"Invalid setting ID";return this.settingsReady.then(function(){return t._settings[e]})}},{key:"updateSetting",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.updateUI,r=void 0===i||i,a=n.source,o=void 0===a?"":a;if(!this.isValidID(e))throw console.log({id:e}),"Invalid setting ID";if(!this.isValid(e,t))throw console.log({id:e,value:t}),"Invalid setting value";Array.isArray(t)&&(t=t.slice()).unique();var s=JSON.stringify(t);JSON.stringify(this._settings[e])!==s&&(this.log("Update setting".concat(o?" from ".concat(o):"",":"),e,this._settings[e],"->",t),this._settings[e]=JSON.parse(s),r&&this.updateUI(e,JSON.parse(s)),this.persistSettings())}},{key:"updateUI",value:function(e,t){var n=this,i={autosave:function(){UITools.setControlValue("user_settings_".concat(e),t,!1),UITools.updateToolControl("user_settings_".concat(e))},language:function(){BeFunky.LanguageManager.setLanguage(t,["app"]),UITools.setToolValue("language","select",t),UITools.updateToolControls("language")},artsy_fav:function(){BFN.BfnService.userLoggedIn&&BFN.FavoritesManager.handleFavoritesLoaded("artsy",t)},effects_fav:function(){BFN.BfnService.userLoggedIn&&BFN.FavoritesManager.handleFavoritesLoaded("effect",t)},watermarks:function(){BFN.BfnService.userIsPlus&&BFN.WatermarkManager.loadWatermarkPresets(t)},texture_fav:function(){},batch_processing_fav:function(){BFN.BatchToolManager.selectedIDs=t},fonts_fav:function(){BFN.FontManager.fontMenuComponent?BFN.FontManager.fontMenuComponent.setState({favorites:t}):BFN.FontManager.favorites=t},fonts_added:function(){if(BFN.BfnService.userIsPlus){var e=t.map(function(e){return e.name}).unique(),n=t.filter(function(e){return"google"===e.type}),i=t.filter(function(e){return"uploaded"===e.type});n.forEach(function(e){var t=e.name,n=e.weights;BFN.FontManager.addUserDefinedFontFromSettings(t,"google",{weights:n,updateIfDuplicate:!0})}),i.reduce(function(e,t){var n=t.name,i=t.weight,r=t.fileName,a=e.find(function(e){return e.name===n});if(a)return a.weights=[].concat(v(a.weights),[i]),a.files=[].concat(v(a.files),[{weight:i,fileName:r}]),e;var o=new w(n,"uploaded",[i],{isUserDefined:!0,files:[{weight:i,fileName:r}]});return[].concat(v(e),[o])},[]).forEach(function(e){var t=e.name,n=e.weights,i=e.files;BFN.FontManager.addUserDefinedFontFromSettings(t,"uploaded",{weights:n,files:i,updateIfDuplicate:!0})}),BFN.CONST.FONT_LIST.filter(function(t){var n=t.isUserDefined,i=t.type,r=t.name;return n&&"system"!==i&&!e.includes(r)}).forEach(function(e){var t=e.name;BFN.FontManager.removeUserDefinedFont(t)})}},colors_recent:function(){BFN.ColorPickerPanel.recentColors=t},color_library:function(){BFN.ColorPickerPanel.colorLibraries=t},use_case:function(){},snapping:function(){UITools.setControlValue("alignment_".concat(e),"yes"===t,!1),UITools.updateToolControl("alignment_".concat(e)),UITools.applyToolControl("alignment_".concat(e))},display_distances:function(){UITools.setControlValue("alignment_".concat(e),"yes"===t,!1),UITools.updateToolControl("alignment_".concat(e)),UITools.applyToolControl("alignment_".concat(e))},guides:function(){UITools.setControlValue("alignment_".concat(e),"yes"===t,!1),UITools.updateToolControl("alignment_".concat(e)),UITools.applyToolControl("alignment_".concat(e))},dismissed_messages:function(){},trialing:function(){},theme_color:function(){!function(e){if(!an.includes(e))throw new Error("Invalid theme value: ".concat(BeFunky.stringValue(e)));on=e,ln.forEach(function(t){return t(e)})}(t),n.hideSettingsModalOverlay(),UITools.setControlValue("user_settings_theme_color",t,!1),UITools.updateToolControl("user_settings_theme_color"),UITools.applyToolControl("user_settings_theme_color")},canvas_bg_color:function(){!function(e){var t=hn.find(function(t){return t.name===e});if(!t)throw new Error("Invalid bgColorName value: ".concat(BeFunky.stringValue(e)));dn=t,pn.forEach(function(e){return e(t)})}(t),n.hideSettingsModalOverlay(),UITools.setControlValue("user_settings_canvas_bg_color",t,!1),UITools.updateToolControl("user_settings_canvas_bg_color"),UITools.applyToolControl("user_settings_canvas_bg_color")}};return this.uiReady?i[e]():"fonts_added"===e?i[e]():void(this.queuedUiUpdates[e]=function(){return i[e]()})}},{key:"persistSettings",value:function(){if(!this.allowLocalSaving)return this.persistSettings();this.persistToIndexedDB(),this.persistToAPI()}},{key:"persistToIndexedDB",value:function(){var e=this,t=this.diffSettings(this.localSettings,this.nonLocalSettings),n=Object.keys(t);n.length&&(this.ifLoggingEnabled(function(){e.log("Writing ".concat(n.length," setting(s) to IndexedDB"));var i=n.reduce(function(n,i){return l(l({},n),{},{[i]:{"Current IndexedDB Value":JSON.stringify(e.localSettings[i]),"New Value":JSON.stringify(t[i])}})},{});console.table(i)}),Object.entries(t).forEach(function(t){var n=f(t,2),i=n[0],r=n[1];BFN.IndexedDB.set("options__".concat(i),r).then(function(){e.localSettings[i]=r},function(e){return BeFunky.logError("Unable to update local setting ".concat(i),e)})}))}},{key:"persistToAPI",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.allowRemoteSaving?[]:Object.keys(this._settings).filter(function(e){return"language"!==e}),i=this.diffSettings(this.remoteSettings,n),r=Object.keys(i);r.length&&(t&&r.isIdenticalTo(["colors_recent"])?this.persistToAPILazyTimeout||(this.persistToAPILazyTimeout=setTimeout(function(){e.persistToAPILazyTimeout=null,e.persistToAPI(!1)},12e4)):(this.ifLoggingEnabled(function(){e.log("Sending ".concat(r.length," setting(s) to API"));var t=r.reduce(function(t,n){return l(l({},t),{},{[n]:{"Current Remote Value":JSON.stringify(e.remoteSettings[n]),"New Value":JSON.stringify(i[n])}})},{});console.table(t)}),BeFunky.SettingsService.updateUserSettings(i,function(t){var n=t.error;t.success;if(n)return BeFunky.logError("Unable to update remote settings",n);e.remoteSettings=Object.assign(e.remoteSettings,i)})))}},{key:"diffSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={};return Object.entries(this._settings).forEach(function(i){var r=f(i,2),a=r[0],o=r[1];t.includes(a)||(e.hasOwnProperty(a)||!Array.isArray(o)||o.length)&&JSON.stringify(e[a])!==JSON.stringify(o)&&(n[a]=o)}),n}},{key:"fetchRemoteSettings",value:function(){var e=this;return new Promise(function(t){BeFunky.SettingsService.getUserSettings(function(n){var i=n.error,r=n.settings;if(i)return BeFunky.logError("Unable to get settings from DynamoDB",i),t();e.remoteSettings=Object.assign({},r),e.allowRemoteSaving=!0,t()})})}},{key:"hideSettingsModalOverlay",value:function(){var e=this;this.resetModalOverlay&&this.resetModalOverlay();var t=BeFunky.getModal();if(t&&"settings_menu"===t.modalID){var n=t.modalElement.closest("#modal_root");n.children.length>1||(n.setStyles({transition:"background 0.3s ease-in-out"}),this.resetModalOverlay=BeFunky.wait(["raf","raf"],function(){n.setStyles({background:"transparent"}),e.resetModalOverlay=BeFunky.wait([5e3],function(){n.setStyles({background:""}),e.resetModalOverlay=BeFunky.wait([300],function(){n.setStyles({transition:""})})})}))}}},{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=BeFunky).logFeature.apply(e,["settings"].concat(n))}},{key:"ifLoggingEnabled",value:function(e){BeFunky.loggingFlags.includes("settings")&&e()}}]),e}();function yv(){var e=g(['<button class="help-clue__upgrade button button--xs button--link" @click=',">","</button>"]);return yv=function(){return e},e}function xv(){var e=g(['<button class="help-clue__upgrade button button--xs button--link" @click=',">","</button>"]);return xv=function(){return e},e}function _v(){var e=g(['<button class="help-clue__upgrade button button--xs button--link" @click=',">","</button>"]);return _v=function(){return e},e}function Iv(){var e=g(['<button class="help-clue__upgrade button button--xs button--link" @click=',">","</button>"]);return Iv=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.SettingsManager=new vv});var Tv=BeFunky.lit,bv=Tv.html,Sv=Tv.appLang,Cv={portrait_enhancer:[{type:"header",langID:"portrait_enhancer_announcement_clue_header"},{type:"text",langID:"portrait_enhancer_clue_body_1"},{type:"text",langID:"portrait_enhancer_clue_body_2"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.siteUrl,"learn/ai-portrait-enhancer/")}],image_enhancer:[{type:"header",langID:"image_enhancer_clue_headline"},{type:"text",langID:"image_enhancer_clue_body"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.siteUrl,"learn/ai-image-enhancer/")}],choose_font:[{type:"header",langID:"font_clue_title"},{type:"text",langID:"font_clue_choose_body"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-"}],manage_font:[{type:"header",langID:"font_clue_title"},{type:"text",langID:"font_clue_manage_body"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-"}],template_library:[{type:"text",langID:"guide_template_library"}],global_history:[{type:"text",langID:"guide_global_history"}],image_manager:[{type:"text",langID:"guide_image_manager"}],template_search:[{type:"header",langID:"guide_template_search_1"},{type:"text",langID:"guide_template_search_2"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360034833692"}],basic_shapes:[{type:"header",langID:"guide_basic_shapes_1"},{type:"text",langID:"guide_basic_shapes_2"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360034831012"}],effect_basic_settings:[{type:"icon_text",iconID:"edit-icon",iconSize:14,langID:"guide_icon_settings"},{type:"icon_text",iconID:"cancel-icon",iconSize:14,langID:"guide_icon_cancel"},{type:"icon_text",iconID:"checkmark-icon",iconSize:14,langID:"guide_icon_checkmark"},{type:"icon_text",iconID:"slider-icon",langID:"guide_icon_slider"},{type:"icon_text",isPlusBadge:!0,langID:["guide_icon_premium",{upgrade_now:function(){return bv(Iv(),function(){return BeFunky.openPricingModal()},Sv("upgrade_now",!0))}}],hideIfPremium:!0}],effect_basic_settings_frames:[{type:"icon_text",iconID:"edit-icon",iconSize:14,langID:"guide_icon_settings"},{type:"icon_text",iconID:"cancel-icon",iconSize:14,langID:"guide_icon_cancel"},{type:"icon_text",iconID:"checkmark-icon",iconSize:14,langID:"guide_icon_checkmark"},{type:"icon_text",iconID:"slider-icon",langID:"guide_icon_slider_frames"},{type:"icon_text",isPlusBadge:!0,langID:["guide_icon_premium",{upgrade_now:function(){return bv(_v(),function(){return BeFunky.openPricingModal()},Sv("upgrade_now",!0))}}],hideIfPremium:!0}],effect_basic_settings_favorites:[{type:"icon_text",iconID:"favorite-star-empty-icon",langID:"guide_icon_favorite"},{type:"icon_text",iconID:"edit-icon",iconSize:14,langID:"guide_icon_settings"},{type:"icon_text",iconID:"cancel-icon",iconSize:14,langID:"guide_icon_cancel"},{type:"icon_text",iconID:"checkmark-icon",iconSize:14,langID:"guide_icon_checkmark"},{type:"icon_text",iconID:"slider-icon",langID:"guide_icon_slider"},{type:"icon_text",isPlusBadge:!0,langID:["guide_icon_premium",{upgrade_now:function(){return bv(xv(),function(){return BeFunky.openPricingModal()},Sv("upgrade_now",!0))}}],hideIfPremium:!0}],effect_lens_flare:[{type:"icon_text",iconID:"target-icon",langID:"guide_icon_lens_flare_controls"},{type:"spacer",spaceHeight:1,color:"#464F61",alpha:1},{type:"icon_text",iconID:"edit-icon",iconSize:14,langID:"guide_icon_settings"},{type:"icon_text",iconID:"cancel-icon",iconSize:14,langID:"guide_icon_cancel"},{type:"icon_text",iconID:"checkmark-icon",iconSize:14,langID:"guide_icon_checkmark"},{type:"icon_text",iconID:"slider-icon",langID:"guide_icon_slider"},{type:"icon_text",isPlusBadge:!0,langID:["guide_icon_premium",{upgrade_now:function(){return bv(yv(),function(){return BeFunky.openPricingModal()},Sv("upgrade_now",!0))}}],hideIfPremium:!0},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.blogUrl,"lens-flare/"),linkTracking:"CREATE|HELP|LENS_FLARE"}],erase_mode:[{type:"text",langID:"erase_clue_description"},{type:"text",langID:["erase_clue_isolate_subject",{isolate_subject:function(){return"<strong>".concat(Sv("isolate_subject",!0),"</strong>")}}]},{type:"icon_text",iconID:"invert-selection-icon",langID:"guide_icon_invert"},{type:"icon_text",iconID:"vignette-icon",langID:"guide_icon_mask"},{type:"text",langID:["erase_clue_remove_keep",{keep:function(){return"<strong>".concat(Sv("keep",!0),"</strong>")},remove:function(){return"<strong>".concat(Sv("remove",!0),"</strong>")}}]},{type:"text",langID:"guide_paint_mode_zoomed_in"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360042227431"}],erase_mode_background:[{type:"text",langID:"erase_clue_description"},{type:"text",langID:["erase_clue_isolate_subject_background",{isolate_subject:function(){return"<strong>".concat(Sv("isolate_subject",!0),"</strong>")}}]},{type:"icon_text",iconID:"invert-selection-icon",langID:"guide_icon_invert"},{type:"icon_text",iconID:"vignette-icon",langID:"guide_icon_mask"},{type:"text",langID:["erase_clue_remove_keep",{keep:function(){return"<strong>".concat(Sv("keep",!0),"</strong>")},remove:function(){return"<strong>".concat(Sv("remove",!0),"</strong>")}}]},{type:"text",langID:"guide_paint_mode_zoomed_in"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360041749552"}],collage_layouts:[{type:"text",langID:"guide_collage_layout_1"},{type:"text",langID:"guide_collage_layout_2"},{type:"text",langID:"guide_collage_layout_3"}],collage_wizard:[{type:"text",langID:"guide_collage_wizard_next"}],layers_groups:[{type:"text",langID:"guide_layers_groups"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.blogUrl,"layers-and-groups/")}],resize_template:[{type:"header",langID:"guide_resize_template_1"},{type:"text",langID:"guide_resize_template_2"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360034937232"}],alignment_options:[{type:"text",langID:"guide_alignment_options"},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.blogUrl,"snap-lines/")}],cutout:[{type:"header",langID:["cutout_clue_title",{"new!":BeFunky.LanguageManager.getString("new!")}]},{type:"text",langID:["cutout_clue_remove_background",{remove_background:function(){return"<strong>".concat(Sv("remove_background",!0),"</strong>")}}]},{type:"icon_text",iconID:"invert-selection-icon",langID:"guide_icon_invert"},{type:"icon_text",iconID:"show-hide-mask-icon",langID:"guide_icon_mask"},{type:"text",langID:["cutout_clue_remove_keep",{keep:function(){return"<strong>".concat(Sv("keep",!0),"</strong>")},remove:function(){return"<strong>".concat(Sv("remove",!0),"</strong>")}}]},{type:"text",langID:["cutout_clue_background_color",{background_color:function(){return"<strong>".concat(Sv("background_color",!0),"</strong>")}}]},{type:"text",langID:"guide_paint_mode_zoomed_in"},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360041749552"}],batch_processing:[{type:"text",langID:"guide_batch_upload_steps"},{type:"text",langID:["guide_batch_edit_steps",{icon:BeFunky.getSvgHtml("batch-processing-icon",{classes:"icon icon--14"})}]},{type:"link",langID:"learn_more",url:"".concat(BeFunky.Params.blogUrl,"batch-processing-photos/")}],batch_upload:[{type:"header",langID:"guide_batch_upload"},{type:"text",langID:"guide_batch_upload_steps"}],batch_edit:[{type:"header",langID:"guide_batch_edit"},{type:"text",langID:["guide_batch_edit_steps",{icon:BeFunky.getSvgHtml("batch-processing-icon",{classes:"icon icon--14"})}]}],batch_icon:[{type:"text",langID:["batch_icon_guide_1",{icon:BeFunky.getSvgHtml("batch-processing-icon",{classes:"icon icon--14"})}]},{type:"text",langID:"batch_icon_guide_2"}],replace_color:[{type:"text",langID:["replace_color_clue_select_colors",{replace_color:function(){return"<strong>".concat(Sv("replace_color",!0),"</strong>")}}]},{type:"icon_text",iconID:"color-swatch-icon",langID:["replace_color_clue_swatch",{source_color:function(){return"<strong>".concat(Sv("source_color",!0),"</strong>")},target_color:function(){return"<strong>".concat(Sv("target_color",!0),"</strong>")}}]},{type:"icon_text",iconID:"slider-icon",langID:["replace_color_clue_tolerance",{tolerance:function(){return"<strong>".concat(Sv("tolerance",!0),"</strong>")},source_color:function(){return"<strong>".concat(Sv("source_color",!0),"</strong>")}}]},{type:"icon_text",iconID:"check-box-icon",langID:["replace_color_clue_preserve_luminosity",{preserve_luminosity:function(){return"<strong>".concat(Sv("preserve_luminosity",!0),"</strong>")},source_color:function(){return"<strong>".concat(Sv("source_color",!0),"</strong>")}}]},{type:"icon_text",iconID:"reset-icon",langID:["replace_color_clue_reset",{reset:function(){return"<strong>".concat(Sv("reset",!0),"</strong>")}}]},{type:"text",langID:["replace_color_clue_erase",{erase:function(){return"<strong>".concat(Sv("erase",!0),"</strong>")}}]},{type:"link",langID:"learn_more",url:"https://support.befunky.com/hc/en-us/articles/360010912612"}],skin_heal:{kb_article_id:"210192933",caption:"Click and drag to apply the effect to your image.",video:"perfect-skin.mp4"},wrinkles:{kb_article_id:"208811886",caption:"Click and drag to apply the effect to your image.",video:"wrinkles.mp4"},blemish_fix:{kb_article_id:"360027507692",caption:"Hover over the blemish, then click to remove.",video:"blemish-fix.mp4"},clone:{kb_article_id:"204748395",caption:"Click to select source area, then click and drag to clone.",video:"clone.mp4"}},Bv={};function Fv(){var e=g(['<img src="','" alt="','" width="','" height="','">']);return Fv=function(){return e},e}function Ev(){var e=g(['\n                <div class="multimedia-clue__vimeo-image" .vimeoId='," .aspectRatio="," .videoTitle=",">\n                    ",'\n                    <button aria-label="Play Video" class="button button--icon button--white-outline-notheme">\n                        ',"\n                    </button>\n                </div>\n            "]);return Ev=function(){return e},e}function Pv(){var e=g(['\n                <div class="multimedia-clue__image-container">\n                    ','\n                    <button aria-label="Expand Image" class="button button--icon button--white-outline-notheme">\n                        ',"\n                    </button>\n                </div>\n               "]);return Pv=function(){return e},e}function kv(){var e=g(["<p><strong>Looking for more inspiration? Check out another tutorial:</strong><br> ","</p>"]);return kv=function(){return e},e}function Nv(){var e=g(['\n            <div class="multimedia-clue__preview-container" style=','>\n                <div class="multimedia-clue__preview-content" style=',">\n                    ",'\n                    <button aria-label="Close Preview" class="button button--icon button--white-outline-notheme" @click="','">\n                        ',"\n                    </button>\n                </div>\n            </div>"]);return Nv=function(){return e},e}function Mv(){var e=g(['<iframe src="https://player.vimeo.com/video/','?title=1&portrait=0&byline=0&badge=0&autoplay=1" allow="autoplay; fullscreen" title="','"></iframe>']);return Mv=function(){return e},e}function Dv(){var e=g(['<img src="','" alt="','">']);return Dv=function(){return e},e}function wv(){var e=g(['\n            <panel-header\n                modifier="alternate"\n                lang-id="','"\n                buttons="close"\n                class="panel-header multimedia-clue__panel-header"\n                @CLOSE=',"\n                @drag=","\n            >\n            </panel-header>\n        "]);return wv=function(){return e},e}function Lv(){var e=g(['<div class="loading-spinner"></div>']);return Lv=function(){return e},e}function Ov(){var e=g(['\n        <div class="multimedia-clue__kb-content" style="','">\n        ',"\n        </div>"]);return Ov=function(){return e},e}function Rv(){var e=g(['\n            <div class="multimedia-clue__caption">\n                <p>',"</p>\n            </div>\n        "]);return Rv=function(){return e},e}function Av(){var e=g(['\n            <div class="multimedia-clue__video" style="','">\n                 <video autoplay loop muted>\n                    <source src="',"app/help-clues/",'" type="video/mp4">\n                </video>\n            </div>\n        ']);return Av=function(){return e},e}function Vv(){var e=g(['\n        <h4 class="multimedia-clue__title bold">\n            ','\n            <a href="https://support.befunky.com/hc/en-us/articles/','" target="_blank" rel="noopener" aria-label="Open Full Article" class="button button--icon button--link">\n                ',"\n            </a>\n        </h4>\n        "]);return Vv=function(){return e},e}function Uv(){var e=g(["\n            ",'\n            <div class="multimedia-clue__content-container">\n                ',"\n                ",'\n                <div class="multimedia-clue__content scrollable-content text-xs" @scroll="','" @click=','>\n                    <div class="multimedia-clue__video-placeholder"></div>\n                    ',"\n                    ","\n                    ","\n                </div>\n            </div>\n        "]);return Uv=function(){return e},e}Object.keys(Cv).forEach(function(e){Array.isArray(Cv[e])?Bv[e]={content:Cv[e],visibility:"HIDDEN",popover:null,renderContent:function(){BeFunky.throwError("Help clue popover not set up yet")}}:Bv[e]={content:Cv[e],visibility:"HIDDEN",isMultimediaClue:!0}});var Gv=BeFunky.lit,Hv=Gv.html,zv=Gv.lang,jv=Gv.icon,Xv=Gv.defineCustomElement,Wv=Gv.useState,Yv=Gv.useLayoutEffect,qv=Gv.elem,Kv=Gv.styleMap;function Qv(e){var t,n=e.toolName,i=e.articleId,r=void 0===i?"":i,a=e.video,o=void 0===a?"":a,s=e.caption,l=void 0===s?"":s,u=this,c=f(Wv(""),2),h=c[0],d=c[1],m=f(Wv(""),2),p=m[0],g=m[1],v=f(Wv(),2),y=v[0],x=v[1],_=f(Wv("right"),2),I=_[0],T=_[1],b=f(Wv(0),2),S=b[0],C=b[1];u._isSetup||(u._isSetup=!0,u.setStyles({top:"64px",left:"336px"}),BeFunky.waitUntil({condition:function(){return t=u.querySelector(".multimedia-clue__panel-header")},onTimeout:function(){BeFunky.throwError("Failed to initialize draggable multimedia clue")},onSuccess:function(){BFN.UI.draggablePanel(u,t,!0)},interval:50,maxAttempts:20})),Yv(function(){r&&function(e){x(),d(""),g("");var t=u.querySelector(".multimedia-clue__content");t&&(t.scrollTop=0);BeFunky.requestAPI("get/zendesk-article/".concat(e)).then(function(e){var t,n=e.data,i=n.zendesk_article,r=n.vimeo_images,a=(t=i.body,["em","span"].forEach(function(e){var n=new RegExp("<"+e+">|</"+e+">","g");t=t.replace(n,"")}),t),o=function(e,t){var n=document.createRange().createContextualFragment(e),i=n.querySelectorAll(".callout--pro-tip"),r=n.querySelectorAll(".callout--important");return o=i,o.forEach(function(e){e.addClass("pro-tip")}),function(e){e.forEach(function(e){var t=e.innerText.replace("Important Note:\n","");e.innerHTML="<p><strong>Important Note:</strong> ".concat(t,"</p>")})}(r),function(e){if(e.innerText.includes("Looking for more inspiration")){var t=e.querySelector("a");e.innerHTML="",e.append(qv(kv(),t))}}(n.lastElementChild),a=n,a.querySelectorAll(".image-with-lightbox").forEach(function(e){var t=e.firstElementChild,n=qv(Pv(),t,jv("pop-out-icon","icon icon--12")),i=e.parentNode;i.parentNode.insertBefore(n,i),e.remove()}),function(e,t){var n=Array.from(e.querySelectorAll("iframe"));Object.entries(t).forEach(function(e){var t,i,r,a=f(e,2),o=a[0],s=a[1],l=s.error,u=s.images,c=s.title;if(l||!u)BeFunky.throwError("Unable to fetch multimedia clue Vimeo placeholder image",s),i="",r=16/9;else{var h=288*(BeFunky.isRetina()?1.5:1);i=(t=u.find(function(e){return e.width>h})||u[u.length-1]).link,r=t.width/t.height}var d=qv(Ev(),o,r,c,i?Hv(Fv(),i,c,t.width,t.height):"",jv("pop-out-icon","icon icon--12")),m=n.find(function(e){return e.src.includes(o)}).parentNode;m.parentNode.replaceChild(d,m)})}(n,t),function(e){Array.from(e.children).forEach(function(e){"P"===e.nodeName&&"&nbsp;"===e.innerHTML&&e.remove()})}(n),function(e){Array.from(e.querySelectorAll("a")).forEach(function(e){e.setAttribute("target","_blank"),e.setAttribute("rel","noopener")})}(n),n;var a;var o}(a,r);d(o),g(i.title)}).catch(function(t){return BeFunky.throwError("Unable to fetch Help Clue KB content",e,t)})}(r)},[r]),Yv(function(){if(o){var e=u.querySelector("video");e&&e.load()}},[o]);var B,F={handleEvent:function(e){var t=e.target.scrollTop;(t<240||S<240)&&C(t)},passive:!0};return Hv(Uv(),Hv(wv(),n,P,N),function(){if(!y)return"";var e,t,n="image"===y.type?Hv(Dv(),y.src,y.alt||""):Hv(Mv(),y.vimeoId,y.videoTitle),i=(e=u.panelSize.width,t=u.panelSize.height,"right"===I?{top:0,alignItems:"center",left:"".concat(e+10,"px")}:"left"===I?{top:0,alignItems:"center",left:"".concat(-634,"px")}:"bottom-left"===I?{top:"".concat(t+10,"px"),right:0}:"bottom-right"===I?{top:"".concat(t+10,"px"),left:0}:"top-left"===I?{top:"".concat(-t-10,"px"),right:0,alignItems:"flex-end"}:"top-right"===I?{top:"".concat(-t-10,"px"),left:0,alignItems:"flex-end"}:{display:"none"}),r="image"===y.type?{}:{height:"".concat(Math.ceil(624/y.aspectRatio),"px"),background:"black"};return Hv(Nv(),Kv(i),Kv(r),n,E,jv("cancel-icon","icon icon--close icon--12"))}(),""===o?"":Hv(Av(),"transform: translateY(-".concat(S,"px)"),BeFunky.Params.globalImagesPath,o),F,k,Hv(Rv(),zv(l)),p?Hv(Vv(),p,r,jv("pop-out-icon","icon icon--close icon--12")):"",(B=h?"":"display: flex; justify-content: center; padding: 0 0 1rem;",Hv(Ov(),B,h||Hv(Lv()))));function E(){x()}function P(){x(),BFN.HelpClueManager.hide(n)}function k(e){var t=e.target.hasClass("multimedia-clue__image-container"),n=e.target.hasClass("multimedia-clue__vimeo-image");if(t||n){var i;if(t){var r=e.target.querySelector("img");i={type:"image",src:r.src,alt:r.alt}}if(n){var a=e.target;i={type:"video",vimeoId:a.vimeoId,aspectRatio:a.aspectRatio,videoTitle:a.videoTitle}}i&&(y&&JSON.stringify(i)===JSON.stringify(y)?x():(x(i),T(M())))}}function N(){if(y){var e=M();I!==e&&T(e)}}function M(){var e=BFN.appRect,t=parseInt(u.style.top),n=parseInt(u.style.left),i=u.panelSize.width,r=u.panelSize.height,a=400,o=624;if(n+i+10+o<e.width)return"right";if(o+10<n)return"left";if(t+r+10+a<e.height){if(n+10+o<e.width)return"bottom-right";if(10+o<e.width)return"bottom-left"}if(a+10<t){if(n+10+o<e.width)return"top-right";if(10+o<e.width)return"top-left"}return"hide"}}function Zv(){var e=g(['\n        <div class="help-clue" style="width: 288px">\n            ','\n            <div class="help-clue__footer">\n                ',"\n                ","\n            </div>\n        </div>\n        "]);return Zv=function(){return e},e}function Jv(){var e=g(["<button @click=",' class="help-clue__dismiss button button--blue button--xs">',"</button>"]);return Jv=function(){return e},e}function $v(){var e=g(['\n            <a class="help-clue__link" href=',' target="_blank" rel="noopener" data-bfntrack=',">","</a>\n        "]);return $v=function(){return e},e}function ey(){var e=g(['\n                <p class="help-clue__item help-clue__icon-text">\n                    ',"\n                    <string>","</string>\n                </p>"]);return ey=function(){return e},e}function ty(){var e=g(['<p class="help-clue__item help-clue__icon-text">\n                        <span class="badge badge--plus help-clue__icon"></span>\n                        <string>',"</string>\n                    </p>"]);return ty=function(){return e},e}function ny(){var e=g(['<p class="help-clue__item">',"</p>"]);return ny=function(){return e},e}function iy(){var e=g(['<h5 class="help-clue__item help-clue__header">',"</h5>"]);return iy=function(){return e},e}function ry(){var e=g(['<div class="popover"></div>']);return ry=function(){return e},e}var ay=BeFunky.lit,oy=ay.elem,sy=ay.html,ly=ay.appLang,uy=ay.render,cy=ay.icon,hy=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){var e=this;this.clueIDs=Object.keys(Bv),this.cluesIDsDismissedThisSession=[],this.hasMigratedFromLocalStorage=!1,this.sideMenuContainer=document.getElementById("side_panel_menu_panels"),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,function(){e.multimediaClue&&e.multimediaClue.toolName&&BFN.HelpClueManager.hide(e.multimediaClue.toolName)}),this.multimediaClue=null}},{key:"setup",value:function(e,t){return this._setRenderOptions(e,t)}},{key:"show",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.force,r=void 0!==i&&i,a=n.renderOptions;if(BFN.cluesToHideOnTablet.find(function(t){return e===t})&&BeFunky.isTablet)return Promise.resolve(!1);if(!this._setRenderOptions(e,a))return Promise.resolve(!1);var o=Bv[e];return r?(this._renderAndFadeIn(e),o.wasForceShown=!0,Promise.resolve(!0)):this.clueIDs.some(function(e){return"VISIBLE"===Bv[e].visibility&&Bv[e].isMultimediaClue})&&(o.isMultimediaClue||this.sideMenuContainer.contains(o.popover))?Promise.resolve(!1):(o.visibility="PENDING",this.wasClueDismissed(e).then(function(n){return"PENDING"!==o.visibility?"VISIBLE"===o.visibility:n?(o.visibility="HIDDEN",!1):(t._renderAndFadeIn(e),o.wasForceShown=!1,!0)}))}},{key:"hide",value:function(e){if(this._validateID(e)){var t=Bv[e];t.visibility="HIDDEN",t.popover&&t.popover.hide(),t.isMultimediaClue&&(t.wasForceShown||this._dismissClue(e),this.multimediaClue&&this.multimediaClue.hide())}}},{key:"toggle",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.renderOptions,r=n.force,a=void 0===r||r;if(!this._setRenderOptions(e,i))return Promise.resolve(!1);"boolean"!=typeof t&&(t="HIDDEN"===Bv[e].visibility),t?(this.clueIDs.forEach(function(t){Bv[t].isMultimediaClue&&t!==e&&(Bv[t].visibility="HIDDEN")}),this.show(e,{force:a})):this.hide(e)}},{key:"wasClueDismissed",value:function(e){return this._validateID(e)?this.cluesIDsDismissedThisSession.includes(e)?Promise.resolve(!0):this._getDismissedIDs().then(function(t){return Boolean(t.find(function(t){return t==="".concat(e,"_clue")}))}):Promise.resolve(!1)}},{key:"showWalkthrough",value:function(e){var t=this;return e.some(function(e){return!t._validateID(e)})?Promise.resolve(!1):e.every(function(e){return Bv[e].renderOptions})?void this._getDismissedIDs().then(function(n){return!e.every(function(e){return n.includes("".concat(e,"_clue"))})&&(e.slice(0,e.length-1).forEach(function(n,i){Bv[n].renderOptions.button={langID:"next",onClick:function(){return t.show(e[i+1],{force:!0})}}}),e.slice(1).forEach(function(e){t.hide(e)}),t.show(e[0],{force:!0}),!0)}):(BeFunky.throwError("Walkthrough clues not setup"),Promise.resolve(!1))}},{key:"handleSideMenuTransition",value:function(){var e=this,t=["VISIBLE","PENDING"];return this.clueIDs.filter(function(e){return t.includes(Bv[e].visibility)}).forEach(function(t){var n=Bv[t],i=n.popover,r=n.wasForceShown,a=n.isMultimediaClue;i&&e.sideMenuContainer.contains(i)?e.hide(t):a&&!r&&e.hide(t)})}},{key:"_validateID",value:function(e){return!!this.clueIDs.includes(e)||(BeFunky.throwError('Invalid help clue ID "'.concat(e,'"')),!1)}},{key:"_setRenderOptions",value:function(e,t){return!!this._validateID(e)&&(!!Bv[e].isMultimediaClue||(t?Bv[e].renderOptions=t:t=Bv[e].renderOptions,t?"function"==typeof t.container||t.container instanceof HTMLElement||(BeFunky.throwError('No container for help clue "'.concat(e,'"'),t.container),!1):(BeFunky.throwError('No render options for help clue "'.concat(e,'"')),!1)))}},{key:"_getDismissedIDs",value:function(){var e=this;return BFN.SettingsManager.getSetting("dismissed_messages").then(function(t){return e._migrateClueDataFromLocalStorage(t)})}},{key:"_dismissClue",value:function(e){if(this._validateID(e)){Bv[e].popover&&this.hide(e),this.cluesIDsDismissedThisSession.push(e);var t="".concat(e,"_clue");this._getDismissedIDs().then(function(e){e.includes(t)||BFN.SettingsManager.updateSetting("dismissed_messages",[].concat(v(e),[t]))})}}},{key:"_renderAndFadeIn",value:function(e){var t=this,n=Bv[e],i=n.renderOptions,r=n.content;if(n.isMultimediaClue)return this.multimediaClue||(Xv("multimedia-clue",Qv),this.multimediaClue=document.getElementById("multimedia_clue_haunted")),n.visibility="VISIBLE",this.multimediaClue.toolName=e,this.multimediaClue.articleId=r.kb_article_id,this.multimediaClue.caption=r.caption,this.multimediaClue.video=r.video,void("function"==typeof this.multimediaClue.show?this.multimediaClue.show():BeFunky.wait([100,"raf"],function(){"VISIBLE"===n.visibility&&t.multimediaClue.show()}));n.popover?n.renderContent():(n.popover=this._createPopover(e),n.popover.strong=!0);var a=["left","right","top","zIndex"],o=["side","positionFactor","strong"];Object.entries(i).forEach(function(t){var i=f(t,2),r=i[0],s=i[1];if(a.includes(r))n.popover.setStyles({[r]:s});else if(o.includes(r))n.popover[r]!==s&&(n.popover[r]=s);else if("container"===r){var l=n.popover.parentElement;"function"==typeof s&&(s=s()),s instanceof HTMLElement?l!==s&&s.appendChild(n.popover):BeFunky.throwError('Invalid container for help clue "'.concat(e,'"'),s)}else"button"!==r&&BeFunky.throwError('Unknown help clue render option "'.concat(r,'"'))}),n.visibility="VISIBLE",requestAnimationFrame(function(){"VISIBLE"===n.visibility&&n.popover.show(!0)})}},{key:"_createPopover",value:function(e){var t=oy(ry());return BFN.UI.popover(t),this._addContent(e,t.container),t}},{key:"_addContent",value:function(e,t){var n=this,i=Bv[e],r=i.content,a=i.renderOptions,o={header:function(e){var t=e.langID;return sy(iy(),ly(t))},text:function(e){var t=e.langID;return sy(ny(),ly(t))},icon_text:function(e){var t=e.langID,n=e.iconID,i=e.isPlusBadge,r=e.iconSize,a=void 0===r?16:r;if(i)return sy(ty(),ly(t));var o=(18-a)/2;return sy(ey(),cy(n,"icon icon--".concat(a," help-clue__icon"),{style:"margin-top: ".concat(o,"px;")}),ly(t))}},s=r.find(function(e){return"link"===e.type}),l=function(e){return e.hideIfPremium&&BeFunky.isPlus()?"":o[e.type]?o[e.type](e):""},u=function(){return sy(Zv(),r.map(l),s?(i=(t=s).langID,o=t.url,u=t.linkTracking,c=void 0===u?"":u,sy($v(),o,c,ly(i))):"",function(){var t=a.button&&a.button.langID?a.button.langID:"ok_got_it";return sy(Jv(),function(){a.button&&a.button.onClick&&a.button.onClick(),n._dismissClue(e)},ly(t))}());var t,i,o,u,c},c=function(){return uy(u(),t)};BeFunky.LanguageManager.addLanguageUpdateListener(c),r.find(function(e){return e.hideIfPremium})&&BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,c),c(),i.renderContent=c}},{key:"_migrateClueDataFromLocalStorage",value:function(e){var t=this;if(this.hasMigratedFromLocalStorage)return e;if(this.hasMigratedFromLocalStorage=!0,e.find(function(e){return e.endsWith("_clue")}))return e;var n=[];try{n=Object.keys(localStorage)}catch(e){}var i=n.filter(function(e){return e.startsWith("guide_")}).map(function(e){BeFunky.removeLocal(e);var n=e.replace("guide_","");return!!t.clueIDs.includes(n)&&n}).filter(Boolean);return Object.entries({walkthrough_batch_processing:["batch_upload","batch_edit"],walkthrough_batch_icon:["batch_icon"]}).forEach(function(e){var t=f(e,2),r=t[0],a=t[1];n.includes(r)&&(BeFunky.removeLocal(r),i.push.apply(i,v(a)))}),n.includes("disableTips")&&BeFunky.removeLocal("disableTips"),console.log("Migrated ".concat(i.length," clues from LocalStorage"),i),i.length&&(e=[].concat(v(e),v(i.map(function(e){return"".concat(e,"_clue")}))).unique(),BFN.SettingsManager.updateSetting("dismissed_messages",e)),e}}]),e}();BFN.SingletonQueue.add(function(){BFN.HelpClueManager=new hy});var dy=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.zoomKeyCodes=[70,48,BeFunky.isFirefox?61:187,BeFunky.isFirefox?173:189],this.editorOverrideKeyCodes=[66,73,79,86],this.keyActionPerformed=!1,this.handleDocumentKeyDownBind=this.handleDocumentKeyDown.bind(this),this.handleDocumentKeyUpBind=this.handleDocumentKeyUp.bind(this),document.addEventListener("keydown",this.handleDocumentKeyDownBind,!0),document.addEventListener("keyup",this.handleDocumentKeyUpBind,!0),window.addEventListener("INIT_COMPLETE",function(){BFN.MainUI.addIdleRenderFunction(function(){return e.addShortcutsToUI()})})}},{key:"processZoomKey",value:function(e){if(!(BFN.ImageCutout.cutoutActive||BFN.ImagePainterUndoManager&&BFN.ImagePainterUndoManager.currentImagePainter&&BFN.ImagePainterUndoManager.currentImagePainter.mouseDown))switch(e){case 70:UITools.setToolValue("zoom","full_screen",!0,!1),UITools.applyTool("zoom"),UITools.setToolValue("zoom","full_screen",!1,!1);break;case 48:UITools.setToolValue("zoom","exact_fit",!0),UITools.applyTool("zoom"),UITools.setToolValue("zoom","exact_fit",!1),UITools.applyToolControl("zoom_minus");break;case 187:case 61:UITools.setControlValue("zoom_plus",!0,!0),UITools.applyToolControl("zoom_plus"),UITools.setControlValue("zoom_plus",!1,!1),UITools.applyToolControl("zoom_minus");break;case 189:case 173:UITools.setControlValue("zoom_minus",!0,!0),UITools.applyToolControl("zoom_minus"),UITools.setControlValue("zoom_minus",!1,!1),UITools.applyToolControl("zoom_minus")}}},{key:"processSaveKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"computer"!==e&&"project"!==e||(this.exitTransformToolFrameIfActive(),UITools.setToolValue("editor_save_image",e,!0,!1),UITools.applyTool("editor_save_image"),UITools.setToolValue("editor_save_image",e,!1,!1))}},{key:"processOpenKey",value:function(){UITools.setToolValue("open_project","computer",!0,!1),UITools.applyTool("open_project"),UITools.setToolValue("open_project","computer",!1,!1)}},{key:"processUndoRedo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;"undo"!==e&&"redo"!==e||(UITools.setToolValue("editor_history_action",e,!0),UITools.applyTool("editor_history_action"),UITools.setToolValue("editor_history_action",e,!1))}},{key:"processSelectAll",value:function(){this.exitTransformToolFrameIfActive();var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer),t=v(e.children);if(t.includes(BFN.TransformItemGroup)&&t.splice(t.indexOf(BFN.TransformItemGroup),1),t.length>1)e.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=e,e.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=e.canvasScale,BFN.TransformItemGroup.addGroupItems(t),e.updateTransformItemGroup();else if(1===t.length){var n=t[0];n.selectedByMouse=!1,n.selectItem()}}},{key:"showBatchProcessor",value:function(){this.exitTransformToolFrameIfActive(),BFN.BatchProcessingManager.openModal()}},{key:"showSettingsModal",value:function(){this.exitTransformToolFrameIfActive(),jm()}},{key:"processGroupItems",value:function(){if(this.exitTransformToolFrameIfActive(),BFN.TransformItemGroup.selectedItems.length){var e="transform_create_group";UITools.setControlValue(e,!0),UITools.applyToolControl(e),UITools.setControlValue(e,!1)}}},{key:"processCopyCut",value:function(e){switch(e){case 67:BFN.PatchManager.copySelection();break;case 88:BFN.PatchManager.cutSelection()}}},{key:"exitTransformToolFrameIfActive",value:function(){return!(!BFN.TransformModel.transformToolFrame||!BFN.TransformModel.transformToolFrame.active)&&(BFN.TransformModel.transformToolFrame.setup(null),!0)}},{key:"addShortcutsToUI",value:function(){if(!BeFunky.isTablet){var e=function(e){return BFN.shortcutString(BFN.shortcutText(e))},t=function(e){return BFN.shortcutString(BFN.openImageShortcutText(e))};document.getElementById("open_project_computer").appendChild(t("O")),document.getElementById("editor_load_image_computer").appendChild(t("O")),document.getElementById("editor_save_image_computer").appendChild(e("S")),document.getElementById("editor_save_image_project").appendChild(e("⇧S"))}}},{key:"getShortcutTooltip",value:function(e){var t=function(e){return BeFunky.LanguageManager.getString(e)},n=function(e){return BFN.shortcutString(BFN.shortcutText(e))},i={undo:"".concat(t("undo")," ").concat(n("Z").outerHTML),redo:"".concat(t("redo")," ").concat(n("⇧Z").outerHTML),batch:"".concat(t("batch_processing")," ").concat(n("B").outerHTML),fullscreen:"".concat(t("fullscreen")," ").concat(n("F").outerHTML)}[e];return i||(BeFunky.throwError("Invalid shortcut tooltip",e),"")}},{key:"handleDocumentKeyDown",value:function(e){var t=this;if(window.isAppOpen){var n=!0;n=(n=(n=(n=(n=(n=(n=n&&(BFN.AppModel.viewingEditor&&(BFN.PhotoEditorModel.currentTexture||this.editorOverrideKeyCodes.includes(e.keyCode))||BFN.AppModel.viewingCollage||BFN.AppModel.viewingDesigner))&&!BeFunky.isModalOpen())&&!BeFunky.isLoadScreenActive())&&(!BFN.FabricManager.iTextEditing||[66,73,85].includes(e.keyCode)))&&!this.keyActionPerformed)&&!BFN.isSortableListDragActive)&&!BeFunky.isPointerDown;var i=[];BFN.TransformItemIsolator.active&&i.push.apply(i,[83,65,66,71,67,88,86,79,73,13]),n=n&&!i.includes(e.keyCode);var r=function(t){BFN.SentryManager.reportBreadcrumb('Key: "'.concat(e.key,'" (').concat(e.keyCode,")").concat(BFN.SentryManager.getSpecialKeyString(e)).concat(t?" -> ".concat(t):""),"key_down","keyboard_manager")};if(e.ctrlKey||e.metaKey||[13].includes(e.keyCode)){var a=!1;if(this.zoomKeyCodes.includes(e.keyCode)&&(a=!0,n&&(r("processZoomKey"),this.processZoomKey(e.keyCode))),83===e.keyCode&&(a=!0,n&&(r("processSaveKey"),this.processSaveKey(e.shiftKey?"project":"computer"))),79===e.keyCode&&(a=!0,n&&(r("processOpenKey"),this.processOpenKey())),90===e.keyCode&&(BFN.FabricManager.iTextEditing||(a=!0,n&&(r("processUndoRedo"),this.processUndoRedo(e.shiftKey?"redo":"undo")))),65===e.keyCode&&(BeFunky.isTextBoxFocused()||(a=!0,n&&(r("processSelectAll"),this.processSelectAll()))),66===e.keyCode&&(a=!0,n)){var o=BFN.TransformModel.selectedTransformItem&&("text"===BFN.TransformModel.selectedTransformItem.type||"text"===BFN.TransformModel.selectedTransformItem.groupType)||BFN.TransformModel.selectedTransformItemText?document.getElementById("text_edit_bold"):null;o?(r("toggleTextBold"),o.click()):(r("showBatchProcessor"),this.showBatchProcessor())}if(73===e.keyCode&&(a=!e.altKey&&!e.shiftKey,n&&a)){var s=BFN.TransformModel.selectedTransformItem&&("text"===BFN.TransformModel.selectedTransformItem.type||"text"===BFN.TransformModel.selectedTransformItem.groupType)||BFN.TransformModel.selectedTransformItemText?document.getElementById("text_edit_italic"):null;s?(r("toggleTextItalic"),s.click()):(r("showSettingsModal"),this.showSettingsModal())}if(85===e.keyCode){var l=BFN.TransformModel.selectedTransformItem&&("text"===BFN.TransformModel.selectedTransformItem.type||"text"===BFN.TransformModel.selectedTransformItem.groupType)||BFN.TransformModel.selectedTransformItemText?document.getElementById("text_edit_underline"):null;l&&(a=!0,n&&(r("toggleTextUnderline"),l.click()))}if(71===e.keyCode&&(a=!0,n&&(r("processGroupItems"),this.processGroupItems())),[67,88].includes(e.keyCode)&&!BeFunky.isTextBoxFocused()&&(a=!0,n&&(r("processCopyCut"),this.processCopyCut(e.keyCode))),86===e.keyCode&&!BeFunky.isTextBoxFocused()&&n){this.keyActionPerformed=!0;var u=function e(t){r("handlePaste"),BFN.ClipboardManager.handlePaste(t),document.documentElement.removeEventListener("paste",e)};return document.documentElement.addEventListener("paste",u),void document.documentElement.addEventListener("keyup",function e(){document.documentElement.removeEventListener("keyup",e),document.documentElement.removeEventListener("paste",u),t.keyActionPerformed=!1})}if(BFN.TransformModel.transformToolFrame&&!BeFunky.isTextBoxFocused())switch(e.keyCode){case 13:r("exitTransformToolFrameIfActive"),a=this.exitTransformToolFrameIfActive()}a&&(e.preventDefault(),n&&(this.keyActionPerformed=!0,setTimeout(function(){t.keyActionPerformed=!1},80)))}}}},{key:"handleDocumentKeyUp",value:function(e){18===e.keyCode&&e.preventDefault()}}]),n}();BFN.SingletonQueue.add(function(){BFN.KeyboardManager=new dy});var my=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues(),this.initDebug()}},{key:"initDefaultValues",value:function(){this.debug=!1,this.gestureActive=!1,this.activePointerIDs=[],this.activePointerData={},this.gestureTimeoutIDs={},this.selectedTransformItems=[],this.canvas=null,this.canvasModel=null,this.canvasStartScale=1,this.prevCenterPoint=null,this.eventListenersActive=!1,this.handlePointerDownBind=this.handlePointerDown.bind(this),this.handlePointerMoveBind=this.handlePointerMove.bind(this),this.handlePointerUpBind=this.handlePointerUp.bind(this),this.handleTouchEndBind=this.handleTouchEnd.bind(this),this.handleTouchCancelBind=this.handleTouchCancel.bind(this),this.handlePreRenderBind=this.handlePreRender.bind(this),document.addEventListener(BeFunky.pointerdown,this.handlePointerDownBind,!0)}},{key:"initDebug",value:function(){if(this.debug){this.debugDiv=document.createElement("div"),this.debugDiv.setStyles({position:"absolute",width:"200px",height:"200px",backgroundColor:"white",zIndex:5e3,border:"1px solid black",right:"10px",top:"10px",color:"black",fontSize:"10px",overflow:"scroll"}),document.body.appendChild(this.debugDiv),this.pointer1div=document.createElement("div"),this.pointer1div.setStyles({position:"absolute",left:0,top:0,width:0,height:0,zIndex:5e3,pointerEvents:"none"});var e=document.createElement("div");e.setStyles({position:"relative",left:"-35px",top:"-35px",width:"70px",height:"70px",backgroundColor:"red",borderRadius:"35px"}),this.pointer1div.appendChild(e),document.body.appendChild(this.pointer1div),this.pointer2div=document.createElement("div"),this.pointer2div.setStyles({position:"absolute",left:0,top:0,width:0,height:0,zIndex:5e3,pointerEvents:"none"});var t=document.createElement("div");t.setStyles({position:"relative",left:"-35px",top:"-35px",width:"70px",height:"70px",backgroundColor:"blue",borderRadius:"35px"}),this.pointer2div.appendChild(t),document.body.appendChild(this.pointer2div),this.centerdiv=document.createElement("div"),this.centerdiv.setStyles({position:"absolute",left:0,top:0,width:0,height:0,zIndex:5e3,pointerEvents:"none"});var n=document.createElement("div");n.setStyles({position:"relative",left:"-15px",top:"-15px",width:"30px",height:"30px",backgroundColor:"yellow",borderRadius:"15px"}),this.centerdiv.appendChild(n),document.body.appendChild(this.centerdiv)}}},{key:"startGesture",value:function(){this.gestureActive||2!==this.activePointerIDs.length||(this.gestureActive=!0,this.log("START GESTURE"),this.canvas=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),this.canvasModel=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),this.canvasStartScale=this.canvasModel.canvasScale,this.canvasModel.canvasScaling=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handlePreRenderBind),BFN.ZoomRegion.show())}},{key:"stopGesture",value:function(){this.gestureActive&&(this.gestureActive=!1,this.log("STOP GESTURE"),this.canvasModel.canvasScaling=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handlePreRenderBind),this.canvas=null,this.canvasModel=null,this.canvasStartScale=1,this.prevCenterPoint=null)}},{key:"processGesture",value:function(){if(this.gestureActive&&2===this.activePointerIDs.length){var e=this.activePointerData[this.activePointerIDs[0]],t=this.activePointerData[this.activePointerIDs[1]],n=Math.sqrt(Math.pow(t.sx-e.sx,2)+Math.pow(t.sy-e.sy,2)),i=Math.sqrt(Math.pow(t.tx-e.tx,2)+Math.pow(t.ty-e.ty,2)),r=(e.tx+t.tx)/2,a=(e.ty+t.ty)/2;this.prevCenterPoint||(this.prevCenterPoint=new PIXI.Point((e.sx+t.sx)/2,(e.sy+t.sy)/2));var o=r-this.prevCenterPoint.x,s=a-this.prevCenterPoint.y;this.prevCenterPoint.x=r,this.prevCenterPoint.y=a;var l=this.canvasStartScale*(i/n),u=Math.min(this.canvasModel.maxCanvasScale,Math.max(this.canvasModel.minCanvasScale,l));(l<u||l>u)&&(e.sx=e.tx,e.sy=e.ty,t.sx=t.tx,t.sy=t.ty,this.canvasStartScale=u),this.canvas.canvasContainer.x+=o/u,this.canvas.canvasContainer.y+=s/u,this.canvasModel.canvasScale=u,this.debug&&(this.pointer1div.setStyles({left:"".concat(e.tx,"px"),top:"".concat(e.ty,"px")}),this.pointer2div.setStyles({left:"".concat(t.tx,"px"),top:"".concat(t.ty,"px")}),this.centerdiv.setStyles({left:"".concat(r,"px"),top:"".concat(a,"px")}))}}},{key:"toggleEventListeners",value:function(e){if(this.eventListenersActive!==e){this.eventListenersActive=e,window.preventPointerMoveThrottling=e;var t=document["".concat(this.eventListenersActive?"add":"remove","EventListener")];t(BeFunky.pointermove,this.handlePointerMoveBind,!0),t(BeFunky.pointerup,this.handlePointerUpBind,!0),t("touchend",this.handleTouchEndBind,!0),t("touchcancel",this.handleTouchCancelBind,!0)}}},{key:"clearGestureTimeouts",value:function(){this.gestureTimeoutIDs.init&&(clearTimeout(this.gestureTimeoutIDs.init),delete this.gestureTimeoutIDs.init),this.gestureTimeoutIDs.start&&(clearTimeout(this.gestureTimeoutIDs.start),delete this.gestureTimeoutIDs.start)}},{key:"log",value:function(){if(this.debug){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.debugDiv.innerHTML+=t.join(" ")+"<br>",this.debugDiv.scrollTop=this.debugDiv.scrollHeight}}},{key:"handlePointerDown",value:function(e){var t=this;if("touch"===e.pointerType&&e.target instanceof HTMLCanvasElement){var n;if(this.log(e.pointerType,"down",e.pointerId),!this.activePointerIDs.length)if(this.selectedTransformItems.length&&this.selectedTransformItems.splice(0),BFN.TransformModel.selectedTransformItem)if(BFN.TransformModel.selectedTransformItem===BFN.TransformItemGroup)(n=this.selectedTransformItems).push.apply(n,v(BFN.TransformItemGroup.selectedItems));else this.selectedTransformItems.push(BFN.TransformModel.selectedTransformItem);if(this.toggleEventListeners(!0),this.activePointerIDs.length<2&&!this.activePointerIDs.includes(e.pointerId)&&(this.activePointerIDs.push(e.pointerId),this.activePointerData[e.pointerId]={tx:e.clientX,ty:e.clientY},2===this.activePointerIDs.length)){for(var i in this.clearGestureTimeouts(),this.activePointerData)this.activePointerData[i].sx=this.activePointerData[i].tx,this.activePointerData[i].sy=this.activePointerData[i].ty;var r=!1;(r=(r=r||BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture)||!!BFN.FabricManager.currentTextTransformItem)||(BFN.ActiveDraggers.forEach(function(e){1===t.selectedTransformItems.length&&t.selectedTransformItems[0]!==e.item&&e.wasDragged&&t.selectedTransformItems.splice(0),e.stopDrag()}),this.gestureTimeoutIDs.init=setTimeout(function(){if(delete t.gestureTimeoutIDs.init,2===t.activePointerIDs.length){BFN.ImageCutout.cutoutActive||BFN.ImageCutout.painter.mouseDown?BFN.ImageCutout.handleKeyDownBind({keyCode:27}):BFN.ImagePainterUndoManager.currentImagePainter&&BFN.ImagePainterUndoManager.currentImagePainter.cancelPaintStroke();var e=new PointerEvent(BeFunky.pointerup,{view:window,bubbles:!0,cancelable:!0,clientX:t.activePointerData[t.activePointerIDs[0]].tx,clientY:t.activePointerData[t.activePointerIDs[0]].ty});document.dispatchEvent(e),BFN.MainUI.emit("pointerup",BFN.MainUI.pointerEvent),BFN.MainUI.emit("pointerupoutside",BFN.MainUI.pointerEvent),t.selectedTransformItems.length&&BFN.GroupManager.selectItems(t.selectedTransformItems),t.gestureTimeoutIDs.start=setTimeout(function(){delete t.gestureTimeoutIDs.start,t.startGesture()},0)}},0))}2===this.activePointerIDs.length&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}}},{key:"handlePointerMove",value:function(e){this.activePointerData.hasOwnProperty(e.pointerId)&&(this.activePointerData[e.pointerId].tx=e.clientX,this.activePointerData[e.pointerId].ty=e.clientY,this.pointerMoved=!0,this.gestureActive&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),BFN.MainUI.requestRender()))}},{key:"handlePointerUp",value:function(e){"touch"===e.pointerType&&this.activePointerIDs.includes(e.pointerId)&&(this.log(e.pointerType,"up",e.pointerId),this.activePointerIDs.splice(this.activePointerIDs.indexOf(e.pointerId),1),delete this.activePointerData[e.pointerId],this.clearGestureTimeouts(),this.stopGesture(),this.activePointerIDs.length||this.toggleEventListeners(!1))}},{key:"handleTouchEnd",value:function(e){!e.touches.length&&this.activePointerIDs.length&&this.handleTouchCancel(e)}},{key:"handleTouchCancel",value:function(e){var t=this;this.activePointerIDs.forEach(function(e){t.activePointerIDs.splice(t.activePointerIDs.indexOf(e),1),delete t.activePointerData[e]}),this.stopGesture(),this.toggleEventListeners(!1)}},{key:"handlePreRender",value:function(e){this.pointerMoved&&(this.pointerMoved=!1,this.processGesture())}},{key:"multiplePointersActive",get:function(){return this.activePointerIDs.length>1}}]),e}();BFN.SingletonQueue.add(function(){BFN.GestureManager=new my});var py=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.resetValues(),this.handlePointerMoveBind=this.handlePointerMove.bind(this),this.handlePointerUpBind=this.handlePointerUp.bind(this)}},{key:"initiateLongPress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];BeFunky.isPointerDown&&!this.longPressPending&&BeFunky.globalPointerEvent&&(i&&"touch"!=BeFunky.globalPointerEvent.pointerType||(this.longPressPending=!0,this.longPressEvent=BeFunky.globalPointerEvent,this.longPressCallback=e,this.longPressPixelThreshold=t,this.longPressDuration=n,this.longPressEndTime=performance.now()+this.longPressDuration,document.addEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0),this.longPressTimer()))}},{key:"longPressTimer",value:function(){this.longPressPending&&(performance.now()>this.longPressEndTime?(this.longPressCallback&&this.longPressCallback(this.longPressEvent),this.handlePointerUpBind()):requestAnimationFrame(this.longPressTimer.bind(this)))}},{key:"resetValues",value:function(){this.longPressPending=!1,this.longPressEvent=null,this.longPressCallback=null,this.longPressPixelThreshold=null,this.longPressDuration=null,this.longPressEndTime=null}},{key:"handlePointerMove",value:function(e){var t=this.longPressEvent.pageX-e.pageX,n=this.longPressEvent.pageY-e.pageY,i=Math.sqrt(Math.pow(t,2)+Math.pow(n,2));this.longPressEndTime=performance.now()+this.longPressDuration,i>=this.longPressPixelThreshold&&this.handlePointerUpBind()}},{key:"handlePointerUp",value:function(e){this.resetValues(),document.removeEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0)}}]),e}();BFN.SingletonQueue.add(function(){BFN.LongPressManager=new py}),BFN.GroupManagerEvents={GROUPS_UPDATED:new Event("GROUPS_UPDATED")};var gy=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.sections=["editor","collage","designer"],this.groupData={},this.sections.forEach(function(t){e.groupData[t]=[]}),this.dispatchGroupsUpdated=BeFunky.debounce(this.dispatchGroupsUpdated,50)}},{key:"createGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&t.length>1){var i=this.sections.includes(n)?n:BFN.AppModel.sectionID,r=new BFN.TransformItemGroupVO;r.id="item_group_".concat(BeFunky.randomString(10)),r.name=e,t.forEach(function(e){e.projectItemVO&&e.projectItemVO.itemID&&r.itemIDs.push(e.projectItemVO.itemID)}),r.itemIDs.length>1&&this.addGroup(i,r,!0)}}},{key:"addGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.sections.includes(e)?e:BFN.AppModel.sectionID;(t&&(this.groupData[i].push(t),this.setGroupVOName(t,t.name)),n)&&(this.getSectionValue(i,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}},{key:"addGroups",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.sections.includes(t)?t:BFN.AppModel.sectionID;(n.forEach(function(t){e.addGroup(r,t)}),i)&&(this.getSectionValue(r,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}},{key:"clearGroups",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.sections.includes(e)?e:BFN.AppModel.sectionID;(this.groupData[n].splice(0),t)&&(this.getSectionValue(n,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}},{key:"deleteGroup",value:function(e){for(var t=null,n=this.sections.length;--n>-1;){for(var i=this.sections[n],r=this.groupData[i].length;--r>-1;){var a=this.groupData[i][r];if(a.id==e){a.itemIDs.splice(0),this.groupData[i].splice(r,1),t=i;break}}if(t)break}t&&(this.getSectionValue(t,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated())}},{key:"openCreateGroupModal",value:function(){var e=BeFunky.createFormModalContainer("group"),t=BeFunky.formModal(e,{title:"create_group",fields:[{name:"groupname",label:"group_name",maxLength:500}],button:"create",onSubmit:function(t){var n=t.groupname;n=n.trim(),UILayers.switchToGroupsTab(),BFN.TransformItemGroup.createGroup(n),BeFunky.closeModal(e)}}).teardown;BeFunky.openFormModal(e,t)}},{key:"selectGroupsByName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){var t=BFN.AppModel.sectionID,n=this.groupData[t],i=[];n.forEach(function(t){e.includes(t.name)&&!i.includes(t.id)&&i.push(t.id)}),this.selectGroups(i)}}},{key:"selectGroups",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length){var i=BFN.AppModel.sectionID,r=this.groupData[i];if(r.length){var a=v(BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children);a.includes(BFN.TransformItemGroup)&&a.splice(a.indexOf(BFN.TransformItemGroup),1);var o=[],s=[];if(a.forEach(function(e){e.projectItemVO&&e.projectItemVO.itemID&&(o.push(e),s.push(e.projectItemVO.itemID))}),o.length){var l=[];r.forEach(function(t){e.includes(t.id)&&t.itemIDs.forEach(function(e){if(s.includes(e)){var t=o[s.indexOf(e)];l.includes(t)||l.push(t)}})}),n&&BFN.TransformItemGroup.selectedItems.length&&BFN.TransformItemGroup.selectedItems.forEach(function(e){l.includes(e)||l.push(e)}),this.selectItems(l,t)}return v(BFN.TransformItemGroup.selectedItems)}}}},{key:"selectItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer);if(e.length>1)n.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=n,n.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=n.canvasScale,BFN.TransformItemGroup.updateSelectedItems(e,t),n.updateTransformItemGroup();else if(n.resetTransformItemGroup(),1===e.length){var i=e[0];i.selectedByMouse=!1,i.selectItem(),i.transformLayer.lastPressedItem=i,i.transformLayer.lastSelectedItem=i}return v(BFN.TransformItemGroup.selectedItems)}},{key:"renameGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&t){var i=this.getAllGroups(),r=null;if(i.forEach(function(t){t.id==e&&(r=t)}),r&&r.name!=t){this.setGroupVOName(r,t);var a=this.sections.includes(n)?n:BFN.AppModel.sectionID;return this.getSectionValue(a,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),r.name}}return null}},{key:"setGroupVOName",value:function(e,t){var n=this,i=null;if(this.sections.forEach(function(t){n.groupData[t].forEach(function(n){n==e&&(i=t)})}),i){var r=[];if(this.groupData[i].forEach(function(t){t!=e&&r.push(t.name)}),r.includes(t))for(var a=0;++a;){var o="".concat(t," (").concat(a,")");if(!r.includes(o)){e.name=o;break}}else e.name=t}else e.name=t}},{key:"addItemsToGroup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!1;if(this.getAllGroups().forEach(function(n){n.id==e&&t.forEach(function(e){n.itemIDs.includes(e)||(n.itemIDs.push(e),i=!0)})}),i){var r=this.sections.includes(n)?n:BFN.AppModel.sectionID;this.getSectionValue(r,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated()}}},{key:"removeItemsFromGroup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!1;if(this.getAllGroups().forEach(function(n){if(n.id==e)for(var r=n.itemIDs.length;--r>-1;){var a=n.itemIDs[r];t.includes(a)&&(n.itemIDs.splice(r,1),i=!0)}}),i){var r=this.sections.includes(n)?n:BFN.AppModel.sectionID;this.getSectionValue(r,BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel).updateProjectVO(),this.dispatchGroupsUpdated()}}},{key:"getSectionGroupVOs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.sections.includes(e)?e:BFN.AppModel.sectionID;return v(this.groupData[t])}},{key:"getSectionGroupObjects",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.sections.includes(n)?n:BFN.AppModel.sectionID;i&&(e=this.getSectionValue(r,BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer),t=[],e.children.forEach(function(e){e instanceof BFN.TransformItem&&t.push(e.itemID)}));var a=[];return this.groupData[r].forEach(function(e){var n={};Object.assign(n,e),i?(n.itemIDs=[],e.itemIDs.forEach(function(e){t.includes(e)&&n.itemIDs.push(e)})):n.itemIDs=v(e.itemIDs),a.push(n)}),a}},{key:"getGroupIDs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.sections.includes(e)?e:BFN.AppModel.sectionID,n=[];return this.groupData[t].forEach(function(e){var t=e.id;n.push(t)}),n}},{key:"getAllGroups",value:function(){var e=[];for(var t in this.groupData){this.groupData[t].forEach(function(t){e.push(t)})}return e}},{key:"getGroupVOsFromItemIDs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[];return this.getAllGroups().forEach(function(n){n.itemIDs.forEach(function(i){e.includes(i)&&!t.includes(n)&&t.push(n)})}),t}},{key:"getCommonGroupVOsFromItemIDs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this.getGroupVOsFromItemIDs(t),i=[];t.forEach(function(t){var r=e.getGroupVOsFromItemIDs([t]);n.forEach(function(e){r.includes(e)||i.includes(e)||i.push(e)})});for(var r=n.length;--r>-1;){var a=n[r];i.includes(a)&&n.splice(r,1)}return n}},{key:"getSectionValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;switch(e){case"editor":return t;case"collage":return n;case"designer":return i}return null}},{key:"dispatchGroupsUpdated",value:function(){this.dispatchEvent(BFN.GroupManagerEvents.GROUPS_UPDATED)}}]),n}();BFN.SingletonQueue.add(function(){BFN.GroupManager=new gy});var fy=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues(),this.initContextMenu()}},{key:"initDefaultValues",value:function(){this.batchMode=null,this.batchSection=null,this.resizeMode="none",this.effectAmount=100,this.effectFadeable=!1,this.backgroundUpdateAllowed=!1,this.cropRatio=1,this.cropOrientation="landscape",this.saveData=[],this.itemSize=320,this.cropMinSize=40,this.processedImageItems=[],this.newlyProcessedImageItems=[],this.visibleImageItems=[],this.hiddenImageItems=[],this.processingVisibleImageItems=!1,this.queuedBatchImageVOs=null,this.queuedImageItems=[],this.queuedImageItemsNum=0,this.effectTexture=null,this.effectID=null,this.effectParams=null,this.savePrefix="",this.saveSuffix="",this.defaultImageType="jpg",this.defaultImageQuality=98,this.maxImageQuality=99,this.imageType=this.defaultImageType,this.imageQuality=this.defaultImageQuality,this.handleImageItemPressedBind=this.handleImageItemPressed.bind(this),this.handleDocumentMouseDownCropBind=this.handleDocumentMouseDownCrop.bind(this),this.handleDocumentMouseMoveCropBind=this.handleDocumentMouseMoveCrop.bind(this),this.handleDocumentMouseUpCropBind=this.handleDocumentMouseUpCrop.bind(this),this.modal=document.getElementById("batch_processing"),this.zipLoader=null,BeFunky.onFreeTrialEnabledChange(function(e){var t=document.getElementById("batch_processing_upgrade");t&&t.setLang(e?"start_free_trial":"upgrade")}),this.modal.querySelector("panel-header").isPlus=!0}},{key:"initContextMenu",value:function(){var e=this;this.contextMenu=document.getElementById("context_menu_batch_processing_image_item"),BeFunky.contextMenu(this.contextMenu,{remove_image:{onClick:function(){e.rightClickItemAction("remove"),e.contextMenu.hide()}},reset_frame:{onClick:function(){e.rightClickItemAction("reset"),e.contextMenu.hide()}}}),this.contextMenu.enabled=!0,this.contextMenu.addEventListener("HIDE",function(){e.rightClickItem=null})}},{key:"handleBatchProcessing",value:function(){var e=this,t=UITools.getToolVO("batch_processing");if("open_modal"!==t.updating_id){if(this.batchSection!==t.section)this.batchSection=t.section,this.modal.getImageItems().forEach(function(t){100!==e.effectAmount&&t.setImageOverlayOpacity(100),t.setImageOverlaySRC(null),e.batchSection||t.toggleImageOverlayVeil(!1,!1)}),this.effectAmount=100,this.setBatchSection(this.batchSection);if(this.backgroundUpdateAllowed&&this.backgroundColor!==t.background_color&&this.setBackgroundColor(t.background_color),!1!==t[t.updating_id])switch(t.updating_id){case"manage_tools":this.showPopover("batch_processing_manage_tools_popover");break;case"cancel":UITools.setToolValue("batch_processing","section",null,!1),UITools.applyTool("batch_processing");break;case"apply":this.processImages(!0);break;case"load_images":this.loadImages();break;case"clear_images":this.clearImages();break;case"upgrade":BFN.BfnService.upgrade("BATCH","BATCH_UPGRADE","batch_processing"),BFN.UserActionManager.addUpgradeAction(["Batch Processing Upgrade"],!1);break;case"save_images":if(BeFunky.isPaywallEnabled()&&!BeFunky.isPlus())return void BeFunky.openTeaserModal("paywall");if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("BATCH","BATCH_UPGRADE","batch_processing"),void BFN.UserActionManager.addUpgradeAction(["Batch Processing Save"],!1);var n=t.add_text,i=t.add_text_mode;UITools.setToolValue("batch_processing","image_quality",this.defaultImageQuality),UITools.setToolValue("batch_processing","add_text",n),UITools.setToolValue("batch_processing","add_text_mode",i),this.setImageType(t.image_type),this.setImageQuality(t.image_quality),this.modal.openSaveDialog(this.saveImages.bind(this)),UITools.disableControlItem("batch_processing_image_quality","png"===this.imageType),UITools.updateToolControl("batch_processing_image_quality"),UITools.updateToolControl("batch_processing_add_text"),UITools.updateToolControl("batch_processing_add_text_mode"),this.refreshBatchExampleName();break;case"image_type":this.setImageType(t.image_type),UITools.disableControlItem("batch_processing_image_quality","png"===this.imageType),this.refreshBatchExampleName();break;case"image_quality":this.setImageQuality(t.image_quality);break;case"add_text":case"add_text_mode":this.refreshBatchExampleName()}}else this.openModal()}},{key:"refreshBatchExampleName",value:function(){var e=UITools.getToolVO("batch_processing"),t=document.getElementById("batch_processing_add_text"),n=document.getElementById("batch_processing_example_name");if(t&&n){var i=t.value.replace(/\s+/g," ").replace(/[^0-9a-zA-Z-_]/g,"");switch(this.savePrefix="",this.saveSuffix="",e.add_text_mode){case"before":this.savePrefix=i.replace(/^\s+/,"");break;case"after":this.saveSuffix=i.replace(/\s+$/,"")}n.textContent="".concat(this.savePrefix+BeFunky.LanguageManager.getString("filename").toLowerCase()+this.saveSuffix,".").concat(this.imageType)}}},{key:"handleBatchResize",value:function(){var e=this,t=UITools.getToolVO("batch_resize");"mode"===t.updating_id&&this.modal.setResizeMode(t.mode),this.resizeMode=t.mode,this.modal.getImageItems().forEach(function(t){t.resize(e.resizeMode)})}},{key:"handleBatchCrop",value:function(){var e=this,t=UITools.getToolVO("batch_crop"),n=this.modal.getImageItems();switch(t.updating_id){case"aspect_ratio":case"orientation":this.cropRatio="freeform"===t.aspect_ratio?-2:BFN.CropRatioMap[t.aspect_ratio],this.cropOrientation=t.orientation,n.forEach(function(t){t.setCropRatio(e.cropRatio,e.cropOrientation)}),"aspect_ratio"===t.updating_id&&UITools.disableControlItem("batch_crop_orientation","freeform"===t.aspect_ratio||1===BFN.CropRatioMap[t.aspect_ratio]);break;case"focal_point_align":this.showPopover("batch_crop_focal_point_align_popover");break;case"reset":UITools.setToolValue("batch_crop","aspect_ratio",t.aspect_ratio,!1),UITools.updateToolControl("batch_crop_aspect_ratio"),UITools.applyTool("batch_crop")}if("focal_point_align"!==t.updating_id&&t.updating_id.includes("focal_point_")&&t[t.updating_id]){var i=t.updating_id.replace("focal_point_","");"auto"===i?this.smartCrop():this.setCropFocalPoint(i)}}},{key:"handleBatchEffect",value:function(){var e=this,t=UITools.getToolVO("batch_effect");t.updating||"reset"!==t.updating_id||(Object.assign(t,t.defaultValues),UITools.updateToolControls("batch_effect"));var n=this.modal.getImageItems();this.effectFadeable=t.hasOwnProperty("amount"),this.effectFadeable&&this.effectAmount!=t.amount&&(this.effectAmount=t.amount,n.forEach(function(t){t.setImageOverlayOpacity(e.effectAmount)})),t.updating||"amount"===t.updating_id||this.processVisibleImageItems(!0)}},{key:"openModal",value:function(){this.modal.open||(BFN.UI.batchProcessingModal(this.modal),BFN.BatchToolManager.initManageToolsList()),this.modal.open(),this.loadZipLibrary()}},{key:"setBatchSection",value:function(e){var t=this;this.batchSection=e,this.batchMode=e,this.resizeMode="none",this.backgroundUpdateAllowed="resize"===this.batchSection,this.backgroundUpdateAllowed||this.setBackgroundColor(-1),document.removeEventListener(BeFunky.pointerdown,this.handleDocumentMouseDownCropBind,!0);var n=null;switch(this.batchMode){case"resize":var i=UITools.getToolVO("batch_resize");UITools.setToolValue("batch_resize","mode",i.mode,!1),this.handleBatchResize();break;case"crop":var r=UITools.getToolVO("batch_crop");UITools.setToolValue("batch_crop","aspect_ratio",r.aspect_ratio,!1),this.handleBatchCrop(),document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDownCropBind,!0);break;default:var a=this.batchMode,o=null;if(BFN.effectMap.hasOwnProperty(a)?o=a:BFN.effectPresetMap.hasOwnProperty(a)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[a])&&(o=BFN.effectPresetMap[a]),o){var s=null;if(o===a){if(BFN.UIToolData[o]&&BFN.UIToolData[o].controls){var l=BFN.UIToolData[o].controls;for(var u in s=[],l){var c=u.replace("".concat(o,"_"),"");s.push({toolID:a,controlID:"batch_effect_".concat(c),controlName:c,controlParamObject:Object.assign({},l[u])})}n=a}}else{var h=a.replace("".concat(o,"_"),""),d=null,m=null,p=!1;if(BFN.EffectData.some(function(e){return e.id===o&&(d=e.name,e.presets.some(function(e,t){return e.id===h&&(p=!e.hasOwnProperty("useBasicAmount")||e.useBasicAmount,e.hasOwnProperty("name")?d=e.name:d+=" ".concat(t+1),m=e.params,!0)}),!0)}),m){s=[];var g=!1;if(m.forEach(function(e){s.push({toolID:a,controlID:"batch_effect_".concat(e.name),controlName:e.name,controlParamObject:Object.assign({},e)}),"amount"===e.name&&(g=!0)}),!g&&p){var f={toolID:a,controlID:"batch_effect_amount",controlName:"amount",controlParamObject:{type:"slider_item",name:"amount",min:0,max:100,defaultValue:100}};s.splice(0,0,f)}n=d}}s&&this.modal.setDynamicControls(s,a)?(this.batchMode="dynamic",this.handleBatchEffect()):this.batchMode=null}else this.batchMode=null}requestAnimationFrame(function(){t.modal.getImageItems().forEach(function(e){e.setBatchMode(t.batchMode)}),t.modal.showControls(t.batchMode,n)})}},{key:"setBackgroundColor",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.backgroundColor=t,this.modal.getImageItems().forEach(function(t){t.setBackgroundColor(e.backgroundColor)})}},{key:"setImageType",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jpg";["jpg","png"].includes(t)&&(this.imageType=t,this.modal.getImageItems().forEach(function(t){t.setImageType(e.imageType)}))}},{key:"setImageQuality",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:99;this.imageQuality=Math.max(0,Math.min(100,e))}},{key:"rightClickItemAction",value:function(e){if(this.rightClickItem)switch(e){case"remove":this.removeImageItem(this.rightClickItem,!0);break;case"reset":switch(this.batchMode){case"crop":this.rightClickItem.setCropRatio(this.cropRatio,this.cropOrientation)}}}},{key:"smartCrop",value:function(){"crop"===this.batchMode&&(this.queuedSmartCropItems=this.modal.getImageItems(),BeFunky.showLoadScreen({isCancellable:!1}),this.processSmartCrop())}},{key:"processSmartCrop",value:function(){var e=this;if(this.queuedSmartCropItems)if(this.queuedSmartCropItems.length){var t=this.queuedSmartCropItems.shift(),n=new Image;n.addEventListener("load",function(i){var r=t.batchImageVO,a=r.cropData,o=Math.round(a.width/r.imageW*r.thumbW),s=Math.round(a.height/r.imageH*r.thumbH);window.smartcrop.crop(n,{width:o,height:s}).then(function(n){var i=n.topCrop,a=parseFloat(t.cropRegion.style.width.replace("%",""))/100*r.thumbW,o=parseFloat(t.cropRegion.style.height.replace("%",""))/100*r.thumbH,s=Math.max(0,Math.min(r.thumbW-a,i.x+i.width/2-a/2)),l=Math.max(0,Math.min(r.thumbH-o,i.y+i.height/2-o/2));t.cropRegion.setStyles({left:"".concat(s/r.thumbW*100,"%"),top:"".concat(l/r.thumbH*100,"%")}),t.updateCropVeil(),t.updateCropData(),e.processSmartCrop()})}),n.src=t.batchImageVO.thumbSRC}else BeFunky.hideLoadScreen()}},{key:"setCropFocalPoint",value:function(e){this.modal.getImageItems().forEach(function(t){var n=t.batchImageVO,i=parseFloat(t.cropRegion.style.width.replace("%",""))/100*n.thumbW,r=parseFloat(t.cropRegion.style.height.replace("%",""))/100*n.thumbH,a=parseFloat(t.cropRegion.style.left.replace("%",""))/100*n.thumbW,o=parseFloat(t.cropRegion.style.top.replace("%",""))/100*n.thumbH;e.includes("l")?a=0:e.includes("c")?a=n.thumbW/2-i/2:e.includes("r")&&(a=n.thumbW-i),e.includes("t")?o=0:e.includes("m")?o=n.thumbH/2-r/2:e.includes("b")&&(o=n.thumbH-r),a=Math.max(0,Math.min(n.thumbW-i,a)),o=Math.max(0,Math.min(n.thumbH-r,o)),t.cropRegion.setStyles({left:"".concat(a/n.thumbW*100,"%"),top:"".concat(o/n.thumbH*100,"%")}),t.updateCropVeil(),t.updateCropData()})}},{key:"loadImages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={fileType:"imagesExceptSVG",saveInIndexedDB:!1,thumbnailLongestSide:this.itemSize,keepThumbTexture:!0,files:t,onBeforeUpload:function(t,n){var i=e.getRecommendedUploadLimit();if(i-e.modal.getTotalImageBytes()>=t.reduce(function(e,t){return e+t.size},0))return n(t);var r=i/Math.pow(1024,2),a=r<1e3?"".concat(Math.round(r)," MB"):"".concat(Math.round(r/1024)," GB"),o='\n                <h3 style="font-size: inherit; font-weight: bold; margin-bottom: 1rem;">'.concat(BeFunky.LanguageManager.getStringReplacements("batch_file_size",{size:a}),"</h3>\n                <span>").concat(BeFunky.LanguageManager.getString("batch_file_size_body"),"</span>\n            ");BeFunky.confirm(o,{onConfirm:function(){return n(t)},onCancel:function(){return n([])},confirmText:"continue"})}},i=0;BFN.MultipleFileUploader.upload(function(t){var n=t.file,r=t.menuImageVO,a=t.isComplete;if(r){var o=new BFN.BatchImageVO;return o.originalName=r.name,o.originalTransparent=BFN.Util.isTransparent(r.thumbTexture),o.name=r.name,o.extension=r.extension,o.imageBlob=n,o.imageW=r.imageWidth,o.imageH=r.imageHeight,o.thumbSRC=r.thumbURL,o.thumbTexture=r.thumbTexture,o.thumbW=r.thumbWidth,o.thumbH=r.thumbHeight,o.resizeData.width=o.imageW,o.resizeData.height=o.imageH,o.cropData.x=0,o.cropData.y=0,o.cropData.width=o.imageW,o.cropData.height=o.imageH,i++,void e.addImageItem(o)}if(a){e.modal.updateImageItems();var s={};e.modal.getImageItems().forEach(function(e){var t=e.batchImageVO;s.hasOwnProperty(t.originalName)||(s[t.originalName]=0);var n=s[t.originalName]++;t.name=t.originalName+(n?" (".concat(n,")"):"")}),"dynamic"===e.batchMode&&e.processVisibleImageItems(),e.modal.popoverWalkthrough&&0===e.modal.popoverWalkthrough.index&&(e.modal.popoverWalkthrough.index=1);var l=new BFN.UserActionVO;l.eventID="media_opened",l.eventObject={mediaType:"Image",mediaOpenLocation:"Computer",batchMediaOpen:i},l.peopleObject={lastMediaOpenDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaOpenCount:1,lifetimeImagesOpenCount:i},l.track()}},n)}},{key:"addImageItem",value:function(e){var t=this.modal.addBatchImage(e);t.setBatchMode(this.batchMode),t.setImageOverlayOpacity(this.effectAmount),t.resize(this.resizeMode),t.setCropRatio(this.cropRatio,this.cropOrientation),t.setBackgroundColor(this.backgroundColor),t.setImageType(this.imageType),t.addEventListener(BeFunky.pointerdown,this.handleImageItemPressedBind,!0),t.oncontextmenu=function(){return!1}}},{key:"removeImageItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(e.removeEventListener(BeFunky.pointerdown,this.handleImageItemPressedBind,!0),e.destroy(),t&&this.modal.updateImageItems())}},{key:"clearImages",value:function(){var e=this,t=this.modal.getImageItems();t.length?BeFunky.confirm("confirm_clear_all_images",{onConfirm:function(){t.forEach(function(t){e.removeImageItem(t)}),e.modal.updateImageItems()}}):UIMessages.display("no_images_to_clear")}},{key:"saveImages",value:function(){if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();this.modal.getImageItems().length?(this.savePending=!0,this.saveData.splice(0),this.processImages()):UIMessages.display("no_images_to_save")}},{key:"processVisibleImageItems",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.processingVisibleImageItems&&"dynamic"===this.batchMode){var n=UITools.getToolVO("batch_effect"),i=n.toolID,r=null;if(BFN.effectMap.hasOwnProperty(i)?r=i:BFN.effectPresetMap.hasOwnProperty(i)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[i])&&(r=BFN.effectPresetMap[i]),r){if(t&&this.processedImageItems.splice(0),this.newlyProcessedImageItems.splice(0),this.queuedImageItems.splice(0),this.visibleImageItems=this.modal.getVisibleImageItems(),this.visibleImageItems.forEach(function(t){e.processedImageItems.length&&e.processedImageItems.includes(t)||(t.toggleImageOverlayVeil(!0,!0),e.queuedImageItems.push(t))}),t){this.hiddenImageItems=this.modal.getImageItems();for(var a=this.hiddenImageItems.length;--a>-1;){var o=this.hiddenImageItems[a];this.visibleImageItems.includes(o)&&this.hiddenImageItems.splice(a,1)}}else this.hiddenImageItems=[];BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.useThumbs=!0,this.effectID=r,this.effectParams=n,this.processQueuedImageItems()}}}},{key:"processQueuedImageItems",value:function(){var e=this;if(this.queuedImageItems.length){var t=this.queuedImageItems.shift();this.effectTexture&&this.effectTexture.destroyGC(!0),this.effectTexture=PIXI.RenderTexture.create(t.batchImageVO.thumbTexture.width,t.batchImageVO.thumbTexture.height),this.processingVisibleImageItems=!0,BFN.EffectManager.setSourceTexture(t.batchImageVO.thumbTexture),BFN.EffectManager.setRenderTexture(this.effectTexture),BFN.EffectManager.effectID=this.effectID,BFN.EffectManager.effectParameters=this.effectParams,BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,function n(){BFN.EffectManager.removeEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,n);var i=UITools.getToolVO("batch_effect"),r=t.batchImageVO.originalTransparent;r=r||"replace_color"===i.toolID&&-1===i.target_color;var a=e.defaultImageQuality/100;BFN.TextureUtils.textureToBlob(e.effectTexture,{isTransparent:r,quality:a}).then(function(n){e.effectTexture.destroyGC(!0),delete e.effectTexture,BFN.BlobUtils.blobToImageElement(n,function(n){var i=n.imageElement,r=n.error;i&&!r?(e.newlyProcessedImageItems.push(t),t.setImageOverlaySRC(i.src,e.effectFadeable,!0)):t.setImageOverlaySRC(null,e.effectFadeable,!0),e.processQueuedImageItems()},{cleanUpMemory:!1})})}),BFN.EffectManager.processEffect()}else{var n;this.effectID=null,this.effectParams=null,BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!0,BFN.EffectManager.useThumbs=!1,this.newlyProcessedImageItems.forEach(function(e){e.applyImageOverlaySRC(),e.toggleImageOverlayVeil(!1,!1)}),(n=this.processedImageItems).push.apply(n,v(this.newlyProcessedImageItems)),this.newlyProcessedImageItems.splice(0),this.hiddenImageItems.forEach(function(t){t.toggleImageOverlayVeil(!0,!1),t.setImageOverlaySRC(null,e.effectFadeable)}),this.processingVisibleImageItems=!1}}},{key:"processImages",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.updateOriginals=e,this.queuedBatchImageVOs=this.modal.getImageItems().map(function(e){return e.batchImageVO}),this.totalQueuedBatchImageVOs=this.queuedBatchImageVOs.length,!this.batchMode&&this.savePending)for(var t=this.queuedBatchImageVOs.length;--t>-1;){var n=this.queuedBatchImageVOs[t],i=!1;switch(n.extension){case"jpg":case"jpeg":i="jpg"===this.imageType&&this.imageQuality==this.defaultImageQuality;break;case"png":i="png"===this.imageType}(i=i&&!BFN.WatermarkManager.watermarkActive)&&(this.saveData.push({name:n.name,blob:n.imageBlob}),this.queuedBatchImageVOs.splice(t,1))}this.updateOriginals&&this.modal.getImageItems().forEach(function(e){e.toggleImageOverlayVeil(!0,!1)});var r=null;switch(this.batchMode){case"resize":case"crop":r=this.batchMode;break;case"dynamic":r=UITools.getToolVO("batch_effect").toolID}this.batchApplyUserActionVO=null;var a=BFN.UserActionManager.getEditorToolObject(r);a&&(a.batchEditingApplied=this.totalQueuedBatchImageVOs,this.batchApplyUserActionVO=new BFN.UserActionVO,this.batchApplyUserActionVO.eventID="editing_applied",this.batchApplyUserActionVO.eventObject=a),BeFunky.showLoadScreen({isCancellable:!1,message:"processing",showIris:!1}),this.processQueuedBatchImageVOs()}},{key:"processQueuedBatchImageVOs",value:function(){var e=this;if(this.queuedBatchImageVOs&&this.queuedBatchImageVOs.length){var t=this.queuedBatchImageVOs.shift(),n=this.totalQueuedBatchImageVOs,i=n-this.queuedBatchImageVOs.length;BeFunky.showLoadScreen({isCancellable:!1,message:"processing",progress:"".concat(i," / ").concat(n),showIris:!1}),BFN.TextureUtils.blobOrBase64ToTexture(t.imageBlob,function(n){var i=n.texture,r=function(n){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];requestAnimationFrame(function(){e.savePending&&!e.updateOriginals&&BFN.WatermarkManager.watermarkActive&&BFN.WatermarkManager.drawWatermark(n);var r=BFN.Util.getThumbTexture(n,e.itemSize),a=i?BFN.Util.isTransparent(r):t.originalTransparent,o=e.savePending&&!e.updateOriginals?"png"===e.imageType:a,s=Math.max(1,Math.min(e.maxImageQuality,e.updateOriginals&&!e.savePending?e.defaultImageQuality:e.imageQuality))/100;BFN.TextureUtils.textureToBlob(n,{isTransparent:o,quality:s}).then(function(i){if(e.savePending&&e.saveData.push({name:t.name,blob:i}),e.updateOriginals){t.originalTransparent=a,t.extension=o?"png":"jpg",t.imageBlob=i,t.imageW=n.width,t.imageH=t.resizeData.height=n.height;try{t.thumbTexture.destroyGC(!0)}catch(e){}t.thumbTexture=r,t.thumbW=r.width,t.thumbH=r.height,t.resizeData.width=t.imageW,t.resizeData.height=t.imageH,t.cropData.x=0,t.cropData.y=0,t.cropData.width=t.imageW,t.cropData.height=t.imageH,n.destroyGC(!0),BFN.TextureUtils.textureToBlob(r,{isTransparent:o}).then(function(n){BFN.BlobUtils.blobToImageElement(n,function(n){var i=n.imageElement,r=n.error;if(t.thumbSRC&&(t.thumbSRC.startsWith("data:")||URL.revokeObjectURL(t.thumbSRC),t.thumbSRC=null),i&&!r){t.thumbSRC=i.src;var a=e.modal.getImageItems().find(function(e){return e.batchImageVO==t});if(a&&(a.setImageOverlaySRC(null),a.resize("scale"),a.setBatchMode(null),requestAnimationFrame(function(){a.toggleImageOverlayVeil(!1,!1)}),e.batchApplyUserActionVO&&e.batchApplyUserActionVO.eventObject)){var o=e.batchApplyUserActionVO.eventObject;a.batchImageVO.addAction(BFN.UserActionManager.getFunnelString(o.toolType,o.toolName))}}e.processQueuedBatchImageVOs()},{cleanUpMemory:!1})})}else n.destroyGC(!0),r.destroyGC(!0),e.processQueuedBatchImageVOs()})})};switch(e.updateOriginals&&(t.imageBlob=null),e.batchMode){case"resize":var a=t.resizeData,o=!1;if(a.width!=t.imageW||a.height!=t.imageH){var s=BFN.Util.fitTextureInRect(i,a.width,a.height,!a.padding,t.backgroundColor);i.destroyGC(!0),i=s;var l=UITools.getToolVO("batch_resize");o="exact_size"===l.mode&&l.use_padding}r(i,o);break;case"crop":var u=t.cropData;if(u.width!=t.imageW||u.height!=t.imageH){var c=Math.min(i.width/t.imageW,i.height/t.imageH);u.x=Math.round(u.x*c),u.y=Math.round(u.y*c),u.width=Math.min(i.width-u.x,Math.round(u.width*c)),u.height=Math.min(i.height-u.y,Math.round(u.height*c));var h=PIXI.RenderTexture.create(u.width,u.height);h.copyPixels(i,{x:-u.x,y:-u.y}),i.destroyGC(!0),i=h}r(i);break;case"dynamic":var d=UITools.getToolVO("batch_effect"),m=d.toolID,p=null;if(BFN.effectMap.hasOwnProperty(m)?p=m:BFN.effectPresetMap.hasOwnProperty(m)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[m])&&(p=BFN.effectPresetMap[m]),p){var g=i.renderClone();BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.manageLoadScreen=!1,BFN.EffectManager.setSourceTexture(i),BFN.EffectManager.setRenderTexture(g),BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,function e(t){BFN.EffectManager.removeEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,e);var n=d.hasOwnProperty("amount"),a=n?d.amount/100:1;i.copyPixels(g,null,!n,a),g.destroyGC(!0);var o=!1;"replace_color"===d.toolID&&-1===d.target_color&&(o=!0),r(i,o)}),BFN.EffectManager.effectID=p,BFN.EffectManager.effectParameters=d,BFN.EffectManager.processEffect()}else r(i);break;default:r(i)}},{textureSize:BFN.maxImageSize})}else{var r=this.modal.getImageItems();if(r.length){var a="";switch(this.batchMode){case"crop":a="CROP";break;case"resize":a="RESIZE"}BFN.EffectManager.parameters&&(a=BFN.UIToolData.hasOwnProperty(BFN.EffectManager.parameters.toolID)?BFN.EffectManager.parameters.toolID.toUpperCase():BFN.EffectManager.parameters.toolID.split("_").slice(1).join("_").toUpperCase()),BFN.BfnService.track("CREATE","BATCH",a),this.updateOriginals&&(this.updateOriginals=!1,UITools.setToolValue("batch_resize","scale",100,!1),UITools.updateToolControl("batch_resize_scale"),r.forEach(function(t){t.updateImageDisplay(),t.resize(e.resizeMode)}),"crop"===this.batchMode&&(UITools.setToolValue("batch_crop","aspect_ratio","freeform",!1),UITools.updateToolControl("batch_crop_aspect_ratio"),UITools.applyTool("batch_crop"))),this.batchApplyUserActionVO&&this.batchApplyUserActionVO.track(),this.savePending?(this.savePending=!1,this.saveData.length&&(BFN.BfnService.track("CREATE","BATCH","SAVE"),BeFunky.showLoadScreen({isCancellable:!1,message:"zipping",showIris:!1}),this.loadZipLibrary().then(function(){var t=BFN.maxZipSizeMB,n=[],i=e.saveData.length,a=0;if(-1===t)n.push(v(e.saveData));else{var o=null,s=0;e.saveData.forEach(function(e,i){var r=e.blob.size/Math.pow(1024,2);s+r>t&&(o=null,s=0),o||((o=[]).startIndex=i,n.push(o)),o.push(e),s+=r,o.sizeMB=s,o.firstImageNum=o.startIndex+1,o.lastImageNum=o.startIndex+o.length})}e.saveData.splice(0);var l=[];!function t(){if(n.length){var o=n.shift(),s=null,u=new zip.BlobWriter,c=0;zip.createWriter(u,function(n){s=n,function n(){if(c===o.length)s.close(function(e){l.push({firstImageNum:o.firstImageNum,lastImageNum:o.lastImageNum,blob:e}),t()});else{var r=o[c];s.add("".concat((e.savePrefix+r.name+e.saveSuffix).trim(),".").concat(e.imageType),new zip.BlobReader(r.blob),function(){BeFunky.showLoadScreen({isCancellable:!1,message:"zipping",progress:"".concat(a," / ").concat(i),showIris:!1}),c++,a++,n()})}}()},function(){},!0)}else{if(window.bfn_mp){var h=new BFN.UserActionVO;h.eventID="media_saved",h.eventObject={mediaSaveType:[],mediaSaveLocation:"Computer",batchMediaSave:i,mediaSaveWatermark:BFN.WatermarkManager.watermarkActive,mediaSaveMainFunnel:[],mediaSaveFontsUsed:[],mediaSaveLayerSourcesUsed:[]},h.peopleObject={lastMediaSaveDate:window.bfn_mp?window.bfn_mp.getISODate():"n/a",lifetimeMediaSaveCount:1,lifetimeImagesSaveCount:i};var d=h.eventObject.mediaSaveType,m=h.eventObject.mediaSaveMainFunnel;if(r.forEach(function(e){var t=e.batchImageVO,n=t.extension.toUpperCase();n="PNG"===n?n:"JPG",d.includes(n)||d.push(n),t.actions&&t.actions.forEach(function(e){m.includes(e)||m.push(e)})}),e.batchApplyUserActionVO&&e.batchApplyUserActionVO.eventObject){var p=e.batchApplyUserActionVO.eventObject,g=BFN.UserActionManager.getFunnelString(p.toolType,p.toolName);m.includes(g)||m.push(g)}d.sort(),m.sort(),h.track()}BeFunky.hideLoadScreen();var f=1===l.length?"download_images_single":"download_images_multiple",v=l.map(function(e){return e.firstImageNum===e.lastImageNum?"":"".concat(e.firstImageNum," - ").concat(e.lastImageNum)}).map(function(e,t){return'\n                                        <div class="control-item" style="margin: 0 0 .5rem;">\n                                            <button class="button button--grey-outline button--has-icon button--fullwidth batch-processing__download-button" id="batch_zip_'.concat(t,'">\n                                                ').concat(BeFunky.getSvgHtml("download-icon"),"\n                                                ").concat(BeFunky.LanguageManager.getStringReplacements("download_images_button",{range:e}),"\n                                                ").concat(BeFunky.getSvgHtml("checkmark-icon"),"\n                                            </button>\n                                        </div>")}),y='\n                                        <panel-header lang-id="download_images" modifier="modal" buttons="close"></panel-header>\n                                        <div class="modal__body">\n                                            <p>'.concat(BeFunky.LanguageManager.getString(f),"</p>\n                                            ").concat(v.join(""),"\n                                        </div>\n                                    "),x=document.createElement("div").setClass("modal modal--button-sm");x.id="batch_processing_download",x.innerHTML=y,l.forEach(function(e,t){var n=x.querySelector("#batch_zip_".concat(t));n.addEventListener("click",function(){var i="batch_processed_images".concat(l.length>1?"_part_".concat(t+1):"",".zip");saveAs(e.blob,i),n.addClass("button--selected")})}),requestAnimationFrame(function(){BeFunky.openModal(x,{onClose:function(){l.splice(0)},size:"extra-small",destroyOnClose:!0})})}}()}).catch(function(e){BeFunky.logError("Batch Processing save failed",e),BeFunky.hideLoadScreen()}))):(BeFunky.hideLoadScreen(),UITools.setToolValue("batch_processing","section",null,!1),UITools.applyTool("batch_processing"))}else BeFunky.hideLoadScreen(),UITools.setToolValue("batch_processing","section",null,!1),UITools.applyTool("batch_processing");BFN.EffectManager.reset(),BFN.EffectManager.autoProcess=!0,BFN.EffectManager.manageLoadScreen=!0}}},{key:"showPopover",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=document.getElementById(e),i=document.getElementById("".concat(e,"_placeholder")).getBoundingClientRect(),r=this.modal.getBoundingClientRect();n.setStyles({left:"".concat(i.x-r.x+t,"px"),top:"".concat(i.y-r.y,"px")}),n.show()}},{key:"loadZipLibrary",value:function(){var e=this;return this.zipLoader?this.zipLoader:(this.zipLoader=BFN.RequestUtils.loadScript("zip.0.0.4.js",function(){return window.zip}).then(function(){var e="".concat(BFN.jsURL,"z-worker.js"),t="".concat(BFN.jsURL,"pako-1.0.10.min.js"),n="".concat(BFN.jsURL,"pako-codecs.0.0.1.js");zip.workerScripts={deflater:[e,t,n]}}).catch(function(t){throw BeFunky.logError("Unable to load zip.js library",t),e.zipLoader=null,t}),this.zipLoader)}},{key:"getRecommendedUploadLimit",value:function(){return(parseInt(navigator.deviceMemory)||4)/4*Math.pow(1024,3)}},{key:"showContextMenu",value:function(e){"crop"===this.batchMode?this.contextMenu.showButton("reset_frame"):this.contextMenu.hideButton("reset_frame"),this.rightClickItem=this.pressedTarget,this.contextMenu.show(e.pageX,e.pageY)}},{key:"handleImageItemPressed",value:function(e){this.pressedTarget=e.currentTarget,2===e.button?(this.showContextMenu(e),e.stopPropagation(),e.preventDefault()):BFN.LongPressManager.initiateLongPress(this.showContextMenu.bind(this))}},{key:"handleDocumentMouseDownCrop",value:function(e){var t=this;if(2!==e.button&&(this.cropControl=null,this.cropDragType=null,this.imageItem=null,this.cropContainer=null,this.cropRegion=null,this.cropAspectRatio=null,e.target&&e.target instanceof HTMLDivElement)){var n=e.target;if(this.mouseStartPosition=null,n.hasClass("batch-item__crop-region")||n.hasClass("batch-item__crop-region-handle")){this.cropControl=n,this.cropDragType=n.hasClass("batch-item__crop-region-handle")?"handle":"region",this.imageItem=n.imageItem,this.cropContainer=n.container,this.cropRegion=n.region,this.cropAspectRatio=this.imageItem.batchImageVO.cropData.height/this.imageItem.batchImageVO.cropData.width;var i=this.cropControl.container.getBoundingClientRect(),r=this.cropControl.region.getBoundingClientRect();this.cropContainer.rect=new BFN.Rectangle(0,0,i.width,i.height),this.cropRegion.rect=new BFN.Rectangle(r.x-i.x,r.y-i.y,r.width,r.height),this.mouseStartPosition={globalX:e.pageX,globalY:e.pageY,localX:e.pageX-i.x,localY:e.pageY-i.y},document.addEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveCropBind),document.addEventListener(BeFunky.pointerup,this.handleDocumentMouseUpCropBind,!0),e.stopImmediatePropagation(),e.preventDefault(),BFN.LongPressManager.initiateLongPress(function(e){t.handleDocumentMouseUpCropBind(),t.showContextMenu(e)})}}}},{key:"handleDocumentMouseMoveCrop",value:function(e){var t=e.pageX-this.mouseStartPosition.globalX,n=e.pageY-this.mouseStartPosition.globalY,i={};switch(this.cropDragType){case"region":var r=Math.max(0,Math.min(this.cropContainer.rect.width-this.cropRegion.rect.width,this.cropRegion.rect.x+t)),a=Math.max(0,Math.min(this.cropContainer.rect.height-this.cropRegion.rect.height,this.cropRegion.rect.y+n)),o=r/this.cropContainer.rect.width*100,s=a/this.cropContainer.rect.height*100;i.left="".concat(o,"%"),i.top="".concat(s,"%");break;case"handle":var l=this.cropControl.handleID,u=this.cropControl.handleType,c=this.cropRegion.width,h=this.cropRegion.height,d=this.cropContainer.rect.width,m=this.cropContainer.rect.height;if(l.includes("top")?(m=this.cropRegion.rect.bottom,h=Math.max(this.cropMinSize,Math.min(m,this.cropRegion.rect.height-n))):l.includes("bottom")&&(m=this.cropContainer.rect.height-this.cropRegion.rect.top,h=Math.max(this.cropMinSize,Math.min(m,this.cropRegion.rect.height+n))),l.includes("left")?(d=this.cropRegion.rect.right,c=Math.max(this.cropMinSize,Math.min(d,this.cropRegion.rect.width-t))):l.includes("right")&&(d=this.cropContainer.rect.width-this.cropRegion.rect.left,c=Math.max(this.cropMinSize,Math.min(d,this.cropRegion.rect.width+t))),"corner"===u&&(this.cropAspectRatio<1?h=(c=Math.max(this.cropMinSize,Math.min(d,h/this.cropAspectRatio)))*this.cropAspectRatio:c=(h=Math.max(this.cropMinSize,Math.min(m,c*this.cropAspectRatio)))/this.cropAspectRatio),l.includes("top")){var p=(this.cropRegion.rect.bottom-h)/this.cropContainer.rect.height*100,g=h/this.cropContainer.rect.height*100;i.top="".concat(p,"%"),i.height="".concat(g,"%")}else if(l.includes("bottom")){var f=h/this.cropContainer.rect.height*100;i.height="".concat(f,"%")}if(l.includes("left")){var v=(this.cropRegion.rect.right-c)/this.cropContainer.rect.width*100,y=c/this.cropContainer.rect.width*100;i.left="".concat(v,"%"),i.width="".concat(y,"%")}else if(l.includes("right")){var x=c/this.cropContainer.rect.width*100;i.width="".concat(x,"%")}}this.imageItem.cropRegion.setStyles(i),this.imageItem.updateCropVeil(),this.imageItem.updateCropData()}},{key:"handleDocumentMouseUpCrop",value:function(e){document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveCropBind),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpCropBind,!0)}}]),e}();BFN.SingletonQueue.add(function(){BFN.BatchProcessingManager=new fy});var vy=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.batchEditToolIDs=["crop","resize","exposure","vignette","levels","vibrance","color","replace_color","fill_light","sharpen","clarity","tint","beautify","color_mixer","auto_enhance","glow","blur_edges","smoothing","soften","blur"],this.batchToolData=this.getBatchToolData(),this.defaultBatchToolIDs=["crop","resize","exposure","color","auto_enhance","sharpen"],BFN.FeaturedData.effect.forEach(function(t){BFN.effectIDMap[t]&&e.defaultBatchToolIDs.push("".concat(BFN.effectIDMap[t],"_").concat(t))}),this._selectedIDs=[],this.selectedIDs=this.defaultBatchToolIDs}},{key:"initManageToolsList",value:function(){var e=this;this.manageToolsList=document.getElementById("batch_processing_manage_tools_popover_content"),BFN.UI.selectableList(this.manageToolsList,"manage_tools",this.batchToolData,function(t){e.selectedIDs=t}),this.updateModalToolLists()}},{key:"updateModalToolLists",value:function(){var e=this;if(this.manageToolsList){var t=this.batchToolData.filter(function(t){var n=t.id;return e.selectedIDs.includes(n)}).sort(function(t,n){return e.selectedIDs.indexOf(t.id)-e.selectedIDs.indexOf(n.id)});BFN.BatchProcessingManager.modal.updateToolButtons(t),this.manageToolsList.selectedIDs=this.selectedIDs}}},{key:"getBatchToolData",value:function(){var e=[];return this.batchEditToolIDs.forEach(function(t){e.push({id:t,name:t})}),BFN.EffectData.forEach(function(t){"effect_featured"!==t.id&&"effect_favorites"!==t.id&&"touchup"!==t.id&&t.presets.forEach(function(n,i){var r="".concat(t.id,"_").concat(n.id),a=n.name?n.name:"".concat(t.name," ").concat(i+1);e.push({id:r,name:a})})}),e}},{key:"selectedIDs",set:function(e){Array.isArray(e)?this._selectedIDs.isIdenticalTo(e)||(this._selectedIDs=e.slice(),this.updateModalToolLists(),BFN.BatchIconManager.updateButtonIcons(),BFN.BatchIconManager.updatePanelHeaders(),BFN.SettingsManager.updateSetting("batch_processing_fav",e.slice())):BeFunky.throwError("Invalid selectedIDs: ".concat(BeFunky.getType(e),"}"),{_value:e})},get:function(){return this._selectedIDs}}]),e}();BFN.SingletonQueue.add(function(){BFN.BatchToolManager=new vy}),BFN.TransformLayerManagerEvents={ITEMS_UPDATED:new Event("ITEMS_UPDATED"),SELECTION_UPDATED:new Event("SELECTION_UPDATED")};var yy=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this._transformItemIDs=[],this._transformItems=[],this._selectedItemIDs=[],this._selectedItems=[],this.updateTransformItems=BeFunky.debounce(this.updateTransformItemsImmediately,50),this.updateSelectedItems=BeFunky.debounce(this.updateSelectedItemsImmediately,50),window.addEventListener("INIT_COMPLETE",function(){BFN.PhotoEditorCanvas.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,e.handleTransformLayerItemsUpdated.bind(e)),BFN.CollageMakerCanvas.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,e.handleTransformLayerItemsUpdated.bind(e)),BFN.DesignerCanvas.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,e.handleTransformLayerItemsUpdated.bind(e)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,e.handleAppViewstateUpdated.bind(e))})}},{key:"updateTransformItemsImmediately",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.filter(function(e){return e instanceof BFN.TransformItem}),i=n.map(function(e){return e.itemID});this._transformItemIDs.isIdenticalTo(i)&&this._transformItems[0]===n[0]||(this._transformItemIDs.splice(0),this._transformItems.splice(0),n.forEach(function(t){e._transformItemIDs.push(t.itemID),e._transformItems.push(t)}),t&&this.dispatchEvent(BFN.TransformLayerManagerEvents.ITEMS_UPDATED))}},{key:"updateSelectedItemsImmediately",value:function(){var e=[];e.push.apply(e,v(BFN.TransformItemGroup.selectedItems)),BFN.TransformModel.selectedTransformItem&&"group"!==BFN.TransformModel.selectedTransformItem.type&&!e.includes(BFN.TransformModel.selectedTransformItem)&&e.push(BFN.TransformModel.selectedTransformItem),e.sort(function(e,t){return e.itemID>t.itemID?1:-1});var t,n,i=e.map(function(e){return e.itemID});this._selectedItemIDs.isIdenticalTo(i)||(this._selectedItemIDs.splice(0),this._selectedItems.splice(0),(t=this._selectedItemIDs).push.apply(t,v(i)),(n=this._selectedItems).push.apply(n,e),this.dispatchEvent(BFN.TransformLayerManagerEvents.SELECTION_UPDATED))}},{key:"smartResizeLayers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e||!t)return null;var n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),i=n.transformLayer,r=n.transformTool,a=i.frameWidth,o=i.frameHeight,s=Math.abs(e),l=Math.abs(t),u=Math.min(s/a,l/o),c=v(i.children);if(c.includes(BFN.TransformItemGroup)&&c.splice(c.indexOf(BFN.TransformItemGroup),1),c.length){var h="resize_item_layer"+BeFunky.randomString(10);return BFN.TransformStateModel.startBulkTransition(h),c.forEach(function(e){e.createTransition("resize_item_layer");var t=e.bounds,n=t.width,i=t.height/n/(e.scale.x/e.scale.y),a=r.minSize;switch(e.type){case"text":a=r.minSizeText;break;case"frame_texture":a=r.minSizeFrame;break;case"texture":e.isShape||(a=r.minSizeFrame)}var o=a,s=o*i,l=Math.sqrt(Math.pow(o,2)+Math.pow(s,2)),c=a,h=c/i,d=Math.sqrt(Math.pow(h,2)+Math.pow(c,2)),m=Math.max(l,d)/2,p=e.itemContentW*e.scale.x,g=e.itemContentH*e.scale.y,f=Math.sqrt(Math.pow(p,2)+Math.pow(g,2))/2,v=Math.atan2(g/2,p/2),y=e.x+Math.cos(v+e.rotation)*f,x=e.y+Math.sin(v+e.rotation)*f,_=y*u,I=x*u,T=p*u,b=g*u,S=Math.max(m,Math.sqrt(Math.pow(T,2)+Math.pow(b,2))/2),C=S/f;T=p*C,b=g*C,S=Math.sqrt(Math.pow(T,2)+Math.pow(b,2))/2,e.scale.x*=C,e.scale.y*=C,e.updateFrameTextureDisplay(),e.x=_-Math.cos(e.rotation+v)*S,e.y=I-Math.sin(e.rotation+v)*S,e.updateShapeTexture(!1),e.resetFrameTextureScale(),e.basicShapeVO&&e.basicShapeVO.strokeWidth&&(e.basicShapeVO.strokeWidth=Math.max(1,Math.min(100,Math.round(e.basicShapeVO.strokeWidth*C)))),e.updateShapeTexture(),"text"===e.type?e.setTextWidth(T,!0):(e.updateHitArea(),e.updateAccurateBounds()),e.updateSmoothingScale(),e.registerTransition(!1)}),BFN.TransformStateModel.stopBulkTransition(),BFN.MainUI.requestRender(),h}return null}},{key:"handleTransformLayerItemsUpdated",value:function(){this.updateTransformItems()}},{key:"handleAppViewstateUpdated",value:function(){this.updateTransformItems()}},{key:"transformItemIDs",get:function(){return this._transformItemIDs}},{key:"transformItems",get:function(){return this._transformItems}},{key:"selectedItemIDs",get:function(){return this._selectedItemIDs}},{key:"selectedItems",get:function(){return this._selectedItems}}]),n}();BFN.SingletonQueue.add(function(){BFN.TransformLayerManager=new yy}),BFN.WatermarkManagerEvents={WATERMARK_UPDATED:new Event("WATERMARK_UPDATED")};var xy=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues(),this.initGraphicLoader(),this.initWatermarkControls(),this.setInitialValues(),this.setUseWatermarkIndexedDB=BeFunky.debounce(this.setUseWatermarkIndexedDB.bind(this),500),this.saveWatermarkPresets=BeFunky.debounce(this.saveWatermarkPresets.bind(this),500)}},{key:"initDefaultValues",value:function(){var e=this;this.editModal=document.getElementById("watermark_edit_modal"),this.presetModal=document.getElementById("watermark_preset_modal"),window.addEventListener("INIT_COMPLETE",function(){BFN.UI.watermarkEditModal(e.editModal),BFN.UI.watermarkPresetModal(e.presetModal)}),this.previewWatermarkURL=null,this.previewWatermarkObjectURL=null,this.previewWatermarkBlob=null,this.watermarkData=null,this.watermarkURL=null,this.watermarkTexture=null,this.watermarkPresets=[],this.activated=!1,this.editModal.querySelector("panel-header").isPlus=!0}},{key:"initGraphicLoader",value:function(){this.graphicLoader=new BFN.GraphicLoader,this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleGraphicLoaderComplete.bind(this))}},{key:"initWatermarkControls",value:function(){this.watermarkControls=v(document.querySelectorAll(".watermark-control")),this.watermarkControls.forEach(function(e){BFN.UI.watermarkControl(e)})}},{key:"setInitialValues",value:function(){var e=this;BFN.IndexedDB.get("options__useWatermark").then(function(t){e.useWatermarkDB=t}).catch(function(){e.useWatermarkDB=!1}).then(function(){e.useWatermark=e.useWatermarkDB})}},{key:"setUseWatermarkIndexedDB",value:function(){this.useWatermarkDB!==this._useWatermark&&(this.useWatermarkDB=this._useWatermark,BFN.IndexedDB.set("options__useWatermark",this._useWatermark))}},{key:"handleWatermark",value:function(){var e=this,t=UITools.getToolVO("watermark");switch(t.updating_id){case"upload":this.uploadWatermark();break;case"placement_popover_button":this.showPopover("watermark_placement_popover",16);break;case"placement":this.editModal.setPreviewWatermarkParams({placement:t.placement});break;case"size":this.editModal.setPreviewWatermarkParams({size:t.size});break;case"padding":this.editModal.setPreviewWatermarkParams({padding:t.padding});break;case"opacity":this.editModal.setPreviewWatermarkParams({opacity:t.opacity});break;case"save":if(this.previewWatermarkURL){var n=this.editModal.nameInputValue;if(n.length){if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("WATERMARK","WATERMARK_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Watermark Preset Save"]);var i=function(){BFN.WatermarkManager.saveWatermarkPreset(n,function(){e.editModal.close()})};if(this.editModal.editingExistingPreset)i();else BFN.WatermarkManager.watermarkPresets.map(function(e){return e.presetName}).includes(n)?BeFunky.confirm(["confirm_overwrite_existing_watermark_preset",{name:n}],{onConfirm:function(){i()}}):i()}else BeFunky.acknowledge("please_enter_watermark_preset_name")}else BeFunky.acknowledge("please_upload_your_watermark")}}},{key:"activate",value:function(){this.activated||(this.activated=!0,this.watermarkData&&this.setWatermarkData(this.watermarkData))}},{key:"uploadWatermark",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=[];t&&n.push(t);var i={allowMultiple:!1,fileType:"imagesExceptSVG",saveInIndexedDB:!1,thumbnailLongestSide:115,createMenuImageVO:!1,files:n};BFN.MultipleFileUploader.upload(function(t){var n=t.file;if(n){var i=n.type;if(["image/jpeg","image/png","image/gif"].includes(i)){var r=function(){e.clearPreviewWatermark(),e.previewWatermarkBlob=n,e.previewWatermarkObjectURL=URL.createObjectURL(e.previewWatermarkBlob),e.previewWatermarkURL=e.previewWatermarkObjectURL,e.editModal.setPreviewWatermarkSRC(e.previewWatermarkURL)};if("image/gif"===i){var a=URL.createObjectURL(n),o=document.createElement("img");o.onload=function(){var e=document.createElement("canvas"),t=e.width=o.width,i=e.height=o.height;e.getContext("2d").drawImage(o,0,0,t,i);var s=e.toDataURL("image/gif");n=BFN.BlobUtils.base64ToBlob(s),URL.revokeObjectURL(a),o.src="",o.onerror=null,r()},o.onerror=function(){URL.revokeObjectURL(a),o.src="",UIMessages.display("Watermark upload error",1e3)},o.src=a}else r()}else BeFunky.acknowledge("acknowledge_watermark_invalid_filetype")}},i)}},{key:"clearPreviewWatermark",value:function(){this.previewWatermarkBlob=null,this.previewWatermarkObjectURL&&URL.revokeObjectURL(this.previewWatermarkObjectURL),this.previewWatermarkObjectURL=null,this.previewWatermarkURL=null}},{key:"clearWatermarkTexture",value:function(){this.watermarkTexture&&this.watermarkTexture.destroyGC(!0),this.watermarkTexture=null}},{key:"updateWatermarkPresetOrder",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={};this.watermarkPresets.forEach(function(e){n[e.presetID]=e}),this.watermarkPresets.splice(0),t.forEach(function(t){e.watermarkPresets.push(n[t])}),this.saveWatermarkPresets()}},{key:"deleteWatermarkPreset",value:function(e){for(var t=this,n=null,i=0,r=this.watermarkPresets.length;--r>-1;){var a=this.watermarkPresets[r];if(a.presetID===e){n=a,this.watermarkPresets.splice(r,1),i=Math.max(0,Math.min(this.watermarkPresets.length-1,r));break}}if(n){var o=!0;if(this.watermarkPresets.forEach(function(e){e.watermarkURL==n.watermarkURL&&(o=!1)}),o&&this.deleteWatermarkFromServer(n.watermarkURL),n.presetID===this.selectedPresetID)if(i<this.watermarkPresets.length){var s=this.watermarkPresets[i];this.selectedPresetID=s.presetID}else this.selectedPresetID=null;return this.saveWatermarkPresets(),this.watermarkControls.forEach(function(e){e.updatePresetList(t.watermarkPresets)}),this.watermarkPresets.length||this.dispatchEvent(BFN.WatermarkManagerEvents.WATERMARK_UPDATED),!0}return!1}},{key:"saveWatermarkPresets",value:function(){BFN.SettingsManager.updateSetting("watermarks",this.watermarkPresets,{updateUI:!1})}},{key:"loadWatermarkPresets",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.watermarkPresets.splice(0),(e=this.watermarkPresets).push.apply(e,v(n)),this.presetModal.updatePresetButtons(this.watermarkPresets),this.watermarkControls.forEach(function(e){e.updatePresetList(t.watermarkPresets)}),this.editModal.isOpen||this.updateSelectedPreset()}},{key:"updateSelectedPreset",value:function(){var e=this.getSelectedPresetObject();e?this.selectedPresetID=e.presetID:this.watermarkPresets.length?(e=this.watermarkPresets[0],this.selectedPresetID=e.presetID):this.selectedPresetID=null}},{key:"saveWatermarkToServer",value:function(e,t){e?BFN.BfnWatermarkService.uploadImage(this.previewWatermarkBlob,t):t&&t({error:"no_blob"})}},{key:"deleteWatermarkFromServer",value:function(e){if(e){BFN.BfnWatermarkService.deleteImage(e,function(e){e.success})}}},{key:"renameWatermarkPreset",value:function(e,t){var n=this;if(e||t&&"string"==typeof t&&t.trim().length){var i=!1;if(this.watermarkPresets.forEach(function(n){i||n.presetID==e||n.presetName!=t||(i=!0)}),i)BeFunky.acknowledge("acknowledge_watermark_preset_name_taken");else{var r=null;this.watermarkPresets.forEach(function(t){r||t.presetID!==e||(r=t)}),r&&(r.presetName=t,this.presetModal.updatePresetButtons(this.watermarkPresets),this.watermarkControls.forEach(function(e){e.updatePresetList(n.watermarkPresets)}),this.saveWatermarkPresets())}}}},{key:"saveWatermarkPreset",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&this.previewWatermarkURL){var i=null,r=function(){var r=null;e.watermarkPresets.forEach(function(e){r||e.presetName!==t||(r=e)});var a=e.editModal.getWatermarkData();if(r){var o=r.watermarkURL||null;Object.assign(r,a),(a=r).watermarkURL=i,o&&(e.watermarkPresets.forEach(function(e){o&&e.watermarkURL===o&&(o=null)}),o&&e.deleteWatermarkFromServer(o))}else a.presetID="preset_".concat(BeFunky.hash(t).toString(36)),a.presetName=t,a.watermarkURL=i,e.watermarkPresets.push(a);e.presetModal.updatePresetButtons(e.watermarkPresets),e.watermarkControls.forEach(function(t){t.updatePresetList(e.watermarkPresets)}),e.selectedPresetID=a.presetID,e.saveWatermarkPresets(),n&&n()};if(this.previewWatermarkBlob){var a=!1;UIToggler.toggleLoadScreen(!0,{message:"uploading_watermark",onCancel:function(){a=!0}}),this.saveWatermarkToServer(this.previewWatermarkBlob,function(t){UIToggler.toggleLoadScreen(!1),t.url?a?e.deleteWatermarkFromServer(t.url):(i=t.url,r()):(BeFunky.logError("Watermark Upload Error".concat(t.error?" : ".concat(t.error):"")),BeFunky.acknowledge("acknowledge_watermark_upload_error"))})}else i=this.previewWatermarkURL,r()}}},{key:"setWatermarkData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.watermarkData=null;["frameW","frameH","framePadding","watermarkPlacement","watermarkW","watermarkH","watermarkAlpha","watermarkURL"].forEach(function(t){e.hasOwnProperty(t)}),this.watermarkData=e,this.activated&&this.loadWatermarkFromURL(this.watermarkData.watermarkURL)}},{key:"loadWatermarkFromURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.clearWatermarkTexture(),e&&(UIToggler.toggleLoadScreen(!0),BeFunky.isSafari&&(e="".concat(e,"?nocache=").concat(Math.random().toString().split(".")[1])),this.watermarkURL=e,this.graphicLoader.graphicsData.watermarkTexture=this.watermarkURL,this.graphicLoader.loadGraphics())}},{key:"drawWatermark",value:function(e){if(this.watermarkActive&&e&&e.baseTexture){var t=this.watermarkTexture,n=this.watermarkData,i=Math.sqrt(Math.pow(n.frameW,2)+Math.pow(n.frameH,2)),r=Math.sqrt(Math.pow(n.watermarkW,2)+Math.pow(n.watermarkH,2)),a=e.baseTexture.width,o=e.baseTexture.height,s=Math.sqrt(Math.pow(a,2)+Math.pow(o,2))/i,l=t.baseTexture.width,u=t.baseTexture.height,c=r/Math.sqrt(Math.pow(l,2)+Math.pow(u,2)),h=n.framePadding*s,d=a-2*h,m=o-2*h,p=Math.min(s*c,d/l,m/u),g=0,f=0;n.watermarkPlacement.includes("l")&&(g=h),n.watermarkPlacement.includes("c")&&(g=a/2-l/2*p),n.watermarkPlacement.includes("r")&&(g=a-h-l*p),n.watermarkPlacement.includes("t")&&(f=h),n.watermarkPlacement.includes("m")&&(f=o/2-u/2*p),n.watermarkPlacement.includes("b")&&(f=o-h-u*p),e.copyPixels(t,{x:g,y:f},!1,n.watermarkAlpha,p)}}},{key:"showPopover",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e){var i=document.getElementById(e),r=document.getElementById("".concat(e,"_placeholder"));if(i&&r){var a=r.getBoundingClientRect(),o=this.editModal.getBoundingClientRect();i.setStyles({left:"".concat(a.x-o.x+t,"px"),top:"".concat(a.y-o.y+n,"px")}),i.show()}}}},{key:"getPresetObjectById",value:function(e){var t=null;return this.watermarkPresets.forEach(function(n){n.presetID&&n.presetID===e&&(t=n)}),t}},{key:"setSelectedPresetObject",value:function(e){var t=this.getSelectedPresetObject();this.watermarkPresets.forEach(function(t){t.selected=e==t}),t!=this.getSelectedPresetObject()&&this.saveWatermarkPresets()}},{key:"getSelectedPresetObject",value:function(){var e=null;return this.watermarkPresets.forEach(function(t){!e&&t.selected&&(e=t)}),e}},{key:"handleGraphicLoaderComplete",value:function(e){this.clearWatermarkTexture(),this.graphicLoader.graphics.watermarkTexture&&(this.watermarkTexture=this.graphicLoader.graphics.watermarkTexture.renderClone()),this.graphicLoader.reset(),this.useWatermark&&this.dispatchEvent(BFN.WatermarkManagerEvents.WATERMARK_UPDATED),UIToggler.toggleLoadScreen(!1)}},{key:"useWatermark",set:function(e){var t=this;(e=!!e)!=this._useWatermark&&(this._useWatermark=e,this.watermarkControls.forEach(function(e){e.selected=t._useWatermark}),this.setUseWatermarkIndexedDB(),this.dispatchEvent(BFN.WatermarkManagerEvents.WATERMARK_UPDATED))},get:function(){return this._useWatermark}},{key:"selectedPresetID",set:function(e){var t=this;this.clearWatermarkTexture();var n=this.getPresetObjectById(e);this._selectedPresetID=n?n.presetID:null,this.watermarkControls.forEach(function(e){e.selectedPresetID=t._selectedPresetID}),this.presetModal.selectedPresetID=this._selectedPresetID,this.setWatermarkData(n||{}),this.setSelectedPresetObject(n)},get:function(){return this._selectedPresetID}},{key:"watermarkActive",get:function(){return!!(this._useWatermark&&this.watermarkTexture&&this.watermarkTexture.baseTexture&&this.watermarkData)}}]),n}();BFN.SingletonQueue.add(function(){BFN.WatermarkManager=new xy});var _y=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.funnelEvents=["editing_applied","text_added","image_layer_added","image_layer_masked","collage_layout_selected","collage_grid_image_added"],this.noParentActions=["image_layer_masked"],this.userActionVOs={editor:[],collage:[],designer:[]},this.pendingImageLayerAddedUserActionVOs={editor:[],collage:[],designer:[]},this.trackImageLayerAddedUserActionVOs=BeFunky.debounce(this.trackImageLayerAddedUserActionVOs.bind(this),3e4),this.pendingImageLayerMaskedUserActionVOs={editor:[],collage:[],designer:[]},this.trackImageLayerMaskedUserActionVOs=BeFunky.debounce(this.trackImageLayerMaskedUserActionVOs.bind(this),3e4),this.pendingCollageGridImageAddedUserActionVOs=[],this.trackCollageGridImageAddedUserActionVOs=BeFunky.debounce(this.trackCollageGridImageAddedUserActionVOs.bind(this),3e4),this.trackedCollageLayoutSelectedUserActionVO=null,this.pendingCollageLayoutSelectedUserActionVO=null,this.trackPendingCollageLayoutSelectedUserActionVO=BeFunky.debounce(this.trackPendingCollageLayoutSelectedUserActionVO.bind(this),3e4),this.lastEventID=null,this.lastAppViewState=null,window.addEventListener("INIT_COMPLETE",function(){e.lastAppViewState=BFN.AppModel.viewState}),this.sessionStarted=!1,this.isTrackable=!1,this._upgradeActions=[],BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this)),this.handleUserDataChanged(),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewStateUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_ID_UPDATED.type,this.handleGlobalHistoryIDUpdated.bind(this)),BFN.GlobalHistoryModel.addEventListener(BFN.GlobalHistoryModelEvents.HISTORY_UPDATED.type,this.handleGlobalHistoryUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS.type,this.handlePhotoEditorClearItems.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS.type,this.handleCollageMakerClearItems.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS.type,this.handleDesignerClearItems.bind(this));var t=function(){var e=BeFunky.getModal();return Boolean(e&&"settings_menu"===e.modalID)};un(function(){window.bfn_mp&&t()&&window.bfn_mp.track("app_theme_changed")},!1),gn(function(){window.bfn_mp&&t()&&window.bfn_mp.track("canvas_color_changed")})}},{key:"trackImageLayerAddedUserActionVOs",value:function(){this.trackImageLayerAddedUserActionVOsImmediately()}},{key:"trackImageLayerAddedUserActionVOsImmediately",value:function(){for(var e in this.pendingImageLayerAddedUserActionVOs){var t=null,n=this.pendingImageLayerAddedUserActionVOs[e];if(n.length){for(var i=n.length;--i>-1;){var r=n[i];if(r.transformItem.destroyed)n.splice(i,1);else if(r.active&&r.transformItem.parent){var a,o,s,l=r.eventObject;if(t||(t={imageLayerTypes:[],imageLayerSources:[]}),(a=t.imageLayerTypes).push.apply(a,v(l.imageLayerTypes)),(o=t.imageLayerSources).push.apply(o,v(l.imageLayerSources)),l.imageLayerGraphicsStyle)t.imageLayerGraphicsStyle=t.imageLayerGraphicsStyle||[],(s=t.imageLayerGraphicsStyle).push.apply(s,v(l.imageLayerGraphicsStyle));n.splice(i,1)}}t&&(t.imageLayerTypes=t.imageLayerTypes.unique().sort(),t.imageLayerSources=t.imageLayerSources.unique().sort(),t.imageLayerGraphicsStyle&&(t.imageLayerGraphicsStyle=t.imageLayerGraphicsStyle.unique().sort()),window.bfn_mp&&window.bfn_mp.track("image_layer_added",t))}}}},{key:"trackImageLayerMaskedUserActionVOs",value:function(){this.trackImageLayerMaskedUserActionVOsImmediately()}},{key:"trackImageLayerMaskedUserActionVOsImmediately",value:function(){for(var e in this.pendingImageLayerMaskedUserActionVOs){var t=null,n=this.pendingImageLayerMaskedUserActionVOs[e];if(n.length){for(var i=n.length;--i>-1;){var r=n[i];if(r.transformItem.destroyed)n.splice(i,1);else if(r.active&&(r.transformItem.parent||this.noParentActions.includes(r.eventID))){var a,o,s=r.eventObject;t||(t={imageLayerMaskedTypes:[],imageLayerMaskedSources:[]}),(a=t.imageLayerMaskedTypes).push.apply(a,v(s.imageLayerMaskedTypes)),(o=t.imageLayerMaskedSources).push.apply(o,v(s.imageLayerMaskedSources)),n.splice(i,1)}}t&&(t.imageLayerMaskedTypes=t.imageLayerMaskedTypes.unique().sort(),t.imageLayerMaskedSources=t.imageLayerMaskedSources.unique().sort(),window.bfn_mp&&window.bfn_mp.track("image_layer_masked",t))}}}},{key:"trackCollageGridImageAddedUserActionVOs",value:function(){this.trackCollageGridImageAddedUserActionVOsImmediately()}},{key:"trackCollageGridImageAddedUserActionVOsImmediately",value:function(){var e=null,t=this.pendingCollageGridImageAddedUserActionVOs;if(t.length){for(var n=t.length;--n>-1;){var i=t[n];if(i.active){var r,a,o=i.eventObject;e||(e={cellImageTypes:[],cellImageSources:[]}),(r=e.cellImageTypes).push.apply(r,v(o.cellImageTypes)),(a=e.cellImageSources).push.apply(a,v(o.cellImageSources)),t.splice(n,1)}}e&&(e.cellImageTypes=e.cellImageTypes.unique().sort(),e.cellImageSources=e.cellImageSources.unique().sort(),window.bfn_mp&&window.bfn_mp.track("collage_grid_image_added",e))}}},{key:"updatePendingCollageLayoutSelectedUserActionVO",value:function(){if(BFN.AppModel.viewingCollage){for(var e=null,t=this.getActiveUserActionVOs("collage"),n=t.length;--n>-1;){var i=t[n];if("collage_layout_selected"===i.eventID){e=i;break}}e&&(e!==this.trackedCollageLayoutSelectedUserActionVO?this.pendingCollageLayoutSelectedUserActionVO=e:this.pendingCollageLayoutSelectedUserActionVO=null)}}},{key:"trackPendingCollageLayoutSelectedUserActionVO",value:function(){this.trackPendingCollageLayoutSelectedUserActionVOImmediately()}},{key:"trackPendingCollageLayoutSelectedUserActionVOImmediately",value:function(){this.pendingCollageLayoutSelectedUserActionVO&&(this.pendingCollageLayoutSelectedUserActionVO.track(),this.trackedCollageLayoutSelectedUserActionVO=this.pendingCollageLayoutSelectedUserActionVO,this.pendingCollageLayoutSelectedUserActionVO=null)}},{key:"registerUserAction",value:function(e){if(e&&e.isValid){if(this.funnelEvents.includes(e.eventID))switch(e.actionSection){case"editor":case"collage":case"designer":this.purgeInactiveUserActionVOs(e.actionSection),this.userActionVOs[e.actionSection].push(e)}switch("image_layer_added"===this.lastEventID&&"image_layer_added"!==e.eventID&&this.trackImageLayerAddedUserActionVOsImmediately(),"image_layer_masked"===this.lastEventID&&"image_layer_masked"!==e.eventID&&this.trackImageLayerMaskedUserActionVOsImmediately(),"collage_grid_image_added"===this.lastEventID&&"collage_grid_image_added"!==e.eventID&&this.trackCollageGridImageAddedUserActionVOsImmediately(),"collage_layout_selected"!==e.eventID&&this.trackPendingCollageLayoutSelectedUserActionVOImmediately(),e.eventID){case"text_added":this.lastEventID!==e.eventID&&e.track();break;case"image_layer_added":switch(e.actionSection){case"editor":case"collage":case"designer":e.transformItem&&(this.pendingImageLayerAddedUserActionVOs[e.actionSection].push(e),this.trackImageLayerAddedUserActionVOs())}break;case"image_layer_masked":switch(e.actionSection){case"editor":case"collage":case"designer":e.transformItem&&(this.pendingImageLayerMaskedUserActionVOs[e.actionSection].push(e),this.trackImageLayerMaskedUserActionVOs())}break;case"collage_grid_image_added":switch(e.actionSection){case"editor":case"collage":case"designer":this.pendingCollageGridImageAddedUserActionVOs.push(e),this.trackCollageGridImageAddedUserActionVOs()}break;case"collage_layout_selected":switch(e.actionSection){case"editor":case"collage":case"designer":this.updatePendingCollageLayoutSelectedUserActionVO(),this.trackPendingCollageLayoutSelectedUserActionVO()}break;default:e.track()}this.lastEventID=e.eventID}}},{key:"purgeInactiveUserActionVOs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e=e||BFN.AppModel.sectionID){case"editor":case"collage":case"designer":for(var t=this.userActionVOs[e],n=t.length;--n>-1;){t[n].active||t.splice(n,1)}}}},{key:"purgeUserActionVOs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e=e||BFN.AppModel.sectionID){case"editor":case"collage":case"designer":this.userActionVOs[e].splice(0),this.pendingImageLayerAddedUserActionVOs[e].splice(0),this.pendingImageLayerMaskedUserActionVOs[e].splice(0),"collage"===e&&this.pendingCollageGridImageAddedUserActionVOs.splice(0)}}},{key:"updateUserActionVOsActiveState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=e||BFN.AppModel.sectionID;var t=BFN.AppModel.getSectionValue(e,BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,BFN.AppModelViewStates.VIEWING_DESIGNER),n=BFN.GlobalHistoryModel.selectedHistoryID[t];if(n){var i=BFN.GlobalHistoryModel.globalHistoryVOHash[n];if(i){var r=BFN.AppModel.sectionID;this.userActionVOs[r].forEach(function(e){e.active=e.actionTimestamp<=i.timestamp})}}}},{key:"addUpgradeAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=null,i=t?BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer"):"";e.forEach(function(e){e&&"string"==typeof e&&(n||(n=i),n+=(n?" - ":"")+e)});var r,a=BeFunky.getLocal("upgradeActions");a&&(a=a.split(","),this._upgradeActions.splice(0),(r=this._upgradeActions).push.apply(r,v(a)));n&&!this._upgradeActions.includes(n)&&(this._upgradeActions.push(n),BeFunky.setLocal("upgradeActions",this._upgradeActions))}},{key:"translateToReadable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof e?"":e.toLowerCase().split(" ").join("_").split("_").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")}},{key:"getActiveUserActionVOs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e=e||BFN.AppModel.sectionID){case"editor":case"collage":case"designer":return this.userActionVOs[e].filter(function(e){return e.active}).sort(function(e,t){return e.actionTimestamp-t.actionTimestamp})}return[]}},{key:"getSaveData",value:function(){var e=this;this.trackImageLayerAddedUserActionVOsImmediately(),this.trackCollageGridImageAddedUserActionVOsImmediately(),this.trackPendingCollageLayoutSelectedUserActionVOImmediately();var t=BFN.AppModel.sectionID,n={actions:[],fonts:[],assets:[],graphicFileNames:[],graphicStyles:[]},i=this.getActiveUserActionVOs(t),r=[];BFN.AppModel.getSectionValue(BFN.AppModel.viewState,BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).children.forEach(function(e){e instanceof BFN.TransformItem&&r.push(e)});for(var a=i.length;--a>-1;){var o=i[a];o.transformItems&&o.transformItems.length&&o.transformItems.forEach(function(e){r.includes(e)||r.push(e)});var s=null;if(this.funnelEvents.includes(o.eventID))switch(o.eventID){case"editing_applied":s=this.getFunnelString(o.eventObject.toolType,o.eventObject.toolName);break;case"text_added":s="Text Added";break;case"image_layer_added":s="Image Layer Added";break;case"image_layer_masked":s="Image Layer Masked";break;case"collage_grid_image_added":s="Collage Grid Image Added"}s&&!n.actions.includes(s)&&n.actions.push(s)}if("collage"===t){for(var l=null,u=this.getActiveUserActionVOs("collage"),c=u.length;--c>-1;){var h=u[c];if("collage_layout_selected"===h.eventID){l=h;break}}var d="Collage Layout : ";if(l){var m=l.eventObject.templateType,p=l.eventObject.templateCategory;d+=m&&p?this.getFunnelString(m,p):"Unknown"}else d+="User Project";n.actions.push(d)}if("designer"===t&&BFN.DesignerModel.projectVO){var g=BFN.DesignerModel.projectVO.sourceTemplateID,f="Design Layout : ";f+=g?"Preset ".concat(g):"Custom",n.actions.push(f)}return r.forEach(function(e){if("text"===e.type){var t=e.iText;for(var i in t.styles)for(var r in t.styles[i]){var a=t.styles[i][r];a.hasOwnProperty("fontFamily")&&!n.fonts.includes(a.fontFamily)&&n.fonts.push(a.fontFamily)}}else{var o=e.assetOrigin;o&&!n.assets.includes(o)&&n.assets.push(o);var s={line:"Outline",solid:"Solid",color:"Multicolor"}[e.graphicStyle];s&&!n.graphicStyles.includes(s)&&n.graphicStyles.push(s);var l=e.projectItemVO,u=[l.graphicID,l.maskImageMaskID,l.imageID].find(function(e){return e&&e.startsWith("graphic_")});if(u){var c=e.isShape?"svg":"png",h="".concat(u.replace("graphic_",""),".").concat(c);h&&!n.graphicFileNames.includes(h)&&n.graphicFileNames.push(h)}}}),"collage"!==t||BFN.CollageMakerCanvasPhotoGridModel.freeform||BFN.PhotoGrid.gridChildren.forEach(function(t){if(t.menuImageVO&&t.menuImageVO.id){var i=t.menuImageVO.id,r=e.getAssetOrigin(i);r&&!n.assets.includes(r)&&n.assets.push(r)}}),n.actions.sort(),n.fonts.sort(),n.assets.sort(),n}},{key:"getAssetOrigin",value:function(e){var t="Unknown";switch(BFN.getImageType(e)){case"computer":t="Computer";break;case"sample":t="Sample";break;case"befunky_photo":t="BeFunky Photo";break;case"befunky_layer":t="BeFunky Layer";break;case"pixabay":t="Pixabay";break;case"unsplash":t="Unsplash";break;case"pexels":t="Pexels";break;case"facebook":t="Facebook";break;case"patterns":t="Patterns";break;case"graphic":case"template_svg":t="Graphic Library";break;case"image":case"mask_image":t="Template"}return t}},{key:"getFunnelString",value:function(){for(var e=null,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(function(t){t&&"string"==typeof t&&(e||(e=""),e&&(e+=" - "),e+=t)}),e}},{key:"getEditorToolObject",value:function(e){if(!e)return null;var t=function(e){return BeFunky.LanguageManager.languageData.en[e]||e},n={},i=!0;if(i&&BFN.ArtsyAdjustAndPaintToolObjects.hasOwnProperty(e)){var r=BFN.ArtsyAdjustAndPaintToolObjects[e];if(r.hasOwnProperty("controls")){var a=r.controls;if(a.hasOwnProperty(e+"_id")){switch(n.toolID=e,n.toolName=t(r.name||e),n.toolPresetID=a[e+"_id"].defaultValue,n.toolSearchID=e,r.type){case"edit":n.toolType="Edit";break;case"touch_up":n.toolType="Touch Up";break;case"effect":n.toolType="Basic Effect";break;case"artsy":n.toolType="Artsy";break;case"frame":n.toolType="Frame";break;case"texture":n.toolType="Texture";break;case"overlay":n.toolType="Overlay";break;default:n.toolType="Edit"}i=!1}}}if(i)for(var o in BFN.UIMenuData.accordionMenus){if(!i)break;for(var s=BFN.UIMenuData.accordionMenus[o],l=0;l<s.length&&i;l++)for(var u=s[l].items,c=0;c<u.length&&i;c++){var h=u[c];if(h.name===e){switch(o){case"editor_edit":n.toolType="Edit";break;case"editor_touch_up":n.toolType="Touch Up"}n.toolName=t(h.name),n.toolID=h.name,n.toolSearchID=e,i=!1}}}if(i){var d=BFN.effectPresetMap[e];if(d)for(var m=0;m<BFN.EffectData.length&&i;m++){var p=BFN.EffectData[m];d===p.id&&(n.toolType="Basic Effect",n.toolName=p.name,n.toolID=p.id,n.toolPresetID=e.replace(d+"_",""),n.toolSearchID=e,i=!1)}}if(i&&BFN.LensFlareData.presets.hasOwnProperty(e)){var g=BFN.LensFlareData.presets[e];n.toolType="Basic Effect",n.toolName="Lens Flare",n.toolID="lens_flare",n.toolPresetID=g.presetID,n.toolSearchID=e,i=!1}if(i&&BFN.ArtsyPresetObjects.hasOwnProperty(e)&&BFN.artsyPresetMap.hasOwnProperty(e)){var f=BFN.ArtsyPresetObjects[e],v=BFN.artsyPresetMap[e];if(f.isArtsy)for(var y=["digitalart"],x=0;x<BFN.ArtsyData.length&&i;x++){var _=BFN.ArtsyData[x];v===_.id&&(n.toolType="Artsy",n.toolName=y.includes(_.id)?f.name:_.name,n.toolID=_.id,n.toolPresetID=f.id,n.toolSearchID=e,i=!1)}}if(i){var I=BFN.textureCategoryIDMap[e];if(I){var T=BFN.textureIDMap[I];if(T)for(var b=0;b<BFN.TextureData.length&&i;b++){var S=BFN.TextureData[b];T===S.id&&(n.toolType="Texture",n.toolName=S.name,n.toolID=S.id,n.toolPresetID=I,n.toolSearchID=e,i=!1)}}}if(i)switch(e){case"border":n.toolType="Frame",n.toolName="Border",n.toolID="border",n.toolSearchID=e,i=!1;break;case"drop_shadow":n.toolType="Frame",n.toolName="Drop Shadow",n.toolID="drop_shadow",n.toolSearchID=e,i=!1;break;default:var C=BFN.frameCategoryIDMap[e];if(C){var B=BFN.frameIDMap[C];if(B)for(var F in BFN.FrameData){if(!i)break;for(var E=BFN.FrameData[F],P=0;P<E.length&&i;P++){var k=E[P];B===k.id&&(n.toolType="Frame",n.toolName=k.name,n.toolID=k.id,n.toolPresetID=C,n.toolSearchID=e,i=!1)}}}}if(i&&BFN.OverlaysManager.isDataLoaded){var N=BFN.OverlaysManager.overlayCategoryIDMap[e];if(N){var M=BFN.OverlaysManager.overlayIDMap[N];if(M)for(var D=0;D<BFN.OverlaysManager.overlayMenuData.length&&i;D++){var w=BFN.OverlaysManager.overlayMenuData[D];M===w.id&&(n.toolType="Overlay",n.toolName=w.englishName,n.toolID=w.id,n.toolPresetID=N,n.toolSearchID=e,i=!1)}}}return!i&&n.toolType&&n.toolName?(n.toolSearchID=e,n):null}},{key:"handleUserDataChanged",value:function(e){var t=this;!this.sessionStarted&&BFN.BfnService.userLoggedIn&&window.bfn_mp&&(this.sessionStarted=!0,BeFunky.waitUntil({condition:function(){return!!BFN.AppModel.viewState},onSuccess:function(){t.isTrackable=!0,window.bfn_mp.track("app_session_started")},onTimeout:function(){return BeFunky.throwError("Unable to track app_session_started")}}))}},{key:"handleAppViewStateUpdated",value:function(e){if(this.lastAppViewState!==BFN.AppModel.viewState){var t=this.lastAppViewState;if(this.lastAppViewState=BFN.AppModel.viewState,!t)return;if(!BFN.AppModel.viewStateChangeReason)return;if(!window.isAppOpen)return;var n=new BFN.UserActionVO;n.eventID="app_section_changed",BFN.AppModel.viewStateChangeReason&&"string"==typeof BFN.AppModel.viewStateChangeReason&&(n.eventObject={reason:BFN.AppModel.viewStateChangeReason},BFN.AppModel.viewStateChangeReason=null),n.superObject={appSection:BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer")},n.register()}}},{key:"handleGlobalHistoryIDUpdated",value:function(e){this.updateUserActionVOsActiveState(),this.trackImageLayerAddedUserActionVOsImmediately(),this.trackCollageGridImageAddedUserActionVOsImmediately(),this.updatePendingCollageLayoutSelectedUserActionVO()}},{key:"handleGlobalHistoryUpdated",value:function(e){this.updateUserActionVOsActiveState()}},{key:"handlePhotoEditorClearItems",value:function(e){this.purgeUserActionVOs("editor")}},{key:"handleCollageMakerClearItems",value:function(e){this.purgeUserActionVOs("collage")}},{key:"handleDesignerClearItems",value:function(e){this.purgeUserActionVOs("designer")}},{key:"upgradeActions",get:function(){var e=this,t=BeFunky.getLocal("upgradeActions");return t&&(t=t.split(",")).forEach(function(t){e._upgradeActions.includes(t)||e._upgradeActions.splice(0,0,t)}),this._upgradeActions}}]),n}();BFN.SingletonQueue.add(function(){BFN.UserActionManager=new _y});var Iy=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.alignmentPanel=null,this.popoverWalkthrough=null,BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.updateAlignmentAvailable.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.updateAlignmentAvailable.bind(this)),BFN.TransformLayerManager.addEventListener(BFN.TransformLayerManagerEvents.ITEMS_UPDATED.type,this.updateAlignmentAvailable.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.updateAlignmentAvailable.bind(this)),document.getElementById("alignment_toggle_panel").parentElement.querySelector('label[for="alignment_toggle_panel"]').preventItemDeselect=!0}},{key:"initAlignmentPanel",value:function(){this.alignmentPanel=document.getElementById("alignment_options_panel"),this.alignmentPanel.setStyles({display:""}),BFN.UI.draggablePanel(this.alignmentPanel),BFN.HelpClueManager.show("alignment_options",{renderOptions:{side:"left",positionFactor:.16,left:"242px",container:this.alignmentPanel.querySelector(".popover-placeholder")}}),this.initPanelHeader()}},{key:"initPanelHeader",value:function(){this.alignmentPanel.querySelector("panel-header").addEventListener("CLOSE",function(){UITools.setToolValue("alignment","toggle_panel",!1,!1),UITools.applyTool("alignment"),UITools.updateToolControls("alignment")})}},{key:"toggleAlignmentPanel",value:function(e){var t=this;this.alignmentPanel||this.initAlignmentPanel();!function n(){if(!BFN.MainUI.viewportUpdating||!e||e&&t.temporarilyHidePanel)if(e){var i=t.alignmentPanel.panelSize,r=BFN.appViewportRect;t.temporarilyHidePanel?(t.temporarilyHidePanel=!1,t.alignmentPanel.show()):t.alignmentPanel.show(r.x+26,r.y+r.height-i.height-10)}else t.hasOwnProperty(t.togglePanelTimeoutID)&&(clearTimeout(t.togglePanelTimeoutID),delete t.togglePanelTimeoutID),t.alignmentPanel.hide();else t.togglePanelTimeoutID=setTimeout(function(){n()},10)}()}},{key:"updateAlignmentAvailable",value:function(){var e=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.active;BFN.AppModel.viewingEditor?e=e&&BFN.PhotoEditorModel.currentTexture:e&&this.temporarilyHidePanel&&(UITools.setToolValue("alignment","toggle_panel",!0),UITools.applyTool("alignment"),UITools.updateToolControls("alignment")),!e&&UITools.getToolValue("alignment","toggle_panel")?this.temporarilyHidePanel=!0:e&&this.temporarilyHidePanel&&(UITools.setToolValue("alignment","toggle_panel",!0),UITools.applyTool("alignment"),UITools.updateToolControls("alignment")),document.getElementById("alignment_toggle_panel").disabled=!e,!e&&UITools.getToolValue("alignment","toggle_panel")&&(UITools.setToolValue("alignment","toggle_panel",!1),UITools.applyTool("alignment"),UITools.updateToolControls("alignment"))}},{key:"handleAlignmentUpdate",value:function(){var e=UITools.getToolVO("alignment");switch(e.updating_id){case"toggle_panel":this.toggleAlignmentPanel(e.toggle_panel);break;case"snapping":var t=!0===e.snapping;BFN.TransformModel.snappingEnabled=t,BFN.SettingsManager.updateSetting("snapping",t?"yes":"no");break;case"display_distances":var n=!0===e.display_distances;BFN.TransformModel.showMeasurements=n,BFN.SettingsManager.updateSetting("display_distances",n?"yes":"no");break;case"guides":var i=!0===e.guides;BFN.TransformGuides.updateVisibility(),BFN.SettingsManager.updateSetting("guides",i?"yes":"no")}}}]),e}();BFN.SingletonQueue.add(function(){BFN.AlignmentOptionsManager=new Iy});var Ty=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("BasicShapeManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.validShapeTypes=["group","line","rectangle","triangle","ellipse","polygon","star","arrow"],this.strokeShapeTypes=["rectangle","triangle","ellipse","polygon"],this.defaultFill="EEEEFF",this.defaultStroke="DDDDFF",this.defaultValuesSetByUser=[],this.defaultValues={fill:this.defaultFill,fillAlpha:1,stroke:-1,strokeAlpha:1,strokeWidth:10,lineStyle:"solid",lineSegmentWidth:3,lineGapSize:.5,rectangleCornerRounding:0,polygonSides:5,polygonShiftOrientation:!1,starPoints:5,starInsetWeight:.5,starShiftOrientation:!1,arrowWeight:.25,arrowStyle:"thick",arrowDoubleSided:!1},this.ghostColor=8421504,this.ghostAlpha=.5,this.minHitAreaStrokeWidth=20}},{key:"createShape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.validShapeTypes.includes(e)){switch(n.hasOwnProperty("fill")||(n.fill=this.defaultValues.fill),n.hasOwnProperty("fillAlpha")||(n.fillAlpha=this.defaultValues.fillAlpha),n.hasOwnProperty("stroke")||(n.stroke=this.defaultValues.stroke),n.hasOwnProperty("strokeAlpha")||(n.strokeAlpha=this.defaultValues.strokeAlpha),n.hasOwnProperty("strokeWidth")||(n.strokeWidth=this.defaultValues.strokeWidth),e){case"line":n.hasOwnProperty("lineStyle")||(n.lineStyle=this.defaultValues.lineStyle),n.hasOwnProperty("lineSegmentWidth")||(n.lineSegmentWidth=this.defaultValues.lineSegmentWidth),n.hasOwnProperty("lineGapSize")||(n.lineGapSize=this.defaultValues.lineGapSize),n.fill=-1,n.fillAlpha=1,-1!==n.stroke||this.defaultValuesSetByUser.includes("stroke")||(n.stroke=this.defaultStroke);break;case"rectangle":n.hasOwnProperty("rectangleCornerRounding")||(n.rectangleCornerRounding=Math.min(.5,this.defaultValues.rectangleCornerRounding));break;case"polygon":n.hasOwnProperty("polygonSides")||(n.polygonSides=this.defaultValues.polygonSides),n.hasOwnProperty("polygonShiftOrientation")||(n.polygonShiftOrientation=this.defaultValues.polygonShiftOrientation);break;case"star":n.hasOwnProperty("starPoints")||(n.starPoints=this.defaultValues.starPoints),n.hasOwnProperty("starInsetWeight")||(n.starInsetWeight=this.defaultValues.starInsetWeight),n.hasOwnProperty("starShiftOrientation")||(n.starShiftOrientation=this.defaultValues.starShiftOrientation),n.stroke=-1,n.strokeAlpha=1,n.strokeWidth=0;break;case"arrow":n.hasOwnProperty("arrowWeight")||(n.arrowWeight=this.defaultValues.arrowWeight),n.hasOwnProperty("arrowStyle")||(n.arrowStyle=this.defaultValues.arrowStyle),n.hasOwnProperty("arrowDoubleSided")||(n.arrowDoubleSided=this.defaultValues.arrowDoubleSided),n.stroke=-1,n.strokeAlpha=1,n.strokeWidth=0}var i=new BFN.BasicShapeVO(e,n),r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),a={type:"texture",texture:null,isGoodie:!0,basicShapeVO:i};t&&(a.initialCenterPosition=t),r.addedItem=a}}},{key:"updateDefaultValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)this.defaultValues.hasOwnProperty(t)&&(this.defaultValuesSetByUser.includes(t)||this.defaultValuesSetByUser.push(t),this.defaultValues[t]=e[t])}},{key:"drawShape",value:function(e){if(e){var t=["line"].includes(e.type),n=e.fillColor,i=Math.max(.01,e.fillAlpha),r=e.strokeColor,a=Math.max(.01,e.strokeAlpha),o=-1!==e.stroke||t?e.strokeWidth*e.fitScale:0,s=e.shapeW,l=e.shapeH;e.shape.clear();var u=null;switch(e.type){case"line":this.drawLine(e,s,l,o);break;case"triangle":u=this.getTrianglePoints(s,l,o);break;case"rectangle":u=this.getRectPoints(s,l,o,e.attributes.rectangleCornerRounding);break;case"ellipse":u=this.getPolygonPoints(s,l,o,128,!0);break;case"polygon":u=this.getPolygonPoints(s,l,o,e.attributes.polygonSides,e.attributes.polygonShiftOrientation);break;case"star":u=this.getStarPoints(s,l,e.attributes.starPoints,e.attributes.starInsetWeight,e.attributes.starShiftOrientation);break;case"arrow":u=this.getArrowPoints(s,l,e.attributes.arrowStyle,e.attributes.arrowWeight,e.attributes.arrowDoubleSided)}if(e.hitAreaPolygonPoints&&(e.hitAreaPolygonPoints.splice(0),e.hitAreaPolygonPoints=null),u){this.drawInsetShape(e,u.outerPoints,u.innerPoints,n,i,r,a,o);var c=u,h=c.outerPointsHitArea,d=c.innerPointsHitArea;h&&(d&&d.length&&null===n&&(h.push(h[0]),d.reverse(),h.push.apply(h,v(d)),h.push(d[0])),h.length&&(e.hitAreaPolygonPoints=h))}}}},{key:"drawInsetShape",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(e&&t)if(n=n||null,window.testShapes)this.drawRect(e,e.shapeW,e.shapeH,16711680),this.drawFill(e,t,16777215,1),n&&(n.forEach(function(t,i){i||e.shape.lineStyle(2,0),e.shape.moveTo(t.x,t.y);var r=n[(i+1)%n.length];e.shape.lineTo(r.x,r.y)}),e.shape.lineStyle(null),n.forEach(function(t){t.invalid?e.shape.beginFill(16711680,.6):t.intersection?e.shape.beginFill(16711935,.6):e.shape.beginFill(255,.6),e.shape.drawCircle(t.x,t.y,t.invalid?5:10),e.shape.endFill()}));else if(n&&!n.length)s?null!==a?this.drawFill(e,t,a,o):this.drawFill(e,t,this.ghostColor,this.ghostAlpha):null!==i?this.drawFill(e,t,i,r):this.drawFill(e,t,this.ghostColor,this.ghostAlpha);else{var l=!1,u=!1;n&&(n.length&&(t.push(t[0]),n.reverse(),t.push.apply(t,v(n)),t.push(n[0])),this.drawFill(e,t,a,o),l=!0),null!==i&&(s&&n&&n.length?(l&&n.reverse(),this.drawFill(e,n,i,r)):this.drawFill(e,t,i,r),u=!0),u||l||this.drawFill(e,t,this.ghostColor,this.ghostAlpha)}}},{key:"drawFill",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e&&t&&!(t.length<3)){var r=e.shape;r.lineStyle(null),null!==n&&r.beginFill(n,i),t.forEach(function(e,t){t?r.lineTo(e.x,e.y):r.moveTo(e.x,e.y)}),null!==n?r.endFill():r.addHole()}}},{key:"drawRect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!(!e||t<=0||n<=0)){var a=t,o=n,s=e.shapeW/2,l=e.shapeH/2;this.drawFill(e,[{x:s-a/2,y:l-o/2},{x:s+a/2,y:l-o/2},{x:s+a/2,y:l+o/2},{x:s-a/2,y:l+o/2}],i,r)}}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(!e||t<=0||n<=0||i<=0)){e.shape.drawRect(0,(n-i)/2,t,i);var r=e.stroke,a=e.strokeColor,o=e.strokeAlpha;switch(-1===r&&(a=this.ghostColor,o=this.ghostAlpha),e.shape.beginFill(a,o),e.attributes.lineStyle){case"solid":e.shape.drawRect(0,(n-i)/2,t,i);break;case"dashed":for(var s=Math.min(t,i*e.attributes.lineSegmentWidth),l=s*(1+e.attributes.lineGapSize),u=0;u<t;u+=l)e.shape.drawRect(u,(n-i)/2,Math.min(s,t-u),i);break;case"dotted":for(var c=Math.min(t,i)/2,h=c*(2+2*e.attributes.lineGapSize),d=c;d<t;d+=h)d+c<=t&&e.shape.drawCircle(d,n/2,c)}e.shape.endFill()}}},{key:"drawBezierEllipse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(!(!e||t<=0||n<=0)){var o=.551915024494,s=Math.abs(t),l=Math.abs(n),u=e.shapeW/2,c=e.shapeH/2,h=u-.5*s,d=u+.5*s,m=c-.5*l,p=c+.5*l,g=o*s*.5,f=l*o*.5;null!==i&&e.shape.beginFill(i,r),e.shape.lineStyle(null),e.shape.moveTo(u,m),e.shape.bezierCurveTo(u+g,m,d,c-f,d,c),e.shape.bezierCurveTo(d,c+f,u+g,p,u,p),e.shape.bezierCurveTo(u-g,p,h,c+f,h,c),e.shape.bezierCurveTo(h,c-f,u-g,m,u,m),null!==a&&a<=Math.min(s,l)/2&&(h=u-.5*(s-=2*a),d=u+.5*s,m=c-.5*(l-=2*a),p=c+.5*l,g=o*s*.5,f=l*o*.5,e.shape.lineTo(u,m),e.shape.bezierCurveTo(u-g,m,h,c-f,h,c),e.shape.bezierCurveTo(h,c+f,u-g,p,u,p),e.shape.bezierCurveTo(u+g,p,d,c+f,d,c),e.shape.bezierCurveTo(d,c-f,u+g,m,u,m)),null!==i?e.shape.endFill():e.shape.addHole()}}},{key:"getLinePoints",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e<=0||t<=0||n<=0?{outerPoints:[],innerPoints:[]}:{outerPoints:[new PIXI.Point(0,Math.round((t-n)/2)),new PIXI.Point(e,Math.round((t-n)/2)),new PIXI.Point(e,Math.round((t+n)/2)),new PIXI.Point(0,Math.round((t+n)/2))],innerPoints:[]}}},{key:"getTrianglePoints",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<=0||t<=0||n<0)return{outerPoints:[],innerPoints:[]};var i=Math.atan(t/(e/2)),r=Math.atan(e/2/t),a=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=n/Math.sin(i)+Math.tan(Math.PI/2-i)*n,o=n/Math.sin(r),s=Math.max(0,e-2*a),l=Math.max(0,t-o-n),u=[];return s>0&&l>0&&u.push.apply(u,[new PIXI.Point(e/2,o),new PIXI.Point(a,t-n),new PIXI.Point(e-a,t-n)]),u},o=a(0),s=n>0?a(n):null;return{outerPoints:o,innerPoints:s,outerPointsHitArea:v(o),innerPointsHitArea:s?n>this.minHitAreaStrokeWidth?v(s):a(this.minHitAreaStrokeWidth):null}}},{key:"getRectPoints",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=e-2*n,a=t-2*n;if(r<=0||a<=0)return[];var o=[];if(i>0){for(var s=[],l=Math.min(r,a)/2*i,u=Math.max(8,Math.min(128,Math.round(l*(2*Math.PI)/4))),c=(u-=u%4)/4,h=-Math.PI/2,d=0;d<u;d++){var m=new PIXI.Point(Math.cos(h)*l,Math.sin(h)*l);m.x+=e/2,m.y+=t/2,s.push(m),h+=2*Math.PI/u}for(var p=0;p<4;p++)for(var g=0;g<=c;g++){var f=s[(p*c+g)%s.length].clone();f.x+=(r/2-l)*([0,1].includes(p)?1:-1),f.y+=(a/2-l)*([1,2].includes(p)?1:-1);var v=!0;g===c&&(r===2*l&&[1,3].includes(p)&&(v=!1),a===2*l&&[0,2].includes(p)&&(v=!1)),v&&o.push(f)}}else{var y=(e-r)/2,x=(t-a)/2;o.push.apply(o,[new PIXI.Point(e-y,x),new PIXI.Point(e-y,t-x),new PIXI.Point(y,t-x),new PIXI.Point(y,x)])}return o},a=r(0),o=n>0?r(n):null;return{outerPoints:a,innerPoints:o,outerPointsHitArea:v(a),innerPointsHitArea:o?n>this.minHitAreaStrokeWidth?v(o):r(this.minHitAreaStrokeWidth):null}}},{key:"getPolygonPoints",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e<=0||t<=0)return{outerPoints:[],innerPoints:null};for(var a=[],o=-Math.PI/2,s=0;s<i;s++){var l=new PIXI.Point(Math.cos(o)*(e/2),Math.sin(o)*(t/2));a.push(l),o+=2*Math.PI/i}if(r){for(var u=[],c=0;c<a.length;c++){var h=a[c],d=a[(c+1)%a.length],m=new PIXI.Point((h.x+d.x)/2,(h.y+d.y)/2);u.push(m)}a.splice(0),a.push.apply(a,u)}var p=null;a.forEach(function(e){p?(p.left=Math.min(p.left,e.x),p.right=Math.max(p.right,e.x),p.top=Math.min(p.top,e.y),p.bottom=Math.max(p.bottom,e.y)):p=new BFN.Rectangle(e.x,e.y)});var g=Math.min(e/p.width,t/p.height);a.forEach(function(n){n.x*=g,n.y*=g,n.x+=e/2-p.center*g,n.y+=t/2-p.middle*g});var f=n>0?this.insetPolygon(a,n):null;return{outerPoints:a,innerPoints:f,outerPointsHitArea:[].concat(a),innerPointsHitArea:f?n>this.minHitAreaStrokeWidth?v(f):this.insetPolygon(a,this.minHitAreaStrokeWidth):null,centerPoint:new PIXI.Point(e/2-p.center*g,t/2-p.middle*g)}}},{key:"insetPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e||e.length<3)return null;if(!t)return v(e);t=Math.abs(t);for(var n=[],i=null,r=null,a=0;a<e.length;a++){var o=e[a],s=e[(a-1+e.length)%e.length],l=e[(a+1)%e.length],u=Math.atan2(s.y-o.y,s.x-o.x),c=Math.atan2(l.y-o.y,l.x-o.x),h=Math.abs(c-u),d=(u+c)/2;h>Math.PI&&(h=2*Math.PI-h,d+=Math.PI);var m=h/2,p=t/Math.sin(m),g=new PIXI.Point(o.x+Math.cos(d)*p,o.y+Math.sin(d)*p);(null===i||o.y>i)&&(i=o.y,r=g.y),n.push(g)}var f=n[0].y>r,y=[];if(!f){y.push.apply(y,v(this.getIntersectionPoints(n)));for(var x=y.length;--x>-1;){var _=y[x];n.splice(_.index+1,0,_)}}for(var I=!1,T=f,b=0;b<n.length;b++){var S=n[b],C=n[(b+1)%n.length];!b&&!f&&e.length>3&&(T=(T=Math.cos(Math.atan2(C.y-S.y,C.x-S.x))<-1e-10)||S.x-n[n.length-1].x<0),f?S.invalid=!0:S.intersection?(S.invalid=!1,T=!T):S.invalid=T,I=I||T}if(!window.testShapes){if(I)for(var B=n.length;--B>-1;){n[B].invalid&&n.splice(B,1)}if(y.length)for(var F=n.length;--F>0;){var E=n[F],P=n[F-1];E.intersection&&P.intersection&&E.rootPoint===P.rootPoint&&n.splice(F,1)}}return n}},{key:"getIntersectionPoints",value:function(e){if(!e||e.length<3)return null;var t=[];e.forEach(function(n,i){var r={ptA:n,ptB:e[(i+1)%e.length],bounds:new BFN.Rectangle(n.x,n.y)};r.bounds.left=Math.min(r.ptA.x,r.ptB.x),r.bounds.right=Math.max(r.ptA.x,r.ptB.x),r.bounds.top=Math.min(r.ptA.y,r.ptB.y),r.bounds.bottom=Math.max(r.ptA.y,r.ptB.y);var a=Math.atan2(r.ptB.y-r.ptA.y,r.ptB.x-r.ptA.x),o=Math.sin(a),s=Math.cos(a);r.slope=o?s?o/s:1/0:0,r.intercept=r.slope===1/0?NaN:0===r.slope?r.ptB.y:r.ptB.y-r.slope*r.ptB.x,t.push(r)});for(var n=function(e,t,n,i){var r=(t.x-e.x)*(i.y-n.y)-(i.x-n.x)*(t.y-e.y);if(0===r)return!1;var a=((i.y-n.y)*(i.x-e.x)+(n.x-i.x)*(i.y-e.y))/r,o=((e.y-t.y)*(i.x-e.x)+(t.x-e.x)*(i.y-e.y))/r;return 0<a&&a<1&&0<o&&o<1},i={},r=0;r<t.length;r++)for(var a=t[r],o=0;o<t.length;o++)if(![r-1,r,(r+1)%t.length].includes(o)){var s=t[o];if(a.slope!==s.slope&&n(a.ptA,a.ptB,s.ptA,s.ptB)){var l=Math.min(r,o)+"_"+Math.max(r,o),u=new PIXI.Point;u.startIndex=Math.min(r,o),u.endIndex=Math.max(r,o),a.slope===1/0&&0===s.slope?(u.x=a.ptA.x,u.y=s.ptA.y):s.slope===1/0&&0===a.slope?(u.x=s.ptA.x,u.y=a.ptA.y):(u.x=(s.intercept-a.intercept)/(a.slope-s.slope),u.y=s.slope*u.x+s.intercept),i.hasOwnProperty(l)?(i[l].x=(i[l].x+u.x)/2,i[l].y=(i[l].y+u.y)/2):i[l]=u}}var c=function(e,t){var n=e.clone();return n.index=t,n.intersection=!0,n.rootPoint=e,n},h=[];for(var d in i){var m=i[d];h.push.apply(h,[c(m,m.startIndex),c(m,m.endIndex)])}return h.sort(function(e,t){return e.index-t.index}),h}},{key:"getStarPoints",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e<=0||t<=0)return{outerPoints:[],innerPoints:null};for(var a=this.getPolygonPoints(e,t,0,n,r),o=[],s=[],l=0;l<a.outerPoints.length;l++){var u=a.outerPoints[l],c=a.outerPoints[(l+1)%a.outerPoints.length],h=new PIXI.Point((u.x+c.x)/2,(u.y+c.y)/2),d=h.x-a.centerPoint.x,m=h.y-a.centerPoint.y,p=Math.sqrt(Math.pow(d,2)+Math.pow(m,2)),g=Math.atan2(m,d),f=Math.max(Math.min(2,e/2,t/2),p*(1-i)),v=new PIXI.Point(a.centerPoint.x+Math.cos(g)*f,a.centerPoint.y+Math.sin(g)*f);o.push.apply(o,[u,v]);var y=Math.max(Math.min(2,e/2,t/2),p*(1-Math.min(.75,i))),x=new PIXI.Point(a.centerPoint.x+Math.cos(g)*y,a.centerPoint.y+Math.sin(g)*y);s.push.apply(s,[u,x])}return{outerPoints:o,innerPoints:null,outerPointsHitArea:s}}},{key:"getArrowPoints",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"thick",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t<=0||n<=0||!["thick","thin"].includes(i))return{outerPoints:[],innerPoints:null};var o=[],s=[];switch(i){case"thick":var l=n/2/Math.tan(Math.PI/6),u=a?t/2:0,c=Math.max(u,t-l),h=t/2,d=Math.min(h,l);if(o.push.apply(o,[new PIXI.Point(c,0),new PIXI.Point(t,n/2),new PIXI.Point(c,n)]),s.push.apply(s,o),c>u){var m=n/2*(1-r),p=Math.round(n-2*m),g=Math.round((n-p)/2),f=Math.round((n+p)/2),y=Math.min(g,Math.round((n-this.minHitAreaStrokeWidth)/2)),x=Math.max(f,Math.round((n+this.minHitAreaStrokeWidth)/2));if(r<1&&(o.push(new PIXI.Point(t-l,f)),s.push(new PIXI.Point(t-l,x))),o.push(new PIXI.Point(a?d:0,f)),s.push(new PIXI.Point(a?d:0,x)),a){var _=[new PIXI.Point(d,n),new PIXI.Point(0,n/2),new PIXI.Point(d,0)];o.push.apply(o,_),s.push.apply(s,_)}o.push(new PIXI.Point(a?d:0,g)),s.push(new PIXI.Point(a?d:0,y)),r<1&&(o.push(new PIXI.Point(t-l,g)),s.push(new PIXI.Point(t-l,y)))}else o.push(new PIXI.Point(0,n/2)),s.push(new PIXI.Point(0,n/2));break;case"thin":var I=function(i){var o=[],s=n/(1+2*Math.sin(Math.PI/4))/1,l=r*(s-2)+2;i&&(l=Math.max(l,e.minHitAreaStrokeWidth));var u=n/2,c=Math.sin(Math.PI/4)*l,h=u+c,d=a?t/2:0,m=t/2;if(a){var p=[new PIXI.Point(0,n/2),new PIXI.Point(u,0),new PIXI.Point(h,c)];1===r&&p.pop(),p.forEach(function(e){e.x=Math.min(m,e.x)}),o.push.apply(o,p)}o.push(new PIXI.Point(a?Math.min(m,2*c+l/2):0,n/2-l/2));var g=[new PIXI.Point(t-2*c-l/2,n/2-l/2),new PIXI.Point(t-h,c),new PIXI.Point(t-u,0),new PIXI.Point(t,n/2),new PIXI.Point(t-u,n),new PIXI.Point(t-h,n-c),new PIXI.Point(t-2*c-l/2,n/2+l/2)];if(1===r&&(g.pop(),g.shift()),g.forEach(function(e){e.x=Math.max(d,e.x)}),o.push.apply(o,g),o.push(new PIXI.Point(a?Math.min(m,2*c+l/2):0,n/2+l/2)),a){var f=[new PIXI.Point(h,n-c),new PIXI.Point(u,n)];1===r&&f.shift(),f.forEach(function(e){e.x=Math.min(m,e.x)}),o.push.apply(o,f)}return o.forEach(function(e){e.y=Math.floor(e.y)}),o};o.push.apply(o,v(I(!1))),s.push.apply(s,v(I(!0)))}return{outerPoints:o,innerPoints:null,outerPointsHitArea:s}}}]),e}();function by(){var e=g(["<strong>","</strong>"]);return by=function(){return e},e}function Sy(){var e=g(["<strong>","</strong>"]);return Sy=function(){return e},e}function Cy(){var e=g(["\n    <div id=",' class="modal modal--button-sm image-preview">\n        <div class="image-preview__left-column">\n            <div class="image-preview__image-outer">\n                <div class="image-preview__image-inner" style=','>\n                    <div class="image-preview__image-wrapper" style=','>\n                        <img class="image-preview__image" src="','" alt="Image with background removed">\n                    </div>\n                </div>\n            </div>\n            <div class="image-preview__dimensions">\n                <p class="image-preview__dimensions-label" data-lang="dimensions" style="margin: 0">Dimensions</p>\n                <p class="bold">'," x ",'</p>\n            </div>\n        </div>\n        <div class="image-preview__right-column">\n            <h3 class="image-preview__header">','</h3>\n            <p class="text-sm">','</p>\n            <p class="text-sm">','</p>\n            <div class="checkbox">\n                <input type="checkbox" id="','" @change=','>\n                <label class="checkbox__label" for="','">\n                    <span class="checkbox__box checkbox__box--sm">\n                        ',"\n                    </span>\n                    <string>",'</string>\n                </label>\n            </div>\n            <div class="image-preview__footer button-group">\n                <button class="modal__button button button--grey-300 button--cancel" @click=',">\n                    ",'\n                </button>\n                <button class="modal__button button button--blue focus-initially" @click=',">\n                    ","\n                </button>\n            </div>\n        </div>\n    </div>"]);return Cy=function(){return e},e}BFN.SingletonQueue.add(function(){BFN.BasicShapeManager=new Ty});var By=BeFunky.lit,Fy=By.appLang,Ey=By.icon,Py=By.elem,ky=By.html;var Ny=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("BackgroundRemovalManager Init"),this.artsyServiceURL="https://upload.befunky.com/artsy/",this.initDefaultValues(),this.initPreviewComponents()}},{key:"initDefaultValues",value:function(){this.lastSourceTexture=null,this.lastUploadUrl=null}},{key:"initPreviewComponents",value:function(){this.maskedContainer=new PIXI.Container,this.backgroundSprite=new PIXI.Sprite,this.backgroundSprite.texture=PIXI.Texture.EMPTY,this.maskedContainer.addChild(this.backgroundSprite),this.sourceSprite=new PIXI.Sprite,this.maskedContainer.addChild(this.sourceSprite),this.maskSprite=new PIXI.Sprite,this.maskedContainer.addChild(this.maskSprite),this.sourceSprite.mask=this.maskSprite}},{key:"getRandomFileName",value:function(e,t){var n,i,r,a,o,s=(i=n?new Date(n):new Date,r="".concat(i.getMonth()+1),a="".concat(i.getDate()),o=i.getFullYear(),r.length<2&&(r="0".concat(r)),a.length<2&&(a="0".concat(a)),[o,r,a]),l=function(e){return(e?new Date(e):new Date).toTimeString().split(" ")[0].split(":")}();return"".concat(e,"_").concat(s.join(""),"_").concat(l.join(""),"_").concat(Math.random().toString(36).substr(2,5),".").concat(t)}},{key:"reset",value:function(){this.lastSourceTexture=null,this.lastUploadUrl=null}},{key:"removeBackground",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(e)if(e&&e.baseTexture&&e.baseTexture.maskTexture)n(e.baseTexture.maskTexture);else{var i=!1;BeFunky.showLoadScreen({onCancel:function(){i=!0,n()}});var r=function(r,a){var s=t.artsyServiceURL,l={method:"api/remove-background/",image:r,masking:"0"};BeFunky.Params.isAdmin&&(l.is_beta="1");var u={method:"POST",body:BeFunky.createFormData(l),headers:{"X-CSRF-Token":getCsToken()}};UIMessages.display("isolating_subject",650);var c=BeFunky.trackUserTiming("Background Removal","remove_background","network");BeFunky.request(s,u,function(r){var s=r.error,l=r.response;if(c(),!i){if(s||!l||l&&!l.data)return o("Background removal request failed",s||"no_response");var u=l.data,h=u.image;if(!u.success)return o("Background removal failed",l);if(!h)return o("Got invalid response from background removal API",l);var d={textureSize:BFN.maxImageSize,readEXIF:!1};BFN.RequestUtils.getTexture(h,d,function(r){var s=r.error,l=r.texture;if(!i){if(s)return o("Unable to download image and convert to texture",s);BeFunky.hideLoadScreen(),t.handleBackgroundRemovalImageTexture(e,l,a,n)}})}})},a=PIXI.RenderTexture.create(e.width,e.height);a.fillColor(0),a.copyPixels(e,null,!1),BFN.Stage.extract.canvas(a).toBlob(function(n){if(a.destroyGC(!0),!i){if(!n)return o("Unable to generate blob background removal",n);if(null!=t.lastUploadUrl&&e===t.lastSourceTexture)r(t.lastUploadUrl,n);else if(void 0!==window.DirectUPL){UIMessages.display("preparing_image");var s=BeFunky.trackUserTiming("Background Removal","upload_image","network");t.lastSourceTexture=e,window.DirectUPL.upload(function(e){if(e&&e.url&&e.s3_name){if(s(),t.lastUploadUrl=e.url,i)return;r(e.url,n)}else o("Background removal image upload failed",e)},{bucket:"background-removal",content_type:"image/jpeg",blob:n,filename:"uploads/".concat(t.getRandomFileName("BGR","jpg"))})}}},"image/jpeg",.95)}else n();function o(e,t){BeFunky.throwError(e,t),i||(n(),BeFunky.hideLoadScreen(),UIMessages.display(e,1500))}}},{key:"isolateSubjectOnPainter",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e&&BFN.ImagePainterUndoManager.currentImagePainter)if(this.isolateSubjectOnPainterWithHistory())n();else{var i=BFN.ImagePainterUndoManager.currentImagePainter;this.removeBackground(e,function(e){if(e){var r=!!i.altTexture,a=r?i.altTexture:i.texture;i.subjectIsolated=!0,i.updatePrevTexture(),r&&a.fillColor(0),a.copyPixels(e,void 0,!r),t&&(a.invert(),r||a.convertLumaToAlpha()),i.updateComplete(),i.paintBounds=new PIXI.Rectangle(0,0,a.width,a.height),i.paintApplied=!0,i.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED),i.subjectIsolated=!1,n(),BFN.MainUI.requestRender()}else n()})}}},{key:"isolateSubjectOnPainterWithHistory",value:function(){if(BFN.ImagePainterUndoManager.currentImagePainter&&BFN.ImagePainterUndoManager.regionVOs.length){var e=BFN.ImagePainterUndoManager.regionVOs[BFN.ImagePainterUndoManager.regionIndex];if(e.redoRegionTexture.subjectIsolated){switch(BFN.ImagePainterUndoManager.direction){case"undo":if(BFN.UndoManager.redoExists)return console.log("SIMPLE REDO, THEN CLEAR REMAINING REGION VOs (SUBJECT ALREADY ISOLATED IN REDO)"),BFN.ImagePainterUndoManager.clearRegionVOs(BFN.ImagePainterUndoManager.regionIndex+1),BFN.UndoManager.redo(),!0;break;case"redo":return console.log("DO NOTHING BUT CLEAR REMAINING REGION VOs (SUBJECT ALREADY ISOLATED)"),BFN.ImagePainterUndoManager.clearRegionVOs(BFN.ImagePainterUndoManager.regionIndex+1),!0}return!1}if(e.undoRegionTexture.subjectIsolated&&"undo"===BFN.ImagePainterUndoManager.direction)return console.log("DO NOTHING (SUBJECT ALREADY ISOLATED IN UNDO STATE)"),!0}return!1}},{key:"getCurrentEditorToolObject",value:function(){var e=BFN.PhotoEditorCanvasTools,t=null,n=null;switch(e.currentTool){case e.cutout:n="cutout";break;case e.background:n="background";break;case e.effect:if(t=BFN.EffectManager.effectID&&BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("effectName")?BFN.EffectManager.parameters.effectName:BFN.EffectManager.effectID,null!=BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("toolID"))try{n=(BFN.UIToolData.hasOwnProperty(BFN.EffectManager.parameters.toolID),BFN.EffectManager.parameters.toolID)}catch(e){}break;case e.artsy:t="artsy",n=BFN.ImageArtsy.currentToolID?BFN.ImageArtsy.currentToolID:null,BFN.ImageArtsy.currentToolID&&BFN.ArtsyPresetObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID]&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name&&(t=BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name);break;case e.texture:t=BFN.ImageTexture.currentTextureName,n=BFN.ImageTexture.currentTextureID?BFN.ImageTexture.currentTextureID:null}return n||t?BFN.UserActionManager.getEditorToolObject(n||t):{}}},{key:"handleBackgroundRemovalImageTexture",value:function(e,t,n,i){var r=this;e.altTexture?(this.backgroundSprite.texture=e.altTextureInverse?e.renderClone():e.altTexture.renderClone(),this.backgroundSprite.texture.fillColorOverlap(16711680,.5),this.sourceSprite.texture=e.altTextureInverse?e.altTexture:e):(this.backgroundSprite.texture=PIXI.Texture.EMPTY,this.sourceSprite.texture=e),this.maskSprite.texture=t;var a,o=PIXI.RenderTexture.create(e.width,e.height);if(BFN.Stage.render(this.maskedContainer,o),this.backgroundSprite.texture!==PIXI.Texture.EMPTY&&(this.backgroundSprite.texture.destroyGC(!0),this.backgroundSprite.texture=PIXI.Texture.EMPTY),this.sourceSprite.texture=PIXI.Texture.EMPTY,this.maskSprite.texture=PIXI.Texture.EMPTY,BFN.BfnService.userIsPlus){a=Math.max.apply(Math,v(BFN.TextureUtils.getScaledDimensions(o,{maxWidth:564,maxHeight:542})))}else a=480;var s=BFN.Util.getThumbTexture(o,a);o.destroyGC(!0);var l=BFN.TextureUtils.textureToBase64(s),u=s.width,c=s.height,h=u/c;s.destroyGC(!0);var d=function(){function e(){var e;(e=BeFunky).logError.apply(e,arguments)}UIMessages.display("thanks_for_sharing"),BeFunky.requestAPI("photo/rec-ai-errored-image",{image:r.lastUploadUrl}).then(function(t){"success"!==t.data&&e("Share background removal image failed:",t.data)}).catch(function(t){e("Share background removal image request failed:",t||"no_response")})},m=function(e,t){var n=r.getCurrentEditorToolObject();n.imageLayer=!!BFN.TransformModel.layerItem,n.imageShared=e,n.imageRejected=t;var i=new BFN.UserActionVO;i.eventID="background_remover_applied",i.eventObject=n,i.track()};if(BFN.BfnService.userIsPlus)!function(e){var t,n=e.previewBase64,i=e.width,r=e.height,a=e.onApply,o=e.onCancel,s=!1,l=!1,u=!1,c="background_remover_preview_".concat(BeFunky.randomString(10)),h="background_remover_share_".concat(BeFunky.randomString(10)),d="padding-bottom: ".concat(r/i*100,"%"),m=Py(Cy(),c,"width: ".concat((t=i/r)>=1.111969111969112?100:100*t/1.111969111969112,"%"),d,n,i,r,Fy("preview_your_results"),Fy("background_remover_preview_modal_body_1"),Fy(["background_remover_preview_modal_body_2",{keep:ky(Sy(),Fy("keep",!0)),remove:ky(by(),Fy("remove",!0))}]),h,function(e){s=e.target.checked},h,Ey("checkmark-icon","icon checkbox__icon icon--12"),Fy("background_remover_preview_modal_checkbox"),function(){u=!0,l=!1,BeFunky.closeModal(c)},Ey("cancel-icon","icon icon--14"),function(){u=!0,l=!0,BeFunky.closeModal(c)},Ey("checkmark-icon","icon icon--20"));BeFunky.openModal(m,{destroyOnClose:!0,size:[944,632],onClose:function(){if(!u)return o(!1);l?a(s):o(s)},closeOnClickOutside:!1})}({previewBase64:l,width:u,height:c,onApply:function(n){i?(t.convertLumaToAlpha(),e.baseTexture.maskTexture=t,i(t)):t.destroyGC(!0),n&&d(),m(n,!1)},onCancel:function(e){t.destroyGC(!0),i&&i(),e&&d(),m(e,!0)}});else{var p=Boolean(e.altTexture);t.destroyGC(!0),i&&i();var g=BFN.Util.getThumbTexture(e,a),f=BFN.TextureUtils.textureToBase64(g);g.destroyGC(!0),p?BeFunky.createAndOpenTeaser("isolate_subject",{featureName:"this_feature",text:"teaser_isolate_subject_body",images:[f,l],imageAspectRatio:h,learnMoreLink:"".concat(BeFunky.Params.siteUrl,"learn/automatic-background-remover/")}):BeFunky.createAndOpenTeaser("background_removal",{headingText:"teaser_background_remover_title",text:"teaser_background_remover_body",images:[f,l],imageAspectRatio:h,learnMoreLink:"".concat(BeFunky.Params.siteUrl,"learn/automatic-background-remover/")});var y=this.getCurrentEditorToolObject(),x=["Background Remover"];y.toolType&&x.push(y.toolType),y.toolName&&x.push(y.toolName),y.toolSearchID&&x.push(y.toolSearchID),BFN.UserActionManager.addUpgradeAction(x)}}}]),e}();BFN.SingletonQueue.add(function(){BFN.BackgroundRemovalManager=new Ny}),BFN.EditLayerManagerEvents={};var My=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){BeFunky.log("EditLayerManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){}},{key:"editTransformItem",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=BFN.TransformModel.selectedTransformItem;!r||r.isGoodie||"texture"!=r.type&&"frame_texture"!=r.type||(BFN.TransformModel.layerItem=r,BFN.TransformItemIsolator.isolateTransformItem(BFN.TransformModel.selectedTransformItem,function(){switch(BFN.PhotoEditorMenuModel.createCurrentImageThumb(r.getPresetItemThumbTexture(),!0),BFN.TransformItemIsolator.itemSprite.visible=!0,UIToggler.toggleMainMenu(!0),BFN.updateAppMenuDisplay("edit_layer"),t){case"cutout":UITools.setToolValue("editor_edit","cutout",!0),UITools.applyTool("editor_edit"),UITools.setToolValue("editor_edit","cutout",!1)}n&&n()},function(){BFN.PhotoEditorModel.sourceTexture&&BFN.PhotoEditorMenuModel.createCurrentImageThumb(BFN.PhotoEditorModel.sourceTexture),BFN.TransformModel.layerItem=null,BFN.updateAppMenuDisplay(),e.updatePanelsAvailable(),i&&i()}),this.updatePanelsAvailable())}},{key:"editTransformItemAlternateMenu",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!BFN.TransformItemIsolator.isolatedTransformItem&&e&&BFN.toolViewstates.hasOwnProperty(e)){var r=BFN.toolViewstates[e],a=e+"_menu",o="tool_controls",s=null,l=null,u=null,c=function(){if(s=document.getElementById(a))try{s.generateItem(),s.setupItem(),s.buildItem(),l=s.querySelector(".preset-menu-item__advanced-settings-padding-container"),o=s.options.presetName,u=s}catch(e){console.log("error",e)}};switch(r){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP:BFN.touchupPaintMenus.hasOwnProperty(a)&&"touchup"===BFN.effectIDMap[e]&&(BFN.setupTouchupPaintMenu(a),(s=document.getElementById(a))&&(l=s.querySelector(".control-item-set")),o=e);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:BFN.effectPresetMap.hasOwnProperty(e)?c():BFN.adjustAndPaintMenus.hasOwnProperty(a)&&(BFN.setupAdjustAndPaintMenu(a),(s=document.getElementById(a))&&(l=s.querySelector(".control-item-set")),o=e);break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY:BFN.artsyPresetMap.hasOwnProperty(e)&&c();break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME:break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE:BFN.textureCategoryIDMap.hasOwnProperty(e)&&BFN.texturePresetMap.hasOwnProperty(BFN.textureCategoryIDMap[e])&&c();break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY:break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE:BFN.lensFlarePresetMap.hasOwnProperty(e)&&c();break;default:(s=document.getElementById(a))&&(l=s.querySelector(".control-item-set")),o=e}if(l){var h=BFN.TransformModel.selectedTransformItem;if(h&&!h.isGoodie&&("texture"==h.type||"frame_texture"==h.type)){var d=l.querySelector(".apply_cancel_menu_container");if(d){var m=document.getElementById("editor_apply_cancel_menu");m.upgradeMode=!!UITools.toolPlusHash[e]&&!BFN.BfnService.userIsPlus,d.appendChild(m);var p=document.getElementById("layer_isolator_tool_menu_header").firstElementChild;p.langId=o,p.toggleButtons({help:"cutout"===o,back:"cutout"===o}),"cutout"===o&&(p.clueId="cutout",BFN.HelpClueManager.setup("cutout",{left:"260px",top:"64px",container:p.nextElementSibling,positionFactor:.165}),p.addEventListener("BACK",function(){UITools.setToolValue("editor_apply_cancel","cancel",!0),UITools.applyTool("editor_apply_cancel"),UITools.setToolValue("editor_apply_cancel","cancel",!1)})),BFN.TransformModel.layerItem=h,u&&(BFN.activePresetMenuItem=u);for(var g=document.createElement("div");l.firstChild;)g.appendChild(l.firstChild);document.getElementById("layer_isolator_tool_menu").appendChild(g);var f=BFN.EDITOR_MENU.presetGenericMenuIDs[e];if(f)g.querySelector(".generic_menu_container").appendChild(document.getElementById(f));var v=BFN.EDITOR_MENU.presetBrushMenuIDs[e];if(v){var y=g.querySelector(".brush_menu_container");y&&y.appendChild(document.getElementById(v))}document.getElementById("layer_isolator_edit_complete").setStyles({visibility:"hidden"}),BFN.TransformItemIsolator.isolateTransformItem(BFN.TransformModel.selectedTransformItem,function(){BFN.PhotoEditorCanvas.canvasTools.altSourceTexture=BFN.TransformItemIsolator.altSourceTexture,BFN.PhotoEditorCanvasModel.viewState=r,BFN.PhotoEditorCanvas.canvasTools.altSourceTexture=null,UITools.applyTool(e);try{s.updateImagePainter()}catch(e){}n?n():requestAnimationFrame(function(){UIToggler.toggleAlternateMenu(!0,"layer_isolator_tool_menu_header","layer_isolator_tool_menu")})},function(){for(document.getElementById("layer_isolator_edit_complete").setStyles({visibility:""}),BFN.activePresetMenuItem&&BFN.activePresetMenuItem===u&&(BFN.activePresetMenuItem=null);g.firstChild;)l.appendChild(g.firstChild);g.remove(),t.updatePanelsAvailable(),i&&i()},!0),this.updatePanelsAvailable()}}}}}},{key:"updatePanelsAvailable",value:function(){UILayers.updateLayersAvailable(),UIHistory.updateHistoryAvailable(),BFN.AlignmentOptionsManager.updateAlignmentAvailable()}}]),n}();BFN.SingletonQueue.add(function(){BFN.EditLayerManager=new My});var Dy=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("HiResTextManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.useHiResText=!0,this.showHiResTextHelpers=!1,this.showHiResTextCanvas=!1,this.multiRealtime=!1,this.enableRetinaScaling=window.bfn_resolution&&window.bfn_resolution>1,this.hiResTextViewportBounds=new BFN.Rectangle,this.hiResTextItemQueue=[],this.processingHiResTextItemQueue=!1,this.processingHiResTextItem=null,this.showHiResTextHelpers&&(this.hiResTextViewport=new PIXI.Graphics),this.updateHighResTextRAF=BeFunky.debounce(this.updateHiResTextImmediately.bind(this),"raf"),this.updateHighResText=BeFunky.debounce(this.updateHighResTextRAF.bind(this),Math.round(12*BFN.frameInterval)),this.processHiResTextItemQueue=BeFunky.debounce(this.processHiResTextItemQueueImmediately.bind(this),"raf"),this.handleAppReadyBind=this.handleAppReady.bind(this),this.handleCanvasUpdatedBind=this.handleCanvasUpdated.bind(this),BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReadyBind)}},{key:"initEventListeners",value:function(){BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvasPhotoGrid.addEventListener(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasUpdatedBind),BFN.PhotoEditorCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasUpdatedBind),BFN.CollageMakerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasUpdatedBind),BFN.DesignerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasUpdatedBind),BFN.UndoManager.addEventListener(BFN.UndoManagerEvents.TIMESTAMP_UPDATED.type,this.handleCanvasUpdatedBind)}},{key:"updateHiResTextViewport",value:function(){var e=this;if(this.useHiResText){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),n=0,i=0;switch(t){case BFN.PhotoEditorCanvas:n=t.canvasImage.imageWidth,i=t.canvasImage.imageHeight;break;case BFN.CollageMakerCanvas:n=t.canvasPhotoGrid.gridWidth,i=t.canvasPhotoGrid.gridHeight;break;case BFN.DesignerCanvas:n=t.canvasWidth,i=t.canvasHeight}if(n&&i){var r=this.showHiResTextHelpers?20:0,a=BFN.MainUI.toLocal(new PIXI.Point(0,0),t.canvas),o=BFN.MainUI.toLocal(new PIXI.Point(n,i),t.canvas);this.hiResTextViewportBounds.left=Math.floor(Math.max(r,a.x)),this.hiResTextViewportBounds.top=Math.floor(Math.max(r,a.y)),this.hiResTextViewportBounds.right=Math.ceil(Math.min(BFN.StageModel.stageW-r,o.x)),this.hiResTextViewportBounds.bottom=Math.ceil(Math.min(BFN.StageModel.stageH-r,o.y)),t.transformLayer.children.forEach(function(t){t instanceof BFN.TransformItem&&"text"===t.type&&t.updateHiResTextBounds(e.multiRealtime)}),this.showHiResTextHelpers&&(this.hiResTextViewport.clear(),this.hiResTextViewport.lineStyle(1,16711935),this.hiResTextViewport.drawRect(this.hiResTextViewportBounds.x,this.hiResTextViewportBounds.y,this.hiResTextViewportBounds.width,this.hiResTextViewportBounds.height),this.hiResTextViewport.drawRect(this.hiResTextViewportBounds.x+5,this.hiResTextViewportBounds.y+5,this.hiResTextViewportBounds.width-10,this.hiResTextViewportBounds.height-10),this.hiResTextViewport.drawRect(this.hiResTextViewportBounds.x+10,this.hiResTextViewportBounds.y+10,this.hiResTextViewportBounds.width-20,this.hiResTextViewportBounds.height-20)),this.hiResTextItemQueue.splice(0),this.processingHiResTextItemQueue=!1,this.processingHiResTextItem=null,this.multiRealtime||this.updateHighResText()}}}},{key:"updateHiResTextImmediately",value:function(){var e=this;if(this.useHiResText&&BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.active&&!BFN.PhotoGrid.gridIsolator.gridChild){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);this.conformHiResTextCanvas(),t.transformLayer.children.forEach(function(t){e.processHiResTextItem(t)})}}},{key:"conformHiResTextCanvas",value:function(){if(this.useHiResText){this.hasOwnProperty("hiResTextCanvas")||(this.hiResTextCanvasElement=document.createElement("canvas"),BFN.appContainer.appendChild(this.hiResTextCanvasElement),this.showHiResTextCanvas?this.hiResTextCanvasElement.setStyles({zIndex:9999,pointerEvents:"none",background:"rgba(175,175,255,.4)",position:"absolute",left:0,top:0,display:"block"}):this.hiResTextCanvasElement.setStyles({display:"none"}),this.hiResTextCanvas=new fabric.StaticCanvas(this.hiResTextCanvasElement,{enableRetinaScaling:this.enableRetinaScaling}),this.hiResTextCanvasContext=this.hiResTextCanvas.getContext(),this.hiResTextCanvas.renderOnAddRemove=!1);var e=Math.ceil(this.hiResTextViewportBounds.width),t=Math.ceil(this.hiResTextViewportBounds.height),n=this.hiResTextViewportBounds.width*(this.enableRetinaScaling?fabric.devicePixelRatio:1)+"px",i=this.hiResTextViewportBounds.height*(this.enableRetinaScaling?fabric.devicePixelRatio:1)+"px";this.hiResTextCanvasElement.width===e&&this.hiResTextCanvasElement.style.width===n||(this.hiResTextCanvasElement.width=e,this.hiResTextCanvasElement.setStyles({width:n}),this.hiResTextCanvas.setWidth(this.hiResTextCanvasElement.width)),this.hiResTextCanvasElement.height===t&&this.hiResTextCanvasElement.style.height===i||(this.hiResTextCanvasElement.height=t,this.hiResTextCanvasElement.setStyles({height:i}),this.hiResTextCanvas.setHeight(this.hiResTextCanvasElement.height))}}},{key:"conformITextToTransformItem",value:function(e){if(this.useHiResText&&e&&e.iText){var t=e.iText;t.scaleX=t.scaleY=e.canvasScale*e.textScale*e.scale.x,t.flipX=e.flippedHorizontal,t.flipY=e.flippedVertical,t.rotate(e.rotation*(180/Math.PI));var n=BFN.MainUI.toLocal(new PIXI.Point,e);t.left=n.x-this.hiResTextViewportBounds.x,t.top=n.y-this.hiResTextViewportBounds.y}}},{key:"drawHiResTextToTransformItem",value:function(e){if(this.hasOwnProperty("hiResTextCanvas")&&this.useHiResText&&e&&e.iText){var t=e.iText;this.hiResTextCanvasContext.lineJoin="round",this.showHiResTextCanvas&&(this.hiResTextCanvas.remove(t),this.hiResTextCanvas.clear()),this.hiResTextCanvas.add(t),this.hiResTextCanvas.renderAll(),this.hasOwnProperty("hiResCanvasTexture")?this.hiResCanvasTexture.update():(this.hiResCanvasTexture=new PIXI.Texture(new PIXI.BaseTexture.fromCanvas(this.hiResTextCanvasElement)),this.hiResCanvasTexture.baseTexture.mipmap=!1,this.hiResCanvasTexture.setScaleMode(PIXI.SCALE_MODES.LINEAR)),e.hiResTextTexture.copyPixels(this.hiResCanvasTexture,{x:this.hiResTextViewportBounds.x-e.hiResTextRect.globalX,y:this.hiResTextViewportBounds.y-e.hiResTextRect.globalY},!BFN.HiResTextManager.showHiResTextHelpers,void 0,{x:1/(this.enableRetinaScaling?fabric.devicePixelRatio:1),y:1/(this.enableRetinaScaling?fabric.devicePixelRatio:1)}),this.showHiResTextCanvas||(this.hiResTextCanvas.remove(t),this.hiResTextCanvas.clear()),BFN.FabricManager.conformITextToTransformItem(e)}}},{key:"processHiResTextItem",value:function(e){this.useHiResText&&e&&e instanceof BFN.TransformItem&&"text"===e.type&&e.hiResTextRect&&e.hiResTextRect.width&&e.hiResTextRect.height&&(this.hiResTextItemQueue.includes(e)||e===this.processingHiResTextItem||this.hiResTextItemQueue.push(e),this.hiResTextItemQueue.length&&!this.processingHiResTextItemQueue&&this.processHiResTextItemQueue())}},{key:"processHiResTextItemQueueImmediately",value:function(){var e=this;this.useHiResText&&(this.hiResTextItemQueue.length?(this.processingHiResTextItemQueue||(this.processingHiResTextItemQueue=!0,this.processQueueStartTime=performance.now()),this.processingHiResTextItem=this.hiResTextItemQueue.shift(),this.processingHiResTextItem.renderHiResText(function(){performance.now()-e.processQueueStartTime<1e3/60?e.processHiResTextItemQueueImmediately():requestAnimationFrame(function(){e.processQueueStartTime=performance.now(),e.processHiResTextItemQueueImmediately()})})):(this.processingHiResTextItemQueue=!1,this.processingHiResTextItem=null))}},{key:"handleAppReady",value:function(e){BFN.AppModel.removeEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReadyBind),this.useHiResText&&(this.initEventListeners(),this.handleCanvasUpdated(e))}},{key:"handleCanvasUpdated",value:function(e){this.updateHiResTextViewport()}}]),e}();BFN.SingletonQueue.add(function(){BFN.HiResTextManager=new Dy});var wy=function(){function t(){i(this,t),this.init()}return a(t,[{key:"init",value:function(){BeFunky.log("PatchManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.patchLoading=!1,this.queuedPatchVO=null,this.queuedProjectItemVOs=null,this.patchImageBaseTextures=null,this.textPatchesHaveLoaded=!1,this.clipboardPatchVO=null,this.clipboardBaseTextures={},this.clipboardThumbSources={}}},{key:"loadPatch",value:function(e,t){var n=this;if(e&&(!e||e instanceof BFN.PatchVO)&&!(BFN.TransformItemIsolator.active||BFN.AppModel.viewingEditor&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)){if(this.patchLoading)throw new Error("Attempting to load a patch while another patch is loading");var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);if(!i.transformTool.transformToolFrame.active){delete this.patchAddedCallback,t&&"function"==typeof t&&(this.patchAddedCallback=function(){t()}),i.transformLayer.deselectItem(),e=this.getPatchVO(this.getPatchObject(e));var r=this.clipboardPatchVO&&this.clipboardPatchVO.id===e.id,a=BFN.AppModel.sectionID,o=function(){var t=Object.keys(e.imageData),i=Object.keys(e.svgData),o=[].concat(v(t),v(i)),s=[];if(o.forEach(function(e){t.includes(e)&&s.push(BFN.ProjectService.localAssetExists("image",e)),i.includes(e)&&s.push(BFN.ProjectService.localAssetExists("svg",e))}),Promise.all(s).then(function(n){o.forEach(function(r,o){n[o]||(t.includes(r)&&BFN.ProjectService.setLocalAsset(a,"image",r,BFN.BlobUtils.base64ToBlob(e.imageData[r])).catch(function(e){return BeFunky.throwError(e,"PatchLocalImageAssetSaveFail")}),i.includes(r)&&BFN.ProjectService.setLocalAsset(a,"svg",r,e.svgData[r]).catch(function(e){return BeFunky.throwError(e,"PatchLocalSvgAssetSaveFail")}))})}),r||n.decompressLabelTextStyles(e),n.queuedPatchVO=e,n.queuedProjectItemVOs=[].concat(v(e.transformGraphics),v(e.transformImages),v(e.transformMaskImages),v(e.transformLabels)),n.patchImageBaseTextures=Object.assign({},n.clipboardBaseTextures),e.showLoadScreen=!0,r)if(n.queuedProjectItemVOs.length<=1)e.showLoadScreen=!1;else if(n.queuedProjectItemVOs.length<=2){var l=[].concat(v(e.transformImages),v(e.transformMaskImages));if(l.length<=2){var u=!0;l.forEach(function(e){var t=e.imageID,i=e.maskImageID,r=e.maskImageMaskID;t&&!n.patchImageBaseTextures[t]&&(u=!1),i&&!n.patchImageBaseTextures[i]&&(u=!1),r&&!n.patchImageBaseTextures[r]&&(u=!1)}),e.showLoadScreen=!u}}e.showLoadScreen&&BeFunky.showLoadScreen({isCancellable:!1}),n.patchLoading=!0,Object.keys(e.imageData).forEach(function(e){var t;switch(BFN.getImageType(e)){case"graphic":t=BFN.GraphicLibraryManager.getMenuImageVO(e);break;case"patterns":t=BFN.CollageMakerPatternManager.getMenuImageVO(e);break;default:t=BFN.ImageLibraryManager.getMenuImageVO(e)}t&&t.hasUsableTexture()&&!n.patchImageBaseTextures.hasOwnProperty(e)&&(n.patchImageBaseTextures[e]=t.imageTexture.baseTexture)}),n.processQueuedProjectItemVOs()},s=function(e){n.patchLoading=!1,BeFunky.hideLoadScreen(),BeFunky.throwError(e,"Unable to Prepare Patch")};if(r)try{o()}catch(e){s(e)}else BFN.ParseBFD.prepareV2(e).then(o).catch(function(e){"cancelled_by_user"!==e&&s(e)})}}}},{key:"processQueuedProjectItemVOs",value:function(){var e=this;if(this.queuedPatchVO&&this.queuedProjectItemVOs&&this.queuedProjectItemVOs.length){var t=this.queuedProjectItemVOs.shift();switch(t.type){case"graphic":return this.processGraphic(t,function(){return e.processQueuedProjectItemVOs()});case"image":return this.processImage(t,function(){return e.processQueuedProjectItemVOs()});case"mask_image":return this.processMaskImage(t,function(){return e.processQueuedProjectItemVOs()});default:return this.processQueuedProjectItemVOs()}}else{this.patchLoading=!1,BeFunky.hideLoadScreen(),Object.keys(this.patchImageBaseTextures).forEach(function(t){delete e.patchImageBaseTextures[t]}),this.projectImageBaseTextures=null;var n=this.queuedPatchVO;n.loaded=!0,this.queuedPatchVO=null,this.queuedProjectItemVOs=null,this.addPatch(n)}}},{key:"processGraphic",value:function(e,t){if(e.basicShapeValues)t();else{var n=e.graphicID,i=this.queuedPatchVO.svgData;if(!n)return BeFunky.logError("Patch graphic missing ID"),t();if(!i.hasOwnProperty(n))return BeFunky.logError("Patch graphic missing SVG data"),t();BFN.TextureUtils.svgStringToTexture(i[n],function(n){var i=n.error,r=n.texture;i?BeFunky.logError("Unable to convert Patch graphic SVG string to texture"):e.graphicTexture=r,t()})}}},{key:"processImage",value:function(e,t){var n=this,i=e.imageID,r=this.queuedPatchVO.imageData,a=function(t){e.transformWidth>0&&e.transformHeight>0&&(e.transformScaleX=e.transformWidth/t.width,e.transformScaleY=e.transformHeight/t.height)};return i?r.hasOwnProperty(i)||this.patchImageBaseTextures.hasOwnProperty(i)?this.patchImageBaseTextures.hasOwnProperty(i)?(e.imageTexture=new PIXI.Texture(this.patchImageBaseTextures[i]),BFN.ProjectManager.assignTextureToMenuImageVO(i,e.imageTexture),a(e.imageTexture.baseTexture),t()):void BFN.TextureUtils.blobOrBase64ToTexture(r[i],function(r){var o=r.texture;r.error?BeFunky.logError("Unable to generate texture from patch image data"):("patterns"===BFN.getImageType(i)&&(o.baseTexture.isPattern=!0),n.patchImageBaseTextures[i]=o.baseTexture,e.imageTexture=o,BFN.ProjectManager.assignTextureToMenuImageVO(i,e.imageTexture),a(e.imageTexture.baseTexture)),t()}):(BeFunky.logError("Patch image missing image data"),t()):(BeFunky.logError("Patch image missing ID"),t())}},{key:"processMaskImage",value:function(e,t){var n=this,i=e.maskImageID,r=this.queuedPatchVO,a=r.svgData,o=r.imageData;if(!i)return BeFunky.logError("Patch mask image missing ID"),t();if(!o.hasOwnProperty(i)&&!this.patchImageBaseTextures.hasOwnProperty(i))return BeFunky.logError("Patch mask image missing image data"),t();var s=function(){if(!e.maskImageMaskID)return t();if(a.hasOwnProperty(e.maskImageMaskID))BFN.SVGManager.getSVGShape(a[e.maskImageMaskID],function(n){e.maskImageMaskTexture=BFN.SVGManager.getTexture(n,t)},e.maskImageMaskID,!0);else{if(n.patchImageBaseTextures.hasOwnProperty(e.maskImageMaskID))return e.maskImageMaskTexture=new PIXI.Texture(n.patchImageBaseTextures[e.maskImageMaskID]),t();if(!o.hasOwnProperty(e.maskImageMaskID))return t();BFN.TextureUtils.blobOrBase64ToTexture(o[e.maskImageMaskID],function(n){var i=n.error,r=n.texture;return i?(BeFunky.logError("Unable to generate texture from patch image data"),t()):(e.maskImageMaskTexture=r,t())})}};if(this.patchImageBaseTextures.hasOwnProperty(i))return e.maskImageTexture=new PIXI.Texture(this.patchImageBaseTextures[i]),BFN.ProjectManager.assignTextureToMenuImageVO(i,e.maskImageTexture),s();BFN.TextureUtils.blobOrBase64ToTexture(o[i],function(r){var a=r.error,o=r.texture;return a?(BeFunky.logError("Unable to generate texture from patch image data"),t()):("patterns"===BFN.getImageType(i)&&(o.baseTexture.isPattern=!0),n.patchImageBaseTextures[i]=o.baseTexture,e.maskImageTexture=o,BFN.ProjectManager.assignTextureToMenuImageVO(i,e.maskImageTexture),s())})}},{key:"convertImagesToMaskImages",value:function(e){for(var t=e.transformImages.length;--t>-1;){var n=e.transformImages[t];if(!n.isGoodie&&n.hasOwnProperty("imageTexture")){e.transformImages.splice(t,1),n.maskImageTexture=n.imageTexture,delete n.imageTexture,n.type="mask_image",n.maskImageID=n.imageID,n.imageID=null;var i=n.maskImageTexture.baseTexture;n.maskImageFrameWidth=n.transformScaleX*i.width,n.maskImageFrameHeight=n.transformScaleY*i.height;var r=Math.max(n.maskImageFrameWidth/i.width,n.maskImageFrameHeight/i.height),a=i.width*r,o=i.height*r;n.maskImageTextureScale={x:n.maskImageFrameWidth/a,y:n.maskImageFrameHeight/o},n.transformScaleX=1,n.transformScaleY=1,e.transformMaskImages.push(n)}}}},{key:"addPatch",value:function(t){var n=this;if(t&&t instanceof BFN.PatchVO&&t.loaded){if(this.patchLoading)throw new Error("Attempting to load a patch while another patch is loading");t.hasOwnProperty("showLoadScreen")&&!t.showLoadScreen||(BeFunky.showLoadScreen({isCancellable:!1}),delete t.showLoadScreen),this.patchLoading=!0;var i=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel),r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);if(i&&r&&a){BFN.ProjectManager.transformItemsPending=!0,BFN.TransformModel.selectItemOnAdd=!1;var o=this.clipboardPatchVO&&this.clipboardPatchVO.id===t.id,s=BFN.TransformLayerManager.transformItems.length,l=[].concat(v(t.transformGraphics),v(t.transformImages),v(t.transformMaskImages),v(t.transformLabels)).length,u=Math.min(a.transformLayer.frameWidth/t.width,a.transformLayer.frameHeight/t.height)/2,c=function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];o&&n.clipboardThumbSources.hasOwnProperty(i.itemID)&&(i.thumbImageSRC=n.clipboardThumbSources[i.itemID]),i.itemID="item_".concat(BeFunky.randomString(10)),i.layerNum=-1,i.transformZIndex+=s;var a=i.transformX-t.width/2,l=i.transformY-t.height/2,c=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),h=Math.atan2(l,a);i.transformX=Math.cos(h)*(c*u),i.transformY=Math.sin(h)*(c*u),r.forEach(function(t){if(i.hasOwnProperty(t))switch(e(i[t])){case"number":i[t]*=u;break;case"object":var n=i[t];for(var r in n)"number"==typeof n[r]&&(n[r]*=u)}})},h=o?"paste_".concat(l>1?"items":"item"):"add_patch",d=h+BeFunky.randomString(10);BFN.TransformStateModel.startBulkTransition(d);var m=[],p=function(e,t){BFN.ProjectManager.transferProperties(e,t),BFN.TransformModel.addedTransformItem.applyTransformItemState(t,!1),m.push({zIndex:t.zIndex,item:BFN.TransformModel.addedTransformItem,state:t})};t.transformGraphics.filter(function(e){return e.graphicTexture||e.basicShapeValues}).forEach(function(e){c(e,["transformWidth","transformHeight","transformScaleX","transformScaleY"]),e.graphicTexture?r.addedItem={type:"texture",texture:e.graphicTexture,isGoodie:!0,projectItemVO:e,graphicStyle:e.graphicStyle}:e.basicShapeValues&&(r.addedItem={type:"texture",texture:null,isGoodie:!0,projectItemVO:e,basicShapeVO:new BFN.BasicShapeVO(e.basicShapeValues.type,e.basicShapeValues)});var t=new BFN.TransformItemStateVO;t.parent=a.transformLayer,e.graphicTexture&&(t.imageTexture=e.graphicTexture,delete e.graphicTexture),p(e,t)}),this.convertImagesToMaskImages(t),t.transformImages.filter(function(e){return e.imageTexture}).forEach(function(e){c(e,["transformWidth","transformHeight","transformScaleX","transformScaleY"]);var t={type:"texture",texture:e.imageTexture,projectItemVO:e,graphicStyle:e.graphicStyle};e.isGoodie&&(t.isGoodie=!0),r.addedItem=t;var n=new BFN.TransformItemStateVO;n.parent=a.transformLayer,e.imageTexture&&(n.imageTexture=e.imageTexture,delete e.imageTexture),p(e,n)}),t.transformMaskImages.filter(function(e){return e.maskImageTexture}).forEach(function(e){c(e,["transformWidth","transformHeight","maskImageFrameWidth","maskImageFrameHeight"]);var t=null;e.maskImageMaskTexture?t=e.maskImageMaskTexture:e.basicShapeValues&&(t=PIXI.RenderTexture.create(32,32));var n={type:"frame_texture",texture:e.maskImageTexture,maskTexture:t,projectItemVO:e};e.graphicStyle&&(n.graphicStyle=e.graphicStyle),e.basicShapeValues&&(n.basicShapeVO=new BFN.BasicShapeVO(e.basicShapeValues.type,e.basicShapeValues)),r.addedItem=n;var i=new BFN.TransformItemStateVO;i.parent=a.transformLayer,e.maskImageTexture&&(i.imageTexture=e.maskImageTexture,delete e.maskImageTexture),e.maskImageMaskTexture&&delete e.maskImageMaskTexture,p(e,i)}),t.transformLabels.length&&(BFN.UndoManager.updating=!0,t.transformLabels.forEach(function(e){c(e,["transformWidth","transformHeight","labelTextItemScale"]),r.addedItem={type:"text",projectItemVO:e};var t=new BFN.TransformItemStateVO;t.parent=a.transformLayer,p(e,t)}),BFN.MainUI.rendering=!0,BFN.MainUI.renderCanvas(),BFN.MainUI.rendering=!1,BFN.UndoManager.updating=!1),BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.transformLayer&&BFN.TransformModel.selectedTransformItem.transformLayer.deselectItem(),BFN.MainUI.renderCanvas(),m.forEach(function(e){var t=e.item;t.ignoreAccurateBounds=!0,t.visible=!1}),BFN.MainUI.renderCanvas();var g=!1;setTimeout(function e(){if(!BFN.updatingShapeQueue.length&&!BFN.updatingTextQueue.length&&(g||(g=!0,m.length&&(m.sort(function(e,t){return e.zIndex-t.zIndex}),m.forEach(function(e,t){var n=e.item,i=e.state,r=(e.zIndex,t+s);n.parent.setChildIndex(n,r),setTimeout(function(){n.updateShapeTexture()},t),i.zIndex=r,n.ignoreAccurateBounds=!1,n.updateAccurateBounds(),n.setTransitionStartState(),n.setTransitionEndState(),n.transitionVO.startState.parent=null,n.transitionVO=null}))),!BFN.accurateBoundsQueue.length)){var i=new BFN.TransformItemGroupVO;i.id="patch_".concat(BeFunky.randomString(10)),i.name=t.name;var r=[];m.forEach(function(e,t){var n=e.item;n.visible=!0,n.preloadThumbnail(5*t+50),n.refreshItemName(),"text"!==n.type||n.iText.wordBreaksEnabled||(n.iText.wordBreaksEnabled=!0),i.itemIDs.push(n.itemID),r.push(n)}),r.length>1?(o||BFN.GroupManager.addGroup(null,i,!0),BFN.GroupManager.selectItems(r)):1===r.length&&(o||(r[0].layerName=t.name),r[0].selectItem()),BFN.TransformLayerManager.updateTransformItems(),BFN.TransformStateModel.stopBulkTransition();var a=new BFN.TransformItemTransitionVO;return a.id=h,a.batchIDPlaceholder=d,BFN.TransformStateModel.addTransition(a),BFN.ProjectManager.transformItemsPending=!1,BFN.TransformModel.selectItemOnAdd=!0,n.patchLoading=!1,BeFunky.hideLoadScreen(),n.patchAddedCallback&&(n.patchAddedCallback(),delete n.patchAddedCallback),BFN.MainUI.requestRender(),void BFN.ProjectManager.requestLocalSave()}setTimeout(e,0)},0)}else BeFunky.throwError("Unable to add patch"),this.patchLoading=!1}}},{key:"createPatchFromSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"BeFunkyPatch",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"canvas",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(BFN.TransformModel.selectedTransformItem&&["computer","befunky_admin","canvas","menu","clipboard"].includes(t)){n=n instanceof Array?n:[];var r=BFN.TransformModel.selectedTransformItem,a=r.transformLayer,o=r===BFN.TransformItemGroup?v(BFN.TransformItemGroup._selectedItems).sort(function(e,t){return a.children.indexOf(e)-a.children.indexOf(t)}):[r];if(o.length){("clipboard"!==t||"clipboard"===t&&o.length>2)&&BeFunky.showLoadScreen({isCancellable:!1});var s=function(){i&&i(),BeFunky.hideLoadScreen()};"clipboard"===t&&(this.clearClipboardBaseTextures(),this.clearClipboardThumbSources());var l=new BFN.PatchVO;l.name=e;for(var u=[],c=[],h=!1,d={left:null,right:null,top:null,bottom:null},m={left:null,right:null,top:null,bottom:null},p=[],g=0;g<o.length;g++){var y=o[g],x=y.projectItemVO,_=y.localPolygon,I=y.localTextPolygon||_;if(x&&_&&I){var T=null;switch("clipboard"===t&&y.thumbImage&&y.thumbImage.src&&this.addClipboardThumbSource(x.itemID,y.thumbImage.src),x.type){case"graphic":x.graphicID?(c.includes(x.graphicID)||c.push(x.graphicID),T=l.transformGraphics):x.basicShapeValues&&(T=l.transformGraphics);break;case"image":x.imageID&&(u.includes(x.imageID)||u.push(x.imageID),this.addClipboardBaseTexture(x.imageID,y.itemContent.texture.baseTexture),T=l.transformImages);break;case"mask_image":if(x.maskImageID&&(u.includes(x.maskImageID)||u.push(x.maskImageID),this.addClipboardBaseTexture(x.maskImageID,y.itemContent.texture.baseTexture),T=l.transformMaskImages),x.maskImageMaskID){var b=y.itemContentMask&&!y.isShape,S=b?u:c;S.includes(x.maskImageMaskID)||S.push(x.maskImageMaskID),b&&this.addClipboardBaseTexture(x.maskImageMaskID,y.itemContentMask.texture.baseTexture)}break;case"label":T=l.transformLabels}if(T){var C=function(e,t){e.forEach(function(e){t.left=null===t.left?e.x:Math.min(t.left,e.x),t.right=null===t.right?e.x:Math.max(t.right,e.x),t.top=null===t.top?e.y:Math.min(t.top,e.y),t.bottom=null===t.bottom?e.y:Math.max(t.bottom,e.y)})};C(_,d),C(I,m),h||(h=!0);var B=x.clone();T.push(B),p.push(B)}}}if(h){l.width=d.right-d.left,l.height=d.bottom-d.top,p.forEach(function(e,t){e.layerNum=-1,e.transformZIndex=t,e.transformX-=d.left,e.transformY-=d.top,e.transformX<.001&&(e.transformX=0),e.transformY<.001&&(e.transformY=0)}),"clipboard"!==t&&this.compressLabelTextStyles(l);var F=[].concat(u,c);if(F.length){var E=[].concat(v(u.map(function(e){return function(e){if("clipboard"===t&&BFN.PatchManager.clipboardBaseTextures.hasOwnProperty(e))return BFN.PatchManager.clipboardBaseTextures[e];return BFN.ProjectService.getLocalAsset("image",e).then(function(e){return BFN.BlobUtils.downsizeImageBlob(e).catch(function(t){return"skipped_small_image"!==t&&BeFunky.logError("Unable to Downsize Patch Image Blob",t),e})}).then(function(e){return BFN.BlobUtils.blobToBase64(e)})}(e)})),v(c.map(function(e){return function(e){return BFN.ProjectService.getLocalAsset("svg",e)}(e)})));Promise.all(E).then(function(e){e.forEach(function(e,t){if(!(e instanceof PIXI.BaseTexture)){var n=F[t];u.includes(n)&&(l.imageData[n]=e),c.includes(n)&&(l.svgData[n]=e)}}),P()}).catch(function(e){BeFunky.logError("Patch Asset Retrieval Failed",e)})}else P()}}}function P(){var e=null,i=null;if("clipboard"!==t){var r=a.x,u=a.y,c=a.parent;a.x=-m.left,a.y=-m.top,c.removeChild(a),a.children.forEach(function(e){e.hasOwnProperty("renderable")&&(e.wasRenderable=e.renderable,e.renderable=o.includes(e))}),a.toggleHiResTextDisplay(!1),a.toggleItemScaleSmoothing(!1),a.setItemScaleMode(PIXI.SCALE_MODES.NEAREST,["text"]);var h=Math.round(m.right-m.left),d=Math.round(m.bottom-m.top),p=PIXI.RenderTexture.create(h,d);BFN.Stage.render(a,p,!1),a.children.forEach(function(e,t){e.hasOwnProperty("renderable")&&(e.renderable=e.wasRenderable,delete e.wasRenderable)}),a.toggleHiResTextDisplay(!0),a.toggleItemScaleSmoothing(!0),a.setItemScaleMode(PIXI.SCALE_MODES.LINEAR,["text"]),a.x=r,a.y=u,c.addChild(a);var g=BFN.Util.getAlphaBounds(p),v=PIXI.RenderTexture.create(g.width,g.height);v.copyPixels(p,{x:-g.minX,y:-g.minY}),p.resize(v.width,v.height),p.copyPixels(v),v.destroyGC(!0);var y=f(BFN.TextureUtils.getScaledDimensions(p,{maxWidth:300,maxHeight:200}),2),x=y[0],_=y[1],I=BFN.Util.getThumbTexture(p,Math.max(x,_));if(l.thumbBase64=BFN.TextureUtils.textureToBase64(I,{isTransparent:!0,quality:.9}),I.destroy(!0),"befunky_admin"===t){var T=p.width/p.height,b=T>=1?T:1/T,S=Math.round(720*b),C=f(BFN.TextureUtils.getScaledDimensions(p,{maxWidth:S,maxHeight:S}),2),B=C[0],F=C[1];e=BFN.Util.getThumbTexture(p,Math.max(B,F)),BFN.TextureUtils.textureToBlob(e,{isTransparent:!0,quality:1}).then(function(t){e.destroyGC(!0),i=t,E()})}else E()}else E();function E(){switch(t){case"clipboard":BFN.PatchManager.clipboardPatchVO=l,s();break;case"menu":BFN.PatchManager.addPatchToMenu(l.id,l.thumbBase64,l),s();break;case"canvas":BFN.PatchManager.loadPatch(BFN.PatchManager.getPatchVO(BFN.PatchManager.getPatchObject(l)),s);break;case"computer":if(!BeFunky.savePatchToComputer)return BeFunky.acknowledge("Please log in to a BeFunky account w/ admin permissions and refresh this page"),s();BeFunky.savePatchToComputer(l,s);break;case"befunky_admin":if(!BeFunky.addPatchForAllUsers)return BeFunky.acknowledge("Please log in to a BeFunky account w/ admin permissions and refresh this page"),s();BeFunky.addPatchForAllUsers(l,{tagIds:n,previewBlob:i}).catch(function(e){console.log({error:e}),BeFunky.acknowledge("Failed to save patch: ".concat(BeFunky.failureReason(e)))}).then(s)}}}}},{key:"loadTextPatches",value:function(){var e=this;this.textPatchesHaveLoaded||BFN.PatchService.getTextPatches().then(function(t){e.textPatchesHaveLoaded=!0;var n=document.getElementById("editor_text_patch_menu");n.firstElementChild&&n.firstElementChild.hasClass("loading-spinner")&&n.removeChild(n.firstElementChild),t.forEach(function(t){var n=t.tmp,i=t.version,r=BeFunky.isRetina()?204:102,a={width:r,height:r,fit:"bounds",auto:"webp",nocache:i||0},o=BeFunky.addParamsToURL("".concat(BFN.patchPreviewImageUrl).concat(n,"_preview.png"),a);e.addPatchToMenu(n,o)})})}},{key:"addPatchToMenu",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&"string"==typeof e&&t&&(this.patchMenuItems||(this.patchMenuItems={}),!this.patchMenuItems.hasOwnProperty(e))){var r=document.createElement("div");r.id=e,r.allowClick=!0,r.addClass("text-patches__item");var a=document.createElement("img");a.src=t,r.appendChild(a),this.patchMenuItems[e]={patchID:e,patchThumb:t,patchVO:i},r.addEventListener("click",function(){if(r.allowClick){r.allowClick=!1,setTimeout(function(){r.allowClick=!0},500);var t=n.patchMenuItems[e];if(t.patchVO)n.loadPatch(t.patchVO);else{var i="".concat(BeFunky.Params.remoteAssetsPath,"template_patches/").concat(e,".bfp");BFN.PatchService.fetchBfp(i).then(function(e){t.patchVO=n.getPatchVO(e),n.loadPatch(t.patchVO)}).catch(function(e){"cancelled_by_user"!==e&&("request_failed"===e?BeFunky.logError("Failed to load Patch",e):BeFunky.throwError("Failed to load Patch",e))})}}}),document.getElementById("editor_text_patch_menu").appendChild(r)}}},{key:"reportBreadcrumb",value:function(e){if(BFN.TransformModel.selectedTransformItem){var t=BFN.SentryManager.getDisplayObjectInfo(BFN.TransformModel.selectedTransformItem);BFN.SentryManager.reportBreadcrumb(t,e,"clipboard_interaction")}}},{key:"copySelection",value:function(){var e=this;BFN.TransformModel.selectedTransformItem&&BFN.PatchManager.createPatchFromSelection("clipboard_patch","clipboard",null,function(){e.reportBreadcrumb("Selection Copied"),BFN.ClipboardManager.addPatchToClipboard(e.clipboardPatchVO)})}},{key:"cutSelection",value:function(){var e=this;BFN.TransformModel.selectedTransformItem&&BFN.PatchManager.createPatchFromSelection("clipboard_patch","clipboard",null,function(){e.reportBreadcrumb("Selection Cut"),BFN.TransformModel.removeSelection(),BFN.ClipboardManager.addPatchToClipboard(e.clipboardPatchVO)})}},{key:"pasteSelection",value:function(){var e=this;this.clipboardPatchVO&&this.loadPatch(this.clipboardPatchVO,function(){e.reportBreadcrumb("Selection Pasted")})}},{key:"clearClipboardBaseTextures",value:function(){var e=BFN.GlobalHistoryModel.getUsedBaseTextures(null,!1);for(var t in this.clipboardBaseTextures){var n=this.clipboardBaseTextures[t];e.includes(n)||n.destroy(),delete this.clipboardBaseTextures[t]}}},{key:"addClipboardBaseTexture",value:function(e,t){this.clipboardBaseTextures.hasOwnProperty(e)||(this.clipboardBaseTextures[e]=t)}},{key:"clearClipboardThumbSources",value:function(){for(var e in this.clipboardThumbSources)delete this.clipboardThumbSources[e]}},{key:"addClipboardThumbSource",value:function(e,t){this.clipboardThumbSources.hasOwnProperty(e)||(this.clipboardThumbSources[e]=t)}},{key:"getPatchVO",value:function(e){var t=new BFN.PatchVO;return Object.assign(t,e),t.transformGraphics=[],t.transformImages=[],t.transformMaskImages=[],t.transformLabels=[],e.transformGraphics.forEach(function(e){return t.transformGraphics.push(BFN.ProjectManager.getProjectItemVO(e))}),e.transformImages.forEach(function(e){return t.transformImages.push(BFN.ProjectManager.getProjectItemVO(e))}),e.transformMaskImages.forEach(function(e){return t.transformMaskImages.push(BFN.ProjectManager.getProjectItemVO(e))}),e.transformLabels.forEach(function(e){return t.transformLabels.push(BFN.ProjectManager.getProjectItemVO(e))}),t.svgData={},Object.entries(e.svgData).forEach(function(e){var n=f(e,2),i=n[0],r=n[1];t.svgData[i]=r.startsWith("<")?r:atob(r)}),t}},{key:"getPatchObject",value:function(e){var t={};return Object.assign(t,e),t.transformGraphics=[],t.transformImages=[],t.transformMaskImages=[],t.transformLabels=[],e.transformGraphics.forEach(function(e){return t.transformGraphics.push(BFN.ProjectManager.getProjectItemObject(e))}),e.transformImages.forEach(function(e){return t.transformImages.push(BFN.ProjectManager.getProjectItemObject(e))}),e.transformMaskImages.forEach(function(e){return t.transformMaskImages.push(BFN.ProjectManager.getProjectItemObject(e))}),e.transformLabels.forEach(function(e){return t.transformLabels.push(BFN.ProjectManager.getProjectItemObject(e))}),t}},{key:"compressLabelTextStyles",value:function(e){e.transformLabels&&!e.transformLabels.length||(e.transformLabels=JSON.parse(JSON.stringify(e.transformLabels)),e.transformLabels.forEach(function(e){e.labelTextStyles.compressedStyles=BFN.ParseBFD.compressCharacterStyles(e.labelTextStyles.styles),delete e.labelTextStyles.styles}))}},{key:"decompressLabelTextStyles",value:function(e){e.transformLabels&&!e.transformLabels.length||e.transformLabels.forEach(function(e){e.labelTextStyles.compressedStyles&&(e.labelTextStyles.styles=BFN.ParseBFD.decompressCharacterStyles(e.labelTextStyles.compressedStyles),delete e.labelTextStyles.compressedStyles)})}}]),t}();BFN.SingletonQueue.add(function(){BFN.PatchManager=new wy});var Ly=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){BeFunky.log("DirectionalBlurManager Init"),this.initDefaultValues()}},{key:"initDefaultValues",value:function(){}},{key:"blurTexture",value:function(e,t){var n=t.maxSpread,i=t.amount,r=void 0===i?0:i,a=t.alphaChoke,o=void 0===a?0:a,s=t.blendAlpha,l=void 0===s||s,u=t.biDirectional,c=void 0===u||u,h=t.iterations,d=void 0===h?5:h;this.directionalBlurFilter||(this.directionalBlurFilter=new BFN.filters.DirectionalBlurFilter,this.directionalBlurSprite=new PIXI.Sprite,this.directionalBlurSprite.filters=[this.directionalBlurFilter],this.directionalBlurTargetTexture=PIXI.RenderTexture.create(32,32)),this.directionalBlurFilter.setDimensions(e.width,e.height,n),this.directionalBlurFilter.amount=r,this.directionalBlurFilter.alphaChoke=o,this.directionalBlurFilter.blendAlpha=l,this.directionalBlurFilter.biDirectional=c,this.directionalBlurFilter.iterations=d,this.directionalBlurSprite.texture=e,this.directionalBlurTargetTexture.resize(e.width,e.height),BFN.Stage.render(this.directionalBlurSprite,this.directionalBlurTargetTexture),this.directionalBlurSprite.texture=PIXI.Texture.EMPTY,e.copyPixels(this.directionalBlurTargetTexture),this.directionalBlurTargetTexture.resize(32,32)}}]),e}();BFN.SingletonQueue.add(function(){BFN.DirectionalBlurManager=new Ly});var Oy=function(){function e(){i(this,e),this.init()}return a(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){this.copiedPatchExpiration=0,this.previouslyPastedFiles=[]}},{key:"addPatchToClipboard",value:function(e){var t=this,n=Date.now()+6e4,i="[BeFunky ".concat(e.id,"]");e.transformLabels.length&&(i=e.transformLabels.reduce(function(e,t){return"".concat(e||i,"\n").concat(t.labelText)},"")),this.addToClipboard(i).catch(function(e){BeFunky.logError("Failed to add patch to clipboard:",e),t.copiedPatchExpiration=n})}},{key:"addToClipboard",value:function(e){return this.copiedPatchExpiration=0,navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e):Promise.reject("not_available")}},{key:"pasteImagesFromClipboard",value:function(e){var t=this;if((e=Array.from(e).filter(function(e){return/^image\/+/.test(e.type)})).length)if(!BFN.AppModel.viewingEditor||BFN.PhotoEditorModel.currentTexture)BFN.AppModel.viewingEditor&&1===e.length?BeFunky.confirm("paste_as_layer_or_background",{confirmText:"background_image",onConfirm:function(){var t={files:e,createMenuImageVO:!1};BFN.PhotoEditorModel.confirmEditorLoadImage(function(){BFN.MultipleFileUploader.upload(function(e){var t=e.file;return BFN.PhotoEditorModel.onEditorImageUpload({file:t})},t)})},cancelText:"layer",onCancel:function(){t.addImagesToCanvasAndImageManager(e,{hasTexture:!0,forceLayer:!0})}}):!BFN.AppModel.viewingCollage||BFN.CollageMakerCanvasPhotoGridModel.freeform?this.addImagesToCanvasAndImageManager(e,{hasTexture:!0}):BeFunky.confirm("paste_as_layer_or_grid_cell",{confirmText:"grid_cells",onConfirm:function(){t.addImagesToCanvasAndImageManager(e,{hasTexture:!0})},cancelText:"layers",onCancel:function(){t.addImagesToCanvasAndImageManager(e,{hasTexture:!0,forceLayer:!0})}});else{var n={files:e.slice(0,1),createMenuImageVO:!1};BFN.MultipleFileUploader.upload(function(e){var t=e.file;return BFN.PhotoEditorModel.onEditorImageUpload({file:t})},n)}}},{key:"addImagesToCanvasAndImageManager",value:function(e,t){var n=this,i=["name","size","lastModified","type"],r=[];if(e.forEach(function(e){var t=n.previouslyPastedFiles.find(function(t){return i.every(function(n){return t[n]===e[n]})});if(t){var a=BFN.ImageLibraryManager.selectedMenuImageVOs.find(function(e){var n=e.id,i=e.imageTexture;return n===t.menuImageVoId&&i&&i.valid});if(a)return o(a),void BFN.ImageLibraryManager.updateImage(a.id,{},!0)}r.push(e)}),r.length){var a={files:Array.from(e),keepImageTexture:!0};BFN.ImageLibraryManager.uploadImages(function(e){var t=e.menuImageVO,r=e.file;t&&(o(t),n.previouslyPastedFiles.push(l({menuImageVoId:t.id},i.reduce(function(e,t){return l(l({},e),{},{[t]:r[t]})},{}))))},a)}function o(e){if(!BFN.AppModel.viewingCollage||t.forceLayer)return BFN.ImageLibraryManager.addImageToCanvas(e,t);BeFunky.waitUntil({condition:function(){return!BFN.PhotoGrid.targetChild},onSuccess:function(){return BFN.ImageLibraryManager.addImageToCanvas(e,t)},onTimeout:function(){return BFN.ImageLibraryManager.addImageToCanvas(e,t)},interval:200,maxAttempts:15})}}},{key:"pasteTextFromClipboard",value:function(e){BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture||(BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel).addedItem={type:"text",text:e})}},{key:"pastePatchFromClipboard",value:function(){BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture||BFN.PatchManager.pasteSelection()}},{key:"handlePaste",value:function(e){if(e.clipboardData.files.length)return this.pasteImagesFromClipboard(e.clipboardData.files);var t=e.clipboardData.getData("text");if(t){if(BFN.PatchManager.clipboardPatchVO){var n=t.match(/^\[BeFunky (patch_[a-z0-9]+)/);if(n&&n[1]===BFN.PatchManager.clipboardPatchVO.id)return this.pastePatchFromClipboard()}this.pasteTextFromClipboard(t)}}}]),e}();if(BFN.SingletonQueue.add(function(){BFN.ClipboardManager=new Oy}),BFN.EventDispatcher){var Ry=function(){BFN.EventDispatcher.call(this),this.init()};BFN.AnimatorEvents={UPDATE:new Event("UPDATE"),UPDATE_COMPLETE:new Event("UPDATE_COMPLETE"),INCREASE_COMPLETE:new Event("INCREASE_COMPLETE"),DECREASE_COMPLETE:new Event("DECREASE_COMPLETE")},BFN.AnimatorTypes={ANIMATION_TYPE_LINEAR:new Event("ANIMATION_TYPE_LINEAR"),ANIMATION_TYPE_EASE_IN:new Event("ANIMATION_TYPE_EASE_IN")},(Ry.prototype=Object.create(BFN.EventDispatcher.prototype)).init=function(){BeFunky.log("Animator Init"),this.initDefaultValues()},Ry.prototype.initDefaultValues=function(){this.id=null,this.animating=!1,this.animationFactor=0,this.animationType=BFN.AnimatorTypes.ANIMATION_TYPE_LINEAR,this.linearSteps=5,this.easeInDivisor=2,this.increasing=!1,this.decreasing=!1,this.animationEaseValue=0,this.animationGoalValue=0,this.recommendedFrameRate=48,this.speedFactor=this.recommendedFrameRate/BFN.frameRate,this.ignoreAnimationCalls=!1},Ry.prototype.setAnimatorFactor=function(e){this.animationFactor=Math.max(0,Math.min(1,e)),this.dispatchEvent(BFN.AnimatorEvents.UPDATE)},Ry.prototype.increase=function(){this.ignoreAnimationCalls||(this.animating=!0,this.increasing=!0,this.decreasing=!1,this.timeDuration=Math.round(this.linearSteps/this.recommendedFrameRate*1e3),this.timeStart=this.getTime()-this.timeDuration*this.animationFactor,this.timeEnd=this.timeStart+this.timeDuration,this.increaseUpdate())},Ry.prototype.decrease=function(){this.ignoreAnimationCalls||(this.animating=!0,this.increasing=!1,this.decreasing=!0,this.timeDuration=Math.round(this.linearSteps/this.recommendedFrameRate*1e3)*this.animationFactor,this.timeStart=this.getTime(),this.timeEnd=this.timeStart+this.timeDuration,this.decreaseUpdate())},Ry.prototype.easeValue=function(){this.ignoreAnimationCalls||(this.animating=!0,this.easeValueUpdate())},Ry.prototype.startUpdate=function(){this.ignoreAnimationCalls||(this.animating=!0,this.update())},Ry.prototype.stopUpdate=function(){this.ignoreAnimationCalls||(this.animating=!1)},Ry.prototype.increaseUpdate=function(){if(this.increasing){switch(this.animationType){case BFN.AnimatorTypes.ANIMATION_TYPE_LINEAR:this.animationFactor=this.timeEnd>this.timeStart?Math.min(1,(this.getTime()-this.timeStart)/(this.timeEnd-this.timeStart)):1;break;case BFN.AnimatorTypes.ANIMATION_TYPE_EASE_IN:var e=Math.max(1.1,this.easeInDivisor*this.speedFactor);Math.abs(1-this.animationFactor)/e>.001?this.animationFactor+=(1-this.animationFactor)/this.easeInDivisor:this.animationFactor=1}this.dispatchEvent(BFN.AnimatorEvents.UPDATE),1==this.animationFactor&&(this.animating=!1,this.increasing=!1,this.dispatchEvent(BFN.AnimatorEvents.UPDATE_COMPLETE),this.dispatchEvent(BFN.AnimatorEvents.INCREASE_COMPLETE));try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.increaseUpdate.bind(this),BFN.frameInterval)}},Ry.prototype.decreaseUpdate=function(){if(this.decreasing){switch(this.animationType){case BFN.AnimatorTypes.ANIMATION_TYPE_LINEAR:this.animationFactor=this.timeEnd>this.timeStart?1-Math.min(1,(this.getTime()-this.timeStart)/(this.timeEnd-this.timeStart)):0;break;case BFN.AnimatorTypes.ANIMATION_TYPE_EASE_IN:var e=Math.max(1.1,this.easeInDivisor*this.speedFactor);Math.abs(0-this.animationFactor)/e>.001?this.animationFactor+=(0-this.animationFactor)/this.easeInDivisor:this.animationFactor=0}this.dispatchEvent(BFN.AnimatorEvents.UPDATE),0==this.animationFactor&&(this.animating=!1,this.decreasing=!1,this.dispatchEvent(BFN.AnimatorEvents.UPDATE_COMPLETE),this.dispatchEvent(BFN.AnimatorEvents.DECREASE_COMPLETE));try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.decreaseUpdate.bind(this),BFN.frameInterval)}},Ry.prototype.easeValueUpdate=function(){if(this.animating){var e=Math.max(1.1,this.easeInDivisor*this.speedFactor);Math.abs(this.animationGoalValue-this.animationEaseValue)/e>.005?(this.animationEaseValue+=(this.animationGoalValue-this.animationEaseValue)/this.easeInDivisor,this.dispatchEvent(BFN.AnimatorEvents.UPDATE)):(this.animationEaseValue=this.animationGoalValue,this.animating=!1,this.dispatchEvent(BFN.AnimatorEvents.UPDATE),this.dispatchEvent(BFN.AnimatorEvents.UPDATE_COMPLETE));try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.easeValueUpdate.bind(this),BFN.frameInterval)}},Ry.prototype.update=function(){if(this.animating){this.dispatchEvent(BFN.AnimatorEvents.UPDATE);try{BFN.MainUI.requestRender()}catch(e){}setTimeout(this.update.bind(this),BFN.frameInterval)}},Ry.prototype.getTime=function(){return(new Date).getTime()},Object.defineProperty(Ry.prototype,"animationCosFactor",{get:function(){return(1+(this.animationFactor<.5?Math.sin(this.animationFactor*Math.PI)-1:1-Math.sin(this.animationFactor*Math.PI)))/2}}),Object.defineProperty(Ry.prototype,"animationSinFactor",{get:function(){return(Math.sin(this.animationFactor*Math.PI-Math.PI/2)+1)/2}}),BFN.Animator=Ry}BFN.DraggerEvents={DRAGGING_STARTED:new Event("DRAGGING_STARTED"),DRAGGING:new Event("DRAGGING"),DRAGGING_COMPLETE:new Event("DRAGGING_COMPLETE")},BFN.ActiveDraggers=[];var Ay=function(e){u(n,BFN.EventDispatcher);var t=p(n);function n(){var e;return i(this,n),(e=t.call(this)).init(),e}return a(n,[{key:"init",value:function(){this.draggedItem=null,this.item=null,this.itemStartX=0,this.itemStartY=0,this.mouseStartX=0,this.mouseStartY=0,this.mouseDeltaX=0,this.mouseDeltaY=0,this.draggedX=0,this.draggedY=0,this.scale=1,this.useBounds=!0,this.autoDrag=!0,this.stickyDrag=!0,this.active=!1,this.dragging=!1,this.draggingPointerID=null,this.wasDragged=!1,this.pixelDragThreshold=0,this.pixelDragThresholdPassed=!1,this.pixelDragThresholdPreventEvent=!1,this.pointerEvent=null,this.altScale=null,this.altStickyDrag=null,this.preventSelectionDrag=!1,this.deselectItemGroup=!0,this.preRenderDragOnly=!1,this.draggingEventEmissionPending=!1,this.completeStopDragTimeoutID=null,this.bounds={minX:0,minY:0,maxX:100,maxY:100},this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,this.lastMousePosition=new PIXI.Point,this.currentMousePosition=new PIXI.Point,this.dragVelocity=0,this.handleItemReleasedBind=this.handleItemReleased.bind(this),this.handleItemMouseMoveBind=this.handleItemMouseMove.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)}},{key:"drag",value:function(e){if(!this.active){this.active=!0,this.dragging=!0,this.item=e;var t=BeFunky.globalPointerCoords;this.itemStartX=this.draggedX=this.item.x,this.itemStartY=this.draggedY=this.item.y,this.mouseStartX=t.x,this.mouseStartY=t.y,document.removeEventListener(BeFunky.pointerup,this.handleItemReleasedBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleItemMouseMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handleItemReleasedBind,!0),document.addEventListener(BeFunky.pointermove,this.handleItemMouseMoveBind,!0),this.dispatchEvent(BFN.DraggerEvents.DRAGGING_STARTED),this.lastMousePosition.x=this.currentMousePosition.x=t.x,this.lastMousePosition.y=this.currentMousePosition.y=t.y,this.pixelDragThresholdPassed=!1,BFN.ActiveDraggers.includes(this)||BFN.ActiveDraggers.push(this),this.preRenderDragOnly&&BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),BFN.MainUI.requestRender()}}},{key:"stopDrag",value:function(){this.active&&(this.preRenderDragOnly&&this.draggingEventEmissionPending&&this.dispatchEvent(BFN.DraggerEvents.DRAGGING),this.draggingEventEmissionPending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.dragging=!1,this.draggingPointerID=null,this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,document.removeEventListener(BeFunky.pointerup,this.handleItemReleasedBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleItemMouseMoveBind,!0),this.item&&this.wasDragged&&BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this.item),"stop_drag"),this.draggedItem=this.item,this.item=null,BFN.MainUI.requestRender(),this.pointerEvent=null,this.completeStopDragTimeoutID=setTimeout(this.completeStopDrag.bind(this),0))}},{key:"completeStopDrag",value:function(){this.active&&(this.dispatchEvent(BFN.DraggerEvents.DRAGGING_COMPLETE),this.draggedItem=null,this.wasDragged=!1,this.altScale=null,this.altStickyDrag=null,BFN.ActiveDraggers.includes(this)&&BFN.ActiveDraggers.splice(BFN.ActiveDraggers.indexOf(this),1),this.active=!1,null!==this.completeStopDragTimeoutID&&(clearTimeout(this.completeStopDragTimeoutID),this.completeStopDragTimeoutID=null))}},{key:"setBounds",value:function(e,t,n,i){this.bounds.minX=e,this.bounds.minY=t,this.bounds.maxX=n,this.bounds.maxY=i}},{key:"handleItemReleased",value:function(e){"touch"===e.pointerType&&null!==this.draggingPointerID&&this.draggingPointerID!==e.pointerId||this.stopDrag()}},{key:"handleItemMouseMove",value:function(e){if(this.item&&("touch"!==e.pointerType||(null===this.draggingPointerID&&(this.draggingPointerID=e.pointerId),this.draggingPointerID===e.pointerId))){this.ctrlKey=e.ctrlKey||e.metaKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey;var t=null===this.altScale?this.scale:this.altScale,n=null===this.altStickyDrag?this.stickyDrag:this.altStickyDrag,i=BeFunky.globalPointerCoords;if(this.mouseDeltaX=(i.x-this.mouseStartX)/t,this.mouseDeltaY=(i.y-this.mouseStartY)/t,this.pixelDragThreshold&&!this.pixelDragThresholdPassed){if(Math.sqrt(Math.pow(i.x-this.mouseStartX,2)+Math.pow(i.y-this.mouseStartY,2))>this.pixelDragThreshold)this.pixelDragThresholdPassed=!0,this.mouseStartX=i.x,this.mouseStartY=i.y;else if(this.pixelDragThresholdPreventEvent)return;this.mouseDeltaX=this.mouseDeltaY=0}if(this.wasDragged||!this.mouseDeltaX&&!this.mouseDeltaY||(this.wasDragged=!0,BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this.item,!0),"start_drag")),this.draggedX=this.itemStartX+this.mouseDeltaX,this.draggedY=this.itemStartY+this.mouseDeltaY,this.useBounds){var r=Math.max(this.bounds.minX,Math.min(this.bounds.maxX,this.draggedX)),a=Math.max(this.bounds.minY,Math.min(this.bounds.maxY,this.draggedY));n&&(this.draggedX<this.bounds.minX?this.mouseStartX+=(this.draggedX-this.bounds.minX)*t:this.draggedX>this.bounds.maxX&&(this.mouseStartX+=(this.draggedX-this.bounds.maxX)*t),this.draggedY<this.bounds.minY?this.mouseStartY+=(this.draggedY-this.bounds.minY)*t:this.draggedY>this.bounds.maxY&&(this.mouseStartY+=(this.draggedY-this.bounds.maxY)*t)),this.draggedX=r,this.draggedY=a}this.autoDrag&&(this.item.x=this.draggedX,this.item.y=this.draggedY);var o=BeFunky.globalPointerCoords;this.currentMousePosition.x=o.x,this.currentMousePosition.y=o.y;var s=this.currentMousePosition.x-this.lastMousePosition.x,l=this.currentMousePosition.y-this.lastMousePosition.y,u=Math.sqrt(Math.pow(s,2)+Math.pow(l,2));this.dragVelocity=u,this.lastMousePosition.x=this.currentMousePosition.x,this.lastMousePosition.y=this.currentMousePosition.y,BFN.MainUI.requestRender(),this.pointerEvent=e,this.preRenderDragOnly?this.draggingEventEmissionPending=!0:this.dispatchEvent(BFN.DraggerEvents.DRAGGING)}}},{key:"handleMainUIPreRender",value:function(){this.preRenderDragOnly?this.draggingEventEmissionPending&&(this.draggingEventEmissionPending=!1,this.dispatchEvent(BFN.DraggerEvents.DRAGGING)):BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)}},{key:"validDrag",get:function(){return this.item&&(!this.useBounds||this.useBounds&&(Math.abs(this.bounds.maxX-this.bounds.minX)>.1||Math.abs(this.bounds.maxY-this.bounds.minY)>.1))}}]),n}();function Vy(){PIXI.Container.call(this),this.init()}function Uy(e,t,n){PIXI.Container.call(this),this._type=BFN.CropHandleTypes.hasOwnProperty(e)?e:BFN.CropHandleTypes.TYPE_CORNER,this._rotation=t||0,this._size=n||12,this.init()}function Gy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16777215;PIXI.Container.call(this),this._color=e,this.init()}function Hy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.appViewState=e,this.init()}function zy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.baseOpacity=Math.max(0,Math.min(1,t)),this._color=e,this._opacity=this.baseOpacity,this._fitPaddingX=n,this._fitPaddingY=i,this.init()}function jy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;PIXI.Container.call(this),BFN.EventDispatcher.call(this),this._color=Math.max(0,Math.min(16777215,e)),this._opacity=Math.max(0,Math.min(1,t)),this.init()}function Xy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;PIXI.Container.call(this),this._color=e,this._opacity=t,this.init()}function Wy(){PIXI.Sprite.call(this),this.init()}function Yy(){PIXI.Sprite.call(this),this.init()}function qy(){PIXI.Sprite.call(this),this.init()}function Ky(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4294967295,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4278190080,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;PIXI.Sprite.call(this),this.dashed=e,this.smoothPadding=t,this.lineThickness=n,this.isLinear=i,this.lighterColor=r,this.darkerColor=a,this.uniqueTextureID=o,this.isRuler=!1,this.init()}function Qy(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4294967295,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4278190080,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;PIXI.Sprite.call(this),this.dashed=e,this.smoothPadding=t,this.lineThickness=n,this.isLinear=i,this.lighterColor=r,this.darkerColor=a,this.uniqueTextureID=o,this.init()}function Zy(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4294967295,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4278190080,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;PIXI.Container.call(this),this.dashed=e,this.smoothPadding=t,this.lineThickness=n,this.isLinear=i,this.lighterColor=r,this.darkerColor=a,this.uniqueTextureID=o,this.init()}function Jy(){PIXI.Sprite.call(this),this.init()}function $y(){PIXI.Container.call(this),this.init()}function ex(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];PIXI.Sprite.call(this),this.autoRender=e,this.init()}function tx(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];PIXI.Sprite.call(this),this.autoRender=e,this.init()}function nx(){PIXI.Sprite.call(this),this.init()}function ix(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;PIXI.Container.call(this),BFN.EventDispatcher.call(this),this._color=Math.max(0,Math.min(16777215,e)),this._opacity=Math.max(0,Math.min(1,t)),this._blendMode=0,this.init()}function rx(){PIXI.Container.call(this),this.init()}function ax(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;PIXI.Container.call(this),this.init(),this.texture=e,this.width=t,this.height=n}function ox(){PIXI.Container.call(this),this.init()}function sx(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;PIXI.particles.ParticleContainer.call(this,2*e,{scale:!1,position:!1,rotation:!1,uvs:!1,alpha:!0},e,!0),this.init()}function lx(){this.hGuidesNum=BFN.maxImageSize,this.vGuidesNum=BFN.maxImageSize;var e=this.hGuidesNum+this.vGuidesNum;PIXI.particles.ParticleContainer.call(this,e,{scale:!0,position:!0,rotation:!0,uvs:!1,alpha:!1},e,!0),this.init()}function ux(){PIXI.Graphics.call(this),this.init()}function cx(){PIXI.Container.call(this),this.init()}function hx(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function dx(){this.init()}function mx(){PIXI.Sprite.call(this),BeFunky.isEdgeHTML&&(BFN.maxBrushSize=512),this.init()}function px(){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.init()}function gx(){PIXI.Sprite.call(this),this.init()}function fx(){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.init()}function vx(){PIXI.Sprite.call(this),this.init()}function yx(){PIXI.Sprite.call(this),this.init()}function xx(){PIXI.Sprite.call(this),this.init()}function _x(){PIXI.Sprite.call(this),this.init()}function Ix(){PIXI.Sprite.call(this),this.init()}function Tx(){PIXI.Sprite.call(this),this.init()}function bx(e,t,n,i,r){PIXI.Sprite.call(this),this._elementVO=e,this._sourcePoint=t,this._centerPoint=n,this._displayDimensions=i,this.useThumb=r||!1,this.init()}function Sx(e){PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.useThumbs=e||!1,this.init()}function Cx(){PIXI.Sprite.call(this),this.init()}function Bx(){PIXI.Sprite.call(this),this.init()}function Fx(){PIXI.Sprite.call(this),this.init()}function Ex(){PIXI.Sprite.call(this),this.init()}function Px(){PIXI.Sprite.call(this),this.init()}function kx(){PIXI.Sprite.call(this),this.init()}function Nx(){PIXI.Sprite.call(this),this.init()}function Mx(){PIXI.Sprite.call(this),this.init()}function Dx(){PIXI.Sprite.call(this),this.init()}function wx(){PIXI.Sprite.call(this),this.init()}function Lx(){PIXI.Sprite.call(this),this.init()}function Ox(){PIXI.Sprite.call(this),this.init()}function Rx(){PIXI.Container.call(this),this.init()}function Ax(){PIXI.Sprite.call(this),this.init()}function Vx(){PIXI.Sprite.call(this),this.init()}function Ux(){PIXI.Container.call(this),this.init()}function Gx(e,t){switch(PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.itemObject=e,this.appViewState=t,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.transformLayer=BFN.PhotoEditorCanvas.transformLayer;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.transformLayer=BFN.CollageMakerCanvas.transformLayer;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.transformLayer=BFN.DesignerCanvas.transformLayer}this.init()}function Hx(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function zx(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function jx(){PIXI.Container.call(this),this.init()}function Xx(e,t){PIXI.Container.call(this),this._sourceTexture=null,this._shadowTexture=null,e&&e.adjustScale&&t&&(this._sourceTexture=e.renderClone(),this._sourceTexture.adjustScale=Object.assign({},e.adjustScale),this._shadowTexture=t.renderClone()),this.init()}function Wx(e,t){switch(PIXI.Sprite.call(this),BFN.EventDispatcher.call(this),this.appViewState=e,this.canvas=t,this.model=null,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.model=BFN.PhotoEditorModel;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.model=BFN.CollageMakerModel;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.model=BFN.DesignerModel}this.init()}function Yx(){PIXI.Container.call(this),this.init()}function qx(e){PIXI.Sprite.call(this),this.transformLayer=e,this.init()}function Kx(e){PIXI.Container.call(this),this.transformTool=e,this.init()}function Qx(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function Zx(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function Jx(){PIXI.Sprite.call(this),this.init()}function $x(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}BFN.Dragger=Ay,Vy.prototype=Object.create(PIXI.Container.prototype),Vy.prototype.init=function(){BeFunky.log("HoverButton Init"),this.initDefaultValues(),this.initButtonContainer(),this.initButtonSprite(),this.initAnimators()},Vy.prototype.initDefaultValues=function(){this.interactive=this.buttonMode=!0,this._selected=!1,this._hovered=!1,this._active=!0,this.mouseover=this.handleMouseOver.bind(this),this.mouseout=this.handleMouseOut.bind(this)},Vy.prototype.initButtonContainer=function(){this.buttonContainer=new PIXI.Container,this.addChild(this.buttonContainer)},Vy.prototype.initButtonSprite=function(){this.buttonSprite=new PIXI.Sprite,this.buttonSprite.anchor.x=this.buttonSprite.anchor.y=.5,this.buttonContainer.addChild(this.buttonSprite)},Vy.prototype.initAnimators=function(){this.hoverAnimator=new BFN.Animator,this.hoverAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.selectAnimator=new BFN.Animator,this.selectAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.activeAnimator=new BFN.Animator,this.activeAnimator.setAnimatorFactor(1),this.activeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleActiveAnimatorUpdate.bind(this))},Vy.prototype.updateDisplay=function(){var e=1;e=BFN.Util.interpolateNumber(e,1.2,this.hoverAnimator.animationFactor),e=BFN.Util.interpolateNumber(e,1.2,this.selectAnimator.animationFactor),this.buttonSprite.scale.x=this.buttonSprite.scale.y=e},Vy.prototype.handleMouseOver=function(){this._hovered=!0,this.hoverAnimator.increase()},Vy.prototype.handleMouseOut=function(){this._hovered=!1,this.hoverAnimator.decrease()},Vy.prototype.handleAnimatorUpdate=function(){this.updateDisplay()},Vy.prototype.handleActiveAnimatorUpdate=function(){this.buttonContainer.scale.x=this.buttonContainer.scale.y=.25*this.activeAnimator.animationFactor+.75,this.buttonContainer.alpha=this.activeAnimator.animationFactor},Object.defineProperty(Vy.prototype,"texture",{set:function(e){this.buttonSprite.texture=e},get:function(){return this.buttonSprite.texture}}),Object.defineProperty(Vy.prototype,"selected",{set:function(e){this._selected=e,this._selected?this.selectAnimator.increase():this.selectAnimator.decrease()},get:function(){return this._selected}}),Object.defineProperty(Vy.prototype,"hovered",{get:function(){return this._hovered}}),Object.defineProperty(Vy.prototype,"active",{set:function(e){this._active!=!!e&&(this._active=!!e,this.interactive=this.interactiveChildren=this._active,this._active?this.activeAnimator.increase():this.activeAnimator.decrease())},get:function(){return this._active}}),BFN.HoverButton=Vy,BFN.CropHandleTypes={TYPE_CORNER:"TYPE_CORNER",TYPE_EDGE:"TYPE_EDGE"},Uy.prototype=Object.create(PIXI.Container.prototype),Uy.prototype.init=function(){BeFunky.log("CropHandle Init"),this.initDefaultValues(),this.initHandle(),this.initAnimator()},Uy.prototype.initDefaultValues=function(){this.interactive=this.buttonMode=!0,this.hovered=!1,this.mouseDown=!1,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind),this.on("pointerdown",this.handleMouseDownBind)},Uy.prototype.initHandle=function(){switch(this.handle=new PIXI.Sprite,this.handle.rotation=this._rotation,this.addChild(this.handle),this.fill=new PIXI.Graphics,this.handle.addChild(this.fill),this.outline=new PIXI.Graphics,this.handle.addChild(this.outline),this._type){case BFN.CropHandleTypes.TYPE_CORNER:this.initCorner();break;case BFN.CropHandleTypes.TYPE_EDGE:this.initEdge()}},Uy.prototype.initCorner=function(){this.fill.x=this.fill.y=5,this.fill.beginFill(0,0),this.fill.drawRect(-this._size,-this._size,2*this._size,2*this._size),this.fill.endFill(),this.fill.beginFill(16777215),this.fill.moveTo(0,0),this.fill.lineTo(this._size+0,0),this.fill.lineTo(this._size+0,this._size/3+0),this.fill.lineTo(this._size/3+0,this._size/3+0),this.fill.lineTo(this._size/3+0,this._size+0),this.fill.lineTo(0,this._size+0),this.fill.lineTo(0,0),this.fill.endFill(),this.outline.x=this.outline.y=5,this.outline.lineStyle(1,0),this.outline.moveTo(0,0),this.outline.lineTo(this._size+0,0),this.outline.lineTo(this._size+0,this._size/3+0),this.outline.lineTo(this._size/3+0,this._size/3+0),this.outline.lineTo(this._size/3+0,this._size+0),this.outline.lineTo(0,this._size+0),this.outline.lineTo(0,0)},Uy.prototype.initEdge=function(){this.fill.y=5,this.fill.beginFill(0,0),this.fill.drawRect(-this._size/2,-this._size,this._size,2*this._size),this.fill.endFill(),this.fill.beginFill(16777215),this.fill.drawRect(-this._size/2,0,this._size,this._size/3),this.fill.endFill(),this.outline.y=5,this.outline.lineStyle(1,0),this.outline.drawRect(-this._size/2,0,this._size,this._size/3)},Uy.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this))},Uy.prototype.handleMouseOver=function(){this.hovered=!0,this.animator.increase()},Uy.prototype.handleMouseOut=function(){this.hovered=!1,this.mouseDown||this.animator.decrease()},Uy.prototype.handleMouseDown=function(){this.mouseDown=!0,document.addEventListener(BeFunky.pointerup,this.handleMouseUpBind)},Uy.prototype.handleMouseUp=function(){this.mouseDown=!1,document.removeEventListener(BeFunky.pointerup,this.handleMouseUpBind),this.hovered||this.handleMouseOutBind()},Uy.prototype.handleAnimatorUpdate=function(){this.fill.alpha=1-this.animator.animationFactor/2},BFN.CropHandle=Uy,Gy.prototype=Object.create(PIXI.Container.prototype),Gy.prototype.init=function(){BeFunky.log("SquareButton Init"),this.initDefaultValues(),this.initSquareGraphic(),this.initAnimators()},Gy.prototype.initDefaultValues=function(){this.interactive=!0,this._itemWidth=10,this._itemHeight=10,this.hovered=!1,this._selected=!1,this._unhoveredAlpha=.25,this._hoveredAlpha=.75,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind)},Gy.prototype.initSquareGraphic=function(){this.squareGraphic=new PIXI.Graphics,this.addChild(this.squareGraphic),this.drawButton()},Gy.prototype.initAnimators=function(){this.hoverAnimator=new BFN.Animator,this.hoverAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.hoverAnimator.setAnimatorFactor(0)},Gy.prototype.setHoverAlphas=function(e,t){this._unhoveredAlpha=e,this._hoveredAlpha=t,this.updateDisplay()},Gy.prototype.drawButton=function(){this.squareGraphic.clear(),this.squareGraphic.beginFill(this._color),this.squareGraphic.drawRect(0,0,10,10),this.squareGraphic.endFill()},Gy.prototype.updateDisplay=function(){this.squareGraphic.width=this._itemWidth,this.squareGraphic.height=this._itemHeight,this.squareGraphic.alpha=this.hoverAnimator.animationFactor*(this._hoveredAlpha=this._unhoveredAlpha)+this._unhoveredAlpha},Gy.prototype.handleMouseOver=function(){this.hovered=!0,this.hoverAnimator.increase()},Gy.prototype.handleMouseOut=function(){this.hovered=!1,this.selected||this.hoverAnimator.decrease()},Gy.prototype.handleAnimatorUpdate=function(){this.updateDisplay()},Object.defineProperty(Gy.prototype,"color",{set:function(e){this._color!=e&&(this._color=e,this.drawButton())},get:function(){return this._selected}}),Object.defineProperty(Gy.prototype,"selected",{set:function(e){this._selected=e,this.hovered||this.selected||this.hoverAnimator.decrease()},get:function(){return this._selected}}),Object.defineProperty(Gy.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(Gy.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),BFN.SquareButton=Gy,BFN.CanvasScaleBarsEvents={SCALING_STARTED:new Event("SCALING_STARTED"),SCALING_COMPLETE:new Event("SCALING_COMPLETE"),DIMENSIONS_UPDATED:new Event("DIMENSIONS_UPDATED"),SCALE_BAR_ACTION:new Event("SCALE_BAR_ACTION")},Hy.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Hy.prototype.init=function(){BeFunky.log("CanvasScaleBars Init"),this.initDefaultValues(),this.initScaleBars(),this.initFadeAnimator(),this.updateScaleBarPositions(),this.updateScaleBarSizes(),this.updateScaleBarScales()},Hy.prototype.initDefaultValues=function(){switch(this.interactive=!0,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.canvasModel=BFN.PhotoEditorCanvasModel;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.canvasModel=BFN.CollageMakerCanvasModel;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.canvasModel=BFN.DesignerCanvasModel}this.minSize=BFN.minImageSize,this.maxSize=BFN.maxImageSize,this._active=!0,this._showing=!1,this._enabled=!0,this._canvasScale=1,this._canvasWidth=100,this._canvasHeight=100,this.isTouch=!1,this.currentScaleBar=null,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data={id:null,action:null},this.appViewState&&(this.hovered=!1,this.dragging=!1,setTimeout(function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_OVER.type,this.handleMainUIMouseOver.bind(this)),BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_OUT.type,this.handleMainUIMouseOut.bind(this))}.bind(this),100),document.addEventListener(BeFunky.pointerdown,this.handleDocumentPressed.bind(this),!0),document.addEventListener(BeFunky.pointerup,this.handleDocumentReleased.bind(this),!0))},Hy.prototype.handleDocumentPressed=function(){requestAnimationFrame(function(){this.interactive=this.interactiveChildren=!1}.bind(this))},Hy.prototype.handleDocumentReleased=function(){this.interactive=this.interactiveChildren=!0},Hy.prototype.initScaleBars=function(){this.scaleBarData=[{id:"left",rotation:Math.PI/2,direction:"vertical"},{id:"right",rotation:-Math.PI/2,direction:"vertical"},{id:"top",rotation:Math.PI,direction:"horizontal"},{id:"bottom",rotation:0,direction:"horizontal"},{id:"topLeft",rotation:Math.PI,direction:"none"},{id:"topRight",rotation:-Math.PI/2,direction:"none"},{id:"bottomLeft",rotation:Math.PI/2,direction:"none"},{id:"bottomRight",rotation:0,direction:"none"}],this.handleScaleBarMouseOverBind=this.handleScaleBarMouseOver.bind(this),this.handleScaleBarMouseOutBind=this.handleScaleBarMouseOut.bind(this),this.handleScaleBarPressedBind=this.handleScaleBarPressed.bind(this),this.handleScaleBarReleasedBind=this.handleScaleBarReleased.bind(this),this.handleScaleBarDraggerDraggingBind=this.handleScaleBarDraggerDragging.bind(this),this.handleScaleBarDraggerDraggingStartedBind=this.handleScaleBarDraggerDraggingStarted.bind(this),this.handleScaleBarDraggerDraggingCompleteBind=this.handleScaleBarDraggerDraggingComplete.bind(this),this.scaleBars={};for(var e=0;e<this.scaleBarData.length;e++){var t=this.scaleBarData[e],n=new BFN.SquareButton(4145484);switch(n.buttonMode=!1,n.itemWidth=n.itemHeight=20,n.setHoverAlphas(.6,1),n.id=t.id,n.rotation=t.rotation,n.roundedRectFilter=new BFN.filters.RoundedRectFilter,n.roundedRectFilter.strokeWidth=0,n.roundedRectFilter.strokeColor=0,n.roundedRectFilter.useTexture=1,n.roundedRectFilter.getCornerRadiusFromShortestSide=1,n.filters=[n.roundedRectFilter],t.direction){case"vertical":n.roundedRectFilter.edgePaddingX=4,n.roundedRectFilter.edgePaddingY=1;break;case"horizontal":n.roundedRectFilter.edgePaddingX=1,n.roundedRectFilter.edgePaddingY=4;break;case"none":n.roundedRectFilter.edgePadding=4}n.on(BeFunky.pointerover,this.handleScaleBarMouseOverBind),n.on(BeFunky.pointerout,this.handleScaleBarMouseOutBind),n.on(BeFunky.pointerdown,this.handleScaleBarPressedBind),this.addChild(n),this.scaleBars[n.id]=n}this.scaleBarDragger=new BFN.Dragger,this.scaleBarDragger.stickyDrag=!1,this.scaleBarDragger.preventSelectionDrag=!0,this.scaleBarDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleScaleBarDraggerDraggingBind),this.scaleBarDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleScaleBarDraggerDraggingStartedBind),this.scaleBarDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleScaleBarDraggerDraggingCompleteBind)},Hy.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.linearSteps=10,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this)),this.appViewState&&this.fadeAnimator.setAnimatorFactor(1)},Hy.prototype.show=function(){this._showing=!0,this._active&&this.fadeAnimator.increase()},Hy.prototype.hide=function(){this._showing=!1,this.fadeAnimator.decrease()},Hy.prototype.updateScaleBarPositions=function(){this.scaleBars.left.x=this.scaleBars.bottom.x=this.scaleBars.topLeft.x=this.scaleBars.bottomLeft.x=-this._canvasWidth/2,this.scaleBars.right.x=this.scaleBars.top.x=this.scaleBars.topRight.x=this.scaleBars.bottomRight.x=this._canvasWidth/2,this.scaleBars.left.y=this.scaleBars.top.y=this.scaleBars.topLeft.y=this.scaleBars.topRight.y=-this._canvasHeight/2,this.scaleBars.right.y=this.scaleBars.bottom.y=this.scaleBars.bottomLeft.y=this.scaleBars.bottomRight.y=this._canvasHeight/2},Hy.prototype.updateScaleBarSizes=function(){this.scaleBars.left.itemWidth=this.scaleBars.right.itemWidth=this._canvasHeight,this.scaleBars.top.itemWidth=this.scaleBars.bottom.itemWidth=this._canvasWidth},Hy.prototype.updateScaleBarScales=function(){for(var e in this.scaleBars){var t=this.scaleBars[e];switch(t.scale.y=1/this._canvasScale,e){case"topLeft":case"topRight":case"bottomLeft":case"bottomRight":t.scale.x=t.scale.y}}},Hy.prototype.handleMainUIMouseOver=function(e){BFN.AppModel.viewState==this.appViewState&&(this.hovered=!0,this.isTouch=!1,this.show())},Hy.prototype.handleMainUIMouseOut=function(e){this.hovered=!1,this.dragging||this.isTouch||this.hide()},Hy.prototype.handleScaleBarMouseOver=function(e){!this.scaleBarDragger.dragging&&this._enabled&&(this.hoveredScaleBarID=e.currentTarget.id,setTimeout(function(){BFN.CursorScreen.cursor="arrow";var e=this.hoveredScaleBarID;switch(e){case"left":case"right":BFN.CursorScreen.cursorRotation=0;break;case"top":case"bottom":BFN.CursorScreen.cursorRotation=Math.PI/2;break;case"topLeft":case"bottomRight":BFN.CursorScreen.cursorRotation=Math.PI/4;break;case"topRight":case"bottomLeft":BFN.CursorScreen.cursorRotation=-Math.PI/4}BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=e,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="over",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION)}.bind(this),0))},Hy.prototype.handleScaleBarMouseOut=function(e){this.currentScaleBar?BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=this.currentScaleBar.id:(BFN.CursorScreen.cursor=null,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=null),BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="out",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION)},Hy.prototype.handleScaleBarPressed=function(e){if(!this.canvasModel.canvasScaling&&this._enabled){this.currentAspectRatio=this._canvasHeight/this._canvasWidth,this.currentScaleBar=e.currentTarget,this.hovered||(this.isTouch=!0,this.show()),this.isTouch&&(this.handleScaleBarMouseOverBind(e),this.currentScaleBar.handleMouseOver(),this.currentScaleBar.selected=!0);var t=this.currentScaleBar.id;switch(t){case"left":this.scaleBarDragger.setBounds(-this.maxSize,this.currentScaleBar.y,-this.minSize/2,this.currentScaleBar.y);break;case"right":this.scaleBarDragger.setBounds(this.minSize/2,this.currentScaleBar.y,this.maxSize,this.currentScaleBar.y);break;case"top":this.scaleBarDragger.setBounds(this.currentScaleBar.x,-this.maxSize,this.currentScaleBar.x,-this.minSize/2);break;case"bottom":this.scaleBarDragger.setBounds(this.currentScaleBar.x,this.minSize/2,this.currentScaleBar.x,this.maxSize);break;case"topLeft":this.scaleBarDragger.setBounds(-this.maxSize,-this.maxSize,-this.minSize/2,-this.minSize/2);break;case"topRight":this.scaleBarDragger.setBounds(this.minSize/2,-this.maxSize,this.maxSize,-this.minSize/2);break;case"bottomLeft":this.scaleBarDragger.setBounds(-this.maxSize,this.minSize/2,-this.minSize/2,this.maxSize);break;case"bottomRight":this.scaleBarDragger.setBounds(this.minSize/2,this.minSize/2,this.maxSize,this.maxSize)}for(var n in BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=t,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="press",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION),BFN.CursorScreen.cursorLock=!0,document.addEventListener(BeFunky.pointerup,this.handleScaleBarReleasedBind),this.scaleBarDragger.drag(this.currentScaleBar),this.scaleBars){var i=this.scaleBars[n];i.selected=i==this.currentScaleBar,i.interactive=i==this.currentScaleBar}}},Hy.prototype.handleScaleBarReleased=function(e){if(this.isTouch&&(this.handleScaleBarMouseOutBind(e),this.currentScaleBar&&(this.currentScaleBar.handleMouseOut(),this.currentScaleBar.selected=!1)),BFN.CursorScreen.cursorLock=!1,document.removeEventListener(BeFunky.pointerup,this.handleScaleBarReleasedBind),this.currentScaleBar){if(this.currentScaleBar.hovered){var t=this.currentScaleBar.id;BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=t}else BFN.CursorScreen.cursor=null,BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.id=null;for(var n in BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.data.action="release",this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION),this.currentScaleBar=null,this.scaleBars){var i=this.scaleBars[n];i.selected=!1,i.interactive=!0}}},Hy.prototype.handleScaleBarDraggerDragging=function(e){this.currentScaleBar&&(this._canvasWidth=Math.round(Math.abs(2*this.currentScaleBar.x)),this._canvasHeight=Math.round(Math.abs(2*this.currentScaleBar.y)),this.updateScaleBarPositions(),this.updateScaleBarSizes(),this.dispatchEvent(BFN.CanvasScaleBarsEvents.DIMENSIONS_UPDATED))},Hy.prototype.handleScaleBarDraggerDraggingStarted=function(e){this.dragging=!0,this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALING_STARTED)},Hy.prototype.handleScaleBarDraggerDraggingComplete=function(e){this.dragging=!1,this.dispatchEvent(BFN.CanvasScaleBarsEvents.SCALING_COMPLETE),this.hovered||this.handleMainUIMouseOut()},Hy.prototype.handleFadeAnimatorUpdate=function(e){this.alpha=this.fadeAnimator.animationFactor},Object.defineProperty(Hy.prototype,"enabled",{set:function(e){this._enabled=e},get:function(){return this._enabled}}),Object.defineProperty(Hy.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.scaleBarDragger.scale=this._canvasScale,this.updateScaleBarScales()},get:function(){return this._canvasScale}}),Object.defineProperty(Hy.prototype,"canvasWidth",{set:function(e){this._canvasWidth=e,this.updateScaleBarPositions(),this.updateScaleBarSizes()},get:function(){return this._canvasWidth}}),Object.defineProperty(Hy.prototype,"canvasHeight",{set:function(e){this._canvasHeight=e,this.updateScaleBarPositions(),this.updateScaleBarSizes()},get:function(){return this._canvasHeight}}),Object.defineProperty(Hy.prototype,"active",{set:function(e){this._active=e,this._active?this._active&&this._showing&&this.show():this.hide()},get:function(){return this._active}}),BFN.CanvasScaleBars=Hy,zy.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),zy.prototype.init=function(){BeFunky.log("CanvasFrame Init"),this.initDefaultValues(),this.initRectangles(),this.setInnerDimensions(100,100),this.setOuterDimensions(200,200)},zy.prototype.initDefaultValues=function(){this.rectBaseSize=128,this._canvasScale=1},zy.prototype.initRectangles=function(){this.rectangles={},this.rectangles.top=this.createRect(-this.rectBaseSize/2,-this.rectBaseSize,this.rectBaseSize,this.rectBaseSize),this.rectangles.bottom=this.createRect(-this.rectBaseSize/2,0,this.rectBaseSize,this.rectBaseSize),this.rectangles.left=this.createRect(-this.rectBaseSize,-this.rectBaseSize/2,this.rectBaseSize,this.rectBaseSize),this.rectangles.right=this.createRect(0,-this.rectBaseSize/2,this.rectBaseSize,this.rectBaseSize)},zy.prototype.setInnerDimensions=function(e,t){this.innerW=e,this.innerH=t,this.rectangles.left.x=-this.innerW/2,this.rectangles.right.x=this.innerW/2,this.rectangles.top.y=-this.innerH/2,this.rectangles.bottom.y=this.innerH/2,this.updateDisplay()},zy.prototype.setOuterDimensions=function(e,t){this.outerW=e,this.outerH=t,this.updateDisplay()},zy.prototype.updateDisplay=function(){var e=Math.max(this._fitPaddingX/this._canvasScale,(this.outerW-this.innerW*this._canvasScale)/2/this._canvasScale)/this.rectBaseSize,t=this.innerH/this.rectBaseSize,n=(this.innerW+e*this.rectBaseSize*2)/this.rectBaseSize,i=Math.max(this._fitPaddingY/this._canvasScale,(this.outerH-this.innerH*this._canvasScale)/2/this._canvasScale)/this.rectBaseSize;this.rectangles.left.scale.x=this.rectangles.right.scale.x=e,this.rectangles.left.scale.y=this.rectangles.right.scale.y=t,this.rectangles.top.scale.x=this.rectangles.bottom.scale.x=n,this.rectangles.top.scale.y=this.rectangles.bottom.scale.y=i,BFN.MainUI&&BFN.MainUI.requestRender()},zy.prototype.createRect=function(e,t,n,i){var r=new PIXI.Sprite(PIXI.RenderTexture.create(n,i));return r.anchor.x=Math.max(0,Math.min(1,Math.abs(e/n))),r.anchor.y=Math.max(0,Math.min(1,Math.abs(t/i))),r.texture.fillColor(this._color,1),r.alpha=this._opacity,this.addChild(r),r},Object.defineProperty(zy.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.updateDisplay()},get:function(){return this._canvasScale}}),Object.defineProperty(zy.prototype,"color",{set:function(e){if("number"==typeof e){for(var t in this._color=Math.max(0,Math.min(16777215,e)),this.rectangles){this.rectangles[t].texture.fillColor(this._color,1)}BFN.MainUI.requestRender()}},get:function(){return this._color}}),Object.defineProperty(zy.prototype,"opacity",{set:function(e){for(var t in this._opacity=Math.max(0,Math.min(1,e)),this.rectangles){this.rectangles[t].alpha=this._opacity}BFN.MainUI.requestRender()},get:function(){return this._opacity}}),BFN.CanvasFrame=zy,jy.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),jy.prototype.init=function(){BeFunky.log("CanvasGlow Init"),this.initDefaultValues(),this.initGlowTexture(),this.initSprites(),this.setDimensions(0,0)},jy.prototype.initDefaultValues=function(){var e=this;this.interactive=this.interactiveChildren=!1,this.spriteSize=24,this.blurAmount=12,this._canvasScale=1,BFN.TransformItemIsolator.isolationAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,function(){e.alpha=Math.max(0,1-4*BFN.TransformItemIsolator.isolationAnimator.animationFactor)})},jy.prototype.initGlowTexture=function(){var e=this;BFN.CanvasGlowTexture||(BFN.CanvasGlowTexture=PIXI.RenderTexture.create(3*this.spriteSize,3*this.spriteSize),BFN.CanvasGlowTexture.clear(),setTimeout(function(){var t=PIXI.RenderTexture.create(BFN.CanvasGlowTexture.width,BFN.CanvasGlowTexture.height);t.clear(),t.fillRect(e.spriteSize,e.spriteSize,e.spriteSize,e.spriteSize,16777215,1);var n=new PIXI.Sprite(t),i=new BFN.filters.DirectionalBlurFilter;i.blendAlpha=!0,i.iterations=4,i.biDirectional=!0,i.amount=e.blurAmount/e.spriteSize,i.setDimensions(t.width,t.height,e.spriteSize),n.filters=[i],BFN.Stage.render(n,BFN.CanvasGlowTexture),t.destroyGC(!0),n.destroy(!0),BFN.MainUI.requestRender()},0)),this.glowTexture=BFN.CanvasGlowTexture},jy.prototype.initSprites=function(){this.sprites=[];for(var e=0;e<3;e++)for(var t=0;t<3;t++)if(1!==e||1!==t){var n=new PIXI.Sprite(new PIXI.Texture(this.glowTexture.baseTexture));n.pluginName="blend_picture",n.anchor.x=e/2,n.anchor.y=t/2,n.alpha=this._opacity,n.texture.frame=new PIXI.Rectangle(this.spriteSize*(2-e),this.spriteSize*(2-t),this.spriteSize,this.spriteSize),n.fillColor=this._color,n.intensity=1,this.addChild(n),this.sprites.push(n)}},jy.prototype.setDimensions=function(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this.updateDisplay())},jy.prototype.updateDisplay=function(){for(var e=0;e<this.sprites.length;e++){var t=this.sprites[e];t.visible=this._width>0&&this._height>0,t.visible&&(t.x=this._width/2*Math.round((.5-t.anchor.x)/.5),t.y=this._height/2*Math.round((.5-t.anchor.y)/.5),t.scale.x=1/this._canvasScale,t.scale.y=1/this._canvasScale,1===Math.round(2*t.anchor.x)&&(t.scale.x=this._width/this.spriteSize),1===Math.round(2*t.anchor.y)&&(t.scale.y=this._height/this.spriteSize))}BFN.MainUI&&BFN.MainUI.requestRender()},Object.defineProperty(jy.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.updateDisplay()},get:function(){return this._canvasScale}}),Object.defineProperty(jy.prototype,"color",{set:function(e){var t=this;"number"==typeof e&&(this._color=Math.max(0,Math.min(16777215,e)),this.sprites.forEach(function(e){e.fillColor=t._color}),BFN.MainUI.requestRender())},get:function(){return this._color}}),Object.defineProperty(jy.prototype,"opacity",{set:function(e){var t=this;this._opacity=Math.max(0,Math.min(1,e)),this.sprites.forEach(function(e){e.alpha=t._opacity}),BFN.MainUI.requestRender()},get:function(){return this._opacity}}),BFN.CanvasGlow=jy,Xy.prototype=Object.create(PIXI.Container.prototype),Xy.prototype.init=function(){BeFunky.log("WindowedVeil Init"),this.initDefaultValues(),this.initVeil(),this.initVeilMask(),this.update(200,200,50,50,100,100)},Xy.prototype.initDefaultValues=function(){this.rectBaseSize=32,this.alphaFilter=new PIXI.filters.AlphaFilter,this.filters=[this.alphaFilter]},Xy.prototype.initVeil=function(){this.veilSprite=new PIXI.Sprite(PIXI.RenderTexture.create(this.rectBaseSize,this.rectBaseSize)),this.veilSprite.texture.fillColor(this._color,this._opacity),this.veilSprite.pluginName="smooth_picture",this.addChild(this.veilSprite)},Xy.prototype.initVeilMask=function(){this.veilMaskTexture=PIXI.RenderTexture.create(this.rectBaseSize,this.rectBaseSize),this.veilMaskTexture.fillColor(16777215),this.veilMaskSprite=new PIXI.Sprite(this.veilMaskTexture),this.veilMaskSprite.pluginName="blend_picture",this.veilMaskSprite.blendMode=BFN.CONST.BLEND_MODES.ALPHA,this.addChild(this.veilMaskSprite)},Xy.prototype.update=function(e,t,n,i,r,a){this.outerW=e,this.outerH=t,this.innerX=n,this.innerY=i,this.innerW=r,this.innerH=a,this.updateDisplay()},Xy.prototype.updateDisplay=function(){this.veilSprite.width=this.outerW,this.veilSprite.height=this.outerH,this.veilMaskSprite.x=this.innerX,this.veilMaskSprite.y=this.innerY,this.veilMaskSprite.width=this.innerW,this.veilMaskSprite.height=this.innerH,BFN.MainUI&&BFN.MainUI.requestRender()},Xy.prototype.setMaskTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(e&&e.baseTexture){var i=new PIXI.Texture(e.baseTexture);i.rotate=[0,12,8,4][t+2*n],this.veilMaskTexture.resize(i.width,i.height),this.veilMaskTexture.copyPixels(i),i.destroy(!1)}else this.veilMaskTexture.resize(this.rectBaseSize,this.rectBaseSize),this.veilMaskTexture.fillColor(16777215);this.updateDisplay()},Object.defineProperty(Xy.prototype,"color",{set:function(e){"number"==typeof e&&(this._color=Math.max(0,Math.min(16777215,e)),this.veilSprite.texture.fillColor(this._color,this._opacity),BFN.MainUI.requestRender())},get:function(){return this._color}}),BFN.WindowedVeil=Xy,Wy.prototype=Object.create(PIXI.Sprite.prototype),Wy.prototype.init=function(){BeFunky.log("EyeDropper Init"),this.initDefaultValues(),this.initHitSurface(),this.initEyeDropper(),this.initEyeDropperMask(),this.initEyeDropperOutline(),this.initAnimator()},Wy.prototype.initDefaultValues=function(){this.interactive=!0,this.sourceTexture=null,this.showing=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},Wy.prototype.initHitSurface=function(){this.hitSurface=new PIXI.Graphics,this.hitSurface.beginFill(0,0),this.hitSurface.drawRect(0,0,100,100),this.hitSurface.endFill(),this.addChild(this.hitSurface)},Wy.prototype.initEyeDropper=function(){this.pixelSize=16,this.pixelRows=5,this.pixelCols=5,this.pixelThresholdX=Math.floor(this.pixelCols/2),this.pixelThresholdY=Math.floor(this.pixelRows/2),this.eyeDropperW=this.pixelSize*this.pixelCols,this.eyeDropperH=this.pixelSize*this.pixelRows,this.positionChanged=!1,this.offsetPoint=new PIXI.Point,this.eyeDropperContainer=new PIXI.Container,this.addChild(this.eyeDropperContainer),this.eyeDropperTexture=PIXI.RenderTexture.create(this.pixelCols,this.pixelRows,PIXI.SCALE_MODES.NEAREST),this.eyeDropperSprite=new PIXI.Sprite(this.eyeDropperTexture),this.eyeDropperSprite.anchor.x=this.eyeDropperSprite.anchor.y=.5,this.eyeDropperSprite.scale.x=this.eyeDropperSprite.scale.y=this.pixelSize,this.eyeDropperContainer.addChild(this.eyeDropperSprite),this.selectionSquare=new PIXI.Graphics,this.selectionSquare.lineStyle(3,0,.5),this.selectionSquare.drawRect(-this.pixelSize/2,-this.pixelSize/2,this.pixelSize,this.pixelSize),this.selectionSquare.lineStyle(2,16777215,1),this.selectionSquare.drawRect(-this.pixelSize/2,-this.pixelSize/2,this.pixelSize,this.pixelSize),this.eyeDropperContainer.addChild(this.selectionSquare)},Wy.prototype.initEyeDropperMask=function(){this.maskTexture=PIXI.RenderTexture.create(this.eyeDropperW,this.eyeDropperH,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.maskTexture,{strokeWidth:0,strokeColor:0,fillColor:4294967295,cornerRadius:Math.min(this.eyeDropperW,this.eyeDropperH)/2,paddingX:4,paddingY:4,clear:!0}),this.maskSprite=new PIXI.Sprite(this.maskTexture),this.maskSprite.anchor.x=this.maskSprite.anchor.y=.5,this.eyeDropperContainer.addChild(this.maskSprite),this.eyeDropperSprite.mask=this.maskSprite},Wy.prototype.initEyeDropperOutline=function(){this.outlineTexture=PIXI.RenderTexture.create(this.eyeDropperW,this.eyeDropperH,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.outlineTexture,{strokeWidth:4,strokeColor:2147483648,fillColor:0,cornerRadius:Math.min(this.eyeDropperW,this.eyeDropperH)/2,paddingX:2,paddingY:2,clear:!0}),BFN.graphics.drawShape("roundedRect",this.outlineTexture,{strokeWidth:2,strokeColor:4294967295,fillColor:0,cornerRadius:Math.min(this.eyeDropperW,this.eyeDropperH)/2,paddingX:3,paddingY:3,clear:!1}),this.outlineSprite=new PIXI.Sprite(this.outlineTexture),this.outlineSprite.anchor.x=this.outlineSprite.anchor.y=.5,this.eyeDropperContainer.addChild(this.outlineSprite)},Wy.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.linearSteps=10,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.animator.setAnimatorFactor(0)},Wy.prototype.activate=function(e,t,n){this.reset(),BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.sourceTexture=e,this.eyeDropperContainer.x=t,this.eyeDropperContainer.y=n,this.positionChanged=!0,BFN.MainUI.requestRender(),this.updateHitSurface()},Wy.prototype.update=function(e,t){this.showing||(this.showing=!0,this.animator.increase()),this.eyeDropperContainer.x=e,this.eyeDropperContainer.y=t,this.positionChanged=!0,BFN.MainUI.requestRender()},Wy.prototype.deactivate=function(){this.handleMainUIPreRender(),this.animator.setAnimatorFactor(1),this.animator.decrease(),this.reset()},Wy.prototype.reset=function(){BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.showing=!1;try{this.sourceTexture.destroyGC(!0)}catch(e){}this.sourceTexture=null},Wy.prototype.updateHitSurface=function(){this.hitSurface.width=BFN.StageModel.stageW,this.hitSurface.height=BFN.StageModel.stageH},Wy.prototype.handleMainUIPreRender=function(e){if(this.positionChanged){this.positionChanged=!1;var t=this.eyeDropperSprite.x<=this.pixelThresholdX||this.eyeDropperSprite.x>=this.sourceTexture.width-this.pixelThresholdX||this.eyeDropperSprite.y<=this.pixelThresholdY||this.eyeDropperSprite.y>=this.sourceTexture.height-this.pixelThresholdY;t&&this.eyeDropperTexture.fillColor(mn().hex),this.offsetPoint.x=this.pixelThresholdX-this.eyeDropperContainer.x,this.offsetPoint.y=this.pixelThresholdY-this.eyeDropperContainer.y,this.eyeDropperTexture.copyPixels(this.sourceTexture,this.offsetPoint,!t)}},Wy.prototype.handleAnimatorUpdate=function(e){this.visible=this.animator.animationFactor>0,this.eyeDropperContainer.alpha=this.animator.animationFactor,this.eyeDropperContainer.scale.x=this.eyeDropperContainer.scale.y=1.2-.2*this.animator.animationFactor},Object.defineProperty(BFN,"EyeDropper",{get:function(){return BFN._EyeDropper||(BFN._EyeDropper=new Wy,BFN.MainUI.eyeDropperContainer.addChild(BFN._EyeDropper)),BFN._EyeDropper}}),Yy.prototype=Object.create(PIXI.Sprite.prototype),Yy.prototype.init=function(){BeFunky.log("BrushCircle Init"),this.initDefaultValues(),this.initBrushGraphic(),this.initBrushSprite(),this.initAnimator()},Yy.prototype.initDefaultValues=function(){this.visible=!1,this.showing=!1,this._radius=0,this._targetEnabled=!1,this._locked=!1,this.strokeWidth=2,this.strokeShadowWidth=.5,this.handleMouseMoveBind=this.handleMouseMove.bind(this)},Yy.prototype.initBrushGraphic=function(){this.brushGraphic=new PIXI.Graphics,this.brushGraphic.boundsPadding=2},Yy.prototype.initBrushSprite=function(){this.brushSpriteTexture=PIXI.RenderTexture.create(32,32,PIXI.settings.SCALE_MODE,window.bfn_resolution),this.brushSprite=new PIXI.Sprite(this.brushSpriteTexture),this.brushSprite.anchor.x=this.brushSprite.anchor.y=.5,this.addChild(this.brushSprite)},Yy.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.animator.setAnimatorFactor(0)},Yy.prototype.show=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._locked=this._locked||n,document.body.setStyles({cursor:"none"}),this.showing=!0,BFN.MainUI.on("pointermove",this.handleMouseMoveBind),null!=e&&this._radius!=Math.max(1,Math.round(e))&&(this._radius=Math.max(1,Math.round(e)),this.updateCircle()),this.animator.increase(),this.updatePosition(t)},Yy.prototype.hide=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._locked=!e&&this._locked,this._locked||(document.body.setStyles({cursor:"auto"}),this.showing=!1,BFN.MainUI.off("pointermove",this.handleMouseMoveBind),this.animator.decrease())},Yy.prototype.updateCircle=function(){var e=Math.round(2*(this._radius+this.strokeWidth/2+this.strokeShadowWidth));if(this.brushSprite.texture.resize(e,e),BFN.graphics.drawShape("ellipse",this.brushSprite.texture,{strokeWidth:this.strokeWidth+2*this.strokeShadowWidth,strokeColor:2147483648}),this._targetEnabled){var t=this.strokeWidth+2*this.strokeShadowWidth,n=e/2-this.strokeWidth/2-this.strokeShadowWidth-1;BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:2147483648,paddingX:t,paddingY:n,clear:!1}),BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:2147483648,paddingX:n,paddingY:t,clear:!1})}if(BFN.graphics.drawShape("ellipse",this.brushSprite.texture,{strokeWidth:this.strokeWidth,strokeColor:4294967295,paddingX:this.strokeShadowWidth,paddingY:this.strokeShadowWidth,clear:!1}),this._targetEnabled){var i=this.strokeWidth+this.strokeShadowWidth,r=e/2-this.strokeWidth/2-1;BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:4294967295,paddingX:i,paddingY:r,clear:!1}),BFN.graphics.drawShape("roundedRect",this.brushSprite.texture,{fillColor:4294967295,paddingX:r,paddingY:i,clear:!1})}BFN.MainUI.requestRender()},Yy.prototype.updatePosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e?e.data.getLocalPosition(BFN.MainUI):BFN.MainUI.getMousePosition();this.x=t.x,this.y=t.y,BFN.MainUI.requestRender()},Yy.prototype.handleMouseMove=function(e){this.updatePosition(e)},Yy.prototype.handleAnimatorUpdate=function(e){this.alpha=this.animator.animationFactor,this.visible=this.alpha>0},Object.defineProperty(Yy.prototype,"targetEnabled",{set:function(e){this._targetEnabled!=e&&(this._targetEnabled=e,this.updateCircle())},get:function(){return this._targetEnabled}}),Object.defineProperty(Yy.prototype,"radius",{set:function(e){var t=Math.max(1,Math.round(e));this._radius!=t&&(this._radius=Math.round(t),this.updateCircle())},get:function(){return this._radius}}),BFN.SingletonQueue.add(function(){BFN.BrushCircle=new Yy}),qy.prototype=Object.create(PIXI.Sprite.prototype),qy.prototype.init=function(){BeFunky.log("BrushCirclePreview Init"),this.initDefaultValues(),this.initAnimator()},qy.prototype.initDefaultValues=function(){this._radius=0,this.strokeWidth=2,this.strokeShadowWidth=.5,this.texture=PIXI.RenderTexture.create(32,32,PIXI.settings.SCALE_MODE,window.bfn_resolution),this.texture.clear(),this.anchor.x=this.anchor.y=.5},qy.prototype.initAnimator=function(){this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdate.bind(this)),this.animator.setAnimatorFactor(0)},qy.prototype.show=function(e){if(this.visible||(this.x=BFN.StageModel.stageW/2,this.y=BFN.StageModel.stageH/2,this.animator.increase()),this._radius!=Math.max(1,Math.round(e))){this._radius=Math.max(1,Math.round(e));var t=Math.round(2*(this._radius+this.strokeWidth/2+this.strokeShadowWidth));this.texture.resize(t,t),BFN.graphics.drawShape("ellipse",this.texture,{strokeWidth:this.strokeWidth+2*this.strokeShadowWidth,strokeColor:2147483648}),BFN.graphics.drawShape("ellipse",this.texture,{strokeWidth:this.strokeWidth,strokeColor:4294967295,clear:!1,paddingX:this.strokeShadowWidth,paddingY:this.strokeShadowWidth}),BFN.MainUI.requestRender()}},qy.prototype.hide=function(){this.animator.decrease()},qy.prototype.handleAnimatorUpdate=function(e){this.alpha=this.animator.animationFactor,this.visible=this.alpha>0},BFN.SingletonQueue.add(function(){BFN.BrushCirclePreview=new qy}),Ky.prototype=Object.create(PIXI.Sprite.prototype),Ky.prototype.init=function(){BeFunky.log("StrokeLine Init"),this.initDefaultValues(),this.initLineSprite()},Ky.prototype.initDefaultValues=function(){this._scale=1,this._adjustScaleX=1,this._adjustScaleY=1,this._length=1,this._highlight=!1,this.smoothPaddingAmount=10},Ky.prototype.initLineSprite=function(){this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures||(BFN.uniqueStrokeLineTextures={})),this.uniqueTextureID&&BFN.uniqueStrokeLineTextures.hasOwnProperty(this.uniqueTextureID)&&(this.strokeLineTexture=BFN.uniqueStrokeLineTextures[this.uniqueTextureID]),this.strokeLineTexture||(this.dashed?(this.strokeLineTexture=PIXI.RenderTexture.create(8,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0),this.isLinear?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.strokeLineTexture,{fillColor:this.darkerColor,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0,clear:!0,paddingR:4}),BFN.graphics.drawShape("roundedRect",this.strokeLineTexture,{fillColor:this.lighterColor,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0,clear:!1,paddingL:4})):(this.strokeLineTexture=PIXI.RenderTexture.create(8,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0),this.isLinear?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.strokeLineTexture,{fillColor:this.lighterColor,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0})),this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures[this.uniqueTextureID]=this.strokeLineTexture)),this.strokeLine=new PIXI.extras.TilingSprite(this.strokeLineTexture,2,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0)),this.strokeLine.anchor.y=.5,this.strokeLine.y=-.001,this.addChild(this.strokeLine)},Ky.prototype.convertToMasked=function(){this.isMasked||(this.isMasked=!0,this.strokeLineMask=new PIXI.Graphics,this.strokeLine.mask=this.strokeLineMask,this.addChild(this.strokeLineMask),this.strokeLineMaskH=2*Math.ceil(this.strokeLineTexture.height/2))},Ky.prototype.showMaskedLines=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isMasked&&(this.maskedSegmentsClear||(this.strokeLineMask.clear(),this.maskedSegmentsClear=!0),t?(this.strokeLine.mask=this.strokeLineMask,t.forEach(function(t){e.maskedSegmentsClear&&(e.maskedSegmentsClear=!1);var n=t.start,i=t.end;n<i&&(e.strokeLineMask.beginFill(16777215),e.strokeLineMask.drawRect(n,-e.strokeLineMaskH/2,i-n,e.strokeLineMaskH),e.strokeLineMask.endFill())})):this.strokeLine.mask=null)},Ky.prototype.convertToRuler=function(){this.isRuler||(this.isRuler=!0,this.isRulerClear=!0,this.uniqueTextureID&&BFN.uniqueStrokeLineTextures.hasOwnProperty(this.uniqueTextureID+"_ruler")&&(this.rulerTexture=BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_ruler"]),this.rulerTexture||(this.rulerTexture=PIXI.RenderTexture.create(8,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0),this.isLinear?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST),BFN.graphics.drawShape("roundedRect",this.rulerTexture,{fillColor:4294902015,edgePadding:0,paddingY:this.smoothPadding?this.smoothPaddingAmount/2:0,cornerRadius:0}),this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_ruler"]=this.rulerTexture)),this.rulerLine=new PIXI.extras.TilingSprite(this.rulerTexture,2,this.lineThickness+(this.smoothPadding?this.smoothPaddingAmount:0)),this.rulerLine.anchor.y=.5,this.addChild(this.rulerLine),this.rulerMask=new PIXI.Graphics,this.rulerLine.mask=this.rulerMask,this.addChild(this.rulerMask),this.rulerMaskH=2*Math.ceil(this.rulerTexture.height/2))},Ky.prototype.showRulers=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isRuler&&(this.isRulerClear||(this.rulerMask.clear(),this.isRulerClear=!0),t&&t.forEach(function(t){if(t&&t.hasOwnProperty("start")&&t.hasOwnProperty("end")){e.isRulerClear&&(e.isRulerClear=!1);var n=t.start,i=t.end;n<i&&(e.rulerMask.beginFill(16777215),e.rulerMask.drawRect(n,-e.rulerMaskH/2,i-n,e.rulerMaskH),e.rulerMask.endFill())}}))},Ky.prototype.setAdjustScales=function(e,t){this._adjustScaleX="number"==typeof e?e:this._adjustScaleX,this._adjustScaleY="number"==typeof t?t:this._adjustScaleY},Ky.prototype.getStrokeLineHighlightTexture=function(){if(!this.strokeLineHighlightTexture)if(this.uniqueTextureID&&BFN.uniqueStrokeLineTextures.hasOwnProperty(this.uniqueTextureID+"_highlight"))this.strokeLineHighlightTexture=BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_highlight"];else{var e=BFN.ColorUtil.rgbaObjectToHexStringObject(BFN.ColorUtil.hexNumberToRGBAObject(this.lighterColor));this.strokeLineHighlightTexture=PIXI.RenderTexture.create(this.strokeLineTexture.width,Math.max(this.strokeLineTexture.height,this.lineThickness+6));var t=(this.strokeLineHighlightTexture.height-this.lineThickness)/2-3;this.strokeLineHighlightTexture.clear();for(var n=0;n<3;n++)this.strokeLineHighlightTexture.fillColorOverlap(parseInt("0x"+e.hex),Math.max(0,Math.min(1,e.alpha*(.05+.075*n))),0,t+n,this.strokeLineHighlightTexture.width,this.lineThickness+2*(3-n));this.strokeLineHighlightTexture.copyPixels(this.strokeLineTexture,{x:0,y:(this.strokeLineHighlightTexture.height-this.strokeLineTexture.height)/2},!1),this.uniqueTextureID&&(BFN.uniqueStrokeLineTextures[this.uniqueTextureID+"_highlight"]=this.strokeLineHighlightTexture)}return this.strokeLineHighlightTexture},Object.defineProperty(Ky.prototype,"length",{set:function(e){this._length=e,this.strokeLine.width=this._length*this._scale*this._adjustScaleX,this.isRuler&&(this.strokeLine.width=this.strokeLine.width);try{BFN.MainUI.requestRender()}catch(e){}},get:function(){return this.strokeLine.width}}),Object.defineProperty(Ky.prototype,"scale",{set:function(e){this._scale=e,this.strokeLine.width=this._length*this._scale*this._adjustScaleX,this.strokeLine.scale.x=1/(this._scale*this._adjustScaleX),this.strokeLine.scale.y=1/(this._scale*this._adjustScaleY),this.isMasked&&(this.strokeLineMask.scale.x=this.strokeLine.scale.x,this.strokeLineMask.scale.y=this.strokeLine.scale.y),this.isRuler&&(this.rulerLine.width=this.strokeLine.width,this.rulerLine.scale.x=this.strokeLine.scale.x,this.rulerLine.scale.y=this.strokeLine.scale.y,this.rulerMask.scale.x=this.strokeLine.scale.x,this.rulerMask.scale.y=this.strokeLine.scale.y);try{BFN.MainUI.requestRender()}catch(e){}},get:function(){return this._scale}}),Object.defineProperty(Ky.prototype,"highlight",{set:function(e){if(this._highlight!=!!e){this._highlight=!!e,this._highlight?this.strokeLine.texture=this.getStrokeLineHighlightTexture():this.strokeLine.texture!=this.strokeLineTexture&&(this.strokeLine.texture=this.strokeLineTexture);try{BFN.MainUI.requestRender()}catch(e){}}},get:function(){return this._highlight}}),BFN.StrokeLine=Ky,Qy.prototype=Object.create(PIXI.Sprite.prototype),Qy.prototype.init=function(){BeFunky.log("StrokeRectangle Init"),this.initDefaultValues(),this.initStrokeLines(),this.updateDisplay()},Qy.prototype.initDefaultValues=function(){this._width=100,this._height=100,this._scale=1,this._adjustScaleX=1,this._adjustScaleY=1,this._invertScales=!1,this._highlight=!1},Qy.prototype.initStrokeLines=function(){this.strokeLineTop=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineTop.rotation=0*Math.PI,this.addChild(this.strokeLineTop),this.strokeLineRight=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineRight.rotation=.5*Math.PI,this.addChild(this.strokeLineRight),this.strokeLineBottom=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineBottom.rotation=1*Math.PI,this.addChild(this.strokeLineBottom),this.strokeLineLeft=new BFN.StrokeLine(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID),this.strokeLineLeft.rotation=1.5*Math.PI,this.addChild(this.strokeLineLeft)},Qy.prototype.setDimensions=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._width=Math.abs(e),this._height=Math.abs(t),this.setScales(n,i,r,!1),this.updateDisplay()},Qy.prototype.setScales=function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._scale="number"==typeof e?e:this._scale,this._adjustScaleX="number"==typeof t?t:this._adjustScaleX,this._adjustScaleY="number"==typeof n?n:this._adjustScaleY;var r=this._invertScales?this._adjustScaleY:this._adjustScaleX,a=this._invertScales?this._adjustScaleX:this._adjustScaleY;this.strokeLineTop.setAdjustScales(r,a),this.strokeLineTop.scale=this._scale,this.strokeLineRight.setAdjustScales(a,r),this.strokeLineRight.scale=this._scale,this.strokeLineBottom.setAdjustScales(r,a),this.strokeLineBottom.scale=this._scale,this.strokeLineLeft.setAdjustScales(a,r),this.strokeLineLeft.scale=this._scale,i&&this.updateDisplay()},Qy.prototype.updateDisplay=function(){this.strokeLineTop.x=-this._width/2,this.strokeLineTop.y=-this._height/2,this.strokeLineTop.length=this._width,this.strokeLineRight.x=this._width/2,this.strokeLineRight.y=-this._height/2,this.strokeLineRight.length=this._height,this.strokeLineBottom.x=this._width/2,this.strokeLineBottom.y=this._height/2,this.strokeLineBottom.length=this._width,this.strokeLineLeft.x=-this._width/2,this.strokeLineLeft.y=this._height/2,this.strokeLineLeft.length=this._height},Object.defineProperty(Qy.prototype,"scale",{set:function(e){this.setScales(e)},get:function(){return this._scale}}),Object.defineProperty(Qy.prototype,"invertScales",{set:function(e){this._invertScales=!!e},get:function(){return this._invertScales}}),Object.defineProperty(Qy.prototype,"width",{get:function(){return this._width}}),Object.defineProperty(Qy.prototype,"height",{get:function(){return this._height}}),Object.defineProperty(Qy.prototype,"highlight",{set:function(e){this._highlight!=!!e&&(this._highlight=!!e,this.strokeLineLeft.highlight=this._highlight,this.strokeLineRight.highlight=this._highlight,this.strokeLineTop.highlight=this._highlight,this.strokeLineBottom.highlight=this._highlight)},get:function(){return this._highlight}}),BFN.StrokeRectangle=Qy,Zy.prototype=Object.create(PIXI.Container.prototype),Zy.prototype.init=function(){BeFunky.log("StrokeRectanglePool Init"),this.initDefaultValues()},Zy.prototype.initDefaultValues=function(){this.interactive=!1,this.strokeRectangles=[],this.strokeRectangleIndex=0,this._scale=1,this._adjustScaleX=1,this._adjustScaleY=1},Zy.prototype.add=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:128,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this.strokeRectangleIndex>=this.strokeRectangles.length?this.createStrokeRectangle():this.strokeRectangles[this.strokeRectangleIndex];return o.invertScales=a,this.setTransform(o,e,t,n,i,r),this.addChild(o),this.strokeRectangleIndex++,BFN.MainUI.requestRender(),o},Zy.prototype.setTransform=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:128,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(e){var o=Math.sqrt(Math.pow(i,2)+Math.pow(r,2)),s=Math.atan2(r,i);e.x=t+Math.cos(a+s)*(o/2),e.y=n+Math.sin(a+s)*(o/2),e.setDimensions(i,r,this._scale,this._adjustScaleX,this._adjustScaleY),e.rotation=a}},Zy.prototype.clear=function(){for(this.strokeRectangleIndex=0;this.children.length;)this.removeChild(this.children[0]);BFN.MainUI.requestRender()},Zy.prototype.setScales=function(e,t,n){var i=this;this._scale="number"==typeof e?e:this._scale,this._adjustScaleX="number"==typeof t?t:this._adjustScaleX,this._adjustScaleY="number"==typeof n?n:this._adjustScaleY,this.children.forEach(function(e){e.setScales(i._scale,i._adjustScaleX,i._adjustScaleY)})},Zy.prototype.createStrokeRectangle=function(){var e=new BFN.StrokeRectangle(this.dashed,this.smoothPadding,this.lineThickness,this.isLinear,this.lighterColor,this.darkerColor,this.uniqueTextureID);return this.strokeRectangles.push(e),e},Object.defineProperty(Zy.prototype,"poolScale",{set:function(e){this.setScales(e)},get:function(){return this._scale}}),BFN.StrokeRectanglePool=Zy,Jy.prototype=Object.create(PIXI.Sprite.prototype),Jy.prototype.init=function(){BeFunky.log("CropGrid Init"),this.initDefaultValues(),this.initOutline(),this.initGridLines(),this.updateDisplay(),this.outlineFilter=new BFN.filters.OutlineFilter(1,0),this.filters=[this.outlineFilter]},Jy.prototype.initDefaultValues=function(){this._width=100,this._height=100,this._scale=1},Jy.prototype.initOutline=function(){this.outline=new BFN.StrokeRectangle,this.addChild(this.outline)},Jy.prototype.initGridLines=function(){this.gridLineTop=new BFN.StrokeLine,this.gridLineTop.rotation=0*Math.PI,this.addChild(this.gridLineTop),this.gridLineRight=new BFN.StrokeLine,this.gridLineRight.rotation=.5*Math.PI,this.addChild(this.gridLineRight),this.gridLineBottom=new BFN.StrokeLine,this.gridLineBottom.rotation=1*Math.PI,this.addChild(this.gridLineBottom),this.gridLineLeft=new BFN.StrokeLine,this.gridLineLeft.rotation=1.5*Math.PI,this.addChild(this.gridLineLeft)},Jy.prototype.setDimensions=function(e,t){this._width=Math.abs(e),this._height=Math.abs(t),this.updateDisplay()},Jy.prototype.updateDisplay=function(){this.outline.setDimensions(this._width,this._height),this.gridLineTop.x=-this._width/2,this.gridLineTop.y=-this._height/6,this.gridLineTop.length=this._width,this.gridLineRight.x=this._width/6,this.gridLineRight.y=-this._height/2,this.gridLineRight.length=this._height,this.gridLineBottom.x=this._width/2,this.gridLineBottom.y=this._height/6,this.gridLineBottom.length=this._width,this.gridLineLeft.x=-this._width/6,this.gridLineLeft.y=this._height/2,this.gridLineLeft.length=this._height},Object.defineProperty(Jy.prototype,"scale",{set:function(e){this._scale=e,this.outline.scale=this._scale,this.gridLineTop.scale=this._scale,this.gridLineRight.scale=this._scale,this.gridLineBottom.scale=this._scale,this.gridLineLeft.scale=this._scale,this.updateDisplay(),BFN.MainUI.requestRender()},get:function(){return this._scale}}),BFN.CropGrid=Jy,$y.prototype=Object.create(PIXI.Container.prototype),$y.prototype.init=function(){BeFunky.log("CheckerPanel Init"),this.initDefaultValues(),this.initCheckerTexture(),this.initCheckerSprite()},$y.prototype.initDefaultValues=function(){this.interactive=!1,this.checkerSize=8,this.checkerColorA=14474460,this.checkerColorB=16777215,this._centered=!0,this._width=20,this._height=20,this._scale=1},$y.prototype.initCheckerTexture=function(){this.checkerTexture=PIXI.RenderTexture.create(2*this.checkerSize,2*this.checkerSize),this.checkerTexture.fillRect(0,0,2*this.checkerSize,2*this.checkerSize,this.checkerColorA,1),this.checkerTexture.fillRect(0,0,this.checkerSize,this.checkerSize,this.checkerColorB,1),this.checkerTexture.fillRect(this.checkerSize,this.checkerSize,this.checkerSize,this.checkerSize,this.checkerColorB,1),this.checkerTexture.setScaleMode(PIXI.SCALE_MODES.NEAREST)},$y.prototype.initCheckerSprite=function(){this.checkerSprite=new PIXI.extras.TilingSprite(this.checkerTexture,2*this.checkerSize,2*this.checkerSize),this.checkerSprite.interactive=!1,this.addChild(this.checkerSprite)},$y.prototype.setDimensions=function(e,t){this._width=Math.abs(e),this._height=Math.abs(t),this.updateDisplay()},$y.prototype.updateDisplay=function(){this.checkerSprite.anchor.x=this.checkerSprite.anchor.y=this._centered?.5:0,this.checkerSprite.scale.x=this.checkerSprite.scale.y=1/this._scale,this.checkerSprite.width=Math.max(0,this._width/this.checkerSprite.scale.x-1),this.checkerSprite.height=Math.max(0,this._height/this.checkerSprite.scale.y-1);try{BFN.MainUI.requestRender()}catch(e){}},Object.defineProperty($y.prototype,"centered",{set:function(e){this._centered=e,this.updateDisplay()},get:function(){return this._centered}}),Object.defineProperty($y.prototype,"width",{set:function(e){this._width=Math.abs(e),this.updateDisplay()},get:function(){return this._width}}),Object.defineProperty($y.prototype,"height",{set:function(e){this._height=Math.abs(e),this.updateDisplay()},get:function(){return this._height}}),Object.defineProperty($y.prototype,"scale",{set:function(e){this._scale=e,this.updateDisplay()},get:function(){return this._scale}}),BFN.CheckerPanel=$y,ex.prototype=Object.create(PIXI.Sprite.prototype),ex.prototype.init=function(){BeFunky.log("BlendModeSprite Init"),this.initDefaultValues(),this.initSourceSprite(),this.initBlendFilters(),BFN.AppModel.appReady?(BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)),this.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)),this.setBlendMode(BFN.CONST.BLEND_MODES.NORMAL)}.bind(this))},ex.prototype.initDefaultValues=function(){this._intensity=1,this.texture=null,this.renderPending=!1},ex.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite},ex.prototype.initBlendFilters=function(){for(var e in this.blendFilters={},BFN.CONST.BLEND_MODES)this.blendFilters[BFN.CONST.BLEND_MODES[e]]=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES[e])},ex.prototype.setBlendMode=function(e){this.blendFilters.hasOwnProperty(e)?this.sourceSprite.filters=[this.blendFilters[e]]:this.sourceSprite.filters=[],this.updateDisplay()},ex.prototype.setBaseTexture=function(e){null!=this.texture&&(this.texture.destroyGC(!0),this.texture=null),e&&(this.sourceSprite.texture=e,this.texture=PIXI.RenderTexture.create(this.sourceSprite.texture.width,this.sourceSprite.texture.height),this.updateDisplay())},ex.prototype.setBlendIntensity=function(e){for(var t in e=Math.min(1,Math.max(0,e)),this.blendFilters)this.blendFilters[t].intensity=e;this.updateDisplay()},ex.prototype.setBlendTexture=function(e){if(e){for(var t in this.blendFilters)this.blendFilters[t].iChannel1=e;this.updateDisplay()}},ex.prototype.updateDisplay=function(){this.autoRender&&(this.renderPending=!0,BFN.MainUI.requestRender())},ex.prototype.renderDisplay=function(){BFN.Stage.render(this.sourceSprite,this.texture)},ex.prototype.handleMainUIPreRender=function(){this.renderPending&&(this.renderPending=!1,this.texture&&this.renderDisplay())},Object.defineProperty(ex.prototype,"intensity",{set:function(e){this._intensity=Math.max(0,Math.min(1,e))},get:function(){return this._intensity}}),BFN.BlendModeSprite=ex,tx.prototype=Object.create(PIXI.Sprite.prototype),tx.prototype.init=function(){BeFunky.log("MaskBlendSprite Init"),this.initDefaultValues()},tx.prototype.initDefaultValues=function(){this.maskBlendTexture=null,this.displayUpdatePending=!1,this.renderPending=!1,this.sourceSprite=new PIXI.Sprite,this.maskBlendFilter=new BFN.filters.MaskBlendFilter,BFN.AppModel.appReady?BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this))}.bind(this))},tx.prototype.updateDisplay=function(){this.displayUpdatePending=!0,this.autoRender&&this.maskBlendTexture&&!this.renderPending&&(this.displayUpdatePending=!1,this.renderPending=!0,BFN.MainUI.requestRender())},tx.prototype.renderDisplay=function(){this.maskBlendTexture&&BFN.Stage.render(this.sourceSprite,this.texture)},tx.prototype.reset=function(){this.displayUpdatePending=!1,this.inverse=!1,this.blendColor=null,this.blendIntensity=1,this.inputTexture=null,this.blendTexture=null,this.maskTexture=null},tx.prototype.handleMainUIPreRender=function(){this.renderPending&&(this.renderPending=!1,this.renderDisplay())},Object.defineProperty(tx.prototype,"autoRender",{set:function(e){this._autoRender=e,this._autoRender&&this.displayUpdatePending&&this.updateDisplay()},get:function(){return this._autoRender}}),Object.defineProperty(tx.prototype,"inverse",{set:function(e){e!=this.maskBlendFilter.inverse&&(this.maskBlendFilter.inverse=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.inverse}}),Object.defineProperty(tx.prototype,"unmaskedAlpha",{set:function(e){e!=this.maskBlendFilter.unmaskedAlpha&&(this.maskBlendFilter.unmaskedAlpha=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.unmaskedAlpha}}),Object.defineProperty(tx.prototype,"blendColor",{set:function(e){e!=this.maskBlendFilter.blendColor&&(this.maskBlendFilter.blendColor=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.blendColor}}),Object.defineProperty(tx.prototype,"blendIntensity",{set:function(e){e!=this.maskBlendFilter.blendIntensity&&(this.maskBlendFilter.blendIntensity=e,this.updateDisplay())},get:function(){return this.maskBlendFilter.blendIntensity}}),Object.defineProperty(tx.prototype,"inputTexture",{set:function(e){if(null!==this.maskBlendTexture){try{this.maskBlendTexture.destroyGC(!0)}catch(e){}this.maskBlendTexture=null,this.texture=PIXI.Texture.EMPTY}e?(this.sourceSprite.texture=e,this.sourceSprite.filters=[this.maskBlendFilter],this.maskBlendTexture=PIXI.RenderTexture.create(this.sourceSprite.texture.width,this.sourceSprite.texture.height),this.texture=this.maskBlendTexture,this.updateDisplay()):(this.sourceSprite.texture=PIXI.Texture.EMPTY,this.sourceSprite.filters=[])},get:function(){return this.sourceSprite.texture}}),Object.defineProperty(tx.prototype,"blendTexture",{set:function(e){this.maskBlendFilter.blendTexture=e,this.updateDisplay()},get:function(){return this.maskBlendFilter.blendTexture}}),Object.defineProperty(tx.prototype,"maskTexture",{set:function(e){this.maskBlendFilter.maskTexture=e,this.updateDisplay()},get:function(){return this.maskBlendFilter.maskTexture}}),Object.defineProperty(tx.prototype,"useInputAlpha",{set:function(e){this.maskBlendFilter.useInputAlpha=e,this.updateDisplay()},get:function(){return this.maskBlendFilter.useInputAlpha}}),BFN.MaskBlendSprite=tx,nx.prototype=Object.create(PIXI.Sprite.prototype),nx.prototype.init=function(){BeFunky.log("FrameSprite Init"),this.initDefaultValues()},nx.prototype.initDefaultValues=function(){this.frameSprite=this,this.rotateValues=[0,2,4,6,8,10,12,14],this._frameWidth=100,this._frameHeight=100,this._framePadding=0,this._offsetFactorX=.5,this._offsetFactorY=.5,this._textureScale=1,this._textureScaleX=1,this._textureScaleY=1,this._isEmpty=!0,this._imageRect=new PIXI.Rectangle,this.textureFrame=new PIXI.Rectangle,this.adjustScale=1,this.excessX=0,this.excessY=0,this.frameScaling=!1,this.frameStretching=!1,this.frameAnchorSide=null,this.frameAnchorPoint=new PIXI.Point,this.updateDisplayCallback=null},nx.prototype.setTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.texture=e,this.baseTexture=this.texture&&this.texture.baseTexture?this.texture.baseTexture:null,this.updateValues()},nx.prototype.updateValues=function(){this.textureFrame=new PIXI.Rectangle,this.baseWidth=this.texture.baseTexture.width,this.baseHeight=this.texture.baseTexture.height},nx.prototype.startFrameScaling=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(["l","tl","t","tr","r","br","b","bl"].includes(e)){this.frameScalingCentered&&!t&&this.stopFrameScaling(),this.frameScaling=!0,this.frameScalingCentered=t,this.frameAnchorSide=e;var n=this._frameWidth,i=this._frameHeight,r=Math.max(n/this.baseWidth,i/this.baseHeight),a=r*this._textureScaleX,o=r*this._textureScaleY,s=this.baseWidth*a,l=this.baseHeight*o,u=l-i,c=(s-n)*this._offsetFactorX,h=u*this._offsetFactorY;switch(this.initialRealDimensions=new PIXI.Point(s,l),this.initialFrameCenter=new PIXI.Point((c+n/2)/this.initialRealDimensions.x*this.baseWidth,(h+i/2)/this.initialRealDimensions.y*this.baseHeight),this.frameAnchorSide){case"l":this.frameAnchorPoint.x=c,this.frameAnchorPoint.y=h+i/2;break;case"tl":this.frameAnchorPoint.x=c,this.frameAnchorPoint.y=h;break;case"t":this.frameAnchorPoint.x=c+n/2,this.frameAnchorPoint.y=h;break;case"tr":this.frameAnchorPoint.x=c+n,this.frameAnchorPoint.y=h;break;case"r":this.frameAnchorPoint.x=c+n,this.frameAnchorPoint.y=h+i/2;break;case"br":this.frameAnchorPoint.x=c+n,this.frameAnchorPoint.y=h+i;break;case"b":this.frameAnchorPoint.x=c+n/2,this.frameAnchorPoint.y=h+i;break;case"bl":this.frameAnchorPoint.x=c,this.frameAnchorPoint.y=h+i}}else this.stopFrameScaling()},nx.prototype.stopFrameScaling=function(){this.frameAnchorSide=null,this.frameScaling&&(this.frameScaling=!1),this.frameScalingCentered&&(this.frameScalingCentered=!1)},nx.prototype.startFrameStretching=function(){this.frameStretching&&this.stopFrameStretching(),this.frameStretching=!0},nx.prototype.stopFrameStretching=function(){this.frameStretching=!1},nx.prototype.modifyFrameBorders=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Math.max(0,this.textureFrame.x-e),i=Math.max(0,this.textureFrame.y-e),r=Math.max(n+1,Math.min(this.baseWidth,this.textureFrame.x+this.textureFrame.width+e)),a=Math.max(n+1,Math.min(this.baseHeight,this.textureFrame.y+this.textureFrame.height+e)),o=Math.max(1,r-n),s=Math.max(1,a-i),l=Math.max(o/this.baseWidth,s/this.baseHeight),u=this.baseWidth*l,c=this.baseHeight*l;this.textureScaleX=this.baseWidth/u,this.textureScaleY=this.baseHeight/c,this.offsetFactorX=this.baseWidth==o?.5:n/(this.baseWidth-o),this.offsetFactorY=this.baseHeight==s?.5:i/(this.baseHeight-s),t&&this.updateDisplay()},nx.prototype.conformOffsetFactors=function(){if(this.texture.valid)try{var e=PIXI.GroupD8.isVertical(this.texture.rotate),t=e?this._frameHeight:this._frameWidth,n=e?this._frameWidth:this._frameHeight,i=Math.min(this.baseWidth/t,this.baseHeight/n),r=i/this._textureScaleX,a=i/this._textureScaleY,o=t*r,s=n*a,l=this.textureFrame.x+this.textureFrame.width/2,u=this.textureFrame.y+this.textureFrame.height/2,c=l-o/2,h=u-s/2,d=Math.max(0,this.baseWidth-o),m=Math.max(0,this.baseHeight-s);this.offsetFactorX=d?c/d:this._offsetFactorX,this.offsetFactorY=m?h/m:this._offsetFactorY}catch(e){}},nx.prototype.updateDisplay=function(){if(this.texture.valid)try{this.frameStretching&&!this.frameWasStretching&&(this.frameWasStretching=!0);var e=PIXI.GroupD8.isVertical(this.texture.rotate),t=e?this._frameHeight:this._frameWidth,n=e?this._frameWidth:this._frameHeight;if(this.frameScaling){var i=this.initialRealDimensions.y/this.initialRealDimensions.x,r=t/this.initialRealDimensions.x,a=n/this.initialRealDimensions.y;this.textureFrame.width=Math.min(this.baseWidth,this.baseWidth*r),this.textureFrame.height=Math.min(this.baseHeight,this.baseHeight*a);var o=this.baseWidth/this.textureFrame.width*t,s=this.baseHeight/this.textureFrame.height*n,l=s/i,u=o*i;l>o&&(this.textureFrame.width=this.textureFrame.width*(o/l)),u>s&&(this.textureFrame.height=this.textureFrame.height*(s/u));var c=this.baseWidth/this.textureFrame.width*this._frameWidth,h=this.baseHeight/this.textureFrame.height*this._frameHeight;this.excessX=Math.max(0,this.baseWidth-this.textureFrame.width),this.excessY=Math.max(0,this.baseHeight-this.textureFrame.height);var d=this.frameAnchorPoint.x/this.initialRealDimensions.x*this.baseWidth,m=this.frameAnchorPoint.y/this.initialRealDimensions.y*this.baseHeight,p=new PIXI.Point(this.baseWidth/2-this.textureFrame.width/2,this.baseHeight/2-this.textureFrame.height/2);if(this.frameScalingCentered)p.x=this.initialFrameCenter.x-this.textureFrame.width/2,p.y=this.initialFrameCenter.y-this.textureFrame.height/2;else switch(this.frameAnchorSide){case"l":p.x=d,p.y=m-this.textureFrame.height/2;break;case"tl":p.x=d,p.y=m;break;case"t":p.x=d-this.textureFrame.width/2,p.y=m;break;case"tr":p.x=d-this.textureFrame.width,p.y=m;break;case"r":p.x=d-this.textureFrame.width,p.y=m-this.textureFrame.height/2;break;case"br":p.x=d-this.textureFrame.width,p.y=m-this.textureFrame.height;break;case"b":p.x=d-this.textureFrame.width/2,p.y=m-this.textureFrame.height;break;case"bl":p.x=d,p.y=m-this.textureFrame.height}this.textureFrame.x=Math.max(0,Math.min(this.baseWidth-this.textureFrame.width,p.x)),this.textureFrame.y=Math.max(0,Math.min(this.baseHeight-this.textureFrame.height,p.y)),this._offsetFactorX=this.excessX>.01?this.textureFrame.x/this.excessX:.5,this._offsetFactorY=this.excessY>.01?this.textureFrame.y/this.excessY:.5;var g=Math.max(t/this.baseWidth,n/this.baseHeight),f=this.baseWidth*g,v=this.baseHeight*g;this._textureScaleX=c/f,this._textureScaleY=h/v}else if(!this.frameStretching){var y=Math.min(this.baseWidth/t,this.baseHeight/n);this.frameWasStretching&&(this.frameWasStretching=!1,this._textureScaleX=y/(this.textureFrame.width/t),this._textureScaleY=y/(this.textureFrame.height/n));var x=y/this._textureScaleX,_=y/this._textureScaleY;this.textureFrame.width=Math.max(0,Math.min(this.baseWidth,Math.round(t*x))),this.textureFrame.height=Math.max(0,Math.min(this.baseHeight,Math.round(n*_))),this.excessX=Math.max(0,this.baseWidth-this.textureFrame.width),this.excessY=Math.max(0,this.baseHeight-this.textureFrame.height),this.textureFrame.x=this._offsetFactorX*this.excessX,this.textureFrame.y=this._offsetFactorY*this.excessY}var I=Math.min(this._frameWidth,Math.max(1,this._frameWidth-2*this._framePadding)),T=Math.min(this._frameHeight,Math.max(1,this._frameHeight-2*this._framePadding)),b=Math.max(0,(this._frameWidth-I)/2),S=Math.max(0,(this._frameHeight-T)/2),C=this.textureFrame.width*(I/this._frameWidth),B=this.textureFrame.height*(T/this._frameHeight),F=this.textureFrame.x+(this.textureFrame.width-C)/2,E=this.textureFrame.y+(this.textureFrame.height-B)/2,P=new PIXI.Rectangle(F,E,C,B);this.texture.frame=P,this.texture.orig=this.texture.trim=new PIXI.Rectangle(b,S,I,T),this.visible=I>1&&T>1,this._imageRect.width=this.width/this.textureFrame.width*this.baseWidth,this._imageRect.height=this.height/this.textureFrame.height*this.baseHeight,this._imageRect.x=-(this._imageRect.width-this.width)*this._offsetFactorX,this._imageRect.y=-(this._imageRect.height-this.height)*this._offsetFactorY,this.adjustScale=1/Math.min(this.baseWidth/t,this.baseHeight/n),this.updateDisplayCallback&&this.updateDisplayCallback(),BFN.MainUI.requestRender()}catch(e){}},nx.prototype.flipH=function(){switch(this.texture.rotate){case 0:this.texture.rotate=12;break;case 2:this.texture.rotate=14;break;case 4:this.texture.rotate=8;break;case 6:this.texture.rotate=10;break;case 8:this.texture.rotate=4;break;case 10:this.texture.rotate=6;break;case 12:this.texture.rotate=0;break;case 14:this.texture.rotate=2}this.updateDisplay()},nx.prototype.flipV=function(){switch(this.texture.rotate){case 0:this.texture.rotate=8;break;case 2:this.texture.rotate=10;break;case 4:this.texture.rotate=12;break;case 6:this.texture.rotate=14;break;case 8:this.texture.rotate=0;break;case 10:this.texture.rotate=2;break;case 12:this.texture.rotate=4;break;case 14:this.texture.rotate=6}this.updateDisplay()},nx.prototype.rotateL=function(){switch(this.texture.rotate){case 0:this.texture.rotate=2;break;case 2:this.texture.rotate=4;break;case 4:this.texture.rotate=6;break;case 6:this.texture.rotate=0;break;case 8:this.texture.rotate=14;break;case 10:this.texture.rotate=8;break;case 12:this.texture.rotate=10;break;case 14:this.texture.rotate=12}this.conformOffsetFactors(),this.updateDisplay()},nx.prototype.rotateR=function(){switch(this.texture.rotate){case 0:this.texture.rotate=6;break;case 2:this.texture.rotate=0;break;case 4:this.texture.rotate=2;break;case 6:this.texture.rotate=4;break;case 8:this.texture.rotate=10;break;case 10:this.texture.rotate=12;break;case 12:this.texture.rotate=14;break;case 14:this.texture.rotate=8}this.conformOffsetFactors(),this.updateDisplay()},nx.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{this.texture.destroyGC(e)}catch(e){}this.texture=PIXI.Texture.EMPTY},Object.defineProperty(nx.prototype,"width",{get:function(){return this._frameWidth*this.scale.x}}),Object.defineProperty(nx.prototype,"height",{get:function(){return this._frameHeight*this.scale.y}}),Object.defineProperty(nx.prototype,"frameWidth",{set:function(e){this._frameWidth=Math.max(1,e)},get:function(){return this._frameWidth}}),Object.defineProperty(nx.prototype,"frameHeight",{set:function(e){this._frameHeight=Math.max(1,e)},get:function(){return this._frameHeight}}),Object.defineProperty(nx.prototype,"framePadding",{set:function(e){this._framePadding=Math.max(0,e)},get:function(){return this._framePadding}}),Object.defineProperty(nx.prototype,"offsetFactorX",{set:function(e){this._offsetFactorX=Math.max(0,Math.min(1,e))},get:function(){return this._offsetFactorX}}),Object.defineProperty(nx.prototype,"offsetFactorY",{set:function(e){this._offsetFactorY=Math.max(0,Math.min(1,e))},get:function(){return this._offsetFactorY}}),Object.defineProperty(nx.prototype,"rotate",{set:function(e){-1!=this.rotateValues.indexOf(e)&&(this.texture.rotate=e,this.conformOffsetFactors())},get:function(){return this.texture.rotate}}),Object.defineProperty(nx.prototype,"textureScale",{set:function(e){this._textureScale=Math.max(0,e),this._textureScaleX=this._textureScale,this._textureScaleY=this._textureScale,this.conformOffsetFactors()},get:function(){return this._textureScale}}),Object.defineProperty(nx.prototype,"textureScaleX",{set:function(e){this._textureScaleX=Math.max(0,e),this.conformOffsetFactors()},get:function(){return this._textureScaleX}}),Object.defineProperty(nx.prototype,"textureScaleY",{set:function(e){this._textureScaleY=Math.max(0,e),this.conformOffsetFactors()},get:function(){return this._textureScaleY}}),Object.defineProperty(nx.prototype,"isEmpty",{get:function(){return this._isEmpty}}),Object.defineProperty(nx.prototype,"imageRect",{get:function(){return this._imageRect}}),BFN.FrameSprite=nx,ix.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),ix.prototype.init=function(){BeFunky.log("FrameBorder Init"),this.initDefaultValues()},ix.prototype.initDefaultValues=function(){this.interactive=this.interactiveChildren=!1,this.visible=!1,this.spriteSize=32,this.sprites=[],this._width=0,this._height=0,this._thickness=0},ix.prototype.initSprites=function(){if(!this.sprites.length){for(var e=0;e<4;e++){var t=this.createSprite();t.anchor.x=e%3?0:1,t.anchor.y=Math.floor(e/2)?0:1,t.gapFactor=[e%3?0:1,e%3?1:0,Math.floor(e/2)?0:1,Math.floor(e/2)?1:0]}for(var n=0;n<4;n++){var i=this.createSprite();i.anchor.x=n<2?1-n%2:.5,i.anchor.y=n<2?.5:1-n%2,i.gapFactor=[n<2?1:0,n<2?1:0,n<2?0:1,n<2?0:1]}}},ix.prototype.setDimensions=function(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this.updateDisplay())},ix.prototype.updateDisplay=function(){this.initSprites();for(var e=0;e<this.sprites.length;e++){var t=this.sprites[e];t.visible=this._thickness>0,t.visible&&(e<4?(t.x=e%3?this._width:0,t.y=Math.floor(e/2)?this._height:0,t.scale.x=t.scale.y=this._thickness/this.spriteSize):(t.x=4==e?0:5===e?this._width:this._width/2,t.y=6==e?0:7===e?this._height:this._height/2,t.scale.x=Math.floor((e-4)/2)?this._width/this.spriteSize:this._thickness/this.spriteSize,t.scale.y=Math.floor((e-4)/2)?this._thickness/this.spriteSize:this._height/this.spriteSize),t.blendMode!==this._blendMode&&(t.blendMode=this._blendMode))}this.visible=this._thickness>0,BFN.MainUI&&BFN.MainUI.requestRender()},ix.prototype.destroy=function(){for(var e=0;e<this.sprites.length;e++)this.removeChild(this.sprites[e]),this.sprites[e].destroy(!1);this.sprites.splice(0),BFN.MainUI&&BFN.MainUI.requestRender()},ix.prototype.createSprite=function(){BFN.FrameBorderTexture||(BFN.FrameBorderTexture=PIXI.RenderTexture.create(this.spriteSize,this.spriteSize),BFN.FrameBorderTexture.fillColor(16777215),BFN.FrameBorderTexture.setScaleMode(PIXI.SCALE_MODES.NEAREST));var e=new PIXI.Sprite(BFN.FrameBorderTexture);return e.pluginName="blend_picture",e.alpha=this._opacity,e.fillColor=this._color,e.intensity=1,e.blendMode=this._blendMode,this.addChild(e),this.sprites.push(e),e},Object.defineProperty(ix.prototype,"thickness",{set:function(e){"number"==typeof e&&this._thickness!==e&&(this._thickness=e,this.updateDisplay())},get:function(){return this._thickness}}),Object.defineProperty(ix.prototype,"color",{set:function(e){var t=this;"number"==typeof e&&this._color!==e&&(this._color=Math.max(0,Math.min(16777215,e)),this.sprites.forEach(function(e){e.fillColor=t._color}),BFN.MainUI.requestRender())},get:function(){return this._color}}),Object.defineProperty(ix.prototype,"opacity",{set:function(e){var t=this;"number"==typeof e&&this._opacity!==e&&(this._opacity=Math.max(0,Math.min(1,e)),this.sprites.forEach(function(e){e.alpha=t._opacity}),BFN.MainUI.requestRender())},get:function(){return this._opacity}}),Object.defineProperty(ix.prototype,"blendMode",{set:function(e){var t=this;"number"==typeof e&&this._blendMode!==e&&(this._blendMode=e,this.sprites.forEach(function(e){e.blendMode=t._blendMode}),BFN.MainUI.requestRender())},get:function(){return this._blendMode}}),Object.defineProperty(ix.prototype,"isFrameBorder",{get:function(){return!0}}),BFN.FrameBorder=ix,rx.prototype=Object.create(PIXI.Container.prototype),rx.prototype.init=function(){BeFunky.log("PremiumWatermark Init"),this.initDefaultValues(),this.initEmblem(),this.initGraphicLoader()},rx.prototype.initDefaultValues=function(){this.interactive=!1,this.visible=!1,this._showing=!1,this.frameWidth=0,this.frameHeight=0,this.currentToolID=null,this._canvasScale=1,this._canvasScaling=!1,BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged.bind(this))},rx.prototype.initEmblem=function(){this.emblem=new PIXI.Sprite,this.emblem.interactive=!0,this.emblem.buttonMode=!0,this.emblem.anchor.y=1,this.emblem.pluginName="blend_picture",this.emblem.currentScale=1,this.emblem.on("click",function(){BFN.PhotoEditorCanvasTools.applyCurrentTool("WATERMARK","")})},rx.prototype.initGraphicLoader=function(){this.graphicLoader=new BFN.GraphicLoader,this.graphicLoader.graphicsData.emblem=BFN.imagesURL+"app/premium_emblem_v4_50_op.png",this.graphicLoader.addEventListener(BFN.GraphicLoaderEvents.LOADING_COMPLETE.type,this.handleGraphicsLoaded.bind(this)),setTimeout(function(){this.graphicLoader.loadGraphics()}.bind(this),1e3)},rx.prototype.setDimensions=function(e,t){this.frameWidth=Math.abs(e),this.frameHeight=Math.abs(t),this.updateDimensions()},rx.prototype.updateDimensions=function(){this.graphicLoader.graphicsLoaded&&(this.emblem.scale.x=this.emblem.scale.y=Math.min(this.frameWidth/3/this.emblem.texture.width,this.frameHeight/3/this.emblem.texture.height),this.emblem.x=Math.round(-this.frameWidth/2+10*this.emblem.scale.x),this.emblem.y=Math.round(this.frameHeight/2-10*this.emblem.scale.y),this.updateSmoothing()),BFN.MainUI.requestRender()},rx.prototype.updateSmoothing=function(){this.emblem.currentScale=this._canvasScaling?1:this.emblem.scale.x*this._canvasScale,BFN.MainUI.requestRender()},rx.prototype.updateDisplay=function(){this._showing=this.currentToolID&&UITools.toolPlusHash[this.currentToolID]&&!BFN.BfnService.userIsPlus,this.visible=this._showing,BFN.MainUI.requestRender()},rx.prototype.handleUserDataChanged=function(e){this.updateDisplay()},rx.prototype.handleGraphicsLoaded=function(e){this.emblem.texture=this.graphicLoader.graphics.emblem,this.addChild(this.emblem),this.updateDimensions()},Object.defineProperty(rx.prototype,"showing",{get:function(){return this._showing}}),Object.defineProperty(rx.prototype,"canvasScaling",{set:function(e){this._canvasScaling=e,this.updateSmoothing()},get:function(){return this._canvasScaling}}),Object.defineProperty(rx.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.updateSmoothing()},get:function(){return this._canvasScale}}),BFN.SingletonQueue.add(function(){BFN.PremiumWatermark=new rx}),ax.prototype=Object.create(PIXI.Container.prototype),ax.prototype.init=function(){BeFunky.log("TileContainer Init"),this.initDefaultValues(),this.initTileContainer(),this.initTileContainerMask(),this.initTilePool()},ax.prototype.initDefaultValues=function(){this.tiles=[],this.tilesX=0,this.tilesY=0,this.tilesNum=0,this.tilesTotalW=0,this.tilesTotalH=0,this.globalOffsetPoint=new PIXI.Point,this.localOffsetPoint=new PIXI.Point,this._smoothScale=1},ax.prototype.initTileContainer=function(){this.tileContainer=new PIXI.Container,this.addChild(this.tileContainer)},ax.prototype.initTileContainerMask=function(){this.tileContainerMask=new PIXI.Graphics,this.tileContainerMask.beginFill(16777215),this.tileContainerMask.drawRect(0,0,100,100),this.tileContainerMask.endFill(),this.addChild(this.tileContainerMask),this.tileContainer.mask=this.tileContainerMask},ax.prototype.initTilePool=function(){this.tilePool=new BFN.SpritePool,this.tilePool.grow(100)},ax.prototype.offset=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.globalOffsetPoint.x=e,this.globalOffsetPoint.y=t,this.updateSpritePlacement()},ax.prototype.rotate=function(e){this.tileContainer.rotation=e;var t=Math.sqrt(Math.pow(this.localOffsetPoint.x,2)+Math.pow(this.localOffsetPoint.y,2)),n=Math.atan2(this.localOffsetPoint.y,this.localOffsetPoint.x)+this.tileContainer.rotation;this.globalOffsetPoint.x=Math.cos(n)*t,this.globalOffsetPoint.y=Math.sin(n)*t,BFN.MainUI.requestRender()},ax.prototype.updateDisplay=function(){if(this.tileContainer.children.length&&this.tileContainer.removeChildren(0,this.tileContainer.children.length),this.tiles.splice(0),this.tilesX=0,this.tilesY=0,this.tilesNum=0,this.tilesTotalW=0,this.tilesTotalH=0,this._texture){this.tilesX=Math.ceil(this.containerDiagonal/this._texture.width)+1,this.tilesY=Math.ceil(this.containerDiagonal/this._texture.height)+1,this.tilesX+=this.tilesX%2?0:1,this.tilesY+=this.tilesY%2?0:1,this.tilesTotalW=this.tilesX*this._texture.width,this.tilesTotalH=this.tilesY*this._texture.height,this.tilesNum=this.tilesX*this.tilesY,this.tilePool.growTo(this.tilesNum);for(var e=0;e<this.tilesNum;e++){var t=this.tilePool.getSprite(e,null,this._texture);this.tiles.push(t),this.tileContainer.addChild(t)}this.updateSpritePlacement(),this.updateSpriteSmoothing()}BFN.MainUI.requestRender()},ax.prototype.updateSpritePlacement=function(){if(this._texture){var e=Math.sqrt(Math.pow(this.globalOffsetPoint.x,2)+Math.pow(this.globalOffsetPoint.y,2)),t=Math.atan2(this.globalOffsetPoint.y,this.globalOffsetPoint.x)-this.tileContainer.rotation;this.localOffsetPoint.x=Math.cos(t)*e%this._texture.width,this.localOffsetPoint.y=Math.sin(t)*e%this._texture.height;var n=Math.sqrt(Math.pow(this.localOffsetPoint.x,2)+Math.pow(this.localOffsetPoint.y,2)),i=Math.atan2(this.localOffsetPoint.y,this.localOffsetPoint.x)+this.tileContainer.rotation;this.globalOffsetPoint.x=Math.cos(i)*n,this.globalOffsetPoint.y=Math.sin(i)*n;for(var r=0;r<this.tilesNum;r++){var a=r%this.tilesX*this._texture.width-this.tilesTotalW/2+this._texture.width/2,o=Math.floor(r/this.tilesY)*this._texture.height-this.tilesTotalH/2+this._texture.height/2;for(a+=this.localOffsetPoint.x,o+=this.localOffsetPoint.y;a<-this.tilesTotalW/2;)a+=this.tilesTotalW;for(;a>this.tilesTotalW/2;)a-=this.tilesTotalW;for(;o<-this.tilesTotalH/2;)o+=this.tilesTotalH;for(;o>this.tilesTotalH/2;)o-=this.tilesTotalH;var s=this.tiles[r];s.x=a,s.y=o}BFN.MainUI.requestRender()}},ax.prototype.updateSpriteSmoothing=function(){for(var e=0;e<this.tiles.length;e++){var t=this.tiles[e];this._smoothScale<=1?("smooth_picture"!=t.pluginName&&(t.pluginName="smooth_picture",t.expandVertex=0),t.currentScale=this._smoothScale):"sprite"!=t.pluginName&&(t.pluginName="sprite",t.currentScale=1)}},Object.defineProperty(ax.prototype,"texture",{set:function(e){this._texture=e},get:function(){return this._texture}}),Object.defineProperty(ax.prototype,"width",{set:function(e){this._width=e,this.containerDiagonal=Math.floor(Math.sqrt(Math.pow(this._width,2)+Math.pow(this._height,2))),this.tileContainer.x=this._width/2,this.tileContainerMask.width=this._width},get:function(){return this._width}}),Object.defineProperty(ax.prototype,"height",{set:function(e){this._height=e,this.containerDiagonal=Math.floor(Math.sqrt(Math.pow(this._width,2)+Math.pow(this._height,2))),this.tileContainer.y=this._height/2,this.tileContainerMask.height=this._height},get:function(){return this._height}}),Object.defineProperty(ax.prototype,"smoothScale",{set:function(e){this._smoothScale=e,this.updateSpriteSmoothing()},get:function(){return this._smoothScale}}),BFN.TileContainer=ax,ox.prototype=Object.create(PIXI.Container.prototype),ox.prototype.init=function(){BeFunky.log("GraphicsPixelGrid Init"),this.initDefaultValues()},ox.prototype.initDefaultValues=function(){this.pixelHash={},this._itemWidth=0,this._itemHeight=0},ox.prototype.clear=function(){for(var e in this.pixelHash){var t=this.pixelHash[e];for(var n in t)this.destroyPixel(n,e),delete t[n];delete this.pixelHash[e]}this.pixelHash={},this._itemWidth=0,this._itemHeight=0},ox.prototype.generate=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.clear();for(var r=0;r<t;r++){var a={};this.pixelHash[r]=a;for(var o=0;o<e;o++)a[o]=this.createPixelGraphic(o,r,n,i)}this._itemWidth=e,this._itemHeight=t},ox.prototype.getPixel=function(e,t){return this.pixelHash.hasOwnProperty(t)&&this.pixelHash[t].hasOwnProperty(e)?this.pixelHash[t][e]:null},ox.prototype.destroyPixel=function(e,t){var n=this.getPixel(e,t);n&&(n.clear(),this.removeChild(n),this.pixelHash[t][e]=null)},ox.prototype.setPixelColor=function(e,t,n){var i=this.getPixel(e,t);if(i){var r=i.alpha;this.destroyPixel(e,t),i=this.createPixelGraphic(e,t,n,r),this.pixelHash[t][e]=i}},ox.prototype.setPixelAlpha=function(e,t,n){var i=this.getPixel(e,t);i&&(i.alpha=n)},ox.prototype.createPixelGraphic=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=new PIXI.Graphics;return r.beginFill(n,i),r.drawRect(0,0,1,1),r.endFill(),r.x=e,r.y=t,this.addChild(r),r},Object.defineProperty(ox.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(ox.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.GraphicsPixelGrid=ox,sx.prototype=Object.create(PIXI.particles.ParticleContainer.prototype),sx.prototype.init=function(){BeFunky.log("SpritePixelGrid Init"),this.initDefaultValues()},sx.prototype.initDefaultValues=function(){this.pixelTexture=PIXI.RenderTexture.create(2,2),this.pixelTexture.setScaleMode(PIXI.SCALE_MODES.NEAREST),this.spritePool=new BFN.SpritePool,this.spritePool.spriteAnchor.x=this.spritePool.spriteAnchor.y=0,this._itemWidth=0,this._itemHeight=0},sx.prototype.clear=function(){for(var e in this.removeChildren(),this.pixelHash){var t=this.pixelHash[e];for(var n in t)delete t[n];delete this.pixelHash[e]}this.pixelHash={},this._itemWidth=0,this._itemHeight=0},sx.prototype.generate=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.clear(),this.pixelTexture.fillRect(0,0,1,1,n),this.spritePool.growTo(e*t);for(var r=0;r<t;r++){var a={};this.pixelHash[r]=a;for(var o=0;o<e;o++){var s=this.spritePool.getSprite(r*e+o,{x:o,y:r},this.pixelTexture);s.alpha=i,this.addChild(s),a[o]=s}}this._itemWidth=e,this._itemHeight=t},sx.prototype.getPixel=function(e,t){return this.pixelHash.hasOwnProperty(t)&&this.pixelHash[t].hasOwnProperty(e)?this.pixelHash[t][e]:null},sx.prototype.destroyPixel=function(e,t){var n=this.getPixel(e,t);n&&(this.removeChild(n),this.pixelHash[t][e]=null)},sx.prototype.setPixelAlpha=function(e,t,n){var i=this.getPixel(e,t);i&&(i.alpha=n)},sx.prototype.setEveryPixelAlpha=function(e){for(var t in this.pixelHash){var n=this.pixelHash[t];for(var i in n){var r=n[i];r&&(r.alpha=e)}}},Object.defineProperty(sx.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(sx.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.SpritePixelGrid=sx,lx.prototype=Object.create(PIXI.particles.ParticleContainer.prototype),lx.prototype.init=function(){BeFunky.log("PixelGrid Init"),this.initDefaultValues(),this.initGuides()},lx.prototype.initDefaultValues=function(){this._frameWidth=0,this._frameHeight=0,this.active=!0},lx.prototype.initGuides=function(){var e=this;this.guideTexture=PIXI.RenderTexture.create(10,3),this.guideTexture.fillRect(0,1,10,1,16777215,.5),this.guideTexture.setScaleMode(PIXI.SCALE_MODES.NEAREST);var t=function(t,n,i){var r=new PIXI.Sprite(e.guideTexture);return r.anchor.x=r.anchor.y=.5,r.x=t,r.y=n,r.rotation=i,e.addChild(r),r};this.hGuides=[];for(var n=-Math.floor(this.hGuidesNum/2);n<Math.floor(this.hGuidesNum/2);n++)this.hGuides.push(t(0,1*n,0));this.vGuides=[];for(var i=-Math.floor(this.vGuidesNum/2);i<Math.floor(this.vGuidesNum/2);i++)this.vGuides.push(t(1*i,0,Math.PI/2))},lx.prototype.setFrameDimensions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._frameWidth=e,this._frameHeight=t,this.updateDisplay()},lx.prototype.updateDisplay=function(){var e=this;this.active?(this._scale<5.5&&this.visible?this.visible=!1:this._scale<6?(this.alpha=(this._scale-5.5)/.5,this.visible||(this.visible=!0)):(this.alpha<1||!this.visible)&&(this.alpha=1,this.visible=!0),this.visible&&(this.hGuides.forEach(function(t){t.scale.x=e._frameWidth/e._scale,t.scale.y=1/e._scale}),this.vGuides.forEach(function(t){t.scale.x=e._frameHeight/e._scale,t.scale.y=1/e._scale}),BFN.MainUI&&BFN.MainUI.requestRender())):this.visible&&(this.visible=!1)},Object.defineProperty(lx.prototype,"frameWidth",{set:function(e){this._frameWidth=e,this.updateDisplay()},get:function(){return this._frameWidth}}),Object.defineProperty(lx.prototype,"frameHeight",{set:function(e){this._frameHeight=e,this.updateDisplay()},get:function(){return this._frameHeight}}),Object.defineProperty(lx.prototype,"canvasScale",{set:function(e){this._scale=e,this.updateDisplay()},get:function(){return this._canvasScale}}),BFN.PixelGrid=lx,ux.prototype=Object.create(PIXI.Graphics.prototype),ux.prototype.init=function(){BeFunky.log("AutoCollageGeneratorClusterItem Init"),this.initDefaultValues()},ux.prototype.initDefaultValues=function(){this._menuImageVO=null,this._itemWidth=0,this._itemHeight=0},ux.prototype.destroy=function(){this._menuImageVO=null,this.clear()},Object.defineProperty(ux.prototype,"menuImageVO",{set:function(e){this._menuImageVO=e,this.clear(),this._menuImageVO.imageTexture&&this._menuImageVO.imageTexture.valid&&this._menuImageVO.imageTexture.baseTexture&&(this._itemWidth=this._menuImageVO.imageTexture.baseTexture.width,this._itemHeight=this._menuImageVO.imageTexture.baseTexture.height,this.beginFill(16777215),this.drawRect(0,0,this._itemWidth,this._itemHeight),this.endFill())},get:function(){return this._menuImageVO}}),Object.defineProperty(ux.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(ux.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.AutoCollageGeneratorClusterItem=ux,cx.prototype=Object.create(PIXI.Container.prototype),cx.prototype.init=function(){BeFunky.log("AutoCollageGeneratorCluster Init"),this.initDefaultValues()},cx.prototype.initDefaultValues=function(){this._itemsNum=0,this._itemWidth=0,this._itemHeight=0,this.clusters=null,this.item=null,this.cluster=null,this.clusterA=null,this.clusterB=null,this.clusterC=null,this.hWidth=0,this.hHeight=0,this.hRatio=0,this.vWidth=0,this.vHeight=0,this.vRatio=0,this.hsRect=new BFN.Rectangle,this.hsWidth=0,this.hsHeight=0,this.hsRatio=0,this.vsRect=new BFN.Rectangle,this.vsWidth=0,this.vsHeight=0,this.vsRatio=0},cx.prototype.addItem=function(e){this.item&&(this.removeChild(this.item),this.item.destroy(),this.item=null,this._itemWidth=0,this._itemHeight=0),e&&e.menuImageVO&&!this.clusters&&(this.item=e,this.item.x=this.item.y=0,this.item.scale.x=this.item.scale.y=1,this.addChild(this.item),this._itemWidth=this.item.width,this._itemHeight=this.item.height)},cx.prototype.addCluster=function(e){this.item||(this.clusters||(this.clusters=[]),this.clusters.length<3&&(this.clusters.push(e),this._itemsNum=this.clusters.length,this.addChild(e),this.arrangeClusters()))},cx.prototype.clear=function(){if(this.item&&(this.removeChild(this.item),this.item.destroy(),this.item=null),this.clusters){for(var e=0;e<this.clusters.length;e++)this.cluster=this.clusters[e],this.removeChild(this.cluster),this.cluster.clear(),this.cluster=null;this.clusters.splice(0),this.clusters=null}this._itemWidth=0,this._itemHeight=null},cx.prototype.arrangeClusters=function(){for(var e=0;e<this.clusters.length;e++)this.cluster=this.clusters[e],this.cluster.x=this.cluster.y=0,this.cluster.scale.x=this.cluster.scale.y=1;if(1==this.clusters.length)this.cluster=this.clusters[0],this._itemWidth=this.cluster.width,this._itemHeight=this.cluster.height;else if(2==this.clusters.length)this.clusterA=this.clusters[0],this.clusterB=this.clusters[1],this.hWidth=this.getCombinedWidth(this.clusterA.rect,this.clusterB.rect),this.hHeight=this.clusterA.height,this.hRatio=this.getLongRatio(this.hWidth,this.hHeight),this.vWidth=this.clusterA.width,this.vHeight=this.getCombinedHeight(this.clusterA.rect,this.clusterB.rect),this.vRatio=this.getLongRatio(this.vWidth,this.vHeight),this.hRatio<this.vRatio?(this.clusterB.x=this.clusterA.width,this.clusterB.width=this.hWidth-this.clusterA.width,this.clusterB.height=this.clusterA.height,this._itemWidth=this.hWidth,this._itemHeight=this.hHeight):(this.clusterB.y=this.clusterA.height,this.clusterB.width=this.clusterA.width,this.clusterB.height=this.vHeight-this.clusterA.height,this._itemWidth=this.vWidth,this._itemHeight=this.vHeight);else if(3==this.clusters.length){for(var t=Number.MAX_VALUE,n=Math.random()<.5,i=0;i<this.clusters.length;i++){this.clusterA=this.clusters[i];for(var r=0;r<this.clusters.length;r++)if(this.clusters[i]!=this.clusters[r]){this.clusterB=this.clusters[r];for(var a=0;a<this.clusters.length;a++)if(this.clusters[i]!=this.clusters[a]&&this.clusters[r]!=this.clusters[a]){this.clusterC=this.clusters[a],this.hWidth=this.getCombinedWidth(this.clusterA.rect,this.clusterB.rect)+(this.getCombinedWidth(this.clusterA.rect,this.clusterC.rect)-this.clusterA.width),this.hHeight=this.clusterA.height,this.hRatio=this.getLongRatio(this.hWidth,this.hHeight),this.vWidth=this.clusterA.width,this.vHeight=this.getCombinedHeight(this.clusterA.rect,this.clusterB.rect)+(this.getCombinedHeight(this.clusterA.rect,this.clusterC.rect)-this.clusterA.height),this.vRatio=this.getLongRatio(this.vWidth,this.vHeight),this.hsRect.width=this.clusterB.itemWidth,this.hsRect.height=this.getCombinedHeight(this.clusterB.rect,this.clusterC.rect),this.hsWidth=this.getCombinedWidth(this.clusterA.rect,this.hsRect),this.hsHeight=this.clusterA.height,this.hsRatio=this.getLongRatio(this.hsWidth,this.hsHeight),this.vsRect.width=this.getCombinedWidth(this.clusterB.rect,this.clusterC.rect),this.vsRect.height=this.clusterB.itemHeight,this.vsWidth=this.clusterA.width,this.vsHeight=this.getCombinedHeight(this.clusterA.rect,this.vsRect),this.vsRatio=this.getLongRatio(this.vsWidth,this.vsHeight);var o=n?Math.min(this.hRatio,this.vRatio):Math.min(this.hRatio,this.vRatio,this.hsRatio,this.vsRatio);if(o<t){t=o;var s=this.getClusterObject(),l=this.getClusterObject(),u=this.getClusterObject();switch(o){case this.hRatio:this._itemWidth=this.hWidth,this._itemHeight=this.hHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.x=s.width,l.width=this.hWidth-this.getCombinedWidth(this.clusterA.rect,this.clusterC.rect),l.height=s.height,u.cluster=this.clusterC,u.x=l.x+l.width,u.width=this.hWidth-u.x,u.height=s.height;break;case this.vRatio:this._itemWidth=this.vWidth,this._itemHeight=this.vHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.y=s.height,l.width=s.width,l.height=this.vHeight-this.getCombinedHeight(this.clusterA.rect,this.clusterC.rect),u.cluster=this.clusterC,u.y=l.y+l.height,u.width=s.width,u.height=this.vHeight-u.y;break;case this.hsRatio:this._itemWidth=this.hsWidth,this._itemHeight=this.hsHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.x=s.width,l.width=this.hsWidth-s.width,l.height=Math.round(l.width/this.clusterB.width*this.clusterB.height),u.cluster=this.clusterC,u.x=s.width,u.y=l.height,u.width=this.hsWidth-s.width,u.height=this.hsHeight-l.height,Math.random()<.5&&(s.x=l.width,l.x=u.x=0);break;case this.vsRatio:this._itemWidth=this.vsWidth,this._itemHeight=this.vsHeight,s.cluster=this.clusterA,s.width=this.clusterA.width,s.height=this.clusterA.height,l.cluster=this.clusterB,l.y=s.height,l.height=this.vsHeight-s.height,l.width=Math.round(l.height/this.clusterB.height*this.clusterB.width),u.cluster=this.clusterC,u.x=l.width,u.y=s.height,u.width=this.vsWidth-l.width,u.height=this.vsHeight-s.height,Math.random()<.5&&(s.y=l.height,l.y=u.y=0)}}}}}try{s.cluster.x=s.x,s.cluster.y=s.y,s.cluster.width=s.width,s.cluster.height=s.height,l.cluster.x=l.x,l.cluster.y=l.y,l.cluster.width=l.width,l.cluster.height=l.height,u.cluster.x=u.x,u.cluster.y=u.y,u.cluster.width=u.width,u.cluster.height=u.height}catch(e){}}},cx.prototype.getCombinedWidth=function(e,t){return Math.floor(e.width+Math.round(t.width*(e.height/t.height)))},cx.prototype.getCombinedHeight=function(e,t){return Math.floor(e.height+Math.round(t.height*(e.width/t.width)))},cx.prototype.getLongRatio=function(e,t){return(e=Math.floor(e))>(t=Math.floor(t))?e/t:t/e},cx.prototype.getClusterObject=function(){return{cluster:null,x:0,y:0,width:0,height:0}},Object.defineProperty(cx.prototype,"rect",{get:function(){return new BFN.Rectangle(0,0,this._itemWidth,this._itemHeight)}}),Object.defineProperty(cx.prototype,"itemsNum",{get:function(){return this._itemsNum}}),Object.defineProperty(cx.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(cx.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.AutoCollageGeneratorCluster=cx,BFN.AutoCollageGeneratorEvents={SIZE_UPDATED:new Event("SIZE_UPDATED")},hx.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),hx.prototype.init=function(){BeFunky.log("AutoCollageGenerator Init"),this.initDefaultValues(),this.initClusterContainer()},hx.prototype.initDefaultValues=function(){this._itemWidth=0,this._itemHeight=0,this.rootCluster=null,this.clusterItems=[]},hx.prototype.initClusterContainer=function(){this.clusterContainer=new PIXI.Container,this.addChild(this.clusterContainer)},hx.prototype.generate=function(e){if(this.clear(),e&&e.length)for(var t=0;t<e.length;t++){var n=e[t],i=new BFN.AutoCollageGeneratorClusterItem;i.menuImageVO=n,i.menuImageVO&&this.clusterItems.push(i)}this.generateCollage();for(var r=[],a=0;a<this.clusterItems.length;a++){var o=this.clusterItems[a];if(o.menuImageVO){var s={},l=this.toLocal(o.toGlobal(new PIXI.Point(0,0))),u=this.toLocal(o.toGlobal(new PIXI.Point(o.itemWidth,o.itemHeight)));s.menuImageVO=o.menuImageVO,s.rect=new BFN.Rectangle(Math.round(l.x),Math.round(l.y),Math.round(u.x)-Math.round(l.x),Math.round(u.y)-Math.round(l.y)),r.push(s)}}return r},hx.prototype.clear=function(){this.clearDisplay(),this.clusterItems.splice(0)},hx.prototype.clearDisplay=function(){this.rootCluster&&(this.rootCluster.clear(),this.rootCluster=null,this.clusterContainer.removeChildren())},hx.prototype.generateCollage=function(){this.clearDisplay();for(var e=[],t=0;t<this.clusterItems.length;t++)e.push(this.clusterItems[t]);for(var n=[];e.length;){var i=Math.floor(Math.random()*e.length);n.push(e[i]),e.splice(i,1)}for(var r=[];n.length;)this.cluster=new BFN.AutoCollageGeneratorCluster,this.cluster.addItem(n.pop()),r.push(this.cluster);for(n.splice(0);r.length>1;){for(var a=[],o=0;o<r.length;o++)a.push(r[o]);r.splice(0);for(var s=null;a.length;)s||(s=new BFN.AutoCollageGeneratorCluster,r.push(s)),s.itemsNum<2?s.addCluster(a.pop()):2==s.itemsNum&&(1==a.length&&s.addCluster(a.pop()),s=null)}this.rootCluster=r[0],this.clusterContainer.addChild(this.rootCluster),r.splice(0),this.clusterContainer.scale.x=this.clusterContainer.scale.y=Math.min(Math.max(1,2e3/this.rootCluster.itemWidth,2e3/this.rootCluster.itemHeight),4e3/this.rootCluster.itemWidth,4e3/this.rootCluster.itemHeight),this._itemWidth=this.clusterContainer.width=Math.floor(this.clusterContainer.width),this._itemHeight=this.clusterContainer.height=Math.floor(this.clusterContainer.height),this.dispatchEvent(BFN.AutoCollageGeneratorEvents.SIZE_UPDATED)},Object.defineProperty(hx.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(hx.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.AutoCollageGenerator=hx,dx.prototype.init=function(){this.initDefaultValues(),this.initAutoCollageGenerator()},dx.prototype.initDefaultValues=function(){this._collageMenuImageVOs=null,this.layoutObjects=[],this.layoutIndex=0,this.previewFitSize=1024},dx.prototype.initAutoCollageGenerator=function(){this.autoCollageGenerator=new BFN.AutoCollageGenerator},dx.prototype.reset=function(){if(this._collageMenuImageVOs){this._collageMenuImageVOs.splice(0),this._collageMenuImageVOs=null;for(var e=0;e<this.layoutObjects.length;e++)this.clearLayoutObject(this.layoutObjects[e]);this.layoutObjects.splice(0),this.layoutIndex=0,BFN.CollageWizardModal.togglePrevButton(!1),BFN.CollageWizardModal.toggleNextButton(!1),BFN.CollageWizardModal.updatePreviewImage(null)}},dx.prototype.generateAutoCollage=function(e){if(this.reset(),e&&e.length){this._collageMenuImageVOs=[];for(var t=0;t<e.length;t++)this._collageMenuImageVOs.push(e[t]);this._collageMenuImageVOs.length&&BFN.BfnService.getTexturesForMenuImageVOs(this._collageMenuImageVOs).then(this.nextLayout.bind(this))}},dx.prototype.nextLayout=function(){var e;this._collageMenuImageVOs&&this._collageMenuImageVOs.length&&(this.layoutObjects.length?this.layoutIndex<this.layoutObjects.length-1?e=this.layoutObjects[++this.layoutIndex]:(e=this.getNewLayout())&&(this.layoutObjects.push(e),this.layoutIndex=this.layoutObjects.length-1):(e=this.getNewLayout())&&(this.layoutObjects.push(e),this.layoutIndex=0),BFN.CollageWizardModal.togglePrevButton(this.layoutIndex>0),e&&this.createPreview(e))},dx.prototype.prevLayout=function(){if(this._collageMenuImageVOs&&this._collageMenuImageVOs.length&&this.layoutIndex>0){var e=this.layoutObjects[--this.layoutIndex];BFN.CollageWizardModal.togglePrevButton(this.layoutIndex>0),e&&this.createPreview(e)}},dx.prototype.getNewLayout=function(){if(this._collageMenuImageVOs){var e={};return e.data=this.autoCollageGenerator.generate(this._collageMenuImageVOs),e.width=this.autoCollageGenerator.itemWidth,e.height=this.autoCollageGenerator.itemHeight,this.autoCollageGenerator.clear(),e}return null},dx.prototype.createPreview=function(e){if(BFN.CollageWizardModal.toggleSelectCollageButton(e.data.length>0),e.imageSRC)this.setPreview(e.imageSRC);else{UIToggler.toggleLoadScreen(!0),BFN.CollageWizardModal.toggleNextButton(!1);var t=PIXI.RenderTexture.create(e.width,e.height);t.clear();var n=null,i=new PIXI.Sprite;i.pluginName="smooth_picture";for(var r=0;r<e.data.length;r++){var a=e.data[r],o=a.menuImageVO,s=a.rect;n=new PIXI.Texture(o.imageTexture.baseTexture),i.texture=n,i.scale.x=i.currentScale=s.width/n.width,i.scale.y=i.currentScaleY=s.height/n.height,i.x=s.x,i.y=s.y,BFN.Stage.render(i,t,!1),n.destroyGC(!1)}var l=Math.min(this.previewFitSize/t.width,this.previewFitSize/t.height),u=PIXI.RenderTexture.create(Math.floor(t.width*l),Math.floor(t.height*l));i.texture=t,i.scale.x=i.currentScale=u.width/t.width,i.scale.y=i.currentScaleY=u.height/t.height,i.x=0,i.y=0,BFN.Stage.render(i,u),t.destroyGC(!0),i.destroy(!0),BFN.Util.getHTMLImage(u,function(t){u.destroyGC(!0),e.imageSRC=t.src,BFN.AutoCollage.setPreview(e.imageSRC),BFN.CollageWizardModal.toggleNextButton(!0),UIToggler.toggleLoadScreen(!1)},!0)}},dx.prototype.setPreview=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";BFN.CollageWizardModal.updatePreviewImage(e)},dx.prototype.selectCurrentLayout=function(){this.layoutObjects.length&&this.layoutIndex<this.layoutObjects.length&&(BFN.CollageMakerCanvasPhotoGridModel.autoCollageLayoutObject=this.layoutObjects[this.layoutIndex])},dx.prototype.clearLayoutObject=function(e){for(var t=0;t<e.data.length;t++){var n=e.data[t];n.menuImageVO=null,n.rect=null,n.imageSRC=null,delete n.menuImageVO,delete n.rect,delete n.imageSRC}e.data.splice(0),e.data=null,delete e.data,delete e.width,delete e.height},BFN.AutoCollage=new dx,BFN.maxBrushSize=1024,mx.prototype=Object.create(PIXI.Sprite.prototype),mx.prototype.init=function(){BeFunky.log("ImagePainterBrush Init"),this.initDefaultValues()},mx.prototype.initDefaultValues=function(){this.radius=25,this.hardness=1,this.strength=1,this.opacity=1,this.inverse=!1,this.useRoughCircleBrush=!1,this.sourceSprite=new PIXI.Sprite,this.sourceSprite.texture=null,this.texture=null,this.sourceSprite.pluginName="filter_renderer",this.brushFilter=BFN.ShaderPool.BrushFilter,this.brushFilter.resolution=1,this.brushFilter.mode="paint"},mx.prototype.reset=function(){this.sourceSprite.texture&&(this.sourceSprite.texture.destroyGC(!0),this.sourceSprite.texture=null),this.texture&&(this.texture.destroyGC(!0),this.texture=null)},mx.prototype.updateBrush=function(){this.reset(),this.brushFilter.mode="paint",this.sourceSprite.texture=PIXI.RenderTexture.create(2*this.radius,2*this.radius,1),this.sourceSprite.texture.clear(),this.texture=PIXI.RenderTexture.create(2*this.radius,2*this.radius,1)},mx.prototype.updateFilter=function(){this.useRoughCircleBrush?(this.roughCircleBrushGraphic||(this.roughCircleBrushGraphic=new PIXI.Graphics),this.roughCircleBrushGraphic.clear(),this.roughCircleBrushGraphic.beginFill(8421504),this.roughCircleBrushGraphic.drawCircle(this.radius,this.radius,this.radius),this.roughCircleBrushGraphic.endFill(),this.sourceSprite.pluginName="sprite",this.sourceSprite.mask=this.roughCircleBrushGraphic):(this.brushFilter.radius=this.radius,this.brushFilter.hardness=this.hardness,this.brushFilter.strength=this.strength,this.brushFilter.opacity=this.opacity,this.brushFilter.inverse=this.inverse,this.sourceSprite.pluginName="filter_renderer",this.sourceSprite.mask=null,this.sourceSprite.bfn_shaders=[this.brushFilter]),this.updateTexture()},mx.prototype.updateTexture=function(){this.texture&&BFN.Stage.render(this.sourceSprite,this.texture)},Object.defineProperty(mx.prototype,"sourceTexture",{get:function(){return this.sourceSprite.texture}}),BFN.ImagePainterBrush=mx,BFN.ImagePainterEvents={BRUSH_RADIUS_UPDATED:new Event("BRUSH_RADIUS_UPDATED"),BRUSH_APPLIED:new Event("BRUSH_APPLIED"),PAINT_UPDATED:new Event("PAINT_UPDATED"),PAINT_UPDATED_PRE_HISTORY:new Event("PAINT_UPDATED_PRE_HISTORY"),PAINTING_STARTED:new Event("PAINTING_STARTED"),PAINTING_COMPLETE:new Event("PAINTING_COMPLETE"),PAINT_APPLIED_UPDATED:new Event("PAINT_APPLIED_UPDATED"),PAINTING_ENABLED_UPDATED:new Event("PAINTING_ENABLED_UPDATED")},px.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),px.prototype.init=function(){BeFunky.log("ImagePainter Init"),this.initDefaultValues(),this.initBrushPool(),this.initBrush()},px.prototype.initDefaultValues=function(){this.interactive=!0,this.brushHardnessAdjustFactor=1,this.textureClone=null,this.textureCloneSprite=new PIXI.Sprite,this.paintTexture=null,this.paintTextureSprite=new PIXI.Sprite,this.referenceContainer=new PIXI.Container,this.referenceContainer.addChild(this.textureCloneSprite),this.referenceContainer.addChild(this.paintTextureSprite),this.prevTexture=null,this.altTexture=null,this.regionTexture=null,this.regionSprite=new PIXI.Sprite,this.lowerResolutionForLargeImages=!0,this.enabled=!0,this._paintingEnabled=!0,this.dispatchEventsAfterUpdate=!0,this.eraseMode=!1,this.singleClick=!1,this.ignoreInitialPress=!1,this.ignoreMouseMove=!1,this._brushSizeFactor=.25,this.brushRadius=25,this.brushHardness=1,this.brushStrength=1,this.brushOpacity=1,this._brushColor=16777215,this.painterWidth=0,this.painterHeight=0,this._scale=1,this._adjustScale=1,this.isSetup=!1,this.setupPending=!1,this.delaySetupTillPaintingEnabled=!1,this.brushEnabled=!0,this.allowBrushCircle=!1,this.clicksEnabled=!0,this.scaleAffectsBrushRadius=!0,this.minBrushRadius=1,this.maxBrushRadius=BFN.maxBrushSize/2,this.brushStepDistance=10,this.brushX=0,this.brushX=0,this.brushPoint=new PIXI.Point,this.brushRect=new PIXI.Rectangle,this.brushBeta=0,this.backgroundColor=null,this.nearestScaleMode=!1,this._paintBounds={x:5,y:5,width:20,height:20,left:5,top:5,right:25,bottom:25},this._paintApplied=!1,this.brushGraphic=new PIXI.Graphics,this.staggerEnabled=!1,this.staggerInterval=5,this.staggerTimer=0,this.mouseDown=!1,this.mouseHovering=!1,this.brushSizeChanged=!1,this.hideBrushCircleAfterPaint=!1,this.batchRender=!1,this.brushPoints=[],this.brushDragRequested=!1,this.subjectIsolated=!1,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleHoveredMouseMoveBind=this.handleHoveredMouseMove.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseMoveBind=this.handleMouseMove.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this.handleCanvasScalingUpdatedBind=this.handleCanvasScalingUpdated.bind(this),this.preUndoCallback=null,this.preRedoCallback=null},px.prototype.initBrushPool=function(){BFN.hasOwnProperty("BrushPool")||(BFN.BrushPool=new BFN.SpritePool,BFN.BrushPool.grow(200)),this.brushPool=BFN.BrushPool,this.brushSpriteContainer=new PIXI.particles.ParticleContainer(5e3,{scale:!1,position:!0,rotation:!1,uvs:!1,alpha:!1}),this.maskRegionGraphic=new PIXI.Graphics,this.maskRegionGraphic.beginFill(16777215,1),this.maskRegionGraphic.drawRect(0,0,100,100),this.maskRegionGraphic.endFill(),BFN.Stage.state.blendModes[20]=[0,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA]},px.prototype.initBrush=function(){this.brush=new BFN.ImagePainterBrush,this.brush.radius=this.brushRadius,this.brush.hardness=this.brushHardness,this.brush.strength=this.brushStrength},px.prototype.setup=function(e,t){this.reset(),this.painterWidth=e,this.painterHeight=t,this.texture&&(this.texture.destroyGC(!0),this.texture=null),this.texture=null,this.setupPending=!0,(!this.delaySetupTillPaintingEnabled||this.delaySetupTillPaintingEnabled&&this._paintingEnabled)&&this.completeSetup(),BFN.ImagePainterUndoManager.setImagePainter(this)},px.prototype.completeSetup=function(){var e=this;if(this.enabled&&this.setupPending){var t=this.lowerResolutionForLargeImages&&this.painterWidth*this.painterHeight>Math.pow(2048,2)?.5:1,n=this.nearestScaleMode?PIXI.SCALE_MODES.NEAREST:PIXI.settings.SCALE_MODE;this.texture=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight,n,t),null===this.backgroundColor?this.texture.clear():this.texture.fillColor(this.backgroundColor),this.textureClone=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight,PIXI.settings.SCALE_MODE,t),null===this.backgroundColor?this.textureClone.clear():this.textureClone.fillColor(this.backgroundColor),this.textureCloneSprite.texture=this.textureClone,this.paintTexture=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight),this.paintTexture.clear(),this.paintTextureSprite.texture=this.paintTexture,this.prevTexture=PIXI.RenderTexture.create(this.painterWidth,this.painterHeight,PIXI.settings.SCALE_MODE,t),this.prevTexture.clear(),this.updatePrevTexture(),this.updateHitArea(),this.brushSizeFactor=this.brushSizeFactor,requestAnimationFrame(function(){e.updateBrush()}),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind),this.on("pointerdown",this.handleMouseDownBind);var i=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents,BFN.CollageMakerCanvasModelEvents,BFN.DesignerCanvasModelEvents);i.addEventListener(r.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),this.isSetup=!0,this.setupPending=!1}},px.prototype.clear=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.paintApplied=!1,this.texture&&(null===this.backgroundColor?this.texture.clear():this.texture.fillColor(this.backgroundColor),this.paintTexture.clear(),null===this.backgroundColor?this.textureClone.clear():this.textureClone.fillColor(this.backgroundColor),e&&BFN.ImagePainterUndoManager.setImagePainter(this)),BFN.MainUI.requestRender()},px.prototype.reset=function(){if(this.paintApplied=!1,this.delaySetupTillPaintingEnabled&&(this._paintingEnabled=!1),this.isSetup){if(this.isSetup=!1,this.setupPending=!1,this.painterWidth=0,this.painterHeight=0,this.brush.reset(),this.texture){try{this.texture.destroyGC(!0)}catch(e){}this.texture=PIXI.Texture.EMPTY}try{this.textureClone.destroyGC(!0)}catch(e){}this.textureClone=null,this.textureCloneSprite.texture=PIXI.Texture.EMPTY;try{this.paintTexture.destroyGC(!0)}catch(e){}this.paintTexture=null,this.paintTextureSprite.texture=PIXI.Texture.EMPTY;try{this.prevTexture.destroyGC(!0)}catch(e){}this.prevTexture=null;try{this.regionTexture.destroyGC(!0)}catch(e){}this.regionTexture=null,this.regionSprite.texture=null,this.altTexture=null,this.updateHitArea(),BFN.ImagePainterUndoManager.reset(),BFN.BrushCirclePreview.hide(),BFN.BrushCircle.hide(),this.off("pointerover",this.handleMouseOverBind),this.off("pointerout",this.handleMouseOutBind),this.off("pointerdown",this.handleMouseDownBind),document.removeEventListener(BeFunky.pointerup,this.handleMouseUpBind,!0),BFN.MainUI.off("pointermove",this.handleMouseMoveBind);var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents,BFN.CollageMakerCanvasModelEvents,BFN.DesignerCanvasModelEvents);e.removeEventListener(t.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind)}},px.prototype.updateBrush=function(){this.brushGraphic.clear(),this.brushGraphic.beginFill(this._brushColor,1),this.brushGraphic.drawRect(0,0,2*this.brushRadius,2*this.brushRadius),this.brushGraphic.endFill(),this.brush.radius=this.brushRadius,this.brush.hardness=.98*this.brushHardness*Math.max(0,Math.min(1,this.brushHardnessAdjustFactor)),this.brush.strength=.95*this.brushHardness+.05,this.brush.opacity=this.brushOpacity,this.brush.updateBrush(),this.regionTexture?this.regionTexture.resize(2*this.brushRadius,2*this.brushRadius):this.regionTexture=PIXI.RenderTexture.create(2*this.brushRadius,2*this.brushRadius),this.regionSprite.texture=this.regionTexture,this.updateHitArea(),this.brushSizeChanged=!1,this.isSetup&&(this.mouseHovering&&this._paintingEnabled&&BFN.BrushCircle.show(this.brushRadius*this._scale/this._adjustScale),BFN.BrushCirclePreview.hide())},px.prototype.updateHitArea=function(){this.hitArea=new PIXI.Rectangle(-this.brushRadius,-this.brushRadius,this.painterWidth+2*this.brushRadius,this.painterHeight+2*this.brushRadius)},px.prototype.applyBrush=function(){this.paintApplied=!0,this.brushPoint.x=this.brushRect.x=this.brush.x=this.regionSprite.x=this.brushX-this.brushRadius,this.brushPoint.y=this.brushRect.y=this.brush.y=this.regionSprite.y=this.brushY-this.brushRadius,this.brushRect.width=2*this.brushRadius,this.brushRect.height=2*this.brushRadius,this._paintBounds.left=Math.max(0,Math.min(this._paintBounds.left,Math.floor(this.brushX-this.brushRadius))),this._paintBounds.right=Math.min(this.painterWidth,Math.max(this._paintBounds.right,Math.ceil(this.brushX+this.brushRadius))),this._paintBounds.top=Math.max(0,Math.min(this._paintBounds.top,Math.floor(this.brushY-this.brushRadius))),this._paintBounds.bottom=Math.min(this.painterHeight,Math.max(this._paintBounds.bottom,Math.ceil(this.brushY+this.brushRadius))),this.updatePaintBounds(),BFN.MainUI.requestRender(),this.dispatchEvent(BFN.ImagePainterEvents.BRUSH_APPLIED)},px.prototype.moveBrushTo=function(e,t){this.brushX=Math.floor(e),this.brushY=Math.floor(t),this.brushBeta=this.mouseDown?this.brushBeta:0,this._paintBounds.left=this._paintBounds.right=this.brushX,this._paintBounds.top=this._paintBounds.bottom=this.brushY,this.updatePaintBounds()},px.prototype.dragBrushTo=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Math.floor(e)-this.brushX,r=Math.floor(t)-this.brushY,a=Math.sqrt(i*i+r*r),o=Math.atan2(r,i);if(n||!(a<this.brushStepDistance)){this.brushBeta=this.mouseDown?this.brushBeta:o;var s=Math.max(1,Math.ceil(a/Math.max(1,this.brushStepDistance))),l=this.brushX,u=this.brushY;this.batchRender=!0,this.brushPoints.splice(0);for(var c=1;c<=s;c++)this.brushPoints.push(new PIXI.Point(Math.floor(l+Math.cos(o)*a*(c/s)),Math.floor(u+Math.sin(o)*a*(c/s))));if(this.brushPoints.length){if(this.brushEnabled){this.eraseMode?this.paintTextureSprite.blendMode=20:this.paintTextureSprite.blendMode=0,this.brushPool.growTo(this.brushPoints.length);for(var h=0;h<this.brushPoints.length;h++){var d=this.brushPool.getSprite(h,this.brushPoints[h],this.brush.texture);this.brushSpriteContainer.addChild(d)}var m=this.getDraggedBrushBounds(this.brushPoints,this.brushRadius);this.maskRegionGraphic.clear(),this.maskRegionGraphic.beginFill(16777215,1),this.maskRegionGraphic.drawRect(m.x,m.y,m.width,m.height),this.maskRegionGraphic.endFill(),this.brushSpriteContainer.mask=this.maskRegionGraphic,BFN.Stage.render(this.brushSpriteContainer,this.paintTexture,!1),this.brushSpriteContainer.mask=null,this.brushSpriteContainer.children.length&&this.brushSpriteContainer.removeChildren(0,this.brushSpriteContainer.children.length),this.texture.clearRect(m.x,m.y,m.width,m.height),this.referenceContainer.mask=this.maskRegionGraphic,BFN.Stage.render(this.referenceContainer,this.texture,!1),this.referenceContainer.mask=null}for(var p=0;p<this.brushPoints.length;p++)this.brushX=this.brushPoints[p].x,this.brushY=this.brushPoints[p].y,this.applyBrush();this.batchRender=!1}}},px.prototype.getDraggedBrushBounds=function(e,t){var n={x:0,y:0,width:0,height:0};if(e.length){var i,r,a,o,s=e[0],l=e[e.length-1],u=l.x-s.x,c=l.y-s.y;u<0?c<0?(i=l.x,r=l.y,a=s.x,o=s.y):(i=l.x,r=s.y,a=s.x,o=l.y):c<0?(i=s.x,r=l.y,a=l.x,o=s.y):(i=s.x,r=s.y,a=l.x,o=l.y),n.x=i-t,n.y=r-t,n.width=a-i+2*t,n.height=o-r+2*t}return n},px.prototype.updatePrevTexture=function(){this.altTexture?this.prevTexture.copyPixels(this.altTexture):this.prevTexture.copyPixels(this.texture)},px.prototype.updatePaintBounds=function(){this._paintBounds.x=this._paintBounds.left,this._paintBounds.y=this._paintBounds.top,this._paintBounds.width=Math.abs(this._paintBounds.right-this._paintBounds.left),this._paintBounds.height=Math.abs(this._paintBounds.bottom-this._paintBounds.top)},px.prototype.updateComplete=function(){this.textureClone.copyPixels(this.texture),this.paintTexture.clear()},px.prototype.updateStaggerTimer=function(){this.mouseDown&&(this.staggerTimer++,this.staggerTimer>=this.staggerInterval&&(this.staggerTimer=0,this.applyBrush()),setTimeout(this.updateStaggerTimer.bind(this),0))},px.prototype.cancelPaintStroke=function(){this.mouseDown&&(this.paintTexture.clear(),this.altTexture?this.altTexture.copyPixels(this.prevTexture):this.texture.copyPixels(this.prevTexture),this.dispatchEvent(BFN.ImagePainterEvents.BRUSH_APPLIED),this.mouseDown=!1,this.brushDragRequested=!1,this.mouseHovering||this.handleMouseOutBind(this),document.removeEventListener(BeFunky.pointerup,this.handleMouseUpBind,!0),this.singleClick&&!this.altTexture||BFN.MainUI.off("pointermove",this.handleMouseMoveBind),window.UIScreens.toggleMouseEvent(!0))},px.prototype.showBrushCircle=function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);!this.isSetup||t.canvasScaling||this.brushSizeChanged||!this._paintingEnabled&&!this.allowBrushCircle||BFN.BrushCircle.show(this.brushRadius*this._scale/this._adjustScale,e)},px.prototype.hideBrushCircle=function(){this.isSetup&&BFN.BrushCircle.showing&&!this.mouseDown&&BFN.BrushCircle.hide()},px.prototype.handleMouseOver=function(e){this.mouseHovering=!0,BFN.MainUI.on("pointermove",this.handleHoveredMouseMoveBind),this.brushSizeChanged&&this.updateBrush(),this.showBrushCircle(e)},px.prototype.handleMouseOut=function(e){this.mouseHovering=!1,BFN.MainUI.off("pointermove",this.handleHoveredMouseMoveBind),this.hideBrushCircle()},px.prototype.handleHoveredMouseMove=function(e){this.isSetup&&!BFN.BrushCircle.showing&&this.showBrushCircle(e)},px.prototype.handleMouseDown=function(e){if(e&&e.data&&e.data.originalEvent){if(2===e.data.originalEvent.button)return;if(this.mouseDown)return}if(this._paintingEnabled&&this.clicksEnabled){this.mouseDown=!0,this.brushDragRequested=!1,this.updatePrevTexture(),BFN.Stage.render(this.brushGraphic,this.brush.sourceTexture),this.brush.updateFilter(),this.brushBeta=0,this.mouseStartPosition=this.getPointerPosition(e);var t=this.getMousePosition();t.x!=this.mouseStartPosition.x&&t.y!=this.mouseStartPosition.y&&(this.hideBrushCircleAfterPaint=!0,this.showBrushCircle(e)),this.moveBrushTo(this.mouseStartPosition.x,this.mouseStartPosition.y),this.ignoreInitialPress||this.dragBrushTo(this.mouseStartPosition.x,this.mouseStartPosition.y,!0),window.UIScreens.toggleMouseEvent(!1),document.addEventListener(BeFunky.pointerup,this.handleMouseUpBind,!0),this.dispatchEvent(BFN.ImagePainterEvents.PAINTING_STARTED),this.singleClick||(this.staggerEnabled&&(this.staggerTimer=0,this.updateStaggerTimer()),BFN.MainUI.on("pointermove",this.handleMouseMoveBind),BFN.smoothPictureDisabled=!0)}},px.prototype.handleMouseMove=function(e){this.ignoreMouseMove||(this.staggerTimer=0,this.lastMouseMoveEvent=e,this.brushDragRequested||(this.brushDragRequested=!0,this.handleMainUIPreRenderBind||(this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)),BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)))},px.prototype.handleMainUIPreRender=function(e){BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.processBrushDrag(this.lastMouseMoveEvent)},px.prototype.processBrushDrag=function(e){if(this.brushDragRequested&&this.mouseDown){this.brushDragRequested=!1,this.mouseCurrentPosition=this.getPointerPosition(e);var t=this.mouseCurrentPosition.x-this.mouseStartPosition.x,n=this.mouseCurrentPosition.y-this.mouseStartPosition.y;this.brushBeta=Math.atan2(n,t),this.dragBrushTo(this.mouseCurrentPosition.x,this.mouseCurrentPosition.y),this.mouseStartPosition=this.mouseCurrentPosition}},px.prototype.handleMouseUp=function(e){BFN.smoothPictureDisabled=!1,this.mouseDown=!1,this.brushDragRequested=!1,this.mouseHovering?this.hideBrushCircleAfterPaint&&(this.hideBrushCircle(),this.hideBrushCircleAfterPaint=!1):this.handleMouseOutBind(this),this.dispatchEvent(BFN.ImagePainterEvents.PAINTING_COMPLETE),this.updateComplete(),document.removeEventListener(BeFunky.pointerup,this.handleMouseUpBind,!0),window.UIScreens.toggleMouseEvent(!0),this.singleClick&&!this.altTexture||(BFN.MainUI.off("pointermove",this.handleMouseMoveBind),this.dispatchEventsAfterUpdate&&(this.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED_PRE_HISTORY),this.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)))},px.prototype.handleCanvasScalingUpdated=function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);BFN.ImagePainterUndoManager.currentImagePainter!=this||t.canvasScaling||(this.toolScale=this._scale,this.updateBrush())},Object.defineProperty(px.prototype,"toolScale",{set:function(e){this._scale=e,this.scaleUpdated=!0,this.brushSizeFactor=this.brushSizeFactor,this.scaleUpdated=!1},get:function(){return this._scale}}),Object.defineProperty(px.prototype,"adjustScale",{set:function(e){this._adjustScale=e},get:function(){return this._adjustScale}}),Object.defineProperty(px.prototype,"brushSizeFactor",{set:function(e){this._brushSizeFactor=Math.max(0,Math.min(1,e));var t=e*e;this.scaleAffectsBrushRadius?this.brushRadius=Math.round((Math.min(this.maxBrushRadius,this.painterWidth/2,this.painterHeight/2,this.painterWidth/2*(1/this._scale),this.painterHeight/2*(1/this._scale))-this.minBrushRadius)*t+this.minBrushRadius):this.brushRadius=Math.round((Math.min(this.maxBrushRadius,this.painterWidth/2,this.painterHeight/2)-this.minBrushRadius)*t+this.minBrushRadius),this.brushStepDistance=Math.round(Math.max(this.brushRadius/4,1)),this.dispatchEvent(BFN.ImagePainterEvents.BRUSH_RADIUS_UPDATED),BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel).canvasScaling||(this.brushSizeChanged||(this.brushSizeChanged=!0,this.isSetup&&BFN.BrushCircle.showing&&BFN.BrushCircle.hide()),this.isSetup&&!this.scaleUpdated&&BFN.BrushCirclePreview.show(this.brushRadius*this._scale/this._adjustScale)),this.targetStep=Math.round(Math.min(Math.max(Math.max(this.painterWidth,this.painterHeight)/(2*this.brushRadius),4),10))},get:function(){return this._brushSizeFactor}}),Object.defineProperty(px.prototype,"brushHardnessFactor",{set:function(e){this.brushHardness=Math.max(0,Math.min(1,e))},get:function(){return this.brushHardness}}),Object.defineProperty(px.prototype,"brushStrengthFactor",{set:function(e){this.brushStrength=Math.max(0,Math.min(1,.95*e+.05)),this.paintTextureSprite.alpha=this.brushStrength},get:function(){return this.brushStrength}}),Object.defineProperty(px.prototype,"brushOpacityFactor",{set:function(e){this.brushOpacity=Math.max(0,Math.min(1,e))},get:function(){return this.brushOpacity}}),Object.defineProperty(px.prototype,"brushColor",{set:function(e){this._brushColor=e},get:function(){return this._brushColor}}),Object.defineProperty(px.prototype,"paintingEnabled",{set:function(e){this._paintingEnabled!=e&&(this._paintingEnabled=e,this.delaySetupTillPaintingEnabled&&this._paintingEnabled&&this.completeSetup(),this.dispatchEvent(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED))},get:function(){return this._paintingEnabled}}),Object.defineProperty(px.prototype,"paintBounds",{set:function(e){e&&(this._paintBounds.x=this._paintBounds.left=Math.floor(e.x)-1,this._paintBounds.y=this._paintBounds.top=Math.floor(e.y)-1,this._paintBounds.width=Math.ceil(e.width)+2,this._paintBounds.height=Math.ceil(e.height)+2,this._paintBounds.right=this._paintBounds.x+this._paintBounds.width,this._paintBounds.bottom=this._paintBounds.y+this._paintBounds.height)},get:function(){return this._paintBounds}}),Object.defineProperty(px.prototype,"paintApplied",{set:function(e){e!=this._paintApplied&&(this._paintApplied=e,this.dispatchEvent(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED))},get:function(){return BFN.ImagePainterUndoManager.currentImagePainter===this?this._paintApplied||BFN.ImagePainterUndoManager.memoryFreed:this._paintApplied}}),BFN.ImagePainter=px,gx.prototype=Object.create(PIXI.Sprite.prototype),gx.prototype.init=function(){BeFunky.log("ImageTouchUp Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initRenderSprite(),this.initPainter()},gx.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._scale=1,this.active=!1,BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectComplete.bind(this))},gx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},gx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},gx.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},gx.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.brushOpacityFactor=.1,this.painter.brushHardnessAdjustFactor=.7,this.imageContainer.addChild(this.painter),this.renderSprite.mask=this.painter},gx.prototype.handleTouchUpBrush=function(){this.updateTouchUpBrushParameters()},gx.prototype.handleUpdateTool=function(e){var t=this;if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP){var n=e,i=null;if(BFN.effectPresetMap.hasOwnProperty("touchup_"+n)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap["touchup_"+n])&&(i=BFN.effectPresetMap["touchup_"+n]),i){switch(this.painter.brushOpacityFactor=.1,this.painter.brushHardnessAdjustFactor=.7,n){case"fix_redeye":this.painter.brushOpacityFactor=1,this.painter.brushHardnessAdjustFactor=1}var r=!1;n!=i&&UITools.getToolVO(i)!=UITools.getToolVO(n)&&(UITools.toolVOs[i]=UITools.getToolVO(n),r=!0);var a=UITools.getToolVO(n);this.currentToolID!=e&&(this.currentToolID=e,UITools.setToolValue("touch_up_brush","size",Math.round(100*a.brush_size)),UITools.setToolValue("touch_up_brush","hardness",Math.round(100*a.brush_hardness)),UITools.updateToolControls("touch_up_brush"),this.updateTouchUpBrushParameters());var o=!1;if(BFN.EffectManager.effectID!=i||r){o=!0,BFN.applyCancelMenu.setStyles({pointerEvents:"none"}),clearTimeout(this.timeoutID);this.timeoutID=setTimeout(function e(){BFN.MainUI.viewportUpdating?t.timeoutID=setTimeout(e,16):(t.active&&(BFN.EffectManager.effectID=i),BFN.applyCancelMenu.setStyles({pointerEvents:""}))},16)}BFN.EffectManager.changing!=a.updating&&(BFN.EffectManager.changing=a.updating),o||(BFN.EffectManager.parameters=a),a.updating||o||BFN.EffectManager.processEffect()}}},gx.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null),this.active=!1,this.currentToolID=null,null!=e?(this.active=!0,this.sourceTexture=e,this.renderTexture=PIXI.RenderTexture.create(32,32),BFN.EffectManager.setSourceTexture(this.sourceTexture),BFN.EffectManager.setRenderTexture(this.renderTexture),BFN.EffectManager.currentComponent=this,this.sourceSprite.texture=this.sourceTexture,this.renderSprite.texture=this.renderTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),UITools.setToolValue("touch_up_brush","erase",!1),UITools.updateToolControl("touch_up_brush_erase"),this.updateTouchUpBrushParameters()):(this.painter.reset(),BFN.EffectManager.currentComponent==this&&BFN.EffectManager.reset())},gx.prototype.updateTouchUpBrushParameters=function(){var e=UITools.getToolVO("touch_up_brush");if(e){e.clear&&(this.painter.clear(!0),UITools.setToolValue("touch_up_brush","erase",!1),UITools.updateToolControl("touch_up_brush_erase")),this.painter.eraseMode!=e.erase&&(this.painter.eraseMode=e.erase),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var t=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,t=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,t=!0),t&&this.painter.updateBrush(),this.currentToolID&&(UITools.setToolValue(this.currentToolID,"brush_size",this.painter.brushSizeFactor),UITools.setToolValue(this.currentToolID,"brush_hardness",this.painter.brushHardnessFactor))}},gx.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.renderSprite.currentScale=e,this.painter.currentScale=e},gx.prototype.handleEffectComplete=function(){BFN.MainUI.requestRender()},Object.defineProperty(gx.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(gx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceSprite.width,this.sourceSprite.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),e}}),Object.defineProperty(BFN,"ImageTouchUp",{get:function(){return!BFN._ImageTouchUp&&(BFN._ImageTouchUp=new gx),BFN._ImageTouchUp}}),BFN.ImageEffectEvents={CLEAR_PAINT:new Event("CLEAR_PAINT"),INVERSE_PAINT:new Event("INVERSE_PAINT")},fx.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),fx.prototype.init=function(){BeFunky.log("ImageEffect Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initRenderSprite(),this.initMaskBlendSprite(),this.initMaskSprite(),this.initPainter()},fx.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._inverse=!1,this._scale=1,this.active=!1,this.effectToolVO=null,this.effectReady=!1,this.effectFadeable=!1,this.sourceTransparency=!1,this.transparentMode=!1,BFN.EffectManager.addEventListener(BFN.EffectManagerEvents.EFFECT_COMPLETE.type,this.handleEffectComplete.bind(this))},fx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},fx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},fx.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},fx.prototype.initMaskBlendSprite=function(){this.maskBlendSprite=new BFN.MaskBlendSprite,this.maskBlendSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.maskBlendSprite)},fx.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},fx.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.paintingEnabled=!1,this.painter.delaySetupTillPaintingEnabled=!0,this.imageContainer.addChild(this.painter),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handlePainterUpdated.bind(this)),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},fx.prototype.handleEffectGeneric=function(){var e=UITools.getToolVO("effect_generic");"amount"===e.updating_id&&(this.updateEffectIntensity(),this.effectToolVO&&this.effectToolVO.hasOwnProperty("amount")&&(this.effectToolVO.amount=e.amount),BFN.MainUI.requestRender())},fx.prototype.handleEffectBrush=function(){this.updateEffectBrushParameters()},fx.prototype.handleUpdateTool=function(e){var t=this;if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT){var n=e,i=null;if(BFN.effectMap.hasOwnProperty(n)?i=n:BFN.effectPresetMap.hasOwnProperty(n)&&BFN.effectMap.hasOwnProperty(BFN.effectPresetMap[n])&&(i=BFN.effectPresetMap[n]),!i)return;var r=!1;n!==i&&UITools.getToolVO(i)!==UITools.getToolVO(n)&&(UITools.toolVOs[i]=UITools.getToolVO(n),r=!0,this.effectReady=!1),this.painter.visible=!BFN.EffectsNoPaint.includes(n);var a=UITools.getToolVO(n);this.effectFadeable=!!a.fadeable,this.effectToolVO=a,this.effectToolVO.hasOwnProperty("amount")||(this.effectToolVO.amount=100),this.currentToolID!==e&&(this.currentToolID=e,UITools.setToolValue("effect_generic","amount",a.hasOwnProperty("amount")?a.amount:100),UITools.applyTool("effect_generic"),UITools.updateToolControls("effect_generic")),"reset"===a.updating_id&&(Object.assign(a,a.defaultValues),UITools.updateToolControls(n),this.painter.clear(!0),UITools.setToolValue("effect_brush","erase",!1),UITools.updateToolControl("effect_brush_erase"));var o=!1;(BFN.EffectManager.effectID!==i||r)&&(o=BFN.EffectManager.autoProcess,BFN.applyCancelMenu.setStyles({pointerEvents:"none"}),cancelAnimationFrame(this.timeoutRAF),this.timeoutRAF=requestAnimationFrame(function(){t.active&&(BFN.EffectManager.effectID=i),BFN.applyCancelMenu.setStyles({pointerEvents:""})}),this.updateMaskDisplay()),BFN.EffectManager.changing!==a.updating&&(a.hasOwnProperty("real_time")&&!a.real_time||(BFN.EffectManager.changing=a.updating)),o||a.hasOwnProperty("real_time")&&!a.real_time||(BFN.EffectManager.parameters=a),a.updating||o||BFN.EffectManager.processEffect()}},fx.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null,this.renderSprite.texture=PIXI.Texture.EMPTY),this.active=!1,this.currentToolID=null,this.effectReady=!1,this.effectFadeable=!1,this.sourceTransparency=!1,e?(this.active=!0,this.sourceTexture=e,this.renderTexture=e.renderClone(),BFN.EffectManager.autoProcess=!1,BFN.EffectManager.setSourceTexture(this.sourceTexture),BFN.EffectManager.setRenderTexture(this.renderTexture),BFN.EffectManager.currentComponent=this,BFN.EffectManager.autoProcess=!0,this.sourceTransparency=this.sourceTexture.determineTransparency(),this.updateTransparentMode(!0),this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("effect_brush","show_mask",!1),UITools.setToolValue("effect_brush","select_action","subtract"),UITools.updateToolControls("effect_brush"),this.updateEffectBrushParameters()):(this.renderSprite.mask=null,this.maskBlendSprite.reset(),this.painter.reset(),BFN.EffectManager.currentComponent===this&&BFN.EffectManager.reset())},fx.prototype.updateEffectIntensity=function(){var e=UITools.getToolVO("effect_generic");this.transparentMode?this.maskBlendSprite.blendIntensity=e.amount/100:this.renderSprite.alpha=e.amount/100},fx.prototype.updateTransparentMode=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.sourceTransparency||!(!BFN.EffectManager.currentEffect||!BFN.EffectManager.currentEffect.outputTransparent);(this.transparentMode!==t||e)&&(this.transparentMode=t,this.transparentMode?(this.sourceSprite.visible=!1,this.sourceSprite.texture=this.sourceTexture,this.renderSprite.visible=!1,this.renderSprite.texture=PIXI.Texture.EMPTY,this.maskBlendSprite.visible=!0,this.maskBlendSprite.inputTexture=this.sourceTexture,this.maskBlendSprite.blendTexture=this.renderTexture,e||(this.showMask=this.showMask,this.handlePainterUpdated())):(this.renderSprite.visible=!0,this.renderSprite.texture=this.renderTexture,this.sourceSprite.visible=!0,this.sourceSprite.texture=this.sourceTexture,this.maskBlendSprite.visible=!1,this.maskBlendSprite.reset()),e||(this.updateEffectIntensity(),this.updateMaskDisplay()))},fx.prototype.updateEffectBrushParameters=function(){var e=this,t=UITools.getToolVO("effect_brush");if(t){if("isolate_subject"===t.updating_id&&!t.updating){for(var n=["blur","glow","replace_color","cinematic_film_grain","holgaart","motioncolor","multimedia","orton","sunburst","viewfinder","winter"],i=!1,r=0;r<n.length;r++){var a=n[r];if(this.currentToolID.includes(a)){i=!0;break}}var o=i?this.inverse:!this.inverse;return this.sourceTexture.altTexture=this.renderTexture,this.sourceTexture.altTextureInverse=!i,void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,o,function(){delete e.sourceTexture.altTexture,delete e.sourceTexture.altTextureInverse})}t.clear&&(this.painter.clear(!0),UITools.setToolValue("effect_brush","erase",!1),UITools.updateToolControl("effect_brush_erase"),this.transparentMode&&this.maskBlendSprite.updateDisplay(),this.inverse&&(this.inverse=!1,this.updateMaskDisplay()),this.dispatchEvent(BFN.ImageEffectEvents.CLEAR_PAINT)),this.showMask!==t.show_mask&&(this.showMask=t.show_mask,this.updateMaskDisplay()),"invert"===t.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var s="subtract"===t.select_action?this.inverse:!this.inverse;this.painter.eraseMode!==s&&(this.painter.eraseMode=s),t.updating&&"size"===t.updating_id&&this.painter.brushSizeFactor!=t.size/100&&(this.painter.brushSizeFactor=t.size/100);var l=!1;t.updating||"size"!==t.updating_id&&this.painter.brushSizeFactor==t.size/100||(this.painter.brushSizeFactor=t.size/100,l=!0),t.updating||"hardness"!==t.updating_id&&this.painter.brushHardnessFactor==t.hardness/100||(this.painter.brushHardnessFactor=t.hardness/100,l=!0),t.updating||"strength"!==t.updating_id&&this.painter.brushStrengthFactor==t.strength/100||(this.painter.brushStrengthFactor=t.strength/100,l=!0),l&&this.painter.updateBrush()}},fx.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.sourceSprite.visible=e&&this.transparentMode||!this.transparentMode&&(this.effectFadeable||this.painter.paintApplied||!this.painter.paintApplied&&(e||this.inverse)),this.renderSprite.visible=!(e||this.inverse&&!this.painter.paintApplied||this.transparentMode),this.maskBlendSprite.visible=!e&&this.transparentMode,this.maskSprite.visible=e&&!(this.inverse&&!this.painter.paintApplied);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.renderSprite.mask!==t&&(this.renderSprite.mask=this.transparentMode?null:t),this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},fx.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.renderSprite.currentScale=e,this.maskBlendSprite.currentScale=e,this.painter.currentScale=e},fx.prototype.handleEffectComplete=function(){this.updateTransparentMode(),this.effectReady||(this.effectReady=!0,this.inverse=this.inverse),this.transparentMode&&this.maskBlendSprite.updateDisplay()},fx.prototype.handlePainterUpdated=function(e){BFN.ImagePainterUndoManager.currentImagePainter===this.painter&&this.painter.isSetup&&this.transparentMode&&(this.maskBlendSprite.maskTexture!==this.painter.texture&&(this.maskBlendSprite.maskTexture=this.painter.texture),this.maskBlendSprite.updateDisplay())},fx.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},fx.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("effect_brush","show_mask",!1),UITools.updateToolControl("effect_brush_show_mask"),this.showMask=UITools.getToolValue("effect_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty(fx.prototype,"showMask",{set:function(e){this._showMask=e,this.transparentMode&&(this.maskBlendSprite.autoRender=!this.showMask)},get:function(){return this._showMask}}),Object.defineProperty(fx.prototype,"inverse",{set:function(e){this._inverse=e,this.maskBlendSprite.inverse=this._inverse,this.painter.inverseMask=!this._inverse,this.dispatchEvent(BFN.ImageEffectEvents.INVERSE_PAINT),BFN.MainUI.requestRender()},get:function(){return this._inverse}}),Object.defineProperty(fx.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(fx.prototype,"modifiedTexture",{get:function(){this.transparentMode&&this.maskBlendSprite.displayUpdatePending&&this.maskBlendSprite.renderDisplay();var e=PIXI.RenderTexture.create(this.sourceSprite.width,this.sourceSprite.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}}),Object.defineProperty(BFN,"ImageEffect",{get:function(){return BFN._ImageEffect||(BFN._ImageEffect=new fx),BFN._ImageEffect}}),vx.prototype=Object.create(PIXI.Sprite.prototype),vx.prototype.init=function(){BeFunky.log("ImageArtsy Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initRenderSprite(),this.initMaskBlendSprite(),this.initMaskSprite(),this.initPainter()},vx.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._inverse=!1,this._scale=1,this.sourceTransparency=!1,BFN.ArtsyManager.addEventListener(BFN.ArtsyManagerEvents.ARTSY_COMPLETE.type,this.handleArtsyComplete.bind(this))},vx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},vx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},vx.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},vx.prototype.initMaskBlendSprite=function(){this.maskBlendSprite=new BFN.MaskBlendSprite,this.maskBlendSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.maskBlendSprite)},vx.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},vx.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.paintingEnabled=!1,this.painter.delaySetupTillPaintingEnabled=!0,this.imageContainer.addChild(this.painter),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handlePainterUpdated.bind(this)),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},vx.prototype.handleArtsyGeneric=function(){var e=UITools.getToolVO("artsy_generic");"amount"==e.updating_id&&(this.sourceTransparency?this.maskBlendSprite.blendIntensity=e.amount/100:this.renderSprite.alpha=e.amount/100,BFN.MainUI.requestRender())},vx.prototype.handleArtsyBrush=function(){this.updateArtsyBrushParameters()},vx.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY){var t=e,n=UITools.getToolVO(t);if(!n||n&&(n.updating||!n.hasOwnProperty("id")))return;var i=BFN.ArtsyToolIDs.hasOwnProperty(t)&&BFN.ArtsyToolParams.hasOwnProperty(t),r=BFN.ArtsyAdjustAndPaintToolObjects.hasOwnProperty(t);this.currentToolID!=t&&(i||r)&&(this.currentToolID=t,UITools.setToolValue("artsy_generic","amount",100),UITools.applyTool("artsy_generic"),UITools.updateToolControls("artsy_generic"));var a=n.id,o={},s=!1,l=null;if(i){for(var u=BFN.ArtsyToolParams[t],c=0;c<u.length;c++){var h=u[c];if(n.hasOwnProperty(h)){var d=BFN.ArtsyToolColorParams.hasOwnProperty(t)&&BFN.ArtsyToolColorParams[t].length&&-1!=BFN.ArtsyToolColorParams[t].indexOf(h);o[h]=(d?"#":"")+n[h]}}var m=BFN.ArtsyPresetObjects[t];s=!m.hasOwnProperty("isArtsy")||m.isArtsy,l=m.hasOwnProperty("maxPixels")?m.maxPixels:null}else{if(!r)return;for(var p in n.defaultValues)if(!["id","maxPixels"].includes(p)){var g=UITools.getParamObject(t+"_"+p),f=!!(g&&g.type&&g.type.includes("color"));o[p]=(f?"#":"")+n[p]}l=n.hasOwnProperty("maxPixels")?n.maxPixels:null}BFN.ArtsyService.currentArtsyID=a,BFN.ArtsyService.isArtsy=s,BFN.ArtsyService.maxPixels=l,BFN.ArtsyManager.parameters=o}},vx.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null,this.renderSprite.texture=PIXI.Texture.EMPTY),this.currentToolID=null,this.sourceTransparency=!1,null!=e?(this.sourceTexture=e,this.renderTexture=e.renderClone(),this.sourceTexture.baseTexture.hasOwnProperty("isTransparent"),this.sourceTransparency=this.sourceTexture.determineTransparency(),BFN.ArtsyManager.setSourceTexture(this.sourceTexture),BFN.ArtsyManager.setRenderTexture(this.renderTexture),this.sourceTransparency?(this.sourceSprite.texture=this.sourceTexture,this.sourceSprite.visible=!1,this.renderSprite.visible=!1,this.maskBlendSprite.visible=!0,this.maskBlendSprite.inputTexture=this.sourceTexture,this.maskBlendSprite.blendTexture=this.renderTexture):(this.maskBlendSprite.visible=!1,this.sourceSprite.visible=!0,this.renderSprite.visible=!0,this.sourceSprite.texture=this.sourceTexture,this.renderSprite.texture=this.renderTexture),this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("artsy_brush","show_mask",!1),UITools.setToolValue("artsy_brush","select_action","subtract"),UITools.updateToolControls("artsy_brush"),this.updateArtsyBrushParameters()):(this.renderSprite.mask=null,this.maskBlendSprite.reset(),this.painter.reset(),BFN.ArtsyManager.reset())},vx.prototype.updateArtsyBrushParameters=function(){var e=this,t=UITools.getToolVO("artsy_brush");if(t){if("isolate_subject"===t.updating_id&&!t.updating)return this.sourceTexture.altTexture=this.renderTexture,this.sourceTexture.altTextureInverse=!0,void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,!this.inverse,function(){delete e.sourceTexture.altTexture,delete e.sourceTexture.altTextureInverse});t.clear&&(this.painter.clear(!0),UITools.setToolValue("artsy_brush","erase",!1),UITools.updateToolControl("artsy_brush_erase"),this.sourceTransparency&&this.maskBlendSprite.updateDisplay(),this.inverse&&(this.inverse=!1,this.updateMaskDisplay())),this.showMask!==t.show_mask&&(this.showMask=t.show_mask,this.updateMaskDisplay()),"invert"===t.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var n="subtract"===t.select_action?this.inverse:!this.inverse;this.painter.eraseMode!=n&&(this.painter.eraseMode=n),t.updating&&"size"==t.updating_id&&this.painter.brushSizeFactor!=t.size/100&&(this.painter.brushSizeFactor=t.size/100);var i=!1;t.updating||"size"!=t.updating_id&&this.painter.brushSizeFactor==t.size/100||(this.painter.brushSizeFactor=t.size/100,i=!0),t.updating||"hardness"!=t.updating_id&&this.painter.brushHardnessFactor==t.hardness/100||(this.painter.brushHardnessFactor=t.hardness/100,i=!0),t.updating||"strength"!=t.updating_id&&this.painter.brushStrengthFactor==t.strength/100||(this.painter.brushStrengthFactor=t.strength/100,i=!0),i&&this.painter.updateBrush()}},vx.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.sourceSprite.visible=e&&this.sourceTransparency||!this.sourceTransparency,this.renderSprite.visible=!(e||this.inverse&&!this.painter.paintApplied||this.sourceTransparency),this.maskBlendSprite.visible=!e&&this.sourceTransparency,this.maskSprite.visible=e&&!(this.inverse&&!this.painter.paintApplied);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.renderSprite.mask!==t&&(this.renderSprite.mask=this.sourceTransparency?null:t),this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},vx.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.renderSprite.currentScale=e,this.maskBlendSprite.currentScale=e,this.painter.currentScale=e},vx.prototype.handleArtsyComplete=function(){this.updateMaskDisplay(),this.sourceTransparency&&this.maskBlendSprite.updateDisplay()},vx.prototype.handlePainterUpdated=function(e){BFN.ImagePainterUndoManager.currentImagePainter===this.painter&&this.painter.isSetup&&this.sourceTransparency&&(this.maskBlendSprite.maskTexture!==this.painter.texture&&(this.maskBlendSprite.maskTexture=this.painter.texture),this.maskBlendSprite.updateDisplay())},vx.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},vx.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("artsy_brush","show_mask",!1),UITools.updateToolControl("artsy_brush_show_mask"),this.showMask=UITools.getToolValue("artsy_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty(vx.prototype,"showMask",{set:function(e){this._showMask=e,this.sourceTransparency&&(this.maskBlendSprite.autoRender=!this.showMask)},get:function(){return this._showMask}}),Object.defineProperty(vx.prototype,"inverse",{set:function(e){this._inverse=e,this.maskBlendSprite.inverse=this._inverse,this.painter.inverseMask=!this._inverse,BFN.MainUI.requestRender()},get:function(){return this._inverse}}),Object.defineProperty(vx.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(vx.prototype,"modifiedTexture",{get:function(){this.sourceTransparency&&this.maskBlendSprite.displayUpdatePending&&this.maskBlendSprite.renderDisplay();var e=PIXI.RenderTexture.create(this.sourceSprite.width,this.sourceSprite.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}}),Object.defineProperty(BFN,"ImageArtsy",{get:function(){return!BFN._ImageArtsy&&(BFN._ImageArtsy=new vx),BFN._ImageArtsy}}),yx.prototype=Object.create(PIXI.Sprite.prototype),yx.prototype.init=function(){BeFunky.log("ImageBorder Init"),this.initDefaultValues(),this.initImageContainer(),this.initMatteSprite(),this.initSourceSprite(),this.initFrameSprite(),this.initCaptionGraphic()},yx.prototype.initDefaultValues=function(){this.baseTextureSize=32,this.sourceTexture=null,this._scale=1,this.imageContainerWidth=0,this.imageContainerHeight=0},yx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},yx.prototype.initMatteSprite=function(){this.matteSpriteTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.matteSprite=new PIXI.Sprite(this.matteSpriteTexture),this.matteSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.matteSprite)},yx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite),this.sourceSpriteMaskTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.sourceSpriteMask=new PIXI.Sprite(this.sourceSpriteMaskTexture),this.imageContainer.addChild(this.sourceSpriteMask),this.sourceSprite.mask=this.sourceSpriteMask},yx.prototype.initFrameSprite=function(){this.frameSpriteTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.frameSprite=new PIXI.Sprite(this.frameSpriteTexture),this.frameSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.frameSprite),this.frameSpriteMaskTexture=PIXI.RenderTexture.create(this.baseTextureSize,this.baseTextureSize),this.frameSpriteMask=new PIXI.Sprite(this.frameSpriteMaskTexture),this.frameSpriteMask.inverseMask=!0,this.imageContainer.addChild(this.frameSpriteMask),this.frameSprite.mask=this.frameSpriteMask},yx.prototype.initCaptionGraphic=function(){this.captionGraphic=new PIXI.Graphics,this.imageContainer.addChild(this.captionGraphic)},yx.prototype.handleBorder=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER&&this.sourceTexture&&(this.updateDisplay(),this.scale.x=this.scale.y=this.sourceTexture.height/this.imageContainerHeight,this.updateSmoothing(),this.itemWidth=Math.round(this.imageContainerWidth*this.scale.x)-2,this.itemHeight=Math.round(this.imageContainerHeight*this.scale.y)-2,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED))},yx.prototype.setSourceTexture=function(e){if(this.sourceTexture&&!e&&(this.resetTexture(this.matteSpriteTexture),this.resetTexture(this.sourceSpriteMaskTexture),this.resetTexture(this.frameSpriteTexture),this.resetTexture(this.frameSpriteMaskTexture)),null!==this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),e){this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2);var t=BFN.Util.getThumbTexture(this.sourceTexture,64),n=BFN.Util.isTransparent(t);t.destroyGC(!0),UITools.toggleControlItem("frame_border_matte_color",n),UITools.setToolValue("frame_border","outer_color","000000"),UITools.setToolValue("frame_border","inner_color","FFFFFF"),UITools.setToolValue("frame_border","matte_color",-1),UITools.setToolValue("frame_border","outer_thickness",50),UITools.setToolValue("frame_border","inner_thickness",50),UITools.setToolValue("frame_border","corner_radius",0),UITools.setToolValue("frame_border","caption_space",0),UITools.updateToolControls("frame_border"),UITools.applyTool("frame_border")}},yx.prototype.updateDisplay=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER&&this.sourceTexture){var e=UITools.getToolVO("frame_border"),t=-1===e.outer_color?-1:parseInt("0x"+e.outer_color),n=-1===e.inner_color?0:parseInt("0xFF"+e.inner_color),i=-1===e.matte_color?0:parseInt("0xFF"+e.matte_color),r=e.outer_thickness/100,a=e.inner_thickness/100,o=e.corner_radius/100,s=e.caption_space/100,l=this.sourceTexture.width,u=this.sourceTexture.height,c=Math.min(l,u),h=Math.round(r*c/8),d=Math.round(a*c/8),m=Math.round(l+2*(h+d)),p=Math.round(u+2*(h+d)),g=Math.round(s*c),f=(c/2+d)*o,v=c/2*o,y=Math.min(1,BFN.maxImageSize/Math.max(m,p)),x=Math.min(BFN.maxImageSize,Math.round(m*y)),_=Math.min(BFN.maxImageSize,Math.round(p*y)),I=x/m,T=_/p;this.imageContainerWidth=m,this.imageContainerHeight=p+g,this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageContainer.scale.x=1,this.imageContainer.scale.y=1,this.sourceSprite.x=this.sourceSprite.y=h+d,this.setTextureSize(this.matteSpriteTexture,x,_),this.setSpriteScale(this.matteSprite,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.matteSpriteTexture,{fillColor:i,cornerRadius:Math.max(1,v*y),edgePadding:0,padding:(h+d)*y}),this.setTextureSize(this.sourceSpriteMaskTexture,x,_),this.setSpriteScale(this.sourceSpriteMask,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.sourceSpriteMaskTexture,{fillColor:4294967295,cornerRadius:Math.max(1,v*y),edgePadding:0,padding:(h+d)*y}),this.setTextureSize(this.frameSpriteTexture,x,_),this.setSpriteScale(this.frameSprite,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.frameSpriteTexture,{fillColor:d>0?n:0,cornerRadius:Math.max(1,f*y),edgePadding:0,padding:h*y,backgroundColor:t}),this.setTextureSize(this.frameSpriteMaskTexture,x,_),this.setSpriteScale(this.frameSpriteMask,1/I,1/T),BFN.graphics.drawShape("roundedRect",this.frameSpriteMaskTexture,{fillColor:4294967295,cornerRadius:Math.max(1,(-1!==e.inner_color?v:f)*y),edgePadding:0,padding:h*y+(-1!==e.inner_color?d*y+(h+d>0?1:0):h+o>0?1:0)}),this.captionGraphic.clear(),g>0&&-1!==t&&(this.captionGraphic.beginFill(t,1),this.captionGraphic.drawRect(0,p,m,g),this.captionGraphic.endFill())}},yx.prototype.updateSmoothing=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER&&this.sourceTexture&&(this.setSpriteSmoothing(this.matteSprite,e),this.setSpriteSmoothing(this.sourceSprite,e),this.setSpriteSmoothing(this.frameSprite,e))},yx.prototype.resetTexture=function(e){e.width===this.baseTextureSize&&e.height===this.baseTextureSize||(e.resize(this.baseTextureSize,this.baseTextureSize),e.clear())},yx.prototype.setTextureSize=function(e,t,n){e.width===t&&e.height===n||e.resize(t,n)},yx.prototype.setSpriteScale=function(e,t,n){e.scale.x=t,e.scale.y=n},yx.prototype.setSpriteSmoothing=function(e,t){e.currentScale=e.scale.x*this.imageContainer.scale.x*(t?1:this._scale*this.scale.x),e.currentScaleY=e.scale.y*this.imageContainer.scale.y*(t?1:this._scale*this.scale.y)},Object.defineProperty(yx.prototype,"toolScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(yx.prototype,"modifiedTexture",{get:function(){var e=Math.min(1,BFN.maxImageSize/Math.max(this.imageContainerWidth,this.imageContainerHeight)),t=Math.min(BFN.maxImageSize,Math.round(this.imageContainerWidth*e)),n=Math.min(BFN.maxImageSize,Math.round(this.imageContainerHeight*e));this.imageContainer.x=this.imageContainer.y=0,this.imageContainer.scale.x=t/this.imageContainerWidth,this.imageContainer.scale.y=n/this.imageContainerHeight,this.updateSmoothing(!0);var i=PIXI.RenderTexture.create(t,n);return BFN.Stage.render(this.imageContainer,i),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageContainer.scale.x=this.imageContainer.scale.y=1,this.updateSmoothing(),i}}),Object.defineProperty(BFN,"ImageBorder",{get:function(){return!BFN._ImageBorder&&(BFN._ImageBorder=new yx),BFN._ImageBorder}}),xx.prototype=Object.create(PIXI.Sprite.prototype),xx.prototype.init=function(){BeFunky.log("ImageDropShadow Init"),this.initDefaultValues(),this.initImageContainer(),this.initBackground(),this.initBlurSprite(),this.initShadowSprite(),this.initSourceSprite(),this.initMaskSprite()},xx.prototype.initDefaultValues=function(){this._scale=1,this.shadowMapSize=1024,this.imageContainerWidth=0,this.imageContainerHeight=0,this.renderPending=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},xx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},xx.prototype.initBackground=function(){this.background=new PIXI.Graphics,this.imageContainer.addChild(this.background)},xx.prototype.initBlurSprite=function(){this.invertChannelFilter=new BFN.filters.InvertChannelFilter,this.directionalBlurFilter=new BFN.filters.DirectionalBlurFilter,this.directionalBlurFilter.blendAlpha=!0,this.directionalBlurFilter.iterations=4,this.directionalBlurFilter.biDirectional=!0,this.blurredTexture=null,this.blurTexture=null,this.blurSprite=new PIXI.Sprite},xx.prototype.initShadowSprite=function(){this.shadowTexture=null,this.shadowSprite=new PIXI.Sprite,this.shadowSprite.pluginName="blend_picture",this.imageContainer.addChild(this.shadowSprite)},xx.prototype.initSourceSprite=function(){this.sourceTexture=null,this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="blend_picture",this.imageContainer.addChild(this.sourceSprite)},xx.prototype.initMaskSprite=function(){this.maskTexture=null,this.maskSprite=new PIXI.Sprite,this.imageContainer.addChild(this.maskSprite)},xx.prototype.handleDropShadow=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW&&this.sourceTexture&&(this.renderPending||(this.renderPending=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),BFN.MainUI.requestRender())},xx.prototype.setSourceTexture=function(e){if(null!==this.blurredTexture&&(this.blurredTexture.destroyGC(!0),this.blurredTexture=null),null!==this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurTexture=null,this.blurSprite.texture=PIXI.Texture.EMPTY),null!==this.shadowTexture&&(this.shadowTexture.destroyGC(!0),this.shadowTexture=null,this.shadowSprite.texture=PIXI.Texture.EMPTY,this.shadowSprite.mask=null),null!==this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!==this.maskTexture&&(this.maskTexture.destroyGC(!0),this.maskTexture=null,this.maskSprite.texture=PIXI.Texture.EMPTY),e){this.sourceTexture=e,this.sourceSprite.texture=e,this.sourceW=this.sourceTexture.width,this.sourceH=this.sourceTexture.height,this.maxBlurRadius=Math.ceil(Math.sqrt(Math.pow(this.sourceW,2)+Math.pow(this.sourceH,2))/8);var t=Math.max(this.sourceW,this.sourceH);this.filterScaleFactor=this.shadowMapSize/(t+2*this.maxBlurRadius),this.filterMaxBlurRadius=Math.ceil(this.maxBlurRadius*this.filterScaleFactor);var n=this.shadowMapSize-2*this.filterMaxBlurRadius;this.filterScaleFactor=n/t,this.scaledSourceW=Math.round(this.sourceW*this.filterScaleFactor),this.scaledSourceH=Math.round(this.sourceH*this.filterScaleFactor),this.shadowMapW=Math.min(this.shadowMapSize,Math.round(this.scaledSourceW+2*this.filterMaxBlurRadius)),this.shadowMapH=Math.min(this.shadowMapSize,Math.round(this.scaledSourceH+2*this.filterMaxBlurRadius)),this.directionalBlurFilter.setDimensions(this.shadowMapW,this.shadowMapH,this.filterMaxBlurRadius),this.blurredTexture=PIXI.RenderTexture.create(this.shadowMapW,this.shadowMapH),this.blurTexture=PIXI.RenderTexture.create(this.shadowMapW,this.shadowMapH),this.blurTexture.copyPixels(this.sourceTexture,{x:this.filterMaxBlurRadius,y:this.filterMaxBlurRadius},!1,1,{x:this.scaledSourceW/this.sourceW,y:this.scaledSourceH/this.sourceH}),this.blurSprite.texture=this.blurTexture,this.blurSprite.filters=[this.directionalBlurFilter],this.maskTexture=this.sourceTexture.renderClone(),this.maskTexture.convertAlphaToLuma(),this.maskSprite.texture=this.maskTexture,this.maskSprite.visible=!1,this.imageContainer.x=-this.sourceW/2,this.imageContainer.y=-this.sourceH/2,this.shadowTexture=PIXI.RenderTexture.create(this.scaledSourceW,this.scaledSourceH),this.shadowSprite.texture=this.shadowTexture,this.shadowSprite.scale.x=this.shadowSprite.scale.y=1/this.filterScaleFactor,this.imageContainer.addChildAt(this.shadowSprite,1),this.sourceSprite.texture=this.sourceTexture;var i=UITools.getToolVO("frame_drop_shadow");for(var r in i.defaultValues)UITools.setToolValue("frame_drop_shadow",r,i.defaultValues[r]);UITools.updateToolControls("frame_drop_shadow"),UITools.applyTool("frame_drop_shadow"),this.updateDisplay(!0)}},xx.prototype.updateDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW&&this.sourceTexture){var t=UITools.getToolVO("frame_drop_shadow"),n=t.size/100,i=t.density/100,r=t.distance/100,a=t.angle*(Math.PI/180),o=Math.round(n*this.filterMaxBlurRadius),s="inner"===t.type,l=Math.round(o/this.filterScaleFactor),u=this.sourceW+2*l,c=this.sourceH+2*l,h=this.filterMaxBlurRadius/this.filterScaleFactor*r,d=Math.round(Math.cos(a)*h),m=Math.round(Math.sin(a)*h);if(this.imageContainerWidth=s?this.sourceW:u+Math.abs(Math.min(0,l-Math.abs(d))),this.imageContainerHeight=s?this.sourceH:c+Math.abs(Math.min(0,l-Math.abs(m))),this.itemWidth=this.imageContainerWidth,this.itemHeight=this.imageContainerHeight,e)return;if(s&&this.shadowSprite.mask!==this.maskSprite?(this.maskSprite.visible=!0,this.shadowSprite.mask=this.maskSprite,this.imageContainer.addChildAt(this.sourceSprite,1)):!s&&this.shadowSprite.mask&&(this.maskSprite.visible=!1,this.shadowSprite.mask=null,this.imageContainer.addChildAt(this.shadowSprite,1)),this.imageContainer.x=-this.imageContainerWidth/2,this.imageContainer.y=-this.imageContainerHeight/2,this.sourceSprite.x=s?0:Math.max(0,(u-this.sourceW)/2-d),this.sourceSprite.y=s?0:Math.max(0,(c-this.sourceH)/2-m),this.shadowSprite.x=s?0:this.sourceSprite.x+d-l,this.shadowSprite.y=s?0:this.sourceSprite.y+m-l,this.shadowSprite.alpha=t.opacity/100,this.shadowSprite.fillColor=parseInt("0x"+t.shadow_color),this.shadowSprite.intensity=1,this.maskSprite.x=this.sourceSprite.x,this.maskSprite.y=this.sourceSprite.y,this.background.clear(),-1!==t.background_color&&(this.background.beginFill("0x"+t.background_color,1),this.background.drawRect(0,0,this.imageContainerWidth,this.imageContainerHeight),this.background.endFill()),this.directionalBlurFilter.amount=n,this.directionalBlurFilter.alphaChoke=i,this.blurSprite.filters=s?[this.invertChannelFilter,this.directionalBlurFilter]:[this.directionalBlurFilter],BFN.Stage.render(this.blurSprite,this.blurredTexture),s)this.shadowTexture.width===this.scaledSourceW&&this.shadowTexture.height===this.scaledSourceH||this.shadowTexture.resize(this.scaledSourceW,this.scaledSourceH),this.shadowTexture.copyPixels(this.blurredTexture,{x:Math.round(d*this.filterScaleFactor)-this.filterMaxBlurRadius,y:Math.round(m*this.filterScaleFactor)-this.filterMaxBlurRadius});else{var p=this.scaledSourceW+2*o,g=this.scaledSourceH+2*o;this.shadowTexture.width===p&&this.shadowTexture.height===g||this.shadowTexture.resize(p,g),this.shadowTexture.copyPixels(this.blurredTexture,{x:o-this.filterMaxBlurRadius,y:o-this.filterMaxBlurRadius})}this.setSmoothingScale(this._scale),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED)}},xx.prototype.setSmoothingScale=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.sourceSprite.currentScale=e*this.sourceSprite.scale.y*(t?this.scale.y:1),this.shadowSprite.currentScale=e*this.shadowSprite.scale.y*(t?this.scale.y:1)},xx.prototype.handleMainUIPreRender=function(e){this.renderPending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.updateDisplay()},Object.defineProperty(xx.prototype,"toolScale",{set:function(e){this._scale=e,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(xx.prototype,"modifiedTexture",{get:function(){var e=Math.min(1,BFN.maxImageSize/this.imageContainerWidth,BFN.maxImageSize/this.imageContainerHeight),t=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerWidth*e)),n=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerHeight*e)),i=PIXI.RenderTexture.create(t,n),r=this.imageContainer.x,a=this.imageContainer.y;return this.imageContainer.x=0,this.imageContainer.y=0,this.imageContainer.scale.x=t/this.imageContainerWidth,this.imageContainer.scale.y=n/this.imageContainerHeight,this.setSmoothingScale(e,!1),BFN.Stage.render(this.imageContainer,i),this.imageContainer.x=r,this.imageContainer.y=a,this.imageContainer.scale.x=1,this.imageContainer.scale.y=1,this.setSmoothingScale(this._scale),i}}),Object.defineProperty(BFN,"ImageDropShadow",{get:function(){return!BFN._ImageDropShadow&&(BFN._ImageDropShadow=new xx),BFN._ImageDropShadow}}),_x.prototype=Object.create(PIXI.Sprite.prototype),_x.prototype.init=function(){BeFunky.log("ImageFrame Init"),this.initDefaultValues(),this.initDisplay()},_x.prototype.initDefaultValues=function(){this.sourceTexture=null,this.currentFrameID=null,this.currentFrameName=null,this._scale=1,this.adjustScale=1,this.itemWidth=this.imageContainerWidth=0,this.itemHeight=this.imageContainerHeight=0,this.tiltAngle=0,this.backgroundColor=-1,this.handleFrameDisplayFrameUpdatedBind=this.handleFrameDisplayFrameUpdated.bind(this)},_x.prototype.initDisplay=function(){this.canvas=new PIXI.Container,this.addChild(this.canvas),this.imageContainer=new PIXI.Container,this.canvas.addChild(this.imageContainer),this.imageBackground=new PIXI.Graphics,this.imageContainer.addChild(this.imageBackground),this.imageCenterContainer=new PIXI.Container,this.imageContainer.addChild(this.imageCenterContainer),this.frameDisplay=new BFN.FrameDisplay,this.frameDisplay.addEventListener(BFN.FrameDisplayEvents.FRAME_UPDATED.type,this.handleFrameDisplayFrameUpdatedBind),this.imageCenterContainer.addChild(this.frameDisplay)},_x.prototype.handleFrameCropRotateGeneric=function(){var e=UITools.getToolVO("frame_crop_rotate_generic");switch(e.updating_id){case"rotate_counter_clockwise":this.frameDisplay.rotateCounterClockwise();break;case"rotate_clockwise":this.frameDisplay.rotateClockwise();break;case"flip_horizontal":this.frameDisplay.flipHorizontal();break;case"flip_vertical":this.frameDisplay.flipVertical();break;case"background_color":this.backgroundColor=-1==e.background_color?-1:parseInt("0x".concat(e.background_color)),this.tiltFrame(this.tiltAngle);break;case"tilt":this.tiltFrame(e.tilt)}this.frameDisplay.setPosition(e.position/100)},_x.prototype.handleFrameCropGeneric=function(){var e=UITools.getToolVO("frame_crop_generic");switch(e.updating_id){case"rotate_counter_clockwise":this.frameDisplay.rotateCounterClockwise();break;case"rotate_clockwise":this.frameDisplay.rotateClockwise();break;case"flip_horizontal":this.frameDisplay.flipHorizontal();break;case"flip_vertical":this.frameDisplay.flipVertical()}this.frameDisplay.setPosition(e.position/100)},_x.prototype.handleFrameFullGeneric=function(){var e=UITools.getToolVO("frame_full_generic");switch(e.updating_id){case"rotate_counter_clockwise":this.frameDisplay.rotateCounterClockwise();break;case"rotate_clockwise":this.frameDisplay.rotateClockwise();break;case"flip_horizontal":this.frameDisplay.flipHorizontal();break;case"flip_vertical":this.frameDisplay.flipVertical();break;case"blend_mode":requestAnimationFrame(function(){BFN.MainUI.requestRender()})}this.frameDisplay.setColor(-1==e.color_overlay?-1:parseInt("0x".concat(e.color_overlay)),e.color_overlay_intensity),this.frameDisplay.setBlendMode(e.blend_mode),this.frameDisplay.setPosition(e.position/100),this.frameDisplay.setOpacity(e.opacity/100)},_x.prototype.handleUpdateTool=function(e){var t=this;if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME&&this.currentFrameID!==e){var n=UITools.getToolVO(e);this.currentFrameID=e,this.currentFrameName=n.hasOwnProperty("frameName")?n.frameName:"Frame";var i="".concat(BFN.imagesURL,"app/frames/").concat(n.texture_category,"/png/images/").concat(n.texture,".png"),r=this.showLoader();this.frameDisplay.addEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,function e(){t.frameDisplay.removeEventListener(BFN.FrameDisplayEvents.FRAME_LOADED.type,e),r()}),this.frameDisplay.setupFrame(this.sourceTexture,i,n.texture_data,100,100,BFN.maxImageSize,BFN.maxImageSize),this.resetFrameDisplay(),this.itemWidth=this.frameDisplay.itemWidth,this.itemHeight=this.frameDisplay.itemHeight,this.imageContainer.x=-Math.round(this.itemWidth/2),this.imageContainer.y=-Math.round(this.itemHeight/2),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED);var a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),o=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME,BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME,BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME);a.dispatchEvent(o);var s=n.hasOwnProperty("blendMode")?n.blendMode:BFN.CONST.BLEND_MODES.NORMAL;switch(n.frame_type){case"crop_rotate":UITools.setToolValue("frame_crop_rotate_generic","blend_mode",s),UITools.updateToolControls("frame_crop_rotate_generic"),this.handleFrameCropRotateGeneric();break;case"crop":UITools.setToolValue("frame_crop_generic","blend_mode",s),UITools.updateToolControls("frame_crop_generic"),this.handleFrameCropGeneric();break;case"full":UITools.setToolValue("frame_full_generic","blend_mode",s),UITools.updateToolControls("frame_full_generic"),this.handleFrameFullGeneric()}this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=Math.min(1,this.frameDisplay.itemHeight/this.imageContainerHeight),this.itemWidth=Math.max(0,Math.round(this.imageContainerWidth*this.canvas.scale.x)-2),this.itemHeight=Math.max(0,Math.round(this.imageContainerHeight*this.canvas.scale.y)-2),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()}},_x.prototype.tiltFrame=function(e){this.tiltAngle=e;var t=Math.abs(e*(Math.PI/180)),n=this.frameDisplay.itemWidth,i=this.frameDisplay.itemHeight;this.imageContainerWidth=Math.max(0,Math.cos(t)*n+Math.sin(t)*i),this.imageContainerHeight=Math.max(0,Math.cos(t)*i+Math.sin(t)*n),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageCenterContainer.x=-this.imageContainer.x,this.imageCenterContainer.y=-this.imageContainer.y,this.imageCenterContainer.rotation=e*(Math.PI/180),this.frameDisplay.x=-this.frameDisplay.itemWidth/2,this.frameDisplay.y=-this.frameDisplay.itemHeight/2,this.imageBackground.clear(),-1!=this.backgroundColor?this.imageBackground.beginFill(this.backgroundColor):this.imageBackground.beginFill(0,0),this.imageBackground.drawRect(0,0,this.imageContainerWidth,this.imageContainerHeight),this.imageBackground.endFill(),this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=Math.min(1,this.frameDisplay.itemHeight/this.imageContainerHeight),this.itemWidth=Math.max(0,Math.round(this.imageContainerWidth*this.canvas.scale.x)-2),this.itemHeight=Math.max(0,Math.round(this.imageContainerHeight*this.canvas.scale.y)-2),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()},_x.prototype.resetFrameDisplay=function(){UITools.setToolValue("frame_crop_rotate_generic","background_color",-1),UITools.setToolValue("frame_crop_rotate_generic","position",0),UITools.setToolValue("frame_crop_rotate_generic","tilt",0),UITools.updateToolControls("frame_crop_rotate_generic"),UITools.setToolValue("frame_crop_generic","position",0),UITools.updateToolControls("frame_crop_generic"),UITools.setToolValue("frame_full_generic","color_overlay",-1),UITools.setToolValue("frame_full_generic","color_overlay_intensity",1),UITools.setToolValue("frame_full_generic","blend_mode",BFN.CONST.BLEND_MODES.NORMAL),UITools.setToolValue("frame_full_generic","position",0),UITools.setToolValue("frame_full_generic","opacity",100),UITools.updateToolControls("frame_full_generic"),this.frameDisplay.resetFrame(),this.tiltAngle=0,this.backgroundColor=-1,this.tiltFrame(this.tiltAngle)},_x.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null),e?this.sourceTexture=e:this.currentFrameID=null},_x.prototype.showLoader=function(){var e,t=!1;return setTimeout(function(){e=BFN.activePresetMenuItem,t||e.setLoading(!0)},0),function(){t=!0,e&&e.setLoading(!1)}},_x.prototype.handleFrameDisplayFrameUpdated=function(e){this.imageContainer.x=-Math.round(this.itemWidth/2),this.imageContainer.y=-Math.round(this.itemHeight/2),this.tiltFrame(this.tiltAngle)},Object.defineProperty(_x.prototype,"toolScale",{set:function(e){this._scale=e,this.frameDisplay.canvasScale=e},get:function(){return this._scale}}),Object.defineProperty(_x.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.floor(this.imageContainerWidth),Math.floor(this.imageContainerHeight));return this.canvas.x=Math.floor(e.width/2),this.canvas.y=Math.floor(e.height/2),this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=1,this.frameDisplay.canvasScale=1,this.removeChild(this.canvas),BFN.Stage.render(this.canvas,e),this.addChild(this.canvas),this.canvas.x=this.canvas.y=0,this.canvas.scale.x=this.canvas.scale.y=this.adjustScale=Math.min(1,this.frameDisplay.itemHeight/this.imageContainerHeight),this.frameDisplay.canvasScale=this._scale,e}}),Object.defineProperty(BFN,"ImageFrame",{get:function(){return BFN._ImageFrame||(BFN._ImageFrame=new _x),BFN._ImageFrame}}),Ix.prototype=Object.create(PIXI.Sprite.prototype),Ix.prototype.init=function(){BeFunky.log("ImageTexture Init"),this.initDefaultValues(),this.initTexture(),this.initImageContainer(),this.initSourceSprite(),this.initBlendModeSprite(),this.initMaskSprite(),this.initPainter()},Ix.prototype.initDefaultValues=function(){this.sourceTexture=null,this.textureTexture=null,this.currentTextureID=null,this.currentTextureName=null,this._scale=1},Ix.prototype.initTexture=function(){this.textureContainer=new PIXI.Container,this.textureCenterContainer=new PIXI.Container,this.textureContainer.addChild(this.textureCenterContainer),this.textureSprite=new PIXI.Sprite,this.textureCenterContainer.addChild(this.textureSprite)},Ix.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Ix.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Ix.prototype.initBlendModeSprite=function(){this.blendModeSprite=new BFN.BlendModeSprite(!1),this.blendModeSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.blendModeSprite)},Ix.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},Ix.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.paintingEnabled=!1,this.painter.delaySetupTillPaintingEnabled=!0,this.painter.renderable=!1,this.imageContainer.addChild(this.painter),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},Ix.prototype.handleTextureGeneric=function(){var e=UITools.getToolVO("texture_generic");switch(this.blendModeSprite.setBlendMode(e.blend_mode),this.blendModeSprite.setBlendIntensity(e.opacity),e.updating_id){case"rotate_counter_clockwise":e.rotate_counter_clockwise&&(this.textureCenterContainer.rotation-=Math.PI/2,this.updateTextureTransform());break;case"rotate_clockwise":e.rotate_clockwise&&(this.textureCenterContainer.rotation+=Math.PI/2,this.updateTextureTransform());break;case"flip_horizontal":e.flip_horizontal&&(Math.abs(this.textureCenterContainer.rotation%Math.PI)?(this.textureSprite.y*=-1,this.textureSprite.scale.y*=-1):(this.textureSprite.x*=-1,this.textureSprite.scale.x*=-1),this.updateTextureTransform());break;case"flip_vertical":e.flip_vertical&&(Math.abs(this.textureCenterContainer.rotation%Math.PI)?(this.textureSprite.x*=-1,this.textureSprite.scale.x*=-1):(this.textureSprite.y*=-1,this.textureSprite.scale.y*=-1),this.updateTextureTransform())}},Ix.prototype.handleTextureBrush=function(){this.updateTextureBrushParameters()},Ix.prototype.handleUpdateTool=function(e){var t=this;if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE){var n=UITools.getToolVO(e);if(UITools.setToolValue("texture_generic","opacity",n.alpha),UITools.setToolValue("texture_generic","blend_mode",n.blendMode),UITools.updateToolControls("texture_generic"),this.currentTextureID!==e){this.currentTextureID=e,this.currentTextureName=n.hasOwnProperty("textureName")?n.textureName:"Texture";var i=this.showLoader(),r=new Image;r.setAttribute("crossOrigin","Anonymous"),r.onload=function(){t.setTexture(new PIXI.Texture(new PIXI.BaseTexture(r))),i()},r.src="".concat(BFN.remoteImagesURL,"app/texturemodel/original/").concat(n.texture)}}},Ix.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.textureTexture&&(this.textureTexture.destroyGC(!0),this.textureTexture=null),this.blendModeSprite.autoRender=!1,e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.textureTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),BFN.Stage.render(new PIXI.Container,this.textureTexture),this.textureCenterContainer.x=this.textureTexture.width/2,this.textureCenterContainer.y=this.textureTexture.height/2,this.blendModeSprite.autoRender=!0,this.blendModeSprite.setBlendMode(null),this.blendModeSprite.setBaseTexture(this.sourceTexture),this.blendModeSprite.setBlendTexture(this.textureTexture),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("texture_brush","show_mask",!1),UITools.setToolValue("texture_brush","select_action","subtract"),UITools.updateToolControls("texture_brush"),this.updateTextureBrushParameters()):(this.currentTextureID=null,this.sourceSprite.mask=null,this.blendModeSprite.mask=null,this.painter.reset(),BFN.FilterHelper.emptyPoolForFilter())},Ix.prototype.setTexture=function(e){try{this.textureSprite.texture.destroyGC(!0),this.textureSprite.texture=null}catch(e){}e&&(this.textureSprite.rotation=0,this.textureSprite.scale.x=this.textureSprite.scale.y=1,this.textureSprite.texture=e,this.textureSprite.x=-this.textureSprite.texture.width/2,this.textureSprite.y=-this.textureSprite.texture.height/2,this.updateTextureTransform(),this.handleTextureGeneric())},Ix.prototype.updateTextureTransform=function(){if(this.textureTexture&&this.textureSprite.texture){var e=this.textureTexture.width,t=this.textureTexture.height,n=Math.abs(this.textureCenterContainer.rotation%Math.PI)?this.textureSprite.texture.height:this.textureSprite.texture.width,i=Math.abs(this.textureCenterContainer.rotation%Math.PI)?this.textureSprite.texture.width:this.textureSprite.texture.height,r=Math.max(e/n,t/i);this.textureCenterContainer.scale.x=this.textureCenterContainer.scale.y=r,BFN.Stage.render(this.textureContainer,this.textureTexture),this.blendModeSprite.updateDisplay()}},Ix.prototype.updateTextureBrushParameters=function(){var e=this,t=UITools.getToolVO("texture_brush");if(t){if("isolate_subject"===t.updating_id&&!t.updating)return this.sourceTexture.altTexture=this.blendModeSprite.texture,this.sourceTexture.altTextureInverse=!1,void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,this.inverse,function(){delete e.sourceTexture.altTexture,delete e.sourceTexture.altTextureInverse});t.clear&&(this.painter.clear(!0),UITools.setToolValue("texture_brush","erase",!1),UITools.updateToolControl("texture_brush_erase"),this.inverse&&(this.inverse=!1,this.updateMaskDisplay())),this.showMask!==t.show_mask&&(this.showMask=t.show_mask,this.updateMaskDisplay()),"invert"===t.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var n="subtract"===t.select_action?this.inverse:!this.inverse;this.painter.eraseMode!==n&&(this.painter.eraseMode=n),t.updating&&"size"===t.updating_id&&this.painter.brushSizeFactor!=t.size/100&&(this.painter.brushSizeFactor=t.size/100);var i=!1;t.updating||"size"!==t.updating_id&&this.painter.brushSizeFactor==t.size/100||(this.painter.brushSizeFactor=t.size/100,i=!0),t.updating||"hardness"!==t.updating_id&&this.painter.brushHardnessFactor==t.hardness/100||(this.painter.brushHardnessFactor=t.hardness/100,this.painter.updateBrush()),t.updating||"strength"!==t.updating_id&&this.painter.brushStrengthFactor==t.strength/100||(this.painter.brushStrengthFactor=t.strength/100,this.painter.updateBrush()),i&&this.painter.updateBrush()}},Ix.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.blendModeSprite.visible=!(e||this.inverse&&!this.painter.paintApplied),this.maskSprite.visible=e&&!(this.inverse&&!this.painter.paintApplied);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.blendModeSprite.mask!==t&&(this.blendModeSprite.mask=t),this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},Ix.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.blendModeSprite.currentScale=e,this.painter.currentScale=e},Ix.prototype.showLoader=function(){var e,t=!1;return setTimeout(function(){e=BFN.activePresetMenuItem,!t&&e&&e.setLoading(!0)},0),function(){t=!0,e&&e.setLoading(!1)}},Ix.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},Ix.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("texture_brush","show_mask",!1),UITools.updateToolControl("texture_brush_show_mask"),this.showMask=UITools.getToolValue("texture_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty(Ix.prototype,"inverse",{set:function(e){this._inverse=e,this.painter.inverseMask=!this._inverse,BFN.MainUI.requestRender()},get:function(){return this._inverse}}),Object.defineProperty(Ix.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Ix.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}}),Object.defineProperty(BFN,"ImageTexture",{get:function(){return BFN._ImageTexture||(BFN._ImageTexture=new Ix),BFN._ImageTexture}}),Tx.prototype=Object.create(PIXI.Sprite.prototype),Tx.prototype.init=function(){BeFunky.log("ImageOverlay Init"),this.initDefaultValues(),this.initImageContainer(),this.initBackgroundSprite(),this.initWhiteVeil(),this.initOverlaySprite(),this.initOverlayMask(),this.initOverlayPattern(),this.initOverlayPatternMask(),this.initShadowContainer(),this.initShadowSprite(),this.initShadowMask(),this.initShadowPattern(),this.initBlurDisplay(),this.initMaskDragger()},Tx.prototype.initDefaultValues=function(){this.currentOverlayID=null,this.currentOverlayName=null,this.currentOverlayLang=null,this.sourceTexture=null,this.overlayTextureSource=null,this.overlayTexture=null,this.blurTexture=null,this.shadowTexture=null,this.shadowSourceTexture=null,this.overlayTextureSourceSprite=new PIXI.Sprite,this.overlayTextureSourceSprite.pluginName="smooth_picture",this._scale=1,this.baseScale=1,this.patternMode=!1,this.patternStartOffset=new PIXI.Point,this.blurAmount=0,this.blurUpdating=!1,this.blurPending=!1,this.blurIntervalActive=!1,this.shadowAmount=0,this.shadowUpdating=!1,this.shadowPending=!1,this.shadowIntervalActive=!1,this.eraseFilter=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.ERASE),this.shadowBlurFilter=new BFN.filters.GaussianBlurFilter},Tx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.imageContainer.interactive=!0,this.addChild(this.imageContainer)},Tx.prototype.initBackgroundSprite=function(){this.backgroundSprite=new PIXI.Sprite,this.backgroundSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.backgroundSprite)},Tx.prototype.initWhiteVeil=function(){this.whiteVeil=new PIXI.Graphics,this.imageContainer.addChild(this.whiteVeil)},Tx.prototype.initOverlaySprite=function(){this.overlaySprite=new PIXI.Sprite,this.overlaySprite.pluginName="smooth_picture",this.imageContainer.addChild(this.overlaySprite)},Tx.prototype.initOverlayMask=function(){this.overlayMask=new PIXI.Sprite,this.overlayMask.anchor.x=this.overlayMask.anchor.y=.5,this.imageContainer.addChild(this.overlayMask)},Tx.prototype.initOverlayPattern=function(){this.overlayPatternTexture=PIXI.RenderTexture.create(32,32),this.overlayPatternTexture.clear(),this.overlayPattern=new BFN.TileContainer(this.overlayPatternTexture,32,32)},Tx.prototype.initOverlayPatternMask=function(){this.overlayPatternMaskTexture=null,this.overlayPatternMask=new PIXI.Sprite},Tx.prototype.initShadowContainer=function(){this.shadowContainer=new PIXI.Container},Tx.prototype.initShadowSprite=function(){this.shadowSprite=new PIXI.Sprite,this.shadowSprite.anchor.x=this.shadowSprite.anchor.y=.5,this.shadowSprite.pluginName="blend_picture",this.shadowSprite.currentScale=1,this.shadowContainer.addChild(this.shadowSprite),this.shadowSourceSprite=new PIXI.Sprite},Tx.prototype.initShadowMask=function(){this.shadowMask=new PIXI.Sprite,this.shadowMask.anchor.x=this.shadowMask.anchor.y=.5,this.shadowContainer.addChild(this.shadowMask),this.shadowSprite.mask=this.shadowMask},Tx.prototype.initShadowPattern=function(){this.shadowPatternTexture=PIXI.RenderTexture.create(32,32),this.shadowPatternTexture.clear(),this.shadowPattern=new BFN.TileContainer(this.shadowPatternTexture,32,32)},Tx.prototype.initBlurDisplay=function(){this.blurFilter=new BFN.filters.FastBlurWrapper,this.blurTexture=null,this.blurAmount=1,this.blurSprite=new PIXI.Sprite},Tx.prototype.initMaskDragger=function(){var e=this;this.maskDragger=new BFN.Dragger,this.maskDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleMaskDraggerDraggingStarted.bind(this)),this.maskDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleMaskDraggerDragging.bind(this)),this.imageContainer.on("pointerdown",function(t){e.maskDragger.drag(e.overlayMask),t.stopPropagation()})},Tx.prototype.handleOverlayGeneric=function(){var e=UITools.getToolVO("overlay_generic");"reset"===e.updating_id&&(this.overlayMask.x=this.shadowContainer.x=this.maskDragger.bounds.minX+(this.maskDragger.bounds.maxX-this.maskDragger.bounds.minX)/2,this.overlayMask.y=this.shadowContainer.y=this.maskDragger.bounds.minY+(this.maskDragger.bounds.maxY-this.maskDragger.bounds.minY)/2,UITools.setToolValue("overlay_generic","color","FFFFFF"),UITools.setToolValue("overlay_generic","opacity",.9),UITools.setToolValue("overlay_generic","size",1),UITools.setToolValue("overlay_generic","rotation",0),UITools.setToolValue("overlay_generic","blur_amount",0),UITools.setToolValue("overlay_generic","shadow_amount",0),UITools.updateToolControls("overlay_generic"),e=UITools.getToolVO("overlay_generic")),this.whiteVeil.alpha=e.opacity,this.whiteVeil.tint=parseInt("0x".concat(e.color));var t=(.8*e.size+.2)*this.baseScale,n=e.rotation*(Math.PI/180);this.overlayMask.scale.x=this.overlayMask.scale.y=t,this.overlayMask.rotation=this.patternMode?0:n,this.shadowContainer.scale.x=this.shadowContainer.scale.y=t,this.shadowContainer.rotation=this.patternMode?0:n,this.patternMode&&(this.overlayPattern.rotate(n),this.shadowPattern.rotate(n),"rotation"===e.updating_id&&this.updateOverlayPatternMaskTexture(),"size"===e.updating_id&&this.updatePatternSource()),this.updateOverlaySmoothing(t),this.blurAmount!=e.blur_amount&&(this.blurAmount=e.blur_amount,this.blurPending=!0),this.blurUpdating=!1,"blur_amount"===e.updating_id&&e.updating&&(this.blurUpdating=!0),this.blurUpdating?this.blurIntervalActive||(this.blurIntervalActive=!0,this.applyBlurInterval()):(this.blurIntervalActive=!1,this.blurPending&&this.applyBlur()),this.shadowAmount!=e.shadow_amount&&(this.shadowAmount=e.shadow_amount,this.shadowPending=!0),this.shadowUpdating=!1,"shadow_amount"===e.updating_id&&e.updating&&(this.shadowUpdating=!0),this.shadowUpdating?this.shadowIntervalActive||(this.shadowIntervalActive=!0,this.applyShadowInterval()):(this.shadowIntervalActive=!1,this.shadowPending&&this.applyShadow()),BFN.MainUI.requestRender()},Tx.prototype.handleUpdateTool=function(e){var t=this;if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY){var n=UITools.getToolVO(e);if(this.overlayMask.x=this.shadowContainer.x=this.maskDragger.bounds.minX+(this.maskDragger.bounds.maxX-this.maskDragger.bounds.minX)/2,this.overlayMask.y=this.shadowContainer.y=this.maskDragger.bounds.minY+(this.maskDragger.bounds.maxY-this.maskDragger.bounds.minY)/2,UITools.setToolValue("overlay_generic","color","FFFFFF"),UITools.setToolValue("overlay_generic","opacity",.9),UITools.setToolValue("overlay_generic","size",1),UITools.setToolValue("overlay_generic","rotation",0),UITools.setToolValue("overlay_generic","blur_amount",0),UITools.setToolValue("overlay_generic","shadow_amount",0),UITools.updateToolControls("overlay_generic"),UITools.applyTool("overlay_generic"),this.currentOverlayID!==e){this.patternMode=-1!==e.indexOf("patterns_patterns"),this.currentOverlayID=e,this.currentOverlayName=n.overlayName,this.currentOverlayLang=n.overlayLang;var i=this.showLoader();BFN.OverlaysItemLoader.load(n.categoryName,n.overlayID,function(e){i(),t.handleOverlayLoaded(e)},!1)}}},Tx.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null),null!=this.backgroundTexture&&(this.backgroundTexture.destroyGC(!0),this.backgroundTexture=null,this.backgroundSprite.texture=PIXI.Texture.EMPTY),null!=this.overlayTexture&&(this.overlayTexture.destroyGC(!0),this.overlayTexture=null,this.overlaySprite.texture=PIXI.Texture.EMPTY,this.overlayMask.texture=PIXI.Texture.EMPTY,this.shadowMask.texture=PIXI.Texture.EMPTY),null!=this.blurTexture&&(this.blurTexture.destroyGC(!0),this.blurFilter.dispose(),this.blurTexture=null),null!=this.overlayPatternMaskTexture&&(this.overlayPatternMaskTexture.destroyGC(!0),this.overlayPatternMaskTexture=null,this.overlayPatternMask.texture=PIXI.Texture.EMPTY),null!=this.shadowTexture&&(this.shadowTexture.destroyGC(!0),this.shadowTexture=null,this.shadowSprite.texture=PIXI.Texture.EMPTY),null!=this.shadowSourceTexture&&(this.shadowSourceTexture.destroyGC(!0),this.shadowSourceTexture=null),e?(this.sourceTexture=e,this.overlayPattern.width=this.sourceTexture.width,this.overlayPattern.height=this.sourceTexture.height,this.shadowPattern.width=this.sourceTexture.width,this.shadowPattern.height=this.sourceTexture.height,this.backgroundTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.backgroundSprite.texture=this.backgroundTexture,this.applyBlur(),this.overlaySprite.texture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.whiteVeil.clear(),this.whiteVeil.beginFill(16777215,1),this.whiteVeil.drawRect(0,0,this.sourceTexture.width,this.sourceTexture.height),this.whiteVeil.endFill(),this.maskDragger.setBounds(0,0,this.sourceTexture.width,this.sourceTexture.height)):(this.blurFilter.dispose(),this.currentOverlayID=null)},Tx.prototype.applyBlurInterval=function(){this.blurPending&&this.applyBlur(),this.blurIntervalActive&&setTimeout(this.applyBlurInterval.bind(this),100)},Tx.prototype.applyBlur=function(){var e=this.blurFilter.render(this.blurAmount,this.sourceTexture);this.backgroundTexture.copyPixels(e),this.blurPending=!1,BFN.MainUI.requestRender()},Tx.prototype.applyShadowInterval=function(){this.shadowPending&&this.applyShadow(),this.shadowIntervalActive&&setTimeout(this.applyShadowInterval.bind(this),100)},Tx.prototype.applyShadow=function(){this.shadowSourceTexture&&this.shadowSourceTexture.width&&this.shadowSourceTexture.height&&this.shadowBlurFilter.setInputDimensions(this.shadowSourceTexture.width,this.shadowSourceTexture.height),this.shadowBlurFilter.blur=this.shadowAmount,this.shadowSourceSprite.filters=[this.shadowBlurFilter],BFN.Stage.render(this.shadowSourceSprite,this.shadowTexture),BFN.Stage.render(this.shadowSourceSprite,this.shadowTexture,!1),this.shadowSprite.visible=this.shadowAmount>0,this.shadowPending=!1,this.patternMode&&BFN.Stage.render(this.shadowContainer,this.shadowPatternTexture),BFN.MainUI.requestRender()},Tx.prototype.updatePatternSource=function(){if(this.patternMode){var e=Math.round(this.overlayMask.texture.width*this.overlayMask.scale.x),t=Math.round(this.overlayMask.texture.height*this.overlayMask.scale.y);this.overlayMask.x=e/2,this.overlayMask.y=t/2,this.shadowContainer.x=this.overlayMask.x,this.shadowContainer.y=this.overlayMask.y,this.overlayPatternTexture.resize(e,t),BFN.Stage.render(this.overlayMask,this.overlayPatternTexture),this.overlayPattern.updateDisplay(),this.updateOverlayPatternMaskTexture(),this.shadowPatternTexture.resize(e,t),BFN.Stage.render(this.shadowContainer,this.shadowPatternTexture),this.shadowPattern.updateDisplay()}},Tx.prototype.updateOverlayPatternMaskTexture=function(){BFN.Stage.render(this.overlayPattern,this.overlayPatternMaskTexture)},Tx.prototype.updateOverlaySmoothing=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.shadowSprite.currentScale=this.baseScale,this.overlayTextureSource&&this.overlayTexture&&(this.overlayTextureSourceSprite.currentScale=e,BFN.Stage.render(this.overlayTextureSourceSprite,this.overlayTexture))},Tx.prototype.setSmoothingScale=function(e){this.backgroundSprite.currentScale=e,this.overlaySprite.currentScale=e},Tx.prototype.showLoader=function(){var e,t=!1;return setTimeout(function(){e=BFN.activePresetMenuItem,t||e.setLoading(!0)},0),function(){t=!0,e&&e.setLoading(!1)}},Tx.prototype.handleOverlayLoaded=function(e){if(null!=this.overlayPatternMaskTexture&&(this.overlayPatternMaskTexture.destroyGC(!0),this.overlayPatternMaskTexture=null,this.overlayPatternMask.texture=PIXI.Texture.EMPTY),e){if(this.patternMode){try{this.imageContainer.removeChild(this.overlayMask)}catch(e){}try{this.imageContainer.removeChild(this.shadowContainer)}catch(e){}this.overlayPattern.offset(0,0),this.shadowPattern.offset(0,0),this.overlayPatternMaskTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.overlayPatternMaskTexture.clear(),this.overlayPatternMask.texture=this.overlayPatternMaskTexture,this.imageContainer.addChild(this.overlayPatternMask),this.imageContainer.addChild(this.shadowPattern),this.overlaySprite.mask=this.overlayPatternMask}else{try{this.imageContainer.removeChild(this.overlayPatternMask)}catch(e){}try{this.imageContainer.removeChild(this.shadowPattern)}catch(e){}this.imageContainer.addChild(this.overlayMask),this.imageContainer.addChild(this.shadowContainer),this.overlaySprite.mask=this.overlayMask}this.maskDragger.autoDrag=!this.patternMode,this.maskDragger.useBounds=!this.patternMode,null!=this.overlayTextureSource&&(this.overlayTextureSource.destroyGC(!0),this.overlayTextureSource=null),null!=this.overlayTexture&&(this.overlayTexture.destroyGC(!0),this.overlayTexture=null),null!=this.shadowTexture&&(this.shadowTexture.destroyGC(!0),this.shadowTexture=null),null!=this.shadowSourceTexture&&(this.shadowSourceTexture.destroyGC(!0),this.shadowSourceTexture=null),this.overlayTextureSource=e,this.overlayTextureSourceSprite.texture=this.overlayTextureSource,this.overlayTexture=this.overlayTextureSource.renderClone(),this.overlayMask.texture=this.overlayTexture,this.shadowMask.texture=this.overlayTexture;var t=this.overlayTexture.width+32,n=this.overlayTexture.height+32,i=PIXI.RenderTexture.create(t,n);i.fillRect(0,0,t,n,0,1);var r=i.renderClone();r.copyPixels(this.overlayTexture,{x:16,y:16},!0,1,1),this.eraseFilter.iChannel1=r,this.shadowSourceSprite.texture=i,this.shadowSourceSprite.filters=[this.eraseFilter],this.shadowSourceTexture=i.renderClone(),BFN.Stage.render(this.shadowSourceSprite,this.shadowSourceTexture),i.destroyGC(!0),this.eraseFilter.iChannel1=null,r.destroyGC(!0),this.shadowSourceSprite.texture=this.shadowSourceTexture,this.shadowTexture=this.shadowSourceTexture.renderClone(),this.shadowSprite.texture=this.shadowTexture,this.applyShadow(),this.sourceTexture&&(this.baseScale=.9*Math.min(this.sourceTexture.width/this.overlayTexture.width,this.sourceTexture.height/this.overlayTexture.height),this.overlayMask.scale.x=this.overlayMask.scale.y=this.baseScale,this.shadowContainer.scale.x=this.shadowContainer.scale.y=this.baseScale,this.patternMode?this.updatePatternSource():(this.overlayMask.x=this.sourceTexture.width/2,this.overlayMask.y=this.sourceTexture.height/2,this.shadowContainer.x=this.sourceTexture.width/2,this.shadowContainer.y=this.sourceTexture.height/2),this.updateOverlaySmoothing(this.baseScale)),BFN.MainUI.requestRender()}else console.log("OVERLAY TEXTURE NOT FOUND")},Tx.prototype.handleMaskDraggerDraggingStarted=function(e){this.patternMode&&(this.patternStartOffset.x=this.overlayPattern.globalOffsetPoint.x,this.patternStartOffset.y=this.overlayPattern.globalOffsetPoint.y)},Tx.prototype.handleMaskDraggerDragging=function(e){if(this.patternMode){var t=this.patternStartOffset.x+this.maskDragger.mouseDeltaX,n=this.patternStartOffset.y+this.maskDragger.mouseDeltaY;this.overlayPattern.offset(t,n),this.shadowPattern.offset(t,n),this.updateOverlayPatternMaskTexture()}else this.shadowContainer.x=this.overlayMask.x,this.shadowContainer.y=this.overlayMask.y},Object.defineProperty(Tx.prototype,"toolScale",{set:function(e){this._scale=e,this.maskDragger.scale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Tx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),e}}),Object.defineProperty(BFN,"ImageOverlay",{get:function(){return BFN._ImageOverlay||(BFN._ImageOverlay=new Tx),BFN._ImageOverlay}}),bx.prototype=Object.create(PIXI.Sprite.prototype),bx.prototype.init=function(){BeFunky.log("LensFlareDisplayElement Init"),this.initDefaultValues(),this.initStaticMask(),this.updateProperties()},bx.prototype.initDefaultValues=function(){this.PId2=Math.PI/2,this.radsPerDeg=Math.PI/180,this.elementBaseDimensions=new PIXI.Point,this.elementBeta=0,this._ignoreActiveProperty=!1,this._intensityFactor=0,this.lensTintFilter=new BFN.filters.LensTintFilter,this.usesColorOverlay=!1,this.staticElement=!1,this.textureSource=null,this.elementSprite=new PIXI.Sprite,this.handleAssetUpdatedBind=this.handleAssetUpdated.bind(this),this.handlePropertyUpdatedBind=this.handlePropertyUpdated.bind(this),this.handlePositionUpdatedBind=this.handlePositionUpdated.bind(this),this._elementVO.addEventListener(BFN.LensFlareElementVOEvents.ASSET_UPDATED.type,this.handleAssetUpdatedBind),this._elementVO.addEventListener(BFN.LensFlareElementVOEvents.PROPERTY_UPDATED.type,this.handlePropertyUpdatedBind),this._elementVO.addEventListener(BFN.LensFlareElementVOEvents.POSITION_UPDATED.type,this.handlePositionUpdatedBind),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},bx.prototype.initStaticMask=function(){if(!BFN.hasOwnProperty("LensFlareDisplayElementStaticMaskTexture")){var e=new PIXI.Graphics;e.beginFill(16777215),e.drawRect(0,0,1024,1024),e.endFill();var t=PIXI.RenderTexture.create(1024,1024);BFN.Stage.render(e,t);var n=BFN.ShaderPool.BrushFilter;n.radius=512,n.hardness=.1;var i=new PIXI.Sprite;i.pluginName="filter_renderer",i.texture=t,i.bfn_shaders=[n];var r=PIXI.RenderTexture.create(1024,1024);BFN.Stage.render(i,r),e.clear(),t.destroyGC(!0),i.filters=[],i.destroy(!0),BFN.LensFlareDisplayElementStaticMaskTexture=r}this.staticContainer=new PIXI.Container,this.staticSprite=new PIXI.Sprite,this.staticContainer.addChild(this.staticSprite),this.staticMask=new PIXI.Sprite(BFN.LensFlareDisplayElementStaticMaskTexture),this.staticMask.anchor.x=this.staticMask.anchor.y=.5,this.staticContainer.addChild(this.staticMask),this.staticSprite.mask=this.staticMask},bx.prototype.updateAsset=function(){if(BFN.LensFlareData.assets.hasOwnProperty(this._elementVO.getProperty("assetID"))){var e=BFN.LensFlareData.assets[this._elementVO.getProperty("assetID")];try{this.texture.destroyGC(!0)}catch(e){}this.texture=PIXI.Texture.EMPTY;try{this.staticSprite.texture.destroyGC(!0)}catch(e){}if(this.staticSprite.texture=PIXI.Texture.EMPTY,this.staticElement=e.static,this.textureSource=this.useThumb?e.thumbTexture:e.imageTexture,this.textureSource){this.elementSprite.texture=this.textureSource;var t=BFN.Util.cloneTexture(this.textureSource);this.staticElement?(this.texture=PIXI.RenderTexture.create(this._displayDimensions.x,this._displayDimensions.y),this.staticSprite.texture=t,this.staticSprite.scale.x=this.staticSprite.scale.y=Math.max(this._displayDimensions.x,this._displayDimensions.y)/Math.min(this.staticSprite.texture.width,this.staticSprite.texture.height),this.staticSprite.x=(this._displayDimensions.x-this.staticSprite.texture.width*this.staticSprite.scale.x)/2,this.staticSprite.y=(this._displayDimensions.y-this.staticSprite.texture.height*this.staticSprite.scale.y)/2,this.elementBaseDimensions.x=this.staticMask.texture.width,this.elementBaseDimensions.y=this.staticMask.texture.height,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)):(this.texture=t,this.elementBaseDimensions.x=this.texture.width,this.elementBaseDimensions.y=this.texture.height,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),this.updatePosition(),this.updateScale(),this.updateProperties()}}},bx.prototype.updatePosition=function(){var e=this._sourcePoint.x-this._centerPoint.x,t=this._sourcePoint.y-this._centerPoint.y,n=Math.sqrt(e*e+t*t);this.elementBeta=Math.atan2(t,e);var i=this._sourcePoint.x-Math.cos(this.elementBeta)*n*2*this._elementVO.getProperty("sourceDistanceFactor")+Math.cos(this.elementBeta+this.PId2)*n*2*this._elementVO.getProperty("centerDistanceFactor")+this._displayDimensions.x/2,r=this._sourcePoint.y-Math.sin(this.elementBeta)*n*2*this._elementVO.getProperty("sourceDistanceFactor")+Math.sin(this.elementBeta+this.PId2)*n*2*this._elementVO.getProperty("centerDistanceFactor")+this._displayDimensions.y/2;this.staticElement?(this.x=this.y=0,this.anchor.x=this.anchor.y=0,this.staticMask.x=i,this.staticMask.y=r,this.renderPending=!0):(this.x=i,this.y=r,this.anchor.x=this.anchor.y=.5),this.updateRotation()},bx.prototype.updateRotation=function(){var e=(this._elementVO.getProperty("rotationLock")?this.elementBeta:0)+this._elementVO.getProperty("rotationOffset")*this.radsPerDeg;this.staticElement?(this.rotation=0,this.staticMask.rotation=e):this.rotation=e},bx.prototype.updateScale=function(){if(this.elementBaseDimensions.x>0&&this.elementBaseDimensions.y>0){var e=Math.max(this._displayDimensions.x,this._displayDimensions.y)/Math.max(this.elementBaseDimensions.x,this.elementBaseDimensions.y)*this._elementVO.getProperty("sizeFactor");e=Math.max(0,e+e*this._intensityFactor*this._elementVO.getProperty("sizeFactorGlobal")),this.staticElement?(this.scale.x=this.scale.y=1,this.staticMask.scale.x=e*this._elementVO.getProperty("stretchXFactor"),this.staticMask.scale.y=e*this._elementVO.getProperty("stretchYFactor"),this.renderPending=!0):(this.scale.x=e*this._elementVO.getProperty("stretchXFactor"),this.scale.y=e*this._elementVO.getProperty("stretchYFactor"))}},bx.prototype.updateIntensity=function(){this._ignoreActiveProperty?this.alpha=1:this.alpha=this._elementVO.getProperty("intensityFactor")+this._elementVO.getProperty("intensityFactor")*this._intensityFactor*this._elementVO.getProperty("intensityFactorGlobal")},bx.prototype.updateProperties=function(){this.visible=!!this._ignoreActiveProperty||this._elementVO.getProperty("active"),this.updateColor(),this.updateIntensity(),this.updateScale(),this.updateRotation()},bx.prototype.updateColor=function(){var e=-1,t=this._elementVO.getProperty("colorGlobal"),n=this._elementVO.getProperty("color");if(t>=0?e=t:n>=0&&(e=n),e>=0){this.usesColorOverlay=!0;var i="0x"+e.toString(16);this.lensTintFilter.color=i}else this.usesColorOverlay=!1;this.updateBlendMode()},bx.prototype.updateBlendMode=function(){if(this.blendMode=PIXI.BLEND_MODES.NORMAL,!this._ignoreActiveProperty)switch(this._elementVO.getProperty("blendMode")){case"screen":this.blendMode=PIXI.BLEND_MODES.SCREEN;break;case"add":this.blendMode=PIXI.BLEND_MODES.ADD}try{this.staticElement?(this.usesColorOverlay?this.staticSprite.filters=[this.lensTintFilter]:this.staticSprite.filters=[],BFN.Stage.render(this.staticContainer,this.texture)):(this.usesColorOverlay?this.elementSprite.filters=[this.lensTintFilter]:this.elementSprite.filters=[],BFN.Stage.render(this.elementSprite,this.texture))}catch(e){}},bx.prototype.destroyElement=function(){try{this.texture.destroyGC(!0)}catch(e){}this.texture=PIXI.Texture.EMPTY,this.staticSprite.mask=null,this.staticContainer.removeChild(this.staticMask),this.staticMask.destroy(!1),this.staticMask.texture=null,this.staticMask=null,this.staticContainer.removeChild(this.staticSprite),this.staticSprite.filters=[],this.staticSprite.destroy(!1),this.staticSprite.texture=null,this.staticSprite=null,this.staticContainer=null,this.elementSprite.filters=[],this.elementSprite.destroy(!1),this.elementSprite=null,this.textureSource=null,this._elementVO.removeEventListener(BFN.LensFlareElementVOEvents.ASSET_UPDATED.type,this.handleAssetUpdatedBind),this._elementVO.removeEventListener(BFN.LensFlareElementVOEvents.PROPERTY_UPDATED.type,this.handlePropertyUpdatedBind),this._elementVO.removeEventListener(BFN.LensFlareElementVOEvents.POSITION_UPDATED.type,this.handlePositionUpdatedBind),this._elementVO=null,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.destroy(!0)},bx.prototype.applyColorOverlay=function(e,t,n){},bx.prototype.handleAssetUpdated=function(e){this.updateAsset()},bx.prototype.handlePropertyUpdated=function(e){this.updateProperties()},bx.prototype.handlePositionUpdated=function(e){this.updatePosition()},bx.prototype.handleMainUIPreRender=function(e){this.staticMask&&this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.staticContainer,this.texture))},Object.defineProperty(bx.prototype,"elementVO",{get:function(){return this._elementVO}}),Object.defineProperty(bx.prototype,"ignoreActiveProperty",{set:function(e){this._ignoreActiveProperty=e,this.updateProperties()},get:function(){return this._ignoreActiveProperty}}),Object.defineProperty(bx.prototype,"intensityFactor",{set:function(e){this._intensityFactor=e,this.updateScale(),this.updateIntensity()},get:function(){return this._intensityFactor}}),BFN.LensFlareDisplayElement=bx,BFN.LensFlareDisplayEvents={ELEMENTS_ADDED:new Event("ELEMENTS_ADDED")},Sx.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),Sx.prototype.init=function(){BeFunky.log("LensFlareDisplay Init"),this.initDefaultValues(),this.initDisplay()},Sx.prototype.initDefaultValues=function(){this.elements=[],this._sourcePoint=new PIXI.Point,this._centerPoint=new PIXI.Point,this._displayDimensions=new PIXI.Point,this.displayTexture=null,this.anchor.x=this.anchor.y=.5,this._intenseMode=!0,this._intensityFactor=0,this._itemWidth=this._displayDimensions.x,this._itemHeight=this._displayDimensions.y,this.maxSize=1200,this.scaleFactor=1,this.handleLensFlareManagerThumbsLoadedBind=this.handleLensFlareManagerThumbsLoaded.bind(this),this.handleLensFlareManagerAssetsLoadedBind=this.handleLensFlareManagerAssetsLoaded.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},Sx.prototype.initDisplay=function(){this.displayContainer=new PIXI.Container,this.addChild(this.displayContainer),this.blackBackground=new PIXI.Graphics,this.blackBackground.visible=!0,this.displayContainer.addChild(this.blackBackground),this.elementContainer=new PIXI.Container,this.displayContainer.addChild(this.elementContainer),this.elementContainerMask=new PIXI.Graphics,this.displayContainer.addChild(this.elementContainerMask),this.elementContainer.mask=this.elementContainerMask},Sx.prototype.setDisplayDimensions=function(e,t){this.scaleFactor=1,(e>this.maxSize||t>this.maxSize)&&(this.scaleFactor=Math.min(this.maxSize/e,this.maxSize/t),e=Math.round(e*this.scaleFactor),t=Math.round(t*this.scaleFactor)),this.scale.x=this.scale.y=1/this.scaleFactor,this._itemWidth=this._displayDimensions.x=e,this._itemHeight=this._displayDimensions.y=t,this.texture=PIXI.Texture.EMPTY;try{this.displayTexture.destroyGC(!0),this.displayTexture=null}catch(e){}e>0&&t>0&&(this.displayTexture=PIXI.RenderTexture.create(e,t),this._intenseMode||(BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.texture=this.displayTexture)),this.displayContainer.x=this._intenseMode?-Math.round(this._itemWidth/2):0,this.displayContainer.y=this._intenseMode?-Math.round(this._itemHeight/2):0,this.blackBackground.clear(),this.blackBackground.beginFill(0),this.blackBackground.drawRect(0,0,this._itemWidth,this._itemHeight),this.blackBackground.endFill(),this.elementContainerMask.clear(),this.elementContainerMask.beginFill(16777215),this.elementContainerMask.drawRect(0,0,this._itemWidth,this._itemHeight),this.elementContainerMask.endFill()},Sx.prototype.clearElements=function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t.destroyElement(),this.elementContainer.removeChild(t)}this.elements.splice(0)},Sx.prototype.addElements=function(e){this.clearElements();for(var t=[],n=0;n<e.length;n++){var i=e[n],r=i.getProperty("assetID");if(r){var a=new BFN.LensFlareDisplayElement(i,this._sourcePoint,this._centerPoint,this._displayDimensions,this.useThumbs);this.elementContainer.addChild(a),this.elements.push(a),t.push(r)}}this.updateElementPositions(),this.useThumbs?(BFN.LensFlareManager.addEventListener(BFN.LensFlareManagerEvents.THUMBS_LOADED.type,this.handleLensFlareManagerThumbsLoadedBind),BFN.LensFlareManager.loadAssetThumbs(t)):(BFN.LensFlareManager.addEventListener(BFN.LensFlareManagerEvents.ASSETS_LOADED.type,this.handleLensFlareManagerAssetsLoadedBind),BFN.LensFlareManager.loadAssets(t))},Sx.prototype.addElementsComplete=function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t.updateAsset(),t.intensityFactor=this._intensityFactor}this.renderPending=!0,BFN.MainUI.requestRender(),this.dispatchEvent(BFN.LensFlareDisplayEvents.ELEMENTS_ADDED)},Sx.prototype.setSourcePoint=function(e,t){this._sourcePoint.x=e*this.scaleFactor,this._sourcePoint.y=t*this.scaleFactor,this.updateElementPositions()},Sx.prototype.setCenterPoint=function(e,t){this._centerPoint.x=e*this.scaleFactor,this._centerPoint.y=t*this.scaleFactor,this.updateElementPositions()},Sx.prototype.updateElementPositions=function(){for(var e=0;e<this.elements.length;e++){this.elements[e].elementVO.dispatchEvent(BFN.LensFlareElementVOEvents.POSITION_UPDATED)}this.renderPending=!0,BFN.MainUI.requestRender()},Sx.prototype.setGlobalColors=function(e){for(var t=0;t<this.elements.length;t++){var n=this.elements[t],i=n.elementVO.getProperty("colorGlobalGroup");if(e.hasOwnProperty(i)){var r=parseInt("0x"+e[i]);n.elementVO.getProperty("colorGlobal")!=r&&n.elementVO.setProperty("colorGlobal",r)}}this.renderPending=!0,BFN.MainUI.requestRender()},Sx.prototype.getElementVOClones=function(){return[]},Sx.prototype.handleLensFlareManagerThumbsLoaded=function(){BFN.LensFlareManager.removeEventListener(BFN.LensFlareManagerEvents.THUMBS_LOADED.type,this.handleLensFlareManagerThumbsLoadedBind),this.addElementsComplete()},Sx.prototype.handleLensFlareManagerAssetsLoaded=function(){BFN.LensFlareManager.removeEventListener(BFN.LensFlareManagerEvents.ASSETS_LOADED.type,this.handleLensFlareManagerAssetsLoadedBind),this.addElementsComplete()},Sx.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,this._intenseMode||BFN.Stage.render(this.displayContainer,this.displayTexture))},Object.defineProperty(Sx.prototype,"sourcePoint",{get:function(){return this._sourcePoint}}),Object.defineProperty(Sx.prototype,"centerPoint",{get:function(){return this._centerPoint}}),Object.defineProperty(Sx.prototype,"displayDimensions",{get:function(){return this._displayDimensions}}),Object.defineProperty(Sx.prototype,"intenseMode",{set:function(e){this._intenseMode!=e&&(this._intenseMode=e,this.blackBackground.visible=!this._intenseMode,this.blendMode=this._intenseMode?PIXI.BLEND_MODES.NORMAL:PIXI.BLEND_MODES.SCREEN,this._intenseMode?(this.displayContainer.x=-Math.round(this._itemWidth/2),this.displayContainer.y=-Math.round(this._itemHeight/2),this.addChild(this.displayContainer),BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.texture=PIXI.Texture.EMPTY):(this.displayContainer.x=this.displayContainer.y=0,this.removeChild(this.displayContainer),this.displayTexture&&(BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),this.texture=this.displayTexture,this.renderPending=!0)),BFN.MainUI.requestRender())},get:function(){return this._intenseMode}}),Object.defineProperty(Sx.prototype,"intensityFactor",{set:function(e){this._intensityFactor=e;for(var t=0;t<this.elements.length;t++){this.elements[t].intensityFactor=this._intensityFactor}this.renderPending=!0,BFN.MainUI.requestRender()},get:function(){return this._intensityFactor}}),Object.defineProperty(Sx.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(Sx.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.LensFlareDisplay=Sx,Cx.prototype=Object.create(PIXI.Sprite.prototype),Cx.prototype.init=function(){BeFunky.log("ImageLensFlare Init"),this.initDefaultValues(),this.initImageContainer(),this.initBlackBackground(),this.initSourceSprite(),this.initLensFlareDisplay(),this.initControls(),this.initControlDragger()},Cx.prototype.initDefaultValues=function(){this.interactive=!0,this.sourceTexture=null,this.currentPresetID=null,this.currentPresetName=null,this.hovering=!1,this._scale=1,this.newSession=!1,this.keepGuidesOn=!1,this.on("pointerover",this.handleToolMouseOver.bind(this)),this.on("pointerout",this.handleToolMouseOut.bind(this)),this.on("pointerdown",this.handleToolMouseDown.bind(this))},Cx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Cx.prototype.initBlackBackground=function(){this.blackBackground=new PIXI.Sprite,this.imageContainer.addChild(this.blackBackground)},Cx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.imageContainer.addChild(this.sourceSprite)},Cx.prototype.initLensFlareDisplay=function(){this.lensFlareDisplay=new BFN.LensFlareDisplay,this.imageContainer.addChild(this.lensFlareDisplay)},Cx.prototype.initControls=function(){this.controls=new PIXI.Container,this.addChild(this.controls),this.flareSourceControl=this.getFlareControl(15),this.controls.addChild(this.flareSourceControl),this.flareCenterControl=this.getFlareControl(10),this.controls.addChild(this.flareCenterControl)},Cx.prototype.initControlDragger=function(){this.controlDragger=new BFN.Dragger,this.controlDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleControlDraggerDragging.bind(this)),this.controlDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleControlDraggerDraggingStarted.bind(this)),this.controlDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleControlDraggerDraggingComplete.bind(this))},Cx.prototype.handleLensFlareGeneric=function(){var e=UITools.getToolVO("lens_flare_generic");this.lensFlareDisplay.intenseMode="intense"==e.intense_mode,this.lensFlareDisplay.intensityFactor=e.intensity/100,BFN.StageModel.setRefreshFactor(e.updating?.5:1)},Cx.prototype.handleUpdateTool=function(e){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE){var t=UITools.getToolVO(e);if(this.newSession){this.newSession=!1;for(var n=1;n<=5;n++){var i="color_value_"+n;t.hasOwnProperty(i)&&UITools.setToolValue(e,i,t.defaultValues[i])}UITools.updateToolControls(e),UITools.setToolValue("lens_flare_generic","intense_mode","normal"),UITools.setToolValue("lens_flare_generic","intensity",0),UITools.updateToolControls("lens_flare_generic"),this.handleLensFlareGeneric()}if(t=UITools.getToolVO(e),this.currentPresetID!=t.presetID){this.currentPresetID=t.presetID,this.currentPresetName=BFN.LensFlareData.presets[this.currentPresetID].presetName;for(var r=BFN.LensFlareData.presets[this.currentPresetID].elementVOs,a=[],o=0;o<r.length;o++){var s=r[o];a.push(s.clone()),s.properties.blendMode}this.lensFlareDisplay.addElements(a)}for(var l=null,u=1;u<=5;u++)t.hasOwnProperty("color_value_"+u)&&(l||(l={}),l[u]=t["color_value_"+u]);l&&this.lensFlareDisplay.setGlobalColors(l)}},Cx.prototype.setSourceTexture=function(e){var t=e&&!this.sourceTexture;null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),e&&(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.newSession=!0),this.resetControls(t),this.updateDisplay(),this.sourceTexture||(this.currentPresetID=null,this.lensFlareDisplay.clearElements())},Cx.prototype.resetControls=function(e){if(this.keepGuidesOn=!1,this.controls.visible=!0,this.lensFlareDisplay.intenseMode=!1,this.lensFlareDisplay.intensityFactor=0,this.sourceTexture&&e){var t=Math.min(this.sourceTexture.width,this.sourceTexture.height)/4;this.setSourcePoint(t,-t),this.setCenterPoint(0,0)}BFN.MainUI.requestRender()},Cx.prototype.setSourcePoint=function(e,t){this.flareSourceControl.x=e,this.flareSourceControl.y=t,this.lensFlareDisplay.setSourcePoint(e,t),BFN.MainUI.requestRender()},Cx.prototype.setCenterPoint=function(e,t){this.flareCenterControl.x=e,this.flareCenterControl.y=t,this.lensFlareDisplay.setCenterPoint(e,t),BFN.MainUI.requestRender()},Cx.prototype.updateDisplay=function(){this.hitArea=new PIXI.Rectangle,this.blackBackgroundTexture||(this.blackBackgroundTexture=PIXI.RenderTexture.create(32,32),this.blackBackgroundTexture.fillColor(0),this.blackBackground.texture=this.blackBackgroundTexture),this.lensFlareDisplay.setDisplayDimensions(0,0),this.sourceTexture&&(this.hitArea=new PIXI.Rectangle(-this.sourceTexture.width,-this.sourceTexture.height,2*this.sourceTexture.width,2*this.sourceTexture.height),this.blackBackground.width=this.sourceTexture.width,this.blackBackground.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.lensFlareDisplay.x=Math.round(this.sourceTexture.width/2),this.lensFlareDisplay.y=Math.round(this.sourceTexture.height/2),this.lensFlareDisplay.setDisplayDimensions(this.sourceTexture.width,this.sourceTexture.height),this.lensFlareDisplay.setSourcePoint(this.flareSourceControl.x,this.flareSourceControl.y),this.lensFlareDisplay.setCenterPoint(this.flareCenterControl.x,this.flareCenterControl.y))},Cx.prototype.getFlareControl=function(e){var t,n,i=Math.round(2*(e+1+.5)),r=PIXI.RenderTexture.create(i,i,PIXI.settings.SCALE_MODE,window.bfn_resolution);t=3,n=i/2-1-.5-1,BFN.graphics.drawShape("roundedRect",r,{fillColor:2147483648,paddingX:t,paddingY:n,quality:.5,clear:!0}),BFN.graphics.drawShape("roundedRect",r,{fillColor:2147483648,paddingX:n,paddingY:t,quality:.5,clear:!1}),BFN.graphics.drawShape("ellipse",r,{strokeWidth:3,strokeColor:2147483648,quality:.5,clear:!1}),t=2.5,n=i/2-1-1,BFN.graphics.drawShape("roundedRect",r,{fillColor:4294967295,paddingX:t,paddingY:n,quality:.5,clear:!1}),BFN.graphics.drawShape("roundedRect",r,{fillColor:4294967295,paddingX:n,paddingY:t,quality:.5,clear:!1}),BFN.graphics.drawShape("ellipse",r,{strokeWidth:2,strokeColor:4294967295,paddingX:.5,paddingY:.5,quality:.5,clear:!1});var a=new PIXI.Sprite(r);return a.interactive=!0,a.buttonMode=!0,a.anchor.x=a.anchor.y=.5,a.on("pointerdown",this.handleFlareControlPressed.bind(this)),a},Cx.prototype.handleToolMouseOver=function(e){this.hovering=!0,this.controls.visible=!0,BFN.MainUI.requestRender()},Cx.prototype.handleToolMouseOut=function(e){this.hovering=!1,this.controlDragger.dragging||(this.controls.visible=this.keepGuidesOn,BFN.MainUI.requestRender())},Cx.prototype.handleToolMouseDown=function(e){this.hovering||(this.keepGuidesOn=!0,this.handleToolMouseOver())},Cx.prototype.handleFlareControlPressed=function(e){this.sourceTexture&&(this.controlDragger.setBounds(-this.sourceTexture.width,-this.sourceTexture.height,this.sourceTexture.width,this.sourceTexture.height),this.controlDragger.drag(e.currentTarget),e.stopPropagation())},Cx.prototype.handleControlDraggerDragging=function(e){switch(this.controlDragger.item){case this.flareSourceControl:this.lensFlareDisplay.setSourcePoint(this.controlDragger.draggedX,this.controlDragger.draggedY);break;case this.flareCenterControl:this.lensFlareDisplay.setCenterPoint(this.controlDragger.draggedX,this.controlDragger.draggedY)}},Cx.prototype.handleControlDraggerDraggingStarted=function(e){this.hovering||(this.keepGuidesOn=!0,this.handleToolMouseOver())},Cx.prototype.handleControlDraggerDraggingComplete=function(e){this.hovering||this.handleToolMouseOut(null)},Object.defineProperty(Cx.prototype,"toolScale",{set:function(e){this._scale=e,this.controlDragger.scale=this._scale,this.flareSourceControl.scale.x=this.flareSourceControl.scale.y=1/this._scale,this.flareCenterControl.scale.x=this.flareCenterControl.scale.y=1/this._scale},get:function(){return this._scale}}),Object.defineProperty(Cx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=0,this.imageContainer.y=0,BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),e}}),Object.defineProperty(BFN,"ImageLensFlare",{get:function(){return!BFN._ImageLensFlare&&(BFN._ImageLensFlare=new Cx),BFN._ImageLensFlare}}),Bx.prototype=Object.create(PIXI.Sprite.prototype),Bx.prototype.init=function(){BeFunky.log("ImageCrop Init"),this.initDefaultValues(),this.initImageContainer(),this.initSprites(),this.initCropFrame(),this.initCropGrid(),this.initCropHandles(),this.initDragger()},Bx.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.cropRatioLocked=!1,this.cropRatio=1,this.cropWidth=0,this.cropWidth=0,this.minCropSize=20,this.handleSize=20,this.imageBounds={minX:0,minY:0,maxX:0,maxY:0},this.currentCropHandle=null,this.cropRatios=BFN.CropRatioMap,this.handleCropFrameDraggingBind=this.handleCropFrameDragging.bind(this),this.handleCropFrameDraggingCompleteBind=this.handleCropFrameDraggingComplete.bind(this),this.handleCropHandleDraggingBind=this.handleCropHandleDragging.bind(this),this.handleCropHandleDraggingCompleteBind=this.handleCropHandleDraggingComplete.bind(this)},Bx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer)},Bx.prototype.initSprites=function(){this.uncroppedSprite=new PIXI.Sprite,this.uncroppedSprite.pluginName="blend_picture",this.uncroppedSprite.alpha=.5,this.imageContainer.addChild(this.uncroppedSprite),this.croppedSprite=new PIXI.Sprite,this.croppedSprite.pluginName="blend_picture",this.imageContainer.addChild(this.croppedSprite)},Bx.prototype.initCropFrame=function(){this.cropFrameContainer=new PIXI.Container,this.imageContainer.addChild(this.cropFrameContainer),this.cropFrameMask=new PIXI.Graphics,this.cropFrameMask.beginFill(16777215,1),this.cropFrameMask.drawRect(-50,-50,100,100),this.cropFrameMask.endFill(),this.cropFrameMask.interactive=!0,this.cropFrameMask.on("pointerdown",this.handleCropFramePress.bind(this)),this.cropFrame=new PIXI.Sprite,this.cropFrame.interactive=!0,this.cropFrame.addChild(this.cropFrameMask),this.cropFrameContainer.addChild(this.cropFrame),this.croppedSprite.mask=this.cropFrameMask},Bx.prototype.initCropGrid=function(){this.cropGrid=new BFN.CropGrid,this.cropFrame.addChild(this.cropGrid)},Bx.prototype.initCropHandles=function(){this.cropHandles={},this.cropHandleContainer=new PIXI.Container,this.cropFrameContainer.addChild(this.cropHandleContainer),this.cornerHandleIDs=["tl","tr","br","bl"];for(var e=0;e<this.cornerHandleIDs.length;e++){var t=this.cornerHandleIDs[e],n=new BFN.CropHandle(BFN.CropHandleTypes.TYPE_CORNER,e*Math.PI/2,this.handleSize);n.id=t,n.type="corner",n.on("pointerdown",this.handleCropHandlePress.bind(this)),this.cropHandles[t]=n,this.cropHandleContainer.addChild(n)}this.sideHandleIDs=["t","r","b","l"];for(var i=0;i<this.sideHandleIDs.length;i++){var r=this.sideHandleIDs[i],a=new BFN.CropHandle(BFN.CropHandleTypes.TYPE_EDGE,i*Math.PI/2,this.handleSize);a.id=r,a.type="side",a.on("pointerdown",this.handleCropHandlePress.bind(this)),this.cropHandles[r]=a,this.cropHandleContainer.addChild(a)}for(var o in this.cropHandles){var s=this.cropHandles[o];switch(o){case"tl":s.anchorHandle=this.cropHandles.br;break;case"tr":s.anchorHandle=this.cropHandles.bl;break;case"br":s.anchorHandle=this.cropHandles.tl;break;case"bl":s.anchorHandle=this.cropHandles.tr;break;case"t":s.anchorHandle=this.cropHandles.b;break;case"r":s.anchorHandle=this.cropHandles.l;break;case"b":s.anchorHandle=this.cropHandles.t;break;case"l":s.anchorHandle=this.cropHandles.r}}},Bx.prototype.initDragger=function(){this.dragger=new BFN.Dragger,this.dragger.stickyDrag=!1},Bx.prototype.handleCrop=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP&&this.sourceTexture&&!this.dragger.dragging){var e=UITools.getToolVO("crop"),t=e.updating_id;if("aspect_ratio"==t&&this.cropRatios.hasOwnProperty(e.aspect_ratio)){var n=e.aspect_ratio,i=this.cropRatios[n];if("freeform"==n)e.lock_aspect_ratio=!1;else{switch(e.lock_aspect_ratio=!0,"original_ratio"==n&&(i=this.sourceTexture.height/this.sourceTexture.width),e.orientation){case"landscape":this.cropRatio=i<1?i:1/i,this.cropWidth=Math.min(Math.round(.9*this.sourceTexture.width),Math.round(this.sourceTexture.height/this.cropRatio*.9)),this.cropHeight=Math.round(this.cropWidth*this.cropRatio);break;case"portrait":this.cropRatio=i>1?i:1/i,this.cropHeight=Math.min(Math.round(.9*this.sourceTexture.height),Math.round(this.sourceTexture.width*this.cropRatio*.9)),this.cropWidth=Math.round(this.cropHeight/this.cropRatio)}this.cropFrame.x=this.cropFrame.y=0,this.updateCropHandlePositions()}UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop")}if(this.cropRatioLocked=e.lock_aspect_ratio,this.cropRatioLocked)switch("lock_aspect_ratio"==t&&(this.cropRatio=this.cropHeight/this.cropWidth),t){case"crop_width":this.cropWidth=Math.max(this.minCropSize,this.minCropSize/this.cropRatio,Math.min(this.sourceTexture.width,e.crop_width)),this.cropHeight=Math.min(this.sourceTexture.height,this.cropWidth*this.cropRatio),this.cropWidth=this.cropHeight/this.cropRatio,this.cropWidth=Math.round(this.cropWidth),this.cropHeight=Math.round(this.cropHeight),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop");break;case"crop_height":this.cropHeight=Math.max(this.minCropSize,this.minCropSize*this.cropRatio,Math.min(this.sourceTexture.height,e.crop_height)),this.cropWidth=Math.min(this.sourceTexture.width,this.cropHeight/this.cropRatio),this.cropHeight=this.cropWidth*this.cropRatio,this.cropWidth=Math.round(this.cropWidth),this.cropHeight=Math.round(this.cropHeight),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop")}else if("lock_aspect_ratio"==t)e.aspect_ratio="freeform",UITools.updateToolControl("crop_aspect_ratio");else switch(this.cropWidth=Math.round(Math.max(this.minCropSize,Math.min(this.sourceTexture.width,e.crop_width))),this.cropHeight=Math.round(Math.max(this.minCropSize,Math.min(this.sourceTexture.height,e.crop_height))),t){case"crop_width":case"crop_height":this.updateOrientation(),UITools.setToolValue("crop","orientation",this.orientation),UITools.updateToolControl("crop_orientation")}if("orientation"==t){var r=this.cropHeight/this.cropWidth;switch(e.orientation){case"landscape":this.cropRatio=r<1?r:1/r,this.cropWidth=Math.min(Math.round(.9*this.sourceTexture.width),Math.round(this.sourceTexture.height/this.cropRatio*.9)),this.cropHeight=Math.round(this.cropWidth*this.cropRatio);break;case"portrait":this.cropRatio=r>1?r:1/r,this.cropHeight=Math.min(Math.round(.9*this.sourceTexture.height),Math.round(this.sourceTexture.width*this.cropRatio*.9)),this.cropWidth=Math.round(this.cropHeight/this.cropRatio)}this.cropFrame.x=this.cropFrame.y=0,this.updateCropHandlePositions(),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop")}this.updateCropFrameCenter(),BFN.MainUI.requestRender()}},Bx.prototype.setSourceTexture=function(e){if(this.reset(),e){this.imageContainer.x=Math.floor(-e.width/2),this.imageContainer.y=Math.floor(-e.height/2),this.cropFrameContainer.x=Math.abs(this.imageContainer.x),this.cropFrameContainer.y=Math.abs(this.imageContainer.y),this.sourceTexture=e,this.uncroppedSprite.texture=this.sourceTexture,this.croppedSprite.texture=this.sourceTexture,this.imageBounds.minX=-e.width/2,this.imageBounds.minY=-e.height/2,this.imageBounds.maxX=e.width/2,this.imageBounds.maxY=e.height/2,this.cropWidth=Math.round(.9*this.sourceTexture.width),this.cropHeight=Math.round(.9*this.sourceTexture.height),this.updateCropHandlePositions(),this.updateDraggerBounds();var t=UITools.getParamObject("crop_crop_width");t.min=this.minCropSize,t.max=this.sourceTexture.width;var n=UITools.getParamObject("crop_crop_height");n.min=this.minCropSize,n.max=this.sourceTexture.height,UITools.setToolValue("crop","aspect_ratio","freeform"),this.updateOrientation(),UITools.setToolValue("crop","orientation",this.orientation),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.setToolValue("crop","lock_aspect_ratio",!1),UITools.updateToolControls("crop")}},Bx.prototype.updateCropFrameDisplay=function(){this.cropFrameMask.width=this.cropWidth,this.cropFrameMask.height=this.cropHeight,this.cropGrid.setDimensions(this.cropWidth,this.cropHeight)},Bx.prototype.updateCropFrameCenter=function(){if(this.currentCropHandle){var e=this.currentCropHandle,t=this.currentCropHandle.anchorHandle;switch(e.id){case"tl":case"l":case"bl":this.cropFrame.x=t.x-this.cropWidth/2;break;case"tr":case"r":case"br":this.cropFrame.x=t.x+this.cropWidth/2}switch(e.id){case"tl":case"t":case"tr":this.cropFrame.y=t.y-this.cropHeight/2;break;case"bl":case"b":case"br":this.cropFrame.y=t.y+this.cropHeight/2}}else this.cropFrame.x=Math.max(-this.sourceTexture.width/2+this.cropWidth/2,Math.min(this.sourceTexture.width/2-this.cropWidth/2,this.cropFrame.x)),this.cropFrame.y=Math.max(-this.sourceTexture.height/2+this.cropHeight/2,Math.min(this.sourceTexture.height/2-this.cropHeight/2,this.cropFrame.y));this.updateCropHandlePositions()},Bx.prototype.updateCropHandlePositions=function(){for(var e in this.cropHandles){var t=this.cropHandles[e];switch(e){case"tl":case"bl":case"l":t.x=this.cropFrame.x-this.cropWidth/2,"side"==t.type&&(t.y=this.cropFrame.y);break;case"tr":case"br":case"r":t.x=this.cropFrame.x+this.cropWidth/2,"side"==t.type&&(t.y=this.cropFrame.y)}switch(e){case"tl":case"tr":case"t":t.y=this.cropFrame.y-this.cropHeight/2,"side"==t.type&&(t.x=this.cropFrame.x);break;case"bl":case"br":case"b":t.y=this.cropFrame.y+this.cropHeight/2,"side"==t.type&&(t.x=this.cropFrame.x)}t.x=Math.floor(t.x),t.y=Math.floor(t.y)}this.updateCropHandleVisibility(),this.updateCropFrameDisplay()},Bx.prototype.updateCropHandleVisibility=function(){var e=this.cropWidth*this._scale<4*this.handleSize||this.cropHeight*this._scale<4*this.handleSize;for(var t in this.cropHandles){var n=this.cropHandles[t],i=!0;switch(t){case"tl":case"tr":case"br":case"bl":break;case"l":case"r":i=this.cropHeight*this._scale>2*this.handleSize;break;case"t":case"b":i=this.cropWidth*this._scale>2*this.handleSize}if(n.visible=i,i){switch(t){case"tl":case"bl":case"l":n.handle.x=e?-this.handleSize:0;break;case"tr":case"br":case"r":n.handle.x=e?this.handleSize:0}switch(t){case"tl":case"tr":case"t":n.handle.y=e?-this.handleSize:0;break;case"bl":case"br":case"b":n.handle.y=e?this.handleSize:0}}}},Bx.prototype.updateCropHandleScales=function(){var e=1/this._scale;for(var t in this.cropHandles){var n=this.cropHandles[t];n.scale.x=n.scale.y=e}},Bx.prototype.updateDraggerBounds=function(){var e=this.sourceTexture.width/2-this.cropWidth/2,t=this.sourceTexture.height/2-this.cropHeight/2;this.dragger.setBounds(-e,-t,e,t)},Bx.prototype.updateOrientation=function(){this.orientation=this.cropHeight/this.cropWidth<1?"landscape":"portrait"},Bx.prototype.setSmoothingScale=function(e){this.uncroppedSprite.currentScale=e,this.croppedSprite.currentScale=e},Bx.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null,this.uncroppedSprite.texture=PIXI.Texture.EMPTY,this.croppedSprite.texture=PIXI.Texture.EMPTY),this.cropFrame.x=this.cropFrame.y=0},Bx.prototype.handleCropFramePress=function(e){BFN.ImageCrop.sourceTexture&&(this.updateDraggerBounds(),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropFrameDraggingBind),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropFrameDraggingCompleteBind),this.dragger.drag(this.cropFrame))},Bx.prototype.handleCropFrameDragging=function(e){this.updateCropHandlePositions()},Bx.prototype.handleCropFrameDraggingComplete=function(e){this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropFrameDraggingBind),this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropFrameDraggingCompleteBind)},Bx.prototype.handleCropHandlePress=function(e){if(this.sourceTexture){this.currentCropHandle=this.cropHandles[e.target.id],this.dragger.setBounds(this.imageBounds.minX,this.imageBounds.minY,this.imageBounds.maxX,this.imageBounds.maxY),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropHandleDraggingBind),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropHandleDraggingCompleteBind);var t=this.currentCropHandle,n=this.currentCropHandle.anchorHandle;this.cropRatio=this.cropHeight/this.cropWidth;var i=Math.max(this.minCropSize,this.minCropSize/(this.cropRatioLocked?this.cropRatio:1)),r=Math.max(this.minCropSize,this.minCropSize*(this.cropRatioLocked?this.cropRatio:1));switch(t.id){case"tl":case"l":case"bl":this.dragger.bounds.maxX=n.x-i;break;case"tr":case"r":case"br":this.dragger.bounds.minX=n.x+i}switch(t.id){case"tl":case"t":case"tr":this.dragger.bounds.maxY=n.y-r;break;case"bl":case"b":case"br":this.dragger.bounds.minY=n.y+r}switch(t.id){case"l":case"r":this.dragger.bounds.minY=this.dragger.bounds.maxY=t.y;break;case"t":case"b":this.dragger.bounds.minX=this.dragger.bounds.maxX=t.x}this.dragger.drag(this.currentCropHandle),BFN.TooltipScreen.show("W: "+this.cropWidth+", H: "+this.cropHeight,!0,!0),BFN.TooltipScreen.setPosition(BeFunky.globalPointerCoords.x,BeFunky.globalPointerCoords.y,!1,!0)}},Bx.prototype.handleCropHandleDragging=function(e){var t=this.currentCropHandle,n=this.currentCropHandle.anchorHandle,i=Math.abs(n.x-t.x)||this.cropWidth,r=Math.abs(n.y-t.y)||this.cropHeight;if(this.cropRatioLocked)if("corner"==t.type){switch(i*(i*this.cropRatio)<r*(r/this.cropRatio)?i=r/this.cropRatio:r=i*this.cropRatio,t.id){case"tl":case"bl":n.x-i<this.dragger.bounds.minX&&(r=(i=n.x-this.dragger.bounds.minX)*this.cropRatio);break;case"tr":case"br":n.x+i>this.dragger.bounds.maxX&&(r=(i=this.dragger.bounds.maxX-n.x)*this.cropRatio)}switch(t.id){case"tl":case"tr":n.y-r<this.dragger.bounds.minY&&(i=(r=n.y-this.dragger.bounds.minY)/this.cropRatio);break;case"bl":case"br":n.y+r>this.dragger.bounds.maxY&&(i=(r=this.dragger.bounds.maxY-n.y)/this.cropRatio)}}else switch(t.id){case"l":case"r":r=i*this.cropRatio,this.cropFrame.y-r/2<this.imageBounds.minY&&(r=2*(this.cropFrame.y-this.imageBounds.minY)),this.cropFrame.y+r/2>this.imageBounds.maxY&&(r=2*(this.imageBounds.maxY-this.cropFrame.y)),i=r/this.cropRatio;break;case"t":case"b":i=r/this.cropRatio,this.cropFrame.x-i/2<this.imageBounds.minX&&(i=2*(this.cropFrame.x-this.imageBounds.minX)),this.cropFrame.x+i/2>this.imageBounds.maxX&&(i=2*(this.imageBounds.maxX-this.cropFrame.x)),r=i*this.cropRatio}this.cropWidth=Math.floor(i),this.cropHeight=Math.floor(r),this.updateCropFrameCenter(),this.updateOrientation(),UITools.setToolValue("crop","orientation",this.orientation),UITools.setToolValue("crop","crop_width",this.cropWidth),UITools.setToolValue("crop","crop_height",this.cropHeight),UITools.updateToolControls("crop"),BFN.TooltipScreen.setMessage("W: "+this.cropWidth+", H: "+this.cropHeight)},Bx.prototype.handleCropHandleDraggingComplete=function(e){this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCropHandleDraggingBind),this.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCropHandleDraggingCompleteBind),this.currentCropHandle=null,BFN.TooltipScreen.hide()},Object.defineProperty(Bx.prototype,"toolScale",{set:function(e){this._scale=e,this.dragger.scale=this._scale,this.cropGrid.scale=this._scale,this.updateCropHandleVisibility(),this.updateCropHandleScales(),this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Bx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.cropWidth),Math.round(this.cropHeight)),t=Math.max(-(this.sourceTexture.width-e.width),Math.min(0,-(this.cropHandles.tl.x+this.cropFrameContainer.x))),n=Math.max(-(this.sourceTexture.height-e.height),Math.min(0,-(this.cropHandles.tl.y+this.cropFrameContainer.y)));return e.copyPixels(this.sourceTexture,new PIXI.Point(t,n)),e}}),Object.defineProperty(Bx.prototype,"cropOffsetLeft",{get:function(){return-(this.cropHandles.l.x+this.cropHandles.r.x)/2}}),Object.defineProperty(Bx.prototype,"cropOffsetTop",{get:function(){return-(this.cropHandles.t.y+this.cropHandles.b.y)/2}}),Object.defineProperty(Bx.prototype,"cropRect",{get:function(){return new BFN.Rectangle(Math.round(this.cropHandles.l.x-this.imageBounds.minX),Math.round(this.cropHandles.t.y-this.imageBounds.minY),Math.round(this.cropWidth),Math.round(this.cropHeight))}}),Object.defineProperty(BFN,"ImageCrop",{get:function(){return!BFN._ImageCrop&&(BFN._ImageCrop=new Bx),BFN._ImageCrop}}),Fx.prototype=Object.create(PIXI.Sprite.prototype),Fx.prototype.init=function(){BeFunky.log("ImagePaintBrush Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initPainter()},Fx.prototype.initDefaultValues=function(){this._scale=1,this.sourceTexture=null},Fx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Fx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Fx.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="blend_picture",this.painter.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.painter.lowerResolutionForLargeImages=!1,this.imageContainer.addChild(this.painter)},Fx.prototype.handlePaintBrush=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH&&this.updatePaintBrushParameters()},Fx.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),UITools.setToolValue("paint_brush","erase",!1),UITools.updateToolControls("paint_brush"),this.updatePaintBrushParameters()):this.painter.reset()},Fx.prototype.updatePaintBrushParameters=function(){var e=UITools.getToolVO("paint_brush");if(e){this.painter.blendMode!=e.blend_mode&&(this.painter.blendMode=e.blend_mode),this.painter.alpha!=e.opacity&&(this.painter.alpha=e.opacity),e.clear&&(this.painter.clear(!0),UITools.setToolValue("paint_brush","erase",!1),UITools.updateToolControl("paint_brush_erase")),this.painter.eraseMode!=e.erase&&(this.painter.eraseMode=e.erase),e.updating&&"size"==e.updating_id&&this.painter.brushSizeFactor!=e.size/100&&(this.painter.brushSizeFactor=e.size/100);var t=!1;e.updating||"size"!=e.updating_id&&this.painter.brushSizeFactor==e.size/100||(this.painter.brushSizeFactor=e.size/100,t=!0),e.updating||"hardness"!=e.updating_id&&this.painter.brushHardnessFactor==e.hardness/100||(this.painter.brushHardnessFactor=e.hardness/100,t=!0),e.updating||"strength"!=e.updating_id&&this.painter.brushStrengthFactor==e.strength/100||(this.painter.brushStrengthFactor=e.strength/100,t=!0),e.updating||"color"!=e.updating_id&&this.painter.brushColor=="0x"+e.color||(this.painter.brushColor="0x"+e.color,t=!0),t&&this.painter.updateBrush()}},Fx.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.painter.currentScale=e},Object.defineProperty(Fx.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Fx.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.removeChild(this.imageContainer),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.addChild(this.imageContainer),e}return null}}),Object.defineProperty(BFN,"ImagePaintBrush",{get:function(){return!BFN._ImagePaintBrush&&(BFN._ImagePaintBrush=new Fx),BFN._ImagePaintBrush}}),Ex.prototype=Object.create(PIXI.Sprite.prototype),Ex.prototype.init=function(){BeFunky.log("ImageClone Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initCloneSprite(),this.initPainter(),this.initTargetSprite(),this.initDestinationSprite()},Ex.prototype.initDefaultValues=function(){this._scale=1,this.originalTexture=null,this.sourceTexture=null,this.mouseDown=!1,this.waiting=!1,this.targetSet=!1,this.cloneOffsetPoint=null,this.erasing=!1,this.ctrlKeyCodes=[17,91,93],this.ctrlKeyCode=null,this.ctrlKeyDown=!1,this.handlePainterMouseDownBind=this.handlePainterMouseDown.bind(this),this.handlePainterMouseMoveBind=this.handlePainterMouseMove.bind(this),this.handlePainterMouseOverBind=this.handlePainterMouseOver.bind(this),this.handlePainterMouseOutBind=this.handlePainterMouseOut.bind(this),this.handlePainterKeyDownBind=this.handlePainterKeyDown.bind(this),this.handlePainterKeyUpBind=this.handlePainterKeyUp.bind(this),this.handleBrushCircleAnimatorUpdateBind=this.handleBrushCircleAnimatorUpdate.bind(this)},Ex.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Ex.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Ex.prototype.initCloneSprite=function(){this.cloneContainer=new PIXI.Container,this.imageContainer.addChild(this.cloneContainer),this.cloneSprite=new PIXI.Sprite,this.cloneSprite.pluginName="smooth_picture",this.cloneContainer.addChild(this.cloneSprite)},Ex.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.painter.allowBrushCircle=!0,this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_UPDATED_PRE_HISTORY.type,this.handlePaintUpdatedPreHistory.bind(this)),this.cloneContainer.addChild(this.painter),this.cloneSprite.mask=this.painter},Ex.prototype.initTargetSprite=function(){var e,t,n=Math.round(23);this.targetTexture=PIXI.RenderTexture.create(n,n,PIXI.settings.SCALE_MODE,window.bfn_resolution),e=3,t=n/2-1-.5-1,BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:2147483648,paddingX:e,paddingY:t,clear:!0}),BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:2147483648,paddingX:t,paddingY:e,clear:!1}),BFN.graphics.drawShape("ellipse",this.targetTexture,{strokeWidth:3,strokeColor:2147483648,clear:!1}),e=2.5,t=n/2-1-1,BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:4294967295,paddingX:e,paddingY:t,clear:!1}),BFN.graphics.drawShape("roundedRect",this.targetTexture,{fillColor:4294967295,paddingX:t,paddingY:e,clear:!1}),BFN.graphics.drawShape("ellipse",this.targetTexture,{strokeWidth:2,strokeColor:4294967295,paddingX:.5,paddingY:.5,clear:!1}),this.target=new PIXI.Container,this.target.interactive=!1,this.addChild(this.target),this.targetSprite=new PIXI.Sprite(this.targetTexture),this.targetSprite.interactive=!1,this.targetSprite.hitArea=new PIXI.Rectangle(0,0,0,0),this.targetSprite.anchor.x=this.targetSprite.anchor.y=.5,this.target.addChild(this.targetSprite)},Ex.prototype.initDestinationSprite=function(){var e,t,n=Math.round(23);this.destinationTexture=PIXI.RenderTexture.create(n,n,PIXI.settings.SCALE_MODE,window.bfn_resolution),e=0,t=n/2-1-.5-1,BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:2147483648,paddingX:e,paddingY:t,clear:!0}),BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:2147483648,paddingX:t,paddingY:e,clear:!1}),e=0,t=n/2-1-1,BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:4294967295,paddingX:e,paddingY:t,clear:!1}),BFN.graphics.drawShape("roundedRect",this.destinationTexture,{fillColor:4294967295,paddingX:t,paddingY:e,clear:!1}),this.destination=new PIXI.Container,this.destination.interactive=!1,this.addChild(this.destination),this.destinationSprite=new PIXI.Sprite(this.destinationTexture),this.destinationSprite.interactive=!1,this.destinationSprite.hitArea=new PIXI.Rectangle(0,0,0,0),this.destinationSprite.anchor.x=this.destinationSprite.anchor.y=.5,this.destination.addChild(this.destinationSprite)},Ex.prototype.handleClone=function(){BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE&&this.updateCloneParameters()},Ex.prototype.setSourceTexture=function(e){this.originalTexture=null,null!=this.sourceTexture&&(this.sourceTexture.destroyGC(!0),this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=e?(this.originalTexture=e,this.sourceTexture=PIXI.RenderTexture.create(e.width,e.height),this.sourceTexture.copyPixels(e),this.sourceSprite.texture=this.sourceTexture,this.cloneSprite.texture=this.sourceTexture,this.painter.altTexture=this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.updateCloneParameters(),this.resetTarget(),this.painter.on("pointerdown",this.handlePainterMouseDownBind),BFN.MainUI.on("pointermove",this.handlePainterMouseMoveBind),this.painter.on("pointerover",this.handlePainterMouseOverBind),this.painter.on("pointerout",this.handlePainterMouseOutBind),BFN.BrushCircle.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleBrushCircleAnimatorUpdateBind)):(this.painter.reset(),BFN.BrushCircle.targetEnabled=!1,UITools.setToolValue("clone","brush_erase",!1),UITools.updateToolControl("clone_brush_erase"),this.painter.off("pointerdown",this.handlePainterMouseDownBind),BFN.MainUI.off("pointermove",this.handlePainterMouseMoveBind),this.painter.off("pointerover",this.handlePainterMouseOverBind),this.painter.off("pointerout",this.handlePainterMouseOutBind),this.handlePainterMouseOutBind(),BFN.BrushCircle.animator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleBrushCircleAnimatorUpdateBind))},Ex.prototype.resetTarget=function(){this.targetSet=!1,this.targetSprite.visible=!1,this.destinationSprite.visible=!1,this.cloneOffsetPoint=null,this.cloneSprite.x=this.cloneSprite.y=0,BFN.BrushCircle.targetEnabled=!0,this.painter.paintingEnabled=!1,BFN.MainUI.requestRender()},Ex.prototype.updateCloneParameters=function(){var e=UITools.getToolVO("clone");if(e){e.target_reset&&this.resetTarget(),e.brush_clear&&(this.painter.clear(!0),this.sourceTexture.copyPixels(this.originalTexture),UITools.setToolValue("clone","brush_erase",!1),UITools.updateToolControl("clone_brush_erase")),this.erasing!=e.brush_erase&&(this.erasing=e.brush_erase,BFN.BrushCircle.targetEnabled=!this.targetSet&&!this.erasing,this.cloneSprite.x=this.cloneSprite.y=0,this.erasing?this.cloneSprite.texture=this.originalTexture:(this.cloneSprite.texture=this.sourceTexture,this.cloneOffsetPoint&&(this.cloneSprite.x=-Math.round(this.cloneOffsetPoint.x),this.cloneSprite.y=-Math.round(this.cloneOffsetPoint.y)))),e.updating&&"brush_size"==e.updating_id&&this.painter.brushSizeFactor!=e.brush_size/100&&(this.painter.brushSizeFactor=e.brush_size/100);var t=!1;e.updating||"brush_size"!=e.updating_id&&this.painter.brushSizeFactor==e.brush_size/100||(this.painter.brushSizeFactor=e.brush_size/100,t=!0),e.updating||"brush_hardness"!=e.updating_id&&this.painter.brushSizeFactor==e.brush_hardness/100||(this.painter.brushHardnessFactor=e.brush_hardness/100,t=!0),e.updating||"brush_strength"!=e.updating_id&&this.painter.brushOpacityFactor==e.brush_strength/100||(this.painter.brushOpacityFactor=e.brush_strength/100,t=!0),t&&this.painter.updateBrush()}},Ex.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.cloneSprite.currentScale=e,this.painter.currentScale=e},Ex.prototype.handlePainterMouseDown=function(e){if(!this.erasing){var t=this.painter.getPointerPosition(e);!this.targetSet||this.ctrlKeyDown?(this.ctrlKeyDown&&this.resetTarget(),this.targetSet=!0,this.targetSprite.visible=!0,this.destinationSprite.visible=!0,this.target.x=t.x+this.imageContainer.x,this.target.y=t.y+this.imageContainer.y,this.target.alpha=1,this.target.visible=!0,BFN.BrushCircle.targetEnabled=!1,this.painter.paintingEnabled=!0,e.data.originalEvent.stopImmediatePropagation()):this.cloneOffsetPoint||(this.cloneOffsetPoint=new PIXI.Point(this.target.x-this.imageContainer.x-t.x,this.target.y-this.imageContainer.y-t.y),this.cloneSprite.x=-Math.round(this.cloneOffsetPoint.x),this.cloneSprite.y=-Math.round(this.cloneOffsetPoint.y)),this.cloneOffsetPoint&&(this.target.x=t.x+this.imageContainer.x+this.cloneOffsetPoint.x,this.target.y=t.y+this.imageContainer.y+this.cloneOffsetPoint.y,this.destination.x=t.x+this.imageContainer.x,this.destination.y=t.y+this.imageContainer.y),BFN.MainUI.requestRender()}},Ex.prototype.handlePainterMouseMove=function(e){if(this.mouseDown&&!this.painter.mouseDown&&!this.waiting)return this.mouseDown=!1,this.waiting=!0,void setTimeout(function(){this.waiting=!1}.bind(this),50);if(!this.waiting){this.mouseDown=this.painter.mouseDown;var t=this.painter.getPointerPosition(e);this.cloneOffsetPoint&&(this.target.x=t.x+this.imageContainer.x+this.cloneOffsetPoint.x,this.target.y=t.y+this.imageContainer.y+this.cloneOffsetPoint.y),this.destination.x=t.x+this.imageContainer.x,this.destination.y=t.y+this.imageContainer.y}},Ex.prototype.handlePainterMouseOver=function(e){document.addEventListener("keydown",this.handlePainterKeyDownBind,!1)},Ex.prototype.handlePainterMouseOut=function(e){document.removeEventListener("keydown",this.handlePainterKeyDownBind)},Ex.prototype.handlePainterKeyDown=function(e){!this.targetSet||this.erasing||this.ctrlKeyDown||-1==this.ctrlKeyCodes.indexOf(e.keyCode)||(this.targetSprite.visible=!1,this.destinationSprite.visible=!1,BFN.MainUI.requestRender(),BFN.BrushCircle.targetEnabled=!0,this.ctrlKeyDown=!0,this.ctrlKeyCode=e.keyCode,document.addEventListener("keyup",this.handlePainterKeyUpBind,!1))},Ex.prototype.handlePainterKeyUp=function(e){this.ctrlKeyDown&&this.ctrlKeyCode==e.keyCode&&(this.targetSet&&(this.targetSprite.visible=!0,this.destinationSprite.visible=!0,BFN.MainUI.requestRender()),BFN.BrushCircle.targetEnabled=!1,this.ctrlKeyDown=!1,this.ctrlKeyCode=null,document.removeEventListener("keyup",this.handlePainterKeyUpBind))},Ex.prototype.handleBrushCircleAnimatorUpdate=function(e){this.target.alpha=this.destination.alpha=BFN.BrushCircle.animator.animationFactor,this.target.visible=this.destination.visible=this.target.alpha>0&&!this.erasing,this.targetSet&&!this.cloneOffsetPoint&&(this.target.alpha=1,this.target.visible=!0)},Ex.prototype.handlePaintUpdatedPreHistory=function(e){this.setSmoothingScale(1),BFN.Stage.render(this.cloneContainer,this.sourceTexture,!1),this.setSmoothingScale(this._scale),this.painter.clear(!1)},Object.defineProperty(Ex.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.target.scale.x=this.target.scale.y=1/this._scale,this.destination.scale.x=this.destination.scale.y=1/this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Ex.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),e}return null}}),Object.defineProperty(BFN,"ImageClone",{get:function(){return!BFN._ImageClone&&(BFN._ImageClone=new Ex),BFN._ImageClone}}),Px.prototype=Object.create(PIXI.Sprite.prototype),Px.prototype.init=function(){BeFunky.log("ImageBlemish Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initResultSprite(),this.initPainter()},Px.prototype.initDefaultValues=function(){this._scale=1,this.sourceTexture=null,this.resultTexture=null,this.erasing=!1,this.replaceFilter=new BFN.filters.ReplaceFilter,this.alphaFilter=new BFN.filters.BlendModeFilter(BFN.CONST.BLEND_MODES.ALPHA),this.blendModeSprite=new BFN.BlendModeSprite(!1),this.eraseSprite=new PIXI.Sprite,this.handleAltBitmapDataUpdatedBind=this.handleAltBitmapDataUpdated.bind(this)},Px.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Px.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite},Px.prototype.initResultSprite=function(){this.resultSprite=new PIXI.Sprite,this.imageContainer.addChild(this.resultSprite)},Px.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.brushEnabled=!1,this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handleBrushApplied.bind(this)),this.imageContainer.addChild(this.painter)},Px.prototype.handleBlemish=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX){var e=UITools.getToolVO("blemish_fix");if(e){e.brush_clear&&(this.painter.clear(!0),this.resultTexture.copyPixels(this.sourceTexture),UITools.setToolValue("blemish_fix","brush_erase",!1),UITools.updateToolControl("blemish_fix_brush_erase")),this.erasing=e.brush_erase,this.painter.singleClick==this.erasing&&(this.painter.singleClick=!this.erasing);var t=e.brush_size/100*.2+.1,n=e.brush_size/100*.08+.02;e.updating&&"brush_size"==e.updating_id&&this.painter.brushSizeFactor!=t&&(this.painter.brushSizeFactor=t);var i=!1;e.updating||"brush_size"!=e.updating_id&&this.painter.brushSizeFactor==t||(this.painter.brushSizeFactor=t,i=!0),e.updating||"brush_hardness"!=e.updating_id&&this.painter.brushHardnessFactor==n||(this.painter.brushHardnessFactor=e.brush_hardness/100,i=!0),i&&this.painter.updateBrush()}}},Px.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.resultTexture.destroyGC(!0)}catch(e){}this.resultTexture=null,this.resultSprite.texture=PIXI.Texture.EMPTY,this.painter.altTexture=null,BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind)},Px.prototype.setSourceTexture=function(e){this.reset(),e?(this.imageContainer.x=-Math.round(e.width/2),this.imageContainer.y=-Math.round(e.height/2),this.sourceTexture=e,this.resultTexture=e.renderClone(),this.sourceSprite.texture=this.sourceTexture,this.resultSprite.texture=this.resultTexture,this.painter.altTexture=this.resultTexture,BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind),UITools.setToolValue("blemish_fix","brush_erase",!1),UITools.setToolValue("blemish_fix","brush_size",50),UITools.setToolValue("blemish_fix","brush_hardness",40),UITools.updateToolControls("blemish_fix")):(this.imageContainer.x=0,this.imageContainer.y=0),this.updatePainter()},Px.prototype.updatePainter=function(){this.sourceTexture?this.painter.painterWidth==this.sourceTexture.width&&this.painter.painterHeight==this.sourceTexture.height||this.painter.setup(this.sourceTexture.width,this.sourceTexture.height):this.painter.reset()},Px.prototype.removeBlemish=function(){if(this.resultTexture){var e=new PIXI.Rectangle(this.painter.brushRect.x,this.painter.brushRect.y,this.painter.brushRect.width,this.painter.brushRect.height),t=PIXI.RenderTexture.create(e.width,e.height);t.copyPixels(this.resultTexture,new PIXI.Point(-e.x,-e.y)),this.replaceDarksWithAverage(t);for(var n=BFN.Util.getTextureAverageColor(t,!0),i=this.getColorBrightness(n),r=[],a=PIXI.RenderTexture.create(e.width,e.height),o=[],s=0;s<8;s++){var l=0,u=0;switch(s){case 0:case 1:case 7:l=-Math.floor(e.width/2);break;case 3:case 4:case 5:l=Math.floor(e.width/2)}switch(s){case 1:case 2:case 3:u=-Math.floor(e.height/2);break;case 5:case 6:case 7:l=Math.floor(e.height/2)}var c=new PIXI.Rectangle(e.x+l,e.y+u,e.width,e.height);a.copyPixels(this.resultTexture,new PIXI.Point(-c.x,-c.y));var h=this.getColorBrightness(BFN.Util.getTextureAverageColor(a,!0));r.push(c),o.push(h)}for(var d=0,m=1,p=0;p<o.length;p++){var g=o[p],f=Math.abs(i-g);f<m&&(d=p,m=f)}var v=r[d];a.copyPixels(this.resultTexture,new PIXI.Point(-v.x,-v.y)),r.splice(0),o.splice(0);var y=t.renderClone();this.blendModeSprite.setBaseTexture(y),this.blendModeSprite.setBlendTexture(a),this.blendModeSprite.setBlendMode(BFN.CONST.BLEND_MODES.LIGHTEN),this.blendModeSprite.renderDisplay(),this.alphaFilter.intensity=1,this.alphaFilter.iChannel1=this.painter.brush.texture,this.blendModeSprite.filters=[this.alphaFilter],BFN.Stage.render(this.blendModeSprite,t),y.destroyGC(!0),this.resultTexture.copyPixels(t,new PIXI.Point(e.x,e.y),!1),t.destroyGC(!0),a.destroyGC(!0)}BFN.MainUI.requestRender()},Px.prototype.erase=function(){if(this.sourceTexture&&this.resultTexture){var e=new PIXI.Rectangle(this.painter.brushRect.x,this.painter.brushRect.y,this.painter.brushRect.width,this.painter.brushRect.height),t=PIXI.RenderTexture.create(e.width,e.height);t.copyPixels(this.sourceTexture,new PIXI.Point(-e.x,-e.y));var n=t.renderClone();this.eraseSprite.texture=n,this.alphaFilter.intensity=1,this.alphaFilter.iChannel1=this.painter.brush.texture,this.eraseSprite.filters=[this.alphaFilter],BFN.Stage.render(this.eraseSprite,t),n.destroyGC(!0),this.resultTexture.copyPixels(t,new PIXI.Point(e.x,e.y),!1),t.destroyGC(!0),this.eraseSprite.texture=PIXI.Texture.EMPTY}BFN.MainUI.requestRender()},Px.prototype.replaceDarksWithAverage=function(e){this.replaceFilter.mode="darks";var t=BFN.Util.getTextureAverageColor(e,!0);this.replaceFilter.color=t;var n=e.renderClone(),i=new PIXI.Sprite(n);i.filters=[this.replaceFilter],BFN.Stage.render(i,e),n.destroyGC(!0),i.filters=[],i.destroy(!0)},Px.prototype.getColorBrightness=function(e){var t=this.hexToRGB(e);return Math.sqrt(t[0]*t[0]*.241+t[1]*t[1]*.691+t[2]*t[2]*.068)/255},Px.prototype.hexToRGB=function(e){return[e>>16&255,e>>8&255,255&e]},Px.prototype.handleBrushApplied=function(e){this.erasing?this.erase():this.removeBlemish()},Px.prototype.handleAltBitmapDataUpdated=function(e){},Object.defineProperty(Px.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale},get:function(){return this._scale}}),Object.defineProperty(Px.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),e}return null}}),Object.defineProperty(BFN,"ImageBlemish",{get:function(){return!BFN._ImageBlemish&&(BFN._ImageBlemish=new Px),BFN._ImageBlemish}}),kx.prototype=Object.create(PIXI.Sprite.prototype),kx.prototype.init=function(){BeFunky.log("ImageBackground Init"),this.initDefaultValues(),this.initImageContainer(),this.initSourceSprite(),this.initMaskBlendSprite(),this.initMaskSprite(),this.initPainter()},kx.prototype.initDefaultValues=function(){this._scale=1,this.sourceTexture=null,this.transparent=!0},kx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},kx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)};function e_(){PIXI.Sprite.call(this),this.init()}function t_(){PIXI.Sprite.call(this),this.init()}function n_(){PIXI.Container.call(this),this.init()}function i_(){PIXI.Container.call(this),this.init()}function r_(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function a_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;PIXI.Container.call(this),this.side=e,this.gridChild=t,this.init()}function o_(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function s_(){PIXI.Container.call(this),this.init()}function l_(){PIXI.Container.call(this),this.init()}function u_(){PIXI.Container.call(this),this.init()}function c_(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function h_(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function d_(){PIXI.Sprite.call(this),this.init()}function m_(){PIXI.Sprite.call(this),this.init()}function p_(){PIXI.Container.call(this),this.init()}function g_(){PIXI.Sprite.call(this),this.init()}function f_(){PIXI.Sprite.call(this),this.init()}function v_(){PIXI.Container.call(this),BFN.EventDispatcher.call(this),this.init()}function y_(){var e=g(["\n                    ","\n                    ","\n                "]);return y_=function(){return e},e}function x_(){var e=g(['<div class="custom_controls_container"></div>']);return x_=function(){return e},e}function __(){var e=g(['<div class="brush_menu_container"></div>']);return __=function(){return e},e}function I_(){var e=g(['<div class="generic_menu_container"></div>']);return I_=function(){return e},e}kx.prototype.initMaskBlendSprite=function(){this.maskBlendSprite=new BFN.MaskBlendSprite,this.maskBlendSprite.pluginName="smooth_picture",this.maskBlendSprite.useInputAlpha=!0,this.imageContainer.addChild(this.maskBlendSprite)},kx.prototype.initMaskSprite=function(){this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.maskSprite.interactive=!1,this.imageContainer.addChild(this.maskSprite)},kx.prototype.initPainter=function(){this.painter=new BFN.ImagePainter,this.painter.pluginName="smooth_picture",this.imageContainer.addChild(this.painter),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.PAINT_UPDATED.type,this.handlePainterUpdated.bind(this)),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handlePainterUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINT_APPLIED_UPDATED.type,this.handlePainterPaintAppliedUpdated.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_ENABLED_UPDATED.type,this.handlePainterPaintingEnabledUpdated.bind(this))},kx.prototype.handleBackground=function(){var e=this;if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND){var t=UITools.getToolVO("background");this.transparent!==t.transparent&&(this.transparent=t.transparent,requestAnimationFrame(function(){UITools.disableControlItem("background_fill_color",e.transparent),UITools.disableControlItem("background_fill_amount",e.transparent),UITools.disableControlItem("background_opacity",e.transparent)}));var n=this.transparent?0:t.opacity/100,i=this.transparent?-1:t.fill_color,r=this.transparent?1:t.fill_amount/100;this.maskBlendSprite.unmaskedAlpha!=n&&(this.maskBlendSprite.unmaskedAlpha=n),this.maskBlendSprite.blendColor!=i&&(this.maskBlendSprite.blendColor=i),this.maskBlendSprite.blendIntensity!=r&&(this.maskBlendSprite.blendIntensity=r)}},kx.prototype.handleBackgroundBrush=function(){this.updateBackgroundBrushParameters()},kx.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.maskBlendSprite.inputTexture=this.sourceTexture,this.maskSprite.width=this.sourceTexture.width,this.maskSprite.height=this.sourceTexture.height,this.imageContainer.x=-Math.round(e.width/2),this.imageContainer.y=-Math.round(e.height/2),this.painter.setup(this.sourceTexture.width,this.sourceTexture.height),this.transparent=!1,this.inverse=!1,this.updateMaskDisplay(),UITools.setToolValue("background","transparent",!0),UITools.setToolValue("background","fill_color","FFFFFF"),UITools.setToolValue("background","fill_amount",100),UITools.setToolValue("background","opacity",100),UITools.updateToolControls("background"),UITools.setToolValue("background_brush","show_mask",!1),UITools.setToolValue("background_brush","select_action","subtract"),UITools.updateToolControls("background_brush"),this.updateBackgroundBrushParameters()):(this.maskBlendSprite.reset(),this.painter.reset())},kx.prototype.updateBackgroundBrushParameters=function(){var e=this,t=UITools.getToolVO("background_brush");if(t){if("isolate_subject"===t.updating_id&&!t.updating)return void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,this.inverse,function(){UITools.setToolValue("background_brush","select_action","add"),UITools.updateToolControl("background_brush_select_action");var n="subtract"===t.select_action?e.inverse:!e.inverse;e.painter.eraseMode!=n&&(e.painter.eraseMode=n)});t.clear&&(this.painter.clear(!0),UITools.setToolValue("background_brush","erase",!1),UITools.updateToolControl("background_brush_erase"),this.maskBlendSprite.updateDisplay(),this.inverse&&(this.inverse=!1,this.updateMaskDisplay())),this.showMask!==t.show_mask&&(this.showMask=t.show_mask,this.updateMaskDisplay()),"invert"==t.updating_id&&(this.inverse=!this.inverse,this.updateMaskDisplay());var n="subtract"===t.select_action?this.inverse:!this.inverse;this.painter.eraseMode!=n&&(this.painter.eraseMode=n),t.updating&&"size"==t.updating_id&&this.painter.brushSizeFactor!=t.size/100&&(this.painter.brushSizeFactor=t.size/100);var i=!1;t.updating||"size"!=t.updating_id&&this.painter.brushSizeFactor==t.size/100||(this.painter.brushSizeFactor=t.size/100,i=!0),t.updating||"hardness"!=t.updating_id&&this.painter.brushHardnessFactor==t.hardness/100||(this.painter.brushHardnessFactor=t.hardness/100,i=!0),t.updating||"strength"!=t.updating_id&&this.painter.brushStrengthFactor==t.strength/100||(this.painter.brushStrengthFactor=t.strength/100,i=!0),i&&this.painter.updateBrush()}},kx.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=!!(null===e?this.showMask:e),this.sourceSprite.visible=e,this.maskBlendSprite.visible=!e,this.maskSprite.visible=e&&(this.painter.paintApplied||this.inverse);var t=this.painter.isSetup&&this.painter.paintApplied?this.painter:null;this.maskSprite.mask!==t&&(this.maskSprite.mask=t),this.painter.renderable=!1,BFN.MainUI.requestRender()},kx.prototype.setSmoothingScale=function(e){this.sourceSprite.currentScale=e,this.maskBlendSprite.currentScale=e,this.painter.currentScale=e},kx.prototype.handlePainterUpdated=function(e){BFN.ImagePainterUndoManager.currentImagePainter===this.painter&&this.painter.isSetup&&(this.maskBlendSprite.maskTexture!==this.painter.texture&&(this.maskBlendSprite.maskTexture=this.painter.texture),this.maskBlendSprite.updateDisplay())},kx.prototype.handlePainterPaintAppliedUpdated=function(e){this.updateMaskDisplay()},kx.prototype.handlePainterPaintingEnabledUpdated=function(){this.painter.isSetup&&!this.painter.paintingEnabled&&this.showMask&&(UITools.setToolValue("background_brush","show_mask",!1),UITools.updateToolControl("background_brush_show_mask"),this.showMask=UITools.getToolValue("background_brush","show_mask"),this.updateMaskDisplay())},Object.defineProperty(kx.prototype,"showMask",{set:function(e){this._showMask=e,this.maskBlendSprite.autoRender=!this.showMask},get:function(){return this._showMask}}),Object.defineProperty(kx.prototype,"inverse",{set:function(e){this._inverse=e,this.maskBlendSprite.inverse=this._inverse,this.painter.inverseMask=this._inverse},get:function(){return this._inverse}}),Object.defineProperty(kx.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(kx.prototype,"modifiedTexture",{get:function(){if(this.sourceTexture){this.maskBlendSprite.displayUpdatePending&&this.maskBlendSprite.renderDisplay();var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.imageContainer.x=this.imageContainer.y=0,this.setSmoothingScale(1),this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.updateMaskDisplay(),e}return null}}),Object.defineProperty(BFN,"ImageBackground",{get:function(){return!BFN._ImageBackground&&(BFN._ImageBackground=new kx),BFN._ImageBackground}}),Nx.prototype=Object.create(PIXI.Sprite.prototype),Nx.prototype.init=function(){BeFunky.log("ImageCutout Init"),this.initDefaultValues(),this.initImageContainer(),this.initDisplay(),this.initCutoutOptionsModal()},Nx.prototype.initDefaultValues=function(){this._scale=1,this._backgroundColor=-1,this.cutoutActive=!1,this.PIx2=2*Math.PI,this.PId4=Math.PI/4,this.sourceTexture=null,this.itemWidth=0,this.itemHeight=0,this.shapePoints=[],this.selectionPoints=[],this.shapeStartPoint=null,this.selectionStartPoint=null,this.selectionMode=null,this.inverse=!1,this.erase=!1,this.invertSelection=!1,this.trimTransparency=!0,this.tolerance=.5,this.shiftKey=!1,this.spaceKey=!1,this.pressedKeyCodes=[],this.alphaBoundsMaxSize=1024,this.alphaBoundsAdjustScale=1,this.initialLumaColor=0,this.isNewCanvas=!1,this.cutoutRect=null,this.shapeBounds={minX:0,minY:0,maxX:0,maxY:0},this.featherBase=1024,this.featherAmount=1,this.featherAmountMax=1,this.featherAmountMin=0,this.featherFilter=new BFN.filters.GaussianBlurFilter,this.inverseFilter=new BFN.filters.LevelsFilter,this.inverseFilter.minOutputValue=1,this.inverseFilter.maxOutputValue=0,this.selectionStrength=1,this.readyCallback=null,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseMoveBind=this.handleMouseMove.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleKeyUpBind=this.handleKeyUp.bind(this),this.handlePaintingCompleteBind=this.handlePaintingComplete.bind(this),this.handleCanvasScalingUpdatedBind=this.handleCanvasScalingUpdated.bind(this),BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltTextureUpdated.bind(this))},Nx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.imageContainer.interactive=!0,this.imageContainer.on("pointerover",this.handleMouseOverBind),this.imageContainer.on("pointerout",this.handleMouseOutBind),this.imageContainer.on("pointerdown",this.handleMouseDownBind),this.addChild(this.imageContainer)},Nx.prototype.initDisplay=function(){var e=this;this.lumaTexture=null,this.alphaTexture=null,this.alphaBoundsTexture=null,this.selectionShape=new PIXI.Graphics,this.selectionSprite=new PIXI.Sprite,this.selectionSprite.pluginName="smooth_picture",this.touchSurface=new PIXI.Graphics,this.addChild(this.touchSurface),this.backgroundGraphic=new PIXI.Graphics,this.imageContainer.addChild(this.backgroundGraphic),this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite),this.maskSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.maskSprite.texture.fillColor(16711680,.5),this.imageContainer.addChild(this.maskSprite),this.lumaSprite=new PIXI.Sprite,this.alphaSprite=new PIXI.Sprite,this.imageContainer.addChild(this.alphaSprite),this.quickSelectTextureMaxSize=2048,this.quickSelectTextureScaleFactor={xy:1,x:1,y:1},this.quickSelectRadius=0,this.quickSelectRadiusMin=0,this.quickSelectRadiusMax=0,this.quickSelectRegionSize=0,this.quickSelectPoints=[],this.quickSelectSprite=new PIXI.Sprite,this.quickSelectSprite.alpha=.5,this.quickSelectSprite.pluginName="blend_picture",this.quickSelectSprite.currentScale=.75,this.imageContainer.addChild(this.quickSelectSprite),this.magicBrushFilter=new BFN.filters.MagicBrushFilter,this.quickSelectRegionSprite=new PIXI.Sprite,this.quickSelectRegionSprite.filters=[this.magicBrushFilter],this.painter=new BFN.ImagePainter,this.painter.alpha=.5,this.painter.tint=16711680,this.painter.dispatchEventsAfterUpdate=!1,this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_COMPLETE.type,this.handlePaintingCompleteBind),this.painter.preRedoCallback=function(){e.lumaTexture&&(-1===BFN.ImagePainterUndoManager.regionIndex||0===BFN.ImagePainterUndoManager.regionIndex&&"undo"===BFN.ImagePainterUndoManager.direction)&&e.lumaTexture.fillColor(e.initialLumaColor)},this.imageContainer.addChild(this.painter),this.inverseSprite=new PIXI.Sprite(PIXI.RenderTexture.create(200,200)),this.inverseSprite.texture.fillColor(16777215,1),this.inverseSprite.blendMode=21,this.imageContainer.addChild(this.inverseSprite),this.selectionCanvas=new PIXI.Graphics,this.addChild(this.selectionCanvas),this.inverseSprite.mask=this.selectionCanvas},Nx.prototype.initCutoutOptionsModal=function(){this.cutoutOptionsModal=document.getElementById("cutout_options_modal"),BFN.UI.cutoutOptionsModal(this.cutoutOptionsModal)},Nx.prototype.handleCutout=function(){var e=this;if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT){var t=UITools.getToolVO("cutout");if("remove_background"===t.updating_id&&!t.updating)return void BFN.BackgroundRemovalManager.isolateSubjectOnPainter(this.sourceTexture,this.inverse,function(){e.updateAlphaTexture()});var n=!1;t.updating||"clear"!=t.updating_id||(this.painter.clear(),this.resetLumaTexture(),n=!0),this.selectionMode!=t.mode&&(this.selectionMode=t.mode,this.inverseSprite.visible=this.selectionCanvas.visible="brush"!=this.selectionMode,UITools.toggleControlItem("cutout_brush_size",["brush","magic_brush"].includes(this.selectionMode)),UITools.toggleControlItem("cutout_strength","magic_brush"!=this.selectionMode),UITools.toggleControlItem("cutout_hardness","magic_brush"!=this.selectionMode),UITools.toggleControlItem("cutout_tolerance","magic_brush"==this.selectionMode),this.painter.paintingEnabled="brush"==this.selectionMode),this.backgroundColor!==t.background_color&&(this.backgroundColor=t.background_color);var i=t.brush_size/100;if(t.updating&&"brush_size"==t.updating_id&&this.painter.brushSizeFactor!=i&&(this.painter.brushSizeFactor=i),t.updating||"brush_size"!=t.updating_id&&this.painter.brushSizeFactor==i||(this.painter.brushSizeFactor=i,this.painter.updateBrush()),!t.updating){this.cutoutOptionsModal.trimTransparency!=t.trim_transparency&&(this.cutoutOptionsModal.trimTransparency=t.trim_transparency),this.tolerance=t.tolerance/100,this.magicBrushFilter.tolerance=this.tolerance,this.selectionStrength=t.strength/100,this.featherAmount=(this.featherAmountMax-this.featherAmountMin)*(1-t.hardness/100)+this.featherAmountMin;var r=t.hardness/100;if(this.painter.brushStrengthFactor==this.selectionStrength&&this.painter.brushHardnessFactor==r||(this.painter.brushStrengthFactor=this.selectionStrength,this.painter.brushHardnessFactor=r,this.painter.updateBrush()),this.featherFilter.blur!=this.featherAmount&&(this.featherFilter.blur=this.featherAmount),this.showMask!=t.show_mask&&(this.showMask=t.show_mask,this.updateMaskDisplay()),"invert"==t.updating_id&&(this.inverse=!this.inverse,n=!0),this.erase="subtract"==t.select_action,"options_modal_cancel"==t.updating_id)this.cutoutOptionsModal.close();else if("options_modal_apply"==t.updating_id){if(this.trimTransparency=t.trim_transparency,t.export_as_layer){var a=this.trimTransparency?this.cutoutOptionsModal.trimTexture.renderClone():this.cutoutOptionsModal.fullTexture.renderClone(),o=BFN.ImageLibraryManager.createMenuImageVOFromTexture(a),s=this.cutoutRect.clone(),l={type:"frame_texture",texture:o.imageTexture,projectItemAssetID:o.id};BFN.TransformModel.layerItem||(l.initialPosition=this.trimTransparency?new PIXI.Point(s.x,s.y):new PIXI.Point,l.initialScale=new PIXI.Point(1,1)),this.cutoutOptionsModal.close(),UITools.setToolValue("editor_apply_cancel","cancel",!0,!1),UITools.applyTool("editor_apply_cancel"),UITools.setToolValue("editor_apply_cancel","cancel",!1,!1),BFN.TransformModel.layerItem&&BFN.TransformItemIsolator.active?(this.exportedItemObject=l,BFN.TransformItemIsolator.reselectOnReleaseComplete=!1):BFN.PhotoEditorCanvasModel.addedItem=l,UITools.setToolValue("editor_main","image_manager",!0),UITools.applyTool("editor_main"),UITools.setToolValue("editor_main","image_manager",!1)}else this.cutoutOptionsModal.close(),BFN.applyCancelMenu.alternateApply=!1,UITools.setToolValue("editor_apply_cancel","apply",!0,!1),UITools.applyTool("editor_apply_cancel"),UITools.setToolValue("editor_apply_cancel","apply",!1,!1);return}}n&&!this.isNewCanvas&&this.updateAlphaTexture(),this.isNewCanvas=!1}},Nx.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.lumaTexture.destroyGC(!0)}catch(e){}this.lumaTexture=null,this.lumaSprite.texture=PIXI.Texture.EMPTY;try{this.alphaTexture.destroyGC(!0)}catch(e){}this.alphaTexture=null,this.alphaSprite.texture=PIXI.Texture.EMPTY;try{this.alphaBoundsTexture.destroyGC(!0)}catch(e){}this.alphaBoundsTexture=null;try{this.quickSelectSourceTexture.destroyGC(!0)}catch(e){}this.quickSelectSourceTexture=null;try{this.quickSelectTexture.destroyGC(!0)}catch(e){}this.quickSelectTexture=null,this.quickSelectSprite.texture=PIXI.Texture.EMPTY;try{this.quickSelectRegionTexture.destroyGC(!0)}catch(e){}this.quickSelectRegionTexture=null,this.quickSelectRegionSprite.texture=PIXI.Texture.EMPTY;try{this.quickSelectRegionResultTexture.destroyGC(!0)}catch(e){}this.quickSelectRegionResultTexture=null;try{this.quickSelectRegionUnionTexture.destroyGC(!0)}catch(e){}this.quickSelectRegionUnionTexture=null,this.magicBrushFilter.unionTexture=PIXI.Texture.EMPTY,this.painter.altTexture=null,this.touchSurface.clear(),BFN.BrushCircle.showing&&BFN.BrushCircle.hide(!0),BFN.PhotoEditorCanvasModel.removeEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),BFN.CollageMakerCanvasModel.removeEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),BFN.DesignerCanvasModel.removeEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind)},Nx.prototype.setSourceTexture=function(e){var t=this;if(this.reset(),e){BFN.applyCancelMenu.alternateApply=!BFN.TransformItemIsolator.active||BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.usingAlternateMenu,this.trimTransparency=!0,this.itemWidth=e.width,this.itemHeight=e.height,this.imageContainer.x=-Math.round(e.width/2),this.imageContainer.y=-Math.round(e.height/2),this.sourceTexture=e,this.lumaTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.lumaTexture.fillColor(0),this.alphaTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.alphaTexture.fillColor(0);var n=this.quickSelectTextureMaxSize/Math.max(this.sourceTexture.width,this.sourceTexture.height),i=Math.round(this.sourceTexture.width*n),r=Math.round(this.sourceTexture.height*n);this.quickSelectTextureScaleFactor.xy=n,this.quickSelectTextureScaleFactor.x=i/this.sourceTexture.width,this.quickSelectTextureScaleFactor.y=r/this.sourceTexture.height,this.quickSelectSourceTexture=PIXI.RenderTexture.create(i,r),this.quickSelectSourceTexture.copyPixels(this.sourceTexture,null,!0,null,this.quickSelectTextureScaleFactor),this.quickSelectTexture=PIXI.RenderTexture.create(i,r),this.quickSelectTexture.clear(),this.quickSelectRegionTexture=PIXI.RenderTexture.create(32,32),this.quickSelectRegionTexture.clear(),this.quickSelectRegionResultTexture=PIXI.RenderTexture.create(32,32),this.quickSelectRegionResultTexture.clear(),this.quickSelectRegionUnionTexture=PIXI.RenderTexture.create(32,32),this.quickSelectRegionUnionTexture.clear(),this.alphaBoundsAdjustScale=Math.min(1,this.alphaBoundsMaxSize/this.sourceTexture.width,this.alphaBoundsMaxSize/this.sourceTexture.height),this.alphaBoundsTexture=PIXI.RenderTexture.create(Math.round(this.sourceTexture.width*this.alphaBoundsAdjustScale),Math.round(this.sourceTexture.height*this.alphaBoundsAdjustScale)),this.alphaBoundsTexture.fillColor(0),this.sourceSprite.texture=this.sourceTexture,this.lumaSprite.texture=this.lumaTexture,this.alphaSprite.texture=this.alphaTexture,this.quickSelectSprite.texture=this.quickSelectTexture,this.quickSelectSprite.scale.x=1/this.quickSelectTextureScaleFactor.x,this.quickSelectSprite.scale.y=1/this.quickSelectTextureScaleFactor.y,this.quickSelectRegionSprite.texture=this.quickSelectRegionTexture,this.magicBrushFilter.unionTexture=this.quickSelectRegionUnionTexture,this.maskSprite.width=this.itemWidth,this.maskSprite.height=this.itemHeight,this.touchSurface.beginFill(16777215,0),this.touchSurface.drawRect(-2*this.sourceTexture.width,-2*this.sourceTexture.height,5*this.sourceTexture.width,5*this.sourceTexture.height),this.touchSurface.endFill(),this.inverseSprite.x=-2*this.sourceTexture.width,this.inverseSprite.y=-2*this.sourceTexture.height,this.inverseSprite.scale.x=this.sourceTexture.width/this.inverseSprite.texture.baseTexture.width*5,this.inverseSprite.scale.y=this.sourceTexture.height/this.inverseSprite.texture.baseTexture.height*5,this.painter.altTexture=this.lumaTexture,this.updateCutoutRect(!0),this.isNewCanvas=!0,this.featherAmountMax=1,this.featherAmountMin=0,this.inverse=!1,this.showMask=!1,UITools.setToolValue("cutout","show_mask",!1),UITools.setToolValue("cutout","select_action","subtract"),UITools.updateToolControls("cutout");var a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),o=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents,BFN.CollageMakerCanvasModelEvents,BFN.DesignerCanvasModelEvents);a.addEventListener(o.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),requestAnimationFrame(function(){t.readyCallback&&(t.readyCallback(),t.readyCallback=null)})}else this.imageContainer.x=0,this.imageContainer.y=0;this.updatePainter(),this.resetLumaTexture(),this.updateAlphaTexture(),this.backgroundColor=this.backgroundColor},Nx.prototype.updateQuickSelectRegionTextures=function(){this.quickSelectRadius=Math.round(this.painter.brushRadius*this.quickSelectTextureScaleFactor.xy),this.quickSelectRegionSize=2*this.quickSelectRadius,this.quickSelectRegionTexture.width==this.quickSelectRegionSize&&this.quickSelectRegionTexture.height==this.quickSelectRegionSize||(this.quickSelectRegionTexture.resize(this.quickSelectRegionSize,this.quickSelectRegionSize),this.quickSelectRegionResultTexture.resize(this.quickSelectRegionSize,this.quickSelectRegionSize),this.quickSelectRegionUnionTexture.resize(this.quickSelectRegionSize,this.quickSelectRegionSize))},Nx.prototype.updatePainter=function(){this.sourceTexture?this.painter.painterWidth==this.sourceTexture.width&&this.painter.painterHeight==this.sourceTexture.height||this.painter.setup(this.sourceTexture.width,this.sourceTexture.height):this.painter.reset()},Nx.prototype.resetLumaTexture=function(){this.lumaTexture&&this.lumaTexture.fillColor(0)},Nx.prototype.updateAlphaTexture=function(){if(this.lumaTexture&&this.alphaTexture){var e=this.inverse||BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction;this.lumaSprite.filters=e?[this.inverseFilter]:[],BFN.Stage.render(this.lumaSprite,this.alphaTexture),this.lumaSprite.filters=[]}this.updateCutoutRect(!0),this.updateMaskDisplay()},Nx.prototype.updateCutoutRect=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.cutoutRect=null,this.alphaTexture&&this.alphaBoundsTexture)if(e)this.cutoutRect=new BFN.Rectangle(0,0,this.alphaTexture.width,this.alphaTexture.height);else{this.alphaBoundsTexture.copyPixels(this.alphaTexture,new PIXI.Point,!0,1,this.alphaBoundsAdjustScale);var n=t?this.alphaBoundsTexture:BFN.Util.getThumbTexture(this.alphaBoundsTexture,128),i=t?1/this.alphaBoundsAdjustScale:this.sourceTexture.width/n.width,r=BFN.Util.getAlphaBounds(n,null,i,!0);n!==this.alphaBoundsTexture&&n.destroyGC(!0),r.width&&r.height&&(this.cutoutRect=new BFN.Rectangle(r.minX,r.minY,r.width,r.height))}},Nx.prototype.updateMaskDisplay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(e=!!(null===e?this.showMask:e))?(this.sourceSprite.mask=null,this.alphaSprite.visible=!0,this.maskSprite.mask=this.alphaSprite,this.maskSprite.visible=!0):(this.maskSprite.mask=null,this.maskSprite.visible=!1,!(BFN.ImagePainterUndoManager.regionIndex<0||0===BFN.ImagePainterUndoManager.regionIndex&&"undo"===BFN.ImagePainterUndoManager.direction)?(this.alphaSprite.visible=!0,this.sourceSprite.mask=this.alphaSprite):(this.alphaSprite.visible=!1,this.sourceSprite.mask=null))},Nx.prototype.processFeather=function(e){if(this.featherAmount){var t=Math.max(e.width,e.height),n=this.featherBase/t,i=Math.round(e.width*n),r=Math.round(e.height*n),a=PIXI.RenderTexture.create(i,r);a.copyPixels(e,null,null,null,{x:a.width/e.width,y:a.height/e.height});var o=new PIXI.Sprite(a);this.featherFilter.setInputDimensions(a.width,a.height),o.filters=[this.featherFilter];var s=PIXI.RenderTexture.create(a.width,a.height);BFN.Stage.render(o,s),e.copyPixels(s,null,null,null,{x:e.width/a.width,y:e.height/a.height}),a.destroyGC(!0),o.filters=[],o.destroy(!1),s.destroyGC(!0)}},Nx.prototype.showCutoutOptionsModal=function(){var e=this.getCutoutTexture(!1),t=this.getCutoutTexture(!0);if(e&&t)this.cutoutOptionsModal.open(e,t);else{try{e.destroyGC(!0)}catch(e){}try{t.destroyGC(!0)}catch(e){}}},Nx.prototype.startQuickSelect=function(){this.updateQuickSelectRegionTextures();var e=this.imageContainer.getPointerPosition(this.pointerEvent),t=e.x>=0&&e.x<this.sourceTexture.width&&e.y>=0&&e.y<this.sourceTexture.height;e.x=Math.max(0,Math.min(this.sourceTexture.width,e.x)),e.y=Math.max(0,Math.min(this.sourceTexture.height,e.y)),this.shapeBounds.minX=this.shapeBounds.maxX=e.x,this.shapeBounds.minY=this.shapeBounds.maxY=e.x,this.mousePosition=e;var n=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.moveTo(n.x,n.y),this.cutoutActive=!0,this.quickSelectBounds=null,t&&this.quickSelect(e)},Nx.prototype.moveQuickSelect=function(){var e=this.imageContainer.getPointerPosition(this.pointerEvent);this.mousePosition||(this.mousePosition=e);var t=e.x-this.mousePosition.x,n=e.y-this.mousePosition.y;if(Math.sqrt(Math.pow(t,2)+Math.pow(n,2))>1/this._scale){var i=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(i.x,i.y),this.dragQuickSelectTo(e),this.mousePosition=e}},Nx.prototype.stopQuickSelect=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.quickSelectBounds){var t=Math.round((this.quickSelectBounds.maxX-this.quickSelectBounds.minX)/this.quickSelectTextureScaleFactor.x),n=Math.round((this.quickSelectBounds.maxY-this.quickSelectBounds.minY)/this.quickSelectTextureScaleFactor.y);if(t>0&&n>0){this.selectionSprite.texture=PIXI.RenderTexture.create(t,n),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1,this.quickSelectSprite.fillColor=this.invertSelection?0:16777215,this.quickSelectSprite.intensity=1,this.quickSelectSprite.x=-this.quickSelectBounds.minX/this.quickSelectTextureScaleFactor.x,this.quickSelectSprite.y=-this.quickSelectBounds.minY/this.quickSelectTextureScaleFactor.y,this.quickSelectSprite.alpha=1,BFN.Stage.render(this.quickSelectSprite,this.selectionSprite.texture),delete this.quickSelectSprite.fillColor,delete this.quickSelectSprite.intensity,this.quickSelectSprite.x=0,this.quickSelectSprite.y=0,this.quickSelectSprite.alpha=.5,this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.quickSelectBounds.minX/this.quickSelectTextureScaleFactor.x,this.selectionSprite.y=this.quickSelectBounds.minY/this.quickSelectTextureScaleFactor.y;var i=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,i,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.lumaTexture.copyPixels(i,null,!1),i.destroyGC(!0),this.painter.paintBounds=new PIXI.Rectangle(Math.floor(this.selectionSprite.x),Math.floor(this.selectionSprite.y),t+1,n+1),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.quickSelectTexture.clear(),this.selectionCanvas.clear(),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},Nx.prototype.dragQuickSelectTo=function(e){if(this.sourceTexture){for(var t=Math.floor(e.x)-this.mousePosition.x,n=Math.floor(e.y)-this.mousePosition.y,i=Math.sqrt(t*t+n*n),r=Math.atan2(n,t),a=this.quickSelectRadius/4,o=Math.max(1,Math.ceil(i/Math.max(1,a))),s=this.mousePosition.x,l=this.mousePosition.y,u=1;u<=o;u++){var c=Math.max(0,Math.min(this.sourceTexture.width,Math.floor(s+Math.cos(r)*i*(u/o)))),h=Math.max(0,Math.min(this.sourceTexture.height,Math.floor(l+Math.sin(r)*i*(u/o))));(u<=4||u==o)&&this.quickSelectPoints.push({x:c,y:h})}for(;this.quickSelectPoints.length;){var d=this.quickSelectPoints.shift();this.quickSelect(d)}}},Nx.prototype.quickSelect=function(e){if(this.sourceTexture){var t=Math.round(e.x*this.quickSelectTextureScaleFactor.x),n=Math.round(e.y*this.quickSelectTextureScaleFactor.y),i=Math.round(t-this.quickSelectRadius),r=Math.round(n-this.quickSelectRadius);this.quickSelectBounds||(this.quickSelectBounds={minX:Math.round(t),minY:Math.round(n),maxX:Math.round(t),maxY:Math.round(n)}),this.quickSelectBounds.minX=Math.max(0,Math.min(this.quickSelectBounds.minX,i,this.quickSelectTexture.width)),this.quickSelectBounds.minY=Math.max(0,Math.min(this.quickSelectBounds.minY,r,this.quickSelectTexture.height)),this.quickSelectBounds.maxX=Math.min(this.quickSelectTexture.width,Math.max(this.quickSelectBounds.maxX,i+this.quickSelectRegionSize,0)),this.quickSelectBounds.maxY=Math.min(this.quickSelectTexture.height,Math.max(this.quickSelectBounds.maxY,r+this.quickSelectRegionSize,0)),this.quickSelectRegionTexture.copyPixels(this.quickSelectSourceTexture,{x:-i,y:-r}),this.quickSelectRegionUnionTexture.copyPixels(this.quickSelectTexture,{x:-i,y:-r}),this.quickSelectTexture.clearRect(i,r,this.quickSelectRegionSize,this.quickSelectRegionSize),BFN.Stage.render(this.quickSelectRegionSprite,this.quickSelectRegionResultTexture,!1),this.quickSelectTexture.copyPixels(this.quickSelectRegionResultTexture,{x:i,y:r},!1),BFN.MainUI.requestRender()}},Nx.prototype.startLasso=function(){var e=this.imageContainer.getPointerPosition(this.pointerEvent);e.x=Math.max(0,Math.min(this.sourceTexture.width,e.x)),e.y=Math.max(0,Math.min(this.sourceTexture.height,e.y)),this.shapePoints.push(new PIXI.Point(e.x,e.y)),this.shapeBounds.minX=this.shapeBounds.maxX=e.x,this.shapeBounds.minY=this.shapeBounds.maxY=e.x,this.mousePosition=e;var t=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.moveTo(t.x,t.y),this.cutoutActive=!0},Nx.prototype.moveLasso=function(){var e=this.imageContainer.getPointerPosition(this.pointerEvent);e.x=Math.max(0,Math.min(this.sourceTexture.width,e.x)),e.y=Math.max(0,Math.min(this.sourceTexture.height,e.y)),this.mousePosition||(this.mousePosition=e);var t=e.x-this.mousePosition.x,n=e.y-this.mousePosition.y;if(Math.sqrt(Math.pow(t,2)+Math.pow(n,2))>1){this.shapePoints.push(new PIXI.Point(e.x,e.y)),this.shapeBounds.minX=Math.min(this.shapeBounds.minX,e.x),this.shapeBounds.minY=Math.min(this.shapeBounds.minY,e.y),this.shapeBounds.maxX=Math.max(this.shapeBounds.maxX,e.x),this.shapeBounds.maxY=Math.max(this.shapeBounds.maxY,e.y),this.mousePosition=e;var i=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(i.x,i.y)}},Nx.prototype.stopLasso=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapePoints.length){var t=this.shapeBounds.maxX-this.shapeBounds.minX,n=this.shapeBounds.maxY-this.shapeBounds.minY;if(t>0&&n>0){var i=1/Math.max(1,Math.max(t,n)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.moveTo(this.shapePoints[0].x*i,this.shapePoints[0].y*i),this.selectionShape.beginFill(this.invertSelection?0:16777215);for(var r=1;r<this.shapePoints.length;r++)this.selectionShape.lineTo(this.shapePoints[r].x*i,this.shapePoints[r].y*i);this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*i,this.selectionShape.y=-this.shapeBounds.minY*i,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(t*i),Math.round(n*i)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/i,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var a=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,a,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(a),this.lumaTexture.copyPixels(a,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),a.destroyGC(!0);var o={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var s=Math.ceil(.26*this.featherBase*this.featherAmount);o.minX=Math.max(0,o.minX-s),o.minY=Math.max(0,o.minY-s),o.maxX=Math.min(this.lumaTexture.width,o.maxX+s),o.maxY=Math.min(this.lumaTexture.height,o.maxY+s)}this.painter.paintBounds=new PIXI.Rectangle(o.minX,o.minY,o.maxX-o.minX,o.maxY-o.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapePoints.splice(0),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},Nx.prototype.startPolygon=function(){if((this.thisTapTime=performance.now(),this.lastTapTime)&&this.thisTapTime-this.lastTapTime<200)return void this.stopPolygon();this.lastTapTime=this.thisTapTime,BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind);var e=this.shiftKey&&this.snapShapePoint?this.snapShapePoint:this.imageContainer.getPointerPosition(this.pointerEvent),t=this.shiftKey&&this.snapShapePoint?this.snapSelectionPoint:this.selectionCanvas.getPointerPosition(this.pointerEvent);if(this.shapeStartPoint||(this.shapeBounds.minX=this.shapeBounds.maxX=e.x,this.shapeBounds.minY=this.shapeBounds.maxY=e.y,this.shapeStartPoint=e,this.selectionStartPoint=t),this.shapePoints.length){this.shapeBounds.minX=Math.min(this.shapeBounds.minX,e.x),this.shapeBounds.minY=Math.min(this.shapeBounds.minY,e.y),this.shapeBounds.maxX=Math.max(this.shapeBounds.maxX,e.x),this.shapeBounds.maxY=Math.max(this.shapeBounds.maxY,e.y);var n=e.x-this.shapeStartPoint.x,i=e.y-this.shapeStartPoint.y,r=Math.sqrt(Math.pow(n,2)+Math.pow(i,2)),a=this.shapePoints[this.shapePoints.length-1],o=e.x-a.x,s=e.y-a.y,l=Math.sqrt(Math.pow(o,2)+Math.pow(s,2));if(r<5/this._scale||l<1/this._scale)return void this.stopPolygon()}this.shapePoints.push(e),this.selectionPoints.push(t),this.movePolygon(),BFN.MainUI.requestRender(),BFN.TransformModel.layerItem?UIToggler.toggleAlternateMenuInteractivity(!1):(UIToggler.toggleNavBar(!1),UIToggler.toggleMainMenu(!1),UIToggler.toggleZoomMenu(!1)),this.cutoutActive=!0},Nx.prototype.movePolygon=function(){if(this.selectionPoints.length){var e=this.selectionCanvas.getPointerPosition(this.pointerEvent);this.selectionCanvas.clear(),this.selectionCanvas.moveTo(this.selectionStartPoint.x,this.selectionStartPoint.y);for(var t=0;t<this.selectionPoints.length;t++)this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(this.selectionPoints[t].x,this.selectionPoints[t].y);if(this.shiftKey){var n=this.shapePoints[this.selectionPoints.length-1],i=this.selectionPoints[this.selectionPoints.length-1],r=e.x-i.x,a=e.y-i.y,o=Math.sqrt(Math.pow(r,2)+Math.pow(a,2)),s=e.x-i.x,l=e.y-i.y,u=Math.sqrt(Math.pow(s,2)+Math.pow(l,2)),c=(Math.atan2(l,s)+this.PIx2)%this.PIx2,h=Math.round(c/this.PId4);this.snapShapePoint=new PIXI.Point,this.snapShapePoint.x=n.x+Math.cos(h*this.PId4)*o,this.snapShapePoint.y=n.y+Math.sin(h*this.PId4)*o,this.snapSelectionPoint=new PIXI.Point,this.snapSelectionPoint.x=i.x+Math.cos(h*this.PId4)*u,this.snapSelectionPoint.y=i.y+Math.sin(h*this.PId4)*u,this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(this.snapSelectionPoint.x,this.snapSelectionPoint.y)}else this.snapShapePoint=null,this.snapSelectionPoint=null,this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.lineTo(e.x,e.y)}},Nx.prototype.stopPolygon=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapePoints.length>2){var t=this.shapeBounds.maxX-this.shapeBounds.minX,n=this.shapeBounds.maxY-this.shapeBounds.minY;if(t>0&&n>0){var i=1/Math.max(1,Math.max(t,n)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.moveTo(this.shapePoints[0].x*i,this.shapePoints[0].y*i),this.selectionShape.beginFill(this.invertSelection?0:16777215);for(var r=1;r<this.shapePoints.length;r++)this.selectionShape.lineTo(this.shapePoints[r].x*i,this.shapePoints[r].y*i);this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*i,this.selectionShape.y=-this.shapeBounds.minY*i,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(t*i),Math.round(n*i)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/i,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var a=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,a,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(a),this.lumaTexture.copyPixels(a,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),a.destroyGC(!0);var o={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var s=Math.ceil(.26*this.featherBase*this.featherAmount);o.minX=Math.max(0,o.minX-s),o.minY=Math.max(0,o.minY-s),o.maxX=Math.min(this.lumaTexture.width,o.maxX+s),o.maxY=Math.min(this.lumaTexture.height,o.maxY+s)}this.painter.paintBounds=new PIXI.Rectangle(o.minX,o.minY,o.maxX-o.minX,o.maxY-o.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapePoints.splice(0),this.selectionPoints.splice(0),this.shapeStartPoint=null,this.selectionStartPoint=null,this.snapPoint=null,BFN.TransformModel.layerItem?UIToggler.toggleAlternateMenuInteractivity(!0):(UIToggler.toggleNavBar(!0),UIToggler.toggleMainMenu(!0),UIToggler.toggleZoomMenu(!0)),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},Nx.prototype.startCircle=function(){this.shapeStartPoint=this.imageContainer.getPointerPosition(this.pointerEvent),this.selectionStartPoint=this.selectionCanvas.getPointerPosition(this.pointerEvent),this.cutoutActive=!0},Nx.prototype.moveCircle=function(){if(this.selectionStartPoint){var e=this.selectionCanvas.getPointerPosition(this.pointerEvent),t=Math.min(this.selectionStartPoint.x,e.x),n=Math.min(this.selectionStartPoint.y,e.y),i=Math.abs(this.selectionStartPoint.x-e.x),r=Math.abs(this.selectionStartPoint.y-e.y);this.shiftKey&&(i=r=Math.min(i,r),t=Math.max(t,this.selectionStartPoint.x-i),n=Math.max(n,this.selectionStartPoint.y-r)),this.selectionCanvas.clear(),this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.drawEllipse(t+i/2,n+r/2,i/2,r/2)}},Nx.prototype.stopCircle=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapeStartPoint){var t=this.imageContainer.getPointerPosition(this.pointerEvent),n=Math.min(this.shapeStartPoint.x,t.x),i=Math.min(this.shapeStartPoint.y,t.y),r=Math.abs(this.shapeStartPoint.x-t.x),a=Math.abs(this.shapeStartPoint.y-t.y);if(this.shiftKey&&(r=a=Math.min(r,a),n=Math.max(n,this.shapeStartPoint.x-r),i=Math.max(i,this.shapeStartPoint.y-a)),this.shapeBounds.minX=n,this.shapeBounds.minY=i,this.shapeBounds.maxX=n+r,this.shapeBounds.maxY=i+a,r>0&&a>0){var o=1/Math.max(1,Math.max(r,a)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.beginFill(this.invertSelection?0:16777215),this.selectionShape.drawEllipse((n+r/2)*o,(i+a/2)*o,r/2*o,a/2*o),this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*o,this.selectionShape.y=-this.shapeBounds.minY*o,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(r*o),Math.round(a*o)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/o,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var s=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,s,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(s),this.lumaTexture.copyPixels(s,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),s.destroyGC(!0);var l={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var u=Math.ceil(.26*this.featherBase*this.featherAmount);l.minX=Math.max(0,l.minX-u),l.minY=Math.max(0,l.minY-u),l.maxX=Math.min(this.lumaTexture.width,l.maxX+u),l.maxY=Math.min(this.lumaTexture.height,l.maxY+u)}this.painter.paintBounds=new PIXI.Rectangle(l.minX,l.minY,l.maxX-l.minX,l.maxY-l.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapeStartPoint=null,this.selectionStartPoint=null,e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},Nx.prototype.startRectangle=function(){this.shapeStartPoint=this.imageContainer.getPointerPosition(this.pointerEvent),this.selectionStartPoint=this.selectionCanvas.getPointerPosition(this.pointerEvent),this.cutoutActive=!0},Nx.prototype.moveRectangle=function(){if(this.selectionStartPoint){var e=this.selectionCanvas.getPointerPosition(this.pointerEvent),t=Math.min(this.selectionStartPoint.x,e.x),n=Math.min(this.selectionStartPoint.y,e.y),i=Math.abs(this.selectionStartPoint.x-e.x),r=Math.abs(this.selectionStartPoint.y-e.y);this.shiftKey&&(i=r=Math.min(i,r),t=Math.max(t,this.selectionStartPoint.x-i),n=Math.max(n,this.selectionStartPoint.y-r)),this.selectionCanvas.clear(),this.selectionCanvas.lineStyle(1,16777215),this.selectionCanvas.drawRect(t,n,i,r)}},Nx.prototype.stopRectangle=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&this.shapeStartPoint){var t=this.imageContainer.getPointerPosition(this.pointerEvent),n=Math.min(this.shapeStartPoint.x,t.x),i=Math.min(this.shapeStartPoint.y,t.y),r=Math.abs(this.shapeStartPoint.x-t.x),a=Math.abs(this.shapeStartPoint.y-t.y);if(this.shiftKey&&(r=a=Math.min(r,a),n=Math.max(n,this.shapeStartPoint.x-r),i=Math.max(i,this.shapeStartPoint.y-a)),this.shapeBounds.minX=n,this.shapeBounds.minY=i,this.shapeBounds.maxX=n+r,this.shapeBounds.maxY=i+a,r>0&&a>0){var o=1/Math.max(1,Math.max(r,a)/BFN.maxImageSize)*2;this.selectionShape.clear(),this.selectionShape.beginFill(this.invertSelection?0:16777215),this.selectionShape.drawRect(n*o,i*o,r*o,a*o),this.selectionShape.endFill(),this.selectionShape.x=-this.shapeBounds.minX*o,this.selectionShape.y=-this.shapeBounds.minY*o,this.selectionSprite.texture=PIXI.RenderTexture.create(Math.round(r*o),Math.round(a*o)),this.selectionSprite.anchor.x=this.selectionSprite.anchor.y=0,this.selectionSprite.scale.x=this.selectionSprite.scale.y=this.selectionSprite.currentScale=1/o,BFN.Stage.render(this.selectionShape,this.selectionSprite.texture),this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.selectionSprite.x=this.shapeBounds.minX,this.selectionSprite.y=this.shapeBounds.minY;var s=PIXI.RenderTexture.create(this.lumaTexture.width,this.lumaTexture.height);BFN.Stage.render(this.selectionSprite,s,!1),this.selectionSprite.texture.destroyGC(!0),this.selectionSprite.texture=PIXI.Texture.EMPTY,this.processFeather(s),this.lumaTexture.copyPixels(s,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05))),s.destroyGC(!0);var l={minX:this.shapeBounds.minX,minY:this.shapeBounds.minY,maxX:this.shapeBounds.maxX,maxY:this.shapeBounds.maxY};if(this.featherAmount){var u=Math.ceil(.26*this.featherBase*this.featherAmount);l.minX=Math.max(0,l.minX-u),l.minY=Math.max(0,l.minY-u),l.maxX=Math.min(this.lumaTexture.width,l.maxX+u),l.maxY=Math.min(this.lumaTexture.height,l.maxY+u)}this.painter.paintBounds=new PIXI.Rectangle(l.minX,l.minY,l.maxX-l.minX,l.maxY-l.minY),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)}}this.selectionCanvas.clear(),this.shapeStartPoint=null,this.selectionStartPoint=null,e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender(),this.cutoutActive=!1},Nx.prototype.applyBrush=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(this.painter.updatePrevTexture(),(BFN.ImagePainterUndoManager.regionIndex<0||0==BFN.ImagePainterUndoManager.regionIndex&&"undo"==BFN.ImagePainterUndoManager.direction)&&(this.initialLumaColor=0,this.invertSelection&&(this.initialLumaColor=16777215,this.lumaTexture.fillColor(this.initialLumaColor))),this.lumaTexture.copyPixels(this.painter.paintTexture,null,!1,Math.max(0,Math.min(1,.95*this.selectionStrength+.05)),null,this.invertSelection?0:16777215),this.painter.dispatchEvent(BFN.ImagePainterEvents.PAINT_UPDATED)):this.painter.cancelPaintStroke(),this.painter.clear(!1),e&&this.updateAlphaTexture(),BFN.MainUI.off("pointermove",this.handleMouseMoveBind),BFN.MainUI.off("pointerup",this.handleMouseUpBind),BFN.MainUI.off("pointerupoutside",this.handleMouseUpBind),document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.resetPressedKeys(),BFN.MainUI.requestRender()},Nx.prototype.resetPressedKeys=function(){for(var e=this.pressedKeyCodes.length;--e>-1;){var t=this.pressedKeyCodes[e];this.handleKeyUpBind({keyCode:t})}},Nx.prototype.getCutoutTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.updateCutoutRect(!1,!0),this.cutoutRect){var t=e?PIXI.RenderTexture.create(Math.min(this.sourceTexture.width,Math.ceil(this.cutoutRect.width)),Math.min(this.sourceTexture.height,Math.ceil(this.cutoutRect.height))):PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return this.sourceSprite.currentScale=1,this.imageContainer.x=e?-this.cutoutRect.x:0,this.imageContainer.y=e?-this.cutoutRect.y:0,this.updateMaskDisplay(!1),BFN.Stage.render(this.imageContainer,t),this.sourceSprite.currentScale=this._scale,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.updateMaskDisplay(),t}if(this.sourceTexture){var n=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);return n.clear(),n}return null},Nx.prototype.handleMouseOver=function(e){switch(this.selectionMode){case"magic_brush":BFN.CursorScreen.cursor="select_cross",BFN.BrushCircle.show(this.painter.brushRadius*this._scale,e,!0);break;case"lasso":BFN.CursorScreen.cursor="select_lasso";break;case"polygon":BFN.CursorScreen.cursor="select_poly";break;case"circle":case"rectangle":BFN.CursorScreen.cursor="select_cross"}},Nx.prototype.handleMouseOut=function(e){switch(this.selectionMode){case"magic_brush":BFN.BrushCircle.hide(!0)}BFN.CursorScreen.cursor=null},Nx.prototype.handleMouseDown=function(e){if(e)this.pointerEvent=e;else{if(!this.pointerEvent)return;e=this.pointerEvent}if(!(e&&e.data&&e.data.originalEvent&&2===e.data.originalEvent.button)){switch(this.invertSelection=e.data.originalEvent.altKey||this.erase,this.invertSelection=(!e.data.originalEvent.altKey||!this.erase)&&this.invertSelection,this.invertSelection=this.inverse?!this.invertSelection:this.invertSelection,this.shiftKey=e.data.originalEvent.shiftKey,this.selectionMode){case"magic_brush":this.startQuickSelect(e);break;case"lasso":this.startLasso(e);break;case"polygon":break;case"circle":this.startCircle(e);break;case"rectangle":this.startRectangle(e)}BFN.MainUI.on("pointermove",this.handleMouseMoveBind),BFN.MainUI.on("pointerup",this.handleMouseUpBind),BFN.MainUI.on("pointerupoutside",this.handleMouseUpBind),document.addEventListener("keydown",this.handleKeyDownBind),document.addEventListener("keyup",this.handleKeyUpBind),BFN.MainUI.requestRender()}},Nx.prototype.handleMouseMove=function(e){if(e)this.pointerEvent=e;else{if(!this.pointerEvent)return;e=this.pointerEvent}if(!this.spaceKey){switch(this.selectionMode){case"magic_brush":this.moveQuickSelect(e);break;case"lasso":this.moveLasso(e);break;case"polygon":this.movePolygon();break;case"circle":this.moveCircle(e);break;case"rectangle":this.moveRectangle(e)}BFN.MainUI.requestRender()}},Nx.prototype.handleMouseUp=function(e){if(e)this.pointerEvent=e;else{if(!this.pointerEvent)return;e=this.pointerEvent}switch(this.shiftKey=e.data.originalEvent.shiftKey,this.selectionMode){case"magic_brush":this.stopQuickSelect();break;case"lasso":this.stopLasso();break;case"polygon":this.startPolygon();break;case"circle":this.stopCircle();break;case"rectangle":this.stopRectangle()}},Nx.prototype.handlePaintingComplete=function(e){this.applyBrush()},Nx.prototype.alternateHistoryAction=function(){return!!this.cutoutActive&&(this.handleKeyDown({keyCode:27}),!0)},Nx.prototype.handleKeyDown=function(e){if(-1==this.pressedKeyCodes.indexOf(e.keyCode)){switch(this.pressedKeyCodes.push(e.keyCode),e.keyCode){case 16:this.shiftKey=!0,this.handleMouseMoveBind();break;case 32:this.spaceKey=!0,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG);break;case 27:switch(this.pressedKeyCodes.splice(this.pressedKeyCodes.indexOf(27),1),this.selectionMode){case"magic_brush":this.stopQuickSelect(!1);break;case"lasso":this.stopLasso(!1);break;case"polygon":this.stopPolygon(!1);break;case"circle":this.stopCircle(!1);break;case"rectangle":this.stopRectangle(!1);break;case"brush":this.applyBrush(!1)}}this.painter.ignoreMouseMove=this.spaceKey}},Nx.prototype.handleKeyUp=function(e){var t=this.pressedKeyCodes.indexOf(e.keyCode);if(t>=0){switch(this.pressedKeyCodes.splice(t,1),e.keyCode){case 16:this.shiftKey=!1,this.handleMouseMoveBind();break;case 32:this.spaceKey=!1,BFN.PhotoEditorCanvas.canvasDragger.stopDrag()}this.painter.ignoreMouseMove=this.spaceKey}},Nx.prototype.handleAltTextureUpdated=function(e){BFN.ImagePainterUndoManager.undoExists||BFN.ImagePainterUndoManager.memoryFreed||this.resetLumaTexture(),this.updateAlphaTexture()},Nx.prototype.handleCanvasScalingUpdated=function(e){"magic_brush"==this.selectionMode&&BFN.BrushCircle.showing&&!BFN.PhotoEditorCanvasModel.canvasScaling&&BFN.BrushCircle.show(this.painter.brushRadius*this._scale,this.pointerEvent,!0)},Object.defineProperty(Nx.prototype,"toolScale",{set:function(e){this._scale=e,this.painter.toolScale=this._scale,this.selectionCanvas.scale.x=this.selectionCanvas.scale.y=1/this._scale,this.sourceSprite.currentScale=this._scale},get:function(){return this._scale}}),Object.defineProperty(Nx.prototype,"backgroundColor",{set:function(e){this._backgroundColor=e,this.backgroundGraphic.clear(),this.sourceTexture&&-1!==e&&(this.backgroundGraphic.beginFill(parseInt("0x"+this._backgroundColor)),this.backgroundGraphic.drawRect(0,0,this.itemWidth,this.itemHeight),this.backgroundGraphic.endFill())},get:function(){return this._backgroundColor}}),Object.defineProperty(Nx.prototype,"modifiedTexture",{get:function(){return this.getCutoutTexture(this.trimTransparency)}}),Object.defineProperty(BFN,"ImageCutout",{get:function(){return!BFN._ImageCutout&&(BFN._ImageCutout=new Nx),BFN._ImageCutout}}),Mx.prototype=Object.create(PIXI.Sprite.prototype),Mx.prototype.init=function(){BeFunky.log("ImageRotator Init"),this.initDefaultValues(),this.initCanvas(),this.initImage(),this.initGrid(),this.initRotatorMask(),this.initGridAnimator(),this.updateGridDisplay()},Mx.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.straightening=!1,this.straightenAngle=0,this.imageWidth=0,this.imageHeight=0,this.itemWidth=0,this.itemHeight=0,this.gridSegmentSize=40,this.rightAngleIndex=0,this.adjustedImageWidth=0,this.adjustedImageHeight=0,this.adjustedImageCenterBeta=0,this.imageCenterBeta=0,this.imageRadius=0,this.imageBetaOffset=0,this.cropScale=0,this.cropWidth=0,this.cropHeight=0},Mx.prototype.initCanvas=function(){this.canvas=new PIXI.Container,this.addChild(this.canvas)},Mx.prototype.initImage=function(){this.imageContainer=new PIXI.Container,this.canvas.addChild(this.imageContainer),this.image=new PIXI.Sprite,this.imageContainer.addChild(this.image)},Mx.prototype.initGrid=function(){this.grid=new PIXI.Graphics,this.addChild(this.grid)},Mx.prototype.initRotatorMask=function(){this.rotatorMask=new PIXI.Graphics,this.addChild(this.rotatorMask),this.mask=this.rotatorMask},Mx.prototype.initGridAnimator=function(){this.gridAnimator=new BFN.Animator,this.gridAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleGridAnimatorUpdate.bind(this))},Mx.prototype.handleRotate=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE){var e=UITools.getToolVO("rotate");switch(e.updating_id){case"rotate_clockwise":case"rotate_counter_clockwise":case"flip_horizontal":case"flip_vertical":this.performRotateAction(e.updating_id);break;case"straighten":this.straightenAngle=e.straighten*(Math.PI/180),this.updateStraightening(),!this.straightening&&e.updating?(this.straightening=!0,this.gridAnimator.increase()):this.straightening&&!e.updating&&(this.straightening=!1,this.gridAnimator.decrease())}}},Mx.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.setupRotator())},Mx.prototype.setupRotator=function(){UITools.setToolValue("rotate","straighten",0),UITools.updateToolControl("rotate_straighten"),this.imageWidth=this.adjustedImageWidth=this.sourceTexture?this.sourceTexture.width:0,this.imageHeight=this.adjustedImageHeight=this.sourceTexture?this.sourceTexture.height:0,this.image.x=-this.imageWidth/2,this.image.y=-this.imageHeight/2,this.image.scale.x=1,this.image.scale.y=1,this.image.rotation=0,this.straightenAngle=0,this.rightAngleIndex=0,this.imageCenterBeta=this.adjustedImageCenterBeta=Math.atan2(this.imageHeight,this.imageWidth),this.imageRadius=Math.sqrt(Math.pow(this.imageWidth/2,2)+Math.pow(this.imageHeight/2,2)),this.updateStraightening(),this.drawRotatorMask(),this.drawGrid()},Mx.prototype.performRotateAction=function(e){switch(e){case"rotate_clockwise":this.rightAngleIndex=(this.rightAngleIndex+1)%4;break;case"rotate_counter_clockwise":this.rightAngleIndex=(this.rightAngleIndex+4-1)%4;break;case"flip_horizontal":this.image.scale.x*=this.rightAngleIndex%2?1:-1,this.image.scale.y*=this.rightAngleIndex%2?-1:1;break;case"flip_vertical":this.image.scale.x*=this.rightAngleIndex%2?-1:1,this.image.scale.y*=this.rightAngleIndex%2?1:-1}this.image.rotation=this.rightAngleIndex*(Math.PI/2),this.imageBetaOffset=0,-1==this.image.scale.x&&-1==this.image.scale.y?this.imageBetaOffset=Math.PI:-1==this.image.scale.x?this.imageBetaOffset=Math.PI-2*this.imageCenterBeta:-1==this.image.scale.y&&(this.imageBetaOffset=-2*this.imageCenterBeta),this.image.x=-Math.cos(this.imageCenterBeta+this.image.rotation+this.imageBetaOffset)*this.imageRadius,this.image.y=-Math.sin(this.imageCenterBeta+this.image.rotation+this.imageBetaOffset)*this.imageRadius,this.updateStraightening(),this.drawRotatorMask(),BFN.MainUI.requestRender()},Mx.prototype.updateStraightening=function(){this.adjustedImageWidth=this.rightAngleIndex%2?this.imageHeight:this.imageWidth,this.adjustedImageHeight=this.rightAngleIndex%2?this.imageWidth:this.imageHeight,this.adjustedImageCenterBeta=Math.atan2(this.adjustedImageHeight,this.adjustedImageWidth),this.imageContainer.rotation=this.straightenAngle;var e=this.imageContainer.rotation,t=Math.abs(e),n=this.adjustedImageWidth>this.adjustedImageHeight?this.adjustedImageCenterBeta:Math.PI/2-this.adjustedImageCenterBeta,i=Math.PI-n-t,r=Math.sin(i)?Math.sin(n)*this.imageRadius/Math.sin(i):this.imageRadius;this.cropScale=r/this.imageRadius,this.cropWidth=Math.round(this.adjustedImageWidth*this.cropScale),this.cropHeight=Math.round(this.adjustedImageHeight*this.cropScale),this.rotatorMask.scale.x=this.rotatorMask.scale.y=this.cropScale,this.itemWidth=this.cropWidth,this.itemHeight=this.cropHeight,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()},Mx.prototype.drawRotatorMask=function(){this.rotatorMask.clear(),this.rotatorMask.beginFill(16777215),this.rotatorMask.drawRect(-this.adjustedImageWidth/2,-this.adjustedImageHeight/2,this.adjustedImageWidth,this.adjustedImageHeight),this.rotatorMask.endFill()},Mx.prototype.drawGrid=function(){if(this.sourceTexture){this.grid.scale.x=this.grid.scale.y=1/this._scale,this.gridSegmentSize=Math.round(Math.max(40,Math.round(Math.max(this.imageWidth,this.imageHeight)/20))*this._scale);var e=Math.ceil(Math.max(this.imageWidth,this.imageHeight)/this.gridSegmentSize)+2;e+=e%2?0:1,this.grid.clear();for(var t=0;t<e;t++){var n=Math.floor((e-1)/2*this.gridSegmentSize),i=Math.floor(t*this.gridSegmentSize-n);this.grid.lineStyle(3,0,.5),this.grid.moveTo(-n,i),this.grid.lineTo(n,i),this.grid.moveTo(i,-n),this.grid.lineTo(i,n)}for(var r=0;r<e;r++){var a=Math.floor((e-1)/2*this.gridSegmentSize),o=Math.floor(r*this.gridSegmentSize-a);this.grid.lineStyle(1,16777215,.5),this.grid.moveTo(-a,o),this.grid.lineTo(a,o),this.grid.moveTo(o,-a),this.grid.lineTo(o,a)}}},Mx.prototype.updateGridDisplay=function(){this.grid.alpha=this.gridAnimator.animationFactor,this.grid.visible=this.grid.alpha>0},Mx.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.image.texture=PIXI.Texture.EMPTY},Mx.prototype.handleGridAnimatorUpdate=function(e){this.updateGridDisplay()},Object.defineProperty(Mx.prototype,"toolScale",{set:function(e){this._scale=e,this.drawGrid()},get:function(){return this._scale}}),Object.defineProperty(Mx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.cropWidth),Math.round(this.cropHeight));return this.canvas.x=e.width/2,this.canvas.y=e.height/2,BFN.Stage.render(this.canvas,e),this.canvas.x=this.canvas.y=0,e}}),Object.defineProperty(BFN,"ImageRotator",{get:function(){return!BFN._ImageRotator&&(BFN._ImageRotator=new Mx),BFN._ImageRotator}}),Dx.prototype=Object.create(PIXI.Sprite.prototype),Dx.prototype.init=function(){BeFunky.log("ImageResize Init"),this.initDefaultValues(),this.initDisplay()},Dx.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this._scaling=!1,this.resizeWidth=0,this.resizeHeight=0,this.imageWidth=0,this.imageHeight=0,this.itemWidth=0,this.itemHeight=0,this.lockAspectRatio=!0,this.aspectRatio=1},Dx.prototype.initDisplay=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer),this.image=new PIXI.Sprite,this.image.pluginName="smooth_picture",this.imageContainer.addChild(this.image)},Dx.prototype.handleResize=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE){var e=UITools.getToolVO("resize");if(this.lockAspectRatio!=e.lock_aspect_ratio&&(this.lockAspectRatio=e.lock_aspect_ratio,this.lockAspectRatio&&(this.aspectRatio=this.resizeHeight/this.resizeWidth)),this.lockAspectRatio)switch(e.updating_id){case"resize_width":this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_width*this.aspectRatio)),this.resizeWidth=this.resizeHeight/this.aspectRatio;break;case"resize_height":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_height/this.aspectRatio)),this.resizeHeight=this.resizeWidth*this.aspectRatio;break;case"resize_xscale":this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_xscale/100*this.imageWidth*this.aspectRatio)),this.resizeWidth=this.resizeHeight/this.aspectRatio;break;case"resize_yscale":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_yscale/100*this.imageHeight/this.aspectRatio)),this.resizeHeight=this.resizeWidth*this.aspectRatio}else switch(e.updating_id){case"resize_width":case"resize_height":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_width)),this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_height));break;case"resize_xscale":case"resize_yscale":this.resizeWidth=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_xscale/100*this.imageWidth)),this.resizeHeight=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,e.resize_yscale/100*this.imageHeight))}this.image.isResize=!e.updating,this.resizeWidth=Math.round(this.resizeWidth),this.resizeHeight=Math.round(this.resizeHeight),UITools.setToolValue("resize","resize_width",this.resizeWidth),UITools.setToolValue("resize","resize_height",this.resizeHeight),UITools.setToolValue("resize","resize_xscale",Math.round(this.resizeWidth/this.imageWidth*100)),UITools.setToolValue("resize","resize_yscale",Math.round(this.resizeHeight/this.imageHeight*100)),UITools.updateToolControls("resize"),this.updateSize()}},Dx.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.image.isResize=!0,this.setupResizer(),UITools.setToolValue("resize","resize_width",this.imageWidth),UITools.setToolValue("resize","resize_height",this.imageHeight),UITools.setToolValue("resize","resize_xscale",100),UITools.setToolValue("resize","resize_yscale",100),UITools.setToolValue("resize","lock_aspect_ratio",!0),UITools.updateToolControls("resize"))},Dx.prototype.setupResizer=function(){this.imageWidth=this.resizeWidth=this.sourceTexture?this.sourceTexture.width:0,this.imageHeight=this.resizeHeight=this.sourceTexture?this.sourceTexture.height:0,this.lockAspectRatio=!1,this.updateSize(),this.updateScaleBounds()},Dx.prototype.updateSize=function(){this.imageContainer.x=-Math.round(this.imageWidth/2)+(this.imageWidth-this.resizeWidth)/2,this.imageContainer.y=-Math.round(this.imageHeight/2)+(this.imageHeight-this.resizeHeight)/2,this.image.scale.x=this.resizeWidth/this.imageWidth,this.image.scale.y=this.resizeHeight/this.imageHeight,this.itemWidth=this.resizeWidth,this.itemHeight=this.resizeHeight,this.updateSmoothing(),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()},Dx.prototype.updateScaleBounds=function(){var e=UITools.getParamObject("resize_resize_xscale");e.min=Math.floor(BFN.minImageSize/this.imageWidth*100),e.max=Math.ceil(BFN.maxImageSize/this.imageWidth*100);var t=UITools.getParamObject("resize_resize_yscale");t.min=Math.floor(BFN.minImageSize/this.imageHeight*100),t.max=Math.ceil(BFN.maxImageSize/this.imageHeight*100)},Dx.prototype.updateSmoothing=function(e){null==e&&(e=!0),this.image.currentScale=e?this.image.scale.x*this._scale:this.image.scale.x,this.image.currentScaleY=e?this.image.scale.y*this._scale:this.image.scale.y},Dx.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.image.texture=PIXI.Texture.EMPTY},Object.defineProperty(Dx.prototype,"toolScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(Dx.prototype,"toolScaling",{set:function(e){this._scaling=e,this.image.isResize=!this._scaling},get:function(){return this._scaling}}),Object.defineProperty(Dx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.resizeWidth),Math.round(this.resizeHeight));return this.updateSmoothing(!1),this.imageContainer.x=0,this.imageContainer.y=0,this.image.isResize=!0,BFN.Stage.render(this.imageContainer,e),this.updateSize(),e}}),Object.defineProperty(BFN,"ImageResize",{get:function(){return!BFN._ImageResize&&(BFN._ImageResize=new Dx),BFN._ImageResize}}),wx.prototype=Object.create(PIXI.Sprite.prototype),wx.prototype.init=function(){BeFunky.log("ImageSlimming Init"),this.initDefaultValues(),this.initDisplay()},wx.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.slimmingWidth=0,this.imageWidth=0,this.itemWidth=0,this.itemHeight=0,this.slimmingAmount=1,this.slimmingFactor=1},wx.prototype.initDisplay=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer),this.image=new PIXI.Sprite,this.image.pluginName="blend_picture",this.imageContainer.addChild(this.image)},wx.prototype.handleSlimming=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING){var e=UITools.getToolVO("slimming");this.slimmingAmount=e.amount/100,this.updateSize()}},wx.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.setupSlimming(),UITools.setToolValue("slimming","amount",Math.round(100*this.slimmingAmount)),UITools.updateToolControls("slimming"))},wx.prototype.setupSlimming=function(){this.imageWidth=this.slimmingWidth=this.sourceTexture?this.sourceTexture.width:0,this.imageHeight=this.sourceTexture?this.sourceTexture.height:0,this.slimmingAmount=.3,this.updateSize()},wx.prototype.updateSize=function(){this.slimmingFactor=1-.05*this.slimmingAmount,this.slimmingWidth=Math.round(this.slimmingFactor*this.imageWidth),this.imageContainer.x=-Math.round(this.imageWidth/2)+(this.imageWidth-this.slimmingWidth)/2,this.imageContainer.y=-Math.round(this.imageHeight/2),this.image.scale.x=this.slimmingWidth/this.imageWidth,this.itemWidth=this.slimmingWidth,this.itemHeight=this.imageHeight,this.updateSmoothing(),BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED)},wx.prototype.updateSmoothing=function(e){null==e&&(e=!0),this.image.currentScale=e?this.image.scale.x*this._scale:this.image.scale.x,this.image.currentScaleY=e?this._scale:1},wx.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null),this.image.texture=PIXI.Texture.EMPTY},Object.defineProperty(wx.prototype,"toolScale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(wx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(Math.round(this.slimmingWidth),Math.round(this.imageHeight));return this.updateSmoothing(!1),this.imageContainer.x=0,this.imageContainer.y=0,BFN.Stage.render(this.imageContainer,e),this.updateSize(),e}}),Object.defineProperty(BFN,"ImageSlimming",{get:function(){return!BFN._ImageSlimming&&(BFN._ImageSlimming=new wx),BFN._ImageSlimming}}),Lx.prototype=Object.create(PIXI.Sprite.prototype),Lx.prototype.init=function(){BeFunky.log("ImageReshape Init"),this.initDefaultValues(),this.initImageContainer(),this.initDisplay()},Lx.prototype.initDefaultValues=function(){this.sourceTexture=null,this.sourceTextureLoRes=null,this.resultTexture=null,this._scale=1,this.blurAmount=.4,this.draftResolution=1,this.draftActive=!1,this.renderPending=!1,this.workingTextureMaxSide=1024,this.displacementResizeFactor=1,this.liquifyBrushFilter=new BFN.filters.LiquifyBrushFilter,this.blurFilter=new BFN.filters.FastBlurWrapper,this.displacementFilter=new BFN.filters.DisplacementFilter,this.handleAltBitmapDataUpdatedBind=this.handleAltBitmapDataUpdated.bind(this),this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this)},Lx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer)},Lx.prototype.initDisplay=function(){this.brushPixelSourceTexture=null,this.brushPixelSourceSprite=new PIXI.Sprite,this.brushPixelSourceRendereredTexture=null,this.brushPixelSourceRendereredSprite=new PIXI.Sprite,this.sourceSprite=new PIXI.Sprite,this.resultSprite=new PIXI.Sprite,this.resultSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.resultSprite),this.displacementTexture=null,this.displacementSprite=new PIXI.Sprite,this.displacementBlurredTexture=null,this.displacementBlurredSprite=new PIXI.Sprite,this.painter=new BFN.ImagePainter,this.painter.brushEnabled=!1,this.painter.brushHardnessFactor=0,this.painter.staggerInterval=25,this.painter.scaleAffectsBrushRadius=!1,this.painter.addEventListener(BFN.ImagePainterEvents.BRUSH_APPLIED.type,this.handleBrushApplied.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_STARTED.type,this.handlePaintingStarted.bind(this)),this.painter.addEventListener(BFN.ImagePainterEvents.PAINTING_COMPLETE.type,this.handlePaintingComplete.bind(this)),this.imageContainer.addChild(this.painter)},Lx.prototype.handleReshape=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE){var e=UITools.getToolVO("reshape"),t=!1;if("reset"==e.updating_id)this.painter.clear(),this.displacementTexture.fillRect(0,0,this.displacementTexture.width,this.displacementTexture.height,32896,1),this.displacementBlurredTexture.copyPixels(this.displacementTexture),t=!0,"erase"==e.mode&&(UITools.setToolValue("reshape","mode","smudge"),UITools.updateToolControl("reshape_mode"),this.liquifyBrushFilter.mode=e.mode);else{var n=e.brush_size/100*.6+.15;e.updating&&"brush_size"==e.updating_id&&this.painter.brushSizeFactor!=n&&(this.painter.brushSizeFactor=n),e.updating||"brush_size"!=e.updating_id&&this.painter.brushSizeFactor==n&&!this.painter.brushSizeChanged||(this.painter.brushSizeFactor=n,this.painter.updateBrush(),this.updateBrushPixelSource()),this.liquifyBrushFilter.pressure=e.pressure/100,this.liquifyBrushFilter.mode=e.mode,this.painter.ignoreInitialPress="smudge"==e.mode,this.painter.staggerEnabled="smudge"!=e.mode;var i=e.strength/100;i!=this.displacementFilter.strength&&(t=!0),this.displacementFilter.strength=i}"strength"==e.updating_id&&this.draftActive!=e.updating&&(t=!1,this.toggleDraft(e.updating)),t&&(this.renderPending=!0,BFN.MainUI.requestRender())}},Lx.prototype.reset=function(){null!=this.sourceTexture&&(this.sourceTexture=null);try{this.sourceTextureLoRes.destroyGC(!0)}catch(e){}this.sourceTextureLoRes=null,this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.resultTexture.destroyGC(!0)}catch(e){}this.resultTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY;try{this.displacementTexture.destroyGC(!0)}catch(e){}this.displacementTexture=null,this.displacementSprite.texture=PIXI.Texture.EMPTY;try{this.displacementBlurredTexture.destroyGC(!0)}catch(e){}this.displacementBlurredTexture=null,this.displacementBlurredSprite.texture=PIXI.Texture.EMPTY,this.painter.altTexture=null,BFN.ImagePainterUndoManager.removeEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind),BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)},Lx.prototype.setSourceTexture=function(e){if(this.reset(),e){this.sourceTexture=e;var t=this.sourceTexture.width*this.sourceTexture.height;t>Math.pow(3072,2)?this.draftResolution=.25:t>Math.pow(2048,2)?this.draftResolution=.5:this.draftResolution=1,this.sourceTextureLoRes=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height,void 0,this.draftResolution),this.sourceTextureLoRes.copyPixels(this.sourceTexture),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.displacementResizeFactor=Math.min(1,this.workingTextureMaxSide/Math.max(this.sourceTexture.width,this.sourceTexture.height)),this.resultTexture=this.sourceTexture.renderClone(),this.resultTexture.clear(),this.displacementTexture=PIXI.RenderTexture.create(Math.floor(this.sourceTexture.width*this.displacementResizeFactor),Math.floor(this.sourceTexture.height*this.displacementResizeFactor)),this.displacementTexture.fillColor(32896),this.displacementBlurredTexture=this.displacementTexture.renderClone(),this.sourceSprite.texture=this.sourceTexture,this.resultSprite.texture=this.resultTexture,this.displacementSprite.texture=this.displacementTexture,this.displacementBlurredSprite.texture=this.displacementBlurredTexture,this.displacementFilter.inputSprite=this.sourceSprite,this.displacementFilter.iChannel1=this.displacementBlurredTexture,this.sourceSprite.filters=[this.displacementFilter],this.painter.altTexture=this.displacementTexture,BFN.ImagePainterUndoManager.addEventListener(BFN.ImagePainterUndoManagerEvents.ALT_TEXTURE_UPDATED.type,this.handleAltBitmapDataUpdatedBind),BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind),UITools.setToolValue("reshape","pressure",50),UITools.setToolValue("reshape","brush_size",50),UITools.setToolValue("reshape","strength",100),UITools.setToolValue("reshape","mode","smudge"),UITools.updateToolControls("reshape"),BFN.Stage.render(this.sourceSprite,this.resultTexture),this.renderPending=!0,BFN.MainUI.requestRender()}else this.imageContainer.x=0,this.imageContainer.y=0,this.blurFilter.dispose();this.updatePainter()},Lx.prototype.toggleDraft=function(e){this.draftActive!==e&&(this.draftActive=e,BFN.StageModel.setRefreshFactor(e?.5:1),this.sourceSprite.texture=e?this.sourceTextureLoRes:this.sourceTexture,this.renderPending=!0,BFN.MainUI.requestRender())},Lx.prototype.updateSmoothing=function(){this.resultSprite.currentScale=this._scale},Lx.prototype.updateItemDimensions=function(){this.sourceTexture&&(this.itemWidth=Math.floor(this.sourceTexture.width-2/this._scale),this.itemHeight=Math.floor(this.sourceTexture.height-2/this._scale))},Lx.prototype.updateBrushPixelSource=function(){try{this.brushPixelSourceTexture.destroyGC(!0)}catch(e){}this.brushPixelSourceTexture=PIXI.RenderTexture.create(Math.round(this.painter.brush.texture.width),this.painter.brush.texture.height),this.brushPixelSourceTexture.fillRect(0,0,this.brushPixelSourceTexture.width,this.brushPixelSourceTexture.height,16777215,1),this.brushPixelSourceSprite.texture=this.brushPixelSourceTexture;try{this.brushPixelSourceRendereredTexture.destroyGC(!0)}catch(e){}this.brushPixelSourceRendereredTexture=PIXI.RenderTexture.create(this.brushPixelSourceTexture.width,this.brushPixelSourceTexture.height),this.brushPixelSourceRendereredTexture.fillRect(0,0,this.brushPixelSourceRendereredTexture.width,this.brushPixelSourceRendereredTexture.height,16777215,1),this.brushPixelSourceRendereredSprite.texture=this.brushPixelSourceRendereredTexture,this.liquifyBrushFilter.vTextureCoordMax=this.brushPixelSourceTexture.width/BFN.FilterHelper.getNextPowerOfTwo(this.brushPixelSourceTexture.width),this.brushPixelSourceSprite.filters=[this.liquifyBrushFilter]},Lx.prototype.applyBrush=function(){if(this.displacementTexture){var e=this.painter.brushRect;this.brushPixelSourceTexture.copyPixels(this.displacementTexture,new PIXI.Point(-e.x,-e.y),!0),this.brushPixelSourceRendereredSprite.x=e.x,this.brushPixelSourceRendereredSprite.y=e.y,this.liquifyBrushFilter.beta=this.painter.brushBeta,BFN.Stage.render(this.brushPixelSourceSprite,this.brushPixelSourceRendereredTexture,!0),this.displacementTexture.fillRect(e.x,e.y,this.brushPixelSourceTexture.width,this.brushPixelSourceTexture.height,16711680,.5),BFN.Stage.render(this.brushPixelSourceRendereredSprite,this.displacementTexture,!1);var t=this.blurFilter.render(this.blurAmount,this.displacementTexture);this.displacementBlurredTexture.copyPixels(t),this.renderPending=!0,BFN.MainUI.requestRender()}},Lx.prototype.updatePainter=function(){this.sourceTexture?(this.painter.painterWidth==this.displacementTexture.width&&this.painter.painterHeight==this.displacementTexture.height||this.painter.setup(this.displacementTexture.width,this.displacementTexture.height),this.painter.scale.x=this.painter.scale.y=1/this.displacementResizeFactor,this.updatePainterToolScale()):this.painter.reset()},Lx.prototype.updatePainterToolScale=function(){this.painter.toolScale=this._scale/this.displacementResizeFactor},Lx.prototype.handleBrushApplied=function(){this.applyBrush()},Lx.prototype.handleAltBitmapDataUpdated=function(e){BFN.Stage.render(this.displacementSprite,this.displacementBlurredTexture,!0);var t=this.blurFilter.render(this.blurAmount,this.displacementTexture);this.displacementBlurredTexture.copyPixels(t),this.renderPending=!0,BFN.MainUI.requestRender()},Lx.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.sourceSprite,this.resultTexture))},Lx.prototype.handlePaintingStarted=function(e){this.toggleDraft(!0)},Lx.prototype.handlePaintingComplete=function(e){this.toggleDraft(!1)},Object.defineProperty(Lx.prototype,"toolScale",{set:function(e){this._scale=e,this.updatePainterToolScale(),this.updateSmoothing(),this.updateItemDimensions()},get:function(){return this._scale}}),Object.defineProperty(Lx.prototype,"modifiedTexture",{get:function(){return this.resultTexture.renderClone()}}),Object.defineProperty(BFN,"ImageReshape",{get:function(){return!BFN._ImageReshape&&(BFN._ImageReshape=new Lx),BFN._ImageReshape}}),Ox.prototype=Object.create(PIXI.Sprite.prototype),Ox.prototype.init=function(){BeFunky.log("ImageTilter Init"),this.initDefaultValues(),this.initDisplay()},Ox.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this.itemWidth=this.imageContainerWidth=0,this.itemHeight=this.imageContainerHeight=0},Ox.prototype.initDisplay=function(){this.imageContainer=new PIXI.Container,this.addChild(this.imageContainer),this.imageBackground=new PIXI.Graphics,this.imageContainer.addChild(this.imageBackground),this.imageCenterContainer=new PIXI.Container,this.imageContainer.addChild(this.imageCenterContainer),this.image=new PIXI.Sprite,this.image.pluginName="smooth_picture",this.imageCenterContainer.addChild(this.image)},Ox.prototype.handleTilt=function(){if(this.sourceTexture&&BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT){var e=UITools.getToolVO("tilt"),t=e.tilt_amount,n=Math.abs(t*(Math.PI/180)),i=this.sourceTexture.width,r=this.sourceTexture.height;this.imageContainerWidth=Math.cos(n)*i+Math.sin(n)*r,this.imageContainerHeight=Math.cos(n)*r+Math.sin(n)*i,this.imageBackground.clear(),-1!=e.background_color?this.imageBackground.beginFill("0x"+e.background_color):this.imageBackground.beginFill(0,0),this.imageBackground.drawRect(0,0,this.imageContainerWidth,this.imageContainerHeight),this.imageBackground.endFill(),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageCenterContainer.x=-this.imageContainer.x,this.imageCenterContainer.y=-this.imageContainer.y,this.imageCenterContainer.rotation=t*(Math.PI/180);var a=Math.min(1,this.image.texture.height/this.imageContainerHeight);this.scale.x=this.scale.y=a,this.itemWidth=Math.round(this.imageContainerWidth*a),this.itemHeight=Math.round(this.imageContainerHeight*a),this.image.currentScale=this._scale*a,BFN.PhotoEditorCanvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED),BFN.MainUI.requestRender()}else this.imageContainer.x=0,this.imageContainer.y=0,this.imageCenterContainer.x=0,this.imageCenterContainer.y=0,this.imageCenterContainer.rotation=0},Ox.prototype.setSourceTexture=function(e){this.reset(),e&&(this.sourceTexture=e,this.image.texture=this.sourceTexture,this.image.x=-this.image.texture.width/2,this.image.y=-this.image.texture.height/2,this.scale.x=this.scale.y=1,this.itemWidth=this.sourceTexture.width,this.itemHeight=this.sourceTexture.height,UITools.setToolValue("tilt","tilt_amount",0),UITools.setToolValue("tilt","background_color",-1),UITools.updateToolControls("tilt"))},Ox.prototype.reset=function(){this.sourceTexture=null,this.image.texture=PIXI.Texture.EMPTY,this.image.x=0,this.image.y=0},Object.defineProperty(Ox.prototype,"toolScale",{set:function(e){this._scale=e,this.image.currentScale=this._scale*this.scale.x},get:function(){return this._scale}}),Object.defineProperty(Ox.prototype,"modifiedTexture",{get:function(){var e=Math.min(1,BFN.maxImageSize/this.imageContainerWidth,BFN.maxImageSize/this.imageContainerHeight),t=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerWidth*e)),n=Math.min(BFN.maxImageSize,Math.floor(this.imageContainerHeight*e)),i=PIXI.RenderTexture.create(t,n);return this.imageContainer.x=this.imageContainer.y=0,this.imageContainer.scale.x=this.imageContainer.scale.y=this.image.currentScale=e,BFN.Stage.render(this.imageContainer,i),this.imageContainer.x=-Math.round(this.imageContainerWidth/2),this.imageContainer.y=-Math.round(this.imageContainerHeight/2),this.imageContainer.scale.x=this.imageContainer.scale.y=1,this.image.currentScale=this._scale*this.scale.x,i}}),Object.defineProperty(BFN,"ImageTilter",{get:function(){return!BFN._ImageTilter&&(BFN._ImageTilter=new Ox),BFN._ImageTilter}}),Rx.prototype=Object.create(PIXI.Container.prototype),Rx.prototype.init=function(){BeFunky.log("FunkyMask Init"),this.initDefaultValues(),this.initMask(),this.initMaskGuide(),this.initMaskGuideShape(),this.initMaskGuideHandles(),this.initDraggers(),BFN.AppModel.appReady?BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this))}.bind(this))},Rx.prototype.initDefaultValues=function(){this._scale=1,this._hardness=.5,this._maskTarget=null,this.interactive=!0,this.renderPending=!1,this.hovered=!1,this.dragging=!1,this.keepGuidesOn=!1,this.showOuterHandles=!0,this.showRatioHandles=!1,this.strokeWidth=2,this.strokeShadowWidth=1,this.on("pointerover",this.handleToolMouseOver.bind(this)),this.on("pointerout",this.handleToolMouseOut.bind(this)),this.on("pointerdown",this.handleToolMouseDown.bind(this)),this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleKeyUpBind=this.handleKeyUp.bind(this)},Rx.prototype.initMask=function(){this.maskSourceSize=512,this.maskSourceScale=1,this.maskSourceFill=new PIXI.Graphics,this.maskSourceFill.beginFill(16777215),this.maskSourceFill.drawRect(0,0,this.maskSourceSize,this.maskSourceSize),this.maskSourceFill.endFill(),this.maskSourceTexture=PIXI.RenderTexture.create(this.maskSourceSize,this.maskSourceSize),BFN.Stage.render(this.maskSourceFill,this.maskSourceTexture),this.maskSourceSprite=new PIXI.Sprite(this.maskSourceTexture),this.maskSourceFilter=BFN.ShaderPool.BrushFilter,this.maskSourceFilter.radius=this.maskSourceSize/2,this.maskContainer=new PIXI.Container,this.addChild(this.maskContainer),this.maskTexture=PIXI.RenderTexture.create(this.maskSourceSize,this.maskSourceSize),this.maskSprite=new PIXI.Sprite(this.maskTexture),this.maskSprite.anchor.x=this.maskSprite.anchor.y=.5,this.maskContainer.addChild(this.maskSprite)},Rx.prototype.initMaskGuide=function(){this.maskGuide=new PIXI.Graphics,this.maskGuide.interactive=!0,this.addChild(this.maskGuide)},Rx.prototype.initMaskGuideShape=function(){this.maskGuideShape=new PIXI.Graphics,this.maskGuideShape.interactive=!0,this.maskGuide.addChild(this.maskGuideShape),this.maskGuideShape.on("pointerdown",function(){BFN.GestureManager.multiplePointersActive||this.positionDragger.drag(this.maskGuide)}.bind(this)),this.resolutionFilter=new BFN.filters.PlainFilter,this.resolutionFilter.resolution=2,this.maskGuideShape.filters=[this.resolutionFilter]},Rx.prototype.initMaskGuideHandles=function(){this.handleTextureSquare=PIXI.RenderTexture.create(20,20,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{fillColor:1073741824,cornerRadius:4}),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{strokeWidth:1.5,strokeColor:4294967295,fillColor:4282154954,cornerRadius:3,paddingX:1,paddingY:1,clear:!1}),this.handleTextureCircle=PIXI.RenderTexture.create(20,20,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{fillColor:1073741824}),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{strokeWidth:1.5,strokeColor:4294967295,fillColor:4282154954,paddingX:1,paddingY:1,clear:!1}),this.handleData=["left","top","right","bottom"],this.outerHandles={},this.innerHandles={},this.ratioHandles={};for(var e=0;e<this.handleData.length;e++){var t=new BFN.HoverButton;t.id=this.handleData[e],t.texture=this.handleTextureSquare,this.outerHandles[t.id]=t,this.maskGuide.addChild(t),t.on("pointerdown",function(e){BFN.GestureManager.multiplePointersActive||this.outerHandleDragger.drag(e.currentTarget)}.bind(this)),t.on("pointerover",function(e){this.maskGuide.addChild(e.currentTarget)}.bind(this)),t.addChildAt(this.getHandleTouchSurface(),0);var n=new BFN.HoverButton;n.id=this.handleData[e],n.texture=this.handleTextureCircle,this.innerHandles[n.id]=n,this.maskGuide.addChild(n),n.on("pointerdown",function(e){BFN.GestureManager.multiplePointersActive||this.innerHandleDragger.drag(e.currentTarget)}.bind(this)),n.on("pointerover",function(e){this.maskGuide.addChild(e.currentTarget)}.bind(this)),n.addChildAt(this.getHandleTouchSurface(),0);var i=new BFN.HoverButton;i.id=this.handleData[e],i.texture=this.handleTextureSquare,this.ratioHandles[i.id]=i,this.maskGuide.addChildAt(i,1),i.on("pointerdown",function(e){BFN.GestureManager.multiplePointersActive||this.ratioHandleDragger.drag(e.currentTarget)}.bind(this)),i.addChildAt(this.getHandleTouchSurface(),0);var r=new PIXI.Graphics;r.rotation=e*(Math.PI/2),r.filters=[this.resolutionFilter],i.addChildAt(r,0),i.line=r}},Rx.prototype.initDraggers=function(){this.positionDragger=new BFN.Dragger,this.positionDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handlePositionDraggerDragging.bind(this)),this.positionDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.positionDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this)),this.outerHandleDragger=new BFN.Dragger,this.outerHandleDragger.autoDrag=!1,this.outerHandleDragger.useBounds=!1,this.outerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleOuterHandleDraggerDragging.bind(this)),this.outerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.outerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this)),this.innerHandleDragger=new BFN.Dragger,this.innerHandleDragger.autoDrag=!1,this.innerHandleDragger.useBounds=!1,this.innerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleInnerHandleDraggerDragging.bind(this)),this.innerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.innerHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this)),this.ratioHandleDragger=new BFN.Dragger,this.ratioHandleDragger.autoDrag=!1,this.ratioHandleDragger.useBounds=!1,this.ratioHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleRatioHandleDraggerDragging.bind(this)),this.ratioHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStarted.bind(this)),this.ratioHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this))},Rx.prototype.setup=function(e,t,n){if(null==n&&(n=1),e>0&&t>0){this.imageDiagonal=2*(Math.sqrt(Math.pow(e,2)+Math.pow(t,2))+10),this.longestSide=Math.max(e,t),this.hitArea=new PIXI.Rectangle(0-this.longestSide-100,0-this.longestSide-100,e+2*(this.longestSide+100),t+2*(this.longestSide+100)),this.maxSize=2*this.longestSide,this.minSize=this.maxSize/20,this.maskSourceScale=this.maskSourceSize/this.longestSide,this.maskContainer.scale.x=this.maskContainer.scale.y=1/this.maskSourceScale,this.ratioHandleDistance=Math.round(Math.max(e,t)/20);for(var i=0;i<this.handleData.length;i++){var r=this.handleData[i],a=this.ratioHandles[r];a.line.clear(),a.line.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),a.line.moveTo(0,0),a.line.lineTo(this.ratioHandleDistance,0),a.line.lineStyle(this.strokeWidth,16777215),a.line.moveTo(0,0),a.line.lineTo(this.ratioHandleDistance,0)}this.maskGuide.x=e/2,this.maskGuide.y=t/2,this.focusR=0,this.focusW=e*n,this.focusH=t*n,this.positionDragger.setBounds(0,0,e,t),this.toggleGuide(!0),this.updateMaskGuide(),this.updateMaskTransform(),this.updateMaskDisplay(),document.addEventListener("keydown",this.handleKeyDownBind,!1),document.addEventListener("keyup",this.handleKeyUpBind,!1)}},Rx.prototype.reset=function(){this.keepGuidesOn=!1,document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind)},Rx.prototype.toggleGuide=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=!!e,this.maskGuide.visible=this.guideVisible=t?e:e||this.keepGuidesOn,BFN.MainUI.requestRender()},Rx.prototype.updateMaskGuide=function(){this.maskGuide.scale.x=this.maskGuide.scale.y=1/this._scale,this.maskGuideShape.rotation=this.focusR,this.maskGuideShape.clear(),this.showOuterHandles&&this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.beginFill(16777215,0),"linear"==this.maskMode?(this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale,this.imageDiagonal*this._scale,this.focusH*this._scale),this.maskGuideShape.endFill(),this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale*this._hardness,this.imageDiagonal*this._scale,this.focusH*this._scale*this._hardness),this.maskGuideShape.lineStyle(this.strokeWidth,16777215),this.showOuterHandles&&this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale,this.imageDiagonal*this._scale,this.focusH*this._scale),this.maskGuideShape.drawRect(-this.imageDiagonal/2*this._scale,-this.focusH/2*this._scale*this._hardness,this.imageDiagonal*this._scale,this.focusH*this._scale*this._hardness)):"square"==this.maskMode?(this.maskGuideShape.drawRect(-this.focusW/2*this._scale,-this.focusH/2*this._scale,this.focusW*this._scale,this.focusH*this._scale),this.maskGuideShape.endFill(),this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.drawRect(-this.focusW/2*this._scale*this._hardness,-this.focusH/2*this._scale*this._hardness,this.focusW*this._scale*this._hardness,this.focusH*this._scale*this._hardness),this.maskGuideShape.lineStyle(this.strokeWidth,16777215),this.showOuterHandles&&this.maskGuideShape.drawRect(-this.focusW/2*this._scale,-this.focusH/2*this._scale,this.focusW*this._scale,this.focusH*this._scale),this.maskGuideShape.drawRect(-this.focusW/2*this._scale*this._hardness,-this.focusH/2*this._scale*this._hardness,this.focusW*this._scale*this._hardness,this.focusH*this._scale*this._hardness)):(this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale,this.focusH/2*this._scale),this.maskGuideShape.endFill(),this.maskGuideShape.lineStyle(this.strokeWidth+2*this.strokeShadowWidth,0,.5),this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale*this._hardness,this.focusH/2*this._scale*this._hardness),this.maskGuideShape.lineStyle(this.strokeWidth,16777215),this.showOuterHandles&&this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale,this.focusH/2*this._scale),this.maskGuideShape.drawEllipse(0,0,this.focusW/2*this._scale*this._hardness,this.focusH/2*this._scale*this._hardness));for(var e=0;e<this.handleData.length;e++){var t=this.handleData[e],n=this.outerHandles[t],i=this.innerHandles[t],r=this.ratioHandles[t];switch(t){case"left":this.betaOffset=Math.PI,this.handleDistance=this.focusW/2,n.visible=i.visible=r.visible="linear"!=this.maskMode;break;case"top":this.betaOffset=-Math.PI/2,this.handleDistance=this.focusH/2;break;case"right":this.betaOffset=0,this.handleDistance=this.focusW/2,n.visible=i.visible=r.visible="linear"!=this.maskMode;break;case"bottom":this.betaOffset=Math.PI/2,this.handleDistance=this.focusH/2}this.showOuterHandles||(n.visible=!1),this.showRatioHandles||(r.visible=!1),n.rotation=this.focusR,n.x=Math.cos(this.focusR+this.betaOffset)*this.handleDistance*this._scale,n.y=Math.sin(this.focusR+this.betaOffset)*this.handleDistance*this._scale,i.rotation=this.focusR,i.x=Math.cos(this.focusR+this.betaOffset)*this.handleDistance*this._scale*this._hardness,i.y=Math.sin(this.focusR+this.betaOffset)*this.handleDistance*this._scale*this._hardness,r.rotation=this.focusR,r.x=i.x+Math.cos(this.focusR+this.betaOffset)*this.ratioHandleDistance*this._scale,r.y=i.y+Math.sin(this.focusR+this.betaOffset)*this.ratioHandleDistance*this._scale,r.line.scale.x=this._scale}},Rx.prototype.updateMaskTransform=function(){this.maskSprite.rotation=this.focusR,this.maskSprite.x=this.maskGuide.x*this.maskSourceScale,this.maskSprite.y=this.maskGuide.y*this.maskSourceScale,this.maskSprite.scale.x="linear"==this.maskMode?this.imageDiagonal*this.maskSourceScale/this.maskSourceSize:this.focusW*this.maskSourceScale/this.maskSourceSize,this.maskSprite.scale.y=this.focusH*this.maskSourceScale/this.maskSourceSize},Rx.prototype.updateMaskDisplay=function(){this.maskSourceFilter.strength=1,this.maskSourceFilter.radius=this.maskSourceSize/2,this.maskSourceFilter.hardness=this._hardness,this.maskSourceFilter.mode=this._maskMode,this.maskSourceSprite.bfn_shaders=[this.maskSourceFilter],this.maskSourceSprite.pluginName="filter_renderer",this.renderPending=!0},Rx.prototype.setOpacity=function(e){this.maskContainer.alpha=e},Rx.prototype.getHandleTouchSurface=function(){var e=new PIXI.Graphics;return e.interactive=!0,e.beginFill(16777215,0),e.drawCircle(0,0,20),e.endFill(),e},Rx.prototype.handleMainUIPreRender=function(e){this.renderPending&&(this.renderPending=!1,BFN.Stage.render(this.maskSourceSprite,this.maskTexture))},Rx.prototype.handleToolMouseOver=function(e){this.hovered=!0,this.toggleGuide(!0)},Rx.prototype.handleToolMouseOut=function(e){this.hovered=!1,this.dragging||this.toggleGuide(!1)},Rx.prototype.handleToolMouseDown=function(e){this.hovered||(this.keepGuidesOn=!0,this.handleToolMouseOver())},Rx.prototype.handlePositionDraggerDragging=function(e){this.updateMaskTransform()},Rx.prototype.handleOuterHandleDraggerDragging=function(e){var t,n=this.outerHandleDragger.item,i=this.maskGuide.getPointerPosition(BFN.MainUI.pointerEvent),r=i.x/this._scale,a=i.y/this._scale,o=Math.max(this.minSize/2,Math.min(this.maxSize/2,Math.sqrt(Math.pow(r,2)+Math.pow(a,2)))),s=this.outerHandleDragger.shiftKey;switch(s&&(t=this.focusH/this.focusW),n.id){case"left":this.focusR=Math.atan2(a,r)-Math.PI,this.focusW=2*o,this.focusH=s?this.focusW*t:this.focusH;break;case"top":this.focusR=Math.atan2(a,r)+Math.PI/2,this.focusH=2*o,this.focusW=s?this.focusH/t:this.focusW;break;case"right":this.focusR=Math.atan2(a,r),this.focusW=2*o,this.focusH=s?this.focusW*t:this.focusH;break;case"bottom":this.focusR=Math.atan2(a,r)-Math.PI/2,this.focusH=2*o,this.focusW=s?this.focusH/t:this.focusW}this.updateMaskGuide(),this.updateMaskTransform()},Rx.prototype.handleInnerHandleDraggerDragging=function(e){var t=this.innerHandleDragger.item,n=this.maskGuide.getPointerPosition(BFN.MainUI.pointerEvent),i=n.x/this._scale,r=n.y/this._scale,a=Math.sqrt(Math.pow(i,2)+Math.pow(r,2));switch(t.id){case"left":case"right":this._hardness=Math.max(.1,Math.min(.9,a/(this.focusW/2)));break;case"top":case"bottom":this._hardness=Math.max(.1,Math.min(.9,a/(this.focusH/2)))}this.updateMaskGuide(),this.updateMaskDisplay()},Rx.prototype.handleRatioHandleDraggerDragging=function(e){var t=this.ratioHandleDragger.item,n=this.maskGuide.getPointerPosition(BFN.MainUI.pointerEvent),i=n.x/this._scale/this._hardness,r=n.y/this._scale/this._hardness,a=Math.sqrt(Math.pow(i,2)+Math.pow(r,2));a=Math.max(this.minSize/2,Math.min(this.maxSize/2,a-this.ratioHandleDistance/this._hardness));var o,s=this.ratioHandleDragger.shiftKey;switch(s&&(o=this.focusH/this.focusW),t.id){case"left":this.focusR=Math.atan2(r,i)-Math.PI,this.focusW=2*a,this.focusH=s?this.focusW*o:this.focusH;break;case"top":this.focusR=Math.atan2(r,i)+Math.PI/2,this.focusH=2*a,this.focusW=s?this.focusH/o:this.focusW;break;case"right":this.focusR=Math.atan2(r,i),this.focusW=2*a,this.focusH=s?this.focusW*o:this.focusH;break;case"bottom":this.focusR=Math.atan2(r,i)-Math.PI/2,this.focusH=2*a,this.focusW=s?this.focusH/o:this.focusW}this.updateMaskGuide(),this.updateMaskTransform()},Rx.prototype.handleDraggingStarted=function(e){this.dragging=!0,this.hovered||(this.keepGuidesOn=!0,this.handleToolMouseOver())},Rx.prototype.handleDraggingComplete=function(e){this.dragging=!1,this.hovered||this.toggleGuide(!1)},Rx.prototype.handleKeyDown=function(e){if(32==e.keyCode&&this.hovered&&this.guideVisible){var t=this.keepGuidesOn;this.keepGuidesOn=!1,this.toggleGuide(!1),this.keepGuidesOn=t}},Rx.prototype.handleKeyUp=function(e){32==e.keyCode&&this.hovered&&!this.guideVisible&&this.toggleGuide(!0)},Object.defineProperty(Rx.prototype,"scale",{set:function(e){this._scale=e,this.positionDragger.scale=this._scale,this.updateMaskGuide()},get:function(){return this._scale}}),Object.defineProperty(Rx.prototype,"maskMode",{set:function(e){"radial"!=e&&"square"!=e&&"linear"!=e||e==this._maskMode||(this._maskMode=e,this.updateMaskGuide(),this.updateMaskTransform(),this.updateMaskDisplay())},get:function(){return this._maskMode}}),Object.defineProperty(Rx.prototype,"maskTarget",{set:function(e){this._maskTarget&&(this._maskTarget.mask=null,this._maskTarget=null),this._maskTarget=e,this._maskTarget.mask=this.maskSprite},get:function(){return this._maskTarget}}),Object.defineProperty(Rx.prototype,"draggerActive",{get:function(){return this.positionDragger.dragging||this.outerHandleDragger.dragging||this.innerHandleDragger.dragging||this.ratioHandleDragger.dragging}}),BFN.FunkyMask=Rx,Ax.prototype=Object.create(PIXI.Sprite.prototype),Ax.prototype.init=function(){BeFunky.log("ImageFocus Init"),this.initDefaultValues(),this.initImageContainer(),this.initFilterSprite(),this.initRenderSprite(),this.initOpacitySprite(),this.initSourceSprite(),this.initFunkyMask(),BFN.AppModel.appReady?BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this)):BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,function(e){BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRender.bind(this))}.bind(this))},Ax.prototype.initDefaultValues=function(){this.sourceTexture=null,this.renderTexture=null,this._inverse=!1,this._scale=1,this.mosaicSegments={minX:0,maxX:0,minY:0,maxY:0},this.renderPending=!1,this.blurFilter=new BFN.filters.FastBlurWrapper(null,null,!1),this.pixelateFilter=new BFN.filters.PixelateFilter,this.grayFilter=new BFN.filters.GrayFilter},Ax.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Ax.prototype.initFilterSprite=function(){this.filterMinBlur=0,this.filterMaxBlur=0,this.filterMaxSize=1024,this.filterSprite=new PIXI.Sprite},Ax.prototype.initRenderSprite=function(){this.renderSprite=new PIXI.Sprite,this.renderSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.renderSprite)},Ax.prototype.initOpacitySprite=function(){this.opacitySprite=new PIXI.Sprite,this.opacitySprite.pluginName="smooth_picture",this.opacitySprite.alpha=0,this.imageContainer.addChild(this.opacitySprite)},Ax.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Ax.prototype.initFunkyMask=function(){this.funkyMask=new BFN.FunkyMask,this.funkyMask.maskTarget=this.sourceSprite,this.imageContainer.addChild(this.funkyMask)},Ax.prototype.handleFocus=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS){var e=UITools.getToolVO("funky_focus"),t=[];if(this.funkyMask.maskMode!=e.mode&&(this.funkyMask.maskMode=e.mode),e.grayscale&&t.push(this.grayFilter),e.mosaic){var n=1-Math.max(0,Math.min(1,e.blur_amount/100));this.pixelateFilter.segmentsX=Math.round((this.mosaicSegments.maxX-this.mosaicSegments.minX)*n+this.mosaicSegments.minX),this.pixelateFilter.segmentsY=Math.round((this.mosaicSegments.maxY-this.mosaicSegments.minY)*n+this.mosaicSegments.minY),t.push(this.pixelateFilter)}else{"blur_amount"==e.updating_id&&e.updating?BFN.StageModel.setRefreshFactor(.25):BFN.StageModel.setRefreshFactor(1);var i=this.blurFilter.apply(e.blur_amount/100);i.length&&t.push(i[0])}this._inverse!=e.inverse&&(this._inverse=e.inverse,this.imageContainer.addChildAt(this.opacitySprite,0),this._inverse?(this.imageContainer.addChildAt(this.sourceSprite,0),this.funkyMask.maskTarget=this.renderSprite,this.opacitySprite.texture=this.renderSprite.texture):(this.imageContainer.addChildAt(this.renderSprite,0),this.funkyMask.maskTarget=this.sourceSprite,this.opacitySprite.texture=this.sourceSprite.texture)),this.opacitySprite.alpha=this._inverse?0:Math.max(0,Math.min(1,1-e.opacity/100)),this.funkyMask.setOpacity(this._inverse?e.opacity/100:1),this.filterSprite.filters=t,this.renderPending=!0,BFN.MainUI.requestRender()}},Ax.prototype.setSourceTexture=function(e){(null!=this.filterTexture&&(this.filterTexture.destroyGC(!0),this.filterTexture=null),null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.renderTexture&&(this.renderTexture.destroyGC(!0),this.renderTexture=null),this.opacitySprite.texture=null,e)?(this.sourceTexture=e,this.renderTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.renderTexture.copyPixels(this.sourceTexture),this.filterScale=Math.min(1,this.filterMaxSize/this.sourceTexture.width,this.filterMaxSize/this.sourceTexture.height),this.filterMinBlur=Math.min(Math.floor(this.sourceTexture.width*this.filterScale)/this.filterMaxSize,Math.floor(this.sourceTexture.height*this.filterScale)/this.filterMaxSize)/4,this.filterMaxBlur=1*Math.min(Math.floor(this.sourceTexture.width*this.filterScale)/this.filterMaxSize,Math.floor(this.sourceTexture.height*this.filterScale)/this.filterMaxSize),this.renderSprite.texture=this.renderTexture,this.sourceSprite.texture=this.sourceTexture,this.filterSprite.texture=this.sourceTexture,this.opacitySprite.texture=this._inverse?this.renderTexture:this.sourceTexture,this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.pixelateFilter.textureW=this.sourceTexture.width,this.pixelateFilter.textureH=this.sourceTexture.height,Math.min(this.sourceTexture.width,this.sourceTexture.height)==this.sourceTexture.width?(this.mosaicSegments.minX=Math.min(8,this.sourceTexture.width),this.mosaicSegments.maxX=Math.min(64,this.sourceTexture.width),this.segmentRange=this.mosaicSegments.maxX-this.mosaicSegments.minX,this.ratio=this.sourceTexture.height/this.sourceTexture.width,this.mosaicSegments.minY=Math.max(1,Math.round(this.mosaicSegments.minX*this.ratio)),this.mosaicSegments.maxY=this.mosaicSegments.minY+Math.round(this.segmentRange*this.ratio)):(this.mosaicSegments.minY=Math.min(8,this.sourceTexture.height),this.mosaicSegments.maxY=Math.min(64,this.sourceTexture.height),this.segmentRange=this.mosaicSegments.maxY-this.mosaicSegments.minY,this.ratio=this.sourceTexture.width/this.sourceTexture.height,this.mosaicSegments.minX=Math.max(1,Math.round(this.mosaicSegments.minY*this.ratio)),this.mosaicSegments.maxX=this.mosaicSegments.minX+Math.round(this.segmentRange*this.ratio)),this.funkyMask.setup(this.sourceTexture.width,this.sourceTexture.height,.8),this.resetControls()):this.funkyMask.reset()},Ax.prototype.resetControls=function(){var e=UITools.getToolVO("funky_focus").defaultValues;for(var t in e)UITools.setToolValue("funky_focus",t,e[t]);UITools.updateToolControls("funky_focus")},Ax.prototype.setSmoothingScale=function(e){this.renderSprite.currentScale=e,this.opacitySprite.currentScale=e,this.sourceSprite.currentScale=e},Ax.prototype.handleMainUIPreRender=function(e){this.renderPending&&BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS&&(this.renderPending=!1,BFN.Stage.render(this.filterSprite,this.renderTexture))},Object.defineProperty(Ax.prototype,"toolScale",{set:function(e){this._scale=e,this.funkyMask.scale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Ax.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1);var t=this.funkyMask.guideVisible;return this.funkyMask.toggleGuide(!1,!0),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.funkyMask.toggleGuide(t,!0),e}}),Object.defineProperty(BFN,"ImageFocus",{get:function(){return!BFN._ImageFocus&&(BFN._ImageFocus=new Ax),BFN._ImageFocus}}),Vx.prototype=Object.create(PIXI.Sprite.prototype),Vx.prototype.init=function(){BeFunky.log("ImageVignette Init"),this.initDefaultValues(),this.initImageContainer(),this.initBlendModeSprite(),this.initSourceSprite(),this.initColorSurface(),this.initFunkyMask()},Vx.prototype.initDefaultValues=function(){this.sourceTexture=null,this._scale=1,this._vignetteColor=-1,this.forceDisplayUpdate=!1},Vx.prototype.initImageContainer=function(){this.imageContainer=new PIXI.Sprite,this.addChild(this.imageContainer)},Vx.prototype.initBlendModeSprite=function(){this.blendModeSprite=new BFN.BlendModeSprite(!1),this.blendModeSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.blendModeSprite)},Vx.prototype.initSourceSprite=function(){this.sourceSprite=new PIXI.Sprite,this.sourceSprite.pluginName="smooth_picture",this.imageContainer.addChild(this.sourceSprite)},Vx.prototype.initColorSurface=function(){this.colorSurfaceTexture=null},Vx.prototype.initFunkyMask=function(){this.funkyMask=new BFN.FunkyMask,this.funkyMask.maskTarget=this.sourceSprite,this.funkyMask.showOuterHandles=!1,this.funkyMask.showRatioHandles=!0,this.imageContainer.addChild(this.funkyMask)},Vx.prototype.handleVignette=function(){if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE){var e=UITools.getToolVO("funky_vignette");"clear"==e.updating_id&&(this.resetControls(),e=UITools.getToolVO("funky_vignette")),this.funkyMask.maskMode!=e.mode&&(this.funkyMask.maskMode=e.mode),this.blendModeSprite.setBlendMode(parseInt(e.blend_mode)),this.blendModeSprite.setBlendIntensity(e.opacity),this.colorSurfaceTexture&&this._vignetteColor!="0x"+e.color&&(this._vignetteColor="0x"+e.color,this._vignetteColor,this.colorSurfaceTexture.fillColor(this._vignetteColor)),this.forceDisplayUpdate?(this.forceDisplayUpdate=!1,this.blendModeSprite.renderDisplay()):this.blendModeSprite.updateDisplay()}},Vx.prototype.setSourceTexture=function(e){null!=this.sourceTexture&&(this.sourceTexture=null,this.sourceSprite.texture=PIXI.Texture.EMPTY),null!=this.colorSurfaceTexture&&(this.colorSurfaceTexture.destroyGC(!0),this.colorSurfaceTexture=null),this._vignetteColor=-1,this.blendModeSprite.autoRender=!1,this.blendModeSprite.setBlendMode(null),this.blendModeSprite.setBaseTexture(null),this.blendModeSprite.setBlendTexture(null),e?(this.sourceTexture=e,this.sourceSprite.texture=this.sourceTexture,this.colorSurfaceTexture=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height),this.blendModeSprite.autoRender=!0,this.blendModeSprite.setBaseTexture(this.sourceTexture),this.blendModeSprite.setBlendTexture(this.colorSurfaceTexture),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.resetControls()):this.funkyMask.reset()},Vx.prototype.resetControls=function(){this.sourceTexture&&(this.imageDiagonal=Math.sqrt(Math.pow(this.sourceTexture.width,2)+Math.pow(this.sourceTexture.height,2)),this.funkyMask.setup(this.sourceTexture.width,this.sourceTexture.height,1),this.funkyMask._hardness=.2,this.funkyMask.focusW=this.funkyMask.focusH=this.imageDiagonal,this.funkyMask.updateMaskGuide(),this.funkyMask.updateMaskTransform(),this.funkyMask.updateMaskDisplay(),this.forceDisplayUpdate=!0);var e=UITools.getToolVO("funky_vignette").defaultValues;for(var t in e)"mode"!=t&&UITools.setToolValue("funky_vignette",t,e[t]);UITools.setToolValue("funky_vignette","blend_mode",BFN.CONST.BLEND_MODES.NORMAL),UITools.updateToolControls("funky_vignette")},Vx.prototype.setSmoothingScale=function(e){this.blendModeSprite.currentScale=e,this.sourceSprite.currentScale=e},Object.defineProperty(Vx.prototype,"toolScale",{set:function(e){this._scale=e,this.funkyMask.scale=this._scale,this.setSmoothingScale(this._scale)},get:function(){return this._scale}}),Object.defineProperty(Vx.prototype,"modifiedTexture",{get:function(){var e=PIXI.RenderTexture.create(this.sourceTexture.width,this.sourceTexture.height);this.imageContainer.x=0,this.imageContainer.y=0,this.setSmoothingScale(1);var t=this.funkyMask.guideVisible;return this.funkyMask.toggleGuide(!1,!0),BFN.Stage.render(this.imageContainer,e),this.imageContainer.x=-Math.round(this.sourceTexture.width/2),this.imageContainer.y=-Math.round(this.sourceTexture.height/2),this.setSmoothingScale(this._scale),this.funkyMask.toggleGuide(t),e}}),Object.defineProperty(BFN,"ImageVignette",{get:function(){return!BFN._ImageVignette&&(BFN._ImageVignette=new Vx),BFN._ImageVignette}}),Ux.prototype=Object.create(PIXI.Container.prototype),Ux.prototype.init=function(){BeFunky.log("TransformFrame Init"),this.initDefaultValues(),this.initImageSprite(),this.initFrameSprite()},Ux.prototype.initDefaultValues=function(){this.texture=null,this.baseTexture=null},Ux.prototype.initImageSprite=function(){this.imageSprite=new PIXI.Sprite,this.imageSprite.tint=8421504},Ux.prototype.initFrameSprite=function(){this.frameSprite=new BFN.FrameSprite,this.frameSprite.updateDisplayCallback=this.updateDisplayCallback.bind(this),this.addChild(this.frameSprite)},Ux.prototype.setTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.texture=e,this.baseTexture=null,e&&e.baseTexture&&(this.baseTexture=e.baseTexture,this.imageSprite.texture=new PIXI.Texture(this.baseTexture),this.frameSprite.setTexture(e))},Ux.prototype.updateDisplay=function(){this.frameSprite.updateDisplay()},Ux.prototype.updateDisplayCallback=function(){this.baseTexture&&(this.imageSprite.scale.x=this.frameSprite.width/this.frameSprite.textureFrame.width,this.imageSprite.scale.y=this.frameSprite.height/this.frameSprite.textureFrame.height,this.imageSprite.x=-(this.imageSprite.width-this.frameSprite.width)*this.frameSprite.offsetFactorX,this.imageSprite.y=-(this.imageSprite.height-this.frameSprite.height)*this.frameSprite.offsetFactorY)},Ux.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.baseTexture=null,this.removeChild(this.frameSprite),this.frameSprite.destroy(e),this.removeChild(this.imageSprite),this.imageSprite.destroy(!1)},Object.defineProperty(Ux.prototype,"frameWidth",{set:function(e){this.frameSprite.frameWidth=e},get:function(){return this.frameSprite.frameWidth}}),Object.defineProperty(Ux.prototype,"frameHeight",{set:function(e){this.frameSprite.frameHeight=e},get:function(){return this.frameSprite.frameHeight}}),Object.defineProperty(Ux.prototype,"offsetFactorX",{set:function(e){this.frameSprite.offsetFactorX=e},get:function(){return this.frameSprite.offsetFactorX}}),Object.defineProperty(Ux.prototype,"offsetFactorY",{set:function(e){this.frameSprite.offsetFactorY=e},get:function(){return this.frameSprite.offsetFactorY}}),Object.defineProperty(Ux.prototype,"textureScale",{set:function(e){this.frameSprite.textureScale=e},get:function(){return this.frameSprite.textureScale}}),Object.defineProperty(Ux.prototype,"textureScaleX",{set:function(e){this.frameSprite.textureScaleX=e},get:function(){return this.frameSprite.textureScaleX}}),Object.defineProperty(Ux.prototype,"textureScaleY",{set:function(e){this.frameSprite.textureScaleY=e},get:function(){return this.frameSprite.textureScaleY}}),Object.defineProperty(Ux.prototype,"adjustScale",{get:function(){return this.frameSprite.adjustScale}}),Object.defineProperty(Ux.prototype,"excessX",{get:function(){return this.frameSprite.excessX}}),Object.defineProperty(Ux.prototype,"excessY",{get:function(){return this.frameSprite.excessY}}),Object.defineProperty(Ux.prototype,"width",{get:function(){return this.frameSprite.width*this.scale.x}}),Object.defineProperty(Ux.prototype,"height",{get:function(){return this.frameSprite.height*this.scale.y}}),Object.defineProperty(Ux.prototype,"pluginName",{set:function(e){this.imageSprite.pluginName=e,this.frameSprite.pluginName=e},get:function(){return this.frameSprite.pluginName}}),Object.defineProperty(Ux.prototype,"currentScale",{set:function(e){this.imageSprite.currentScale=e,this.frameSprite.currentScale=e},get:function(){return this.frameSprite.currentScale}}),Object.defineProperty(Ux.prototype,"currentScaleY",{set:function(e){this.imageSprite.currentScaleY=e,this.frameSprite.currentScaleY=e},get:function(){return this.frameSprite.currentScaleY}}),Object.defineProperty(Ux.prototype,"blendMode",{set:function(e){this.frameSprite.blendMode=e},get:function(){return this.frameSprite.blendMode}}),Object.defineProperty(Ux.prototype,"smoothEdges",{set:function(e){this.imageSprite.smoothEdges=e,this.frameSprite.smoothEdges=e},get:function(){return this.frameSprite.smoothEdges}}),Object.defineProperty(Ux.prototype,"fillColor",{set:function(e){this.frameSprite.fillColor=e},get:function(){return this.frameSprite.fillColor}}),Object.defineProperty(Ux.prototype,"intensity",{set:function(e){this.frameSprite.intensity=e},get:function(){return this.frameSprite.intensity}}),Object.defineProperty(Ux.prototype,"tint",{set:function(e){this.frameSprite.tint=e},get:function(){return this.frameSprite.tint}}),BFN.TransformFrame=Ux,BFN.TransformItemEvents={ITEM_DISPLAY_UPDATED:new Event("ITEM_DISPLAY_UPDATED"),GET_SNAP_COORDINATES:new Event("GET_SNAP_COORDINATES"),PRESS_ITEM:new Event("PRESS_ITEM"),SELECT_ITEM:new Event("SELECT_ITEM"),DESELECT_ITEM:new Event("DESELECT_ITEM"),DUPLICATE_ITEM:new Event("DUPLICATE_ITEM"),REMOVE_ITEM:new Event("REMOVE_ITEM"),DESTROY_ITEM:new Event("DESTROY_ITEM"),REGISTER_TRANSITION:new Event("REGISTER_TRANSITION"),TRANSITION_APPLIED:new Event("TRANSITION_APPLIED"),TEXT_DISPLAY_UPDATED:new Event("TEXT_DISPLAY_UPDATED"),ACCURATE_BOUNDS_UPDATED:new Event("ACCURATE_BOUNDS_UPDATED"),THUMB_UPDATED:new Event("THUMB_UPDATED")},BFN.TransformItemTextBaseFontSize=20,BFN.TransformItemTextBaseLineHeight=1.05,BFN.TransformItemTextStrokePercentMin=.005,BFN.TransformItemTextStrokePercentMax=.15,BFN.TransformItemTextStrokePercentDefault=.07676767677,Gx.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Gx.prototype.init=function(){BeFunky.log("TransformItem Init"),this.initDefaultValues(),this.initItemContent(),this.initLongPressValues(),this.updateSmoothingScale(),this.initialized=!0},Gx.prototype.initDefaultValues=function(){switch(this.interactive=!0,this.buttonMode=!0,this.hitArea=new PIXI.Polygon,this.textMaskMaxSize=2048,this.mouseChildren=!1,this.updateProjectItemVO=BeFunky.debounce(this.updateProjectItemVO.bind(this),10),this.isTemplateItem=BFN.ProjectManager.sourceTemplateLoading,this.isGoodie=!!this.itemObject.hasOwnProperty("isGoodie")&&this.itemObject.isGoodie,this.graphicStyle=this.itemObject.graphicStyle,this.isShape=!1,this.fabricShape=null,this.selectedByMouse=!1,this.flippedHorizontal=!1,this.flippedVertical=!1,this.transforming=!1,this.accurateBounds=null,this.snapCoordinates=[],this.otherItemAccurateBoundsList=[],this.snapGapRects={},this.destroyed=!1,this.zIndexUpdating=!1,this.zIndexStart=null,this.bounds=new PIXI.Rectangle,this.itemBoundsData=null,this.itemGroupData={},this.transitionVO=null,this.lastTransitionVO=null,this.currentTransformItemStateVO=null,this._align=null,this._borderEnabled=!1,this._overlayColorEnabled=!1,this._overlayColor=-1,this._overlayColorIntensity=0,this._tintColorEnabled=!1,this._tintColor=-1,this._locked=!1,this._isTransparent=void 0,this.shapeUpdatePending=!1,this.textUpdatePending=!1,this.textPadding=BFN.TransformItemTextBaseFontSize,this.fontSizeNormalizeFactor=1,this.textBackgroundEnabled=!1,this.textBackgroundColor=-1,this.textBackgroundIntensity=1,this.textBackgroundPadding=20,this.thumbTexture=null,this.thumbImage=null,this.presetItemThumbTextures=[],this.itemMoved=!1,this.preventEditText=!1,this.preventBaseTextureDestroy=!1,this.debugAccurateBounds=!1,this.ignoreAccurateBounds=this.itemObject.hasOwnProperty("projectItemVO"),this.accurateBoundsTimer=0,this.accurateBoundsRequested=!1,this.accurateBoundsIndervalID=null,this.transformTool=null,this.model=null,this.canvasModel=null,this.canvasModelEvents=null,this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:this.transformTool=BFN.PhotoEditorCanvas.transformTool,this.model=BFN.PhotoEditorModel,this.canvasModel=BFN.PhotoEditorCanvasModel,this.canvasModelEvents=BFN.PhotoEditorCanvasModelEvents;break;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:this.transformTool=BFN.CollageMakerCanvas.transformTool,this.model=BFN.CollageMakerModel,this.canvasModel=BFN.CollageMakerCanvasModel,this.canvasModelEvents=BFN.CollageMakerCanvasModelEvents;break;case BFN.AppModelViewStates.VIEWING_DESIGNER:this.transformTool=BFN.DesignerCanvas.transformTool,this.model=BFN.DesignerModel,this.canvasModel=BFN.DesignerCanvasModel,this.canvasModelEvents=BFN.DesignerCanvasModelEvents}if(this.projectVO=this.itemObject.hasOwnProperty("projectVO")?this.itemObject.projectVO:this.model.projectVO,this.basicShapeVO=this.itemObject.hasOwnProperty("basicShapeVO")?this.itemObject.basicShapeVO:null,this.itemID="item_".concat(BeFunky.randomString(10)),this.projectItemVOMutable=!0,this.itemObject.hasOwnProperty("projectItemVO"))this.projectItemVO=this.itemObject.projectItemVO,!this.itemObject.isDuplicate&&this.projectItemVO.itemID||(this.projectItemVO.itemID="item_".concat(BeFunky.randomString(10))),this.projectItemVO.itemID&&(this.itemID=this.projectItemVO.itemID);else{switch(this.projectItemVO=new BFN.ProjectItemVO,this.projectItemVO.itemID="item_".concat(BeFunky.randomString(10)),this.itemID="item_".concat(BeFunky.randomString(10)),this.projectItemVO.itemID=this.itemID,this.itemObject.type){case"text":this.projectItemVO.type="label",this.projectItemVO.labelWordBreaksEnabled=!0;break;case"texture":this.itemObject.texture?this.projectItemVO.type=this.itemObject.texture.baseTexture.hasOwnProperty("fabricShape")?"graphic":"image":this.projectItemVO.type=this.basicShapeVO?"graphic":"image";break;case"frame_texture":this.projectItemVO.type="mask_image"}if(this.itemObject.hasOwnProperty("projectItemAssetID"))switch(this.projectItemVO.type){case"graphic":this.projectItemVO.graphicID=this.itemObject.projectItemAssetID;break;case"image":this.projectItemVO.imageID=this.itemObject.projectItemAssetID;break;case"mask_image":this.projectItemVO.maskImageID=this.itemObject.projectItemAssetID}}this.graphicStyle&&(this.projectItemVO.graphicStyle=this.graphicStyle),this.projectItemVO.thumbImageSRC&&(this.thumbImageSRC=this.projectItemVO.thumbImageSRC,this.thumbImageSRCPending=!1,delete this.projectItemVO.thumbImageSRC),this.maskFlippedHorizontal=this.projectItemVO.maskImageMaskFlippedHorizontal,this.maskFlippedVertical=this.projectItemVO.maskImageMaskFlippedVertical,this.itemObject.hasOwnProperty("readyCallback")&&(this.readyCallback=this.itemObject.readyCallback,delete this.itemObject.readyCallback),this.handleMainUIPostPreRenderBind=this.handleMainUIPostPreRender.bind(this),this.handleCanvasScalingUpdatedBind=this.handleCanvasScalingUpdated.bind(this),this.canvasModel.addEventListener(this.canvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),this.queueShapeUpdate=BeFunky.debounce(this.queueShapeUpdate.bind(this),0),this.queueTextUpdate=BeFunky.debounce(this.queueTextUpdate.bind(this),0),this.updateHitArea=BeFunky.debounce(this.updateHitArea.bind(this),0),BFN.Util.addSetterCallback(this,"rotation",this.updateDropShadowTransform.bind(this)),BFN.Util.addSetterCallback(this.scale,"x",this.updateDropShadowTransform.bind(this)),BFN.Util.addSetterCallback(this.scale,"y",this.updateDropShadowTransform.bind(this))},Gx.prototype.initItemContent=function(){var e=this;switch(this.layerType=null,this.layerName=null,this.layerNum=-1,this.type=this.itemObject.type,this.type){case"texture":case"frame_texture":if(this.itemObject.texture&&this.itemObject.texture.baseTexture&&this.addPresetItemThumbTexture(this.itemObject.texture.baseTexture),this.layerType=this.isGoodie?this.basicShapeVO?"shape":"graphic":"image","frame_texture"===this.type)if(this.handleFrameDraggerDraggingBind=this.handleFrameDraggerDragging.bind(this),this.handleFrameDraggerDraggingCompleteBind=this.handleFrameDraggerDraggingComplete.bind(this),this.itemContent=new BFN.FrameSprite,this.itemContent.updateDisplayCallback=function(){e.resetTransparency()},this.itemObject.texture.baseTexture.isTemplateAsset=this.isTemplateItem,this.itemContent.setTexture(new PIXI.Texture(this.itemObject.texture.baseTexture)),this.itemObject.hasOwnProperty("projectItemVO")?(this.itemContent.frameWidth=this.projectItemVO.maskImageFrameWidth,this.itemContent.frameHeight=this.projectItemVO.maskImageFrameHeight,this.itemContent.textureScale=1,this.itemContent.offsetFactorX=this.projectItemVO.maskImageOffsetFactorX,this.itemContent.offsetFactorY=this.projectItemVO.maskImageOffsetFactorY,this.scale.x=this.projectItemVO.transformScaleX,this.scale.y=this.projectItemVO.transformScaleY,this.itemContent.scale.x=1/this.projectItemVO.transformScaleX,this.itemContent.scale.y=1/this.projectItemVO.transformScaleY):(this.itemContent.frameWidth=this.itemContent.texture.baseTexture.width,this.itemContent.frameHeight=this.itemContent.texture.baseTexture.height),this.itemContent.updateDisplay(),this.itemObject.hasOwnProperty("maskTexture")&&this.itemObject.maskTexture){var t=this.itemObject.maskTexture.baseTexture.hasOwnProperty("fabricShape");if(this.isShape=!!this.basicShapeVO||t,this.fabricShape=t?this.itemObject.maskTexture.baseTexture.fabricShape:null,this.isShape){if(this.fabricShape){var n=null;(this.itemObject.isDuplicate||this.itemObject.newShape)&&(n=function(){if(e.readyCallback){try{e.readyCallback(e)}catch(e){}delete e.readyCallback}e.itemObject.newShape&&delete e.itemObject.newShape,e.updateShapeTexture(),BFN.MainUI.requestRender()}),this.itemContentMask=new PIXI.Sprite(BFN.SVGManager.getTexture(this.fabricShape,n,{x:this.itemContent.frameWidth,y:this.itemContent.frameHeight})),this.itemContentMask.maskAlphaOnly=!0}else if(this.itemContentMask=new PIXI.Sprite(this.itemObject.maskTexture),this.itemContentMask.pluginName="smooth_picture",this.itemContentMask.maskAlphaOnly=!0,this.updateShapeTexture(),BFN.BasicShapeManager.strokeShapeTypes.includes(this.basicShapeVO.type)&&(this.borderBasicShapeVO=this.basicShapeVO.clone({stroke:-1}),this.itemContentBorder=new PIXI.Sprite,this.itemContentBorder.pluginName="blend_picture"),this.readyCallback){try{this.readyCallback(this)}catch(e){}delete this.readyCallback}}else this.itemContentMask=new PIXI.Sprite(this.itemObject.maskTexture),this.itemContentMask.pluginName="smooth_picture",this.updateShapeTexture()}else this.borderBasicShapeVO=new BFN.BasicShapeVO("rectangle",{fill:-1,stroke:-1}),this.itemContentBorder=new BFN.FrameBorder;else if(this.isShape=!1,this.itemObject.texture?(this.isShape=this.itemObject.texture.baseTexture.hasOwnProperty("fabricShape"),this.fabricShape=this.isShape?this.itemObject.texture.baseTexture.fabricShape:null):this.isShape=!!this.basicShapeVO,this.isShape){this.layerType=this.basicShapeVO?"shape":"graphic";var i=null,r=function(){if(i.baseTexture.isTemplateAsset=e.isTemplateItem,(!e.isGoodie||e.isGoodie&&!BFN.SVGManager.textureHasModifiedShapeColors(e.itemContent.texture)||e.thumbImageSRC)&&e.updateShapeTexture(!0,!0),e.thumbImageSRC)e.thumbTexture=null,e.thumbImage?e.thumbImage.src=e.thumbImageSRC:(e.thumbImage=new Image,e.thumbImage.src=e.thumbImageSRC),delete e.thumbImageSRC,delete e.thumbImageSRCPending;else{var t=BFN.TransformStateModel.getThumb(e),n=BFN.Util.getHTMLImage(t,null,!0);t.destroyGC(!0),e.thumbTexture&&(e.thumbTexture.destroyGC(!0),e.thumbTexture=null),e.thumbImage?e.thumbImage.src=n.src:(e.thumbImage=new Image,e.thumbImage.src=n.src)}e.updateContentDimensions(),e.updateSmoothingScale()};this.basicShapeVO?((i=PIXI.RenderTexture.create(this.basicShapeVO.shapeW,this.basicShapeVO.shapeH)).fillColor(0,0),this.thumbImageSRC&&(this.thumbImageSRCPending=!0),setTimeout(r,0)):(this.thumbImageSRC&&(this.thumbImageSRCPending=!0),i=BFN.SVGManager.getTexture(this.fabricShape,r)),this.itemContent=new PIXI.Sprite(i)}else this.itemObject.texture.baseTexture.isTemplateAsset=this.isTemplateItem,this.itemContent=new PIXI.Sprite(new PIXI.Texture(this.itemObject.texture.baseTexture));if(this.updateContentDimensions(),this.itemObject.hasOwnProperty("projectItemVO"))"frame_texture"===this.type&&(this.scale.x=this.projectItemVO.transformScaleX,this.scale.y=this.projectItemVO.transformScaleY);else if(this.itemObject.hasOwnProperty("initialDimensions")&&this.itemObject.initialDimensions)this.scale.x=this.itemObject.initialDimensions.x/this.itemContent.texture.baseTexture.width,this.scale.y=this.itemObject.initialDimensions.y/this.itemContent.texture.baseTexture.height;else if(this.itemObject.hasOwnProperty("initialScale")&&this.itemObject.initialScale)this.scale.x=this.itemObject.initialScale.x,this.scale.y=this.itemObject.initialScale.y;else{var a=Math.min(.5*this.itemObject.initialFrameWidth/this.itemContentW,.5*this.itemObject.initialFrameHeight/this.itemContentH);if(this.scale.x=this.scale.y=this.isShape?a:Math.min(1,a),!this.itemObject.projectItemVO&&"graphic"===this.projectItemVO.type&&this.basicShapeVO)switch(this.basicShapeVO.type){case"line":this.scale.y*=.2;break;case"arrow":this.scale.y*=.5}}this.updateFrameTextureDisplay(),this.resetFrameTextureScale();break;case"text":this.layerType="text";var o=this.itemObject.isDuplicate?"":this.itemObject.text||BeFunky.LanguageManager.getString("click_when_selected");this.iText=new fabric.TextboxPad(o,{left:0,top:0,textAlign:"left",fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,padding:10,lineHeight:BFN.TransformItemTextBaseLineHeight,wordBreaksEnabled:this.projectItemVO.labelWordBreaksEnabled}),this.iText.strokeWidth=0,this.iText.objectCaching=!1,this.iText.paintFirst="stroke",this.iText._styleProperties.push("strokePercent"),this.conformTextWidthToContent(this.iText),this.iText.selectable=!1,this.iText.hasBorders=!1,this.iText.hasControls=!1,this.defaultTextStyles={fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,fill:"rgb(0,0,0,1)",textBackgroundColor:"",stroke:"",strokeWidth:1,strokePercent:BFN.TransformItemTextStrokePercentDefault};for(var s=0;s<this.iText.text.length;s++)this.iText._extendStyles(s,this.defaultTextStyles);if(this.itemsAffectedByTextHeight=[],this.preChangeTextHeight=0,this.handleTextHeightChangedBind=this.handleTextHeightChanged.bind(this),this.iText.on("height:changed",this.handleTextHeightChangedBind),this.itemObject.hasOwnProperty("isDuplicate")&&this.itemObject.isDuplicate&&this.itemObject.hasOwnProperty("sourceTransformItem")&&this.itemObject.sourceTransformItem){var l=this.itemObject.sourceTransformItem;this.textScale=l.textScale,this.iText.width=l.iText.width,this.iText.scaleX=this.iText.scaleY=this.textScale,this.iTexture=l.iTexture.renderClone();var u=l.iText?l.iText.text.length:"_",c=l.getTextStyleData(),h=(c?"mixed"===c.fontSize?"mixed"===c.fontSizeStart?c.fontSizeMin:c.fontSizeStart:c.fontSize:"_")||"_";this.duplicateData={textLength:u,fontSize:h}}else{var d={backgroundEnabled:"textBackgroundEnabled",backgroundColor:"textBackgroundColor",backgroundIntensity:"textBackgroundIntensity",backgroundPadding:"textBackgroundPadding",outlineEnabled:"textOutlineEnabled",highlightEnabled:"textHighlightEnabled"};for(var m in BFN.FabricManager.userStyle.itemStyles)d.hasOwnProperty(m)&&(this.hasOwnProperty(d[m])||BFN.Util.hasPropertyDescriptor(this,d[m]))&&(this[d[m]]=BFN.FabricManager.userStyle.itemStyles[m]);for(var p in BFN.FabricManager.userStyle.globalStyles)this.iText[p]=BFN.FabricManager.userStyle.globalStyles[p];for(var g=0;g<this.iText.text.length;g++)this.iText._extendStyles(g,BFN.FabricManager.userStyle.charStyles),this.iText._extendStyles(g,{fontSize:BFN.TransformItemTextBaseFontSize});this.conformTextWidthToContent(this.iText),this.textScale=.5*this.itemObject.initialFrameWidth/this.iText.width,this.iText.scaleX=this.iText.scaleY=this.textScale;var f=this.iText.width*this.textScale,v=this.iText.height*this.textScale,y=Math.round(f+2*this.textPadding*this.textScale),x=Math.round(v+2*this.textPadding*this.textScale);this.iTexture=PIXI.RenderTexture.create(y,x)}this.itemContent=new PIXI.Sprite(this.iTexture),this.updateContentDimensions(),this.scale.x=this.scale.y=1}if(this.addChild(this.itemContent),this.itemContent.pluginName="blend_picture",this.itemContent.currentScale=1,this.itemContent.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.itemContent.smoothEdges=!0,this.itemBlendMode=BFN.CONST.BLEND_MODES.NORMAL,this.itemContentMask&&(this.addChild(this.itemContentMask),this.itemContent.mask=this.itemContentMask),this.itemContentBorder&&this.addChild(this.itemContentBorder),"text"===this.type&&(this.hiResTextReady=!1,this.hiResTextRect=new BFN.Rectangle,this.hiResTextTexture=PIXI.RenderTexture.create(16,16,PIXI.SCALE_MODES.LINEAR,BFN.HiResTextManager.enableRetinaScaling?2:1),this.hiResTextSprite=new PIXI.Sprite(this.hiResTextTexture),this.hiResTextSprite.interactive=!1,this.hiResTextSprite.visible=!1,this.hiResTextSprite.pluginName="blend_picture",this.hiResTextSprite.blendMode=BFN.CONST.BLEND_MODES.NORMAL,this.addChild(this.hiResTextSprite),BFN.HiResTextManager.showHiResTextHelpers&&(this.hiResTextHelper=new PIXI.Graphics,this.addChild(this.hiResTextHelper))),"text"!==this.type||this.itemObject.hasOwnProperty("isDuplicate")&&this.itemObject.isDuplicate||this.itemObject.hasOwnProperty("projectItemVO")||this.setTextWidth(this.itemContentW),this.shapeColorGroupsNum=0,this.shapeColorMap=null,this.shapeObjectFills=!1,this.isGoodie&&this.isShape&&"graphic"===this.layerType&&this.itemContent.texture&&this.itemContent.texture.baseTexture){var _=this.itemContent.texture.baseTexture;if(_.fabricShapeColorMap)for(var I in this.shapeColorMap=this.itemContent.texture.baseTexture.fabricShapeColorMap,this.itemContent.texture.baseTexture.fabricShapeColorMap)this.shapeColorGroupsNum=Math.max(this.shapeColorGroupsNum,parseInt(I)+1);_.fabricShape&&(this.shapeObjectFills=!!_.fabricShape.containsObjectFills)}if(this.shapeColorMap&&this.itemObject.isDuplicate&&this.itemObject.sourceTransformItem&&BFN.SVGManager.textureHasModifiedShapeColors(this.itemObject.sourceTransformItem.itemContent.texture)){var T=this.itemObject.sourceTransformItem.itemContent.texture.baseTexture.fabricShapeColorMap;for(var b in T){var S=T[b];if(this.shapeColorMap.hasOwnProperty(b)){var C=this.shapeColorMap[b];C.colorHash=S.colorHash,C.colorOpacity=S.colorOpacity}}}BFN.queuedDropShadowItems||(BFN.queuedDropShadowItems=[]),this.dropShadowVO=new BFN.DropShadowVO(this.projectItemVO.dropShadowValues),this.itemObject.isDuplicate&&this.itemObject.sourceTransformItem&&!this.itemObject.sourceTransformItem.itemContentShadow.isEmpty?(this.itemContentShadow=new BFN.TransformItemDropShadow(this.itemObject.sourceTransformItem.itemContentShadow.sourceTexture,this.itemObject.sourceTransformItem.itemContentShadow.shadowTexture),this.itemContentShadow.isDuplicate=!0):this.itemContentShadow=new BFN.TransformItemDropShadow,this.addChildAt(this.itemContentShadow,0),this.itemObject.hasOwnProperty("isDuplicate")&&delete this.itemObject.isDuplicate,this.itemObject.hasOwnProperty("sourceTransformItem")&&delete this.itemObject.sourceTransformItem,this.hoverDropFilter=new BFN.filters.ColorOverlayFilter,this.hoverDropFilter.roundingDisabled=!0,this.hoverDropFilter.color=2154751,this.handleHoverDropAnimatorUpdateBind=this.handleHoverDropAnimatorUpdate.bind(this),this.hoverDropAnimator=new BFN.Animator,this.hoverDropAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverDropAnimatorUpdateBind)},Gx.prototype.conformTextWidthToContent=function(e){e.width=Math.pow(2,14),e.initDimensions();for(var t=e._splitTextIntoLines(e.text).lines,n=0,i=0;i<t.length;i++)n=Math.ceil(Math.max(n,e.measureLine(i).width+1));e.width=n},Gx.prototype.pressItem=function(e){BFN.TransformItemEvents.PRESS_ITEM.targetItem=this,BFN.TransformItemEvents.PRESS_ITEM.externalPress=!0,BFN.TransformItemEvents.PRESS_ITEM.data={},BFN.TransformItemEvents.PRESS_ITEM.data.originalEvent=e,this.dispatchEvent(BFN.TransformItemEvents.PRESS_ITEM)},Gx.prototype.refreshItemThumb=function(){UILayers.handleItemsUpdated()},Gx.prototype.refreshItemName=function(){UILayers.handleItemsUpdated()},Gx.prototype.initLongPressValues=function(){this.longPressOccurred=!1,this.handlePointerDownBind=this.handlePointerDown.bind(this),this.on("pointerdown",this.handlePointerDownBind)},Gx.prototype.handlePointerDown=function(e){this.initiateLongPress()},Gx.prototype.initiateLongPress=function(){var e=this;this.longPressOccurred=!1;BFN.LongPressManager.initiateLongPress(function(t){e.longPressOccurred=!0,setTimeout(function(){e.longPressOccurred=!1},0),document.dispatchEvent(new MouseEvent(BeFunky.pointerup)),e.transformLayer.transformTool.gizmoDragger.dragging&&e.transformLayer.transformTool.gizmoDragger.stopDrag(),e.pressItem(t)})},Gx.prototype.selectItem=function(){this.dispatchEvent(BFN.TransformItemEvents.SELECT_ITEM)},Gx.prototype.deselectItem=function(){this.dispatchEvent(BFN.TransformItemEvents.DESELECT_ITEM)},Gx.prototype.duplicateItem=function(){this.dispatchEvent(BFN.TransformItemEvents.DUPLICATE_ITEM)},Gx.prototype.removeItem=function(){this.dispatchEvent(BFN.TransformItemEvents.REMOVE_ITEM)},Gx.prototype.destroyItem=function(){this.destroyed||(this.off("pointerdown",this.handlePointerDownBind),"text"===this.type&&this.iText&&this.iText.off("height:changed",this.handleTextHeightChangedBind),this.dispatchEvent(BFN.TransformItemEvents.DESTROY_ITEM))},Gx.prototype.updateAccurateBounds=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.debugAccurateBounds;if(this.currentTransformItemStateVO){var i=this.currentTransformItemStateVO;if(i.accurateBounds){if(this.accurateBounds=i.accurateBounds,!t)return n&&(console.log(this.layerName,"- State has Accurate Bounds, Skipping Recalculation"),console.log("")),this.updateHiResTextBounds(),this.shapeUpdatePending||this.textUpdatePending||this.updateDropShadowSource(),void this.dispatchEvent(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED);n&&console.log(this.layerName,"- State has Accurate Bounds, But Recalculating ( Alpha Bounds Forced )")}else this.accurateBounds=BFN.Util.getTransformItemBounds(this,!0),this.accurateBounds.minX=this.accurateBounds.minY=0,this.accurateBounds.maxX=this.accurateBounds.width,this.accurateBounds.maxY=this.accurateBounds.height,this.accurateBounds.centerX=this.accurateBounds.width/2,this.accurateBounds.centerY=this.accurateBounds.height/2;if(this.ignoreAccurateBounds)n&&(console.log(this.layerName,"- Accurate Bounds Ignored, Using Approximation from",i.accurateBounds?"state":"polygon"),console.log(""));else if(this.accurateBoundsTimer=10,this.projectItemVO.hasOwnProperty("labelBounds")&&(this.accurateBoundsTimer=0),this.accurateBoundsRequested)n&&(console.log(this.layerName,"- Accurate Bounds Already Requested, Ignoring Call..."),console.log(""));else{n&&console.log(this.layerName,"Countdown Starting"),this.accurateBoundsRequested=!0,BFN.accurateBoundsQueue.push(this);!function i(){if(BFN.accurateBoundsQueue.length&&BFN.accurateBoundsQueue[0]!==e)BFN.accurateBoundsQueue.includes(e)?setTimeout(i,0):e.accurateBoundsRequested=!1;else if(--e.accurateBoundsTimer>0)BFN.accurateBoundsQueue.includes(e)?setTimeout(i,0):e.accurateBoundsRequested=!1;else if(n&&console.log(e.layerName,"Countdown Complete"),BFN.accurateBoundsQueue.shift(),e.accurateBoundsRequested=!1,e.parent){if(e.currentTransformItemStateVO){var r=e.currentTransformItemStateVO;if(r.accurateBounds){if(e.accurateBounds=r.accurateBounds,!t)return n&&(console.log(e.layerName,"- State has Accurate Bounds, Skipping Recalculation"),console.log("")),e.updateHiResTextBounds(),e.shapeUpdatePending||e.textUpdatePending||e.updateDropShadowSource(),void e.dispatchEvent(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED);n&&console.log(e.layerName,"- State has Accurate Bounds, But Recalculating ( Alpha Bounds Forced )")}else n&&console.log(e.layerName,"- State has No Accurate Bounds, Calculating...");var a=BFN.Util.getTransformItemBounds(e),o=BFN.Util.getTransformItemTexture(e,a);if(o){n&&(console.log(e.layerName,"- Calculating Accurate Alpha Bounds Now..."),console.log(""));var s=1/Math.max(o.width/a.width,o.height/a.height);if(e.accurateBounds=BFN.Util.getAlphaBounds(o,null,s,!1,!1),o.clear(),o.resize(256,256),e.accurateBounds.noBounds){var l=BFN.Util.getTransformItemBounds(e,!0);e.accurateBounds.minX=e.accurateBounds.minY=0,e.accurateBounds.maxX=e.accurateBounds.width=l.width,e.accurateBounds.maxY=e.accurateBounds.height=l.height,e.accurateBounds.centerX=l.width/2,e.accurateBounds.centerY=l.height/2}if(r.accurateBounds=Object.assign({},e.accurateBounds),e.projectItemVO.hasOwnProperty("labelBounds")){var u=a.minX+e.accurateBounds.minX,c=a.minY+e.accurateBounds.minY,h=e.projectItemVO.labelBounds.x-u,d=e.projectItemVO.labelBounds.y-c;e.x+=h,e.y+=d,e.projectItemVO.transformX=e.x,e.projectItemVO.transformY=e.y,e.projectItemVO.labelBounds=null,delete e.projectItemVO.labelBounds,e.setTransitionStartState(),e.setTransitionEndState(),BFN.ProjectManager.requestLocalSave()}else if(e.projectItemVO.hasOwnProperty("positionOffsetVectors")){for(var m=0;m<e.projectItemVO.positionOffsetVectors.length;m++){var p=e.projectItemVO.positionOffsetVectors[m];e.x+=Math.cos(p.direction)*p.distance,e.y+=Math.sin(p.direction)*p.distance}e.projectItemVO.transformX=e.x,e.projectItemVO.transformY=e.y,e.projectItemVO.positionOffsetVectors.splice(0),e.projectItemVO.positionOffsetVectors=null,delete e.projectItemVO.positionOffsetVectors,e.setTransitionStartState(),e.setTransitionEndState(),BFN.ProjectManager.requestLocalSave()}e.updateHiResTextBounds(),e.updateDropShadowSource(),e.dispatchEvent(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED)}BFN.MainUI.requestRender()}}else n&&console.log(e.layerName,"No Parent, Aborting...")}()}}},Gx.prototype.updateSmoothingScale=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="frame_texture"!==this.type||this.canvasScaling?1:this.itemContent.adjustScale*this.itemContent.textureScaleX,i="frame_texture"!==this.type||this.canvasScaling?1:this.itemContent.adjustScale*this.itemContent.textureScaleY;this.itemContent.currentScale=(e?this.scale.x*Math.abs(this.itemContent.scale.x)*e:this.canvasScaling?1:this.scale.x*Math.abs(this.itemContent.scale.x)*this.canvasScale)*n,this.itemContent.currentScaleY=(e?this.scale.y*Math.abs(this.itemContent.scale.y)*e:this.canvasScaling?1:this.scale.y*Math.abs(this.itemContent.scale.y)*this.canvasScale)*i,this.itemContentBorder&&(this.itemContentBorder.currentScale=e?this.scale.x*Math.abs(this.itemContentBorder.scale.x)*e:this.canvasScaling?1:this.scale.x*Math.abs(this.itemContentBorder.scale.x)*this.canvasScale,this.itemContentBorder.currentScaleY=e?this.scale.y*Math.abs(this.itemContentBorder.scale.y)*e:this.canvasScaling?1:this.scale.y*Math.abs(this.itemContentBorder.scale.y)*this.canvasScale),this.itemContentShadow&&(this.itemContentShadow.smoothingScaleX=e?1/this.itemContentShadow.adjustScaleX*e:this.canvasScaling?1:1/this.itemContentShadow.adjustScaleX*this.canvasScale,this.itemContentShadow.smoothingScaleY=e?1/this.itemContentShadow.adjustScaleY*e:this.canvasScaling?1:1/this.itemContentShadow.adjustScaleY*this.canvasScale),t&&BFN.MainUI.requestRender()},Gx.prototype.updateContentDimensions=function(){this.itemContentW==this.itemContent.width&&this.itemContentH==this.itemContent.height||("text"===this.type?(this.itemContent.scale.x=Math.abs(this.itemContent.scale.x)*(this.flippedHorizontal?-1:1),this.itemContent.scale.y=Math.abs(this.itemContent.scale.y)*(this.flippedVertical?-1:1),this.itemContentW=this.itemContent.width-Math.round(2*this.textPadding*this.textScale),this.itemContentH=this.itemContent.height-Math.round(2*this.textPadding*this.textScale)):(this.itemContentW=this.itemContent.width,this.itemContentH=this.itemContent.height,this.basicShapeVO&&(this.itemContentW="frame_texture"===this.type?Math.round(this.basicShapeVO.shapeW/this.basicShapeVO.fitScale):100,this.itemContentH="frame_texture"===this.type?Math.round(this.basicShapeVO.shapeH/this.basicShapeVO.fitScale):100)),this.itemContentW=Math.abs(this.itemContentW),this.itemContentH=Math.abs(this.itemContentH),this.updateBounds())},Gx.prototype.updateBounds=function(){if(this.bounds=new PIXI.Rectangle(0,0,this.itemContentW,this.itemContentH),this.polygon=[new PIXI.Point(0,0),new PIXI.Point(this.itemContentW,0),new PIXI.Point(this.itemContentW,this.itemContentH),new PIXI.Point(0,this.itemContentH)],"text"===this.type){var e=this.textPadding*this.textScale;this.textPolygon=[new PIXI.Point(-e,-e),new PIXI.Point(this.itemContentW+e,-e),new PIXI.Point(this.itemContentW+e,this.itemContentH+e),new PIXI.Point(-e,this.itemContentH+e)]}this.updateHitArea()},Gx.prototype.updateHitArea=function(){var e=this;this.hitArea.points.splice(0);var t=10/this.canvasScale,n=this.itemContentW,i=this.itemContentH;this.itemContentBorder&&this.itemContentBorder.isFrameBorder&&(n+=2*this.itemContentBorder.thickness,i+=2*this.itemContentBorder.thickness);var r=this.itemContentW*this.scale.x,a=this.itemContentH*this.scale.y;if(r<t||a<t||!this.basicShapeVO||this.basicShapeVO&&!this.basicShapeVO.hitAreaPolygonPoints){var o,s=(r<t?(t-r)/2:0)/this.scale.x,l=(a<t?(t-a)/2:0)/this.scale.y,u=-s+(this.itemContentW-n)/2,c=-l+(this.itemContentH-i)/2,h=n+2*s,d=i+2*l;(o=this.hitArea.points).push.apply(o,[u,c,u+h,c,u+h,c+d,u,c+d])}else this.basicShapeVO.hitAreaPolygonPoints.forEach(function(t){e.hitArea.points.push(t.x/e.basicShapeVO.shapeW*e.itemContentW),e.hitArea.points.push(t.y/e.basicShapeVO.shapeH*e.itemContentH)})},Gx.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.destroyed){if(this.destroyPresetItemThumbTextures(),"frame_texture"===this.type&&(this.hoverDropAnimator.setAnimatorFactor(0),this.hoverDropAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverDropAnimatorUpdateBind),this.hoverDropAnimator=null,this.hoverDropFilter=null),this.canvasModel.removeEventListener(this.canvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdatedBind),!this.itemContent.texture.baseTexture.isPattern)try{this.itemContent.texture.destroyGC(!e.includes(this.itemContent.texture.baseTexture)&&!this.preventBaseTextureDestroy)}catch(e){}this.itemContent.destroy(!1),this.itemContentMask&&(this.itemContent.mask=null,this.itemContentMask.texture.destroyGC(!e.includes(this.itemContentMask.texture.baseTexture)),this.itemContentMask.destroy(!1),this.removeChild(this.itemContentMask)),this.itemContentBorder&&(this.itemContentBorder.texture&&this.itemContentBorder.texture!==PIXI.Texture.EMPTY&&this.itemContentBorder.texture.destroyGC(!0),this.itemContentBorder.destroy(!1),this.removeChild(this.itemContentBorder),this.itemContentBorder=null),this.itemContentShadow&&(this.itemContentShadow.destroy(),this.removeChild(this.itemContentShadow),this.itemContentShadow=null);try{"text"!==this.type&&(this.thumbTexture.destroyGC(!0),this.thumbImage.src=""),this.thumbTexture=null,this.thumbImage=null}catch(e){}this.removeChild(this.itemContent),this.itemContent=null,this.hiResTextTexture&&(this.hiResTextTexture.destroy(!0),this.hiResTextTexture=null),this.hiResTextSprite&&this.children.includes(this.hiResTextSprite)&&(this.hiResTextSprite.destroy(!1),this.removeChild(this.hiResTextSprite),this.hiResTextSprite=null),this.hiResTextHelper&&this.children.includes(this.hiResTextHelper)&&(this.removeChild(this.hiResTextHelper),this.hiResTextHelper=null),this.destroyed=!0}},Gx.prototype.updateHiResTextBounds=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(BFN.HiResTextManager.useHiResText)if("text"!==this.type||BFN.FabricManager.showingTransformItemIText||BFN.FabricManager.currentTextTransformItem===this&&!n)t&&t();else{t&&(this.updateHiResTextBoundsCallback=t),this.hiResTextReady=!1,this.toggleHiResText(!1);var i=BFN.HiResTextManager.hiResTextViewportBounds,r=this.globalTextPolygon,a=Math.max(i.left,Math.min(r[0].x,r[1].x,r[2].x,r[3].x)),o=Math.max(i.top,Math.min(r[0].y,r[1].y,r[2].y,r[3].y)),s=Math.min(i.right,Math.max(r[0].x,r[1].x,r[2].x,r[3].x)),l=Math.min(i.bottom,Math.max(r[0].y,r[1].y,r[2].y,r[3].y)),u=new BFN.Rectangle(a,o,s-a,l-o),c=this.toLocal(new PIXI.Point(Math.round(u.x),Math.round(u.y)),BFN.MainUI);this.hiResTextRect.globalX=Math.round(u.x),this.hiResTextRect.globalY=Math.round(u.y),this.hiResTextRect.x=c.x,this.hiResTextRect.y=c.y,this.hiResTextRect.width=Math.max(0,Math.ceil(u.width)),this.hiResTextRect.height=Math.max(0,Math.ceil(u.height)),BFN.HiResTextManager.showHiResTextHelpers&&(this.hiResTextHelper.x=this.hiResTextRect.x,this.hiResTextHelper.y=this.hiResTextRect.y,this.hiResTextHelper.rotation=-this.rotation,this.hiResTextHelper.scale.x=this.hiResTextHelper.scale.y=1/this.canvasScale/this.scale.x,this.hiResTextHelper.clear(),this.hiResTextRect.width&&this.hiResTextRect.height&&(this.hiResTextHelper.lineStyle(2,65280),this.hiResTextHelper.drawRect(0,0,this.hiResTextRect.width,this.hiResTextRect.height),this.hiResTextRect.width>10&&this.hiResTextRect.height>10&&(this.hiResTextHelper.lineStyle(1,65280),this.hiResTextHelper.drawRect(5,5,this.hiResTextRect.width-10,this.hiResTextRect.height-10)))),e&&!this.awaitingPreRender&&(this.awaitingPreRender=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.POST_PRE_RENDER.type,this.handleMainUIPostPreRenderBind))}else t&&t()},Gx.prototype.handleMainUIPostPreRender=function(){BFN.MainUI.removeEventListener(BFN.MainUIEvents.POST_PRE_RENDER.type,this.handleMainUIPostPreRenderBind),this.awaitingPreRender=!1,BFN.HiResTextManager.conformHiResTextCanvas(),this.renderHiResText(this.updateHiResTextBoundsCallback?this.updateHiResTextBoundsCallback:void 0),delete this.updateHiResTextBoundsCallback},Gx.prototype.updateHiResText=function(){},Gx.prototype.renderHiResText=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;BFN.HiResTextManager.useHiResText&&"text"===this.type&&this.hiResTextRect.width&&this.hiResTextRect.height&&!this.hiResTextReady&&(this.hiResTextTexture.resize(Math.ceil(this.hiResTextRect.width),Math.ceil(this.hiResTextRect.height)),BFN.HiResTextManager.showHiResTextHelpers&&this.hiResTextTexture.fillColor(128,.5),this.hiResTextSprite.x=this.hiResTextRect.x,this.hiResTextSprite.y=this.hiResTextRect.y,this.hiResTextSprite.rotation=-this.rotation,this.hiResTextSprite.scale.x=this.hiResTextSprite.scale.y=1/this.canvasScale/this.scale.x,BFN.HiResTextManager.conformITextToTransformItem(this),BFN.HiResTextManager.drawHiResTextToTransformItem(this),this.hiResTextReady=!0,this.toggleHiResText(!0),BFN.MainUI.requestRender()),e&&e()},Gx.prototype.toggleHiResText=function(e){if("text"===this.type){var t=!!(BFN.HiResTextManager.useHiResText&&this.hiResTextReady&&e),n=!([BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this)&&BFN.FabricManager.showingTransformItemIText);this.hiResTextSprite.visible=t&&n,this.itemContent.visible=!t&&n}},Gx.prototype.createTransition=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.transitionVO&&(this.transitionVO.id!=e||!this.transitionVO.isGroupTransition&&this.isGroupTransition)&&(this.lastTransitionVO=null),this.transitionVO=new BFN.TransformItemTransitionVO,this.transitionVO.id=e,this.transitionVO.transformItem=this,this.transitionVO.isCreateTransition=t,this.transitionVO.isGroupTransition=!!this.isGroupTransition,this.transitionVO.useGroupIcon=n,this.setTransitionStartState(),this.accurateBounds&&(this.transitionVO.startState.accurateBounds=Object.assign({},this.accurateBounds)),"text"===this.type&&this.iText&&this.updateItemsAffectedByTextHeight()},Gx.prototype.registerTransition=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.transitionVO){var n=this.dropShadowVO.enabled&&(this.itemContentShadow.isEmpty||this.dropShadowRequiresRefresh);this.transitionVO.startState.refreshDropShadow=n,this.transitionVO.endState.refreshDropShadow=n,this.setTransitionEndState(),this.currentTransformItemStateVO=this.transitionVO.endState,e?(this.lastTransitionVO?(this.currentTransformItemStateVO=this.lastTransitionVO.endState,this.updateStateVO(this.currentTransformItemStateVO)):(this.ignoreTextHeight||(this.transitionVO.batchIDPlaceholder=this.registerItemsAffectedByTextHeight()),this.lastTransitionVO=this.transitionVO,this.dispatchEvent(BFN.TransformItemEvents.REGISTER_TRANSITION)),t&&(this.currentTransformItemStateVO&&(this.currentTransformItemStateVO.accurateBounds=null),this.updateAccurateBounds())):(this.ignoreTextHeight||(this.transitionVO.batchIDPlaceholder=this.registerItemsAffectedByTextHeight()),this.lastTransitionVO=null,this.dispatchEvent(BFN.TransformItemEvents.REGISTER_TRANSITION),t?(this.currentTransformItemStateVO&&(this.currentTransformItemStateVO.accurateBounds=null),this.updateAccurateBounds()):this.currentTransformItemStateVO&&!this.currentTransformItemStateVO.accurateBounds&&this.transitionVO.startState.accurateBounds&&(this.debugAccurateBounds&&console.log(this.layerName,"- Applying startState Bounds to endState Bounds"),this.currentTransformItemStateVO.accurateBounds=Object.assign({},this.transitionVO.startState.accurateBounds)))}this.duplicateData&&delete this.duplicateData,this.updateProjectItemVO()},Gx.prototype.setTransition=function(e){this.transitionVO=e,this.lastTransitionVO=null},Gx.prototype.setTransitionStartState=function(){this.transitionVO&&this.updateStateVO(this.transitionVO.startState)},Gx.prototype.setTransitionEndState=function(){this.transitionVO&&this.updateStateVO(this.transitionVO.endState)},Gx.prototype.updateStateVO=function(e){this.parent&&(e.parent=this.parent,e.zIndex=this.parent.getChildIndex(this)),e.locked=this._locked,e.x=this.x,e.y=this.y,e.scaleX=this.scale.x,e.scaleY=this.scale.y,e.rotation=this.rotation,e.opacity=100*this.alpha,e.blendMode=this.itemBlendMode,e.tintEnabled=this.tintColorEnabled,e.tint=this.tintColor,e.overlayColorEnabled=this.overlayColorEnabled,e.overlayColor=this.overlayColor,e.overlayColorIntensity=this.overlayColorIntensity,e.flippedHorizontal=this.flippedHorizontal,e.flippedVertical=this.flippedVertical,e.dropShadowValues=this.dropShadowVO.getValues(),this.basicShapeVO&&(e.basicShapeValues=Object.assign({},this.basicShapeVO.getValues())),e.shapeColorMap=this.getShapeColorMap(),"text"===this.type&&(e.text=this.iText.text,e.textStyle=this.getTextStyle(),e.textWidth=this.iText.width,e.textScale=this.textScale,e.textItemScale=this.scale.x,e.textBackgroundEnabled=this.textBackgroundEnabled,e.textBackgroundColor=this.textBackgroundColor,e.textBackgroundIntensity=this.textBackgroundIntensity,e.textBackgroundPadding=this.textBackgroundPadding,e.textOutlineEnabled=this.textOutlineEnabled,e.textHighlightEnabled=this.textHighlightEnabled),"frame_texture"===this.type&&(e.imageID=this.projectItemVO.maskImageID,e.imageTexture=this.itemContent.texture,e.maskImageFrameWidth=this.itemContent.frameWidth,e.maskImageFrameHeight=this.itemContent.frameHeight,e.maskImageOffsetFactorX=this.itemContent.offsetFactorX,e.maskImageOffsetFactorY=this.itemContent.offsetFactorY,e.maskImageTextureScale={x:this.itemContent.textureScaleX,y:this.itemContent.textureScaleY},this.borderBasicShapeVO&&(e.borderEnabled=this._borderEnabled,e.borderValues={stroke:this.borderBasicShapeVO.stroke,strokeAlpha:this.borderBasicShapeVO.strokeAlpha,strokeWidth:this.borderBasicShapeVO.strokeWidth})),"texture"===this.type&&(e.imageID=this.projectItemVO.imageID,e.imageTexture=this.itemContent.texture)},Gx.prototype.getTransition=function(){return this.transitionVO},Gx.prototype.clearTransition=function(){this.lastTransitionVO=null},Gx.prototype.applyTransformItemState=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.currentTransformItemStateVO=e;try{e.parent&&-1!==e.parent.children.indexOf(this)&&e.parent.getChildIndex(this)!=e.zIndex?e.parent.setChildIndex(this,Math.min(this.parent.children.length-1,e.zIndex)):e.parent&&-1===e.parent.children.indexOf(this)?(e.parent.addChild(this),e.parent.setChildIndex(this,Math.min(this.parent.children.length-1,e.zIndex))):this.parent&&!e.parent&&this.parent.removeChild(this)}catch(e){BeFunky.log("LAYER ORDER ERROR")}this.locked=e.locked,this.updateValue(this,"x",e,"x"),this.updateValue(this,"y",e,"y"),this.updateValue(this.scale,"x",e,"scaleX"),this.updateValue(this.scale,"y",e,"scaleY"),this.updateValue(this,"rotation",e,"rotation"),this.alpha=e.opacity/100,this.tintColorEnabled=e.tintEnabled,this.tintColor=e.tint,this.overlayColorEnabled=e.overlayColorEnabled,this.overlayColor=e.overlayColor,this.overlayColorIntensity=e.overlayColorIntensity,this.setBlendMode(e.blendMode),this.basicShapeVO&&e.basicShapeValues&&this.basicShapeVO.setValues(e.basicShapeValues),this.setShapeColorMap(e.shapeColorMap,!1),this._borderEnabled=e.borderEnabled,this.borderBasicShapeVO&&e.borderValues&&this.borderBasicShapeVO.setValues(e.borderValues),this.dropShadowVO.setValues(e.dropShadowValues),["text","frame_texture"].includes(this.type)||this.shapeUpdatePending||(this.shapeUpdatePending=!0,this.queueShapeUpdate()),"text"===this.type&&(this.pendingTransformItemState=e,this.textUpdatePending||(this.textUpdatePending=!0,BFN.MainUI.rendering=!1,this.renderable=!1,this.queueTextUpdate())),"frame_texture"===this.type?(e.imageID&&this.projectItemVO.maskImageID!==e.imageID&&(this.projectItemVO.maskImageID=e.imageID),e.imageTexture&&this.itemContent.texture!==e.imageTexture&&(this.itemObject.texture=e.imageTexture,this.itemContent.setTexture(e.imageTexture),this.updateThumb()),this.itemContent.frameWidth=e.maskImageFrameWidth,this.itemContent.frameHeight=e.maskImageFrameHeight,this.itemContent.textureScaleX=e.maskImageTextureScale.x,this.itemContent.textureScaleY=e.maskImageTextureScale.y,this.itemContent.offsetFactorX=e.maskImageOffsetFactorX,this.itemContent.offsetFactorY=e.maskImageOffsetFactorY,this.itemContent.updateDisplay(),this.itemContentW=this.itemContent.frameWidth,this.itemContentH=this.itemContent.frameHeight,this.updateBounds(),this.updateSmoothingScale()):this.updateHitArea(),"texture"!==this.type||this.isGoodie||(e.imageID&&this.projectItemVO.imageID!==e.imageID&&(this.projectItemVO.imageID=e.imageID),e.imageTexture&&this.itemContent.texture!==e.imageTexture&&(this.itemObject.texture=e.imageTexture,this.itemContent.texture=e.imageTexture,this.updateThumb(),this.updateContentDimensions())),e.flippedHorizontal!=this.flippedHorizontal&&this.flipHorizontal(),e.flippedVertical!=this.flippedVertical&&this.flipVertical(),this.updateFrameTextureDisplay(),this.resetFrameTextureScale(),this.thumbImageSRC&&!this.thumbImageSRCPending&&(delete this.thumbImageSRC,delete this.thumbImageSRCPending),t&&(this.transitionVO=this.lastTransitionVO=null),this.dispatchEvent(BFN.TransformItemEvents.TRANSITION_APPLIED),this.shapeUpdatePending||this.updateSmoothingScale(),e.refreshDropShadow&&(!this.itemContentShadow.shadowStateID||this.itemContentShadow.shadowStateID&&this.itemContentShadow.shadowStateID!==this.currentTransformItemStateVO.id)?this.clearDropShadow():this.updateDropShadowDisplay(),this.updateAccurateBounds(),this.updateProjectItemVO(),this.model.updateProjectVO(),BFN.MainUI.requestRender()},Gx.prototype.updateValue=function(e,t,n,i){try{e[t]=n[i]}catch(e){}},Gx.prototype.updateProjectItemVO=function(){if(this.projectItemVO&&!BFN.ProjectManager.transformItemsPending){switch(this.projectItemVO.type){case"graphic":this.basicShapeVO&&(this.projectItemVO.basicShapeValues=this.basicShapeVO.getValues()),this.graphicStyle&&(this.projectItemVO.graphicStyle=this.graphicStyle),this.projectItemVO.shapeColorMap=this.getShapeColorMap();break;case"image":this.graphicStyle&&(this.projectItemVO.graphicStyle=this.graphicStyle);break;case"mask_image":"frame_texture"===this.type&&(this.projectItemVO.maskImageFrameWidth=this.itemContent.frameWidth,this.projectItemVO.maskImageFrameHeight=this.itemContent.frameHeight,this.projectItemVO.maskImageOffsetFactorX=this.itemContent.offsetFactorX,this.projectItemVO.maskImageOffsetFactorY=this.itemContent.offsetFactorY,this.projectItemVO.maskImageTextureScale={x:this.itemContent.textureScaleX,y:this.itemContent.textureScaleY},this.basicShapeVO&&(this.projectItemVO.basicShapeValues=this.basicShapeVO.getValues()),this.borderBasicShapeVO&&(this.projectItemVO.borderEnabled=this._borderEnabled,this.projectItemVO.borderValues={stroke:this.borderBasicShapeVO.stroke,strokeAlpha:this.borderBasicShapeVO.strokeAlpha,strokeWidth:this.borderBasicShapeVO.strokeWidth}));break;case"label":"text"===this.type&&(this.projectItemVO.labelText=this.iText.text,this.projectItemVO.labelTextStyles=this.getTextStyle(),this.projectItemVO.labelWidth=this.iText.width,this.projectItemVO.labelTextScale=this.textScale,this.projectItemVO.labelTextItemScale=this.scale.x,this.projectItemVO.labelTextBackgroundEnabled=this.textBackgroundEnabled,this.projectItemVO.labelTextBackgroundColor=this.textBackgroundColor,this.projectItemVO.labelTextBackgroundIntensity=this.textBackgroundIntensity,this.projectItemVO.labelTextBackgroundPadding=this.textBackgroundPadding,this.projectItemVO.labelTextOutlineEnabled=this.textOutlineEnabled,this.projectItemVO.labelTextHighlightEnabled=this.textHighlightEnabled,this.projectItemVO.labelWordBreaksEnabled=this.iText.wordBreaksEnabled);break;default:return}this.projectItemVO.dropShadowValues=this.dropShadowVO.getValues(),this.projectItemVO.layerName=this.layerName,this.projectItemVO.layerNum=this.layerNum,this.parent&&(this.projectItemVO.transformZIndex=this.parent.getChildIndex(this)),this.projectItemVO.isGoodie=this.isGoodie,this.projectItemVO.transformLocked=this._locked,this.projectItemVO.transformX=this.x,this.projectItemVO.transformY=this.y,this.projectItemVO.transformRotation=this.rotation,this.projectItemVO.transformScaleX=this.scale.x,this.projectItemVO.transformScaleY=this.scale.y,this.projectItemVO.transformWidth=this.itemContentW*this.scale.x,this.projectItemVO.transformHeight=this.itemContentH*this.scale.y,this.projectItemVO.transformFlippedHorizontal=this.flippedHorizontal,this.projectItemVO.transformFlippedVertical=this.flippedVertical,this.projectItemVO.transformOpacity=100*this.alpha,this.projectItemVO.transformBlendMode=this.itemBlendMode,this.projectItemVO.transformOverlayColorEnabled=this.overlayColorEnabled,this.projectItemVO.transformOverlayColor=this.overlayColor,this.projectItemVO.transformOverlayColorIntensity=this.overlayColorIntensity,this.projectItemVO.transformTintColorEnabled=this.tintColorEnabled,this.projectItemVO.transformTintColor=this.tintColor,BFN.ProjectManager.requestLocalSave()}},Gx.prototype.updateFrameTextureDisplay=function(){"frame_texture"===this.type&&(this.itemContent.frameWidth=this.itemContentW*this.scale.x,this.itemContent.frameHeight=this.itemContentH*this.scale.y,this.itemContent.scale.x=1/this.scale.x*(this.flippedHorizontal?-1:1),this.itemContent.scale.y=1/this.scale.y*(this.flippedVertical?-1:1),this.itemContent.updateDisplay())},Gx.prototype.resetFrameTextureScale=function(){"frame_texture"===this.type&&(this.itemContent.frameWidth=Math.abs(this.itemContent.width/this.itemContent.scale.x),this.itemContent.frameHeight=Math.abs(this.itemContent.height/this.itemContent.scale.y),this.itemContent.x=this.flippedHorizontal?this.itemContent.frameWidth:0,this.itemContent.y=this.flippedVertical?this.itemContent.frameHeight:0,this.itemContent.scale.x=this.flippedHorizontal?-1:1,this.itemContent.scale.y=this.flippedVertical?-1:1,this.itemContent.updateDisplay(),this.scale.x=this.scale.y=1,this.updateContentDimensions(),this.shapeUpdatePending||(this.shapeUpdatePending=!0,this.queueShapeUpdate()))},Gx.prototype.resetFrameTexture=function(){"frame_texture"===this.type&&(this.clearDropShadow(),this.createTransition("history_image_region"),this.itemContent.textureScaleX=this.itemContent.textureScaleY=1,this.itemContent.offsetFactorX=this.itemContent.offsetFactorY=.5,this.itemContent.updateDisplay(),this.updateContentDimensions(),this.updateAccurateBounds(),this.updateSmoothingScale(),this.registerTransition(!1,!1),BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.transformItem===this&&BFN.TransformModel.transformToolFrame.setup(this))},Gx.prototype.fitFrameToImage=function(){if("frame_texture"===this.type){this.clearDropShadow(),this.createTransition("history_image_region");var e=this.itemContent.imageRect.x,t=this.itemContent.imageRect.y,n=Math.sqrt(Math.pow(e,2)+Math.pow(t,2)),i=Math.atan2(t,e)+this.rotation;this.x+=Math.cos(i)*n,this.y+=Math.sin(i)*n,this.itemContent.frameWidth=this.itemContent.imageRect.width,this.itemContent.frameHeight=this.itemContent.imageRect.height,this.itemContent.textureScaleX=this.itemContent.textureScaleY=1,this.itemContent.offsetFactorX=this.itemContent.offsetFactorY=.5,this.itemContent.updateDisplay(),this.resetFrameTextureScale(),this.updateContentDimensions(),this.updateAccurateBounds(),this.updateSmoothingScale(),this.transformTool.updateDisplay(),this.registerTransition(!1,!1),BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.transformItem===this&&BFN.TransformModel.transformToolFrame.setup(this)}},Gx.prototype.dragFrame=function(e){"frame_texture"===this.type&&(BFN.hasOwnProperty("FrameDragger")||(BFN.FrameDragger=new BFN.Dragger,BFN.FrameDragger.useBounds=!1,BFN.FrameDragger.autoDrag=!1),this.frameDraggerStartMousePosition=this.getPointerPosition(e),this.frameStartOffsetFactors=new PIXI.Point(this.itemContent.offsetFactorX,this.itemContent.offsetFactorY),this.frameOffsetFactorPixelSteps=new PIXI.Point(this.itemContent.excessX?1/(this.itemContent.excessX*this.itemContent.adjustScale*this.itemContent.textureScaleX):0,this.itemContent.excessY?1/(this.itemContent.excessY*this.itemContent.adjustScale*this.itemContent.textureScaleY):0),this.clearDropShadow(),this.createTransition("history_image_region"),BFN.FrameDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleFrameDraggerDraggingBind),BFN.FrameDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleFrameDraggerDraggingCompleteBind),BFN.FrameDragger.drag(this))},Gx.prototype.handleFrameDraggerDragging=function(){if("frame_texture"===this.type){var e=this.getPointerPosition(BFN.MainUI.pointerEvent),t=(this.frameDraggerStartMousePosition.x-e.x)*(this.flippedHorizontal?-1:1),n=(this.frameDraggerStartMousePosition.y-e.y)*(this.flippedVertical?-1:1),i=this.frameStartOffsetFactors.x+t*this.frameOffsetFactorPixelSteps.x,r=this.frameStartOffsetFactors.y+n*this.frameOffsetFactorPixelSteps.y;i<0?(this.frameStartOffsetFactors.x+=Math.abs(i),i=0):i>1&&(this.frameStartOffsetFactors.x-=i-1,i=1),r<0?(this.frameStartOffsetFactors.y+=Math.abs(r),r=0):r>1&&(this.frameStartOffsetFactors.y-=r-1,r=1),this.itemContent.offsetFactorX=i,this.itemContent.offsetFactorY=r,this.itemContent.updateDisplay()}},Gx.prototype.handleFrameDraggerDraggingComplete=function(){"frame_texture"===this.type&&(BFN.FrameDragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleFrameDraggerDraggingBind),BFN.FrameDragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleFrameDraggerDraggingCompleteBind),BFN.FrameDragger.wasDragged?this.registerTransition():this.updateDropShadowSource())},Gx.prototype.showImageDropState=function(){this.hoverDropAnimator&&BFN.TransformModel.awaitingDrop&&(this.hasDropOptions="frame_texture"===this.type&&!this.itemContentMask&&this.isTransparent,this.hoverDropAnimator.increase())},Gx.prototype.hideImageDropState=function(){this.hoverDropAnimator&&this.hoverDropAnimator.decrease()},Gx.prototype.handleHoverDropAnimatorUpdate=function(e){var t=this.projectItemVO.transformOpacity/100;this.alpha=t+this.hoverDropAnimator.animationFactor*(1-t),this.hoverDropFilter.intensity=.4*this.hoverDropAnimator.animationFactor,this.itemContent.blendMode=this.hoverDropAnimator.animationFactor>0?BFN.CONST.BLEND_MODES.NORMAL:this.itemBlendMode;var n=this.hoverDropAnimator.animationFactor>0?[this.hoverDropFilter]:[];this.itemContent.filters=this.itemContent.visible?n:[],"text"===this.type&&this.hiResTextSprite&&(this.hiResTextSprite.filters=this.hiResTextSprite.visible?n:[]),this.itemContentBorder&&(this.itemContentBorder.filters=this.itemContentBorder.visible?n:[])},Gx.prototype.resetTransparency=function(){void 0!==this._isTransparent&&(this._isTransparent=void 0)},Gx.prototype.updateThumb=function(){if(this.thumbImageSRC)this.thumbImage=new Image,this.thumbImage.src=this.thumbImageSRC,delete this.thumbImageSRC,delete this.thumbImageSRCPending;else{var e=BFN.TransformStateModel.getThumb(this),t=BFN.Util.getHTMLImage(e,null,!0);e.destroyGC(!0),this.thumbImage=t}this.dispatchEvent(BFN.TransformItemEvents.THUMB_UPDATED)},Gx.prototype.replaceImage=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace_image",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if("frame_texture"===this.type){this.clearDropShadow(),this.createTransition(n),this.itemObject.texture=t,this.projectItemVO.maskImageID=e;var l={};a&&(l.textureScaleX=this.itemContent.textureScaleX,l.textureScaleY=this.itemContent.textureScaleY,l.offsetFactorX=this.itemContent.offsetFactorX,l.offsetFactorY=this.itemContent.offsetFactorY),o&&(o.hasOwnProperty("frameWidth")&&(l.frameWidth=o.frameWidth),o.hasOwnProperty("frameHeight")&&(l.frameHeight=o.frameHeight),o.hasOwnProperty("textureScaleX")&&(l.textureScaleX=o.textureScaleX),o.hasOwnProperty("textureScaleY")&&(l.textureScaleY=o.textureScaleY),o.hasOwnProperty("offsetFactorX")&&(l.offsetFactorX=o.offsetFactorX),o.hasOwnProperty("offsetFactorY")&&(l.offsetFactorY=o.offsetFactorY)),this.itemContent.wasReplaced=!0,this.itemContent.setTexture(new PIXI.Texture(t.baseTexture)),this.itemContent.frameWidth=l.frameWidth||this.itemContent.frameWidth,this.itemContent.frameHeight=l.frameHeight||this.itemContent.frameHeight,this.itemContent.textureScaleX=l.textureScaleX||1,this.itemContent.textureScaleY=l.textureScaleY||1,this.itemContent.offsetFactorX=l.offsetFactorX||.5,this.itemContent.offsetFactorY=l.offsetFactorY||.5,this.itemContent.updateDisplay(),this.x+=i,this.y+=r,this.updateShapeTexture(),this.updateContentDimensions(),this.flippedHorizontal&&(this.flipHorizontal(),s&&this.flipHorizontal()),this.flippedVertical&&(this.flipVertical(),s&&this.flipVertical()),this.updateSmoothingScale(),this.updateThumb(),this.registerTransition(),"replace_image"===n&&this.addPresetItemThumbTexture(t.baseTexture,this.transitionVO.endState.creationTime)}else"texture"!==this.type||this.isGoodie||(this.clearDropShadow(),this.createTransition(n),this.itemObject.texture=t,this.projectItemVO.imageID=e,this.itemContent.wasReplaced=!0,this.itemContent.texture=t,this.x+=i,this.y+=r,this.updateContentDimensions(),this.flippedHorizontal&&(this.flipHorizontal(),s&&this.flipHorizontal()),this.flippedVertical&&(this.flipVertical(),s&&this.flipVertical()),this.updateSmoothingScale(),this.updateThumb(),this.registerTransition(),"replace_image"===n&&this.addPresetItemThumbTexture(t.baseTexture,this.transitionVO.endState.creationTime));this.resetTransparency()},Gx.prototype.getShapeColorGroupColor=function(e){var t={color:-1,opacity:1};return this.shapeColorMap&&this.shapeColorMap.hasOwnProperty(e)&&(t.color=this.shapeColorMap[e].colorHash,t.opacity=this.shapeColorMap[e].colorOpacity),t},Gx.prototype.setShapeColorGroupColor=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.shapeColorMap&&this.shapeColorMap.hasOwnProperty(e)){var o=this.shapeColorMap[e];if((-1===n&&-1!==o.colorHash||a)&&(n=o.colorHashOriginal,i=o.colorOpacityOriginal),o.colorHash=n,o.colorOpacity=i,this.hasOwnProperty("updateShapeTextureTimeout")&&(clearTimeout(this.updateShapeTextureTimeout),delete this.updateShapeTextureTimeout),r)this.updateShapeTexture(!0);else try{this.itemContent.texture.baseTexture.drawPeriod,this.updateShapeTextureTimeout=setTimeout(function(){clearTimeout(t.updateShapeTextureTimeout),delete t.updateShapeTextureTimeout,t.updateShapeTexture(!1)},this.itemContent.texture.baseTexture.drawPeriod)}catch(e){}}},Gx.prototype.getShapeColorMap=function(){if(!this.shapeColorMap)return null;var e={};for(var t in this.shapeColorMap){var n=this.shapeColorMap[t];e[t]={colorHash:n.colorHash,colorOpacity:n.colorOpacity}}return e},Gx.prototype.setShapeColorMap=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&this.shapeColorMap){for(var n in e){var i=e[n];for(var r in this.shapeColorMap[n]=this.shapeColorMap[n]||{},i)this.shapeColorMap[n][r]=i[r]}t&&this.updateShapeTexture()}},Gx.prototype.queueShapeUpdate=function(){-1===BFN.updatingShapeQueue.indexOf(this)&&BFN.updatingShapeQueue.push(this),BFN.UndoManager.updating||BFN.updatingShapeTransformItem?this.queueShapeUpdate():(this.shapeUpdatePending=!1,BFN.updatingShapeTransformItem=this,this.updateShapeTexture(),this.updateDropShadowSource(),BFN.updatingShapeTransformItem=null,-1!==BFN.updatingShapeQueue.indexOf(this)&&BFN.updatingShapeQueue.splice(BFN.updatingShapeQueue.indexOf(this),1))},Gx.prototype.updateShapeTexture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isShape){var n=this.itemContentMask?this.itemContentMask:this.itemContent,i=null;if("frame_texture"===this.type){this.basicShapeVO?this.basicShapeVO.updateTexture(n.texture,this.itemContent.frameWidth,this.itemContent.frameHeight,e):BFN.SVGManager.updateTexture(n.texture,null,null,this.itemContent.frameWidth,this.itemContent.frameHeight,!0,!0);var r=this.maskFlippedHorizontal?!this.flippedHorizontal:this.flippedHorizontal,a=this.maskFlippedVertical?!this.flippedVertical:this.flippedVertical;n.x=r?this.itemContent.frameWidth:0,n.y=a?this.itemContent.frameHeight:0,n.scale.x=r?-1:1,n.scale.y=a?-1:1,e||(n.x/=this.scale.x,n.y/=this.scale.y,n.scale.x/=this.scale.x,n.scale.y/=this.scale.y),this.basicShapeVO&&(n.x/=this.basicShapeVO.fitScale,n.y/=this.basicShapeVO.fitScale,n.scale.x/=this.basicShapeVO.fitScale,n.scale.y/=this.basicShapeVO.fitScale,n.scale.x*=this.itemContent.frameWidth*this.itemContent.scale.x/(n.texture.width*n.scale.x),n.scale.y*=this.itemContent.frameHeight*this.itemContent.scale.y/(n.texture.height*n.scale.y)),this.updateBorderTexture(e)}else this.basicShapeVO?(this.basicShapeVO.updateTexture(n.texture,Math.round(100*this.scale.x),Math.round(100*this.scale.y),e),i={x:this.scale.x*this.basicShapeVO.fitScale,y:this.scale.y*this.basicShapeVO.fitScale}):i=BFN.SVGManager.updateTexture(n.texture,this.scale.x,this.scale.y,null,null,e,t),n.scale.x=1/i.x*(this.flippedHorizontal?-1:1),n.scale.y=1/i.y*(this.flippedVertical?-1:1);this.basicShapeVO&&e&&this.updateHitArea()}else if("frame_texture"===this.type){if(this.itemContentMask){this.itemContentMaskTexture||(this.itemContentMaskTexture=this.itemContentMask.texture,this.itemContentMask.texture=PIXI.RenderTexture.create(32,32));var o=Math.min(1,this.itemContent.frameWidth/this.itemContentMaskTexture.baseTexture.width),s=Math.min(1,this.itemContent.frameHeight/this.itemContentMaskTexture.baseTexture.height),l=Math.round(this.itemContentMaskTexture.width*o),u=Math.round(this.itemContentMaskTexture.height*s);if(this.itemContentMask.texture.width!=l||this.itemContentMask.texture.height!=u){var c=BFN.Util.resizeTexture(this.itemContentMaskTexture,l,u,!1,!0);this.itemContentMask.texture.resize(c.width,c.height),this.itemContentMask.texture.copyPixels(c),c.destroyGC(!0)}this.itemContentMask.x=this.maskFlippedHorizontal?Math.abs(this.itemContent.x-this.itemContentW):this.itemContent.x,this.itemContentMask.y=this.maskFlippedVertical?Math.abs(this.itemContent.y-this.itemContentH):this.itemContent.y,this.itemContentMask.scale.x=this.itemContent.frameWidth/this.itemContentMask.texture.width*(this.itemContentMask.x?-1:1),this.itemContentMask.scale.y=this.itemContent.frameHeight/this.itemContentMask.texture.height*(this.itemContentMask.y?-1:1)}this.updateBorderTexture(e)}BFN.MainUI.requestRender()},Gx.prototype.updateBorderTexture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if("frame_texture"===this.type&&this.itemContentBorder&&this.borderBasicShapeVO){var t={};if(this.basicShapeVO&&Object.assign(t,this.basicShapeVO.getValues()),t.fill=-1,t.stroke=this.borderBasicShapeVO.stroke,t.strokeAlpha=this.borderBasicShapeVO.strokeAlpha,t.strokeWidth=this.borderBasicShapeVO.strokeWidth,this.borderBasicShapeVO.setValues(t),this.itemContentBorder.isFrameBorder)-1!==this.borderBasicShapeVO.stroke&&this._borderEnabled?(this.itemContentBorder.initSprites(),this.itemContentBorder.setDimensions(this.itemContent.frameWidth,this.itemContent.frameHeight),this.itemContentBorder.color=parseInt("0x".concat(this.borderBasicShapeVO.stroke)),this.itemContentBorder.opacity=this.borderBasicShapeVO.strokeAlpha,this.itemContentBorder.thickness=this.borderBasicShapeVO.strokeWidth,this.itemContentBorder.scale.x=this.itemContentBorder.scale.y=1,e?this.updateHitArea():(this.itemContentBorder.scale.x/=this.scale.x,this.itemContentBorder.scale.y/=this.scale.y)):0!==this.itemContentBorder.thickness&&(this.itemContentBorder.thickness=0,this.itemContentBorder.destroy(),this.updateHitArea());else{if(this.itemContentBorder.visible=this._borderEnabled&&!(-1===t.stroke||t.strokeAlpha<=0||t.strokeWidth<1),!this.itemContentBorder.visible)return void(this.itemContentBorder.texture&&this.itemContentBorder.texture!==PIXI.Texture.EMPTY&&(this.itemContentBorder.texture.destroyGC(!0),this.itemContentBorder.texture=PIXI.Texture.EMPTY));this.itemContentBorder.texture===PIXI.Texture.EMPTY&&(this.itemContentBorder.texture=PIXI.RenderTexture.create(32,32)),this.borderBasicShapeVO.updateTexture(this.itemContentBorder.texture,this.itemContent.frameWidth,this.itemContent.frameHeight,e),this.itemContentMask?(this.itemContentBorder.x=this.itemContentMask.x,this.itemContentBorder.y=this.itemContentMask.y,this.itemContentBorder.scale.x=this.itemContentMask.scale.x,this.itemContentBorder.scale.y=this.itemContentMask.scale.y):(this.itemContentBorder.x=0,this.itemContentBorder.y=0,this.itemContentBorder.scale.x=1,this.itemContentBorder.scale.y=1,e||(this.itemContentBorder.scale.x/=this.scale.x,this.itemContentBorder.scale.y/=this.scale.y),this.itemContentBorder.scale.x/=this.borderBasicShapeVO.fitScale,this.itemContentBorder.scale.y/=this.borderBasicShapeVO.fitScale,this.itemContentBorder.scale.x*=this.itemContent.frameWidth*this.itemContent.scale.x/(this.itemContentBorder.texture.width*this.itemContentBorder.scale.x),this.itemContentBorder.scale.y*=this.itemContent.frameHeight*this.itemContent.scale.y/(this.itemContentBorder.texture.height*this.itemContentBorder.scale.y))}BFN.MainUI.requestRender()}},Gx.prototype.clearDropShadow=function(){this.itemContentShadow.clearShadowTexture()},Gx.prototype.updateDropShadowSource=function(){var e=this;if(!this.dropShadowVO.enabled)return this.itemContentShadow.clearShadowTexture(),void delete this.itemContent.wasReplaced;if(this.itemContentShadow.isEmpty||this.itemContentShadow.isDuplicate){BFN.queuedDropShadowItems.includes(this)||(BFN.queuedDropShadowItems.push(this),function t(){BFN.queuedDropShadowItems[0]===e?setTimeout(function(){if(BFN.queuedDropShadowItems.shift(),e.dropShadowVO.enabled){if(!e.itemContentShadow.isDuplicate){var t=!(!e.itemContent.wasReplaced||!e.itemContentMask||e.itemContent.mask!==e.itemContentMask);BFN.Util.getTransformItemTexture(e,null,!0,e.itemContentShadow.sourceTexture,t)}e.updateDropShadowDisplay(),e.itemContentShadow.isDuplicate?delete e.itemContentShadow.isDuplicate:e.updateDropShadowTexture(!0),BFN.MainUI.requestRender()}delete e.itemContent.wasReplaced},0):requestAnimationFrame(t)}())}else delete this.itemContent.wasReplaced},Gx.prototype.updateDropShadowDisplay=function(){this.updateDropShadowPosition(),this.updateDropShadowScale(),this.updateDropShadowTransform(),this.updateDropShadowOffset(),this.updateDropShadowVisuals()},Gx.prototype.updateDropShadowTexture=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.dropShadowVO.enabled&&this.parent){if(this.itemContentShadow.size=this.dropShadowVO.size,this.itemContentShadow.density=this.dropShadowVO.density/100,t)return BFN.queuedDropShadowItems.includes(this)&&BFN.queuedDropShadowItems.splice(BFN.queuedDropShadowItems.indexOf(this),1),void this.itemContentShadow.updateShadowTexture(this.currentTransformItemStateVO?this.currentTransformItemStateVO.id:null);BFN.queuedDropShadowItems.includes(this)||(BFN.queuedDropShadowItems.push(this),function t(){BFN.queuedDropShadowItems[0]===e?setTimeout(function(){BFN.queuedDropShadowItems.shift(),e.dropShadowVO.enabled&&(e.itemContentShadow.updateShadowTexture(e.currentTransformItemStateVO?e.currentTransformItemStateVO.id:null),BFN.MainUI.requestRender())},0):requestAnimationFrame(t)}())}},Gx.prototype.updateDropShadowPosition=function(){this.itemContentShadow.x=this.itemContentW/2,this.itemContentShadow.y=this.itemContentH/2},Gx.prototype.updateDropShadowScale=function(){if(this.dropShadowVO.enabled&&this.itemContentShadow._sourceTexture&&this.itemContentShadow._sourceTexture.adjustScale){var e=this.dropShadowVO.scale/100;this.itemContentShadow.adjustScaleX=this.itemContentShadow._sourceTexture.adjustScale.x/e,this.itemContentShadow.adjustScaleY=this.itemContentShadow._sourceTexture.adjustScale.y/e,this.updateSmoothingScale()}},Gx.prototype.updateDropShadowTransform=function(){this.dropShadowVO&&this.dropShadowVO.enabled&&(this.itemContentShadow.parentScaleX=this.scale.x,this.itemContentShadow.parentScaleY=this.scale.y,this.itemContentShadow.parentRotation=this.rotation)},Gx.prototype.updateDropShadowOffset=function(){if(this.dropShadowVO.enabled){var e=(this.dropShadowVO.angle+90)*(Math.PI/180);this.itemContentShadow.offsetX=Math.cos(e)*this.dropShadowVO.distance,this.itemContentShadow.offsetY=Math.sin(e)*this.dropShadowVO.distance}},Gx.prototype.updateDropShadowVisuals=function(){this.dropShadowVO.enabled&&(this.itemContentShadow.color=parseInt("0x".concat(this.dropShadowVO.color)),this.itemContentShadow.opacity=this.dropShadowVO.opacity,this.itemContentShadow.blendMode=this.dropShadowVO.blend_mode)},Gx.prototype.setTextWidth=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.iText){this.textScale=e/this.iText.width;var i=Math.round((this.iText.width+2*this.textPadding)*this.textScale),r=Math.round((this.iText.height+2*this.textPadding)*this.textScale),a=1;if((i>BFN.maxImageSize||r>BFN.maxImageSize)&&(a=Math.min(BFN.maxImageSize/i,BFN.maxImageSize/r),this.textScale*=a,i=Math.min(BFN.maxImageSize,Math.round((this.iText.width+2*this.textPadding)*this.textScale)),r=Math.min(BFN.maxImageSize,Math.round((this.iText.height+2*this.textPadding)*this.textScale))),this.scale.x=this.scale.y=1/a,this.iTexture.resize(i,r,!1),n){var o=t?this.iTexture.renderClone():null;o&&(this.iTexture.copyPixels(o,null,!0,1,{x:this.iTexture.width/o.width,y:this.iTexture.height/o.height}),o.destroyGC(!0),o=null),this.itemContent.texture=this.iTexture,this.updateTextDisplay()}this.itemContent.visible=n,this.updateContentDimensions(),this.initialized&&this.updateHiResTextBounds(),this.itemContent.x=this.flippedHorizontal?this.itemContentW:0,this.itemContent.y=this.flippedVertical?this.itemContentH:0,this.itemContent.anchor.x=this.textPadding/i*this.textScale,this.itemContent.anchor.y=this.textPadding/r*this.textScale}},Gx.prototype.generateFabricCanvas=function(){if(!BFN.hasOwnProperty("fabricCanvas")){BFN.fabricCanvasElement=document.createElement("canvas"),BFN.appContainer.appendChild(BFN.fabricCanvasElement),BFN.fabricCanvas=new fabric.StaticCanvas(BFN.fabricCanvasElement,{enableRetinaScaling:!1}),BFN.fabricCanvasContext=BFN.fabricCanvas.getContext(),BFN.fabricCanvasElement.setStyles({display:"none"})}},Gx.prototype.generateITextClone=function(){BFN.hasOwnProperty("iTextClone")||(BFN.iTextClone=new fabric.TextboxPad("iTextClone",{left:0,top:0,textAlign:"left",fontFamily:BFN.FabricManager.defaultFontFamily,fontSize:BFN.TransformItemTextBaseFontSize,fill:"rgb(0,0,0)",padding:10}),BFN.iTextClone.objectCaching=!1,BFN.iTextClone.paintFirst="stroke",BFN.iTextClone.noScaleCache=!1,BFN.iTextClone.strokeWidth=0,BFN.iTextClone.objectCaching=!1,BFN.fabricCanvas.add(BFN.iTextClone))},Gx.prototype.generateFabricCanvasTexture=function(){BFN.hasOwnProperty("fabricCanvasTexture")?BFN.fabricCanvasTexture.update():(BFN.fabricCanvasTexture=new PIXI.Texture(new PIXI.BaseTexture.fromCanvas(BFN.fabricCanvasElement)),BFN.fabricCanvasTexture.baseTexture.mipmap=!1)},Gx.prototype.updateTextDisplay=function(){var e=this;for(var t in this.iText.styles){var n=this.iText.styles[t];for(var i in n){var r=n[i];r&&(r.hasOwnProperty("fontSize")&&r.hasOwnProperty("strokePercent")&&(r.strokeWidth=r.fontSize*r.strokePercent),r.hasOwnProperty("strokeWidth")&&(r.strokeWidth=Math.max(r.strokeWidth,1/this.textScale)))}}this.generateFabricCanvas(),this.generateITextClone();var a=this.iText.styles,o={};for(var s in a)for(var l in o[s]={},a[s])for(var u in o[s][l]={},a[s][l])o[s][l][u]=a[s][l][u];BFN.iTextClone.text=this.iText.text,BFN.iTextClone.width=this.iText.width,BFN.iTextClone.styles=o,BFN.iTextClone.textAlign=this.iText.textAlign,BFN.iTextClone.charSpacing=this.iText.charSpacing,BFN.iTextClone.lineHeight=this.iText.lineHeight,BFN.iTextClone.outlineEnabled=this.iText.outlineEnabled,BFN.iTextClone.highlightEnabled=this.iText.highlightEnabled,this.updateITextBackgroundDisplay(),BFN.iTextClone.backgroundOverrideColor=this.iText.backgroundOverrideColor,BFN.iTextClone.backgroundOverridePadding=this.iText.backgroundOverridePadding,BFN.iTextClone.wordBreaksEnabled=this.iText.wordBreaksEnabled,BFN.iTextClone.initDimensions(),BFN.iTextClone.left=this.textPadding*this.textScale,BFN.iTextClone.top=this.textPadding*this.textScale,BFN.iTextClone.scaleX=BFN.iTextClone.scaleY=this.textScale,BFN.fabricCanvasElement.width=(BFN.iTextClone.width+2*this.textPadding)*BFN.iTextClone.scaleX,BFN.fabricCanvasElement.height=(BFN.iTextClone.height+2*this.textPadding)*BFN.iTextClone.scaleY,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),BFN.fabricCanvasContext.lineJoin="round",BFN.fabricCanvas.renderAll(),this.generateFabricCanvasTexture(),this.iTexture.copyPixels(BFN.fabricCanvasTexture),requestAnimationFrame(function(){BFN.fabricCanvasElement.width=16,BFN.fabricCanvasElement.height=16,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),e.updateSmoothingScale(),e.updateAccurateBounds(!0),BFN.MainUI.requestRender(),e.dispatchEvent(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED),BFN.updatingTextTransformItem=null,-1!==BFN.updatingTextQueue.indexOf(e)&&BFN.updatingTextQueue.splice(BFN.updatingTextQueue.indexOf(e),1)})},Gx.prototype.getITextMask=function(e){var t=this;if("text"===this.type&&this.iText&&e){this.generateFabricCanvas(),this.generateITextClone();var n=this.iText.styles,i={};for(var r in n)for(var a in i[r]={},n[r])for(var o in i[r][a]={},n[r][a]){var s=n[r][a][o];if(s)switch(o){case"stroke":case"fill":s="white";break;case"textBackgroundColor":s=""}i[r][a][o]=s}BFN.iTextClone.text=this.iText.text,BFN.iTextClone.width=this.iText.width,BFN.iTextClone.styles=i,BFN.iTextClone.textAlign=this.iText.textAlign,BFN.iTextClone.charSpacing=this.iText.charSpacing,BFN.iTextClone.lineHeight=this.iText.lineHeight,BFN.iTextClone.backgroundColor="",BFN.iTextClone.backgroundOverrideColor="",BFN.iTextClone.backgroundOverridePadding=0,BFN.iTextClone.initDimensions();var l=this.textMaskMaxSize/Math.max(BFN.iTextClone.width+2*this.textPadding,BFN.iTextClone.height+2*this.textPadding);BFN.iTextClone.left=this.textPadding*l,BFN.iTextClone.top=this.textPadding*l,BFN.iTextClone.scaleX=BFN.iTextClone.scaleY=l,BFN.fabricCanvasElement.width=(BFN.iTextClone.width+2*this.textPadding)*l,BFN.fabricCanvasElement.height=(BFN.iTextClone.height+2*this.textPadding)*l,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),BFN.fabricCanvasContext.lineJoin="round",BFN.fabricCanvas.renderAll(),this.generateFabricCanvasTexture();var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=BFN.Util.getAlphaBounds(BFN.fabricCanvasTexture),i=new BFN.Rectangle(n.left-e,n.top-e,n.width+2*e,n.height+2*e),r=t.textMaskMaxSize/Math.max(i.width,i.height);return BFN.iTextClone.left=BFN.iTextClone.left*r-i.left*r,BFN.iTextClone.top=BFN.iTextClone.top*r-i.top*r,BFN.iTextClone.scaleX=BFN.iTextClone.scaleX*r,BFN.iTextClone.scaleY=BFN.iTextClone.scaleY*r,BFN.fabricCanvasElement.width=Math.round(i.width*r),BFN.fabricCanvasElement.height=Math.round(i.height*r),BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")}),BFN.fabricCanvasContext.lineJoin="round",BFN.fabricCanvas.renderAll(),BFN.fabricCanvasTexture.update(),n},c=this.iText.scaleX*this.iText.width/(BFN.iTextClone.scaleX*BFN.iTextClone.width)*(this.textScale/this.iText.scaleX),h=this.iText.scaleY*this.iText.height/(BFN.iTextClone.scaleY*BFN.iTextClone.height)*(this.textScale/this.iText.scaleY),d=u(10);requestAnimationFrame(function(){u(),requestAnimationFrame(function(){BFN.fabricCanvasElement.width=16,BFN.fabricCanvasElement.height=16,BFN.fabricCanvasElement.setStyles({width:"".concat(BFN.fabricCanvasElement.width,"px"),height:"".concat(BFN.fabricCanvasElement.height,"px")});var n=PIXI.RenderTexture.create(BFN.fabricCanvasTexture.width,BFN.fabricCanvasTexture.height);n.fillColor(0),n.copyPixels(BFN.fabricCanvasTexture,null,!1);var i=t.iText.scaleX*t.iText.width/(BFN.iTextClone.scaleX*BFN.iTextClone.width)*(t.textScale/t.iText.scaleX)*t.scale.x,r=t.iText.scaleY*t.iText.height/(BFN.iTextClone.scaleY*BFN.iTextClone.height)*(t.textScale/t.iText.scaleY)*t.scale.y,a=new BFN.Rectangle(d.left*c*t.scale.x,d.top*h*t.scale.y,n.width*i,n.height*r);e({boundsRect:a,maskTexture:n})})})}},Gx.prototype.updateITextBackgroundDisplay=function(){this.iText.backgroundOverrideColor=-1!=this.textBackgroundColor&&this.textBackgroundEnabled?BFN.ColorUtil.hexStringObjectToRGBAString({hex:this.textBackgroundColor,alpha:this.textBackgroundIntensity}):"",this.iText.backgroundOverridePadding=this.textBackgroundPadding/100*this.textPadding},Gx.prototype.queueTextUpdate=function(){var e=this;if(this.pendingTransformItemState)if(-1===BFN.updatingTextQueue.indexOf(this)&&BFN.updatingTextQueue.push(this),BFN.UndoManager.updating||BFN.updatingTextTransformItem)this.queueTextUpdate();else{this.textUpdatePending=!1,BFN.updatingTextTransformItem=this,this.iText._forceClearCache=!0,this.iText._clearCache(),this.iText.text=this.pendingTransformItemState.text,this.iText.textAlign=this.pendingTransformItemState.textStyle.textAlign,this.iText.charSpacing=this.pendingTransformItemState.textStyle.charSpacing,this.iText.lineHeight=this.pendingTransformItemState.textStyle.lineHeight,this.iText.width=this.pendingTransformItemState.textWidth,this.iText.scaleX=this.iText.scaleY=this.pendingTransformItemState.textScale,this.textBackgroundEnabled=this.pendingTransformItemState.textBackgroundEnabled,this.textBackgroundColor=this.pendingTransformItemState.textBackgroundColor,this.textBackgroundIntensity=this.pendingTransformItemState.textBackgroundIntensity,this.textBackgroundPadding=this.pendingTransformItemState.textBackgroundPadding,this.textOutlineEnabled=this.pendingTransformItemState.textOutlineEnabled,this.textHighlightEnabled=this.pendingTransformItemState.textHighlightEnabled,this.updateITextBackgroundDisplay();var t=this.pendingTransformItemState.textStyle.styles,n={};for(var i in t){var r=n[i]={};for(var a in t[i]){var o=r[a]=Object.assign({},t[i][a]);o.fontSize&&o.stroke&&!o.strokeWidth&&(o.strokePercent=o.strokePercent||BFN.TransformItemTextStrokePercentDefault,o.strokeWidth=o.strokePercent*o.fontSize)}}this.iText.styles=n,this.conformITextToSmallestFontSize(),this.iText.__skipDimension=!1,this.iText.initDimensions(),setTimeout(function(){e.setTextWidth(e.pendingTransformItemState.textWidth*e.pendingTransformItemState.textScale*e.pendingTransformItemState.textItemScale),e.pendingTransformItemState=null,e.renderable=!0,BFN.MainUI.rendering=!0,e.updateProjectItemVO()},1)}else BFN.updatingTextTransformItem===this&&(BFN.updatingTextTransformItem=null),-1!==BFN.updatingTextQueue.indexOf(this)&&BFN.updatingTextQueue.splice(BFN.updatingTextQueue.indexOf(this),1),this.pendingTransformItemState=null,this.textUpdatePending=!1,this.renderable=!0,BFN.MainUI.rendering=!0,this.updateProjectItemVO()},Gx.prototype.setITextStyle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("text"===this.type&&this.currentTransformItemStateVO){this.pendingTransformItemState=Object.assign(new BFN.TransformItemStateVO,this.currentTransformItemStateVO),this.pendingTransformItemState.textStyle=JSON.parse(JSON.stringify(this.currentTransformItemStateVO.textStyle));var t=!1,n=!1;for(var i in e){var r=e[i];if(BFN.FabricManager.itemStyles.includes(i))switch(i){case"backgroundEnabled":this.textBackgroundEnabled=r,this.pendingTransformItemState.textBackgroundEnabled=this.textBackgroundEnabled,-1==this.textBackgroundColor&&(this.textBackgroundColor=BFN.FabricManager.defaultBackgroundColor,this.pendingTransformItemState.textBackgroundColor=this.textBackgroundColor),t=!0,n=!0;break;case"backgroundColor":this.textBackgroundColor=r,this.pendingTransformItemState.textBackgroundColor=this.textBackgroundColor,t=!0,n=!0;break;case"backgroundIntensity":this.textBackgroundIntensity=r,this.pendingTransformItemState.textBackgroundIntensity=this.textBackgroundIntensity,t=!0,n=!0;break;case"backgroundPadding":this.textBackgroundPadding=r,this.pendingTransformItemState.textBackgroundPadding=this.textBackgroundPadding,t=!0,n=!0;break;case"outlineEnabled":if(this.textOutlineEnabled=r,this.pendingTransformItemState.textOutlineEnabled=this.textOutlineEnabled,this.textOutlineEnabled&&this.iText.styleIsEmpty("stroke")){var a=BFN.FabricManager.userStyle.charStyles,o=a.stroke?a.stroke:BFN.ColorUtil.hexStringObjectToRGBAString({hex:BFN.FabricManager.defaultOutlineColor,alpha:1});this.iText.setStyles({stroke:o},this.pendingTransformItemState.textStyle.styles,!0)}t=!0,n=!0;break;case"highlightEnabled":if(this.textHighlightEnabled=r,this.pendingTransformItemState.textHighlightEnabled=this.textHighlightEnabled,this.textHighlightEnabled&&this.iText.styleIsEmpty("textBackgroundColor")){var s=BFN.FabricManager.userStyle.charStyles,l=s.textBackgroundColor?s.textBackgroundColor:BFN.ColorUtil.hexStringObjectToRGBAString({hex:BFN.FabricManager.defaultHighlightColor,alpha:1});this.iText.setStyles({textBackgroundColor:l},this.pendingTransformItemState.textStyle.styles,!0)}t=!0,n=!0}else if(BFN.FabricManager.globalStyles.includes(i))this.pendingTransformItemState.textStyle[i]=r,this.iText[i]=r,n=!0;else{for(var u in this.pendingTransformItemState.textStyle.styles){var c=this.pendingTransformItemState.textStyle.styles[u];for(var h in c){c[h][i]=r}}this.iText.styles=this.pendingTransformItemState.textStyle.styles,n=!0}}t&&this.updateITextBackgroundDisplay(),n&&!this.textUpdatePending&&(this.textUpdatePending=!0,BFN.MainUI.rendering=!1,this.renderable=!1,this.queueTextUpdate())}},Gx.prototype.conformITextToSmallestFontSize=function(){if(this.iText){var e=null,t=this.iText.styles;for(var n in t){var i=t[n];for(var r in i){var a=i[r];a.hasOwnProperty("fontSize")||(a.fontSize=BFN.TransformItemTextBaseFontSize);var o=a.fontSize;e=null===e?o:Math.min(e,o)}}var s=null===e?1:BFN.TransformItemTextBaseFontSize/e;for(var l in t){var u=t[l];for(var c in u){u[c].fontSize*=s}}this.textBackgroundPadding*=s,this.iText.charSpacing*=s,this.iText.width*=s,this.iText.scaleX/=s,this.iText.scaleY/=s,this.fontSizeNormalizeFactor=s}},Gx.prototype.exitTextEditing=function(){var e=this;this.ignoreTextHeight=!0,requestAnimationFrame(function(){delete e.ignoreTextHeight}),this.resetTextIfEmpty(),this.conformITextToSmallestFontSize(),this.iText.exitEditing()},Gx.prototype.resetTextIfEmpty=function(){if(""===this.iText.text.trim()){this.iText.text=BeFunky.LanguageManager.getString("click_when_selected"),this.iText.styles={},this.iText.styles[0]={};for(var e=0;e<this.iText.text.length;e++){var t={};Object.assign(t,this.defaultTextStyles),this.iText.backupStyle&&Object.assign(t,this.iText.backupStyle),t.fontSize=BFN.TransformItemTextBaseFontSize,this.iText.styles[0][e]=t}}},Gx.prototype.getTextStyle=function(){if("text"===this.type&&this.iText){var e={};for(var t in e.textAlign=this.iText.textAlign,e.charSpacing=this.iText.charSpacing,e.lineHeight=this.iText.lineHeight,e.styles={},this.iText.styles)for(var n in e.styles[t]={},this.iText.styles[t])for(var i in e.styles[t][n]={},this.iText.styles[t][n])e.styles[t][n][i]=this.iText.styles[t][n][i];return e}return null},Gx.prototype.getTextStyleData=function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=["backgroundColor"],r=n;if(i.forEach(function(e){r.hasOwnProperty(e)||(r["".concat(e,"Empty")]=!1)}),"text"==this.type){var a=function(e,t,n){e.hasOwnProperty(t)||(e[t]=n)},o=function(e,t){i.includes(e)&&-1==t&&(r["".concat(e,"Empty")]=!0),r.hasOwnProperty(e)?r[e]!=t&&(r[e]="mixed"):r[e]=t};if(r.strokeEmpty=!!r.strokeEmpty||this.iText.styleIsEmpty("stroke"),r.textBackgroundColorEmpty=!!r.textBackgroundColorEmpty||this.iText.styleIsEmpty("textBackgroundColor"),o("backgroundEnabled",this.textBackgroundEnabled),o("backgroundColor",this.textBackgroundColor),o("backgroundIntensity",this.textBackgroundIntensity),o("backgroundPadding",this.textBackgroundPadding),o("outlineEnabled",this.textOutlineEnabled),o("highlightEnabled",this.textHighlightEnabled),BFN.FabricManager.globalStyles.forEach(function(e){o(e,t.iText[e])}),this.iText.getSelectionStyles&&this.iText.isEditing){var s=this.iText.selectionStart||0,l=s+1;this.iText.text.length&&this.iText.selectionStart>0&&(s===this.iText.text.length||this.iText.selectionStart===this.iText.selectionEnd)&&(s--,l--);var u=this.iText.text.length?this.iText.getSelectionStyles(s,l,!0):this.iText.backupStyle?[this.iText.backupStyle]:null;u&&u.length&&(Object.assign(r,u[0]),r.hasOwnProperty("fontSize")&&(r.fontSize=r.fontSizeMin=r.fontSizeStart=Math.round(this.scale.x*this.textScale*r.fontSize)))}else for(var c in this.iText.styles){var h=this.iText.styles[c];for(var d in h){var m=h[d];for(var p in a(e=m,"fontSize",BFN.TransformItemTextBaseFontSize),a(e,"fontWeight",""),a(e,"fontStyle",""),a(e,"underline",!1),a(e,"textBackgroundColor",""),a(e,"strokePercent",BFN.TransformItemTextStrokePercentDefault),m)if("fontSize"===p){var g=Math.round(this.scale.x*this.textScale*m[p]);o("fontSize",g),r.fontSizeMin=r.hasOwnProperty("fontSizeMin")?Math.min(r.fontSizeMin,g):g}else o(p,m[p]);0===parseInt(c)&&0===parseInt(d)&&o("fontSizeStart",r.fontSize)}}}return r},Gx.prototype.getAvailableGroupItems=function(){var e=this,t=BFN.GroupManager.getGroupVOsFromItemIDs([this.itemID]),n=[];t.forEach(function(t){t.itemIDs.forEach(function(t){n.includes(t)||t===e.itemID||n.push(t)})});var i=[];return this.transformLayer.children.forEach(function(t){t instanceof BFN.TransformItem&&t.projectItemVO&&t!==e&&!i.includes(t)&&n.includes(t.itemID)&&i.push(t)}),i},Gx.prototype.updateItemsAffectedByTextHeight=function(){var e=this;if("text"===this.type&&this.iText&&[BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this)){this.preChangeTextHeight=Math.round(this.iText.height*this.textScale*this.scale.y);var t=this.getAvailableGroupItems(),n=this.localPolygon,i=new PIXI.Point((n[0].x+n[2].x)/2,(n[0].y+n[2].y)/2),r=new PIXI.Point(n[2].x,n[2].y),a=BFN.Util.rotatePoint(i,r,-this.rotation).y,o=function(t){for(var n=!0,r=0;r<t.length;r++)if(n){var o=t[r];BFN.Util.rotatePoint(i,o,-e.rotation).y<a&&(n=!1)}return n};this.itemsAffectedByTextHeight.splice(0),t.forEach(function(t){var n=o(t.localPolygon);if(!n&&t.accurateBounds){var i=BFN.Util.getTransformItemBounds(t),r=i.minX+t.accurateBounds.left,a=i.maxX-t.accurateBounds.right,s=i.minY+t.accurateBounds.top,l=i.maxY-t.accurateBounds.bottom;n=o([new PIXI.Point(r,s),new PIXI.Point(a,s),new PIXI.Point(a,l),new PIXI.Point(r,l)])}n&&e.itemsAffectedByTextHeight.push({item:t,startPoint:new PIXI.Point(t.x,t.y)})})}},Gx.prototype.handleTextHeightChanged=function(e){if("text"===this.type&&this.iText&&[BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this)&&this.itemsAffectedByTextHeight.length&&!this.ignoreTextHeight){var t=Math.round(this.iText.height*this.textScale*this.scale.y)-this.preChangeTextHeight,n=this.rotation+Math.PI/2;this.itemsAffectedByTextHeight.forEach(function(e){e.item.toggleHiResText(!(Math.abs(t)>0)),e.item.x=e.startPoint.x+Math.cos(n)*t,e.item.y=e.startPoint.y+Math.sin(n)*t}),BFN.TransformItemBoundingBoxes.updateItems(),BFN.MainUI.requestRender()}},Gx.prototype.registerItemsAffectedByTextHeight=function(){if("text"!==this.type||!this.iText||![BFN.TransformModel.selectedTransformItem,BFN.TransformModel.selectedTransformItemText].includes(this))return null;if(!this.itemsAffectedByTextHeight.length)return null;var e=Math.round(this.iText.height*this.textScale*this.scale.y)-this.preChangeTextHeight;if(Math.abs(e)<1)return this.itemsAffectedByTextHeight.forEach(function(e){"text"===e.item.type&&e.item.iText&&e.item.toggleHiResText(!0)}),BFN.MainUI.requestRender(),null;this.itemsAffectedByTextHeight.forEach(function(e){e.item.x=e.startPoint.x,e.item.y=e.startPoint.y});var t="offset_items_".concat(BeFunky.randomString(10));BFN.TransformStateModel.startBulkTransition(t);var n=this.rotation+Math.PI/2;return this.itemsAffectedByTextHeight.forEach(function(t){t.item.createTransition("offset_item"),t.item.x=t.startPoint.x+Math.cos(n)*e,t.item.y=t.startPoint.y+Math.sin(n)*e,t.item.registerTransition()}),BFN.TransformStateModel.stopBulkTransition(),this.itemsAffectedByTextHeight.splice(0),t},Gx.prototype.setBlendMode=function(e){this.itemBlendMode=e,this.itemContent.blendMode=e,"text"===this.type&&(this.hiResTextSprite.blendMode=e),this.itemContentBorder&&!this.itemContentMask&&(this.itemContentBorder.blendMode=e),BFN.MainUI.requestRender()},Gx.prototype.flipHorizontal=function(){this.flippedHorizontal=!this.flippedHorizontal,this.itemContent.scale.x=Math.abs(this.itemContent.scale.x)*(this.flippedHorizontal?-1:1),this.itemContent.x=this.flippedHorizontal?this.itemContentW:0,this.itemContentMask&&(this.itemContentMask.x=this.maskFlippedHorizontal?Math.abs(this.itemContent.x-this.itemContentW):this.itemContent.x,this.isShape?this.itemContentMask.scale.x=this.itemContent.scale.x*(this.maskFlippedHorizontal?-1:1):this.itemContentMask.scale.x=Math.abs(this.itemContentMask.scale.x)*(this.itemContentMask.x?-1:1)),this.updateHiResTextBounds(),this.updateHiResText()},Gx.prototype.flipVertical=function(){this.flippedVertical=!this.flippedVertical,this.itemContent.scale.y=Math.abs(this.itemContent.scale.y)*(this.flippedVertical?-1:1),this.itemContent.y=this.flippedVertical?this.itemContentH:0,this.itemContentMask&&(this.itemContentMask.y=this.maskFlippedVertical?Math.abs(this.itemContent.y-this.itemContentH):this.itemContent.y,this.isShape?this.itemContentMask.scale.y=this.itemContent.scale.y*(this.maskFlippedVertical?-1:1):this.itemContentMask.scale.y=Math.abs(this.itemContentMask.scale.y)*(this.itemContentMask.y?-1:1)),this.updateHiResTextBounds(),this.updateHiResText()},Gx.prototype.setItemZIndex=function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent){e=Math.max(0,Math.min(this.parent.children.length-1,e));var i=this.parent.getChildIndex(this);e!=i&&(this.zIndexUpdating||(this.zIndexUpdating=!0,this.zIndexStart=i,this.createTransition("history_layer_order")),this.parent.setChildIndex(this,e),i=this.parent.getChildIndex(this),BFN.MainUI.requestRender()),this.zIndexUpdating&&!n&&(this.zIndexUpdating=!1,this.zIndexStart!=i&&(this.parent&&this.parent.children.forEach(function(e){"group"!==e.type&&e.projectItemVO&&(e.projectItemVO.transformZIndex=t.parent.getChildIndex(e))}),this.registerTransition(),BFN.TransformLayerManager.updateTransformItemsImmediately(!1)),UILayers.handleItemsUpdated())}},Gx.prototype.changeItemIndex=function(e){var t=this;if(this.parent){for(var n=this.globalPolygon,i=this.parent.getChildIndex(this),r=-1,a=[],o=0;o<this.parent.children.length;o++){var s=this.parent.children[o],l=this.parent.getChildIndex(s);(this===s||this!==s&&BFN.Util.polygonHitTest(n,s.globalPolygon))&&a.push({index:l})}a.sort(function(e,t){return e.index-t.index});for(var u=0;u<a.length;u++)if(i==a[u].index){switch(e){case"backwards":u>0&&(r=a[u-1].index,this.parent.setChildIndex(this,r));break;case"forwards":u<a.length-1&&(r=a[u+1].index,this.parent.setChildIndex(this,r))}break}var c=i!=r&&-1!=r;return c&&(this.parent.children.forEach(function(e){"group"!==e.type&&e.projectItemVO&&(e.projectItemVO.transformZIndex=t.parent.getChildIndex(e))}),this.parent.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)),c}return!1},Gx.prototype.moveBackwards=function(){return this.changeItemIndex("backwards")},Gx.prototype.moveForwards=function(){return this.changeItemIndex("forwards")},Gx.prototype.updateItemBoundsData=function(){if(this.accurateBounds&&this.parent){var e=BFN.Util.getTransformItemBounds(this,!!this.accurateBounds.noBounds),t=new BFN.Rectangle;t.left=e.minX+this.accurateBounds.minX,t.right=e.minX+this.accurateBounds.minX+this.accurateBounds.width,t.top=e.minY+this.accurateBounds.minY,t.bottom=e.minY+this.accurateBounds.minY+this.accurateBounds.height;var n=this.globalPolygon,i=Math.sqrt(Math.pow(n[0].x-n[1].x,2)+Math.pow(n[0].y-n[1].y,2)),r=Math.sqrt(Math.pow(n[1].x-n[2].x,2)+Math.pow(n[1].y-n[2].y,2));this.itemBoundsData={item:this,bounds:t,globalPolygon:n,globalPolygonW:i,globalPolygonH:r,localPolygon:this.localBorderPolygon}}else this.itemBoundsData=null},Gx.prototype.updateItemGroupData=function(){if(this.parent){var e=BFN.TransformItemGroup;if(0!==e.rotation&&e.isStretchable){var t=BFN.Util.rotatePoint(new PIXI.Point(e.x,e.y),new PIXI.Point(this.x,this.y),-e.rotation);this.itemGroupData.dx=t.x-e.x,this.itemGroupData.dy=t.y-e.y,this.itemGroupData.rr=this.rotation-e.rotation}else this.itemGroupData.dx=this.x-e.x,this.itemGroupData.dy=this.y-e.y,this.itemGroupData.rr=this.rotation;this.itemGroupData.iv=!!e.isStretchable&&Math.abs(Math.cos(this.itemGroupData.rr))<e.oneTenthDegree,this.itemGroupData.sx=this.scale.x,this.itemGroupData.sy=this.scale.y,this.itemGroupData.bw=this.bounds.width,this.itemGroupData.bh=this.bounds.height,this.itemGroupData.dz=this.parent.getChildIndex(this),this.itemGroupData.bm=this.itemBlendMode,this.itemGroupData.dd=Math.sqrt(Math.pow(this.itemGroupData.dx,2)+Math.pow(this.itemGroupData.dy,2)),this.itemGroupData.bt=Math.atan2(this.itemGroupData.dy,this.itemGroupData.dx)}},Gx.prototype.preloadThumbnail=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.thumbImage||"text"===this.type||setTimeout(function(){if(!e.thumbImage){var t=BFN.TransformStateModel.getThumb(e),n=BFN.Util.getHTMLImage(t,null,!0);t.destroyGC(!0),e.thumbImage=n}},t)},Gx.prototype.addPresetItemThumbTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:performance.now();if(!(!e||e&&e.hasOwnProperty("fabricShape"))){var n=new PIXI.Texture(e),i=BFN.PhotoEditorMenuModel.getPresetItemThumbTexture(n);n.destroy(!1),i&&(i.creationTime=t,i.originalBaseTexture=e,this.presetItemThumbTextures.push(i),this.presetItemThumbTextures.sort(function(e,t){return e.timestamp-t.timestamp}))}},Gx.prototype.getPresetItemThumbTexture=function(){var e=null;if(this.presetItemThumbTextures.length&&this.currentTransformItemStateVO)for(var t=0;t<this.presetItemThumbTextures.length;t++){var n=this.presetItemThumbTextures[t];n.creationTime<=this.currentTransformItemStateVO.creationTime&&(e=n)}return e},Gx.prototype.destroyPresetItemThumbTextures=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=this.presetItemThumbTextures.length;--t>-1;){var n=this.presetItemThumbTextures[t];n.creationTime>=e&&(n.destroy(!0),this.presetItemThumbTextures.splice(t,1))}this.presetItemThumbTextures.sort(function(e,t){return e.timestamp-t.timestamp})},Gx.prototype.handleCanvasScalingUpdated=function(e){this.canvasScaling||this.updateHitArea(),this.updateSmoothingScale()},Object.defineProperty(Gx.prototype,"itemWidth",{get:function(){return this.itemContent.width}}),Object.defineProperty(Gx.prototype,"itemHeight",{get:function(){return this.itemContent.height}}),Object.defineProperty(Gx.prototype,"globalPolygon",{get:function(){for(var e=[],t=0;t<this.polygon.length;t++){var n=this.polygon[t],i=BFN.MainUI.toLocal(n,this);e.push(i)}return e}}),Object.defineProperty(Gx.prototype,"globalBorderPolygon",{get:function(){if(!(this.itemContentBorder&&this.itemContentBorder.isFrameBorder&&this.borderBasicShapeVO.strokeWidth>0&&-1!==this.borderBasicShapeVO.stroke))return this.globalPolygon;for(var e=[],t=0;t<this.polygon.length;t++){var n=this.polygon[t].clone();n.x+=this.borderBasicShapeVO.strokeWidth*(t%3?1:-1),n.y+=this.borderBasicShapeVO.strokeWidth*(Math.floor(t/2)?1:-1);var i=BFN.MainUI.toLocal(n,this);e.push(i)}return e}}),Object.defineProperty(Gx.prototype,"globalTextPolygon",{get:function(){if("text"===this.type){for(var e=[],t=0;t<this.textPolygon.length;t++){var n=this.textPolygon[t],i=BFN.MainUI.toLocal(n,this);e.push(i)}return e}return null}}),Object.defineProperty(Gx.prototype,"localPolygon",{get:function(){for(var e=[],t=0;t<this.polygon.length;t++){var n=this.polygon[t],i=this.transformLayer.toLocal(n,this);e.push(i)}return e}}),Object.defineProperty(Gx.prototype,"localBorderPolygon",{get:function(){if(!(this.itemContentBorder&&this.itemContentBorder.isFrameBorder&&this.borderBasicShapeVO.strokeWidth>0&&-1!==this.borderBasicShapeVO.stroke))return this.localPolygon;for(var e=[],t=0;t<this.polygon.length;t++){var n=this.polygon[t].clone();n.x+=this.borderBasicShapeVO.strokeWidth*(t%3?1:-1),n.y+=this.borderBasicShapeVO.strokeWidth*(Math.floor(t/2)?1:-1);var i=this.transformLayer.toLocal(n,this);e.push(i)}return e}}),Object.defineProperty(Gx.prototype,"localTextPolygon",{get:function(){if("text"===this.type){for(var e=[],t=0;t<this.textPolygon.length;t++){var n=this.textPolygon[t],i=this.transformLayer.toLocal(n,this);e.push(i)}return e}return null}}),Object.defineProperty(Gx.prototype,"align",{set:function(e){this._align=e,this.dispatchEvent(BFN.TransformItemEvents.ITEM_DISPLAY_UPDATED),this._align=null},get:function(){return this._align}}),Object.defineProperty(Gx.prototype,"textOutlineEnabled",{set:function(e){this.iText&&(this.iText.outlineEnabled=!!e)},get:function(){return!!this.iText&&!!this.iText.outlineEnabled}}),Object.defineProperty(Gx.prototype,"textHighlightEnabled",{set:function(e){this.iText&&(this.iText.highlightEnabled=!!e)},get:function(){return!!this.iText&&!!this.iText.highlightEnabled}}),Object.defineProperty(Gx.prototype,"borderEnabled",{set:function(e){this._borderEnabled!==!!e&&this.borderBasicShapeVO&&(this._borderEnabled=!!e)},get:function(){return this._borderEnabled}}),Object.defineProperty(Gx.prototype,"overlayColorEnabled",{set:function(e){this._overlayColorEnabled!==!!e&&(this._overlayColorEnabled=!!e,this.overlayColor=this.overlayColor,this.overlayColorIntensity=this.overlayColorIntensity)},get:function(){return this._overlayColorEnabled}}),Object.defineProperty(Gx.prototype,"overlayColor",{set:function(e){this._overlayColor=e,this.itemContent.fillColor=-1!=this._overlayColor&&this.overlayColorEnabled?parseInt("0x".concat(this._overlayColor)):0,BFN.MainUI.requestRender()},get:function(){return this._overlayColor}}),Object.defineProperty(Gx.prototype,"overlayColorIntensity",{set:function(e){this._overlayColorIntensity=e,this.itemContent.intensity=-1!=this._overlayColor&&this.overlayColorEnabled?this._overlayColorIntensity:0,BFN.MainUI.requestRender()},get:function(){return this._overlayColorIntensity}}),Object.defineProperty(Gx.prototype,"tintColorEnabled",{set:function(e){this._tintColorEnabled!==!!e&&(this._tintColorEnabled=!!e,this.tintColor=this.tintColor)},get:function(){return this._tintColorEnabled}}),Object.defineProperty(Gx.prototype,"tintColor",{set:function(e){this._tintColor=e,this.itemContent.tint=-1!==this._tintColor&&this.tintColorEnabled?parseInt("0x".concat(this._tintColor)):16777215,BFN.MainUI.requestRender()},get:function(){return this._tintColor}}),Object.defineProperty(Gx.prototype,"locked",{set:function(e){this._locked=e,this.updateBounds()},get:function(){return this._locked}}),Object.defineProperty(Gx.prototype,"isTransparent",{get:function(){return void 0===this._isTransparent&&(this._isTransparent=!1,"text"===this.type||this.isShape?this._isTransparent=!0:"texture"!==this.type&&"frame_texture"!==this.type||(this._isTransparent=this.itemContent.texture.determineTransparency())),this._isTransparent}}),Object.defineProperty(Gx.prototype,"canvasScale",{get:function(){switch(this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:return BFN.PhotoEditorCanvasModel.canvasScale;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:return BFN.CollageMakerCanvasModel.canvasScale;case BFN.AppModelViewStates.VIEWING_DESIGNER:return BFN.DesignerCanvasModel.canvasScale;default:return 1}}}),Object.defineProperty(Gx.prototype,"canvasScaling",{get:function(){switch(this.appViewState){case BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR:return BFN.PhotoEditorCanvasModel.canvasScaling;case BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER:return BFN.CollageMakerCanvasModel.canvasScaling;case BFN.AppModelViewStates.VIEWING_DESIGNER:return BFN.DesignerCanvasModel.canvasScaling;default:return!1}}}),Object.defineProperty(Gx.prototype,"itemName",{set:function(e){this.layerName=e||null,this.refreshItemName(),this.updateProjectItemVO()},get:function(){if(this.layerName)return this.layerName;if("text"===this.type&&!BFN.FabricManager.isDefaultText(this.iText.text)){var e=this.iText.text.substring(0,Math.min(15,this.iText.text.length));return e+=e.length<this.iText.text.length?"...":""}return BeFunky.LanguageManager.getStringReplacements("layer_".concat(this.layerType),{number:this.layerNum.toString()})}}),Object.defineProperty(Gx.prototype,"thumbImage",{set:function(e){this.handleThumbImageLoadedBind||(this.handleThumbImageLoadedBind=function(){this._thumbImage&&this._thumbImage.src&&this.refreshItemThumb()}.bind(this)),this._thumbImage&&this._thumbImage.removeEventListener("load",this.handleThumbImageLoadedBind),this._thumbImage=e,this._thumbImage&&(this._thumbImage.addEventListener("load",this.handleThumbImageLoadedBind),this.handleThumbImageLoadedBind())},get:function(){return this._thumbImage}}),Object.defineProperty(Gx.prototype,"assetOrigin",{get:function(){try{var e=this.projectItemVO.graphicID||this.projectItemVO.imageID||this.projectItemVO.maskImageID||null;if(e){var t=this.itemContent.texture.baseTexture.isTemplateAsset?"Template":BFN.UserActionManager.getAssetOrigin(e);if(t)return t}else if("texture"===this.type&&this.isGoodie&&this.isShape&&this.basicShapeVO)return"Basic Shape"}catch(e){}return""}}),Object.defineProperty(Gx.prototype,"itemInfo",{get:function(){var e="";if("text"===this.type){var t=this.iText?this.iText.text.length:"_",n=this.getTextStyleData(),i=(n?"mixed"===n.fontSize?"mixed"===n.fontSizeStart?n.fontSizeMin:n.fontSizeStart:n.fontSize:"_")||"_";this.duplicateData&&(t=this.duplicateData.textLength||t,i=this.duplicateData.fontSize||i),e="Text[Length:".concat(t,", Size:").concat(i,"px]")}else this.projectItemVO&&(this.projectItemVO.graphicID?e="Graphic":this.projectItemVO.imageID?e="Image":this.projectItemVO.maskImageID?(e="MaskImage",this.projectItemVO.basicShapeValues?e+="[".concat("BasicShape:"+BFN.formatKeyString(this.projectItemVO.basicShapeValues.type),"]"):this.projectItemVO.maskImageMaskID&&(e+="[".concat(BFN.formatKeyString(BFN.getImageType(this.projectItemVO.maskImageMaskID)),"]"))):this.projectItemVO.basicShapeValues&&(e="BasicShape:"+BFN.formatKeyString(this.projectItemVO.basicShapeValues.type)));return e}}),Object.defineProperty(Gx.prototype,"itemInfoLite",{get:function(){var e="";return"text"===this.type?e="Text":this.projectItemVO&&(this.projectItemVO.graphicID?e="Graphic":this.projectItemVO.imageID?e="Image":this.projectItemVO.maskImageID?(e="MaskImage",this.projectItemVO.basicShapeValues?e+="[BasicShape]":this.projectItemVO.maskImageMaskID&&(e+="[".concat(BFN.formatKeyString(BFN.getImageType(this.projectItemVO.maskImageMaskID)),"]"))):this.projectItemVO.basicShapeValues&&(e="BasicShape")),e}}),Object.defineProperty(Gx.prototype,"itemDimensions",{get:function(){var e=this.localPolygon,t=Math.round(Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2))),n=Math.round(Math.sqrt(Math.pow(e[2].x-e[1].x,2)+Math.pow(e[2].y-e[1].y,2)));return"".concat(t,"x").concat(n,"px")}}),Object.defineProperty(Gx.prototype,"textureDimensions",{get:function(){var e="?";return this.itemContent&&this.itemContent.texture&&this.itemContent.texture.baseTexture&&(e="".concat(this.itemContent.texture.baseTexture.width,"x").concat(this.itemContent.texture.baseTexture.height,"px"),this.itemContentMask&&this.itemContentMask.texture&&this.itemContentMask.texture.baseTexture&&(e+="[".concat(this.itemContentMask.texture.baseTexture.width,"x").concat(this.itemContentMask.texture.baseTexture.height,"px]"))),e}}),BFN.TransformItem=Gx,BFN.TransformItemGroupEvents={},Hx.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Hx.prototype.init=function(){BeFunky.log("TransformItemGroup Init"),this.initDefaultValues(),this.initItemContent(),this.initStrokeRectanglePool(),this.initFadeAnimator(),this.initContextMenu(),this.initLongPressValues()},Hx.prototype.initDefaultValues=function(){var e=this;this.interactive=!0,this.buttonMode=!0,this.type="group",this.oneTenthDegree=Math.PI/1800,this._canvasScale=1,this._selectedItems=[],this._selectedItemTypes=[],this.subSelectedItem=null,this.pendingTextItems=[],this.allowedKeys=[17,18,91,93],this.pressedKeys=[],this.selectedByMouse=!1,this.groupBounds=null,this.accurateBounds=null,this.accurateBoundsQueue=[],this.snapCoordinates=[],this.otherItemAccurateBoundsList=[],this.snapGapRects={},this.transitionID=null,this.transitionBatchID=null,this.accurateBoundsUpdating=!1,this.duplicatingGroup=!1,this._dropShadowVO=new BFN.DropShadowVO,this._dropShadowDefaultValues=this._dropShadowVO.getValues(),this._dropShadowMixedValues=[],this._dropShadowEmpty=!1,this.handleItemAccurateBoundsUpdatedBind=this.handleItemAccurateBoundsUpdated.bind(this),this.handleItemTextDisplayUpdatedBind=this.handleItemTextDisplayUpdated.bind(this),this.handleDocumentMouseDownBind=this.handleDocumentMouseDown.bind(this),this.handleDocumentMouseMoveBind=this.handleDocumentMouseMove.bind(this),this.handleDocumentMouseUpBind=this.handleDocumentMouseUp.bind(this),this.handleDocumentKeyDownBind=this.handleDocumentKeyDown.bind(this),this.handleDocumentKeyUpBind=this.handleDocumentKeyUp.bind(this),document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDownBind,!0),document.addEventListener("keydown",this.handleDocumentKeyDownBind,!0),window.addEventListener("blur",function(){!e.pressedKeys.length&&e.interactive||(e.pressedKeys.splice(0),e.interactive=!0,document.removeEventListener("keyup",e.handleDocumentKeyUpBind,!0))})},Hx.prototype.initItemContent=function(){this.itemContent=new PIXI.Sprite,this.addChild(this.itemContent),this.itemContent.texture=PIXI.RenderTexture.create(128,128),this.itemContent.texture.clear(),this.updateContentDimensions()},Hx.prototype.initStrokeRectanglePool=function(){this.strokeRectanglePoolHolder=new PIXI.Container,this.addChild(this.strokeRectanglePoolHolder),this.strokeRectanglePool=new BFN.StrokeRectanglePool(!1,!0,2,!0,4287274495,4287274495,"undashed_selection_line"),this.strokeRectanglePoolHolder.addChild(this.strokeRectanglePool)},Hx.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.setAnimatorFactor(1),this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this))},Hx.prototype.initContextMenu=function(){var e=this;this.contextMenu=document.getElementById("context_menu_transform_group");var t={delete_selection:{onClick:function(){n("transform_delete"),e.contextMenu.hide()},shortcutText:"Del"},duplicate_selection:{onClick:function(){return n("transform_duplicate")},hasDivider:!0,shortcutText:BFN.shortcutText("D")},align:{onClick:function(){},hasDivider:!0,children:{align_left:{onClick:function(){return n("transform_align_left")}},align_center:{onClick:function(){return n("transform_align_center")}},align_right:{onClick:function(){return n("transform_align_right")}},align_top:{onClick:function(){return n("transform_align_top")}},align_middle:{onClick:function(){return n("transform_align_middle")}},align_bottom:{onClick:function(){return n("transform_align_bottom")}}}},flip:{onClick:function(){},hasDivider:!0,children:{horizontal:{onClick:function(){return n("transform_flip_horizontal")}},vertical:{onClick:function(){return n("transform_flip_vertical")}}}},layer_order:{onClick:function(){},hasDivider:!0,children:{move_backwards:{onClick:function(){return n("transform_move_backwards")}},move_forwards:{onClick:function(){return n("transform_move_forwards")}}}},create_group:{onClick:function(){e.contextMenu.hide(),n("transform_create_group")}},add_to_group:{children:{}},remove_from_group:{children:{}}};function n(e){UITools.setControlValue(e,!0),UITools.applyToolControl(e),UITools.setControlValue(e,!1)}BeFunky.Params.isAdmin&&(t.patch={hasDivider:!0,children:{}}),BeFunky.contextMenu(this.contextMenu,t,{hideOnClick:!1}),BeFunky.Params.isAdmin&&this.contextMenu.hideButton("patch"),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},Hx.prototype.updateSelectedItems=function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1,r=this._selectedItems.length;--r>-1;){var a=this._selectedItems[r];t.includes(a)||(i=!0,this._selectedItems.splice(r,1))}t.forEach(function(t){e._selectedItems.includes(t)||(i=!0,e._selectedItems.push(t))}),this.updateSelectedItemTypes(),i&&(this.lastTransitionVO=null,this.updateGroupDisplay(n?0:1),BFN.TransformLayerManager.updateSelectedItems())},Hx.prototype.updateGroupDisplay=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.fadeAnimator.animationFactor;this.updateSelectedItemsRotation(),this.updateItemBoundsData(),this.strokeRectanglePool.clear(),this.strokeRectanglePool.setScales(this._canvasScale,1,1);var n=this.isStretchable,i=n&&this.selectedItemsRotation||0,r=Math.abs(i)>this.oneTenthDegree,a=n&&r?[]:null,o=null;if(this._selectedItems.forEach(function(e){var t=e.itemBoundsData;t&&(a?a.push.apply(a,v(t.localPolygon)):o?(o.left=Math.min(o.left,t.bounds.left),o.top=Math.min(o.top,t.bounds.top),o.right=Math.max(o.right,t.bounds.right),o.bottom=Math.max(o.bottom,t.bounds.bottom)):o=new BFN.Rectangle(t.bounds.x,t.bounds.y,t.bounds.width,t.bounds.height))}),a){var s=BFN.Util.rectFromPointCloud(a,i);o=new BFN.Rectangle(s.tl.x,s.tl.y,s.width,s.height)}if(o){if(this.selectedByMouse=!1,this.x=o.x,this.y=o.y,this.rotation=i,this.scale.x=1,this.scale.y=1,this.itemContent.width=o.width,this.itemContent.height=o.height,this.updateItemGroupData(),this.updateContentDimensions(),this.transformLayer){var l=this.transformLayer.canvas.transformIndicatorContainer;l.children.includes(this.strokeRectanglePoolHolder)||l.addChildAt(this.strokeRectanglePoolHolder,0);var u=l.toLocal(new PIXI.Point,this);this.strokeRectanglePoolHolder.x=u.x,this.strokeRectanglePoolHolder.y=u.y,this.strokeRectanglePoolHolder.rotation=this.rotation,this.strokeRectanglePoolHolder.scale.x=this.scale.x,this.strokeRectanglePoolHolder.scale.y=this.scale.y,this.strokeRectanglePool.rotation=-this.rotation,this.strokeRectanglePool.setScales(this._canvasScale,this.scale.x,this.scale.y)}this._selectedItems.forEach(function(t){var n=t.itemBoundsData,i=t.itemGroupData;n&&i&&e.strokeRectanglePool.add(n.item.x-e.x,n.item.y-e.y,n.globalPolygonW/e._canvasScale,n.globalPolygonH/e._canvasScale,n.item.rotation,!!i.iv)})}else this.strokeRectanglePoolHolder.parent&&this.strokeRectanglePoolHolder.parent.removeChild(this.strokeRectanglePoolHolder);this.fadeAnimator.animationFactor!==t&&this.fadeAnimator.setAnimatorFactor(Math.max(0,Math.min(1,t))),BFN.MainUI.requestRender()},Hx.prototype.updateSelectedItemTypes=function(){var e=this;this._selectedItemTypes.splice(0),this._selectedItems.forEach(function(t){var n=t.type;"texture"!==n&&"frame_texture"!==n||(n=t.isGoodie?t.basicShapeVO?"shape":"graphic":"texture"===n?"image":t.itemContentMask?"masked_image":"framed_image"),e._selectedItemTypes.includes(n)||e._selectedItemTypes.push(n)})},Hx.prototype.updateSelectedItemsRotation=function(){var e,t,n,i=this,r=function(e){if(e>=-Math.PI||e<=Math.PI)return e;for(;e<-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;return e},a=null;if(this._selectedItems.length){a=r(this._selectedItems[0].rotation);for(var o=1;o<this._selectedItems.length;o++){var s=r(this._selectedItems[o].rotation);if(e=a,t=s,n=void 0,n=Math.abs(t-e),!(Math.abs(Math.cos(n)*Math.sin(n))<i.oneTenthDegree)){a=null;break}Math.abs(s)<Math.abs(a)&&(a=s)}}this._selectedItemsRotation=a},Hx.prototype.updateItemBoundsData=function(){this._selectedItems.forEach(function(e){e.updateItemBoundsData()})},Hx.prototype.updateItemGroupData=function(){this._selectedItems.forEach(function(e){e.updateItemGroupData()})},Hx.prototype.toggleGroupItem=function(e){return this._selectedItems.includes(e)?(this.removeGroupItem(e),!1):(this.addGroupItem(e),!0)},Hx.prototype.addGroupItems=function(e){if(e&&e.length){var t=v(this._selectedItems);e.forEach(function(e){e&&e.parent&&!t.includes(e)&&t.push(e)}),this.updateSelectedItems(t),this.updateAccurateBounds()}},Hx.prototype.addGroupItem=function(e){if(e&&e.parent&&!this._selectedItems.includes(e)){var t=v(this._selectedItems);t.push(e),this.updateSelectedItems(t),this.updateAccurateBounds()}},Hx.prototype.removeGroupItem=function(e){var t=v(this._selectedItems),n=t.indexOf(e);if(-1!=n)if(t.splice(n,1),t.length<=1){if(this.transformLayer&&this.transformLayer.resetTransformItemGroup(),t.length){var i=t[0];i.selectedByMouse=!1,i.selectItem()}}else this.updateSelectedItems(t),this.updateAccurateBounds()},Hx.prototype.clearItems=function(){this.updateSelectedItems()},Hx.prototype.updateGroupTransform=function(){var e=this;this._selectedItems.forEach(function(t,n){var i=t.itemGroupData,r=i.dx*e.scale.x,a=i.dy*e.scale.y,o=Math.atan2(a,r),s=Math.sqrt(Math.pow(r,2)+Math.pow(a,2));t.x=e.x+Math.cos(o+e.rotation)*s,t.y=e.y+Math.sin(o+e.rotation)*s,t.rotation=i.rr+e.rotation,t.scale.x=i.sx*e.scale[i.iv?"y":"x"],t.scale.y=i.sy*e.scale[i.iv?"x":"y"],t.updateFrameTextureDisplay()});BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,function t(){if(BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,t),e.transformLayer){var n=e.transformLayer.canvas.transformIndicatorContainer.toLocal(new PIXI.Point,e);e.strokeRectanglePoolHolder.x=n.x,e.strokeRectanglePoolHolder.y=n.y,e.strokeRectanglePoolHolder.rotation=e.rotation,e.strokeRectanglePoolHolder.scale.x=e.scale.x,e.strokeRectanglePoolHolder.scale.y=e.scale.y,e.strokeRectanglePool.setScales(e._canvasScale,e.scale.x,e.scale.y)}}),BFN.MainUI.requestRender()},Hx.prototype.createGroup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this._selectedItems.length>1&&BFN.GroupManager.createGroup(e,this._selectedItems)},Hx.prototype.duplicateGroup=function(){var e=this;if(!(this.selectedItems.length<=1||!this.transformLayer||this.duplicatingGroup)){var t=this.transformLayer,n=v(this.selectedItems).sort(function(e,n){return t.children.indexOf(e)-t.children.indexOf(n)});t.deselectItem(),this.duplicatingGroup=!0,this.transitionID="duplicate_selection",this.transitionBatchID=this.transitionID+BeFunky.randomString(10),BFN.TransformStateModel.startBulkTransition(this.transitionBatchID);var i=null,r=[],a=function(e){e.duplicatedItem&&r.push(e.duplicatedItem),requestAnimationFrame(i)};t.addEventListener(BFN.TransformLayerEvents.ITEM_DUPLICATED.type,a),(i=function(){if(n.length){n.shift().duplicateItem()}else{t.removeEventListener(BFN.TransformLayerEvents.ITEM_DUPLICATED.type,a),e.duplicatingGroup=!1,BFN.TransformStateModel.stopBulkTransition();var i=new BFN.TransformItemTransitionVO;i.id=e.transitionID,i.batchIDPlaceholder=e.transitionBatchID,BFN.TransformStateModel.addTransition(i),e.transitionID=null,e.transitionBatchID=null,r.length>1&&BFN.GroupManager.selectItems(r)}})();var o=!1,s=10;!function t(){e.duplicatingGroup?(s>0?s--:o||(o=!0,UIToggler.toggleLoadScreen(!0,{isCancellable:!1})),requestAnimationFrame(t)):o&&(o=!1,UIToggler.toggleLoadScreen(!1))}()}},Hx.prototype.pressItem=function(e){BFN.TransformItemEvents.PRESS_ITEM.targetItem=this,BFN.TransformItemEvents.PRESS_ITEM.externalPress=!0,BFN.TransformItemEvents.PRESS_ITEM.data={},BFN.TransformItemEvents.PRESS_ITEM.data.originalEvent=e,this.dispatchEvent(BFN.TransformItemEvents.PRESS_ITEM)},Hx.prototype.initLongPressValues=function(){this.longPressOccurred=!1,this.handlePointerDownBind=this.handlePointerDown.bind(this),this.on("pointerdown",this.handlePointerDownBind)},Hx.prototype.handlePointerDown=function(e){this.initiateLongPress()},Hx.prototype.initiateLongPress=function(){var e=this;this.longPressOccurred=!1;BFN.LongPressManager.initiateLongPress(function(t){e.longPressOccurred=!0,setTimeout(function(){e.longPressOccurred=!1},0),document.dispatchEvent(new MouseEvent(BeFunky.pointerup)),e.transformLayer.transformTool.gizmoDragger.dragging&&e.transformLayer.transformTool.gizmoDragger.stopDrag(),e.pressItem(t)})},Hx.prototype.updateAccurateBounds=function(){var e=this;this.groupBounds=BFN.Util.getTransformItemBounds(this),this.accurateBounds=BFN.Util.getTransformItemBounds(this),this.accurateBounds.minX=0,this.accurateBounds.maxX=this.accurateBounds.width,this.accurateBounds.centerX=this.accurateBounds.width/2,this.accurateBounds.centerOffsetX=0,this.accurateBounds.minY=0,this.accurateBounds.maxY=this.accurateBounds.height,this.accurateBounds.centerY=this.accurateBounds.height/2,this.accurateBounds.centerOffsetY=0,this._selectedItems.length?(this.accurateBoundsUpdating=!0,this._selectedItems.forEach(function(t){t.removeEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,e.handleItemAccurateBoundsUpdatedBind),t.addEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,e.handleItemAccurateBoundsUpdatedBind),e.accurateBoundsQueue.includes(t)||e.accurateBoundsQueue.push(t)}),this._selectedItems.forEach(function(t){e.pendingTextItems.includes(t)||t.updateAccurateBounds()})):(this.accurateBoundsUpdatedCallback=null,this.isTextStyleTransition=!1)},Hx.prototype.handleItemAccurateBoundsUpdated=function(e){var t=e.dispatcher,n=this.accurateBoundsQueue.indexOf(t);if(t.removeEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind),-1!=n&&this.accurateBoundsQueue.splice(n,1),!this.accurateBoundsQueue.length&&this._selectedItems.length){this.isTextStyleTransition&&(this.isTextStyleTransition=!1,this.updateGroupDisplay(),this.groupBounds=BFN.Util.getTransformItemBounds(this));var i=null;this._selectedItems.forEach(function(e){var t=BFN.Util.getTransformItemBounds(e,!!e.accurateBounds.noBounds);i?(i.left=Math.min(i.left,t.minX+e.accurateBounds.minX),i.top=Math.min(i.top,t.minY+e.accurateBounds.minY),i.right=Math.max(i.right,t.minX+e.accurateBounds.minX+e.accurateBounds.width),i.bottom=Math.max(i.bottom,t.minY+e.accurateBounds.minY+e.accurateBounds.height)):i=new BFN.Rectangle(t.minX+e.accurateBounds.minX,t.minY+e.accurateBounds.minY,e.accurateBounds.width,e.accurateBounds.height)}),i&&(this.accurateBounds.minX=i.x-this.groupBounds.minX,this.accurateBounds.minY=i.y-this.groupBounds.minY,this.accurateBounds.maxX=this.accurateBounds.minX+i.width,this.accurateBounds.maxY=this.accurateBounds.minY+i.height,this.accurateBounds.width=this.accurateBounds.maxX-this.accurateBounds.minX,this.accurateBounds.height=this.accurateBounds.maxY-this.accurateBounds.minY,this.accurateBounds.left=this.accurateBounds.minX,this.accurateBounds.top=this.accurateBounds.minY,this.accurateBounds.right=this.groupBounds.maxX-i.right,this.accurateBounds.bottom=this.groupBounds.maxY-i.bottom,this.accurateBounds.centerX=this.accurateBounds.minX+this.accurateBounds.width/2,this.accurateBounds.centerY=this.accurateBounds.minY+this.accurateBounds.height/2,this.accurateBounds.centerOffsetX=this.accurateBounds.centerX-(this.groupBounds.centerX-this.groupBounds.minX),this.accurateBounds.centerOffsetY=this.accurateBounds.centerY-(this.groupBounds.centerY-this.groupBounds.minY)),this.accurateBoundsUpdatedCallback&&(this.accurateBoundsUpdatedCallback(),this.accurateBoundsUpdatedCallback=null),this.accurateBoundsUpdating=!1}},Hx.prototype.updateSmoothingScale=function(){this._selectedItems.forEach(function(e){e.updateSmoothingScale()})},Hx.prototype.updateContentDimensions=function(){this.itemContentW==this.itemContent.width&&this.itemContentH==this.itemContent.height||(this.itemContentW=this.itemContent.width,this.itemContentH=this.itemContent.height,this.updateBounds())},Hx.prototype.updateBounds=function(){this.bounds=new PIXI.Rectangle(0,0,this.itemContentW,this.itemContentH),this.polygon=[new PIXI.Point(0,0),new PIXI.Point(this.itemContentW,0),new PIXI.Point(this.itemContentW,this.itemContentH),new PIXI.Point(0,this.itemContentH)],this.updateHitArea()},Hx.prototype.updateHitArea=function(){this.hitArea=new PIXI.Rectangle(0,0,this.itemContentW,this.itemContentH),this._selectedItems.forEach(function(e){e.updateHitArea()})},Hx.prototype.toggleTransform=function(e){var t=this;if(this.parent&&this._selectedItems.length){var n=[];this._selectedItems.forEach(function(e){e.parent==t.parent&&n.push({item:e,dz:e.itemGroupData.dz,bm:e.itemGroupData.bm})}),n.sort(function(e,t){return e.dz-t.dz});for(var i=0;i<n.length;i++){var r=n[i].item,a=n[i].dz,o=n[i].bm;r.parent.setChildIndex(r,e?r.parent.children.length-2:a),r.itemContent.blendMode=e?BFN.CONST.BLEND_MODES.NORMAL:o,r.itemContentBorder&&r.itemContentBorder.isFrameBorder&&(r.itemContentBorder.blendMode=r.itemContent.blendMode)}}},Hx.prototype.updateHiResTextBounds=function(){this._selectedItems.forEach(function(e){e.updateHiResTextBounds(!1)})},Hx.prototype.updateHiResText=function(){this._selectedItems.forEach(function(e){BFN.HiResTextManager.processHiResTextItem(e)})},Hx.prototype.renderHiResText=function(){},Hx.prototype.removeItem=function(){this.transformLayer&&this.transformLayer.selectedItem==this&&this.transformLayer.removeItem(this)},Hx.prototype.alignItems=function(e){var t=this;if(this._align&&this.transformLayer&&this._selectedItems.length){var n=this.transformLayer.getItemSelectionBounds(this._selectedItems);if(!e){var i={left:-this.transformLayer.frameWidth/2,center:0,right:this.transformLayer.frameWidth/2,top:-this.transformLayer.frameHeight/2,middle:0,bottom:this.transformLayer.frameHeight/2};Math.abs(n[this._align]-i[this._align])<=1&&(e=!0,n[this._align]=i[this._align])}e?this._selectedItems.forEach(function(e){e._align=t._align,t.transformLayer.alignItem(e,n[t._align]),e._align=null}):(this.transformLayer.alignItem(this),this.updateGroupTransform()),this.updateGroupDisplay(),this.updateAccurateBounds(),this.transformLayer.transformTool.updateDisplay()}},Hx.prototype.setOverlayColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._selectedItems.forEach(function(n){n.overlayColor=e,n.overlayColorIntensity=t})},Hx.prototype.setTintColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._selectedItems.forEach(function(t){t.tintColor=e})},Hx.prototype.setBlendMode=function(e){this._selectedItems.forEach(function(t){t.setBlendMode(e)})},Hx.prototype.setOpacity=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._selectedItems.forEach(function(t){t.alpha=e/100}),BFN.MainUI.requestRender()},Hx.prototype.flipHorizontal=function(){this._selectedItems.forEach(function(e){e.flipHorizontal()}),BFN.MainUI.requestRender()},Hx.prototype.flipVertical=function(){this._selectedItems.forEach(function(e){e.flipVertical()}),BFN.MainUI.requestRender()},Hx.prototype.moveBackwards=function(){return this.changeItemIndex("backwards")},Hx.prototype.moveForwards=function(){return this.changeItemIndex("forwards")},Hx.prototype.changeItemIndex=function(e){var t=this;if(!this.parent||!this._selectedItems.length)return!1;var n=this.globalPolygon,i=[];if(this.parent.children.forEach(function(e){if(e!=t&&!t._selectedItems.includes(e)&&BFN.Util.polygonHitTest(n,e.globalPolygon)){var r=e.parent.getChildIndex(e);i.push({item:e,zIndex:r})}}),!i.length)return!1;i.sort(function(e,t){return e.zIndex-t.zIndex});var r=i[0].zIndex,a=i[i.length-1].zIndex,o=[];if(this._selectedItems.forEach(function(e){if(e.parent&&e.parent==t.parent){var n=e.parent.getChildIndex(e);o.push({item:e,zIndex:n})}}),!o.length)return!1;o.sort(function(e,t){return e.zIndex-t.zIndex});var s=o[0].zIndex,l=o[o.length-1].zIndex,u=null,c=-1;switch(e){case"backwards":if(l<r)return!1;for(var h=0;h<i.length;h++){i[h].zIndex<l&&(u=i[h].item,c=l)}break;case"forwards":if(s>a)return!1;for(var d=i.length;--d>-1;){i[d].zIndex>s&&(u=i[d].item,c=s)}}return!(!u||-1==c)&&(u.createTransition("history_layer_order",!1,!0),u.parent.setChildIndex(u,c),u.registerTransition(!1,!1),i.forEach(function(e){e.item.updateItemGroupData()}),o.forEach(function(e){e.item.updateItemGroupData()}),u.parent.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED),!0)},Hx.prototype.updateHitAreaOrTextWidths=function(){var e=this;this._selectedItems.forEach(function(t){"text"===t.type?e.pendingTextItems.push(t):t.basicShapeVO?t.updateContentDimensions():t.updateHitArea()}),this.processPendingTextItems()},Hx.prototype.processPendingTextItems=function(){if(this.pendingTextItems.length){var e=this.pendingTextItems[0];e.addEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleItemTextDisplayUpdatedBind),e.setTextWidth(e.itemGroupData.bw*this.scale.x,!0),e.itemGroupData.sx=e.scale.x/this.scale.x,e.itemGroupData.sy=e.scale.y/this.scale.y}},Hx.prototype.handleItemTextDisplayUpdated=function(e){this.pendingTextItems[0].removeEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,this.handleItemTextDisplayUpdatedBind),this.pendingTextItems.shift(),requestAnimationFrame(this.processPendingTextItems.bind(this))},Hx.prototype.updateFrameTextureDisplay=function(){},Hx.prototype.resetFrameTextureScale=function(){var e=this;this._selectedItems.forEach(function(t){t.resetFrameTextureScale(),t.itemGroupData.sx=t.scale.x/e.scale[t.itemGroupData.iv?"y":"x"],t.itemGroupData.sy=t.scale.y/e.scale[t.itemGroupData.iv?"x":"y"]})},Hx.prototype.updateShapeTexture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._selectedItems.forEach(function(t){t.updateShapeTexture(e)})},Hx.prototype.updateBorderTexture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._selectedItems.forEach(function(t){t.updateBorderTexture(e)})},Hx.prototype.updateDropShadowValues=function(){var e=this;this._dropShadowMixedValues.splice(0),this._dropShadowEmpty=!1;var t=null;this._selectedItems.forEach(function(n){if(t)for(var i in t.color===e._dropShadowDefaultValues.color&&(e._dropShadowEmpty=!0),t)e._dropShadowMixedValues.includes(i)||t[i]!==n.dropShadowVO[i]&&(e._dropShadowMixedValues.push(i),t[i]=e._dropShadowDefaultValues[i]);else t=n.dropShadowVO.getValues()}),this._dropShadowVO.setValues(t||this._dropShadowDefaultValues)},Hx.prototype.setDropShadowValues=function(e,t){if(this._dropShadowVO[e]=t,this._selectedItems.forEach(function(n){n.dropShadowVO[e]=t}),"enabled"===e&&t){var n=BFN.TransformModel.defaultDropShadowVO.getValues();delete n.enabled,this._selectedItems.forEach(function(e){-1===e.dropShadowVO.color&&e.dropShadowVO.setValues(n)}),this.updateDropShadowValues()}},Hx.prototype.clearDropShadow=function(){this._selectedItems.forEach(function(e){e.clearDropShadow()})},Hx.prototype.createTransition=function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.transitionID&&this.transitionID!=e&&(this.lastTransitionVO=null),this.lastTransitionVO&&this.lastTransitionVO.id!=e&&(this.lastTransitionVO=null),this.transitionID=e,this.transitionBatchID=this.transitionID+BeFunky.randomString(10),BFN.TransformStateModel.startBulkTransition(this.transitionBatchID),n&&this._selectedItems.forEach(function(e){e.isGroupTransition=!0,e.createTransition(t.transitionID),delete e.isGroupTransition})},Hx.prototype.registerTransition=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.accurateBoundsUpdatedCallback=t?i:null,this.isTextStyleTransition=r,n&&this._selectedItems.forEach(function(n){n.registerTransition(e,t)}),BFN.TransformStateModel.stopBulkTransition();var a=function(){var e=new BFN.TransformItemTransitionVO;return e.id=this.transitionID,e.batchIDPlaceholder=this.transitionBatchID,BFN.TransformStateModel.addTransition(e),e}.bind(this);e?(this.lastTransitionVO||(this.lastTransitionVO=a()),t&&this.updateAccurateBounds()):(this.lastTransitionVO=null,a(),t&&this.updateAccurateBounds()),this.transitionID=null,this.transitionBatchID=null},Hx.prototype.getGroupItemData=function(){var e=["overlayColor","tintColor","borderColor","shapeFillBak","shapeStrokeBak"],t={};e.forEach(function(e){t["".concat(e,"Empty")]=!1});var n=function(n,i){if(e.includes(n)&&-1==i&&(t["".concat(n,"Empty")]=!0),t.hasOwnProperty(n)){if(t[n]!=i)switch(n){case"shapeStrokeWidth":t[n]!==i&&(t.shapeStrokeWidthMixed=!0),t[n]=Math.max(t[n],i);break;case"shapeHideFill":case"shapeHideStroke":t[n]=!(!t[n]&&!i);break;case"borderThickness":t[n]!==i&&(t.borderThicknessMixed=!0),t[n]=Math.max(t[n],i);break;default:t[n]="mixed"}}else t[n]=i};return this.selectedItems.forEach(function(e){n("opacity",Math.round(100*e.alpha)),n("blendMode",e.itemBlendMode),n("overlayColorEnabled",e.overlayColorEnabled),n("overlayColor",e.overlayColor),n("overlayColorIntensity",e.overlayColorIntensity),n("tintColorEnabled",e.tintColorEnabled),n("tintColor",e.tintColor),e.basicShapeVO&&(n("shapeFill",e.basicShapeVO.fill),n("shapeFillExists",-1!==e.basicShapeVO.fill),n("shapeFillAlpha",e.basicShapeVO.fillAlpha),n("shapeStroke",e.basicShapeVO.stroke),n("shapeStrokeExists",-1!==e.basicShapeVO.stroke),n("shapeStrokeAlpha",e.basicShapeVO.strokeAlpha),n("shapeStrokeWidth",e.basicShapeVO.strokeWidth),n("shapeFillBak",e.basicShapeVO.fillBak),n("shapeStrokeBak",e.basicShapeVO.strokeBak),n("shapeHideFill",["line"].includes(e.basicShapeVO.type)),n("shapeHideStroke",["star","arrow"].includes(e.basicShapeVO.type))),e.borderBasicShapeVO?(n("borderEnabled",e.borderEnabled),n("borderColor",e.borderBasicShapeVO.stroke),n("borderAlpha",e.borderBasicShapeVO.strokeAlpha),n("borderThickness",e.borderBasicShapeVO.strokeWidth)):t.borderHide||(t.borderHide=!0)}),t},Hx.prototype.getTextGroupStyleData=function(){var e={};return"text"===this.groupType&&this.selectedItems.forEach(function(t){t.getTextStyleData(e)}),e},Hx.prototype.handleDocumentMouseDown=function(e){if(e.target instanceof HTMLCanvasElement&&2!=e.button){if(BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture)return;if(BFN.AppModel.viewingEditor&&BFN.PhotoEditorCanvasModel.viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)return;if(BFN.PhotoEditorCanvasModel.viewState!=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)return;if(BFN.TransformItemIsolator.active)return;if(BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.active)return;this.documentMouseDownPoint={x:e.pageX,y:e.pageY},this.documentMouseMoved=!1,this.allowSelectionDrag=!1,this.eraseSelection=!1,document.addEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0)}},Hx.prototype.handleDocumentMouseMove=function(e){var t=!1,n=!0;if(BFN.ActiveDraggers.forEach(function(e){t=e.preventSelectionDrag||t,n=e.deselectItemGroup&&n}),t=!(!t&&!BFN.preventSelectionDrag),BFN.preventSelectionDrag=!1,t)return document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0),void(n&&this.transformLayer&&this.transformLayer.children.includes(this)&&this.transformLayer.resetTransformItemGroup());if(!this.documentMouseMoved){this.documentMouseMoved=!0;var i=e.ctrlKey||e.metaKey||e.altKey;this.allowSelectionDrag=!BFN.ActiveDraggers.length,BFN.AppModel.viewingEditor&&BFN.ActiveDraggers.includes(BFN.PhotoEditorCanvas.canvasDragger)&&(!BFN.PhotoEditorCanvas.canvasDragger.validDrag||i)&&(BFN.PhotoEditorCanvas.canvasDragger.stopDrag(),this.allowSelectionDrag=!0),i&&(BFN.ActiveDraggers.forEach(function(e){e.stopDrag()}),this.allowSelectionDrag=!0),this.allowSelectionDrag&&e.altKey&&(this.eraseSelection=!0)}var r=e.pageX-this.documentMouseDownPoint.x,a=e.pageY-this.documentMouseDownPoint.y;if(Math.sqrt(Math.pow(r,2)+Math.pow(a,2))>5&&(document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),this.allowSelectionDrag&&!BFN.FabricManager.currentTextTransformItem)){var o=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer);o.textTransformItem=null;var s=[];o.lastDeselectedItem&&"group"!=o.lastDeselectedItem.type&&(e.metaKey||e.ctrlKey)&&s.push(o.lastDeselectedItem),o.selectedItem&&"group"!=o.selectedItem.type&&!s.includes(o.selectedItem)&&s.push(o.selectedItem),o.deselectItem(!(e.ctrlKey||e.metaKey)),o.startGroupSelection(e.ctrlKey||e.metaKey||this.eraseSelection,this.eraseSelection,s),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0)}},Hx.prototype.handleDocumentMouseUp=function(e){document.removeEventListener(BeFunky.pointermove,this.handleDocumentMouseMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handleDocumentMouseUpBind,!0),this.transformLayer&&(this.transformLayer.updateTransformItemGroup(),delete this.transformLayer.lastDeselectedItem)},Hx.prototype.handleDocumentKeyDown=function(e){this.allowedKeys.includes(e.keyCode)&&!this.pressedKeys.includes(e.keyCode)&&(this.pressedKeys.push(e.keyCode),this.interactive&&(this.interactive=!1,document.addEventListener("keyup",this.handleDocumentKeyUpBind,!0)))},Hx.prototype.handleDocumentKeyUp=function(e){this.interactive||(this.allowedKeys.includes(e.keyCode)&&this.pressedKeys.includes(e.keyCode)&&this.pressedKeys.splice(this.pressedKeys.indexOf(e.keyCode),1),this.pressedKeys.length||(this.interactive=!0,document.removeEventListener("keyup",this.handleDocumentKeyUpBind,!0)))},Hx.prototype.handleFadeAnimatorUpdate=function(e){this.strokeRectanglePool.alpha=this.fadeAnimator.animationFactor,this.strokeRectanglePool.visible=this.fadeAnimator.animationFactor>0},Object.defineProperty(Hx.prototype,"itemWidth",{get:function(){return this.itemContent.width}}),Object.defineProperty(Hx.prototype,"itemHeight",{get:function(){return this.itemContent.height}}),Object.defineProperty(Hx.prototype,"groupType",{get:function(){var e=null,t=!0;return this.selectedItems.forEach(function(n){var i=n.type;"texture"===i||"frame_texture"===i?i=n.isGoodie?n.basicShapeVO?"shape":"graphic":"image":t=!1,e?e!==i&&(e="mixed","shape"===i&&(t=!1)):e=i}),"mixed"===e&&t&&(e="graphic_image_mix"),e}}),Object.defineProperty(Hx.prototype,"basicShapeVO",{get:function(){return"shape"===this.groupType?(this._basicShapeVO||(this._basicShapeVO=new BFN.BasicShapeVO("group")),this._basicShapeVO):null}}),Object.defineProperty(Hx.prototype,"borderBasicShapeVO",{get:function(){return"image"===this.groupType?(this._borderBasicShapeVO||(this._borderBasicShapeVO=new BFN.BasicShapeVO("group")),this._borderBasicShapeVO):null}}),Object.defineProperty(Hx.prototype,"dropShadowVO",{get:function(){return this._dropShadowVO}}),Object.defineProperty(Hx.prototype,"dropShadowMixedValues",{get:function(){return this._dropShadowMixedValues}}),Object.defineProperty(Hx.prototype,"dropShadowEmpty",{get:function(){return this._dropShadowEmpty}}),Object.defineProperty(Hx.prototype,"globalPolygon",{get:function(){for(var e=[],t=0;t<this.polygon.length;t++){var n=this.polygon[t],i=BFN.MainUI.toLocal(n,this);e.push(i)}return e}}),Object.defineProperty(Hx.prototype,"globalBorderPolygon",{get:function(){return this.globalPolygon}}),Object.defineProperty(Hx.prototype,"localPolygon",{get:function(){if(!this.transformLayer)return[0,0,0,0];for(var e=[],t=0;t<this.polygon.length;t++){var n=this.polygon[t],i=this.transformLayer.toLocal(n,this);e.push(i)}return e}}),Object.defineProperty(Hx.prototype,"selectedItems",{get:function(){return this._selectedItems}}),Object.defineProperty(Hx.prototype,"selectedItemsRotation",{get:function(){return this._selectedItemsRotation}}),Object.defineProperty(Hx.prototype,"selectedItemTypes",{get:function(){return this._selectedItemTypes}}),Object.defineProperty(Hx.prototype,"isStretchable",{get:function(){return!this._selectedItemTypes.includes("text")&&null!==this._selectedItemsRotation}}),Object.defineProperty(Hx.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.strokeRectanglePool.setScales(this._canvasScale,this.scale.x,this.scale.y),this.transformLayer&&this.updateGroupTransform()},get:function(){return this._canvasScale}}),Object.defineProperty(Hx.prototype,"align",{set:function(e){this._align=e,this.alignItems(BeFunky.globalPointerEvent.ctrlKey||BeFunky.globalPointerEvent.metaKey),this._align=null},get:function(){return this._align}}),Object.defineProperty(Hx.prototype,"groupInfo",{get:function(){var e={};this.selectedItems.forEach(function(t){var n=t.itemInfoLite;e[n]||(e[n]=0),e[n]++});var t=[];for(var n in e)t.push("".concat(n,"(").concat(e[n],")"));return t.sort(),t.join("/")}}),Object.defineProperty(Hx.prototype,"groupInfoLite",{get:function(){return"".concat(BFN.formatKeyString(this.groupType)," ( ").concat(this.selectedItems.length," Count )")}}),Object.defineProperty(Hx.prototype,"groupDimensions",{get:function(){var e=this.localPolygon,t=Math.round(Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2))),n=Math.round(Math.sqrt(Math.pow(e[2].x-e[1].x,2)+Math.pow(e[2].y-e[1].y,2)));return"".concat(t,"x").concat(n,"px")}}),BFN.SingletonQueue.add(function(){BFN.TransformItemGroup=new Hx}),zx.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),zx.prototype.init=function(){BeFunky.log("TransformItemIsolator Init"),this.initDefaultValues(),this.initBackground(),this.initItem(),this.initAnimators()},zx.prototype.initDefaultValues=function(){this.interactive=!1,this.canvasModel=null,this.canvas=null,this.transformParamsStart={},this.transformParamsEnd={},this.itemTextureFrame=new BFN.Rectangle,this.reselectOnReleaseComplete=!0,this.backgroundContainerActive=!0,this.shiftParamsStart={x:0,y:0,w:0,h:0},this.shiftParamsEnd={x:0,y:0,w:0,h:0},this.usingAlternateMenu=!1,this.imageLayerEdited=!1,this._itemWidth=0,this._itemHeight=0,this.handleIsolatedItemThumbUpdatedBind=BeFunky.debounce(this.handleIsolatedItemThumbUpdated.bind(this),"raf"),this.handleCanvasScaleUpdatedBind=this.handleCanvasScaleUpdated.bind(this),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handlePhotoEditorCanvasViewstateUpdated.bind(this))},zx.prototype.initBackground=function(){this.backgroundContainer=new PIXI.Container,this.addChild(this.backgroundContainer),this.backgroundTexture=PIXI.RenderTexture.create(32,32),this.backgroundSprite=new PIXI.Sprite(this.backgroundTexture),this.backgroundSprite.pluginName="smooth_picture",this.backgroundContainer.addChild(this.backgroundSprite)},zx.prototype.initItem=function(){this.itemTexture=PIXI.RenderTexture.create(32,32),this.itemSprite=new PIXI.Sprite(this.itemTexture),this.itemSprite.visible=!1,this.itemSprite.pluginName="smooth_picture",this.itemSprite.anchor.x=this.itemSprite.anchor.y=.5,this.addChild(this.itemSprite),this.itemSpriteOffset=new PIXI.Point},zx.prototype.initAnimators=function(){this.isolationAnimator=new BFN.Animator,this.isolationAnimator.linearSteps=32,this.isolationAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleIsolationAnimatorUpdate.bind(this)),this.isolationAnimator.addEventListener(BFN.AnimatorEvents.INCREASE_COMPLETE.type,this.handleIsolationAnimatorIncreaseComplete.bind(this)),this.isolationAnimator.addEventListener(BFN.AnimatorEvents.DECREASE_COMPLETE.type,this.handleIsolationAnimatorDecreaseComplete.bind(this)),this.shiftAnimator=new BFN.Animator,this.shiftAnimator.linearSteps=8,this.shiftAnimator.setAnimatorFactor(1),this.shiftAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleShiftAnimatorUpdate.bind(this)),this.shiftAnimator.addEventListener(BFN.AnimatorEvents.INCREASE_COMPLETE.type,this.handleShiftAnimatorIncreaseComplete.bind(this))},zx.prototype.isolateTransformItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!!e!=!!this.isolatedTransformItem){e&&(this.isolatedCallback=t,this.releasedCallback=n,this.usingAlternateMenu=i),this.canvasModel=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),this.canvas=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);var r=this.canvas.transformItemIsolatorContainer,a=this.canvas.transformLayer;if(!e||e.isGoodie||"texture"!==e.type&&"frame_texture"!==e.type||(this.isolatedTransformItem=e,this.isolatedTransformItem.deselectItem(),r.addChild(this),BFN.CollageMakerCanvas.canvasScaleBars.active=!1,BFN.GlobalHistoryModel.updateGlobalHistoryButtons()),!e&&this.isolatedTransformItem){var o=0,s=0,l=0,u=0;switch(this.canvasModel){case BFN.PhotoEditorCanvasModel:o=2*this.canvasModel.imageFitPaddingX,s=2*this.canvasModel.imageFitPaddingY,l=BFN.PhotoEditorCanvas.canvasImage.width,u=BFN.PhotoEditorCanvas.canvasImage.height;break;case BFN.CollageMakerCanvasModel:o=2*this.canvasModel.collageFitPaddingX,s=2*this.canvasModel.collageFitPaddingY,l=BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth,u=BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight;break;case BFN.DesignerCanvasModel:o=2*this.canvasModel.designerFitPaddingX,s=2*this.canvasModel.designerFitPaddingY,l=BFN.DesignerCanvas.canvasWidth,u=BFN.DesignerCanvas.canvasHeight}return this.transformParamsStart.canvasScale=l&&u?Math.min(1,(BFN.StageModel.stageW-o)/l,(BFN.StageModel.stageH-s)/u):1,UITools.setControlValue("layer_isolator_display_canvas",!0),UITools.updateToolControl("layer_isolator_display_canvas"),UITools.applyTool("layer"),this.canvasModel.disregardScaleRange=!0,this.canvasModel.canvasScaling=!0,this.transformParamsEnd.canvasScale=this.canvasModel.canvasScale,this.itemSprite.visible=!0,UIToggler.toggleMainMenu(!1),this.isolationAnimator.decrease(),this.isolatedTransformItem.removeEventListener(BFN.TransformItemEvents.THUMB_UPDATED.type,this.handleIsolatedItemThumbUpdatedBind),void(this.imageLayerEdited&&(this.trackImageLayerEdited(),this.imageLayerEdited=!1))}if(this.imageLayerEdited=!1,BFN.TransformGuides.updateVisibility(),this.isolatedTransformItem){this.isolatedTransformItem.renderable=!1;var c=a.layerBounds;c||(c=new BFN.Rectangle);var h=function(e,t){c.left=Math.min(c.left,-e/2),c.right=Math.max(c.right,e/2),c.top=Math.min(c.top,-t/2),c.bottom=Math.max(c.bottom,t/2)};switch(this.canvas){case BFN.PhotoEditorCanvas:h(BFN.PhotoEditorCanvas.canvasImage.imageWidth,BFN.PhotoEditorCanvas.canvasImage.imageHeight);break;case BFN.CollageMakerCanvas:h(BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth,BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight);break;case BFN.DesignerCanvas:h(BFN.DesignerCanvas.canvasWidth,BFN.DesignerCanvas.canvasHeight)}if(c.width&&c.height){var d=Math.min(1,BFN.maxImageSize/c.width,BFN.maxImageSize/c.height),m=Math.round(c.width*d),p=Math.round(c.height*d);switch(this.backgroundTexture.resize(m,p),this.canvas){case BFN.PhotoEditorCanvas:var g=this.canvas.canvasImage.currentScale;this.canvas.canvasImage.currentScale=d,this.canvas.canvasImage.x=(-c.x-this.canvas.canvasImage.imageWidth/2)*d,this.canvas.canvasImage.y=(-c.y-this.canvas.canvasImage.imageHeight/2)*d,this.canvas.canvasImage.scale.x=this.canvas.canvasImage.scale.y=d,BFN.Stage.render(this.canvas.canvasImage,this.backgroundTexture,!0),this.canvas.canvasImage.currentScale=g,this.canvas.canvasImage.x=0,this.canvas.canvasImage.y=0,this.canvas.canvasImage.scale.x=this.canvas.canvasImage.scale.y=1;break;case BFN.CollageMakerCanvas:var f={backgroundX:this.canvas.background.x,backgroundY:this.canvas.background.y,gridScale:this.canvas.canvasPhotoGrid.canvasScale,gridX:this.canvas.canvasPhotoGrid.x,gridY:this.canvas.canvasPhotoGrid.y};this.canvas.background.x=-(this.canvas.canvasPhotoGrid.gridWidth/2+c.x*d),this.canvas.background.y=-(this.canvas.canvasPhotoGrid.gridHeight/2+c.y*d),this.canvas.background.scale.x=this.canvas.canvasPhotoGrid.gridWidth/this.canvas.background.itemWidth,this.canvas.background.scale.y=this.canvas.canvasPhotoGrid.gridHeight/this.canvas.background.itemHeight,BFN.Stage.render(this.canvas.background,this.backgroundTexture,!0),this.canvas.background.x=f.backgroundX,this.canvas.background.y=f.backgroundY,this.canvas.background.scale.x=this.canvas.background.scale.y=1,this.canvas.canvasPhotoGrid.canvasScale=d,this.canvas.canvasPhotoGrid.x=-c.x*d,this.canvas.canvasPhotoGrid.y=-c.y*d,this.canvas.canvasPhotoGrid.scale.x=this.canvas.canvasPhotoGrid.scale.y=d,BFN.Stage.render(this.canvas.canvasPhotoGrid,this.backgroundTexture,!1),this.canvas.canvasPhotoGrid.canvasScale=f.gridScale,this.canvas.canvasPhotoGrid.x=f.gridX,this.canvas.canvasPhotoGrid.y=f.gridY,this.canvas.canvasPhotoGrid.scale.x=this.canvas.canvasPhotoGrid.scale.y=1;break;case BFN.DesignerCanvas:var v={backgroundX:this.canvas.background.x,backgroundY:this.canvas.background.y};this.canvas.background.x=-(this.canvas.canvasWidth/2+c.x*d),this.canvas.background.y=-(this.canvas.canvasHeight/2+c.y*d),this.canvas.background.scale.x=this.canvas.canvasWidth/this.canvas.background.itemWidth,this.canvas.background.scale.y=this.canvas.canvasHeight/this.canvas.background.itemHeight,BFN.Stage.render(this.canvas.background,this.backgroundTexture,!0),this.canvas.background.x=v.backgroundX,this.canvas.background.y=v.backgroundY,this.canvas.background.scale.x=this.canvas.background.scale.y=1}var y=new PIXI.Point(a.x,a.y);a.x=-c.x*d,a.y=-c.y*d,a.scale.x=a.scale.y=d,a.toggleHiResTextDisplay(!1),a.transformItems.forEach(function(e){e.updateSmoothingScale(d,!1)});var x=a.parent,_=a.parent.children.indexOf(a);a.parent.removeChild(a),BFN.Stage.render(a,this.backgroundTexture,!1),x.addChildAt(a,_),a.x=y.x,a.y=y.y,a.scale.x=a.scale.y=1,a.toggleHiResTextDisplay(!0),a.transformItems.forEach(function(e){e.updateSmoothingScale(null,!1)}),this.isolatedTransformItem.renderable=!0;var I=[0,12,8,4][this.isolatedTransformItem.flippedHorizontal+2*this.isolatedTransformItem.flippedVertical],T=null;switch(this.isolatedTransformItem.type){case"texture":T=this.isolatedTransformItem.itemContent.texture.baseTexture,this.itemTexture.resize(Math.floor(T.width),Math.floor(T.height));var b=new PIXI.Texture(T);b.rotate=I,this.itemTexture.copyPixels(b),b.destroyGC(!1);break;case"frame_texture":var S=this.isolatedTransformItem.itemContent;T=S.baseTexture,this.itemTexture.resize(Math.floor(S.textureFrame.width),Math.floor(S.textureFrame.height));var C=new PIXI.Texture(T);C.rotate=I,this.itemTextureFrame.x=Math.min(S.textureFrame.x,T.width-this.itemTexture.width),this.itemTextureFrame.y=Math.min(S.textureFrame.y,T.height-this.itemTexture.height),this.itemTextureFrame.width=this.itemTexture.width,this.itemTextureFrame.height=this.itemTexture.height;var B=this.isolatedTransformItem.flippedHorizontal?-Math.min(T.width-(this.itemTextureFrame.x+this.itemTexture.width),T.width-this.itemTexture.width):-this.itemTextureFrame.x,F=this.isolatedTransformItem.flippedVertical?-Math.min(T.height-(this.itemTextureFrame.y+this.itemTexture.height),T.height-this.itemTexture.height):-this.itemTextureFrame.y;this.itemTexture.copyPixels(C,{x:B,y:F}),C.destroyGC(!1)}this.itemSpriteOffset.x=-this.itemTexture.width/2%1,this.itemSpriteOffset.y=-this.itemTexture.height/2%1;var E=this.isolatedTransformItem.itemContentW*this.isolatedTransformItem.scale.x,P=this.isolatedTransformItem.itemContentH*this.isolatedTransformItem.scale.y,k=Math.sqrt(Math.pow(E,2)+Math.pow(P,2)),N=Math.atan2(P,E),M=this.isolatedTransformItem.x+Math.cos(this.isolatedTransformItem.rotation+N)*(k/2),D=this.isolatedTransformItem.y+Math.sin(this.isolatedTransformItem.rotation+N)*(k/2),w=0,L=0;switch(this.canvasModel){case BFN.PhotoEditorCanvasModel:w=2*this.canvasModel.imageFitPaddingX,L=2*this.canvasModel.imageFitPaddingY;break;case BFN.CollageMakerCanvasModel:w=2*this.canvasModel.collageFitPaddingX,L=2*this.canvasModel.collageFitPaddingY;break;case BFN.DesignerCanvasModel:w=2*this.canvasModel.designerFitPaddingX,L=2*this.canvasModel.designerFitPaddingY}this.transformParamsStart.canvasScale=this.canvasModel.canvasScale,this.transformParamsEnd.canvasScale=Math.min(1,(BFN.StageModel.stageW-w)/this.itemTexture.width,(BFN.StageModel.stageH-L)/this.itemTexture.height),this.transformParamsStart.x=M,this.transformParamsStart.y=D,this.transformParamsStart.width=E,this.transformParamsStart.height=P,this.transformParamsStart.rotation=(this.isolatedTransformItem.rotation+4*Math.PI)%(2*Math.PI),this.transformParamsStart.rotation>Math.PI&&(this.transformParamsStart.rotation-=2*Math.PI),this.transformParamsStart.alpha=this.isolatedTransformItem.alpha,this.transformParamsEnd.x=0,this.transformParamsEnd.y=0,this.transformParamsEnd.width=this.itemTexture.width,this.transformParamsEnd.height=this.itemTexture.height,this.transformParamsEnd.rotation=0,this.transformParamsEnd.alpha=1,this.backgroundContainer.x=this.transformParamsStart.x,this.backgroundContainer.y=this.transformParamsStart.y,this.backgroundContainer.rotation=this.transformParamsStart.rotation,this.backgroundContainer.scale.x=this.backgroundContainer.scale.y=1;var O=this.backgroundContainer.toLocal(this.toGlobal(new PIXI.Point(c.x,c.y)));this.backgroundSprite.x=O.x,this.backgroundSprite.y=O.y,this.backgroundSprite.rotation=-this.backgroundContainer.rotation,this.backgroundSprite.scale.x=this.backgroundSprite.scale.y=this.backgroundSprite.currentScale=1/d,T&&(T.backgroundSpritePosition={x:O.x,y:O.y}),this._itemWidth=this.itemTexture.width,this._itemHeight=this.itemTexture.height,this.itemSprite.visible=!0,this.canvas.canvas.visible=!1,UIToggler.toggleMainMenu(!1),UIToggler.toggleNavBar(!1),UITools.setControlValue("layer_isolator_display_canvas",!0),UITools.updateToolControl("layer_isolator_display_canvas"),UITools.applyTool("layer"),this.isolatedTransformItem.addEventListener(BFN.TransformItemEvents.THUMB_UPDATED.type,this.handleIsolatedItemThumbUpdatedBind),this.canvasModel.addEventListener("CANVAS_SCALE_UPDATED",this.handleCanvasScaleUpdatedBind),this.canvasModel.disregardScaleRange=!0,this.canvasModel.canvasScaling=!0,this.isolationAnimator.setAnimatorFactor(0),this.isolationAnimator.increase(),UIHistory.updateHistoryAvailable(),UIHistory.resetButton.disabled=!0,BFN.MainUI.requestRender()}}}},zx.prototype.releaseTransformItem=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.waitingToRelease=e,this.waitingToRelease||this.isolateTransformItem()},zx.prototype.toggleBackground=function(e){this.backgroundContainerActive=!!e,this.updateBackgroundContainerAlpha()},zx.prototype.updateBackgroundContainerAlpha=function(){this.backgroundContainer.alpha=this.backgroundContainerActive?1:1-this.isolationAnimator.animationFactor,BFN.MainUI.requestRender()},zx.prototype.shiftCanvasTo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.shiftParamsStart={x:this.backgroundSprite.x,y:this.backgroundSprite.y,w:this._itemWidth,h:this._itemHeight},this.shiftParamsEnd={x:e,y:t,w:n,h:i};var r=!1;for(var a in this.shiftParamsStart)this.shiftParamsEnd.hasOwnProperty(a)&&Math.round(this.shiftParamsStart[a])!==Math.round(this.shiftParamsEnd[a])&&(r=!0);return r&&(this.shiftAnimator.setAnimatorFactor(0),this.shiftAnimator.increase()),r},zx.prototype.trackImageLayerEdited=function(){var e=new BFN.UserActionVO;e.eventID="image_layer_edited",e.register()},zx.prototype.handleIsolatedItemThumbUpdated=function(e){var t=this;if(this.active&&!this.animating){var n=this.isolatedTransformItem,i=[0,12,8,4][n.flippedHorizontal+2*n.flippedVertical],r=null;switch(n.type){case"texture":r=n.itemContent.texture.baseTexture,this.itemTexture.resize(Math.floor(r.width),Math.floor(r.height));var a=new PIXI.Texture(r);a.rotate=i,this.itemTexture.copyPixels(a),a.destroyGC(!1);break;case"frame_texture":var o=n.itemContent;r=o.baseTexture,this.itemTexture.resize(Math.floor(o.textureFrame.width),Math.floor(o.textureFrame.height));var s=new PIXI.Texture(r);s.rotate=i,this.itemTextureFrame.x=Math.min(o.textureFrame.x,r.width-this.itemTexture.width),this.itemTextureFrame.y=Math.min(o.textureFrame.y,r.height-this.itemTexture.height),this.itemTextureFrame.width=this.itemTexture.width,this.itemTextureFrame.height=this.itemTexture.height;var l=n.flippedHorizontal?-Math.min(r.width-(this.itemTextureFrame.x+this.itemTexture.width),r.width-this.itemTexture.width):-this.itemTextureFrame.x,u=n.flippedVertical?-Math.min(r.height-(this.itemTextureFrame.y+this.itemTexture.height),r.height-this.itemTexture.height):-this.itemTextureFrame.y;this.itemTexture.copyPixels(s,{x:l,y:u}),s.destroyGC(!1)}var c=!1;r&&(!r.backgroundSpritePosition&&r.imageOffset&&(r.backgroundSpritePosition={x:this.backgroundSprite.x+r.imageOffset.x/this.backgroundContainer.scale.x,y:this.backgroundSprite.y+r.imageOffset.y/this.backgroundContainer.scale.y},delete r.imageOffset),r.backgroundSpritePosition&&(c=this.shiftCanvasTo(r.backgroundSpritePosition.x,r.backgroundSpritePosition.y,this.itemTexture.width,this.itemTexture.height)));var h=this.isolatedTransformItem.itemContentW*this.isolatedTransformItem.scale.x,d=this.isolatedTransformItem.itemContentH*this.isolatedTransformItem.scale.y,m=Math.sqrt(Math.pow(h,2)+Math.pow(d,2)),p=Math.atan2(d,h),g=this.isolatedTransformItem.x+Math.cos(this.isolatedTransformItem.rotation+p)*(m/2),f=this.isolatedTransformItem.y+Math.sin(this.isolatedTransformItem.rotation+p)*(m/2);this.transformParamsStart.x=g,this.transformParamsStart.y=f,this.transformParamsStart.width=h,this.transformParamsStart.height=d,this.transformParamsEnd.width=this.itemTexture.width,this.transformParamsEnd.height=this.itemTexture.height,this._itemWidth=this.itemTexture.width,this._itemHeight=this.itemTexture.height,this.itemTexture.determineTransparency();try{this.altSourceTexture.destroyGC(!0)}catch(e){}this.altSourceTexture=this.itemTexture.renderClone(),BFN.GlobalHistoryModel.updateGlobalHistoryButtons();var v=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);v.updateCheckerPanel(),v.updateTransformLayerVeil(),c||requestAnimationFrame(function(){t.handleShiftAnimatorIncreaseComplete()}),BFN.MainUI.requestRender()}},zx.prototype.handlePhotoEditorCanvasViewstateUpdated=function(e){this.active&&(this.itemSprite.visible=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)},zx.prototype.handleCanvasScaleUpdated=function(e){this.backgroundSprite.currentScale=this.backgroundContainer.scale.x*this.canvasModel.canvasScale,this.backgroundSprite.currentScaleY=this.backgroundContainer.scale.y*this.canvasModel.canvasScale,this.itemSprite.currentScale=this.itemSprite.scale.x*this.canvasModel.canvasScale,this.itemSprite.currentScaleY=this.itemSprite.scale.y*this.canvasModel.canvasScale},zx.prototype.handleIsolationAnimatorUpdate=function(e){var t=(this.transformParamsStart.x-this.transformParamsEnd.x)*(1-this.isolationAnimator.animationSinFactor),n=(this.transformParamsStart.y-this.transformParamsEnd.y)*(1-this.isolationAnimator.animationSinFactor),i=(this.transformParamsStart.width-this.transformParamsEnd.width)*(1-this.isolationAnimator.animationSinFactor),r=(this.transformParamsStart.height-this.transformParamsEnd.height)*(1-this.isolationAnimator.animationSinFactor),a=(this.transformParamsStart.rotation-this.transformParamsEnd.rotation)*(1-this.isolationAnimator.animationSinFactor),o=(this.transformParamsStart.alpha-this.transformParamsEnd.alpha)*(1-this.isolationAnimator.animationSinFactor);this.itemSprite.x=this.transformParamsEnd.x+t+this.itemSpriteOffset.x,this.itemSprite.y=this.transformParamsEnd.y+n+this.itemSpriteOffset.y,this.itemSprite.width=this.transformParamsEnd.width+i,this.itemSprite.height=this.transformParamsEnd.height+r,this.itemSprite.rotation=this.transformParamsEnd.rotation+a,this.itemSprite.alpha=this.transformParamsEnd.alpha+o,this.backgroundContainer.x=this.itemSprite.x,this.backgroundContainer.y=this.itemSprite.y,this.backgroundContainer.scale.x=this.itemSprite.width/this.transformParamsStart.width,this.backgroundContainer.scale.y=this.itemSprite.height/this.transformParamsStart.height,this.backgroundContainer.rotation=this.itemSprite.rotation,this.canvasModel.canvasScale=(this.transformParamsEnd.canvasScale-this.transformParamsStart.canvasScale)*this.isolationAnimator.animationSinFactor+this.transformParamsStart.canvasScale,this.canvas.transformLayerVeil.opacity=this.canvas.transformLayerVeil.baseOpacity*(1-this.isolationAnimator.animationFactor),this.updateBackgroundContainerAlpha()},zx.prototype.handleIsolationAnimatorIncreaseComplete=function(e){var t=this;this.canvasModel.disregardScaleRange=!1,this.canvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange(),BFN.ZoomRegion.updatePreview(),this.canvas.layerToolContainer.addChild(BFN.PhotoEditorCanvas.canvasTools),this.itemTexture.determineTransparency(),this.altSourceTexture=this.itemTexture.renderClone(),document.getElementById("layer_edit_menu").setStyles({display:"flex"}),this.isolatedCallback&&setTimeout(function(){requestAnimationFrame(function(){t.itemSprite.visible=!1,t.isolatedCallback(),t.canvasModel.canvasScaling=!0,t.canvasModel.canvasScale=t.canvasModel.canvasScale,t.canvasModel.canvasScaling=!1;var e=BFN.SentryManager.getDisplayObjectInfo(t.isolatedTransformItem);BFN.SentryManager.reportBreadcrumb(e,"layer_isolated","app_action")})},50)},zx.prototype.handleIsolationAnimatorDecreaseComplete=function(e){if(this.usingAlternateMenu=!1,this.canvasModel.disregardScaleRange=!1,BFN.CollageMakerCanvas.canvasScaleBars.active=!0,this.itemSprite.visible=!1,BFN.PhotoEditorCanvas.canvasToolsContainer.addChild(BFN.PhotoEditorCanvas.canvasTools),this.canvasModel.removeEventListener("CANVAS_SCALE_UPDATED",this.handleCanvasScaleUpdatedBind),this.canvasModel.canvasScaling=!1,this.canvasModel=null,this.canvas.canvas.visible=!0,this.canvas=null,this._itemWidth=0,this._itemHeight=0,this.backgroundTexture.resize(32,32),this.backgroundTexture.clear(),this.itemTexture.resize(32,32),this.itemTexture.clear(),this.isolatedTransformItem){var t=BFN.SentryManager.getDisplayObjectInfo(this.isolatedTransformItem);BFN.SentryManager.reportBreadcrumb(t,"layer_released","app_action"),this.reselectOnReleaseComplete&&this.isolatedTransformItem.selectItem(),this.isolatedTransformItem=null,BFN.TransformGuides.updateVisibility(),this.parent&&this.parent.removeChild(this)}this.reselectOnReleaseComplete=!0,BFN.ZoomManager.updateZoomRange(),BFN.ZoomRegion.updatePreview();try{this.altSourceTexture.destroyGC(!0)}catch(e){}if(UIToggler.toggleNavBar(!0),UIToggler.toggleMainMenu(!0),document.getElementById("layer_edit_menu").setStyles({display:"none"}),this.releasedCallback){var n=this.releasedCallback;setTimeout(function(){requestAnimationFrame(function(){n()})},50)}this.isolatedCallback=null,this.releasedCallback=null,BFN.GlobalHistoryModel.updateGlobalHistoryButtons(),UIHistory.updateHistoryAvailable(),UIHistory.resetButton.disabled=!1,BFN.HiResTextManager.updateHighResText()},zx.prototype.handleShiftAnimatorUpdate=function(e){var t=this.shiftParamsEnd.x-this.shiftParamsStart.x,n=this.shiftParamsEnd.y-this.shiftParamsStart.y;this.backgroundSprite.x=this.shiftParamsStart.x+t*this.shiftAnimator.animationSinFactor,this.backgroundSprite.y=this.shiftParamsStart.y+n*this.shiftAnimator.animationSinFactor,this.itemSprite.x=-t*(1-this.shiftAnimator.animationSinFactor)*this.backgroundContainer.scale.x+this.itemSpriteOffset.x,this.itemSprite.y=-n*(1-this.shiftAnimator.animationSinFactor)*this.backgroundContainer.scale.y+this.itemSpriteOffset.y,BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).updateCheckerPanel()},zx.prototype.handleShiftAnimatorIncreaseComplete=function(e){this.usingAlternateMenu&&this.waitingToRelease&&this.releaseTransformItem()},Object.defineProperty(zx.prototype,"active",{get:function(){return!!this.isolatedTransformItem}}),Object.defineProperty(zx.prototype,"activeFactor",{get:function(){return this.isolationAnimator.animationSinFactor}}),Object.defineProperty(zx.prototype,"animating",{get:function(){return!(!this.isolationAnimator.animating&&!this.shiftAnimator.animating)}}),Object.defineProperty(zx.prototype,"itemWidth",{get:function(){var e=this._itemWidth;if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){var t=BFN.PhotoEditorCanvasTools.currentTool;t&&t.hasOwnProperty("itemWidth")&&(e=t.itemWidth)}return e}}),Object.defineProperty(zx.prototype,"itemHeight",{get:function(){var e=this._itemHeight;if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){var t=BFN.PhotoEditorCanvasTools.currentTool;t&&t.hasOwnProperty("itemHeight")&&(e=t.itemHeight)}return e}}),BFN.SingletonQueue.add(function(){BFN.TransformItemIsolator=new zx}),jx.prototype=Object.create(PIXI.Container.prototype),jx.prototype.init=function(){BeFunky.log("TransformItemBoundingBoxes Init"),this.initDefaultValues(),this.initStrokeRectanglePool()},jx.prototype.initDefaultValues=function(){this.interactive=!1,this.itemData=[],this._scale=1},jx.prototype.initStrokeRectanglePool=function(){this.strokeRectanglePool=new BFN.StrokeRectanglePool(!1,!0,2,!0,3011608961,3011608961,"undashed_selection_line_gray"),this.addChild(this.strokeRectanglePool)},jx.prototype.selectItems=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(t){var n=this.parent,i=null,r=1;try{i=t.length?t[0].transformLayer.canvas.transformItemBoundingBoxesContainer:null}catch(e){}try{r=t.length?t[0].transformLayer.canvas.model.canvasScale:1}catch(e){}n!==i&&(i?i.addChild(this):n&&n.removeChild(this)),this.strokeRectanglePool.clear(),this.itemData.splice(0),t.forEach(function(t){e.itemData.push({item:t,strokeRectangle:e.strokeRectanglePool.add(t.x,t.y,t.itemContentW*t.scale.x,t.itemContentH*t.scale.y,t.rotation)})}),this.lineScale=r,BFN.MainUI.requestRender()}},jx.prototype.updateItems=function(){var e=this;this.itemData.forEach(function(t){var n=t.item,i=t.strokeRectangle;e.strokeRectanglePool.setTransform(i,n.x,n.y,n.itemContentW*n.scale.x,n.itemContentH*n.scale.y,n.rotation)})},jx.prototype.clear=function(){this.selectItems()},Object.defineProperty(jx.prototype,"lineScale",{set:function(e){this.strokeRectanglePool.poolScale=e},get:function(){return this.strokeRectanglePool.poolScale}}),BFN.SingletonQueue.add(function(){BFN.TransformItemBoundingBoxes=new jx}),Xx.prototype=Object.create(PIXI.Container.prototype),Xx.prototype.init=function(){BeFunky.log("TransformItemDropShadow Init"),this.initDefaultValues(),this.initDisplay()},Xx.prototype.initDefaultValues=function(){this.interactive=this.interactiveChildren=!1,this.renderable=!this.isEmpty,this._shadowStateID=null,this._adjustScaleX=1,this._adjustScaleY=1,this._parentScaleX=1,this._parentScaleY=1,this._parentRotation=0,this._offsetX=0,this._offsetY=0,this._size=0,this._density=0,this._opacity=100,this._destroyed=!1},Xx.prototype.initDisplay=function(){this.scaleContainer=new PIXI.Container,this.addChild(this.scaleContainer),this.rotationContainer=new PIXI.Container,this.scaleContainer.addChild(this.rotationContainer),this.shadowSprite=new PIXI.Sprite(this._shadowTexture||void 0),this.shadowSprite.pluginName="blend_picture",this.shadowSprite.fillColor=0,this.shadowSprite.intensity=1,this.shadowSprite.anchor.x=this.shadowSprite.anchor.y=.5,this.rotationContainer.addChild(this.shadowSprite)},Xx.prototype.updateShadowTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._sourceTexture&&!this._destroyed){var t=this._sourceTexture.width+2*this._size,n=this._sourceTexture.height+2*this._size;this._shadowTexture||(this._shadowTexture=PIXI.RenderTexture.create(t,n),this.shadowSprite.texture=this._shadowTexture,this.renderable=!0),this._shadowTexture.width===t&&this._shadowTexture.height===n||this._shadowTexture.resize(t,n),this._shadowTexture.copyPixels(this._sourceTexture,{x:this._size,y:this._size}),BFN.DirectionalBlurManager.blurTexture(this._shadowTexture,{maxSpread:Math.max(.01,this._size),amount:1,alphaChoke:this._density,iterations:Math.min(5,this._size+1)}),this._shadowStateID=e}},Xx.prototype.clearShadowTexture=function(){this._sourceTexture&&(this._sourceTexture.destroyGC(!0),this._sourceTexture=null),this._shadowTexture&&(this._shadowTexture.destroyGC(!0),this._shadowTexture=null,this.shadowSprite.texture=PIXI.Texture.EMPTY,this.renderable=!1),this._shadowStateID=null},Xx.prototype.destroy=function(){this.clearShadowTexture(),this.shadowSprite.destroy(!0),this.rotationContainer.removeChild(this.shadowSprite),this.rotationContainer.destroy(!0),this.scaleContainer.removeChild(this.rotationContainer),this.scaleContainer.destroy(!0),this.removeChild(this.scaleContainer),this._destroyed=!0},Object.defineProperty(Xx.prototype,"shadowStateID",{get:function(){return this._shadowStateID}}),Object.defineProperty(Xx.prototype,"sourceTexture",{get:function(){return this._sourceTexture||(this._sourceTexture=PIXI.RenderTexture.create(32,32)),this._sourceTexture}}),Object.defineProperty(Xx.prototype,"shadowTexture",{get:function(){return this._shadowTexture}}),Object.defineProperty(Xx.prototype,"isEmpty",{get:function(){return!(this._sourceTexture&&this._shadowTexture)}}),Object.defineProperty(Xx.prototype,"adjustScaleX",{set:function(e){this._adjustScaleX!==e&&(this._adjustScaleX=e,this.shadowSprite.scale.x=1/this._adjustScaleX)},get:function(){return this._adjustScaleX}}),Object.defineProperty(Xx.prototype,"adjustScaleY",{set:function(e){this._adjustScaleY!==e&&(this._adjustScaleY=e,this.shadowSprite.scale.y=1/this._adjustScaleY)},get:function(){return this._adjustScaleY}}),Object.defineProperty(Xx.prototype,"parentScaleX",{set:function(e){this._parentScaleX!==e&&(this._parentScaleX=e,this.scaleContainer.scale.x=1/this._parentScaleX)},get:function(){return this._parentScaleX}}),Object.defineProperty(Xx.prototype,"parentScaleY",{set:function(e){this._parentScaleY!==e&&(this._parentScaleY=e,this.scaleContainer.scale.y=1/this._parentScaleY)},get:function(){return this._parentScaleY}}),Object.defineProperty(Xx.prototype,"parentRotation",{set:function(e){this._parentRotation!==e&&(this._parentRotation=e,this.rotationContainer.rotation=-this._parentRotation,this.shadowSprite.rotation=this._parentRotation)},get:function(){return this._parentRotation}}),Object.defineProperty(Xx.prototype,"offsetX",{set:function(e){this._offsetX!==e&&(this._offsetX=e,this.shadowSprite.x=this._offsetX)},get:function(){return this._offsetX}}),Object.defineProperty(Xx.prototype,"offsetY",{set:function(e){this._offsetY!==e&&(this._offsetY=e,this.shadowSprite.y=this._offsetY)},get:function(){return this._offsetY}}),Object.defineProperty(Xx.prototype,"size",{set:function(e){this._size=Math.max(0,e)},get:function(){return this._size}}),Object.defineProperty(Xx.prototype,"density",{set:function(e){this._density=Math.max(0,Math.min(1,e))},get:function(){return this._density}}),Object.defineProperty(Xx.prototype,"opacity",{set:function(e){e=Math.max(0,Math.min(100,e)),this._opacity!==e&&(this._opacity=e,this.shadowSprite.alpha=this._opacity/100)},get:function(){return this._opacity}}),Object.defineProperty(Xx.prototype,"color",{set:function(e){e=Math.max(0,Math.min(16777215,e)),this.shadowSprite.fillColor!==e&&(this.shadowSprite.fillColor=e)},get:function(){return this.shadowSprite.fillColor}}),Object.defineProperty(Xx.prototype,"blendMode",{set:function(e){this.shadowSprite.blendMode!==e&&(this.shadowSprite.blendMode=e)},get:function(){return this.shadowSprite.blendMode}}),Object.defineProperty(Xx.prototype,"smoothingScaleX",{set:function(e){this.shadowSprite.currentScale=e},get:function(){return this.shadowSprite.currentScale}}),Object.defineProperty(Xx.prototype,"smoothingScaleY",{set:function(e){this.shadowSprite.currentScaleY=e},get:function(){return this.shadowSprite.currentScaleY}}),BFN.TransformItemDropShadow=Xx,BFN.TransformLayerEvents={ITEM_SELECTED:new Event("ITEM_SELECTED"),ITEMS_UPDATED:new Event("ITEMS_UPDATED"),ITEM_DISPLAY_UPDATED:new Event("ITEMS_UPDATED"),ITEM_DUPLICATED:new Event("ITEM_DUPLICATED")},Wx.prototype=window.azrc.extend(Object.create(PIXI.Sprite.prototype),Object.create(BFN.EventDispatcher.prototype)),Wx.prototype.init=function(){BeFunky.log("TransformLayer Init"),this.initDefaultValues(),this.initSelectionRect()},Wx.prototype.initDefaultValues=function(){this.interactive=!0,this._scale=1,this.selectedItem=null,this.transformItems=[],this.frameWidth=0,this.frameHeight=0,this.nudgeDistance=1,this.altPressed=!1,this.dPressed=!1,this.usedBaseTextures=[],this.lastPressedItem=null,this.lastSelectedItem=null,this.lastClickedItem=null,this.handleGroupMouseMoveBind=this.handleGroupMouseMove.bind(this),this.handleGroupMouseUpBind=this.handleGroupMouseUp.bind(this),this.handleItemMouseOverBind=this.handleItemMouseOver.bind(this),this.handleItemMouseOutBind=this.handleItemMouseOut.bind(this),this.handleItemPressedBind=this.handleItemPressed.bind(this),this.handleItemReleasedBind=this.handleItemReleased.bind(this),this.handleItemDisplayUpdatedBind=this.handleItemDisplayUpdated.bind(this),this.handleGetSnapCoordinatesBind=this.handleGetSnapCoordinates.bind(this),this.handleSelectItemBind=this.handleSelectItem.bind(this),this.handleDeselectItemBind=this.handleDeselectItem.bind(this),this.handleRemoveItemBind=this.handleRemoveItem.bind(this),this.handleDestroyItemBind=this.handleDestroyItem.bind(this),this.handleDuplicateItemBind=this.handleDuplicateItem.bind(this),this.handleRegisterTransitionBind=this.handleRegisterTransition.bind(this),this.handleTransitionAppliedBind=this.handleTransitionApplied.bind(this),this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleAltKeyUpBind=this.handleAltKeyUp.bind(this)},Wx.prototype.initSelectionRect=function(){this.selectionRect=new BFN.Rectangle,this.selectionOrigin=new PIXI.Point,this.canvasSelectionOrigin=new PIXI.Point,this.transformItemBounds=[],this.groupedTransformItems=[],this.retainedTransformItems=[],this.handleTransformItemGroupPressedBind=this.handleTransformItemGroupPressed.bind(this),this.selectionShape=new PIXI.Graphics,this.selectionShape.beginFill(11184895,.4),this.selectionShape.drawRect(0,0,100,100),this.selectionShape.endFill()},Wx.prototype.addItem=function(e){e.initialFrameWidth=this.frameWidth,e.initialFrameHeight=this.frameHeight;var t=!!e.isDuplicate,n=null;e.hasOwnProperty("accurateBounds")&&(n=e.accurateBounds,delete e.accurateBounds);var i=new BFN.TransformItem(e,this.appViewState);if(e.projectItemVO&&-1!=e.projectItemVO.layerNum&&!t)i.layerName=e.projectItemVO.layerName,i.layerNum=e.projectItemVO.layerNum;else{i.layerName=null;var r=0;this.children.forEach(function(e){e.layerType==i.layerType&&(r=Math.max(r,e.layerNum))}),i.layerNum=r+1}if(e.projectItemVO&&e.projectItemVO.layerName&&t){var a=function(e){var t=e.split(" (");if(t.length>1){var n=t.pop().split(")");if(2===n.length){var i=parseInt(n.shift());if(!isNaN(i))return i}}return NaN},o=e.projectItemVO.layerName;if(!isNaN(a(o))){var s=o.split(" (");s.pop(),o=s.join(" (")}i.layerName=o;var l=[];this.children.forEach(function(e){if(e instanceof BFN.TransformItem&&e.projectItemVO&&e.projectItemVO.layerName&&e.projectItemVO.layerName.includes(o)){var t=a(e.projectItemVO.layerName);!isNaN(t)&&t>0&&!l.includes(t)&&l.push(t)}});for(var u=0;++u;)if(!l.includes(u)){i.layerName+=" ("+u+")";break}}e.hasOwnProperty("initialPosition")&&e.initialPosition?(i.x=e.initialPosition.x-this.frameWidth/2,i.y=e.initialPosition.y-this.frameHeight/2):e.hasOwnProperty("initialCenterPosition")&&e.initialCenterPosition?(i.x=e.initialCenterPosition.x-i.itemContentW*i.scale.x/2,i.y=e.initialCenterPosition.y-i.itemContentH*i.scale.y/2):(i.x=-i.itemContentW/2*i.scale.x,i.y=-i.itemContentH/2*i.scale.y),i.updateFrameTextureDisplay(),i.on("pointerover",this.handleItemMouseOverBind),i.on("pointerout",this.handleItemMouseOutBind),i.on("pointerdown",this.handleItemPressedBind),i.on("pointerup",this.handleItemReleasedBind),i.addEventListener(BFN.TransformItemEvents.ITEM_DISPLAY_UPDATED.type,this.handleItemDisplayUpdatedBind),i.addEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),i.addEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleItemPressedBind),i.addEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemBind),i.addEventListener(BFN.TransformItemEvents.DESELECT_ITEM.type,this.handleDeselectItemBind),i.addEventListener(BFN.TransformItemEvents.REMOVE_ITEM.type,this.handleRemoveItemBind),i.addEventListener(BFN.TransformItemEvents.DESTROY_ITEM.type,this.handleDestroyItemBind),i.addEventListener(BFN.TransformItemEvents.DUPLICATE_ITEM.type,this.handleDuplicateItemBind),i.addEventListener(BFN.TransformItemEvents.REGISTER_TRANSITION.type,this.handleRegisterTransitionBind),i.addEventListener(BFN.TransformItemEvents.TRANSITION_APPLIED.type,this.handleTransitionAppliedBind),this.transformItems.push(i),BFN.TransformItemGroup.duplicatingGroup&&(i.isGroupTransition=!0);var c="history_"+(t?"duplicate_":"new_");return"text"==i.type?c+="text":i.isGoodie?c+=i.basicShapeVO?"shape":"graphic":c+="image",i.createTransition(c,!0),i.isGroupTransition&&delete i.isGroupTransition,this.addChild(i),i.registerTransition(!1,!n),n&&(i.currentTransformItemStateVO.accurateBounds=n,i.transitionVO&&(i.transitionVO.startState.accurateBounds=n,i.transitionVO.endState.accurateBounds=n)),this.model.updateProjectVO(),i.updateAccurateBounds(),BFN.ProjectManager.transformItemsPending||this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED),BFN.TransformModel.addedTransformItem=i,BFN.TransformModel.selectItemOnAdd&&this.selectItem(i),i},Wx.prototype.selectItem=function(e){this.debouncingHideMeasurements=!1,this.altPressed&&this.handleAltKeyUpBind(null,!0),this.clickItem(e)||(BFN.TransformModel.transformToolFrame&&BFN.TransformModel.transformToolFrame.active&&BFN.TransformModel.transformToolFrame.setup(null),e&&(this.transformItems.includes(e)||"group"==e.type)&&(this.handleSelectedItemTransition(e),this.selectedItem=e,window.addEventListener("keydown",this.handleKeyDownBind),this.dispatchEvent(BFN.TransformLayerEvents.ITEM_SELECTED)))},Wx.prototype.deselectItem=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!BFN.GestureManager.multiplePointersActive&&(this.textTransformItem=null,this.selectedItem)){if((BFN.CursorScreen.cursorLock||BFN.CursorScreen.cursor)&&(BFN.CursorScreen.cursorLock=!1,BFN.CursorScreen.cursor=null),t&&"frame_texture"==this.selectedItem.type)return;if(this.selectedItem&&"frame_texture"==this.selectedItem.type){var n=this.selectedItem.transformTool.transformToolFrame;if(n.transformItem===this.selectedItem)return void n.setup(null)}this.lastDeselectedItem=this.selectedItem,this.selectedItem=null,window.removeEventListener("keydown",this.handleKeyDownBind),e&&this.resetTransformItemGroup(),this.lastPressedItem=null,this.lastSelectedItem=null,this.lastClickedItem=null,this.dispatchEvent(BFN.TransformLayerEvents.ITEM_SELECTED)}},Wx.prototype.clickItem=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(BFN.GestureManager.multiplePointersActive)return!1;if(e&&"frame_texture"===e.type&&(n||e.selectedByMouse))if(this.awaitingDoubleClick&&this.awaitingDoubleClickTimeoutID){if(clearTimeout(this.awaitingDoubleClickTimeoutID),this.awaitingDoubleClick=!1,this.awaitingDoubleClickTimeoutID=null,e==this.lastPressedItem)return BFN.TransformModel.transformToolFrame.transformItem!==BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.transformToolFrame.setup(BFN.TransformModel.selectedTransformItem),!0}else this.awaitingDoubleClick||this.awaitingDoubleClickTimeoutID||(this.awaitingDoubleClick=!0,this.awaitingDoubleClickTimeoutID=setTimeout(function(){t.awaitingDoubleClick=!1,t.awaitingDoubleClickTimeoutID=null},250));return!1},Wx.prototype.handleSelectedItemTransition=function(e){var t=v(UIToggler.alternateMenu.querySelectorAll(".popover.active"));this.selectedItem&&this.selectedItem.type===e.type?(t.forEach(function(e){e.originalStrongValue=e.strong,e.strong=!0}),setTimeout(function(){t.forEach(function(e){e.strong=!!e.originalStrongValue,delete e.originalStrongValue})},0)):(t.forEach(function(e){return e.setStyles({display:"none"})}),requestAnimationFrame(function(){t.forEach(function(e){return e.setStyles({display:"block"})})}))},Wx.prototype.enableChildren=function(){this.interactiveChildren=!0},Wx.prototype.disableChildren=function(){this.interactiveChildren=!1},Wx.prototype.toggleFlattenDisplayMode=function(e){this.toggleTransparentBasicShapeDisplay(!e),this.toggleHiResTextDisplay(!e),this.toggleItemScaleSmoothing(!e),this.setItemScaleMode(e?PIXI.SCALE_MODES.NEAREST:PIXI.SCALE_MODES.LINEAR,["text"])},Wx.prototype.toggleTransparentBasicShapeDisplay=function(e){for(var t=0;t<this.transformItems.length;t++){var n=this.transformItems[t];if(n.isGoodie&&n.basicShapeVO)if(e)n.renderable=!0;else{var i=-1===n.basicShapeVO.fill&&-1===n.basicShapeVO.stroke;n.renderable=!i}}BFN.MainUI.requestRender()},Wx.prototype.toggleHiResTextDisplay=function(e){for(var t=0;t<this.transformItems.length;t++){var n=this.transformItems[t];"text"===n.type&&n.toggleHiResText(!!e)}BFN.MainUI.requestRender()},Wx.prototype.toggleItemScaleSmoothing=function(e){for(var t=0;t<this.transformItems.length;t++){this.transformItems[t].updateSmoothingScale(e?0:1)}},Wx.prototype.setItemScaleMode=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0;n<this.transformItems.length;n++){var i=this.transformItems[n];if(!t||-1!=t.indexOf(i.type))try{i.itemContent.texture.setScaleMode(0==i.rotation?e:PIXI.SCALE_MODES.LINEAR)}catch(e){}}BFN.MainUI.requestRender()},Wx.prototype.removeItem=function(e){var t=this;e&&(e==this.selectedItem&&"group"!=e.type&&this.deselectItem(),e==BFN.TransformModel.focusedTransformItem&&(BFN.TransformModel.focusedTransformItem=null),"group"==e.type&&e.selectedItems.length?(e.createTransition("history_remove_selection",!1),e._selectedItems.forEach(function(e){-1!=t.children.indexOf(e)&&-1!=t.transformItems.indexOf(e)&&(e.clearDropShadow(),e.createTransition("history_remove_selection"),t.removeChild(e),e.registerTransition(!1,!1))}),e.registerTransition(!1,!1,!1),this.deselectItem(),this.model.updateProjectVO(),this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)):-1!=this.children.indexOf(e)&&-1!=this.transformItems.indexOf(e)&&(e.clearDropShadow(),e.createTransition("text"==e.type?"history_delete_text":e.isGoodie?"history_delete_graphic":"history_delete_image"),this.removeChild(e),e.registerTransition(),this.model.updateProjectVO(),this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)))},Wx.prototype.destroyItem=function(e){e&&(e==this.selectedItem&&this.deselectItem(),-1!=this.transformItems.indexOf(e)&&(-1!=this.children.indexOf(e)&&this.removeChild(e),this.transformItems.splice(this.transformItems.indexOf(e),1),e.off("pointerover",this.handleItemMouseOverBind),e.off("pointerout",this.handleItemMouseOutBind),e.off("pointerdown",this.handleItemPressedBind),e.off("pointerup",this.handleItemPressedBind),e.removeEventListener(BFN.TransformItemEvents.ITEM_DISPLAY_UPDATED.type,this.handleItemDisplayUpdatedBind),e.removeEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),e.removeEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleItemPressedBind),e.removeEventListener(BFN.TransformItemEvents.SELECT_ITEM.type,this.handleSelectItemBind),e.removeEventListener(BFN.TransformItemEvents.DESELECT_ITEM.type,this.handleDeselectItemBind),e.removeEventListener(BFN.TransformItemEvents.REMOVE_ITEM.type,this.handleRemoveItemBind),e.removeEventListener(BFN.TransformItemEvents.DESTROY_ITEM.type,this.handleDestroyItemBind),e.removeEventListener(BFN.TransformItemEvents.DUPLICATE_ITEM.type,this.handleDuplicateItemBind),e.destroy(this.usedBaseTextures),e=null,this.model.updateProjectVO(),this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)))},Wx.prototype.removeAllItems=function(){var e=this.transformItems.length;for(BFN.TransformStateModel.startBulkTransition("removeall");--e>-1;)this.removeItem(this.transformItems[e]);BFN.TransformStateModel.stopBulkTransition()},Wx.prototype.destroyAllItems=function(){this.usedBaseTextures=BFN.GlobalHistoryModel.getUsedBaseTextures(this.appViewState);for(var e=this.transformItems.length;--e>-1;)this.destroyItem(this.transformItems[e]);this.usedBaseTextures.splice(0)},Wx.prototype.alignItem=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.accurateBounds){var n=BFN.Util.getTransformItemBounds(e),i={x:0,y:0},r=null===t;switch(e.align){case"left":i.x=(r?-this.frameWidth/2:t)-(n.minX+e.accurateBounds.left);break;case"center":i.x=(r?0:t)-(n.centerX+e.accurateBounds.centerOffsetX);break;case"right":i.x=(r?this.frameWidth/2:t)-(n.maxX-e.accurateBounds.right);break;case"top":i.y=(r?-this.frameHeight/2:t)-(n.minY+e.accurateBounds.top);break;case"middle":i.y=(r?0:t)-(n.centerY+e.accurateBounds.centerOffsetY);break;case"bottom":i.y=(r?this.frameHeight/2:t)-(n.maxY-e.accurateBounds.bottom)}e.x+=i.x,e.y+=i.y,e.updateHiResTextBounds(),BFN.MainUI.requestRender()}},Wx.prototype.getAveragePosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0;return e.length&&(e.forEach(function(e){var i=BFN.Util.getTransformItemBounds(e);switch(t){case"left":n+=i.minX+e.accurateBounds.left;break;case"center":n+=i.centerX+e.accurateBounds.centerOffsetX;break;case"right":n+=i.maxX-e.accurateBounds.right;break;case"top":n+=i.minY+e.accurateBounds.top;break;case"middle":n+=i.centerY+e.accurateBounds.centerOffsetY;break;case"bottom":n+=i.maxY-e.accurateBounds.bottom}}),n/=e.length),n},Wx.prototype.getItemSelectionBounds=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=null;return e&&e.length&&e.forEach(function(e){var n=BFN.Util.getTransformItemBounds(e);t||(t={}),t.left=t.hasOwnProperty("left")?Math.min(t.left,n.minX+e.accurateBounds.left):n.minX+e.accurateBounds.left,t.right=t.hasOwnProperty("right")?Math.max(t.right,n.maxX-e.accurateBounds.right):n.maxX-e.accurateBounds.right,t.top=t.hasOwnProperty("top")?Math.min(t.top,n.minY+e.accurateBounds.top):n.minY+e.accurateBounds.top,t.bottom=t.hasOwnProperty("bottom")?Math.max(t.bottom,n.maxY-e.accurateBounds.bottom):n.maxY-e.accurateBounds.bottom}),t?(t.center=(t.left+t.right)/2,t.middle=(t.top+t.bottom)/2):t={left:0,center:0,right:0,top:0,middle:0,bottom:0},t},Wx.prototype.offsetAllItems=function(e,t){BeFunky.log("OFFSET ITEMS",e,t);var n=[];this.children.forEach(function(e){e instanceof BFN.TransformItem&&n.push(e)}),n.length&&(BFN.UndoManager.isBatchHistoryAction&&BFN.TransformStateModel.startBulkTransition("offset_items_".concat(BeFunky.randomString(10))),n.forEach(function(n){BFN.UndoManager.isBatchHistoryAction&&n.createTransition("offset_item"),n.x+=Math.round(e),n.y+=Math.round(t),BFN.UndoManager.isBatchHistoryAction&&n.registerTransition()}),BFN.TransformStateModel.stopBulkTransition(),BFN.MainUI.requestRender())},Wx.prototype.hasText=function(){return this.children.some(function(e){return e instanceof BFN.TransformItem&&"text"===e.type})},Wx.prototype.startGroupSelection=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];BFN.SentryManager.reportBreadcrumb("Available Items: ".concat(BFN.TransformLayerManager.transformItems.length," | Selected Items: ").concat(BFN.TransformItemGroup.selectedItems.length),"start_selection_drag"),document.removeEventListener(BeFunky.pointerup,this.handleGroupMouseUpBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleGroupMouseMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handleGroupMouseUpBind,!0),document.addEventListener(BeFunky.pointermove,this.handleGroupMouseMoveBind,!0),this.eraseSelection=n,this.retainedTransformItems.splice(0),t&&(BFN.TransformItemGroup.selectedItems.forEach(function(t){e.retainedTransformItems.push(t)}),i.forEach(function(t){e.retainedTransformItems.includes(t)||e.retainedTransformItems.push(t)})),this.transformItemBounds.splice(0);for(var r=0;r<this.transformItems.length;r++){var a=this.transformItems[r];this.children.includes(a)&&a.accurateBounds&&(a.updateItemBoundsData(),a.itemBoundsData&&this.transformItemBounds.push(a.itemBoundsData))}this.updateGroupSelection()},Wx.prototype.updateGroupSelection=function(){var e=this,t=this.getPointerPosition(BFN.MainUI.pointerEvent),n=this.canvas.getPointerPosition(BFN.MainUI.pointerEvent);this.canvas.transformIndicatorContainer.children.includes(this.selectionShape)||(this.selectionOrigin.x=t.x,this.selectionOrigin.y=t.y,this.canvasSelectionOrigin.x=n.x,this.canvasSelectionOrigin.y=n.y,this.canvas.transformIndicatorContainer.addChild(this.selectionShape)),this.selectionRect.left=Math.floor(Math.min(this.selectionOrigin.x,t.x)),this.selectionRect.top=Math.floor(Math.min(this.selectionOrigin.y,t.y)),this.selectionRect.right=Math.ceil(Math.max(this.selectionOrigin.x,t.x)),this.selectionRect.bottom=Math.ceil(Math.max(this.selectionOrigin.y,t.y)),this.selectionShape.x=Math.floor(Math.min(this.canvasSelectionOrigin.x,n.x)),this.selectionShape.y=Math.floor(Math.min(this.canvasSelectionOrigin.y,n.y)),this.selectionShape.scale.x=(Math.ceil(Math.max(this.canvasSelectionOrigin.x,n.x))-this.selectionShape.x)/100,this.selectionShape.scale.y=(Math.ceil(Math.max(this.canvasSelectionOrigin.y,n.y))-this.selectionShape.y)/100;var i=[BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.left,this.selectionRect.top),this),BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.right,this.selectionRect.top),this),BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.right,this.selectionRect.bottom),this),BFN.MainUI.toLocal(new PIXI.Point(this.selectionRect.left,this.selectionRect.bottom),this)];if(this.groupedTransformItems.splice(0),this.retainedTransformItems.forEach(function(t){e.groupedTransformItems.push(t)}),this.eraseSelection){if(this.groupedTransformItems.length)for(var r=this.transformItemBounds.length;--r>-1;){var a=this.transformItemBounds[r],o=this.groupedTransformItems.indexOf(a.item);-1!=o&&BFN.Util.polygonHitTest(i,a.globalPolygon)&&this.groupedTransformItems.splice(o,1)}}else this.transformItemBounds.forEach(function(t){!e.retainedTransformItems.includes(t.item)&&BFN.Util.polygonHitTest(i,t.globalPolygon)&&e.groupedTransformItems.push(t.item)});this.groupedTransformItems.length?(this.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=this,this.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=this._scale):this.children.includes(BFN.TransformItemGroup)&&(BFN.TransformItemGroup.transformLayer=null,this.removeChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.updateSelectedItems(this.groupedTransformItems),BFN.MainUI.requestRender()},Wx.prototype.stopGroupSelection=function(){BFN.SentryManager.reportBreadcrumb("Available Items: ".concat(BFN.TransformLayerManager.transformItems.length," | Selected Items: ").concat(BFN.TransformItemGroup.selectedItems.length),"stop_selection_drag"),document.removeEventListener(BeFunky.pointerup,this.handleGroupMouseUpBind,!0),document.removeEventListener(BeFunky.pointermove,this.handleGroupMouseMoveBind,!0),this.canvas.transformIndicatorContainer.children.includes(this.selectionShape)&&this.canvas.transformIndicatorContainer.removeChild(this.selectionShape),this.groupedTransformItems.length&&(1==this.groupedTransformItems.length?(this.groupedTransformItems[0].selectItem(),this.resetTransformItemGroup()):this.updateTransformItemGroup()),BFN.MainUI.requestRender()},Wx.prototype.updateTransformItemGroup=function(){BFN.TransformItemGroup.selectedItems.length&&(1==BFN.TransformItemGroup.scale.x&&0==BFN.TransformItemGroup.rotation&&BFN.TransformItemGroup.updateItemGroupData(),BFN.TransformItemGroup.updateContentDimensions(),BFN.TransformItemGroup.updateAccurateBounds(),BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),BFN.TransformItemGroup.addEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),BFN.TransformItemGroup.remainingItem=null,BFN.TransformItemGroup.selectedByMouse=!1,this.selectItem(BFN.TransformItemGroup),this.transformTool.updateDisplay(),BFN.TransformModel.selectedGroupType!=BFN.TransformItemGroup.groupType&&(BFN.TransformModel.selectedTransformItem=BFN.TransformItemGroup),BFN.TransformModel.updateGroupMenu(),"text"==BFN.TransformItemGroup.groupType&&BFN.FabricManager.updateTextMenu(BFN.TransformItemGroup.getTextGroupStyleData()),BFN.TransformItemGroup.off("pointerdown",this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.on("pointerdown",this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.addEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleTransformItemGroupPressedBind),BFN.SentryManager.reportBreadcrumb(BFN.TransformItemGroup.groupInfo,"item_selection_updated","selection_interaction")),BFN.TransformItemGroup.lastSelectionCount=BFN.TransformItemGroup.selectedItems.length,this.textTransformItem=null},Wx.prototype.resetTransformItemGroup=function(){this.groupedTransformItems.splice(0),BFN.TransformItemGroup.off("pointerdown",this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.PRESS_ITEM.type,this.handleTransformItemGroupPressedBind),BFN.TransformItemGroup.clearItems(),this.selectedItem==BFN.TransformItemGroup&&this.deselectItem(),this.children.includes(BFN.TransformItemGroup)&&(BFN.TransformItemGroup.removeEventListener(BFN.TransformItemEvents.GET_SNAP_COORDINATES.type,this.handleGetSnapCoordinatesBind),BFN.TransformItemGroup.transformLayer=null,this.removeChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.lastSelectionCount>0&&(BFN.TransformItemGroup.lastSelectionCount=0,BFN.SentryManager.reportBreadcrumb("Reset / Empty","item_selection_updated","selection_interaction"))},Wx.prototype.handleGroupMouseMove=function(e){this.updateGroupSelection()},Wx.prototype.handleGroupMouseUp=function(e){this.stopGroupSelection()},Wx.prototype.handleTransformItemGroupPressed=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!BFN.GestureManager.multiplePointersActive){BFN.ZoomRegion.hide();var n,i,r=e.data.originalEvent;if(2===r.button||BFN.TransformItemGroup.longPressOccurred)return n=function(){for(var e=BFN.GroupManager.getCommonGroupVOsFromItemIDs(BFN.TransformLayerManager.selectedItemIDs),t=BFN.GroupManager.getSectionGroupVOs(),r=t.length;--r>-1;){var a=t[r];e.includes(a)&&t.splice(r,1)}if(t.length){BFN.TransformItemGroup.contextMenu.showButton("add_to_group");var o={};t.forEach(function(e){o[e.name]={onClick:function(){BFN.GroupManager.addItemsToGroup(e.id,BFN.TransformLayerManager.selectedItemIDs),n(),i()},translate:!1}}),BFN.TransformItemGroup.contextMenu.updateChildren("add_to_group",o)}else BFN.TransformItemGroup.contextMenu.hideButton("add_to_group")},i=function(){var e=BFN.GroupManager.getGroupVOsFromItemIDs(BFN.TransformLayerManager.selectedItemIDs);if(e.length){BFN.TransformItemGroup.contextMenu.showButton("remove_from_group");var t={};e.forEach(function(e){t[e.name]={onClick:function(){BFN.GroupManager.removeItemsFromGroup(e.id,BFN.TransformLayerManager.selectedItemIDs),n(),i()},translate:!1}}),BFN.TransformItemGroup.contextMenu.updateChildren("remove_from_group",t)}else BFN.TransformItemGroup.contextMenu.hideButton("remove_from_group")},n(),i(),BFN.TransformItemGroup.contextMenu.show(r.pageX,r.pageY),BFN.TransformItemGroup.selectedByMouse=!1,this.selectItem(BFN.TransformItemGroup),void e.stopPropagation();if(this.selectedItem===BFN.TransformItemGroup&&!t){for(var a=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent),o=null,s=0;s<BFN.TransformItemGroup.selectedItems.length;s++){var l=BFN.TransformItemGroup.selectedItems[s],u=l.globalPolygon;l.parent&&BFN.Util.polygonHitTest([a],u)&&(!o||o&&l.parent.children.indexOf(l)>o.parent.children.indexOf(o))&&(o=l)}BFN.TransformItemGroup.subSelectedItem=o}BFN.TransformItemGroup.selectedByMouse=!0,e.externalPress&&(BFN.TransformItemGroup.selectedByMouse=!1),this.selectItem(BFN.TransformItemGroup),e.stopPropagation()}},Wx.prototype.handleItemMouseOver=function(e){var t=e.currentTarget;setTimeout(function(){BFN.TransformModel.awaitingDrop&&("text"===t.type&&BFN.FabricManager.isDefaultText(t.iText.text)||(BFN.TransformModel.focusedTransformItem=t))},0)},Wx.prototype.handleItemMouseOut=function(e){BFN.TransformModel.focusedTransformItem=null},Wx.prototype.handleItemPressed=function(e){var t=this;if(!BFN.GestureManager.multiplePointersActive){BFN.ZoomRegion.hide();var n,i,r,a=e.target||e.targetItem,o=e.data.originalEvent,s=function(e){t.lastPressedItem=e,t.lastSelectedItem=e},l=2===o.button||a.longPressOccurred,u=o.ctrlKey||o.metaKey,c=o.altKey;if(u||c){if(this.selectedItem==BFN.TransformItemGroup){if(c)BFN.TransformItemGroup.removeGroupItem(a);else BFN.TransformItemGroup.toggleGroupItem(a)&&s(a);return this.transformTool.updateDisplay(),void e.stopPropagation()}return this.selectedItem?(this.selectedItem==a?(this.deselectItem(),this.textTransformItem=null):c||(this.children.includes(BFN.TransformItemGroup)||(BFN.TransformItemGroup.transformLayer=this,this.addChild(BFN.TransformItemGroup)),BFN.TransformItemGroup.canvasScale=this._scale,BFN.TransformItemGroup.addGroupItems([this.selectedItem,a]),s(a),this.updateTransformItemGroup()),void e.stopPropagation()):(a.selectedByMouse=!1,this.selectItem(a),s(a),void e.stopPropagation())}if(this.resetTransformItemGroup(),!(l||u||c||a===this.selectedItem||e.externalPress)){var h=[];this.children.forEach(function(e){e instanceof BFN.TransformItem&&e.projectItemVO&&!h.includes(e.projectItemVO.itemID)&&h.push(e.projectItemVO.itemID)});var d=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]),m=[];if(d.forEach(function(e){e.itemIDs.forEach(function(e){!m.includes(e)&&h.includes(e)&&m.push(e)})}),m.length>1)return BFN.GroupManager.selectGroups(d.map(function(e){return e.id}),!0),void this.handleTransformItemGroupPressed(e,!0)}if(l)return i=function(){for(var e=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]),t=BFN.GroupManager.getSectionGroupVOs(),o=t.length;--o>-1;){var s=t[o];e.includes(s)&&t.splice(o,1)}if(t.length){BFN.TransformModel.contextMenu.showButton("add_to_group");var l={};t.forEach(function(e){l[e.name]={onClick:function(){BFN.GroupManager.addItemsToGroup(e.id,[a.itemID]),n(),i(),r()},translate:!1}}),BFN.TransformModel.contextMenu.updateChildren("add_to_group",l)}else BFN.TransformModel.contextMenu.hideButton("add_to_group")},r=function(){var e=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]);if(e.length){BFN.TransformModel.contextMenu.showButton("remove_from_group");var t={};e.forEach(function(e){t[e.name]={onClick:function(){BFN.GroupManager.removeItemsFromGroup(e.id,[a.itemID]),n(),i(),r()},translate:!1}}),BFN.TransformModel.contextMenu.updateChildren("remove_from_group",t)}else BFN.TransformModel.contextMenu.hideButton("remove_from_group")},(n=function(){var e=BFN.GroupManager.getGroupVOsFromItemIDs([a.itemID]);if(e.length){BFN.TransformModel.contextMenu.showButton("select_group");var t={};e.forEach(function(e){t[e.name]={onClick:function(t){var n=!(!t.metaKey&&!t.ctrlKey);BFN.GroupManager.selectGroups([e.id],!1,n)},translate:!1}}),BFN.TransformModel.contextMenu.updateChildren("select_group",t)}else BFN.TransformModel.contextMenu.hideButton("select_group")})(),i(),r(),BFN.TransformModel.contextMenu.toggleButton("canvas","frame_texture"===a.type),BFN.TransformModel.contextMenu.show(o.pageX,o.pageY),a.selectedByMouse=!1,this.selectItem(a),s(a),void e.stopPropagation();if("frame_texture"===a.type&&o.shiftKey)a.dragFrame(e);else{a.selectedByMouse=!0;var p=!1;a===this.selectedItem&&(p=!0),e.externalPress&&(a.selectedByMouse=!1),this.selectItem(a),s(a),a.itemMoved=!1,"text"===a.type&&p?this.textTransformItem=a:this.textTransformItem=null,e.stopPropagation()}}},Wx.prototype.handleItemReleased=function(e){if(!BFN.GestureManager.multiplePointersActive&&this.textTransformItem&&"text"==this.textTransformItem.type&&!this.textTransformItem.itemMoved&&!this.textTransformItem.preventEditText&&![BFN.TransformModel.focusedTransformItem,BFN.TransformModel.targetTransformItem].includes(this.textTransformItem)){var t=this.textTransformItem?this.textTransformItem:null;this.deselectItem(),t&&(BFN.FabricManager.editText(t,e.data.global.x,e.data.global.y),BFN.TransformModel.selectedTransformItemText=t)}},Wx.prototype.handleItemDisplayUpdated=function(e){var t=e.dispatcher;t.align&&this.alignItem(t),this.dispatchEvent(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED)},Wx.prototype.handleGetSnapCoordinates=function(e){var t,n=e.dispatcher;if(n.snapCoordinates.splice(0),BFN.TransformModel.snappingEnabled){var i=new BFN.Rectangle(-this.frameWidth/2,-this.frameHeight/2,this.frameWidth,this.frameHeight);n.snapCoordinates.push({id:"canvas",bounds:i,position:"horizontal",value:i.left}),n.snapCoordinates.push({id:"canvas",bounds:i,position:"horizontal",value:i.center}),n.snapCoordinates.push({id:"canvas",bounds:i,position:"horizontal",value:i.right}),n.snapCoordinates.push({id:"canvas",bounds:i,position:"vertical",value:i.top}),n.snapCoordinates.push({id:"canvas",bounds:i,position:"vertical",value:i.middle}),n.snapCoordinates.push({id:"canvas",bounds:i,position:"vertical",value:i.bottom}),BFN.TransformGuides&&BFN.TransformGuides.visible&&BFN.TransformGuides.transformGuideData&&BFN.TransformGuides.transformGuideData.length&&BFN.TransformGuides.transformGuideData.forEach(function(e){n.snapCoordinates.push({id:"guide",bounds:i,position:"x"===e.axis?"horizontal":"vertical",value:e.value})});var r=[],a=this.children,o="group"==n.type?n.selectedItems:[];this.transformItems.forEach(function(e){if(e&&n!=e&&a.includes(e)&&e.accurateBounds&&!o.includes(e)){var t=BFN.Util.getTransformItemBounds(e),i=new BFN.Rectangle(t.minX+e.accurateBounds.minX,t.minY+e.accurateBounds.minY,e.accurateBounds.width,e.accurateBounds.height);n.snapCoordinates.push({bounds:i,position:"horizontal",value:i.left}),n.snapCoordinates.push({bounds:i,position:"horizontal",value:i.center}),n.snapCoordinates.push({bounds:i,position:"horizontal",value:i.right}),n.snapCoordinates.push({bounds:i,position:"vertical",value:i.top}),n.snapCoordinates.push({bounds:i,position:"vertical",value:i.middle}),n.snapCoordinates.push({bounds:i,position:"vertical",value:i.bottom}),r.push(i)}}),n.otherItemAccurateBoundsList.splice(0),(t=n.otherItemAccurateBoundsList).push.apply(t,r);for(var s=n.snapGapRects={},l=0;l<r.length;l++)for(var u=r[l],c=0;c<r.length;c++){var h=r[c];if(h!=u){var d=h.neighbors(u);if(d&&["right","bottom"].includes(d.side)){for(var m=!0,p=r.length;--p>-1&&m;){var g=r[p];if(![u,h].includes(g)&&g.intersects(d.intersectRect,1)&&!g.containsRect(d.intersectRect))switch(d.direction){case"horizontal":m=g.left<d.intersectRect.left&&g.right>d.intersectRect.right;break;case"vertical":m=g.top<d.intersectRect.top&&g.bottom>d.intersectRect.bottom}}if(m){var f=(Math.round(10*d.distance)/10).toFixed(1);s.hasOwnProperty(d.direction)||(s[d.direction]={}),s[d.direction].hasOwnProperty(f)||(s[d.direction][f]=[]),s[d.direction][f].push(d.gapRect)}}}}for(var v in s)for(var y in s[v])for(var x=s[v][y],_=x.length;--_>-1;)for(var I=x[_],T=_;--T>-1;){var b=x[T];if(I.intersects(b))switch(v){case"horizontal":Math.abs(I.left-b.left)<1&&Math.abs(I.right-b.right)<1&&(b.top=Math.min(b.top,I.top),b.bottom=Math.max(b.bottom,I.bottom),x.splice(_,1));break;case"vertical":Math.abs(I.top-b.top)<1&&Math.abs(I.bottom-b.bottom)<1&&(b.left=Math.min(b.left,I.left),b.right=Math.max(b.right,I.right),x.splice(_,1))}}}},Wx.prototype.handleSelectItem=function(e){var t=e.dispatcher;t.selectedByMouse=!1,this.selectItem(t)},Wx.prototype.handleDeselectItem=function(e){this.deselectItem()},Wx.prototype.handleRemoveItem=function(e){this.removeItem(e.dispatcher)},Wx.prototype.handleDestroyItem=function(e){this.destroyItem(e.dispatcher)},Wx.prototype.handleDuplicateItem=function(e){var t=this,n=e.dispatcher,i=new BFN.TransformItemStateVO,r={isDuplicate:!0,sourceTransformItem:n,projectItemVO:n.projectItemVO};for(var a in n.itemObject)r.hasOwnProperty(a)||(r[a]=n.itemObject[a]);if(r.hasOwnProperty("projectItemVO")){var o=new BFN.ProjectItemVO;Object.assign(o,r.projectItemVO),"text"==n.type&&(o.labelTextStyles=JSON.parse(JSON.stringify(r.projectItemVO.labelTextStyles))),n.thumbImage&&n.thumbImage.src&&(o.thumbImageSRC=n.thumbImage.src),r.projectItemVO=o}r.hasOwnProperty("basicShapeVO")&&(r.basicShapeVO=r.basicShapeVO.clone(),r.hasOwnProperty("maskTexture")&&(r.maskTexture=PIXI.RenderTexture.create(32,32))),n.thumbImage&&n.thumbImage.src&&(r.thumbImage=new Image,r.thumbImage.src=n.thumbImage.src),n.accurateBounds&&(r.accurateBounds=Object.assign({},n.accurateBounds));var s=this.addItem(r),l=s.getTransition();r.thumbImage&&(s.thumbImage=r.thumbImage,delete r.thumbImage),BFN.TransformItemGroup.duplicatingGroup||(s.deselectItem(),n.selectItem()),n.updateStateVO(i),i.x+=10,i.y+=10,i.zIndex+=1,i.imageTexture=null,n.accurateBounds&&(i.accurateBounds=Object.assign({},n.accurateBounds)),s.ignoreAccurateBounds=!1;var u=function e(){s.removeEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,e),s.updateStateVO(l.endState),s.updateProjectItemVO(),s.ignoreAccurateBounds=!1,BFN.TransformItemGroup.duplicatingGroup||(s.deselectItem(),s.selectItem()),BFN.TransformLayerEvents.ITEM_DUPLICATED.duplicatedItem=s,t.dispatchEvent(BFN.TransformLayerEvents.ITEM_DUPLICATED),delete BFN.TransformLayerEvents.ITEM_DUPLICATED.duplicatedItem};"text"==s.type?(s.addEventListener(BFN.TransformItemEvents.TEXT_DISPLAY_UPDATED.type,u),BFN.MainUI.renderCanvas(),s.applyTransformItemState(i),BFN.MainUI.renderCanvas()):(s.applyTransformItemState(i),u())},Wx.prototype.handleRegisterTransition=function(e){BFN.TransformStateModel.addTransition(e.dispatcher.getTransition()),this.model.updateProjectVO()},Wx.prototype.handleTransitionApplied=function(e){-1!=this.children.indexOf(e.dispatcher)&&this.dispatchEvent(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED),this.deselectItem(),BFN.ProjectManager.transformItemsPending||this.dispatchEvent(BFN.TransformLayerEvents.ITEMS_UPDATED)},Wx.prototype.handleKeyDown=function(e){var t=this;if(this.debounceHideMeasurements||(this.debounceHideMeasurements=BeFunky.debounce(function(){t.debouncingHideMeasurements&&(t.debouncingHideMeasurements=!1,t.transformTool.item&&!t.altPressed&&t.transformTool.fadeAnimator.increase())},500)),!BeFunky.isModalOpen()&&!BeFunky.isLoadScreenActive()&&(!BFN.TransformModel.transformToolFrame||!BFN.TransformModel.transformToolFrame.active||27==e.keyCode)&&this.appViewState==BFN.AppModel.viewState&&this.selectedItem&&!this.selectedItem.transforming&&!BFN.FabricManager.styleUpdating&&!BFN.FabricManager.styleChangeRequested&&!BFN.isSortableListDragActive&&!BeFunky.isTextBoxFocused()){var n=function(n){var i="group"==t.selectedItem.type;t.selectedItem.createTransition(i?"history_nudge_selection":"history_nudge"),n(),t.transformTool.showItemMeasurements(),t.transformTool.fadeAnimator.decrease(),t.debouncingHideMeasurements=!0,t.debounceHideMeasurements(),i&&t.selectedItem.updateGroupTransform(),t.selectedItem.registerTransition(!0,!1),t.dispatchEvent(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED),e.preventDefault()},i=function(n){n+=" : ".concat(BFN.SentryManager.getDisplayObjectInfo(t.selectedItem)),BFN.SentryManager.reportBreadcrumb('Key: "'.concat(e.key,'" (').concat(e.keyCode,")").concat(BFN.SentryManager.getSpecialKeyString(e)).concat(n?" -> "+n:""),"key_down","keyboard_layer")};switch(e.keyCode){case 18:!this.altPressed&&BFN.TransformModel.showMeasurements&&(this.altPressed=!0,window.addEventListener("keyup",this.handleAltKeyUpBind),window.addEventListener("blur",this.handleAltKeyUpBind),this.transformTool.showItemMeasurements(),this.transformTool.fadeAnimator.decrease());break;case 37:n(function(){t.selectedItem.x-=t.nudgeDistance/t._scale});break;case 38:n(function(){t.selectedItem.y-=t.nudgeDistance/t._scale});break;case 39:n(function(){t.selectedItem.x+=t.nudgeDistance/t._scale});break;case 40:n(function(){t.selectedItem.y+=t.nudgeDistance/t._scale});break;case 8:case 46:i("removeItem/Group"),BFN.TransformModel.removeSelection(),e.preventDefault();break;case 68:this.dPressed||(i("duplicateItem/Group"),this.dPressed=!0,setTimeout(function(){t.dPressed=!1},200),"group"!=this.selectedItem.type||this.selectedItem.duplicatingGroup?this.selectedItem.duplicateItem():this.selectedItem.duplicateGroup()),(e.metaKey||e.ctrlKey)&&e.preventDefault();break;case 27:i("deselectItem"),this.deselectItem()}}},Wx.prototype.handleAltKeyUp=function(e){(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||18===e.keyCode)&&(this.altPressed=!1,window.removeEventListener("keyup",this.handleAltKeyUpBind),window.removeEventListener("blur",this.handleAltKeyUpBind),this.transformTool.item&&!this.debouncingHideMeasurements&&this.transformTool.fadeAnimator.increase())},Object.defineProperty(Wx.prototype,"itemsExist",{get:function(){for(var e=0;e<this.transformItems.length;e++)if(this.children.includes(this.transformItems[e]))return!0;return!1}}),Object.defineProperty(Wx.prototype,"canvasScale",{set:function(e){this._scale=e,this.children.includes(BFN.TransformItemGroup)&&(BFN.TransformItemGroup.canvasScale=e),(this.altPressed||this.debouncingHideMeasurements)&&(this.altPressed&&this.handleAltKeyUpBind(null,!0),this.transformTool.transformSnapGuides.hideLines())},get:function(){return this._scale}}),Object.defineProperty(Wx.prototype,"layerBounds",{get:function(){var e=this,t=null;return this.transformItems.forEach(function(n){e.children.includes(n)&&n.visible&&n.renderable&&("text"===n.type?n.localTextPolygon:n.localPolygon).forEach(function(e){t?(t.left=Math.min(t.left,e.x),t.right=Math.max(t.right,e.x),t.top=Math.min(t.top,e.y),t.bottom=Math.max(t.bottom,e.y)):t=new BFN.Rectangle(e.x,e.y)})}),t}}),BFN.TransformLayer=Wx,Yx.prototype=Object.create(PIXI.Container.prototype),Yx.prototype.init=function(){BeFunky.log("TransformToolSnapGuides Init"),this.initDefaultValues(),this.initStrokeLines(),this.initGraphics(),this.initRulerLabels(),this.hideLines()},Yx.prototype.initDefaultValues=function(){this._centerX=0,this._centerY=0,this._width=100,this._height=100,this._scale=1,this.bgFillFilter=new BFN.filters.BackgroundFillFilter,this.bgFillFilter.resolution=BFN.Stage.resolution},Yx.prototype.initStrokeLines=function(){var e=this;this.strokeLinesH=["top","middle","bottom"],this.strokeLinesV=["left","center","right"],this.strokeLineSides=[].concat(v(this.strokeLinesH),v(this.strokeLinesV)),this.strokeLines={},this.strokeLineSides.forEach(function(t){e.strokeLines[t]=e.createStrokeLine(t)})},Yx.prototype.initGraphics=function(){this.graphics=new PIXI.Graphics,this.addChild(this.graphics)},Yx.prototype.initRulerLabels=function(){this.allRulerLabels=[],this.availableRulerLabels=[],this.usedRulerLabels=[],this.rulerLabelData=[],this.rulerLabelContainer=new PIXI.Container,this.addChild(this.rulerLabelContainer)},Yx.prototype.setCenter=function(e,t){this._centerX=e,this._centerY=t,this.updateDisplay()},Yx.prototype.setDimensions=function(e,t){this._width=Math.abs(e),this._height=Math.abs(t),this.updateDisplay()},Yx.prototype.updateDisplay=function(){this.strokeLines.top.y=this._centerY-this._height/2,this.strokeLines.middle.y=this._centerY,this.strokeLines.bottom.y=this._centerY+this._height/2,this.strokeLines.left.x=this._centerX-this._width/2,this.strokeLines.center.x=this._centerX,this.strokeLines.right.x=this._centerX+this._width/2,BFN.MainUI&&BFN.MainUI.requestRender()},Yx.prototype.showLine=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.strokeLines.hasOwnProperty(e)){if(this.mainUIItemBounds=null,r){var a=BFN.MainUI.toLocal(new PIXI.Point(r.x,r.y)),o=BFN.MainUI.toLocal(new PIXI.Point(r.x+r.width,r.y+r.height));this.mainUIItemBounds=new BFN.Rectangle(a.x,a.y,o.x-a.x,o.y-a.y)}var s=[];n&&n.forEach(function(n){if(n&&n.startPoint&&n.endPoint){var i=t.strokeLines[e],r={};t.strokeLinesH.includes(e)?(r.start=Math.round(i.toLocal(n.startPoint).x*t._scale),r.end=Math.round(i.toLocal(n.endPoint).x*t._scale)):t.strokeLinesV.includes(e)&&(r.start=Math.round(i.toLocal(n.startPoint).x*t._scale),r.end=Math.round(i.toLocal(n.endPoint).x*t._scale)),s.push(r)}});var l=[];i&&i.forEach(function(n){if(n&&n.startPoint&&n.endPoint){var i=t.strokeLines[e],r={};t.strokeLinesH.includes(e)?(r.start=i.toLocal(n.startPoint).x*t._scale,r.end=i.toLocal(n.endPoint).x*t._scale,n.endPoint.x-n.startPoint.x>0&&t.rulerLabelData.push({line:e,value:(Math.round((n.endPoint.x-n.startPoint.x)/t._scale*10)/10).toFixed(1).toString(),x:(n.startPoint.x+n.endPoint.x)/2})):t.strokeLinesV.includes(e)&&(r.start=i.toLocal(n.startPoint).x*t._scale,r.end=i.toLocal(n.endPoint).x*t._scale,r.end-r.start>0&&t.rulerLabelData.push({line:e,value:(Math.round((n.endPoint.y-n.startPoint.y)/t._scale*10)/10).toFixed(1).toString(),y:(n.startPoint.y+n.endPoint.y)/2})),l.push(r)}});var u=this.strokeLines[e];u.showMaskedLines(s),u.showRulers(l),u.visible=!0,BFN.MainUI&&BFN.MainUI.requestRender()}},Yx.prototype.hideLines=function(){var e=this;this.strokeLineSides.forEach(function(t){e.strokeLines[t].visible=!1}),this.graphics.clear(),this.hideRulerLabels(),BFN.MainUI&&BFN.MainUI.requestRender()},Yx.prototype.showRulerLabel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=null;this.availableRulerLabels.length?((r=this.availableRulerLabels.shift()).text=e,r.visible=!0):((r=new PIXI.Text(e,{fontFamily:"Times New Roman",fontSize:13,fill:16777215,align:"center",padding:3})).filters=[this.bgFillFilter],r.texture.setScaleMode(PIXI.SCALE_MODES.NEAREST),this.allRulerLabels.push(r),this.rulerLabelContainer.addChild(r));switch(r.x=t,r.y=n,r.anchor.x=r.anchor.y=.5,i){case"vertical":if(this.mainUIItemBounds){var a=BFN.MainUI.toLocal(new PIXI.Point(r.x,r.y),this.rulerLabelContainer);a.y<=this.mainUIItemBounds.middle?(a.y=Math.max(r.texture.height*r.scale.y/2+0,a.y),a.y=Math.min(this.mainUIItemBounds.top-r.texture.height*r.scale.y/2-0,a.y)):a.y>=this.mainUIItemBounds.middle&&(a.y=Math.min(BFN.StageModel.stageH-r.texture.height*r.scale.y/2-0,a.y),a.y=Math.max(this.mainUIItemBounds.bottom+r.texture.height*r.scale.y/2+0,a.y));var o=this.rulerLabelContainer.toLocal(a,BFN.MainUI);r.y=o.y}break;case"horizontal":if(this.mainUIItemBounds){var s=BFN.MainUI.toLocal(new PIXI.Point(r.x,r.y),this.rulerLabelContainer);s.x<=this.mainUIItemBounds.center?(s.x=Math.max(r.texture.width*r.scale.x/2+0,s.x),s.x=Math.min(this.mainUIItemBounds.left-r.texture.width*r.scale.x/2-0,s.x)):s.x>=this.mainUIItemBounds.center&&(s.x=Math.min(BFN.StageModel.stageW-r.texture.width*r.scale.x/2-0,s.x),s.x=Math.max(this.mainUIItemBounds.right+r.texture.width*r.scale.x/2+0,s.x));var l=this.rulerLabelContainer.toLocal(s,BFN.MainUI);r.x=l.x}}this.usedRulerLabels.push(r)},Yx.prototype.showRulerLabels=function(){var e=this;this.rulerLabelData.forEach(function(t){var n=e.strokeLines[t.line];t.hasOwnProperty("x")||(t.x=e.rulerLabelContainer.toLocal(new PIXI.Point(n.x,0),e).x,t.y=e.rulerLabelContainer.toLocal(new PIXI.Point(0,t.y)).y,t.lineDirection="vertical"),t.hasOwnProperty("y")||(t.x=e.rulerLabelContainer.toLocal(new PIXI.Point(t.x)).x,t.y=e.rulerLabelContainer.toLocal(new PIXI.Point(0,n.y),e).y,t.lineDirection="horizontal"),e.showRulerLabel(t.value,t.x,t.y,t.lineDirection)})},Yx.prototype.hideRulerLabels=function(){var e;this.availableRulerLabels.splice(0),(e=this.availableRulerLabels).push.apply(e,v(this.allRulerLabels)),this.usedRulerLabels.forEach(function(e){e.visible=!1}),this.usedRulerLabels.splice(0),this.rulerLabelData.splice(0)},Yx.prototype.createStrokeLine=function(e){if(this.strokeLineSides.includes(e)){var t=4*BFN.maxImageSize,n=new BFN.StrokeLine(!1,!0,1,!1,4280344831,4278190080,"transform_tool_snap_guide");return this.strokeLinesH.includes(e)&&(n.x=-t/2),this.strokeLinesV.includes(e)&&(n.y=-t/2),n.length=t,n.rotation=this.strokeLinesV.includes(e)?Math.PI/2:0,n.convertToMasked(),n.convertToRuler(),this.addChild(n),n}},Object.defineProperty(Yx.prototype,"scale",{set:function(e){var t=this;this._scale=e,this.strokeLineSides.forEach(function(e){t.strokeLines[e].scale=t._scale}),this.graphics.scale.x=this.graphics.scale.y=1/this._scale,this.rulerLabelContainer.scale.x=this.rulerLabelContainer.scale.y=1/this._scale,BFN.MainUI.requestRender()},get:function(){return this._scale}}),BFN.TransformToolSnapGuides=Yx,qx.prototype=Object.create(PIXI.Sprite.prototype),qx.prototype.init=function(){BeFunky.log("TransformTool Init"),this.initDefaultValues(),this.initTransformSnapGuides(),this.initTransformTool(),this.initTransformToolGizmo(),this.initHandleTextures(),this.initTextHandles(),this.initScaleHandles(),this.initRotationHandle(),this.initDraggers(),this.initFadeAnimator(),this.initTransformToolFrame()},qx.prototype.initDefaultValues=function(){this.PIx2=2*Math.PI,this.PId2=Math.PI/2,this.rotationHandleOffset=25,this.snapSections=24,this.snapDistance=2,this.snapSectionBeta=this.PIx2/this.snapSections,this.screenPixelSnapThreshold=6,this.itemWidth=0,this.itemHeight=0,this._scale=1,this.frameWidth=0,this.frameHeight=0,this.minSize=1,this.minSizeText=10,this.minSizeFrame=10,this.currentTextHandle=null,this.currentScaleHandle=null,this.textAnchor=new PIXI.Point,this.textControl=new PIXI.Point,this.scaleAnchor=new PIXI.Point,this.scaleControl=new PIXI.Point,this.deltaPoint=new PIXI.Point,this.anchorCenter=!1,this.hBeta=0,this.snapDistanceTransform=0,this.snapGuidesCleared=!0,this.otherItemAccurateBounds=[],this.gizmoPadding=10,this.gizmoPaddingDiagonal=Math.sqrt(2*Math.pow(this.gizmoPadding,2)),this.itemZIndex=0,this.itemBlendMode=BFN.CONST.BLEND_MODES.NORMAL,this.iTextData=null,this.itemData=null,this.drawSnapHelpers=!1,this.handleItemAccurateBoundsUpdatedBind=this.handleItemAccurateBoundsUpdated.bind(this)},qx.prototype.initTransformSnapGuides=function(){this.transformSnapGuidesContainer=new PIXI.Container,this.addChild(this.transformSnapGuidesContainer)},qx.prototype.initTransformTool=function(){this.transformTool=new PIXI.Container,this.transformTool.interactive=!0,this.addChild(this.transformTool)},qx.prototype.initTransformToolGizmo=function(){this.transformGizmo=new PIXI.Container,this.transformGizmo.interactive=!1,this.transformGizmo.interactiveChildren=!1,this.transformTool.addChild(this.transformGizmo),this.transformGizmoOutline=new BFN.StrokeRectangle(!0,!0,2,!0,4293783021,4287274495,"dashed_transform_line"),this.transformGizmoOutline.setDimensions(this.itemWidth,this.itemHeight),this.transformGizmo.addChild(this.transformGizmoOutline),this.transformGizmoHandle=new BFN.StrokeLine(!0,!0,2,!0,4293783021,4287274495,"dashed_transform_line"),this.transformGizmoHandle.rotation=-this.PId2,this.transformGizmo.addChild(this.transformGizmoHandle)},qx.prototype.initHandleTextures=function(){this.handleTextureSquare=PIXI.RenderTexture.create(20,20,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{fillColor:268435456,cornerRadius:4,paddingY:5}),BFN.graphics.drawShape("roundedRect",this.handleTextureSquare,{strokeWidth:1,strokeColor:4287274495,fillColor:4294967295,cornerRadius:1,paddingX:1,paddingY:6,clear:!1}),this.handleTextureCircle=PIXI.RenderTexture.create(24,24,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{strokeWidth:1.5,strokeColor:4287274495,fillColor:4294967295,paddingX:4,paddingY:4,clear:!1})},qx.prototype.initTextHandles=function(){this.textHandles={},this.textHandleIDs=["l","r"];for(var e=0;e<this.textHandleIDs.length;e++){var t=this.textHandleIDs[e],n=new BFN.HoverButton;n.buttonMode=!1,n.id=t,n.texture=this.handleTextureSquare,n.on("pointerover",this.handleTextHandleOver.bind(this)),n.on("pointerout",this.handleTextHandleOut.bind(this)),n.on("pointerdown",this.handleTextHandlePress.bind(this)),this.textHandles[t]=n,this.transformTool.addChild(n)}},qx.prototype.initScaleHandles=function(){this.scaleHandles={},this.scaleHandleIDs=["l","tl","t","tr","r","br","b","bl"],this.sideHandleIDs=["l","t","r","b"];for(var e=0;e<this.scaleHandleIDs.length;e++){var t=this.scaleHandleIDs[e],n=new BFN.HoverButton;n.buttonMode=!1,n.id=t,n.texture=e%2?this.handleTextureCircle:this.handleTextureSquare,n.on("pointerover",this.handleScaleHandleOver.bind(this)),n.on("pointerout",this.handleScaleHandleOut.bind(this)),n.on("pointerdown",this.handleScaleHandlePress.bind(this)),this.scaleHandles[t]=n,this.transformTool.addChild(n)}},qx.prototype.initRotationHandle=function(){this.rotationHandle=new BFN.HoverButton,this.rotationHandle.buttonMode=!1,this.rotationHandle.texture=this.handleTextureCircle,this.rotationHandle.on("pointerover",this.handleRotationHandleOver.bind(this)),this.rotationHandle.on("pointerout",this.handleRotationHandleOut.bind(this)),this.rotationHandle.on("pointerdown",this.handleRotationHandlePress.bind(this)),this.rotationHandle.selectAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleRotationHandleSelectAnimatorUpdate.bind(this)),this.transformTool.addChild(this.rotationHandle)},qx.prototype.initDraggers=function(){this.toolDraggers=[],this.gizmoDragger=new BFN.Dragger,this.gizmoDragger.useBounds=!0,this.gizmoDragger.stickyDrag=!1,this.gizmoDragger.pixelDragThreshold=5,this.gizmoDragger.preventSelectionDrag=!0,this.gizmoDragger.deselectItemGroup=!1,this.gizmoDragger.preRenderDragOnly=!0,this.gizmoDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleTransformGizmoDraggingStarted.bind(this)),this.gizmoDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleTransformGizmoDragging.bind(this)),this.gizmoDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleTransformGizmoDraggingComplete.bind(this)),this.toolDraggers.push(this.gizmoDragger),this.textHandleDragger=new BFN.Dragger,this.textHandleDragger.useBounds=!1,this.textHandleDragger.autoDrag=!1,this.textHandleDragger.preventSelectionDrag=!0,this.textHandleDragger.deselectItemGroup=!1,this.textHandleDragger.preRenderDragOnly=!0,this.textHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleTextHandleDraggingStarted.bind(this)),this.textHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleTextHandleDragging.bind(this)),this.textHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleTextHandleDraggingComplete.bind(this)),this.toolDraggers.push(this.textHandleDragger),this.scaleHandleDragger=new BFN.Dragger,this.scaleHandleDragger.useBounds=!1,this.scaleHandleDragger.autoDrag=!1,this.scaleHandleDragger.preventSelectionDrag=!0,this.scaleHandleDragger.deselectItemGroup=!1,this.scaleHandleDragger.preRenderDragOnly=!0,this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleScaleHandleDraggingStarted.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleScaleHandleDragging.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleScaleHandleDraggingComplete.bind(this)),this.toolDraggers.push(this.scaleHandleDragger),this.rotationHandleDragger=new BFN.Dragger,this.rotationHandleDragger.useBounds=!1,this.rotationHandleDragger.autoDrag=!1,this.rotationHandleDragger.preventSelectionDrag=!0,this.rotationHandleDragger.deselectItemGroup=!1,this.rotationHandleDragger.preRenderDragOnly=!0,this.rotationHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleRotationHandleDraggingStarted.bind(this)),this.rotationHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleRotationHandleDragging.bind(this)),this.rotationHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleRotationHandleDraggingComplete.bind(this)),this.toolDraggers.push(this.rotationHandleDragger)},qx.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this)),this.fadeAnimator.addEventListener(BFN.AnimatorEvents.INCREASE_COMPLETE.type,this.handleFadeAnimatorUpdateComplete.bind(this)),this.fadeAnimator.setAnimatorFactor(0)},qx.prototype.updateOtherItemAccurateBounds=function(){var e=this;if(this.item&&this.item.accurateBounds){var t=this.transformLayer.children,n="group"==this.item.type?this.item.selectedItems:[];this.otherItemAccurateBounds.splice(0),this.transformLayer.transformItems.forEach(function(i){if(i&&e.item!=i&&t.includes(i)&&i.accurateBounds&&!n.includes(i)){var r=BFN.Util.getTransformItemBounds(i),a=new BFN.Rectangle(r.minX+i.accurateBounds.minX,r.minY+i.accurateBounds.minY,i.accurateBounds.width,i.accurateBounds.height);e.otherItemAccurateBounds.push(a)}})}},qx.prototype.showItemMeasurements=function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.transformSnapGuides.hideLines(),this.item&&this.item.accurateBounds&&BFN.TransformModel.showMeasurements){t&&this.updateOtherItemAccurateBounds();var n=BFN.Util.getTransformItemBounds(this.item),i=new BFN.Rectangle(n.minX+this.item.accurateBounds.minX,n.minY+this.item.accurateBounds.minY,this.item.accurateBounds.width,this.item.accurateBounds.height),r={},a=["left","center","right"],o=["top","middle","bottom"],s=[].concat(a,o);for(var l in s.forEach(function(t){var n=r[t]={};n.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point},n.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point},a.includes(t)&&(n.axis="y",n.rulerSegmentA.side="top",n.rulerSegmentB.side="bottom",n.rulerSegmentA.startPoint.x=n.rulerSegmentA.endPoint.x=i[t],n.rulerSegmentB.startPoint.x=n.rulerSegmentB.endPoint.x=i[t],n.rulerSegmentA.startPoint.y=Math.min(i.top,-e.frameHeight/2),n.rulerSegmentA.endPoint.y=i.top,n.rulerSegmentB.startPoint.y=i.bottom,n.rulerSegmentB.endPoint.y=Math.max(i.bottom,e.frameHeight/2)),o.includes(t)&&(n.axis="x",n.rulerSegmentA.side="left",n.rulerSegmentB.side="right",n.rulerSegmentA.startPoint.y=n.rulerSegmentA.endPoint.y=i[t],n.rulerSegmentB.startPoint.y=n.rulerSegmentB.endPoint.y=i[t],n.rulerSegmentA.startPoint.x=Math.min(i.left,-e.frameWidth/2),n.rulerSegmentA.endPoint.x=i.left,n.rulerSegmentB.startPoint.x=i.right,n.rulerSegmentB.endPoint.x=Math.max(i.right,e.frameWidth/2))}),this.itemNeighbors||(this.itemNeighbors={left:[],top:[],right:[],bottom:[]}),this.itemNeighbors)this.itemNeighbors[l].splice(0);this.otherItemAccurateBounds.forEach(function(t){var n=i.neighbors(t);n&&e.itemNeighbors[n.side].push(n)});var u=function(e,t,n){return n>=e&&n<=t},c={};s.forEach(function(t){var n=r[t];e.itemNeighbors[n.rulerSegmentA.side].forEach(function(e){var r=e.intersectRect,a=!1;switch(n.rulerSegmentA.side){case"left":u(r.top,r.bottom,i[t])&&r.left>n.rulerSegmentA.startPoint.x&&(n.rulerSegmentA.startPoint.x=r.left,a=!0);break;case"top":u(r.left,r.right,i[t])&&r.top>n.rulerSegmentA.startPoint.y&&(n.rulerSegmentA.startPoint.y=r.top,a=!0)}a&&(c[t]||(c[t]={}),c[t][n.rulerSegmentA.side]||(c[t][n.rulerSegmentA.side]=e.rect))}),e.itemNeighbors[n.rulerSegmentB.side].forEach(function(e){var r=e.intersectRect,a=!1;switch(n.rulerSegmentB.side){case"right":u(r.top,r.bottom,i[t])&&r.right<n.rulerSegmentB.endPoint.x&&(n.rulerSegmentB.endPoint.x=r.right,a=!0);break;case"bottom":u(r.left,r.right,i[t])&&r.bottom<n.rulerSegmentB.endPoint.y&&(n.rulerSegmentB.endPoint.y=r.bottom,a=!0)}a&&(c[t]||(c[t]={}),c[t][n.rulerSegmentB.side]||(c[t][n.rulerSegmentB.side]=e.rect))})});var h={left:[],top:[],right:[],bottom:[]};s.forEach(function(t){var n=r[t];n.rulerSegmentA.startPoint=e.toGlobal(n.rulerSegmentA.startPoint),n.rulerSegmentA.endPoint=e.toGlobal(n.rulerSegmentA.endPoint),n.rulerSegmentB.startPoint=e.toGlobal(n.rulerSegmentB.startPoint),n.rulerSegmentB.endPoint=e.toGlobal(n.rulerSegmentB.endPoint);var i=Math.round(n.rulerSegmentA.endPoint[n.axis]-n.rulerSegmentA.startPoint[n.axis]),a=Math.round(n.rulerSegmentB.endPoint[n.axis]-n.rulerSegmentB.startPoint[n.axis]),o=h[n.rulerSegmentA.side],s=h[n.rulerSegmentB.side];o.push(i),s.push(a),o.length>1&&o[o.length-1]===o[o.length-2]&&(n.rulerSegmentA=null),s.length>1&&s[s.length-1]===s[s.length-2]&&(n.rulerSegmentB=null)});var d=this.transformLayer.toGlobal(new PIXI.Point(i.x,i.y)),m=this.transformLayer.toGlobal(new PIXI.Point(i.x+i.width,i.y+i.height)),p=new BFN.Rectangle(d.x,d.y,m.x-d.x,m.y-d.y);for(var g in r){var f=r[g];this.showSnapGuideLine(g,[f.rulerSegmentA,f.rulerSegmentB],[f.rulerSegmentA,f.rulerSegmentB],p)}this.snapGuidesCleared||this.transformSnapGuides.hideLines(),this.transformSnapGuides.setCenter(i.center,i.middle),this.transformSnapGuides.setDimensions(i.width,i.height),this.transformSnapGuides.showRulerLabels();var v=this.transformSnapGuides.graphics.toLocal(new PIXI.Point(d.x,d.y)),y=this.transformSnapGuides.graphics.toLocal(new PIXI.Point(m.x,m.y)),x=new BFN.Rectangle(v.x,v.y,y.x-v.x,y.y-v.y);this.transformSnapGuides.graphics.clear(),this.transformSnapGuides.graphics.lineStyle(1,2154751),this.transformSnapGuides.graphics.drawRect(x.x,x.y,x.width,x.height);var _=new PIXI.Point,I=new PIXI.Point;for(var T in c)for(var b in c[T]){var S=c[T][b];switch(b){case"left":_.x=I.x=S.right,_.y=S.top,I.y=S.bottom;break;case"right":_.x=I.x=S.left,_.y=S.top,I.y=S.bottom;break;case"top":_.y=I.y=S.bottom,_.x=S.left,I.x=S.right;break;case"bottom":_.y=I.y=S.top,_.x=S.left,I.x=S.right}var C=this.transformSnapGuides.graphics.toLocal(_,this.transformLayer),B=this.transformSnapGuides.graphics.toLocal(I,this.transformLayer);this.transformSnapGuides.graphics.moveTo(C.x,C.y),this.transformSnapGuides.graphics.lineTo(B.x,B.y)}}},qx.prototype.selectItem=function(e,t){if(e){e!=this.item&&(this.fadeAnimator.setAnimatorFactor(0),this.deselectItem(),this.item=e,this.updateDisplay());for(var n=0;n<this.textHandleIDs.length;n++){var i=this.textHandleIDs[n];this.textHandles[i].visible="text"===this.item.type}for(var r=0;r<this.sideHandleIDs.length;r++){var a=this.sideHandleIDs[r];this.scaleHandles[a].visible=!(["text","group"].includes(this.item.type)&&!this.item.isStretchable)}this.itemCenterOffsetX=0,this.itemCenterOffsetY=0,this.item.selectedByMouse&&this.item.accurateBounds?(this.item.transforming=!0,this.gizmoDragger.scale=this._scale,this.gizmoDragger.drag(this.transformTool),this.fadeAnimator.decrease(),"group"==this.item.type&&this.item.fadeAnimator.decrease()):(this.fadeAnimator.increase(),"group"==this.item.type&&this.item.fadeAnimator.increase())}},qx.prototype.deselectItem=function(){this.toolDraggers.forEach(function(e){e.dragging&&e.stopDrag(),e.active&&e.completeStopDrag()}),this.item&&(this.item.transforming=!1,this.item=null),this.fadeAnimator.decrease(),this.transformSnapGuides.hideLines(),BFN.MainUI.tooltip=null},qx.prototype.disableHandles=function(e){for(var t in this.textHandles){var n=this.textHandles[t];n!=e&&(n.interactive=!1)}for(var i in this.scaleHandles){var r=this.scaleHandles[i];r!=e&&(r.interactive=!1)}this.rotationHandle!=e&&(this.rotationHandle.interactive=!1)},qx.prototype.enableHandles=function(){for(var e in this.textHandles){this.textHandles[e].interactive=!0}for(var t in this.scaleHandles){this.scaleHandles[t].interactive=!0}this.rotationHandle.interactive=!0},qx.prototype.updateHandleScales=function(){for(var e in this.textHandles){var t=this.textHandles[e];t.scale.x=t.scale.y=1/this._scale}for(var n in this.scaleHandles){var i=this.scaleHandles[n];i.scale.x=i.scale.y=1/this._scale}this.rotationHandle.scale.x=this.rotationHandle.scale.y=1/this._scale},qx.prototype.drawGizmo=function(){this.transformGizmoOutline.setDimensions(this.itemWidth+this.gizmoPadding/this._scale*2,this.itemHeight+this.gizmoPadding/this._scale*2),this.transformGizmoHandle.y=-(this.itemHeight/2+this.gizmoPadding/this._scale),this.transformGizmoHandle.length=this.rotationHandleOffset*(1/this._scale)},qx.prototype.updateDisplay=function(){this.item&&!BFN.UndoManager.updating&&(this.updateTransformValues(),this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo())},qx.prototype.updateTransformValues=function(){if(this.item){var e=this.item.bounds;this.itemBaseWidth=e.width,this.itemBaseHeight=e.height,this.itemWidth=this.itemBaseWidth*this.item.scale.x,this.itemHeight=this.itemBaseHeight*this.item.scale.y,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.itemCenterX=this.item.x+Math.cos(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.itemCenterY=this.item.y+Math.sin(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.itemAspectRatio=this.item.scale.x/this.item.scale.y,this.transformGizmo.x=this.transformGizmo.y=0,this.transformGizmo.rotation=this.item.rotation,this.hBeta=this.item.rotation,this.vBeta=this.hBeta-this.PId2,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY}},qx.prototype.updateTextHandlePosition=function(){var e=(this.itemHeight+this.gizmoPadding/this._scale*2)*this._scale;for(var t in this.textHandles){var n=this.textHandles[t];n.rotation=this.hBeta;var i=null,r=null;switch(n.id){case"l":i=this.hBeta-Math.PI,r=this.hBeta+Math.PI;break;case"r":i=this.hBeta,r=this.hBeta}null!==i&&(n.betaPadding=r,n.noPaddingX=this.transformGizmo.x+Math.cos(i)*(this.itemWidth/2),n.noPaddingY=this.transformGizmo.y+Math.sin(i)*(this.itemWidth/2),n.x=n.noPaddingX+Math.cos(n.betaPadding)*(this.gizmoPadding/this._scale),n.y=n.noPaddingY+Math.sin(n.betaPadding)*(this.gizmoPadding/this._scale),n.rotation=this.hBeta+this.PId2,n.active=e>this.handleTextureCircle.width+this.handleTextureSquare.width-8)}},qx.prototype.updateScaleHandlePosition=function(){var e=(this.itemWidth+this.gizmoPadding/this._scale*2)*this._scale,t=(this.itemHeight+this.gizmoPadding/this._scale*2)*this._scale;for(var n in this.scaleHandles){var i=this.sideHandleIDs.includes(n)?"side":"corner",r=null,a=null,o=null;switch(n){case"tl":r=this.itemCenterBeta+this.hBeta-Math.PI,a=-.75*Math.PI+this.hBeta;break;case"tr":r=-this.itemCenterBeta+this.hBeta,a=-.25*Math.PI+this.hBeta;break;case"bl":r=Math.PI-this.itemCenterBeta+this.hBeta,a=.75*Math.PI+this.hBeta;break;case"br":r=this.itemCenterBeta+this.hBeta,a=.25*Math.PI+this.hBeta;break;case"l":r=this.hBeta-Math.PI,o=this.hBeta+Math.PI;break;case"r":r=this.hBeta,o=this.hBeta;break;case"t":r=this.hBeta-Math.PI/2,o=this.hBeta-Math.PI/2;break;case"b":r=this.hBeta+Math.PI/2,o=this.hBeta+Math.PI/2}if(null!==r){var s=this.scaleHandles[n];switch(i){case"corner":s.betaDiagonal=a,s.noPaddingX=this.transformGizmo.x+Math.cos(r)*this.itemRadius,s.noPaddingY=this.transformGizmo.y+Math.sin(r)*this.itemRadius,s.x=s.noPaddingX+Math.cos(a)*(this.gizmoPaddingDiagonal/this._scale),s.y=s.noPaddingY+Math.sin(a)*(this.gizmoPaddingDiagonal/this._scale);break;case"side":var l=["l","r"].includes(s.id);s.betaPadding=o,s.noPaddingX=this.transformGizmo.x+Math.cos(r)*((l?this.itemWidth:this.itemHeight)/2),s.noPaddingY=this.transformGizmo.y+Math.sin(r)*((l?this.itemWidth:this.itemHeight)/2),s.x=s.noPaddingX+Math.cos(s.betaPadding)*(this.gizmoPadding/this._scale),s.y=s.noPaddingY+Math.sin(s.betaPadding)*(this.gizmoPadding/this._scale),s.rotation=this.hBeta+(l?this.PId2:0),s.active=(l?t:e)>this.handleTextureCircle.width+this.handleTextureSquare.width-8}}}},qx.prototype.updateRotationHandlePosition=function(){this.rotationHandle.x=this.transformGizmo.x-Math.cos(this.vBeta)*(-Math.abs(this.itemHeight/2)-this.rotationHandleOffset*(1/this._scale)-this.gizmoPadding/this._scale),this.rotationHandle.y=this.transformGizmo.y-Math.sin(this.vBeta)*(-Math.abs(this.itemHeight/2)-this.rotationHandleOffset*(1/this._scale)-this.gizmoPadding/this._scale)},qx.prototype.initTransformToolFrame=function(){this.transformToolFrame=new BFN.TransformToolFrame(this),this.addChild(this.transformToolFrame)},qx.prototype.resizeText=function(){var e=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent),t=new PIXI.Point(e.x+BFN.MainUI.x-this.textAnchor.x,e.y+BFN.MainUI.y-this.textAnchor.y),n=Math.cos(Math.atan2(t.y,t.x)+this.textControl.beta-this.hBeta)<=0?0:Math.ceil((this.getPointToLineDistance(t,Math.tan(this.vBeta))-2*this.gizmoPadding)/this._scale),i=this.item,r=i.iText,a=i.textScale*i.scale.x;this.item.iText.width=n/a,this.item.iText.initDimensions(),n=r.width*a,r.width=n/a,r.initDimensions();var o=Math.ceil(r.height*a);this.textControl.beta<Math.PI/2?(r.left=this.iTextData.topLeft.x,r.top=this.iTextData.topLeft.y,this.item.x=this.itemData.topLeft.x,this.item.y=this.itemData.topLeft.y):(r.left=this.iTextData.topRight.x-Math.cos(this.hBeta)*n*this._scale,r.top=this.iTextData.topRight.y-Math.sin(this.hBeta)*n*this._scale,this.item.x=this.itemData.topRight.x-Math.cos(this.hBeta)*n,this.item.y=this.itemData.topRight.y-Math.sin(this.hBeta)*n),BFN.FabricManager.fabricCanvas.renderAll(),this.itemWidth=n,this.itemHeight=o,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.updateDisplayForTextResize()},qx.prototype.updateDisplayForTextResize=function(){this.item&&(this.itemCenterX=this.item.x+Math.cos(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.itemCenterY=this.item.y+Math.sin(this.itemCenterBeta+this.item.rotation)*this.itemRadius,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo())},qx.prototype.freeformScale=function(){var e=this;if(!(["text","group"].includes(this.item.type)&&!this.item.isStretchable)){var t=this.sideHandleIDs.includes(this.currentScaleHandle.id)?"side":"corner",n=["l","r"].includes(this.currentScaleHandle.id),i=null,r=function(){switch(i=e.transformTool.getPointerPosition(BFN.MainUI.pointerEvent),t){case"corner":e.scaleControl.x=i.x-Math.cos(e.currentScaleHandle.betaDiagonal)*(e.gizmoPaddingDiagonal/e._scale),e.scaleControl.y=i.y-Math.sin(e.currentScaleHandle.betaDiagonal)*(e.gizmoPaddingDiagonal/e._scale);break;case"side":e.scaleControl.x=i.x-Math.cos(e.currentScaleHandle.betaPadding)*(e.gizmoPadding/e._scale),e.scaleControl.y=i.y-Math.sin(e.currentScaleHandle.betaPadding)*(e.gizmoPadding/e._scale)}},a=function(){var i=!0,r=null;"side"===t&&(i=(e.item.rotation+e.PIx2)%e.PId2<Math.PI/180,r=!!((e.item.rotation+e.PIx2)%e.PIx2/e.PId2%2)?n?"vertical":"horizontal":n?"horizontal":"vertical");if(BFN.TransformModel.snappingEnabled&&e.scaleHandleDragger.wasDragged&&i){for(var a=!1,o=!1,s={},l=0;l<e.item.snapCoordinates.length;l++){var u=e.item.snapCoordinates[l],c=e.transformLayer.toLocal(e.scaleControl,e.transformTool);switch(u.position){case"horizontal":var h=c.x-u.value;if(Math.abs(h)<(a?e.snapDistanceTransformSnapped:e.snapDistanceTransform)){a||(c.x=u.value);var d=e.transformTool.toLocal(c,e.transformLayer);e.scaleControl.x=d.x,e.scaleControl.y=d.y,a=!0,s.hasOwnProperty("center")||(s.center={maskedSegment:null,values:[],axis:"y"}),s.center.values.includes(u.bounds.top)||s.center.values.push(u.bounds.top),s.center.values.includes(u.bounds.bottom)||s.center.values.push(u.bounds.bottom)}break;case"vertical":var m=c.y-u.value;if(Math.abs(m)<(o?e.snapDistanceTransformSnapped:e.snapDistanceTransform)){o||(c.y=u.value);var p=e.transformTool.toLocal(c,e.transformLayer);e.scaleControl.x=p.x,e.scaleControl.y=p.y,o=!0,s.hasOwnProperty("middle")||(s.middle={maskedSegment:null,values:[],axis:"x"}),s.middle.values.includes(u.bounds.left)||s.middle.values.push(u.bounds.left),s.middle.values.includes(u.bounds.right)||s.middle.values.push(u.bounds.right)}}}var g=BFN.Util.getTransformItemBounds(e.item,!0);for(var f in g.x={a:g.minX,b:g.maxX},g.y={a:g.minY,b:g.maxY},s)if("corner"===t||"horizontal"===r&&"center"===f&&a||"vertical"===r&&"middle"===f&&o){var v=s[f];v.maskedSegment={startPoint:new PIXI.Point,endPoint:new PIXI.Point},v.maskedSegment.startPoint[v.axis]=g[v.axis].a,v.maskedSegment.endPoint[v.axis]=g[v.axis].b,v.values.sort(function(e,t){return e-t});for(var y=0;y<v.values.length;y++)v.maskedSegment.startPoint[v.axis]=Math.min(v.maskedSegment.startPoint[v.axis],v.values[y]),v.maskedSegment.endPoint[v.axis]=Math.max(v.maskedSegment.endPoint[v.axis],v.values[y]);v.maskedSegment.startPoint=e.transformLayer.toGlobal(v.maskedSegment.startPoint),v.maskedSegment.endPoint=e.transformLayer.toGlobal(v.maskedSegment.endPoint),e.showSnapGuideLine(f,[v.maskedSegment])}var x=e.transformLayer.toLocal(e.scaleControl,e.transformTool);e.transformSnapGuides.setCenter(x.x,x.y),e.transformSnapGuides.setDimensions(3,3)}};r(),a();var o=new PIXI.Point(this.scaleAnchor.x,this.scaleAnchor.y);o=this.transformGizmo.toLocal(o,this.transformTool);var s=new PIXI.Point(this.scaleControl.x,this.scaleControl.y);s=this.transformGizmo.toLocal(s,this.transformTool);var l=new PIXI.Point(this.currentScaleHandle.noPaddingX,this.currentScaleHandle.noPaddingY);l=this.transformGizmo.toLocal(l,this.transformTool);var u=!("side"===t&&!n)&&(o.x-l.x)*(o.x-s.x)<0,c=("side"!==t||!n)&&(o.y-l.y)*(o.y-s.y)<0,h=this.minSize,d=this.minSize;switch(this.item.type){case"text":h=d=this.minSizeText;break;case"frame_texture":h=d=this.minSizeFrame;var m=this.item.itemContent.frameSprite;m.frameScaling&&(h=Math.max(h,m.initialRealDimensions.x/m.baseWidth*this.minSizeFrame),d=Math.max(d,m.initialRealDimensions.y/m.baseHeight*this.minSizeFrame));break;case"texture":this.item.isShape||(h=d=this.minSizeFrame)}if(this.scaleHandleDragger.altKey){switch(this.anchorCenter||(this.anchorCenter=!0,this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateDisplay(),BFN.MainUI.renderCanvas(),i=this.transformTool.getPointerPosition(BFN.MainUI.pointerEvent)),r(),a(),t){case"corner":this.newItemWidth=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.vBeta)),this.newItemHeight=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.hBeta));break;case"side":n?(this.newItemWidth=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.vBeta)),this.newItemHeight=this.itemHeight):(this.newItemWidth=this.itemWidth,this.newItemHeight=2*this.getPointToLineDistance(this.scaleControl,Math.tan(this.hBeta)))}this.newItemWidth=u?h:Math.max(h,this.newItemWidth),this.newItemHeight=c?d:Math.max(d,this.newItemHeight)}else{this.anchorCenter=!1;var p=new PIXI.Point(this.scaleControl.x,this.scaleControl.y);p=this.transformGizmo.toLocal(p,this.transformTool);var g=new PIXI.Point(this.scaleAnchor.x,this.scaleAnchor.y);switch(g=this.transformGizmo.toLocal(g,this.transformTool),t){case"corner":var f=Math.sqrt(Math.pow(this.scaleControl.x-this.scaleAnchor.x,2)+Math.pow(this.scaleControl.y-this.scaleAnchor.y,2)),v=Math.abs(Math.atan2(p.y-g.y,p.x-g.x));v=v>this.PId2?Math.PI-v:v,this.newItemWidth=Math.cos(v)*f,this.newItemHeight=Math.sin(v)*f;break;case"side":n?(this.newItemWidth=Math.abs(g.x-p.x),this.newItemHeight=this.itemHeight):(this.newItemWidth=this.itemWidth,this.newItemHeight=Math.abs(g.y-p.y))}this.newItemWidth=u?h:Math.max(h,this.newItemWidth),this.newItemHeight=c?d:Math.max(d,this.newItemHeight);var y=new PIXI.Point(g.x,g.y);switch(this.currentScaleHandle.id){case"tl":y.x-=this.newItemWidth/2,y.y-=this.newItemHeight/2;break;case"tr":y.x+=this.newItemWidth/2,y.y-=this.newItemHeight/2;break;case"bl":y.x-=this.newItemWidth/2,y.y+=this.newItemHeight/2;break;case"br":y.x+=this.newItemWidth/2,y.y+=this.newItemHeight/2;break;case"l":y.x-=this.newItemWidth/2;break;case"r":y.x+=this.newItemWidth/2;break;case"t":y.y-=this.newItemHeight/2;break;case"b":y.y+=this.newItemHeight/2}y=this.transformTool.toLocal(y,this.transformGizmo),this.transformGizmo.x=y.x,this.transformGizmo.y=y.y,y=this.toLocal(y,this.transformTool),this.itemCenterX=y.x,this.itemCenterY=y.y}switch(this.item.scale.x=this.newItemWidth/this.itemBaseWidth,this.item.scale.y=this.newItemHeight/this.itemBaseHeight,this.itemAspectRatio=this.item.scale.x/this.item.scale.y,this.itemWidth=this.itemBaseWidth*this.item.scale.x,this.itemHeight=this.itemBaseHeight*this.item.scale.y,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.item.updateFrameTextureDisplay(),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.currentScaleHandle.id){case"tl":case"br":BFN.CursorScreen.cursorRotation=this.hBeta+this.itemCenterBeta;break;case"tr":case"bl":BFN.CursorScreen.cursorRotation=this.hBeta-this.itemCenterBeta;break;case"l":case"r":BFN.CursorScreen.cursorRotation=this.hBeta;break;case"tr":case"bl":BFN.CursorScreen.cursorRotation=this.vBeta}if(this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.anchorCenter){var x=this.getInverseScaleHandle(this.currentScaleHandle);this.scaleAnchor.x=x.noPaddingX,this.scaleAnchor.y=x.noPaddingY}"group"==this.item.type&&this.item.updateGroupTransform()}},qx.prototype.constrainedScale=function(){var e=this,t=this.sideHandleIDs.includes(this.currentScaleHandle.id)?"side":"corner",n=["l","r"].includes(this.currentScaleHandle.id);if("side"===t)switch(this.item.type){case"text":case"group":return}this.scaleHandleDragger.altKey?this.anchorCenter||(this.anchorCenter=!0,this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY):this.anchorCenter=!1;var i=this.transformTool.getPointerPosition(BFN.MainUI.pointerEvent);switch(t){case"corner":this.scaleControl.x=i.x-Math.cos(this.currentScaleHandle.betaDiagonal)*(this.gizmoPaddingDiagonal/this._scale),this.scaleControl.y=i.y-Math.sin(this.currentScaleHandle.betaDiagonal)*(this.gizmoPaddingDiagonal/this._scale);break;case"side":this.scaleControl.x=i.x-Math.cos(this.currentScaleHandle.betaPadding)*(this.gizmoPadding/this._scale),this.scaleControl.y=i.y-Math.sin(this.currentScaleHandle.betaPadding)*(this.gizmoPadding/this._scale)}var r=this.itemBaseHeight/this.itemBaseWidth/this.itemAspectRatio,a=this.minSize;switch(this.item.type){case"text":a=this.minSizeText;break;case"frame_texture":a=this.minSizeFrame;break;case"texture":this.item.isShape||(a=this.minSizeFrame)}var o=Math.max(a,a/r),s=Math.max(a,a*r),l=a,u=l*r,c=Math.sqrt(Math.pow(l,2)+Math.pow(u,2)),h=a,d=h/r,m=Math.sqrt(Math.pow(d,2)+Math.pow(h,2)),p=Math.max(c,m)/2,g=[];if(BFN.TransformModel.snappingEnabled&&this.scaleHandleDragger.wasDragged&&"corner"===t){var f=null;switch(this.currentScaleHandle.id){case"tl":case"br":f=this.item.rotation+this.itemCenterBeta;break;case"bl":case"tr":f=this.item.rotation-this.itemCenterBeta}if(null!==f){var v=Math.sin(f),y=Math.cos(f),x=v?y?v/y:1/0:0;this.drawSnapHelpers&&(this.itemGuidesGraphic.clear(),this.itemGuidesGraphic.lineStyle(1,16711935),this.itemGuidesGraphic.moveTo(this.itemCenterX-2e3*y,this.itemCenterY-2e3*v),this.itemGuidesGraphic.lineTo(this.itemCenterX+2e3*y,this.itemCenterY+2e3*v),this.itemGuidesGraphic.lineStyle(null));var _=this.transformLayer.toLocal(new PIXI.Point(this.currentScaleHandle.noPaddingX,this.currentScaleHandle.noPaddingY),this.transformTool),I=this.transformLayer.toLocal(this.scaleAnchor,this.transformTool),T=Math.atan2(_.y-I.y,_.x-I.x);this.item.snapCoordinates.forEach(function(t){var n=new PIXI.Point(t.value,t.value);switch(t.position){case"horizontal":n.y=0===x?e.itemCenterY:x===1/0?NaN:x*(n.x-e.itemCenterX)+e.itemCenterY;break;case"vertical":n.x=0===x?NaN:x===1/0?e.itemCenterX:(n.y-e.itemCenterY)/x+e.itemCenterX}if(!isNaN(n.x)&&!isNaN(n.y)){var i=Math.atan2(n.y-I.y,n.x-I.x),r=Math.sqrt(Math.pow(n.x-I.x,2)+Math.pow(n.y-I.y,2));Math.abs(i-T)<e.PId2&&r>p&&(n.snapCoordinate=t,g.push(n),e.drawSnapHelpers&&(e.itemGuidesGraphic.beginFill(65280),e.itemGuidesGraphic.drawCircle(n.x,n.y,3),e.itemGuidesGraphic.endFill()))}})}}var b=null,S=null,C=null;switch(this.currentScaleHandle.id){case"tl":case"br":b=(this.hBeta-this.PId2+this.itemCenterBeta+this.PIx2)%this.PIx2;break;case"tr":case"bl":b=(this.hBeta+this.PId2-this.itemCenterBeta+this.PIx2)%this.PIx2;break;case"l":case"r":b=(this.hBeta-this.PId2+this.PIx2)%this.PIx2;break;case"t":case"b":b=(this.hBeta+this.PIx2)%this.PIx2}this.deltaPoint.x=this.scaleControl.x-this.scaleAnchor.x,this.deltaPoint.y=this.scaleControl.y-this.scaleAnchor.y;var B=0,F=0;switch(t){case"corner":b%Math.PI==0?(S=1/0,this.newItemRadius=Math.max(p,Math.abs(this.deltaPoint.y)/2)):b%Math.PI===this.PId2?(S=0,this.newItemRadius=Math.max(p,Math.abs(this.deltaPoint.x)/2)):(S=Math.tan(b),this.newItemRadius=Math.max(p,this.getPointToLineDistance(this.deltaPoint,S)/2));break;case"side":if(b%Math.PI==0)S=1/0,n?(B=Math.max(o,Math.abs(this.deltaPoint.x))/2,this.newItemRadius=B/Math.cos(this.itemCenterBeta)):(F=Math.max(s,Math.abs(this.deltaPoint.y))/2,this.newItemRadius=F/Math.sin(this.itemCenterBeta));else if(b%Math.PI===this.PId2)S=0,n?(B=Math.max(o,Math.abs(this.deltaPoint.x))/2,this.newItemRadius=B/Math.cos(this.itemCenterBeta)):(F=Math.max(s,Math.abs(this.deltaPoint.y))/2,this.newItemRadius=F/Math.sin(this.itemCenterBeta));else{S=Math.tan(b);var E=this.getPointToLineDistance(this.deltaPoint,S);n?(B=Math.max(o,E)/2,this.newItemRadius=B/Math.cos(this.itemCenterBeta)):(F=Math.max(s,E)/2,this.newItemRadius=F/Math.sin(this.itemCenterBeta))}}switch(this.deltaPoint.x=this.currentScaleHandle.noPaddingX-this.scaleControl.x,this.deltaPoint.y=this.currentScaleHandle.noPaddingY-this.scaleControl.y,t){case"corner":C=S===1/0?Math.abs(this.deltaPoint.y)/2>this.newItemRadius:0===S?Math.abs(this.deltaPoint.x)/2>this.newItemRadius:this.getPointToLineDistance(this.deltaPoint,S)/2>this.newItemRadius;break;case"side":C=S===1/0?n?Math.abs(this.deltaPoint.x)/2>B:Math.abs(this.deltaPoint.y)/2>F:0===S?n?Math.abs(this.deltaPoint.x)/2>B:Math.abs(this.deltaPoint.y)/2>F:n?this.getPointToLineDistance(this.deltaPoint,S)/2>B:this.getPointToLineDistance(this.deltaPoint,S)/2>F}if(this.newItemRadius=C?p:Math.max(p,this.newItemRadius),BFN.TransformModel.snappingEnabled&&"corner"===t){var P=this.transformLayer.toLocal(this.scaleAnchor,this.transformTool);this.drawSnapHelpers&&(this.itemGuidesGraphic.beginFill(11184895,.5),this.itemGuidesGraphic.drawCircle(P.x,P.y,6),this.itemGuidesGraphic.endFill());for(var k=null,N=g.length;--N>-1;){var M=g[N],D=Math.sqrt(Math.pow(M.x-P.x,2)+Math.pow(M.y-P.y,2))/2,w=Math.sqrt(Math.pow(M.x-this.itemCenterX,2)+Math.pow(M.y-this.itemCenterY,2)),L=this.anchorCenter?w:D;Math.abs(this.newItemRadius-L)<this.screenPixelSnapThreshold/this._scale&&(k=M,this.newItemRadius=L)}if(k){this.drawSnapHelpers&&(this.itemGuidesGraphic.beginFill(16776960),this.itemGuidesGraphic.drawCircle(k.x,k.y,6),this.itemGuidesGraphic.endFill());for(var O={},R=0;R<this.item.snapCoordinates.length;R++){var A=this.item.snapCoordinates[R];switch(A.position){case"horizontal":Math.abs(k.x-A.value)<1&&(O.hasOwnProperty("center")||(O.center={maskedSegment:null,values:[],axis:"y"}),O.center.values.includes(A.bounds.top)||O.center.values.push(A.bounds.top),O.center.values.includes(A.bounds.bottom)||O.center.values.push(A.bounds.bottom));break;case"vertical":Math.abs(k.y-A.value)<1&&(O.hasOwnProperty("middle")||(O.middle={maskedSegment:null,values:[],axis:"x"}),O.middle.values.includes(A.bounds.left)||O.middle.values.push(A.bounds.left),O.middle.values.includes(A.bounds.right)||O.middle.values.push(A.bounds.right))}}var V=BFN.Util.getTransformItemBounds(this.item,!0);for(var U in V.x={a:V.minX,b:V.maxX},V.y={a:V.minY,b:V.maxY},O){var G=O[U];G.maskedSegment={startPoint:new PIXI.Point,endPoint:new PIXI.Point},G.maskedSegment.startPoint[G.axis]=V[G.axis].a,G.maskedSegment.endPoint[G.axis]=V[G.axis].b,G.values.sort(function(e,t){return e-t});for(var H=0;H<G.values.length;H++)G.maskedSegment.startPoint[G.axis]=Math.min(G.maskedSegment.startPoint[G.axis],G.values[H]),G.maskedSegment.endPoint[G.axis]=Math.max(G.maskedSegment.endPoint[G.axis],G.values[H]);G.maskedSegment.startPoint=this.transformLayer.toGlobal(G.maskedSegment.startPoint),G.maskedSegment.endPoint=this.transformLayer.toGlobal(G.maskedSegment.endPoint),this.showSnapGuideLine(U,[G.maskedSegment])}this.transformSnapGuides.setCenter(k.x,k.y),this.transformSnapGuides.setDimensions(3,3)}}if(this.newItemWidth=Math.cos(this.itemCenterBeta)*this.newItemRadius*2,this.newItemHeight=Math.sin(this.itemCenterBeta)*this.newItemRadius*2,B=this.newItemWidth/2,F=this.newItemHeight/2,!this.anchorCenter){var z=new PIXI.Point(this.scaleAnchor.x,this.scaleAnchor.y),j=null;switch(this.currentScaleHandle.id){case"tl":case"br":j=this.hBeta+this.itemCenterBeta;break;case"tr":case"bl":j=this.hBeta-this.itemCenterBeta;break;case"l":case"r":j=this.hBeta;break;case"t":case"b":j=this.hBeta+this.PId2}var X=Math.cos(j)*("corner"===t?this.newItemRadius:n?B:F),W=Math.sin(j)*("corner"===t?this.newItemRadius:n?B:F);switch(this.currentScaleHandle.id){case"tl":case"bl":case"l":case"t":z.x-=X,z.y-=W;break;case"tr":case"br":case"r":case"b":z.x+=X,z.y+=W}this.transformGizmo.x=z.x,this.transformGizmo.y=z.y,z=this.toLocal(z,this.transformTool),this.itemCenterX=z.x,this.itemCenterY=z.y}if(this.item.scale.x=this.newItemWidth/this.itemBaseWidth,this.item.scale.y=this.item.scale.x/this.itemAspectRatio,this.itemWidth=this.itemBaseWidth*this.item.scale.x,this.itemHeight=this.itemBaseHeight*this.item.scale.y,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.item.updateFrameTextureDisplay(),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.newItemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.newItemRadius,this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.anchorCenter){var Y=this.getInverseScaleHandle(this.currentScaleHandle);this.scaleAnchor.x=Y.noPaddingX,this.scaleAnchor.y=Y.noPaddingY}if("text"==this.item.type&&this.item==BFN.TransformModel.selectedTransformItem){var q=this.item.iText;for(var K in q.styles){var Q=q.styles[K];for(var Z in Q){var J=Q[Z];J.hasOwnProperty("strokePercent")&&J.hasOwnProperty("fontSize")&&(J.strokeWidth=Math.max(1/(this.item.textScale*this.item.scale.x),J.fontSize*J.strokePercent))}}BFN.FabricManager.updateTextMenu(this.item.getTextStyleData())}else"group"==this.item.type&&"text"===this.item.groupType&&this.item==BFN.TransformModel.selectedTransformItem&&BFN.FabricManager.updateTextMenu(this.item.getTextGroupStyleData());"group"==this.item.type&&this.item.updateGroupTransform()},qx.prototype.constrainedRotate=function(){if(this.rotationHandleDraggerBeta=(Math.atan2(this.rotationHandleDragger.draggedY,this.rotationHandleDragger.draggedX)+this.PIx2)%this.PIx2,this.rotationHandle.x=Math.cos(Math.atan2(this.rotationHandleDragger.draggedY,this.rotationHandleDragger.draggedX))*this.rotationRadius,this.rotationHandle.y=Math.sin(Math.atan2(this.rotationHandleDragger.draggedY,this.rotationHandleDragger.draggedX))*this.rotationRadius,this.rotationHandleDragger.shiftKey||this.rotationHandleDragger.dragVelocity<3){var e=Math.round(this.rotationHandleDraggerBeta/this.snapSectionBeta),t=Math.sqrt(Math.pow(this.rotationHandleDragger.draggedX,2)+Math.pow(this.rotationHandleDragger.draggedY,2)),n=Math.min(Math.PI/180,this.snapDistance*(1/this._scale)/t);(Math.abs(this.rotationHandleDraggerBeta-e*this.snapSectionBeta)<n||this.rotationHandleDragger.shiftKey)&&(this.rotationHandle.x=Math.cos(e*this.snapSectionBeta)*this.rotationRadius,this.rotationHandle.y=Math.sin(e*this.snapSectionBeta)*this.rotationRadius)}this.item.rotation=this.transformGizmo.rotation=Math.atan2(this.rotationHandle.y,this.rotationHandle.x)+this.PId2,BFN.CursorScreen.cursorRotation=this.item.rotation,this.hBeta=this.item.rotation,this.vBeta=this.hBeta-this.PId2,this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.updateTextHandlePosition(),this.updateScaleHandlePosition(),"group"==this.item.type&&this.item.updateGroupTransform()},qx.prototype.setItemScale=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.item&&"text"==this.item.type&&(this.item.scale.x=this.item.scale.y=Math.max(.01,e)/this.item.textScale,this.itemWidth=this.item.scale.x*this.itemBaseWidth,this.itemHeight=this.item.scale.y*this.itemBaseHeight,this.itemRadius=Math.sqrt(Math.pow(this.itemWidth,2)+Math.pow(this.itemHeight,2))/2,this.itemCenterBeta=Math.atan2(this.itemHeight/2,this.itemWidth/2),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,t&&this.conformItemToBounds(),this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo(),t&&this.updateDisplay())},qx.prototype.conformItemToBounds=function(){if(this.item){var e=BFN.Util.getTransformItemBounds(this.item,!0),t=this.frameWidth/2+(e.width/2+10),n=this.frameHeight/2+(e.height/2+10);this.itemCenterX=Math.max(-t,Math.min(t,this.itemCenterX)),this.itemCenterY=Math.max(-n,Math.min(n,this.itemCenterY)),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,"group"==this.item.type&&this.item.updateGroupTransform()}},qx.prototype.fitItemToCanvas=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.item&&"frame_texture"===this.item.type){this.item.clearDropShadow(),this.item.createTransition(t?"transform_fill_canvas":"transform_fit_to_canvas");var n=this.frameWidth+this.frameWidth%2,i=this.frameHeight+this.frameHeight%2,r=Math.min(n/this.item.itemContentW,i/this.item.itemContentH),a=Math.round(this.item.itemContentW*r),o=Math.round(this.item.itemContentH*r);if(a+=a%2,o+=o%2,this.item.rotation=0,this.item.x=-a/2,this.item.y=-o/2,this.item.scale.x=a/this.item.itemContentW,this.item.scale.y=o/this.item.itemContentH,this.item.updateFrameTextureDisplay(),this.item.resetFrameTextureScale(),t){this.updateTransformValues();var s=this.item.itemContent;a<n?s.startFrameScaling("l",!0):o<i&&s.startFrameScaling("t",!0),this.item.x=-n/2,this.item.y=-i/2,this.item.scale.x=n/this.itemBaseWidth,this.item.scale.y=i/this.itemBaseHeight,this.item.updateFrameTextureDisplay(),s.stopFrameScaling(),this.item.resetFrameTextureScale()}!function t(){if(!e.item.shapeUpdatePending)return e.item.updateContentDimensions(),e.item.registerTransition(),e.updateDisplay(),void BFN.MainUI.requestRender();setTimeout(t,0)}()}},qx.prototype.getPointToLineDistance=function(e,t){if(0==t)return Math.abs(e.y);var n=(e.y+1/t*e.x)/(t- -1/t),i=t*n;return Math.sqrt(Math.pow(n-e.x,2)+Math.pow(i-e.y,2))},qx.prototype.getInverseTextHandle=function(e){return this.textHandles[this.textHandleIDs[(this.textHandleIDs.indexOf(e.id)+1)%this.textHandleIDs.length]]},qx.prototype.getInverseScaleHandle=function(e){return this.scaleHandles[this.scaleHandleIDs[(this.scaleHandleIDs.indexOf(e.id)+4)%this.scaleHandleIDs.length]]},qx.prototype.getInverseFrameAnchorSide=function(){var e=null;this.item&&"frame_texture"==this.item.type&&this.currentScaleHandle&&(e=this.getInverseScaleHandle(this.currentScaleHandle).id,this.item.flippedHorizontal&&(e.includes("l")?e=e.replace("l","r"):e.includes("r")&&(e=e.replace("r","l"))),this.item.flippedVertical&&(e.includes("t")?e=e.replace("t","b"):e.includes("b")&&(e=e.replace("b","t"))));return e},qx.prototype.showSnapGuideLine=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3?arguments[3]:void 0;this.snapGuidesCleared||(this.snapGuidesCleared=!0,this.transformSnapGuides.hideLines()),this.transformSnapGuides.showLine(e,t,n,i)},qx.prototype.toggleItemTransform=function(e){this.item&&this.item.parent&&("group"===this.item.type?this.item.toggleTransform(e):(e?(this.itemZIndex=this.item.parent.getChildIndex(this.item),this.itemBlendMode=this.item.itemBlendMode,this.item.parent.setChildIndex(this.item,this.item.parent.children.length-1),this.item.itemContent.blendMode=BFN.CONST.BLEND_MODES.NORMAL):(this.item.parent.setChildIndex(this.item,this.itemZIndex),this.item.itemContent.blendMode=this.itemBlendMode,this.itemZIndex=0,this.itemBlendMode=BFN.CONST.BLEND_MODES.NORMAL),this.item.itemContentBorder&&this.item.itemContentBorder.isFrameBorder&&(this.item.itemContentBorder.blendMode=this.item.itemContent.blendMode)))},qx.prototype.handleTextHandleOver=function(e){var t=this;setTimeout(function(){t.item&&(BFN.CursorScreen.cursor="arrow",BFN.CursorScreen.cursorRotation=t.item.rotation)},0)},qx.prototype.handleTextHandleOut=function(e){this.textHandleDragger.dragging||(BFN.CursorScreen.cursor=null)},qx.prototype.handleTextHandlePress=function(e){if(this.item){BFN.CursorScreen.cursorLock=!0,this.item.transforming=!0,this.currentTextHandle=this.textHandles[e.target.id],this.currentTextHandle.selected=!0,this.disableHandles(this.currentTextHandle),this.item.transformLayer.disableChildren(),this.textControl.x=this.currentTextHandle.transform.worldTransform.tx,this.textControl.y=this.currentTextHandle.transform.worldTransform.ty,this.textControl.beta=this.currentTextHandle.betaPadding-this.hBeta;var t=this.getInverseTextHandle(this.currentTextHandle);this.textAnchor.x=t.transform.worldTransform.tx,this.textAnchor.y=t.transform.worldTransform.ty,this.textAnchor.beta=t.betaPadding-this.hBeta,this.textHandleDragger.scale=this._scale,this.textHandleDragger.drag(this.currentTextHandle),e.stopPropagation()}},qx.prototype.handleScaleHandleOver=function(e){var t=this,n=e.target;setTimeout(function(){if(t.item&&n){switch(BFN.CursorScreen.cursor="arrow",t.hoveredScaleHandle=n,t.hoveredScaleHandle.id){case"tl":case"br":BFN.CursorScreen.cursorRotation=t.hBeta+t.itemCenterBeta;break;case"tr":case"bl":BFN.CursorScreen.cursorRotation=t.hBeta-t.itemCenterBeta;break;case"l":case"r":BFN.CursorScreen.cursorRotation=t.hBeta;break;case"t":case"b":BFN.CursorScreen.cursorRotation=t.vBeta}!t.hoveredScaleHandle||["text","group"].includes(t.item.type)||t.sideHandleIDs.includes(t.hoveredScaleHandle.id)||t.scaleHandleDragger.dragging||(BFN.MainUI.tooltip="scaling_tooltip")}},0)},qx.prototype.handleScaleHandleOut=function(e){this.scaleHandleDragger.dragging||(BFN.CursorScreen.cursor=null,BFN.MainUI.tooltip=null)},qx.prototype.handleScaleHandlePress=function(e){if(this.item){BFN.CursorScreen.cursorLock=!0,BFN.MainUI.tooltip=null,this.item.transforming=!0,this.currentScaleHandle=this.scaleHandles[e.target.id],this.currentScaleHandle.selected=!0,this.transformSnapGuides.hideLines(),this.snapGuidesCleared=!0,this.disableHandles(this.currentScaleHandle),this.item.transformLayer.disableChildren();var t=this.getInverseScaleHandle(this.currentScaleHandle);if(this.scaleAnchor.x=t.noPaddingX,this.scaleAnchor.y=t.noPaddingY,this.scaleHandleDragger.scale=this._scale,this.scaleHandleDragger.drag(this.currentScaleHandle),e.stopPropagation(),!["text","group"].includes(this.item.type)){var n=Math.round(this.item.itemContentW*this.item.scale.x),i=Math.round(this.item.itemContentH*this.item.scale.y);BFN.TooltipScreen.show(n+" x "+i,!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY,!1,!0)}}},qx.prototype.handleRotationHandleOver=function(e){var t=this;setTimeout(function(){t.item&&(BFN.CursorScreen.cursor="rotate",BFN.CursorScreen.cursorRotation=t.item.rotation)},0)},qx.prototype.handleRotationHandleOut=function(e){this.rotationHandleDragger.dragging||(BFN.CursorScreen.cursor=null)},qx.prototype.handleRotationHandlePress=function(e){if(this.rotationRadius=Math.sqrt(Math.pow(this.rotationHandle.x,2)+Math.pow(this.rotationHandle.y,2)),this.item){BFN.CursorScreen.cursorLock=!0,this.item.transforming=!0,this.rotationHandle.selected=!0,this.disableHandles(this.rotationHandle),this.item.transformLayer.disableChildren(),this.rotationHandleDragger.scale=this._scale,this.rotationHandleDragger.drag(this.rotationHandle),e.stopPropagation();var t=(Math.round((this.item.rotation+2*Math.PI)%(2*Math.PI)*(180/Math.PI)*2)/2).toFixed(1);BFN.TooltipScreen.show(t+"°",!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY,!1,!0)}},qx.prototype.handleRotationHandleSelectAnimatorUpdate=function(e){},qx.prototype.handleTransformGizmoDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.item){BFN.TransformToolSnapGaps.show(),this.prepareItemForDragging(),this.item.accurateBoundsRequested&&this.item.addEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind);var t=this.item.isGoodie?"history_move_graphic":"history_move_image";switch(this.item.type){case"text":t="history_move_text";break;case"group":t="history_move_selection"}this.item.createTransition(t)}this.handleTransformGizmoDragging(e)},qx.prototype.prepareItemForDragging=function(){if(this.item){this.item.dispatchEvent(BFN.TransformItemEvents.GET_SNAP_COORDINATES);var e=BFN.Util.getTransformItemBounds(this.item);this.itemCenterOffsetX=this.transformTool.x-(e.minX+this.item.accurateBounds.minX+this.item.accurateBounds.width/2),this.itemCenterOffsetY=this.transformTool.y-(e.minY+this.item.accurateBounds.minY+this.item.accurateBounds.height/2);var t=this.frameWidth/2+(e.width/2+10),n=this.frameHeight/2+(e.height/2+10);this.gizmoDragger.setBounds(-t,-n,t,n)}},qx.prototype.handleItemAccurateBoundsUpdated=function(e){e.dispatcher.removeEventListener(BFN.TransformItemEvents.ACCURATE_BOUNDS_UPDATED.type,this.handleItemAccurateBoundsUpdatedBind),this.item&&this.item.transforming&&this.gizmoDragger.dragging&&this.prepareItemForDragging()},qx.prototype.handleTransformGizmoDragging=function(e){var t=this;this.snapDistanceTransform=this.screenPixelSnapThreshold*(1/this._scale),this.snapDistanceTransformSnapped=1/this._scale,this.snapGuidesCleared=!1,this.item&&(this.gizmoDragger.wasDragged&&!this.item.itemMoved&&(this.item.itemMoved=!0,this.toggleItemTransform(!0)),this.itemCenterX=this.transformTool.x,this.itemCenterY=this.transformTool.y,BFN.TransformModel.snappingEnabled&&this.gizmoDragger.wasDragged&&this.item.accurateBounds&&function(){for(var e=!1,n=!1,i={},r=0;r<t.item.snapCoordinates.length;r++){var a=t.item.snapCoordinates[r],o={},s=null;switch(a.position){case"horizontal":var l;if(o.left=t.itemCenterX-t.item.accurateBounds.width/2-a.value-t.itemCenterOffsetX,o.center=t.itemCenterX-a.value-t.itemCenterOffsetX,o.right=t.itemCenterX+t.item.accurateBounds.width/2-a.value-t.itemCenterOffsetX,Math.abs(o.left)<(e?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterX=e?t.itemCenterX:a.value+t.item.accurateBounds.width/2+t.itemCenterOffsetX,s="left",e=!0):Math.abs(o.center)<(e?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterX=e?t.itemCenterX:a.value+t.itemCenterOffsetX,s="center",e=!0):Math.abs(o.right)<(e?t.snapDistanceTransformSnapped:t.snapDistanceTransform)&&(t.itemCenterX=e?t.itemCenterX:a.value-t.item.accurateBounds.width/2+t.itemCenterOffsetX,s="right",e=!0),s)i.hasOwnProperty(s)||(i[s]={maskedSegment:null,rulerSegmentA:null,rulerSegmentB:null,values:[],axis:"y"}),(l=i[s].values).push.apply(l,[a.bounds.top,a.bounds.bottom]);break;case"vertical":var u;if(o.top=t.itemCenterY-t.item.accurateBounds.height/2-a.value-t.itemCenterOffsetY,o.middle=t.itemCenterY-a.value-t.itemCenterOffsetY,o.bottom=t.itemCenterY+t.item.accurateBounds.height/2-a.value-t.itemCenterOffsetY,Math.abs(o.top)<(n?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterY=n?t.itemCenterY:a.value+t.item.accurateBounds.height/2+t.itemCenterOffsetY,s="top",n=!0):Math.abs(o.middle)<(n?t.snapDistanceTransformSnapped:t.snapDistanceTransform)?(t.itemCenterY=n?t.itemCenterY:a.value+t.itemCenterOffsetY,s="middle",n=!0):Math.abs(o.bottom)<(n?t.snapDistanceTransformSnapped:t.snapDistanceTransform)&&(t.itemCenterY=n?t.itemCenterY:a.value-t.item.accurateBounds.height/2+t.itemCenterOffsetY,s="bottom",n=!0),s)i.hasOwnProperty(s)||(i[s]={maskedSegment:null,rulerSegmentA:null,rulerSegmentB:null,values:[],axis:"x"}),(u=i[s].values).push.apply(u,[a.bounds.left,a.bounds.right])}}BFN.TransformToolSnapGaps.clearSnapGaps();var c={left:null,top:null,right:null,bottom:null},h=new BFN.Rectangle(t.itemCenterX-t.item.accurateBounds.width/2-t.itemCenterOffsetX,t.itemCenterY-t.item.accurateBounds.height/2-t.itemCenterOffsetY,t.item.accurateBounds.width,t.item.accurateBounds.height),d=function(){var e={left:null,top:null,right:null,bottom:null};return t.item.otherItemAccurateBoundsList.forEach(function(t){var n=h.neighbors(t);n&&(!e[n.side]||e[n.side].distance>n.distance)&&(e[n.side]=n)}),e},m=d(),p={horizontal:null,vertical:null},g=t.item.snapGapRects,f=function(e){var n=m[e];n&&function(){var i=n.direction,r=function(r){g[i][r].forEach(function(a){var o=n.intersectRect.neighbors(a);if(o&&o.direction===i&&!h.intersects(o.gapRect)){var s=r-n.distance;Math.abs(s)<t.snapDistanceTransform&&(["right","bottom"].includes(e)&&(s*=-1),null===p[i]&&(p[i]=s),Math.abs(s)<Math.abs(p[i])&&(p[i]=s))}})};for(var a in g[i])r(a)}()};for(var v in m)f(v);for(var y in p){var x="horizontal"===y?m.left:m.top,_="horizontal"===y?m.right:m.bottom;if(x&&_){var I=(x.distance+_.distance)/2-x.distance;Math.abs(I)<t.snapDistanceTransform&&(null===p[y]||null!==p[y]&&Math.abs(I)<Math.abs(p[y]))&&(p[y]=I,"horizontal"===y?c.left=c.right=!0:"vertical"===y&&(c.top=c.bottom=!0))}}for(var T in p)if(p[T])switch(T){case"horizontal":t.itemCenterX+=p[T];break;case"vertical":t.itemCenterY+=p[T]}h.x=t.itemCenterX-t.item.accurateBounds.width/2-t.itemCenterOffsetX,h.y=t.itemCenterY-t.item.accurateBounds.height/2-t.itemCenterOffsetY,m=d();var b={horizontal:[],vertical:[]},S=function(e){var t=m[e];t&&function(){var n=t.direction;for(var i in g[n]){if(parseFloat(i).toFixed(1).toString()===(Math.round(10*t.distance)/10).toFixed(1).toString())g[n][i].forEach(function(i){var r=t.gapRect.neighbors(i);r&&r.direction===n&&null!==p[n]&&(b[n].includes(i)||b[n].push(i),c[e]=!0)})}}()};for(var C in m)S(C);for(var B in m){var F=m[B];F&&c[B]&&b[F.direction].push(F.gapRect)}var E=function(e){b[e].forEach(function(n){var i=BFN.TransformToolSnapGaps.toLocal(new PIXI.Point(n.left,n.top),t),r=BFN.TransformToolSnapGaps.toLocal(new PIXI.Point(n.right,n.bottom),t),a=new BFN.Rectangle(i.x,i.y,r.x-i.x,r.y-i.y),o="";switch(e){case"horizontal":o+=(Math.round(10*n.width)/10).toFixed(1);break;case"vertical":o+=(Math.round(10*n.height)/10).toFixed(1)}BFN.TransformToolSnapGaps.drawSnapGap(a,e,o)})};for(var P in b)E(P);var k={x:{a:t.itemCenterX-t.item.accurateBounds.width/2-t.itemCenterOffsetX,b:t.itemCenterX+t.item.accurateBounds.width/2-t.itemCenterOffsetX,c:t.itemCenterX-t.itemCenterOffsetX},y:{a:t.itemCenterY-t.item.accurateBounds.height/2-t.itemCenterOffsetY,b:t.itemCenterY+t.item.accurateBounds.height/2-t.itemCenterOffsetY,c:t.itemCenterY-t.itemCenterOffsetY}},N={x:{a:[],b:[]},y:{a:[],b:[]}},M=["left","center","right","top","middle","bottom"],D=["a","c","b"],w=["x","y"];M.forEach(function(e){if(i.hasOwnProperty(e)){var n=i[e],r=w[(w.indexOf(n.axis)+1)%2];n.maskedSegment={startPoint:new PIXI.Point,endPoint:new PIXI.Point},n.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point},n.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point},n.maskedSegment.startPoint[n.axis]=k[n.axis].a,n.maskedSegment.startPoint[r]=k[r][D[M.indexOf(e)%D.length]],n.maskedSegment.endPoint[n.axis]=k[n.axis].b,n.maskedSegment.endPoint[r]=k[r][D[M.indexOf(e)%D.length]],n.rulerSegmentA.startPoint[n.axis]=n.rulerSegmentA.endPoint[n.axis]=k[n.axis].a,n.rulerSegmentB.startPoint[n.axis]=n.rulerSegmentB.endPoint[n.axis]=k[n.axis].b,n.values.sort(function(e,t){return e-t});for(var a=0;a<n.values.length;a++){var o=n.values[a],s=n.values[n.values.length-1-a];n.maskedSegment.startPoint[n.axis]=Math.min(n.maskedSegment.startPoint[n.axis],o,k[n.axis].a),n.maskedSegment.endPoint[n.axis]=Math.max(n.maskedSegment.startPoint[n.axis],o,k[n.axis].b),o<n.rulerSegmentA.endPoint[n.axis]-1&&(n.rulerSegmentA.startPoint[n.axis]=o),s>n.rulerSegmentB.startPoint[n.axis]+1&&(n.rulerSegmentB.endPoint[n.axis]=s)}n.maskedSegment.startPoint=t.toGlobal(n.maskedSegment.startPoint),n.maskedSegment.endPoint=t.toGlobal(n.maskedSegment.endPoint),n.rulerSegmentA.startPoint=t.toGlobal(n.rulerSegmentA.startPoint),n.rulerSegmentA.endPoint=t.toGlobal(n.rulerSegmentA.endPoint),n.rulerSegmentB.startPoint=t.toGlobal(n.rulerSegmentB.startPoint),n.rulerSegmentB.endPoint=t.toGlobal(n.rulerSegmentB.endPoint);var l=Math.round(n.rulerSegmentA.endPoint[n.axis]-n.rulerSegmentA.startPoint[n.axis]),u=Math.round(n.rulerSegmentB.endPoint[n.axis]-n.rulerSegmentB.startPoint[n.axis]);switch(N[n.axis].a.includes(l)?n.rulerSegmentA=null:N[n.axis].a.push(l),N[n.axis].b.includes(u)?n.rulerSegmentB=null:N[n.axis].b.push(u),e){case"top":case"middle":case"bottom":c.left&&(n.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point}),c.right&&(n.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point});break;case"left":case"center":case"right":c.top&&(n.rulerSegmentA={startPoint:new PIXI.Point,endPoint:new PIXI.Point}),c.bottom&&(n.rulerSegmentB={startPoint:new PIXI.Point,endPoint:new PIXI.Point})}var d=t.transformLayer.toGlobal(new PIXI.Point(h.x,h.y)),m=t.transformLayer.toGlobal(new PIXI.Point(h.x+h.width,h.y+h.height)),p=new BFN.Rectangle(d.x,d.y,m.x-d.x,m.y-d.y),g=[];BFN.TransformToolSnapGaps.usedSnapGapLabels.forEach(function(e){var t=BFN.TransformToolSnapGaps.labelContainer.toGlobal(new PIXI.Point(e.x,e.y)),i=new BFN.Rectangle(t.x-e.width/2,t.y-e.height/2,e.width,e.height);i.intersectsLine(n.maskedSegment.startPoint,n.maskedSegment.endPoint)&&g.push(i)});var f=[n.maskedSegment];if(g.length){g.sort(function(e,t){return e[n.axis]-t[n.axis]});var v,y,x=n.maskedSegment,_=x.startPoint[n.axis],I=x.endPoint[n.axis],T=x.endPoint[r],b=["right","bottom"],S=["left","top"],C=function(){if(y>v){var e=new PIXI.Point;e[n.axis]=v,e[r]=T;var t=new PIXI.Point;t[n.axis]=y,t[r]=T,f.push({startPoint:e,endPoint:t})}};f.splice(0);for(var B=0;B<g.length;B++){var F=g[B];B||(v=_),y=F[S[w.indexOf(n.axis)]]-1,C(),v=F[b[w.indexOf(n.axis)]]+1,B===g.length-1&&(y=I,C())}}t.showSnapGuideLine(e,f,BFN.TransformModel.showMeasurements?[n.rulerSegmentA,n.rulerSegmentB]:null,p)}})}(),this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.snapGuidesCleared||this.transformSnapGuides.hideLines(),this.transformSnapGuides.setCenter(this.itemCenterX-this.itemCenterOffsetX,this.itemCenterY-this.itemCenterOffsetY),this.transformSnapGuides.setDimensions(this.item.accurateBounds.width,this.item.accurateBounds.height),this.transformSnapGuides.showRulerLabels(),this.item.x=this.itemCenterX-Math.cos(this.hBeta+this.itemCenterBeta)*this.itemRadius,this.item.y=this.itemCenterY-Math.sin(this.hBeta+this.itemCenterBeta)*this.itemRadius,"group"==this.item.type&&this.item.updateGroupTransform()),this.item&&this.gizmoDragger.wasDragged&&this.item.updateHiResTextBounds()},qx.prototype.handleTransformGizmoDraggingComplete=function(e){this.item,BFN.smoothPictureDisabled=!1;var t=null;this.item&&(this.item.transforming=!1,this.item.itemMoved&&(this.item.itemMoved=!1,"group"===this.item.type&&this.item.subSelectedItem&&(this.item.subSelectedItem=null),this.conformItemToBounds(),this.updateDisplay(),this.toggleItemTransform(!1),this.item.registerTransition(!1,!1)),this.item.subSelectedItem&&(t=this.item.subSelectedItem,this.item.subSelectedItem=null),t||(this.fadeAnimator.increase(),"group"==this.item.type&&this.item.fadeAnimator.increase()),BFN.TransformToolSnapGaps.clearSnapGaps(),BFN.TransformToolSnapGaps.hide(),this.item.updateHiResText()),BFN.TransformStateModel.stopBulkTransition(),t&&(t.selectedByMouse=!1,t.transformLayer.deselectItem(),t.transformLayer.lastPressedItem=t,t.transformLayer.clickItem(t,!0),t.transformLayer.selectItem(t))},qx.prototype.handleTextHandleDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.item&&"text"==this.item.type){this.item.buttonMode=!1,this.item.clearDropShadow(),this.item.createTransition("history_resize_text"),BFN.FabricManager.showTransformItemIText(this.item);var t=this.item.iText;this.iTextData={topLeft:{x:t.left,y:t.top},topRight:{x:t.left+Math.cos(this.hBeta)*(t.width*t.scaleX),y:t.top+Math.sin(this.hBeta)*(t.width*t.scaleX)}};var n=this.item;this.itemData={topLeft:{x:n.x,y:n.y},topRight:{x:n.x+Math.cos(this.hBeta)*this.itemWidth,y:n.y+Math.sin(this.hBeta)*this.itemWidth}},this.handleTextHandleDragging(e)}},qx.prototype.handleTextHandleDragging=function(e){this.item&&"text"==this.item.type&&(this.resizeText(),this.item.toggleHiResText(!1))},qx.prototype.handleTextHandleDraggingComplete=function(e){this.item||BeFunky.throwError("Item was deselected before handleTextHandleDraggingComplete"),BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.item&&(this.item.buttonMode=!0,this.item.transforming=!1,this.textHandleDragger.wasDragged?(this.item.setTextWidth(this.itemWidth),this.conformItemToBounds(),this.updateDisplayForTextResize(),this.item.registerTransition(),BFN.FabricManager.hideTransformItemIText(this.item)):(BFN.FabricManager.hideTransformItemIText(this.item),this.item.updateDropShadowSource()),(!this.currentTextHandle||this.currentTextHandle&&!this.currentTextHandle.hovered)&&(BFN.CursorScreen.cursor=null)),this.currentTextHandle&&(this.currentTextHandle.selected=!1,this.currentTextHandle=null),this.enableHandles(),this.item.transformLayer.enableChildren(),this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateDisplay(),this.item&&this.item.updateHiResTextBounds()},qx.prototype.handleScaleHandleDraggingStarted=function(e){var t=this;if(this.transformSnapGuidesContainer.alpha=1,this.transformSnapGuidesContainer.visible=!0,BFN.smoothPictureDisabled=!0,this.item){if(BFN.TransformModel.snappingEnabled)if(this.item.dispatchEvent(BFN.TransformItemEvents.GET_SNAP_COORDINATES),this.drawSnapHelpers)BFN.PhotoEditorCanvas.transformLayerVeil.opacity=0,this.snapLinesGraphic||(this.snapLinesGraphic=new PIXI.Graphics,BFN.PhotoEditorCanvas.canvas.addChild(this.snapLinesGraphic)),this.snapLinesGraphic.x=this.transformLayer.x,this.snapLinesGraphic.y=this.transformLayer.y,this.snapLinesGraphic.clear(),this.snapLinesGraphic.lineStyle(1,16711680),this.item.snapCoordinates.forEach(function(e){switch(e.position){case"horizontal":t.snapLinesGraphic.moveTo(e.value,-2e3),t.snapLinesGraphic.lineTo(e.value,2e3);break;case"vertical":t.snapLinesGraphic.moveTo(-2e3,e.value),t.snapLinesGraphic.lineTo(2e3,e.value)}}),this.itemGuidesGraphic||(this.itemGuidesGraphic=new PIXI.Graphics,BFN.PhotoEditorCanvas.canvas.addChild(this.itemGuidesGraphic)),this.itemGuidesGraphic.x=this.transformLayer.x,this.itemGuidesGraphic.y=this.transformLayer.y,this.itemGuidesGraphic.clear();this.item.buttonMode=!1;var n=this.item.isGoodie?"history_scale_graphic":"history_scale_image";switch(this.item.type){case"text":n="history_font_size";break;case"group":n="history_scale_selection"}this.item.clearDropShadow(),this.item.createTransition(n),this.toggleItemTransform(!0),this.transformToolVO=UITools.getToolVO("transform")}},qx.prototype.handleScaleHandleDragging=function(e){if(this.snapDistanceTransform=this.screenPixelSnapThreshold*(1/this._scale),this.snapDistanceTransformSnapped=1/this._scale,this.snapGuidesCleared=!1,this.item&&this.currentScaleHandle){var t=this.sideHandleIDs.includes(this.currentScaleHandle.id),n=this.scaleHandleDragger.ctrlKey,i=this.scaleHandleDragger.shiftKey,r=this.scaleHandleDragger.altKey;if("frame_texture"==this.item.type){var a=this.item.itemContent.frameSprite.frameScaling,o=this.item.itemContent.frameSprite.frameStretching,s=this.item.itemContent.frameSprite.frameScalingCentered,l=this.item.itemContent.frameSprite;n||t?(o&&(l.stopFrameStretching(),l.updateDisplay()),a&&r==s||l.startFrameScaling(this.getInverseFrameAnchorSide(),r)):(a&&l.stopFrameScaling(),i?o||l.startFrameStretching():o&&(l.stopFrameStretching(),l.updateDisplay()))}var u=!(["text","group"].includes(this.item.type)&&!this.item.isStretchable);(i||t)&&u?this.freeformScale():this.constrainedScale(),this.item.updateSmoothingScale();var c=function(e){e.basicShapeVO?e.updateShapeTexture(!1):e.borderBasicShapeVO&&e.updateBorderTexture(!1)};this.item===BFN.TransformItemGroup?this.item.selectedItems.forEach(function(e){c(e)}):c(this.item),this.snapGuidesCleared||this.transformSnapGuides.hideLines()}if(this.drawGizmo(),this.item&&BFN.TooltipScreen.active){var h=Math.round(this.item.itemContentW*this.item.scale.x),d=Math.round(this.item.itemContentH*this.item.scale.y);BFN.TooltipScreen.setMessage(h+" x "+d)}this.item&&this.item.updateHiResTextBounds()},qx.prototype.handleScaleHandleDraggingComplete=function(e){(this.transformSnapGuidesContainer.alpha=0,this.transformSnapGuidesContainer.visible=!1,this.item||BeFunky.throwError("Item was deselected before handleScaleHandleDraggingComplete"),BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.item&&"frame_texture"===this.item.type&&(this.item.itemContent.frameSprite.stopFrameScaling(),this.item.itemContent.frameSprite.stopFrameStretching()),this.conformItemToBounds(),this.toggleItemTransform(!1),this.item&&(this.item.buttonMode=!0,this.item.transforming=!1,this.scaleHandleDragger.wasDragged?(this.item.resetFrameTextureScale(),this.item.updateShapeTexture(),"group"==this.item.type?this.item.updateHitAreaOrTextWidths():"text"==this.item.type?this.item.setTextWidth(this.itemWidth,!0):this.item.updateHitArea(),this.item.ignoreTextHeight=!0,this.item.registerTransition(!1,"text"!=this.item.type),delete this.item.ignoreTextHeight):"group"===this.item.type?BFN.TransformStateModel.stopBulkTransition():this.item.updateDropShadowSource(),this.item.updateSmoothingScale(),this.currentScaleHandle&&!this.currentScaleHandle.hovered&&(BFN.CursorScreen.cursor=null)),this.currentScaleHandle&&(this.currentScaleHandle.selected=!1),this.currentScaleHandle=null,this.enableHandles(),this.item)?this.item.transformLayer.enableChildren():BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas.transformLayer,BFN.CollageMakerCanvas.transformLayer,BFN.DesignerCanvas.transformLayer).enableChildren();this.transformGizmo.x=this.transformGizmo.y=0,this.transformTool.x=this.itemCenterX,this.transformTool.y=this.itemCenterY,this.updateDisplay(),BFN.TooltipScreen.active&&BFN.TooltipScreen.hide()},qx.prototype.handleRotationHandleDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.item){this.item.buttonMode=!1;var t=this.item.isGoodie?"history_rotate_graphic":"history_rotate_image";switch(this.item.type){case"text":t="history_rotate_text";break;case"group":t="history_rotate_selection"}this.item.createTransition(t),this.toggleItemTransform(!0)}},qx.prototype.handleRotationHandleDragging=function(e){this.item&&this.constrainedRotate(),this.drawGizmo();var t=(Math.round((this.item.rotation+2*Math.PI)%(2*Math.PI)*(180/Math.PI)*2)/2).toFixed(1);BFN.TooltipScreen.setMessage(t+"°"),this.item&&this.item.updateHiResTextBounds()},qx.prototype.handleRotationHandleDraggingComplete=function(e){this.item||BeFunky.throwError("Item was deselected before handleRotationHandleDraggingComplete"),BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.conformItemToBounds(),this.toggleItemTransform(!1),this.item&&(this.item.buttonMode=!0,this.item.transforming=!1,this.rotationHandleDragger.wasDragged?this.item.registerTransition(!1,!0):"group"===this.item.type&&BFN.TransformStateModel.stopBulkTransition(),this.item.updateSmoothingScale(),this.rotationHandle.hovered||(BFN.CursorScreen.cursor=null)),this.rotationHandle.selected=!1,this.enableHandles(),this.item.transformLayer.enableChildren(),this.updateDisplay(),BFN.TooltipScreen.hide()},qx.prototype.handleFadeAnimatorUpdate=function(e){this.transformTool.alpha=this.fadeAnimator.animationFactor,this.transformTool.visible=this.transformTool.alpha>0,this.transformSnapGuidesContainer.alpha=1-this.fadeAnimator.animationFactor,this.transformSnapGuidesContainer.visible=this.transformSnapGuidesContainer.alpha>0},qx.prototype.handleFadeAnimatorUpdateComplete=function(e){this.transformSnapGuides.hideLines()},Object.defineProperty(qx.prototype,"scale",{set:function(e){this._scale=e;try{this.transformGizmoOutline.scale=this.transformGizmoHandle.scale=this._scale,this.transformSnapGuides.scale=this._scale,this.transformToolFrame.scale=this._scale,this.updateHandleScales(),this.updateTextHandlePosition(),this.updateScaleHandlePosition(),this.updateRotationHandlePosition(),this.drawGizmo()}catch(e){}},get:function(){return this._scale}}),Object.defineProperty(qx.prototype,"transformSnapGuides",{get:function(){return this._transformSnapGuides||(this._transformSnapGuides=new BFN.TransformToolSnapGuides,this.transformSnapGuidesContainer.addChild(this._transformSnapGuides)),this._transformSnapGuides}}),BFN.TransformTool=qx,Kx.prototype=Object.create(PIXI.Container.prototype),Kx.prototype.init=function(){BeFunky.log("TransformToolFrame Init"),this.initDefaultValues(),this.initScaleHandleTextures(),this.initControlContainer(),this.initImageSprite(),this.initImageSpriteVeil(),this.initTouchSurfaces(),this.initFadeContainer(),this.initSpriteOutlines(),this.initScaleHandles(),this.initDraggers(),this.initFadeAnimator()},Kx.prototype.initDefaultValues=function(){this.active=!1,this.focusedFrameSprite=null,this.transformItem=null,this.currentScaleHandle=null,this.scaleControlBounds=null,this.scaleMode=null,this.scaleHandleIDs=["l","tl","t","tr","r","br","b","bl"],this.cornerHandleIDs=["tl","tr","br","bl"],this.sideHandleIDs=["l","t","r","b"],this.PId2=Math.PI/2,this.imageOutlinePadding=10,this.scaleAnchor=new PIXI.Point,this.scaleControl=new PIXI.Point,this._scale=1},Kx.prototype.initScaleHandleTextures=function(){this.handleTextureCorner=PIXI.RenderTexture.create(20,20,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:268435456,cornerRadius:2,paddingX:1,paddingT:1.5,paddingB:9.5}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:268435456,cornerRadius:2,paddingY:1,paddingL:1.5,paddingR:9.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4287274495,cornerRadius:1,paddingX:2,paddingT:2.5,paddingB:10.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4287274495,cornerRadius:1,paddingY:2,paddingL:2.5,paddingR:10.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4294967295,cornerRadius:1,paddingX:3,paddingT:3.5,paddingB:11.5,clear:!1}),BFN.graphics.drawShape("roundedRect",this.handleTextureCorner,{fillColor:4294967295,cornerRadius:1,paddingY:3,paddingL:3.5,paddingR:11.5,clear:!1}),this.handleTextureSide=PIXI.RenderTexture.create(20,20,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("roundedRect",this.handleTextureSide,{fillColor:268435456,cornerRadius:2,paddingY:5}),BFN.graphics.drawShape("roundedRect",this.handleTextureSide,{strokeWidth:1,strokeColor:4287274495,fillColor:4294967295,cornerRadius:1,paddingX:1,paddingY:6,clear:!1}),this.handleTextureCircle=PIXI.RenderTexture.create(24,24,PIXI.settings.SCALE_MODE,window.bfn_resolution),BFN.graphics.drawShape("ellipse",this.handleTextureCircle,{strokeWidth:1.5,strokeColor:4287274495,fillColor:4294967295,paddingX:4,paddingY:4,clear:!1})},Kx.prototype.initControlContainer=function(){this.controlContainer=new PIXI.Container,this.addChild(this.controlContainer)},Kx.prototype.initImageSprite=function(){this.imageSprite=new PIXI.Sprite,this.imageSprite.pluginName="smooth_picture",this.controlContainer.addChild(this.imageSprite)},Kx.prototype.initImageSpriteVeil=function(){var e=this;this.imageSpriteVeil=new BFN.WindowedVeil(mn().hex,.6),this.controlContainer.addChild(this.imageSpriteVeil),gn(function(t){var n=t.hex;e.imageSpriteVeil.color=n})},Kx.prototype.initTouchSurfaces=function(){this.imageTouchSurface=new PIXI.Graphics,this.imageTouchSurface.interactive=!0,this.imageTouchSurface.beginFill(0,0),this.imageTouchSurface.drawRect(0,0,100,100),this.imageTouchSurface.endFill(),this.imageTouchSurface.on("pointerover",this.handleTouchSurfaceOver.bind(this)),this.imageTouchSurface.on("pointerout",this.handleTouchSurfaceOut.bind(this)),this.imageTouchSurface.on("pointerdown",this.handleTouchSurfacePress.bind(this)),this.controlContainer.addChild(this.imageTouchSurface),this.frameTouchSurface=new PIXI.Graphics,this.frameTouchSurface.interactive=!0,this.frameTouchSurface.beginFill(0,0),this.frameTouchSurface.drawRect(0,0,100,100),this.frameTouchSurface.endFill(),this.frameTouchSurface.on("pointerover",this.handleTouchSurfaceOver.bind(this)),this.frameTouchSurface.on("pointerout",this.handleTouchSurfaceOut.bind(this)),this.frameTouchSurface.on("pointerdown",this.handleTouchSurfacePress.bind(this)),this.controlContainer.addChild(this.frameTouchSurface)},Kx.prototype.initFadeContainer=function(){this.fadeContainer=new PIXI.Container,this.controlContainer.addChild(this.fadeContainer)},Kx.prototype.initSpriteOutlines=function(){this.imageSpriteOutline=new BFN.StrokeRectangle(!0,!0,2,!0,4290824698,4287274495,"transform_tool_image_outline"),this.imageSpriteOutline.setDimensions(200,200),this.fadeContainer.addChild(this.imageSpriteOutline),this.frameSpriteOutline=new BFN.StrokeRectangle(!1,!0,1,!0,4290824698,4287274495,"transform_tool_frame_outline"),this.frameSpriteOutline.setDimensions(100,100),this.fadeContainer.addChild(this.frameSpriteOutline)},Kx.prototype.initScaleHandles=function(){this.scaleHandleContainer=new PIXI.Container,this.fadeContainer.addChild(this.scaleHandleContainer),this.imageScaleHandles={};for(var e=0;e<this.cornerHandleIDs.length;e++)this.imageScaleHandles[this.cornerHandleIDs[e]]=this.createScaleHandle(this.cornerHandleIDs[e],"image");this.frameScaleHandles={};for(var t=0;t<this.scaleHandleIDs.length;t++)this.frameScaleHandles[this.scaleHandleIDs[t]]=this.createScaleHandle(this.scaleHandleIDs[t],"frame")},Kx.prototype.initDraggers=function(){this.touchSurfaceDragger=new BFN.Dragger,this.touchSurfaceDragger.useBounds=!1,this.touchSurfaceDragger.autoDrag=!1,this.touchSurfaceDragger.preventSelectionDrag=!0,this.touchSurfaceDragger.deselectItemGroup=!1,this.touchSurfaceDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleTouchSurfaceDraggingStarted.bind(this)),this.touchSurfaceDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleTouchSurfaceDragging.bind(this)),this.touchSurfaceDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleTouchSurfaceDraggingComplete.bind(this)),this.scaleHandleDragger=new BFN.Dragger,this.scaleHandleDragger.useBounds=!1,this.scaleHandleDragger.autoDrag=!1,this.scaleHandleDragger.preventSelectionDrag=!0,this.scaleHandleDragger.deselectItemGroup=!1,this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleScaleHandleDraggingStarted.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleScaleHandleDragging.bind(this)),this.scaleHandleDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleScaleHandleDraggingComplete.bind(this))},Kx.prototype.initFadeAnimator=function(){this.fadeAnimator=new BFN.Animator,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdate.bind(this)),this.fadeAnimator.setAnimatorFactor(0)},Kx.prototype.setup=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{this.imageSprite.texture.destroy(!1)}catch(e){}if(this.imageSprite.texture=PIXI.Texture.EMPTY,t&&"frame_texture"==t.type){var n=t!==this.transformItem;this.transformItem=t,this.focusedFrameSprite=this.transformItem.itemContent.frameSprite,this.imageSprite.renderable=!0,this.imageSprite.texture=new PIXI.Texture(this.focusedFrameSprite.baseTexture),this.imageSprite.texture.rotate=this.transformItem.flippedHorizontal?this.transformItem.flippedVertical?4:12:this.transformItem.flippedVertical?8:0,this.controlContainer.x=this.transformItem.x,this.controlContainer.y=this.transformItem.y,this.controlContainer.rotation=this.transformItem.rotation,this.updateImageTouchSurfaceDisplay(),this.updateFrameTouchSurfaceDisplay(),this.updateOutlineDisplays(),this.updateScaleHandlePositions(),this.updateImageSpriteDisplay(),this.fadeAnimator.increase(),this.active=!0,this.transformTool.fadeAnimator.decrease(),BFN.TransformModel.selectedTransformItem===this.transformItem&&(BFN.TransformModel.selectedTransformItem=this.transformItem),this.setScaleControlRange(),this.updateScaleControl(),setTimeout(function(){e.transformItem&&(e.transformItem.renderable=!1,BFN.MainUI.renderCanvas(),n&&BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(e.transformItem),"enter_crop_layer","app_action"))},50);var i=null;if(this.transformItem.itemContentMask&&!this.transformItem.isShape){var r=this.transformItem.itemContentMask.texture,a=new PIXI.Sprite(r),o=PIXI.RenderTexture.create(r.width,r.height);o.fillColor(16777215);var s=new PIXI.Sprite(o);s.mask=a,i=PIXI.RenderTexture.create(r.width,r.height),BFN.Stage.render(s,i),o.destroyGC(!0),s.mask=null,s.destroy(!0),a.destroy(!1)}var l=this.transformItem.maskFlippedHorizontal?!this.transformItem.flippedHorizontal:this.transformItem.flippedHorizontal,u=this.transformItem.maskFlippedVertical?!this.transformItem.flippedVertical:this.transformItem.flippedVertical;this.imageSpriteVeil.setMaskTexture(i||(this.transformItem.itemContentMask?this.transformItem.itemContentMask.texture:null),l,u),i&&i.destroyGC(!0)}else this.imageSprite.renderable=!1,this.fadeAnimator.decrease(),this.active=!1,this.transformTool.fadeAnimator.increase(),this.transformItem&&(BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this.transformItem),"exit_crop_layer","app_action"),BFN.TransformModel.selectedTransformItem===this.transformItem&&(BFN.TransformModel.selectedTransformItem=this.transformItem),this.transformItem.renderable=!0,this.transformItem=null,this.focusedFrameSprite=null);this.scale=this.scale,BFN.PIXITicker.nudge(),BFN.MainUI.tooltip=null,BFN.MainUI.requestRender()},Kx.prototype.setImageScale=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.transformItem){if(e=Math.max(1,e),this.imageScaleObject||(this.imageScaleObject={}),this.imageScaleObject.scaling||(this.imageScaleObject.scaling=!0,this.imageScaleObject.scale=-1,this.imageScaleObject.imageBaseScale=1/Math.max(this.frameTouchSurface.width/this.imageTouchSurface.width,this.frameTouchSurface.height/this.imageTouchSurface.height),this.imageScaleObject.imageBaseWidth=this.imageTouchSurface.width,this.imageScaleObject.imageBaseHeight=this.imageTouchSurface.height,this.imageScaleObject.imageBaseOriginX=this.frameTouchSurface.x+this.frameTouchSurface.width/2-this.imageTouchSurface.x,this.imageScaleObject.imageBaseOriginY=this.frameTouchSurface.y+this.frameTouchSurface.height/2-this.imageTouchSurface.y,this.imageScaleObject.imageBaseOriginFactorX=this.imageScaleObject.imageBaseOriginX/this.imageScaleObject.imageBaseWidth,this.imageScaleObject.imageBaseOriginFactorY=this.imageScaleObject.imageBaseOriginY/this.imageScaleObject.imageBaseHeight,this.transformItem.clearDropShadow(),this.transformItem.createTransition("history_image_region")),this.imageScaleObject.scale!=e){this.imageScaleObject.scale=e;var n=e/this.imageScaleObject.imageBaseScale;this.imageTouchSurface.width=Math.max(this.frameTouchSurface.width,this.imageScaleObject.imageBaseWidth*n),this.imageTouchSurface.height=Math.max(this.frameTouchSurface.height,this.imageScaleObject.imageBaseHeight*n),this.imageTouchSurface.x=this.frameTouchSurface.x+this.frameTouchSurface.width/2-this.imageTouchSurface.width*this.imageScaleObject.imageBaseOriginFactorX,this.imageTouchSurface.y=this.frameTouchSurface.y+this.frameTouchSurface.height/2-this.imageTouchSurface.height*this.imageScaleObject.imageBaseOriginFactorY,this.imageTouchSurface.x=Math.min(this.frameTouchSurface.x,Math.max(this.frameTouchSurface.x+this.frameTouchSurface.width-this.imageTouchSurface.width,this.imageTouchSurface.x)),this.imageTouchSurface.y=Math.min(this.frameTouchSurface.y,Math.max(this.frameTouchSurface.y+this.frameTouchSurface.height-this.imageTouchSurface.height,this.imageTouchSurface.y)),this.updateImageOutlineDisplay(),this.updateImageScaleHandlePositions(),this.updateImageSpriteDisplay(),this.updateTransformItem(),this.updateImageSpriteVeilDisplay()}this.imageScaleObject.scaling&&!t&&(delete this.imageScaleObject,this.transformItem.updateContentDimensions(),this.transformItem.updateAccurateBounds(),this.transformItem.updateSmoothingScale(),this.transformItem.registerTransition(!1,!1),this.setup(this.transformItem))}else this.imageScaleObject&&delete this.imageScaleObject},Kx.prototype.setScaleControlRange=function(){if(this.transformItem){var e=this.focusedFrameSprite,t=Math.max(this.frameTouchSurface.width/this.imageTouchSurface.width,this.frameTouchSurface.height/this.imageTouchSurface.height),n=this.imageTouchSurface.width*t,i=this.imageTouchSurface.height*t,r=this.transformTool.minSizeFrame,a=this.frameTouchSurface.width/r*e.baseWidth,o=this.frameTouchSurface.height/r*e.baseHeight,s=Math.min(a/n,o/i);UITools.getParamObject("layer_mask_image_crop_size").max=Math.max(100,Math.floor(100*s)),UITools.updateToolControl("layer_mask_image_crop_size")}},Kx.prototype.updateScaleControl=function(){if(this.transformItem){var e=1/Math.max(this.frameTouchSurface.width/this.imageTouchSurface.width,this.frameTouchSurface.height/this.imageTouchSurface.height),t=Math.floor(100*e),n=UITools.getParamObject("layer_mask_image_crop_size");n.max=Math.max(100,t,n.max),UITools.setControlValue("layer_mask_image_crop_size",t),UITools.updateToolControl("layer_mask_image_crop_size")}},Kx.prototype.updateTransformItem=function(){if(this.transformItem){var e=this.focusedFrameSprite,t=this.frameTouchSurface.width,n=this.frameTouchSurface.height,i=e.baseWidth,r=e.baseHeight,a=Math.max(t/i,n/r),o=i*a,s=r*a,l=this.imageTouchSurface.width,u=this.imageTouchSurface.height,c=this.imageTouchSurface.width-this.frameTouchSurface.width,h=this.imageTouchSurface.height-this.frameTouchSurface.height;e.frameWidth=t,e.frameHeight=n,e.textureScaleX=l/o,e.textureScaleY=u/s,e.offsetFactorX=c?Math.max(0,Math.min(1,(this.frameTouchSurface.x-this.imageTouchSurface.x)/c)):.5,e.offsetFactorY=h?Math.max(0,Math.min(1,(this.frameTouchSurface.y-this.imageTouchSurface.y)/h)):.5,this.transformItem.flippedHorizontal&&(e.offsetFactorX=1-e.offsetFactorX),this.transformItem.flippedVertical&&(e.offsetFactorY=1-e.offsetFactorY),e.updateDisplay();var d=this.frameTouchSurface.x,m=this.frameTouchSurface.y,p=Math.sqrt(Math.pow(d,2)+Math.pow(m,2)),g=Math.atan2(m,d)+this.transformItem.rotation;this.transformItem.x=this.controlContainer.x+Math.cos(g)*p,this.transformItem.y=this.controlContainer.y+Math.sin(g)*p,this.transformItem.itemContent.x=this.transformItem.flippedHorizontal?this.frameTouchSurface.width:0,this.transformItem.itemContent.y=this.transformItem.flippedVertical?this.frameTouchSurface.height:0}},Kx.prototype.updateImageSpriteDisplay=function(){this.updateImageSpriteDimensions(),this.updateImageSpritePosition()},Kx.prototype.updateImageSpriteDimensions=function(){this.imageSprite.width=this.imageTouchSurface.width,this.imageSprite.height=this.imageTouchSurface.height,this.updateImageSpriteSmoothing()},Kx.prototype.updateImageSpritePosition=function(){this.imageSprite.x=this.imageTouchSurface.x,this.imageSprite.y=this.imageTouchSurface.y},Kx.prototype.updateImageSpriteSmoothing=function(){this.imageSprite.currentScale=this.imageSprite.scale.x*this._scale,this.imageSprite.currentScaleY=this.imageSprite.scale.y*this._scale},Kx.prototype.updateImageSpriteVeilDisplay=function(){this.imageSpriteVeil.x=this.imageTouchSurface.x,this.imageSpriteVeil.y=this.imageTouchSurface.y,this.imageSpriteVeil.update(this.imageTouchSurface.width,this.imageTouchSurface.height,this.frameTouchSurface.x-this.imageTouchSurface.x,this.frameTouchSurface.y-this.imageTouchSurface.y,this.frameTouchSurface.width,this.frameTouchSurface.height)},Kx.prototype.updateImageTouchSurfaceDisplay=function(){this.updateImageTouchSurfaceDimensions(),this.updateImageTouchSurfacePosition()},Kx.prototype.updateImageTouchSurfaceDimensions=function(){this.transformItem&&(this.imageTouchSurface.width=this.focusedFrameSprite.imageRect.width,this.imageTouchSurface.height=this.focusedFrameSprite.imageRect.height,this.updateImageSpriteDimensions(),this.updateImageSpriteVeilDisplay())},Kx.prototype.updateImageTouchSurfacePosition=function(){this.transformItem&&(this.imageTouchSurface.x=this.transformItem.flippedHorizontal?Math.abs(this.focusedFrameSprite.imageRect.x)+this.focusedFrameSprite.width-this.focusedFrameSprite.imageRect.width:this.focusedFrameSprite.imageRect.x,this.imageTouchSurface.y=this.transformItem.flippedVertical?Math.abs(this.focusedFrameSprite.imageRect.y)+this.focusedFrameSprite.height-this.focusedFrameSprite.imageRect.height:this.focusedFrameSprite.imageRect.y,this.updateImageSpriteVeilDisplay())},Kx.prototype.updateImageTouchSurfaceHitArea=function(){var e=this.imageOutlinePadding/(this._scale*this.imageTouchSurface.scale.x),t=this.imageOutlinePadding/(this._scale*this.imageTouchSurface.scale.y);this.imageTouchSurface.hitArea=new PIXI.Rectangle(-e,-t,this.imageTouchSurface.width/this.imageTouchSurface.scale.x+2*e,this.imageTouchSurface.height/this.imageTouchSurface.scale.y+2*t)},Kx.prototype.updateFrameTouchSurfaceDisplay=function(){this.updateFrameTouchSurfaceDimensions(),this.updateFrameTouchSurfacePosition()},Kx.prototype.updateFrameTouchSurfaceDimensions=function(){this.transformItem&&(this.frameTouchSurface.width=this.focusedFrameSprite.width,this.frameTouchSurface.height=this.focusedFrameSprite.height,this.updateImageSpriteVeilDisplay())},Kx.prototype.updateFrameTouchSurfacePosition=function(){this.transformItem&&(this.frameTouchSurface.x=0,this.frameTouchSurface.y=0,this.updateImageSpriteVeilDisplay())},Kx.prototype.updateOutlineDisplays=function(){this.updateFrameOutlineDisplay(),this.updateImageOutlineDisplay()},Kx.prototype.updateImageOutlineDisplay=function(){this.updateImageOutlineDimensions(),this.updateImageOutlinePosition()},Kx.prototype.updateImageOutlineDimensions=function(){this.imageSpriteOutline.setDimensions(this.imageTouchSurface.width+this.imageOutlinePadding/this._scale*2,this.imageTouchSurface.height+this.imageOutlinePadding/this._scale*2)},Kx.prototype.updateImageOutlinePosition=function(){this.imageSpriteOutline.x=this.imageTouchSurface.x+this.imageTouchSurface.width/2,this.imageSpriteOutline.y=this.imageTouchSurface.y+this.imageTouchSurface.height/2},Kx.prototype.updateFrameOutlineDisplay=function(){this.updateFrameOutlineDimensions(),this.updateFrameOutlinePosition()},Kx.prototype.updateFrameOutlineDimensions=function(){this.frameSpriteOutline.setDimensions(this.frameTouchSurface.width,this.frameTouchSurface.height)},Kx.prototype.updateFrameOutlinePosition=function(){this.frameSpriteOutline.x=this.frameTouchSurface.x+this.frameTouchSurface.width/2,this.frameSpriteOutline.y=this.frameTouchSurface.y+this.frameTouchSurface.height/2},Kx.prototype.updateScaleHandlePositions=function(){this.updateFrameScaleHandlePositions(),this.updateImageScaleHandlePositions()},Kx.prototype.updateImageScaleHandlePositions=function(){for(var e in this.imageScaleHandles){var t=this.imageScaleHandles[e];t.noPaddingX=this.imageSpriteOutline.x,t.noPaddingY=this.imageSpriteOutline.y,t.id.includes("l")&&(t.noPaddingX-=this.imageTouchSurface.width/2),t.id.includes("r")&&(t.noPaddingX+=this.imageTouchSurface.width/2),t.id.includes("t")&&(t.noPaddingY-=this.imageTouchSurface.height/2),t.id.includes("b")&&(t.noPaddingY+=this.imageTouchSurface.height/2),t.id.includes("l")&&(t.x=t.noPaddingX-this.imageOutlinePadding/this._scale),t.id.includes("r")&&(t.x=t.noPaddingX+this.imageOutlinePadding/this._scale),t.id.includes("t")&&(t.y=t.noPaddingY-this.imageOutlinePadding/this._scale),t.id.includes("b")&&(t.y=t.noPaddingY+this.imageOutlinePadding/this._scale)}},Kx.prototype.updateFrameScaleHandlePositions=function(){for(var e in this.frameScaleHandles){var t=this.frameScaleHandles[e];t.noPaddingX=this.frameSpriteOutline.x,t.noPaddingY=this.frameSpriteOutline.y,t.id.includes("l")&&(t.noPaddingX-=this.frameTouchSurface.width/2),t.id.includes("r")&&(t.noPaddingX+=this.frameTouchSurface.width/2),t.id.includes("t")&&(t.noPaddingY-=this.frameTouchSurface.height/2),t.id.includes("b")&&(t.noPaddingY+=this.frameTouchSurface.height/2),t.x=t.noPaddingX,t.y=t.noPaddingY}},Kx.prototype.updateFrameScaleHandleDisplay=function(){var e=this.frameSpriteOutline.width*this._scale,t=this.frameSpriteOutline.height*this._scale,n=this.handleTextureCorner.width+this.handleTextureSide.width-2;for(var i in this.frameScaleHandles){var r=this.frameScaleHandles[i];switch(r.type){case"corner":break;case"side":r.active=r.horizontal?t>n:e>n}}},Kx.prototype.updateOutlineScales=function(){this.frameSpriteOutline.scale=this._scale,this.imageSpriteOutline.scale=this._scale},Kx.prototype.updateScaleHandleScales=function(){for(var e in this.frameScaleHandles){var t=this.frameScaleHandles[e];t.scale.x=t.scale.y=1/this._scale}for(var n in this.imageScaleHandles){var i=this.imageScaleHandles[n];i.scale.x=i.scale.y=1/this._scale}},Kx.prototype.toggleInteraction=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(var n in e=!!e,this.imageTouchSurface.interactive=e||!e&&this.imageTouchSurface==t,this.frameTouchSurface.interactive=e||!e&&this.frameTouchSurface==t,this.imageScaleHandles){var i=this.imageScaleHandles[n];(e||i!=t)&&(i.interactive=e)}for(var r in this.frameScaleHandles){var a=this.frameScaleHandles[r];(e||a!=t)&&(a.interactive=e)}this.transformTool.transformLayer.interactiveChildren=e},Kx.prototype.updateCursorOrientation=function(e){if(e){var t=e.group+"SpriteOutline",n=this.hasOwnProperty(t)?this[t]:null;if(n){var i=this.controlContainer.toGlobal(new PIXI.Point(e.noPaddingX,e.noPaddingY)),r=this.controlContainer.toGlobal(new PIXI.Point(n.x,n.y));BFN.CursorScreen.cursorRotation=Math.atan2(r.y-i.y,r.x-i.x)}}},Kx.prototype.dragImage=function(){var e=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent),t=e.x-this.containerMouseDownPoint.x,n=e.y-this.containerMouseDownPoint.y,i=this.imageTouchSurface.width-this.frameTouchSurface.width,r=this.imageTouchSurface.height-this.frameTouchSurface.height,a=this.frameTouchSurface.x-i,o=this.frameTouchSurface.x,s=this.frameTouchSurface.y-r,l=this.frameTouchSurface.y,u=this.containerItemStartPoint.x+t,c=this.containerItemStartPoint.y+n;this.containerMouseDownPoint.x+=Math.min(0,u-a)+Math.max(0,u-o),this.containerMouseDownPoint.y+=Math.min(0,c-s)+Math.max(0,c-l),this.imageTouchSurface.x=Math.max(a,Math.min(o,u)),this.imageTouchSurface.y=Math.max(s,Math.min(l,c)),this.updateImageOutlinePosition(),this.updateImageScaleHandlePositions(),this.updateTransformItem(),this.updateImageSpritePosition(),this.updateImageSpriteVeilDisplay()},Kx.prototype.dragFrame=function(){var e=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent),t=e.x-this.containerMouseDownPoint.x,n=e.y-this.containerMouseDownPoint.y,i=this.imageTouchSurface.width-this.frameTouchSurface.width,r=this.imageTouchSurface.height-this.frameTouchSurface.height,a=this.imageTouchSurface.x,o=this.imageTouchSurface.x+i,s=this.imageTouchSurface.y,l=this.imageTouchSurface.y+r,u=this.containerItemStartPoint.x+t,c=this.containerItemStartPoint.y+n;this.containerMouseDownPoint.x+=Math.min(0,u-a)+Math.max(0,u-o),this.containerMouseDownPoint.y+=Math.min(0,c-s)+Math.max(0,c-l),this.frameTouchSurface.x=Math.max(a,Math.min(o,u)),this.frameTouchSurface.y=Math.max(s,Math.min(l,c)),this.updateFrameOutlinePosition(),this.updateFrameScaleHandlePositions(),this.updateTransformItem(),this.updateImageSpriteVeilDisplay()},Kx.prototype.updateScaleControlBounds=function(){if(this.scaleControlBounds={},this.currentScaleHandle&&this.transformItem&&this.scaleMode){var e=this.getInverseScaleHandle(this.currentScaleHandle);this.scaleAnchor.x=e.noPaddingX,this.scaleAnchor.y=e.noPaddingY;var t=this.currentScaleHandle,n=this.focusedFrameSprite,i=this.scaleHandleDragger.altKey,r=new BFN.Rectangle(this.imageTouchSurface.x,this.imageTouchSurface.y,this.imageTouchSurface.width,this.imageTouchSurface.height),a=new BFN.Rectangle(this.frameTouchSurface.x,this.frameTouchSurface.y,this.frameTouchSurface.width,this.frameTouchSurface.height),o=this.transformTool.minSizeFrame,s=Math.max(o,r.width/n.baseWidth*o),l=Math.max(o,r.height/n.baseHeight*o),u=a.width/o*n.baseWidth,c=a.height/o*n.baseHeight;switch(t.type){case"corner":var h=t.id.includes("l")?t:e,d=t.id.includes("r")?t:e,m=d.noPaddingX-h.noPaddingX,p=d.noPaddingY-h.noPaddingY,g=Math.atan2(p,m),f=g+Math.PI/2;this.scaleControlBounds.slope=Math.sin(f)/Math.cos(f),this.scaleControlBounds.beta=g,this.scaleControlBounds.sign=t.noPaddingY-this.scaleAnchor.y<this.scaleControlBounds.slope*(t.noPaddingX-this.scaleAnchor.x)?-1:1}switch(t.group){case"image":if(this.scaleControlBounds.center=r.centerX,this.scaleControlBounds.middle=r.centerY,this.scaleControlBounds.ratio=r.height/r.width,this.scaleControlBounds.maxDiagonal=Math.min(Math.sqrt(Math.pow(u,2)+Math.pow(u*this.scaleControlBounds.ratio,2)),Math.sqrt(Math.pow(c,2)+Math.pow(c/this.scaleControlBounds.ratio,2)))/(i?2:1),this.scaleMode&&this.scaleMode.includes("freeform"))t.id.includes("l")&&(this.scaleControlBounds.right=i?Math.min(a.left,r.left+(r.right-a.right)):a.left,this.scaleControlBounds.left=i?r.centerX-u/2:r.right-u),t.id.includes("t")&&(this.scaleControlBounds.bottom=i?Math.min(a.top,r.top+(r.bottom-a.bottom)):a.top,this.scaleControlBounds.top=i?r.centerY-c/2:r.bottom-c),t.id.includes("r")&&(this.scaleControlBounds.left=i?Math.max(a.right,r.right-(a.left-r.left)):a.right,this.scaleControlBounds.right=i?r.centerX+u/2:r.left+u),t.id.includes("b")&&(this.scaleControlBounds.top=i?Math.max(a.bottom,r.bottom-(a.top-r.top)):a.bottom,this.scaleControlBounds.bottom=i?r.centerY+c/2:r.top+c),"side"===t.type&&(t.horizontal?this.scaleControlBounds.top=this.scaleControlBounds.bottom=r.centerY:this.scaleControlBounds.left=this.scaleControlBounds.right=r.centerX);else if(this.scaleMode.includes("constrained"))switch(this.scaleControlBounds.minDiagonal=0,t.type){case"corner":var v,y;i?(v=Math.max(a.right-r.centerX,r.centerX-a.left),y=Math.max(a.bottom-r.centerY,r.centerY-a.top)):(t.id.includes("l")&&(v=r.right-a.left),t.id.includes("t")&&(y=r.bottom-a.top),t.id.includes("r")&&(v=a.right-r.left),t.id.includes("b")&&(y=a.bottom-r.top));var x=v*this.scaleControlBounds.ratio,_=y/this.scaleControlBounds.ratio,I=Math.sqrt(Math.pow(v,2)+Math.pow(x,2)),T=Math.sqrt(Math.pow(y,2)+Math.pow(_,2));this.scaleControlBounds.minDiagonal=Math.max(I,T)}break;case"frame":if(this.scaleControlBounds.center=a.centerX,this.scaleControlBounds.middle=a.centerY,this.scaleControlBounds.ratio=a.height/a.width,this.scaleControlBounds.minDiagonal=Math.max(Math.sqrt(Math.pow(s,2)+Math.pow(s*this.scaleControlBounds.ratio,2)),Math.sqrt(Math.pow(l,2)+Math.pow(l/this.scaleControlBounds.ratio,2)))/(i?2:1),this.scaleMode.includes("freeform"))t.id.includes("l")&&(this.scaleControlBounds.left=i?Math.max(r.left,a.left-(r.right-a.right)):r.left,this.scaleControlBounds.right=i?a.centerX-s/2:a.right-s),t.id.includes("t")&&(this.scaleControlBounds.top=i?Math.max(r.top,a.top-(r.bottom-a.bottom)):r.top,this.scaleControlBounds.bottom=i?a.centerY-l/2:a.bottom-l),t.id.includes("r")&&(this.scaleControlBounds.right=i?Math.min(r.right,a.right+(a.left-r.left)):r.right,this.scaleControlBounds.left=i?a.centerX+s/2:a.left+s),t.id.includes("b")&&(this.scaleControlBounds.bottom=i?Math.min(r.bottom,a.bottom+(a.top-r.top)):r.bottom,this.scaleControlBounds.top=i?a.centerY+l/2:a.top+l),"side"===t.type&&(t.horizontal?this.scaleControlBounds.top=this.scaleControlBounds.bottom=a.centerY:this.scaleControlBounds.left=this.scaleControlBounds.right=a.centerX);else if(this.scaleMode.includes("constrained"))switch(this.scaleControlBounds.maxDiagonal=0,t.type){case"corner":var b,S;i?(b=Math.min(r.right-a.centerX,a.centerX-r.left),S=Math.min(r.bottom-a.centerY,a.centerY-r.top)):(t.id.includes("l")&&(b=a.right-r.left),t.id.includes("t")&&(S=a.bottom-r.top),t.id.includes("r")&&(b=r.right-a.left),t.id.includes("b")&&(S=r.bottom-a.top));var C=b*this.scaleControlBounds.ratio,B=S/this.scaleControlBounds.ratio,F=Math.sqrt(Math.pow(b,2)+Math.pow(C,2)),E=Math.sqrt(Math.pow(S,2)+Math.pow(B,2));this.scaleControlBounds.maxDiagonal=Math.min(F,E)}}}},Kx.prototype.freeformScale=function(){var e=this,t=this.currentScaleHandle,n=this.scaleHandleDragger.altKey,i=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent);this.scaleControl.x=i.x,this.scaleControl.y=i.y,"image"===t.group&&(t.id.includes("l")&&(this.scaleControl.x+=this.imageOutlinePadding/this._scale),t.id.includes("r")&&(this.scaleControl.x-=this.imageOutlinePadding/this._scale),t.id.includes("t")&&(this.scaleControl.y+=this.imageOutlinePadding/this._scale),t.id.includes("b")&&(this.scaleControl.y-=this.imageOutlinePadding/this._scale)),this.scaleControlBounds&&(this.scaleControlBounds.hasOwnProperty("left")&&(this.scaleControl.x=Math.max(this.scaleControlBounds.left,this.scaleControl.x)),this.scaleControlBounds.hasOwnProperty("right")&&(this.scaleControl.x=Math.min(this.scaleControlBounds.right,this.scaleControl.x)),this.scaleControlBounds.hasOwnProperty("top")&&(this.scaleControl.y=Math.max(this.scaleControlBounds.top,this.scaleControl.y)),this.scaleControlBounds.hasOwnProperty("bottom")&&(this.scaleControl.y=Math.min(this.scaleControlBounds.bottom,this.scaleControl.y)));var r="image"===t.group?this.imageTouchSurface:this.frameTouchSurface,a=function(){r.width=Math.abs(n?2*(e.scaleControlBounds.center-e.scaleControl.x):e.scaleAnchor.x-e.scaleControl.x),r.x=n?e.scaleControlBounds.center-r.width/2:t.id.includes("l")?e.scaleControl.x:e.scaleAnchor.x},o=function(){r.height=Math.abs(n?2*(e.scaleControlBounds.middle-e.scaleControl.y):e.scaleAnchor.y-e.scaleControl.y),r.y=n?e.scaleControlBounds.middle-r.height/2:t.id.includes("t")?e.scaleControl.y:e.scaleAnchor.y};switch(t.type){case"corner":a(),o();break;case"side":t.horizontal?a():o()}},Kx.prototype.constrainedScale=function(){var e=this.currentScaleHandle,t=this.scaleHandleDragger.altKey,n=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent);this.scaleControl.x=n.x,this.scaleControl.y=n.y,"image"===e.group&&(e.id.includes("l")&&(this.scaleControl.x+=this.imageOutlinePadding/this._scale),e.id.includes("r")&&(this.scaleControl.x-=this.imageOutlinePadding/this._scale),e.id.includes("t")&&(this.scaleControl.y+=this.imageOutlinePadding/this._scale),e.id.includes("b")&&(this.scaleControl.y-=this.imageOutlinePadding/this._scale));var i=new PIXI.Point(this.scaleControl.x-(t?this.scaleControlBounds.center:this.scaleAnchor.x),this.scaleControl.y-(t?this.scaleControlBounds.middle:this.scaleAnchor.y)),r=this.getPointToLineDistance(i,this.scaleControlBounds.slope);(i.y<this.scaleControlBounds.slope*i.x?-1:1)!=this.scaleControlBounds.sign&&(r=this.scaleControlBounds.minDiagonal),"corner"===e.type&&(r=Math.min(this.scaleControlBounds.maxDiagonal,Math.max(this.scaleControlBounds.minDiagonal,r)));var a="image"===e.group?this.imageTouchSurface:this.frameTouchSurface;switch(e.type){case"corner":a.width=Math.abs(Math.cos(this.scaleControlBounds.beta)*r*(t?2:1)),a.height=Math.abs(Math.sin(this.scaleControlBounds.beta)*r*(t?2:1))}if(t)a.x=this.scaleControlBounds.center-a.width/2,a.y=this.scaleControlBounds.middle-a.height/2;else switch(e.type){case"corner":switch(e.id){case"tl":a.x=this.scaleAnchor.x-a.width,a.y=this.scaleAnchor.y-a.height;break;case"tr":a.x=this.scaleAnchor.x,a.y=this.scaleAnchor.y-a.height;break;case"br":a.x=this.scaleAnchor.x,a.y=this.scaleAnchor.y;break;case"bl":a.x=this.scaleAnchor.x-a.width,a.y=this.scaleAnchor.y}}},Kx.prototype.createScaleHandle=function(e,t){var n=new BFN.HoverButton;return n.buttonMode=!1,n.id=e,n.group=t,n.type=this.sideHandleIDs.includes(e)?"side":"corner",n.horizontal=["l","r"].includes(e),n.texture="image"==t?this.handleTextureCircle:"side"==n.type?this.handleTextureSide:this.handleTextureCorner,n.rotation=n.horizontal?Math.PI/2:"corner"==n.type?this.cornerHandleIDs.indexOf(e)*(Math.PI/2):0,n.on("pointerover",this.handleScaleHandleOver.bind(this)),n.on("pointerout",this.handleScaleHandleOut.bind(this)),n.on("pointerdown",this.handleScaleHandlePress.bind(this)),this.scaleHandleContainer.addChild(n),"frame"==t&&this.cornerHandleIDs.includes(e)&&(n.buttonSprite.anchor.x=n.buttonSprite.anchor.y=.3),n},Kx.prototype.getInverseScaleHandle=function(e){var t,n=null;if(e&&e.group&&e.id)switch(e.group){case"image":(t=this.cornerHandleIDs.indexOf(e.id))>=0&&(n=this.imageScaleHandles[this.cornerHandleIDs[(t+2)%this.cornerHandleIDs.length]]);break;case"frame":(t=this.scaleHandleIDs.indexOf(e.id))>=0&&(n=this.frameScaleHandles[this.scaleHandleIDs[(t+4)%this.scaleHandleIDs.length]])}return n},Kx.prototype.getPointToLineDistance=function(e,t){if(0==t)return Math.abs(e.y);if(t==1/0)return Math.abs(e.x);var n=(e.y+1/t*e.x)/(t- -1/t),i=t*n;return Math.sqrt(Math.pow(n-e.x,2)+Math.pow(i-e.y,2))},Kx.prototype.handleTouchSurfaceOver=function(e){var t=this,n=e.target;setTimeout(function(){if(t.transformTool.item&&e.target)switch(BFN.CursorScreen.cursor="move",n){case t.imageTouchSurface:t.imageSpriteOutline.hovered=!0,t.imageSpriteOutline.highlight=!0;break;case t.frameTouchSurface:t.frameSpriteOutline.hovered=!0,t.frameSpriteOutline.highlight=!0}},0)},Kx.prototype.handleTouchSurfaceOut=function(e){this.imageSpriteOutline.hovered=!1,this.frameSpriteOutline.hovered=!1,this.touchSurfaceDragger.dragging||(BFN.CursorScreen.cursor=null,this.imageSpriteOutline.highlight=!1,this.frameSpriteOutline.highlight=!1)},Kx.prototype.handleTouchSurfacePress=function(e){if(this.transformItem){BFN.CursorScreen.cursorLock=!0,this.transformItem.transforming=!0;var t=e.target;this.toggleInteraction(!1,t),this.containerMouseDownPoint=this.controlContainer.getPointerPosition(BFN.MainUI.pointerEvent),this.containerItemStartPoint=new PIXI.Point(t.x,t.y),this.touchSurfaceDragger.drag(t),e.stopPropagation()}},Kx.prototype.handleScaleHandleOver=function(e){var t=e.target;setTimeout(function(){this.transformItem&&e.target&&(BFN.CursorScreen.cursor="arrow",t.parent.setChildIndex(t,t.parent.children.length-1),this.updateCursorOrientation(t),this.sideHandleIDs.includes(t.id)||(BFN.MainUI.tooltip="scaling_tooltip"))}.bind(this),0)},Kx.prototype.handleScaleHandleOut=function(e){this.scaleHandleDragger.dragging||(BFN.CursorScreen.cursor=null),BFN.MainUI.tooltip=null},Kx.prototype.handleScaleHandlePress=function(e){if(this.transformItem){BFN.CursorScreen.cursorLock=!0,this.transformItem.transforming=!0,this.currentScaleHandle=e.target,this.currentScaleHandle.selected=!0,this.toggleInteraction(!1,this.currentScaleHandle),this.scaleHandleDragger.drag(this.currentScaleHandle);var t=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.width:this.imageTouchSurface.width),n=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.height:this.imageTouchSurface.height);BFN.TooltipScreen.show(t+" x "+n,!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY,!1,!0),e.stopPropagation()}},Kx.prototype.handleTouchSurfaceDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.transformItem){var t="invalid_frame_transform_move",n=this.touchSurfaceDragger.item;if(n)switch(n){case this.imageTouchSurface:t="history_image_region";break;case this.frameTouchSurface:t="history_move_image"}this.transformItem.clearDropShadow(),this.transformItem.createTransition(t)}},Kx.prototype.handleTouchSurfaceDragging=function(e){switch(this.touchSurfaceDragger.item){case this.imageTouchSurface:this.dragImage();break;case this.frameTouchSurface:this.dragFrame()}},Kx.prototype.handleTouchSurfaceDraggingComplete=function(e){this.imageSpriteOutline.highlight=this.imageSpriteOutline.hovered,this.frameSpriteOutline.highlight=this.frameSpriteOutline.hovered,BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.toggleInteraction(!0),this.transformItem&&(this.transformItem.transforming=!1,this.touchSurfaceDragger.draggedItem===this.frameTouchSurface&&(this.transformItem.transformTool.updateTransformValues(),this.transformItem.transformTool.conformItemToBounds()),this.transformItem.updateContentDimensions(),this.transformItem.updateSmoothingScale(),this.setup(this.transformItem),this.transformTool.updateDisplay(),this.transformItem.registerTransition(!1))},Kx.prototype.handleScaleHandleDraggingStarted=function(e){if(BFN.smoothPictureDisabled=!0,this.transformItem){var t="invalid_frame_transform_scale",n=this.scaleHandleDragger.item;if(n)switch(n.group){case"image":t="history_image_region";break;case"frame":t="history_scale_image"}this.transformItem.clearDropShadow(),this.transformItem.createTransition(t),this.transformToolVO=UITools.getToolVO("transform")}},Kx.prototype.handleScaleHandleDragging=function(e){if(this.transformItem&&this.currentScaleHandle){var t=this.scaleHandleDragger.shiftKey,n=this.scaleHandleDragger.altKey,i=(t||"side"==this.currentScaleHandle.type?"freeform":"constrained")+"_"+(n?"center":"opposite");switch(this.scaleMode!=i&&(this.scaleMode=i,this.updateScaleControlBounds()),this.scaleMode.includes("freeform")?this.freeformScale():this.constrainedScale(),this.currentScaleHandle.group){case"image":this.updateImageOutlineDisplay(),this.updateImageScaleHandlePositions(),this.updateImageSpriteDisplay();break;case"frame":this.updateFrameOutlineDisplay(),this.updateFrameScaleHandlePositions(),this.updateFrameScaleHandleDisplay()}if(this.updateTransformItem(),this.transformItem.basicShapeVO){this.transformItem.updateShapeTexture(!1);var r=this.transformItem.maskFlippedHorizontal?!this.transformItem.flippedHorizontal:this.transformItem.flippedHorizontal,a=this.transformItem.maskFlippedVertical?!this.transformItem.flippedVertical:this.transformItem.flippedVertical;this.imageSpriteVeil.setMaskTexture(this.transformItem.itemContentMask?this.transformItem.itemContentMask.texture:null,r,a)}if(this.updateImageSpriteVeilDisplay(),this.updateCursorOrientation(this.currentScaleHandle),this.updateScaleControl(),BFN.TooltipScreen.active){var o=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.width:this.imageTouchSurface.width),s=Math.round("frame"===this.currentScaleHandle.group?this.frameTouchSurface.height:this.imageTouchSurface.height);BFN.TooltipScreen.setMessage(o+" x "+s)}}},Kx.prototype.handleScaleHandleDraggingComplete=function(e){(BFN.CursorScreen.cursorLock=!1,BFN.smoothPictureDisabled=!1,this.currentScaleHandle&&(this.currentScaleHandle.selected=!1),this.currentScaleHandle=null,this.scaleControlBounds=null,this.scaleMode=null,this.toggleInteraction(!0),this.transformItem)&&(this.transformItem.transforming=!1,this.scaleHandleDragger.wasDragged?("frame"===this.scaleHandleDragger.draggedItem.group&&(this.transformItem.transformTool.updateTransformValues(),this.transformItem.transformTool.conformItemToBounds()),this.transformItem.updateShapeTexture(),this.transformItem.updateContentDimensions(),this.transformItem.updateSmoothingScale(),this.setup(this.transformItem),this.transformTool.updateDisplay(),this.transformItem.registerTransition(!1)):this.transformItem.updateDropShadowSource());BFN.TooltipScreen.active&&BFN.TooltipScreen.hide()},Kx.prototype.handleFadeAnimatorUpdate=function(e){this.fadeContainer.alpha=this.fadeAnimator.animationFactor,this.visible=!!this.fadeContainer.alpha},Object.defineProperty(Kx.prototype,"scale",{set:function(e){this._scale=Math.max(0,e),this.transformItem&&(this.updateImageOutlineDimensions(),this.updateImageScaleHandlePositions(),this.updateImageTouchSurfaceHitArea(),this.updateFrameScaleHandleDisplay(),this.updateScaleHandleScales(),this.updateOutlineScales(),this.updateImageSpriteSmoothing())},get:function(){return this._scale}}),BFN.TransformToolFrame=Kx,Qx.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Qx.prototype.init=function(){BeFunky.log("TransformToolSnapGaps Init"),this.initDefaultValues(),this.initDisplay()},Qx.prototype.initDefaultValues=function(){this.interactive=!1,this.interactiveChildren=!1,this._scale=1,this.bgFillFilter=new BFN.filters.BackgroundFillFilter,this.bgFillFilter.resolution=BFN.Stage.resolution,this.graphic=new PIXI.Graphics,this.addChild(this.graphic)},Qx.prototype.initDisplay=function(){this.snapGapGraphic=new PIXI.Graphics,this.addChild(this.snapGapGraphic),this.allSnapGapLabels=[],this.availableSnapGapLabels=[],this.usedSnapGapLabels=[],this.labelContainer=new PIXI.Container,this.addChild(this.labelContainer)},Qx.prototype.show=function(){this.canvasModel=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),this.canvas=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);var e=this.canvas.transformToolSnapGapsContainer;e.children.includes(BFN.TransformToolSnapGaps)||(BFN.TransformToolSnapGaps.canvasScale=this.canvasModel.canvasScale,e.addChild(BFN.TransformToolSnapGaps))},Qx.prototype.hide=function(){this.canvas=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);var e=this.canvas.transformToolSnapGapsContainer;e.children.includes(BFN.TransformToolSnapGaps)&&e.removeChild(BFN.TransformToolSnapGaps)},Qx.prototype.drawRect=function(e,t){e&&t&&(this.graphic.beginFill(65280,.2),this.graphic.drawRect(e.x,e.y,t.x-e.x,t.y-e.y),this.graphic.endFill())},Qx.prototype.clearSnapGaps=function(){var e;this.snapGapGraphic.clear(),this.availableSnapGapLabels.splice(0),(e=this.availableSnapGapLabels).push.apply(e,v(this.allSnapGapLabels)),this.usedSnapGapLabels.forEach(function(e){e.visible=!1}),this.usedSnapGapLabels.splice(0)},Qx.prototype.drawSnapGap=function(e,t,n){if(e&&["horizontal","vertical"].includes(t)&&n){this.snapGapGraphic.beginFill(16711935,.25),this.snapGapGraphic.drawRect(e.x,e.y,e.width,e.height),this.snapGapGraphic.endFill();var i=BFN.TransformModel.showMeasurements?16711935:2154751,r=new PIXI.Point;switch(t){case"horizontal":this.snapGapGraphic.lineStyle(1,i),this.snapGapGraphic.moveTo(e.x,e.y),this.snapGapGraphic.lineTo(e.x+e.width,e.y),this.snapGapGraphic.moveTo(e.x,e.y+e.height),this.snapGapGraphic.lineTo(e.x+e.width,e.y+e.height),r.x=e.x+e.width/2,r.y=e.y+e.height/2;break;case"vertical":this.snapGapGraphic.lineStyle(1,i),this.snapGapGraphic.moveTo(e.x,e.y),this.snapGapGraphic.lineTo(e.x,e.y+e.height),this.snapGapGraphic.moveTo(e.x+e.width,e.y),this.snapGapGraphic.lineTo(e.x+e.width,e.y+e.height),r.x=e.x+e.width/2,r.y=e.y+e.height/2}if(this.snapGapGraphic.lineStyle(null),BFN.TransformModel.showMeasurements){var a=null;this.availableSnapGapLabels.length?((a=this.availableSnapGapLabels.shift()).text=n,a.visible=!0):((a=new PIXI.Text(n,{fontFamily:"Times New Roman",fontSize:13,fill:16777215,align:"center",padding:3})).filters=[this.bgFillFilter],a.anchor.x=a.anchor.y=.5,a.texture.setScaleMode(PIXI.SCALE_MODES.NEAREST),this.allSnapGapLabels.push(a),this.labelContainer.addChild(a)),a.x=r.x,a.y=r.y,this.usedSnapGapLabels.push(a)}}},Object.defineProperty(Qx.prototype,"canvasScale",{set:function(e){this._scale=e,this.scale.x=this.scale.y=1/this._scale},get:function(){return this._scale}}),BFN.SingletonQueue.add(function(){BFN.TransformToolSnapGaps=new Qx}),Zx.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),Zx.prototype.init=function(){BeFunky.log("TransformGuides Init"),this.initDefaultValues(),this.initGuideBars(),this.initGuideRulerMarks(),this.initGuideMarkers(),this.initGuideLines(),this.initGuideLock(),this.initGuideClear(),this.initGuideDragger(),this.initContextMenu(),this.updateGuideBarDisplay(),this.updateVisibility()},Zx.prototype.initDefaultValues=function(){var e=this;this.interactive=!0,this.interactiveChildren=!0,this.iconBase64Data={lock_locked:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAQBAMAAADUulMJAAAAElBMVEUAAAAAAAAAAAAAAAAAAAAAAADgKxmiAAAABXRSTlMA5zOZZqu80ccAAABFSURBVAjXY2BgUBQUYgACltDQUAcgrRoEREBaVIGBKRBEAzESbRoKAsEgLlgAQTOFKoBpllAHiHgoRJw51ACmDkHDzAEABwINSTHDDiEAAAAASUVORK5CYII=",lock_unlocked:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAASBAMAAACZcvICAAAAFVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAASAQCkAAAABnRSTlMA5zOZZsxFe4rUAAAASklEQVQI12NgYFAUFGIAApa0tDQHIK2WBERAWkyBgSkRRAMxiA6D0gyotFkaCCQziEEFEDRTmgKYZklzgIinQcSZ0wxg6hA0zBwAHDoQawcLHeMAAAAASUVORK5CYII=",clear:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMAgMAAAArG7R0AAAACVBMVEUAAAAAAAAAAACDY+nAAAAAAnRSTlMA8iUgXggAAAApSURBVAjXYwhgYGVIYZAEwhQGNscJDIzTHBgYMhlAGMQGiYHkQGpAagGiVAbNG1KVKAAAAABJRU5ErkJggg=="},this._colorMode=mn().name,this._colors={dark:{guide_bar:2763835,lock:11383244,clear:11383244,ruler_mark:11383244,marker_fill:11383244,marker_stroke:2369073},light:{guide_bar:16777215,lock:6118261,clear:6118261,ruler_mark:6118261,marker_fill:16777215,marker_stroke:6118261}},gn(function(){e.colorMode=mn().name}),this.transformGuideData=[],this.guides={},this.activeGuide=null,this.guidesLocked=!1,this.pressedID=null,this.pressedAxis=null,this.pressedValue=null,this.snapData=[],this.snappedItems=[],this.snapValue=null,this.snapDistance=5,this.guideBarAvailable=!0,this.handleGuideMarkerPressBind=this.handleGuideMarkerPress.bind(this),this.handleGuideMarkerOverBind=this.handleGuideMarkerOver.bind(this),this.handleGuideMarkerOutBind=this.handleGuideMarkerOut.bind(this),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppViewstateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handlePhotoEditorCanvasViewstateUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.updateVisibility.bind(this)),this.on("pointerdown",function(){BFN.preventSelectionDrag=!0})},Zx.prototype.initGuideBars=function(){this.guideBarThickness=24,this.guideBarTexture=PIXI.RenderTexture.create(this.guideBarThickness,this.guideBarThickness),this.guideBarTexture.fillColor(this._colors[this._colorMode].guide_bar),this.guideBarCornerLeft=new PIXI.Sprite(this.guideBarTexture),this.guideBarCornerLeft.interactive=!0,this.addChild(this.guideBarCornerLeft),this.guideBarCornerRight=new PIXI.Sprite(this.guideBarTexture),this.guideBarCornerRight.interactive=!0,this.addChild(this.guideBarCornerRight),this.guideBarLeft=this.createGuideBar("y",0,this.guideBarThickness),this.addChild(this.guideBarLeft),this.guideBarTop=this.createGuideBar("x",this.guideBarThickness,0),this.addChild(this.guideBarTop)},Zx.prototype.initGuideRulerMarks=function(){this.guideRulerMarks=new PIXI.Graphics,this.addChild(this.guideRulerMarks)},Zx.prototype.initGuideMarkers=function(){this.guideMarkerTexture=null,this.guideMarkersContainer=new PIXI.Container,this.addChild(this.guideMarkersContainer),this.guideMarkersMask=new PIXI.Graphics,this.addChild(this.guideMarkersMask),this.guideMarkersContainer.mask=this.guideMarkersMask},Zx.prototype.initGuideLines=function(){this.guideLineTexture=null,this.guideLinesContainer=new PIXI.Container,this.guideLinesContainer.interactive=this.guideLinesContainer.interactiveChildren=!1,this.addChild(this.guideLinesContainer)},Zx.prototype.initGuideLock=function(){var e=this;this.guideLockTextureLocked=PIXI.Texture.from(this.iconBase64Data.lock_locked),this.guideLockTextureLocked.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,this.guideLockTextureUnlocked=PIXI.Texture.from(this.iconBase64Data.lock_unlocked),this.guideLockTextureUnlocked.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,this.guideLockButton=new PIXI.Sprite,this.guideLockButton.interactive=!0,this.guideLockButton.buttonMode=!0,this.guideLockButton.pluginName="blend_picture",this.guideLockButton.fillColor=this._colors[this._colorMode].lock,this.guideLockButton.intensity=1,this.guideLockButton.anchor.x=this.guideLockButton.anchor.y=.5,this.guideLockButton.x=this.guideLockButton.y=this.guideBarThickness/2,this.guideLockButton.hitArea=new PIXI.Rectangle(-this.guideBarThickness/2,-this.guideBarThickness/2,this.guideBarThickness,this.guideBarThickness),this.addChild(this.guideLockButton),this.guideLockButton.on("pointerover",function(){BFN.MainUI.tooltip=e.guidesLocked?"unlock_guides":"lock_guides",e.guideLockButton.alpha=.7,BFN.MainUI.requestRender()}),this.guideLockButton.on("pointerout",function(){BFN.MainUI.tooltip=null,e.guideLockButton.alpha=1,BFN.MainUI.requestRender()}),this.guideLockButton.on("pointerdown",function(){e.guidesLocked=!e.guidesLocked,BFN.MainUI.tooltip=e.guidesLocked?"unlock_guides":"lock_guides",e.saveGuides(),e.updateGuideLockDisplay()}),this.updateGuideLockDisplay()},Zx.prototype.initGuideClear=function(){var e=this;this.guideClearTexture=PIXI.Texture.from(this.iconBase64Data.clear),this.guideClearTexture.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,this.guideClearButton=new PIXI.Sprite(this.guideClearTexture),this.guideClearButton.interactive=!0,this.guideClearButton.buttonMode=!0,this.guideClearButton.pluginName="blend_picture",this.guideClearButton.fillColor=this._colors[this._colorMode].clear,this.guideClearButton.intensity=1,this.guideClearButton.anchor.x=this.guideClearButton.anchor.y=.5,this.guideClearButton.x=1.5*this.guideBarThickness,this.guideClearButton.y=this.guideBarThickness/2,this.guideClearButton.hitArea=new PIXI.Rectangle(-this.guideBarThickness/2,-this.guideBarThickness/2,this.guideBarThickness,this.guideBarThickness),this.addChild(this.guideClearButton),this.guideClearButton.on("pointerover",function(){BFN.MainUI.tooltip="clear_guides",e.guideClearButton.alpha=.7,BFN.MainUI.requestRender()}),this.guideClearButton.on("pointerout",function(){BFN.MainUI.tooltip=null,e.guideClearButton.alpha=1,BFN.MainUI.requestRender()}),this.guideClearButton.on("pointerdown",function(){e.transformGuideData.splice(0),e.updateDisplay(!0),e.saveGuides(),e.contextMenu.hide()})},Zx.prototype.initGuideDragger=function(){this.guideDragger=new BFN.Dragger,this.guideDragger.useBounds=!1,this.guideDragger.autoDrag=!1,this.guideDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleGuideDraggerDragging.bind(this)),this.guideDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleGuideDraggerDraggingComplete.bind(this))},Zx.prototype.initContextMenu=function(){var e=this;this.contextMenu=document.getElementById("context_menu_transform_guides"),BeFunky.contextMenu(this.contextMenu,{add_guide:{onClick:function(){e.addGuide(e.pressedAxis,e.pressedValue,!0),e.contextMenu.hide()}},remove_guide:{onClick:function(){e.removeGuide(e.pressedID)}},clear_guides:{onClick:function(){e.transformGuideData.splice(0),e.updateDisplay(!0),e.saveGuides(),e.contextMenu.hide()}},lock_guides:{onClick:function(){e.guidesLocked=!0,e.saveGuides(),e.updateGuideLockDisplay(),e.contextMenu.hide()}},unlock_guides:{onClick:function(){e.guidesLocked=!1,e.saveGuides(),e.updateGuideLockDisplay(),e.contextMenu.hide()}}}),this.contextMenu.enabled=!1,this.contextMenu.target=document.querySelector("#appStage canvas")},Zx.prototype.addGuide=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(["x","y"].includes(e)&&"number"==typeof t){var i={id:"".concat(e,"_").concat(BeFunky.randomString(10)),axis:e,value:t};return this.transformGuideData.push(i),this.updateDisplay(!0),n&&this.saveGuides(),i}},Zx.prototype.removeGuide=function(e){for(var t=this.transformGuideData.length;--t>-1;){if(this.transformGuideData[t].id===e){this.transformGuideData.splice(t,1);break}}this.updateDisplay(!0),this.saveGuides()},Zx.prototype.setTransformGuideData=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.transformGuideData.splice(0);try{var i;(i=this.transformGuideData).push.apply(i,v(t))}catch(e){}this.guidesLocked=n,setTimeout(function(){e.updateDisplay(!0),e.updateGuideLockDisplay()},0)},Zx.prototype.updateGuideBarDisplay=function(){this.visible&&(this.guideBarTop.width=Math.max(10,BFN.StageModel.stageW-2*this.guideBarThickness),this.guideBarLeft.height=Math.max(10,BFN.StageModel.stageH-this.guideBarThickness),this.guideBarCornerRight.x=BFN.StageModel.stageW-this.guideBarThickness,this.guideClearButton.x=BFN.StageModel.stageW-this.guideBarThickness/2,this.guideMarkersMask.clear(),this.guideMarkersMask.beginFill(16777215),this.guideMarkersMask.drawRect(this.guideBarTop.x,this.guideBarTop.y,this.guideBarTop.width,Math.max(10,BFN.StageModel.stageH-this.guideBarTop.y)),this.guideMarkersMask.endFill(),this.guideMarkersMask.beginFill(16777215),this.guideMarkersMask.drawRect(this.guideBarLeft.x,this.guideBarLeft.y,Math.max(10,BFN.StageModel.stageW-this.guideBarLeft.x),this.guideBarLeft.height),this.guideMarkersMask.endFill(),this.guideMarkersMask.hitArea=new PIXI.Rectangle(0,0,0,0))},Zx.prototype.updateDisplay=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(BFN.AppModel.viewState&&this.visible){if(t){var n=this.transformGuideData.map(function(e){return e.id});for(var i in this.guides)n.includes(i)||this.destroyGuide(i);this.transformGuideData.forEach(function(t){e.createGuide(t)})}for(var r in this.guides)this.updateGuidePosition(r);this.drawGuideRulerMarks(),BFN.MainUI.requestRender()}},Zx.prototype.updateGuidePosition=function(e){if(this.guides.hasOwnProperty(e)){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),n=t.transformLayer,i=this.guides[e],r=t.toGlobal(new PIXI.Point),a=n.toGlobal(new PIXI.Point(i.value,i.value));i.marker[i.axis]=a[i.axis]-BFN.MainUI[i.axis];var o=i.line,s=a[i.axis]-BFN.MainUI[i.axis];s%1||(s-=.001),o[i.axis]=s,o[i.perpendicularAxis]=r[i.perpendicularAxis]-BFN.MainUI[i.perpendicularAxis]}},Zx.prototype.drawGuideRulerMarks=function(){var e=this,t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,n=t.toGlobal(new PIXI.Point(-Math.round(t.frameWidth/2),-Math.round(t.frameHeight/2)));n.x-=BFN.MainUI.x,n.y-=BFN.MainUI.y;var i,r,a,o,s,l,u=t.canvasScale,c=2*u,h=10*u,d=20*u,m=100*u,p=c<4?h<4?d<4?m:d:h:c,g=this._colors[this._colorMode].ruler_mark;this.guideRulerMarks.clear();var f=function(t){switch(s=1,p){case c:.3===(o=r%50?r%5?.3:.5:.7)&&(s=Math.min(1,2*(p-4)));break;case h:.5===(o=r%10?.5:.7)&&r%2&&(s=Math.min(1,2*(p-4)));break;case d:.5===(o=r%5?.5:.7)&&(s=Math.min(1,2*(p-4)));break;case m:o=.7}switch(a=o*e.guideBarThickness,e.guideRulerMarks.lineStyle(1,g,s),t){case"x":e.guideRulerMarks.moveTo(i,e.guideBarThickness-a),e.guideRulerMarks.lineTo(i,e.guideBarThickness);break;case"y":e.guideRulerMarks.moveTo(e.guideBarThickness-a,i),e.guideRulerMarks.lineTo(e.guideBarThickness,i)}},v=function(t){for(e.guideRulerMarks.lineStyle(1,g,1),"x"===t?(e.guideRulerMarks.moveTo(0,e.guideBarThickness-.001),e.guideRulerMarks.lineTo(BFN.StageModel.stageW,e.guideBarThickness-.001),e.guideRulerMarks.moveTo(BFN.StageModel.stageW-e.guideBarThickness-.001,0),e.guideRulerMarks.lineTo(BFN.StageModel.stageW-e.guideBarThickness-.001,e.guideBarThickness)):(e.guideRulerMarks.moveTo(e.guideBarThickness-.001,0),e.guideRulerMarks.lineTo(e.guideBarThickness-.001,BFN.StageModel.stageH)),l="x"===t?e.guideBarTop:e.guideBarLeft,(i=n[t])%1||(i-=.001),r=0;i>l[t];)f(t),i-=p,r++;for((i=n[t])%1||(i-=.001),r=0;i<l[t]+("x"===t?l.width:l.height);)i>l[t]&&f(t),i+=p,r++};v("x"),v("y")},Zx.prototype.saveGuides=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel);t.projectVO.transformGuides=v(this.transformGuideData),t.projectVO.transformGuidesLocked=this.guidesLocked;var n=e;BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage&&(n=!1),n&&BFN.ProjectManager.requestLocalSave()},Zx.prototype.updateVisibility=function(){var e=!0===UITools.getToolValue("alignment","guides"),t=BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&!BFN.TransformItemIsolator.isolatedTransformItem&&(!BFN.AppModel.viewingEditor||BFN.AppModel.viewingEditor&&BFN.PhotoEditorModel.currentTexture);this.visible=this.guideLinesContainer.visible=e&&t,BFN.MainUI&&(this.updateGuideBarDisplay(),this.updateDisplay(!0),BFN.MainUI.requestRender())},Zx.prototype.updateColors=function(){this.guideBarTexture.fillColor(this._colors[this._colorMode].guide_bar),this.guideLockButton.fillColor=this._colors[this._colorMode].lock,this.guideClearButton.fillColor=this._colors[this._colorMode].clear,this.drawGuideRulerMarks(),this.guideMarkerTexture&&this.guideMarkerTexture.copyPixels(this.guideMarkerTextures[this._colorMode]),BFN.MainUI.requestRender()},Zx.prototype.updateGuideLockDisplay=function(){this.guideLockButton.texture=this.guidesLocked?this.guideLockTextureLocked:this.guideLockTextureUnlocked,this.guideMarkersContainer.visible=!this.guidesLocked,this.guideMarkersContainer.interactiveChildren=!this.guidesLocked,this.guideBarLeft.buttonMode=this.guideBarTop.buttonMode=!this.guidesLocked,BFN.MainUI&&BFN.MainUI.requestRender()},Zx.prototype.updateTooltip=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getTooltipString(this.activeGuide);this.guideDragger.dragging?BFN.TooltipScreen.active?BFN.TooltipScreen.setMessage(n,!1,!0):(BFN.TooltipScreen.show(n,!0,!0),BFN.TooltipScreen.setPosition(e,t,!1,!0,!0)):this.guideDragger.dragging||BFN.TooltipScreen.hide()},Zx.prototype.getTooltipString=function(e){var t="n/a";if(e){var n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,i=0,r=0;switch(e.axis){case"x":i=e.value+n.frameWidth/2,r=n.frameWidth-i,t="◄ ".concat((Math.round(10*i)/10).toFixed(1),"px | ").concat((Math.round(10*r)/10).toFixed(1),"px ►");break;case"y":i=e.value+n.frameHeight/2,r=n.frameHeight-i,t="▲ ".concat((Math.round(10*i)/10).toFixed(1),"px | ").concat((Math.round(10*r)/10).toFixed(1)," px ▼")}}return t},Zx.prototype.generateSnapData=function(){var e=this;this.snapData.splice(0),BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer.children.forEach(function(t){var n,i;if("group"!==t.type){var r=BFN.Util.getTransformItemBounds(t),a=new BFN.Rectangle(r.minX+t.accurateBounds.minX,r.minY+t.accurateBounds.minY,t.accurateBounds.width,t.accurateBounds.height);switch(e.activeGuide.axis){case"x":(n=e.snapData).push.apply(n,[{item:t,value:a.left},{item:t,value:a.right}]);break;case"y":(i=e.snapData).push.apply(i,[{item:t,value:a.top},{item:t,value:a.bottom}])}}})},Zx.prototype.processSnapData=function(){var e=this,t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,n=Math.round(t.toLocal(new PIXI.Point(this.guideDragger.draggedX,this.guideDragger.draggedY),this)[this.activeGuide.axis]);this.snapValue=null;var i=[];if(BFN.TransformModel.snappingEnabled&&this.snapData.length){var r=this.snapDistance/t.canvasScale,a=r,o=null;this.snapData.forEach(function(e){var t=e.value,i=Math.abs(t-n);i<r&&i<=a&&(a=i,o=t)}),null!==o&&(this.snapValue=n=o,this.snapData.forEach(function(e){if(!i.includes(e.item)){var t=e.value;Math.abs(t-o)<=.5&&i.push(e.item)}}))}if(i){for(var s=this.snappedItems.length;--s>-1;){var l=this.snappedItems[s];i.includes(l)||(l.hoverDropAnimator.decrease(),this.snappedItems.splice(s,1))}i.forEach(function(t){!e.snappedItems.includes(t)&&t.hoverDropAnimator&&(t.hoverDropAnimator.increase(),e.snappedItems.push(t))})}else this.snappedItems.forEach(function(e){e.hoverDropAnimator.decrease()}),this.snappedItems.splice(0);return n},Zx.prototype.createGuideBar=function(e,t,n){var i=new PIXI.Sprite(this.guideBarTexture);return i.interactive=!0,i.buttonMode=!0,i.axis=e,i.x=t,i.y=n,i.on("pointerdown",this.handleGuideBarPress.bind(this)),i.on("pointerout",this.handleGuideMarkerOutBind),i},Zx.prototype.getGuideMarkerTexture=function(){var e=this;if(!this.guideMarkerTexture){var t={dark:.7,light:.85},n=this.guideBarThickness,i=Math.round(.5*this.guideBarThickness);i+=i%2?0:1;var r=function(r){var a=PIXI.RenderTexture.create(n,i),o=new PIXI.Graphics,s=Math.floor(i/4)+1;o.lineStyle(1.5,e._colors[r].marker_stroke,t[r],0),o.beginFill(e._colors[r].marker_fill),o.moveTo(0,0),o.lineTo(Math.round(.8*e.guideBarThickness)-1,0),o.lineTo(e.guideBarThickness-1,s),o.lineTo(Math.round(.8*e.guideBarThickness)-1,Math.round(i/2)),o.lineTo(0,Math.round(i/2)),o.lineTo(0,0),o.endFill();var l=o.generateCanvasTexture();return a.copyPixels(l,{x:(a.width-l.width)/2,y:(a.height-l.height)/2}),o.clear(),a};this.guideMarkerTextures={dark:r("dark"),light:r("light")},this.guideMarkerTexture=PIXI.RenderTexture.create(n,i),this.guideMarkerTexture.copyPixels(this.guideMarkerTextures[this._colorMode])}return this.guideMarkerTexture},Zx.prototype.getGuideLineTexture=function(){if(!this.guideLineTexture){var e=new PIXI.Graphics;e.moveTo(0,0);for(var t=0;t<=4096;t+=4){var n=t%8?15592941:4145484;e.lineStyle(3,n,.8,0),e.lineTo(t,0)}this.guideLineTexture=PIXI.RenderTexture.create(4096,1),BFN.Stage.render(e,this.guideLineTexture),e.clear()}return this.guideLineTexture},Zx.prototype.createGuide=function(e){if(!this.guides.hasOwnProperty(e.id)){var t={id:e.id,axis:e.axis,perpendicularAxis:"x"===e.axis?"y":"x",value:e.value};this.guides[e.id]=t,t.marker=new PIXI.Sprite(this.getGuideMarkerTexture()),t.marker.interactive=!0,t.marker.buttonMode=!0,t.marker.anchor.x=t.marker.anchor.y=.5,t.marker.x=t.marker.y=Math.round(this.guideBarThickness/2+2),t.marker.rotation="x"===e.axis?Math.PI/2:0,t.marker.guide=t,t.marker.on("pointerdown",this.handleGuideMarkerPressBind),t.marker.on("pointerover",this.handleGuideMarkerOverBind),t.marker.on("pointerout",this.handleGuideMarkerOutBind),this.guideMarkersContainer.addChild(t.marker),t.line=new PIXI.Sprite(this.getGuideLineTexture()),t.line.interactive=!1,t.line.anchor.x=t.line.anchor.y=.5,t.line.rotation="x"===e.axis?Math.PI/2:0,t.line.guide=e,this.guideLinesContainer.addChild(t.line)}},Zx.prototype.destroyGuide=function(e){if(this.guides.hasOwnProperty(e)){var t=this.guides[e];for(var n in this.guideMarkersContainer.children.includes(t.marker)&&this.guideMarkersContainer.removeChild(t.marker),t.marker.off("pointerdown",this.handleGuideMarkerPressBind),t.marker.off("pointerover",this.handleGuideMarkerOverBind),t.marker.off("pointerout",this.handleGuideMarkerOutBind),t.marker.destroy(!1),this.guideLinesContainer.children.includes(t.line)&&this.guideLinesContainer.removeChild(t.line),t.line.destroy(!1),t)delete t[n];delete this.guides[e]}},Zx.prototype.handleAppViewstateUpdated=function(e){BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformGuidesContainer.addChild(this.guideLinesContainer);var t=!0;BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage&&(t=!1);var n=BFN.AppModel.sectionValue(BFN.PhotoEditorModel,BFN.CollageMakerModel,BFN.DesignerModel);t?this.setTransformGuideData(n.projectVO.transformGuides,n.projectVO.transformGuidesLocked):this.setTransformGuideData(),this.updateVisibility()},Zx.prototype.handleStageDimensionsUpdated=function(e){var t=this;setTimeout(function(){t.updateGuideBarDisplay(),t.updateDisplay()},0)},Zx.prototype.handlePhotoEditorCanvasViewstateUpdated=function(e){this.updateVisibility()},Zx.prototype.handleGuideBarPress=function(e){if(this.guideBarAvailable){var t=e.target,n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,i=t.axis,r=Math.round(n.getPointerPosition(e)[t.axis]);if(2===e.data.originalEvent.button)return this.guidesLocked?(this.contextMenu.hideButton("add_guide"),this.contextMenu.showButton("unlock_guides"),this.contextMenu.hideButton("lock_guides")):(this.contextMenu.showButton("add_guide"),this.contextMenu.showButton("lock_guides"),this.contextMenu.hideButton("unlock_guides")),this.contextMenu.hideButton("remove_guide"),this.transformGuideData.length?this.contextMenu.showButton("clear_guides"):this.contextMenu.hideButton("clear_guides"),this.contextMenu.show(e.data.originalEvent.pageX,e.data.originalEvent.pageY),this.pressedAxis=i,this.pressedValue=r,void e.stopPropagation();if(this.guidesLocked)e.stopPropagation();else{var a=this.addGuide(i,r);this.guides.hasOwnProperty(a.id)&&(this.activeGuide=this.guides[a.id],this.guideBarAvailable=!1,this.guideDragger.drag(this.activeGuide.marker),this.generateSnapData(),this.activeGuide.value=this.processSnapData(),this.updateGuidePosition(this.activeGuide.id),this.updateTooltip(e.data.originalEvent.pageX,e.data.originalEvent.pageY))}}},Zx.prototype.handleGuideMarkerPress=function(e){var t=this;if(this.guideBarAvailable){var n=e.target,i=function(){t.contextMenu.showButton("remove_guide"),t.contextMenu.hideButton("add_guide"),t.contextMenu.hideButton("clear_guides"),t.contextMenu.hideButton("lock_guides"),t.contextMenu.hideButton("unlock_guides"),t.contextMenu.show(e.data.originalEvent.pageX,e.data.originalEvent.pageY),t.pressedID=n.guide.id};if(2===e.data.originalEvent.button)return i(),void e.stopPropagation();this.activeGuide=n.guide,this.guideBarAvailable=!1,this.guideDragger.drag(this.activeGuide.marker),this.generateSnapData(),this.activeGuide.value=this.processSnapData(),this.processSnapData(),this.updateGuidePosition(this.activeGuide.id),this.updateTooltip(e.data.originalEvent.pageX,e.data.originalEvent.pageY),e.stopPropagation(),BFN.MainUIEvents.MOUSE_DOWN.data={canvasPressed:!0,originalEvent:e.data.originalEvent},BFN.MainUI.dispatchEvent(BFN.MainUIEvents.MOUSE_DOWN),BFN.LongPressManager.initiateLongPress(function(){t.guideDragger.stopDrag(),BFN.preventSelectionDrag=!0,i()})}},Zx.prototype.handleGuideMarkerOver=function(e){var t=this;if(!this.guideDragger.dragging&&this.guideMarkersContainer.children.includes(e.target)){var n=e.target;this.guideMarkersContainer.addChild(n),BFN.MainUI.requestRender(),setTimeout(function(){var i=t.getTooltipString(n.guide);BFN.TooltipScreen.show(i,!0,!0),BFN.TooltipScreen.setPosition(e.data.originalEvent.pageX,e.data.originalEvent.pageY,!1,!0,!0),BFN.MainUI.requestRender()},0)}},Zx.prototype.handleGuideMarkerOut=function(e){this.guideDragger.dragging||BFN.TooltipScreen.hide()},Zx.prototype.handleGuideDraggerDragging=function(e){var t=this;if(this.activeGuide){var n=this.processSnapData(),i=this.transformGuideData.find(function(e){return e.id===t.activeGuide.id});i&&(i.value=n),this.activeGuide.value=n,this.updateGuidePosition(this.activeGuide.id),this.updateTooltip()}},Zx.prototype.handleGuideDraggerDraggingComplete=function(e){var t=this,n=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer,i=this.activeGuide?this.snapValue||Math.round(n.toLocal(new PIXI.Point(this.guideDragger.draggedX,this.guideDragger.draggedY),this)[this.activeGuide.axis]):null,r=this.activeGuide?this.transformGuideData.find(function(e){return e.id===t.activeGuide.id}):null;r&&(r.value=i),this.activeGuide&&null!==i&&(this.activeGuide.value=i,this.activeGuide=null);var a=r?this.transformGuideData.find(function(e){return e.axis===r.axis&&e.value===r.value&&r.id!==e.id}):null;a?(this.transformGuideData.splice(this.transformGuideData.indexOf(a),1),this.updateDisplay(!0)):this.updateDisplay(),this.snapData.splice(0),this.snapValue=null,this.snappedItems.length&&(this.snappedItems.forEach(function(e){e.hoverDropAnimator.decrease()}),this.snappedItems.splice(0)),this.saveGuides(),this.updateTooltip(),setTimeout(function(){t.guideBarAvailable=!0},200)},Object.defineProperty(Zx.prototype,"colorMode",{set:function(e){this._colors.hasOwnProperty(e)&&(this._colorMode=e,this.updateColors())},get:function(){return this._colorMode}}),BFN.SingletonQueue.add(function(){BFN.TransformGuides=new Zx}),Jx.prototype=Object.create(PIXI.Sprite.prototype),Jx.prototype.init=function(){BeFunky.log("PhotoEditorCanvasImage Init"),this.initDefaultValues()},Jx.prototype.initDefaultValues=function(){this.interactive=!0},Object.defineProperty(Jx.prototype,"imageWidth",{get:function(){try{return this.texture.width}catch(e){return 0}}}),Object.defineProperty(Jx.prototype,"imageHeight",{get:function(){try{return this.texture.height}catch(e){return 0}}}),BFN.SingletonQueue.add(function(){BFN.PhotoEditorCanvasImage=new Jx}),BFN.PhotoEditorCanvasToolsEvents={TOOL_OVER:new Event("TOOL_OVER"),TOOL_OUT:new Event("TOOL_OUT"),START_CANVAS_DRAG:new Event("START_CANVAS_DRAG"),TOOL_DIMENSIONS_UPDATED:new Event("TOOL_DIMENSIONS_UPDATED")},$x.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),$x.prototype.init=function(){BeFunky.log("PhotoEditorCanvasTools Init"),this.initDefaultValues(),this.initToolMap(),this.initToolContainer(),this.initPremiumWatermark()},$x.prototype.initDefaultValues=function(){this._scale=1,this._scaling=!1,this.tools=[],this.currentTool=null,this.altSourceTexture=null,this.fitAfterApply=!1,this.toolPressed=!1,this.handleToolOverBind=this.handleToolOver.bind(this),this.handleToolOutBind=this.handleToolOut.bind(this),this.handleToolPressedBind=this.handleToolPressed.bind(this),this.handleToolReleasedBind=this.handleToolReleased.bind(this),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasViewStateUpdated.bind(this)),this.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED.type,this.handleToolDimensionsUpdated.bind(this))},$x.prototype.initToolMap=function(){this.toolMap={},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP]={id:"touchup",init:this.initTouchUp.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT]={id:"effect",init:this.initEffect.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY]={id:"artsy",init:this.initArtsy.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER]={id:"border",init:this.initBorder.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW]={id:"dropShadow",init:this.initDropShadow.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME]={id:"frame",init:this.initFrame.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE]={id:"texture",init:this.initTexture.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY]={id:"overlay",init:this.initOverlay.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE]={id:"flare",init:this.initLensFlare.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP]={id:"crop",init:this.initCrop.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE]={id:"rotator",init:this.initRotator.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE]={id:"resizer",init:this.initResizer.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING]={id:"slimming",init:this.initSlimming.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE]={id:"reshape",init:this.initReshape.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT]={id:"tilter",init:this.initTilter.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS]={id:"focus",init:this.initFocus.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE]={id:"vignette",init:this.initVignette.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH]={id:"paintBrush",init:this.initPaintBrush.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE]={id:"clone",init:this.initClone.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX]={id:"blemish",init:this.initBlemish.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND]={id:"background",init:this.initBackground.bind(this)},this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT]={id:"cutout",init:this.initCutout.bind(this)},BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING&&(this.toolMap[BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING]={id:"matting",init:this.initMatting.bind(this)})};$x.prototype.initToolContainer=function(){this.toolContainer=new PIXI.Container,this.addChild(this.toolContainer)},$x.prototype.initTouchUp=function(){this.touchup=BFN.ImageTouchUp,this.touchup.interactive=!0,this.tools.push(this.touchup),this.toolContainer.addChild(this.touchup)},$x.prototype.initEffect=function(){this.effect=BFN.ImageEffect,this.effect.interactive=!0,this.effect.toolScale=this._scale,this.tools.push(this.effect),this.toolContainer.addChild(this.effect)},$x.prototype.initArtsy=function(){this.artsy=BFN.ImageArtsy,this.artsy.interactive=!0,this.tools.push(this.artsy),this.toolContainer.addChild(this.artsy)},$x.prototype.initBorder=function(){this.border=BFN.ImageBorder,this.border.interactive=!0,this.tools.push(this.border),this.toolContainer.addChild(this.border)},$x.prototype.initDropShadow=function(){this.dropShadow=BFN.ImageDropShadow,this.dropShadow.interactive=!0,this.tools.push(this.dropShadow),this.toolContainer.addChild(this.dropShadow)},$x.prototype.initFrame=function(){this.frame=BFN.ImageFrame,this.frame.interactive=!0,this.tools.push(this.frame),this.toolContainer.addChild(this.frame)},$x.prototype.initTexture=function(){this.texture=BFN.ImageTexture,this.texture.interactive=!0,this.tools.push(this.texture),this.toolContainer.addChild(this.texture)},$x.prototype.initOverlay=function(){this.overlay=BFN.ImageOverlay,this.tools.push(this.overlay),this.toolContainer.addChild(this.overlay)},$x.prototype.initLensFlare=function(){this.flare=BFN.ImageLensFlare,this.tools.push(this.flare),this.toolContainer.addChild(this.flare)},$x.prototype.initCrop=function(){this.crop=BFN.ImageCrop,this.tools.push(this.crop),this.toolContainer.addChild(this.crop)},$x.prototype.initRotator=function(){this.rotator=BFN.ImageRotator,this.rotator.interactive=!0,this.tools.push(this.rotator),this.toolContainer.addChild(this.rotator)},$x.prototype.initResizer=function(){this.resizer=BFN.ImageResize,this.resizer.interactive=!0,this.tools.push(this.resizer),this.toolContainer.addChild(this.resizer)},$x.prototype.initSlimming=function(){this.slimming=BFN.ImageSlimming,this.slimming.interactive=!0,this.tools.push(this.slimming),this.toolContainer.addChild(this.slimming)},$x.prototype.initReshape=function(){this.reshape=BFN.ImageReshape,this.reshape.interactive=!0,this.tools.push(this.reshape),this.toolContainer.addChild(this.reshape)},$x.prototype.initTilter=function(){this.tilter=BFN.ImageTilter,this.tilter.interactive=!0,this.tools.push(this.tilter),this.toolContainer.addChild(this.tilter)},$x.prototype.initFocus=function(){this.focus=BFN.ImageFocus,this.tools.push(this.focus),this.toolContainer.addChild(this.focus)},$x.prototype.initVignette=function(){this.vignette=BFN.ImageVignette,this.tools.push(this.vignette),this.toolContainer.addChild(this.vignette)},$x.prototype.initPaintBrush=function(){this.paintBrush=BFN.ImagePaintBrush,this.tools.push(this.paintBrush),this.toolContainer.addChild(this.paintBrush)},$x.prototype.initClone=function(){this.clone=BFN.ImageClone,this.tools.push(this.clone),this.toolContainer.addChild(this.clone)},$x.prototype.initBlemish=function(){this.blemish=BFN.ImageBlemish,this.tools.push(this.blemish),this.toolContainer.addChild(this.blemish)},$x.prototype.initBackground=function(){this.background=BFN.ImageBackground,this.tools.push(this.background),this.toolContainer.addChild(this.background)},$x.prototype.initMatting=function(){this.matting=BFN.ImageMatting,this.tools.push(this.matting),this.toolContainer.addChild(this.matting)},$x.prototype.initCutout=function(){this.cutout=BFN.ImageCutout,this.tools.push(this.cutout),this.toolContainer.addChild(this.cutout)},$x.prototype.initPremiumWatermark=function(){this.premiumWatermark=BFN.PremiumWatermark,this.addChild(this.premiumWatermark)},$x.prototype.handleEditorApplyCancel=function(){if(BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS){var e=!BFN.applyCancelMenu.alternateApply&&!BFN.PhotoEditorCanvas.canvasToolsContainer.children.includes(BFN.PhotoEditorCanvas.canvasTools)&&!BFN.TransformItemIsolator.active,t=BFN.TransformItemIsolator.active||BFN.TransformModel.layerItem,n=this.currentTool?this.currentTool.hasOwnProperty("adjustScale")?this.currentTool.adjustScale:this.currentTool.scale.x:1,i=!1;if("apply"===UITools.getToolValue("editor_apply_cancel","updating_id")){if(!BFN.applyCancelMenu.upgradeMode&&BFN.applyCancelMenu.alternateApply){switch(BFN.PhotoEditorCanvasModel.viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT:BFN.ImageCutout.showCutoutOptionsModal()}return}i=this.applyCurrentTool()}else this.fitAfterApply=!1;if(BFN.ColorPickerPanel.colorButton&&(BFN.ColorPickerPanel.colorButton=null),t||(BFN.PhotoEditorCanvasModel.viewState=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,BFN.PhotoEditorCanvas.updateCanvasImage()),this.fitAfterApply){var r=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),a=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED,BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME_ANIMATED,BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME_ANIMATED);1!=n&&(r.canvasScaling=!0,r.canvasScale*=n,r.canvasScaling=!1),r.dispatchEvent(a)}t?requestAnimationFrame(function(){if(BFN.TransformItemIsolator.usingAlternateMenu){var t=document.getElementById("layer_isolator_tool_menu").querySelector("tabbed-layout");t&&t.activeTab===t.tabNames[1]&&(t.activeTab="")}e&&BFN.PhotoEditorCanvas.canvasToolsContainer.addChild(BFN.PhotoEditorCanvas.canvasTools),BFN.PhotoEditorCanvasModel.viewState=BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,BFN.TransformItemIsolator.usingAlternateMenu&&(UIToggler.toggleAlternateMenu(!1),BFN.TransformModel.layerItem=null,BFN.TransformItemIsolator.releaseTransformItem(i))}):e&&BFN.PhotoEditorCanvas.canvasToolsContainer.addChild(BFN.PhotoEditorCanvas.canvasTools)}},$x.prototype.applyCurrentTool=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_UPGRADE",n=this.premiumWatermark.showing&&!BFN.ImageEditManager.editingImage;if(this.fitAfterApply=!1,this.currentTool){BFN.TransformModel.layerItem||BFN.TransformItemIsolator.active||n||BFN.PhotoEditorModel.updateCurrentTexture(this.currentTool.modifiedTexture);var i,r="image_updated",a=null,o=null,s=Date.now(),l={};switch(this.currentTool){case this.touchup:r=null!=BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("toolID")?BFN.EffectManager.parameters.toolID:BFN.EffectManager.effectID,l.hasParameters=!!BFN.EffectManager.parameters,l.hasParameters&&(l.toolID=BFN.EffectManager.parameters.toolID),l.effectID=BFN.EffectManager.effectID,"perfectskin"===r&&(r="skin_heal");var u="TOUCHUP";switch(r){case"fix_redeye":u="REDEYE";break;case"flashspot":u="FLASHSPOT_FIXER";break;case"blemish_fix":u="BLEMISH";break;case"clone":u="CLONE";break;case"eye_color":u="EYECOLOR";break;case"lipstick":u="LIPSTICK";break;case"bronzer":u="BRONZER";break;case"blush":u="BLUSH";break;case"wrinkles":u="WRINKLE_REMOVER";break;case"teeth_whiten":u="TEETH_WHITEN";break;case"eye_brighten":u="EYE_BRIGHTEN";break;case"eyebrow_pencil":u="EYEBROW_PENCIL";break;case"mascara":u="MASCARA";break;case"hair_color":u="HAIR_COLOR";break;case"perfectskin":case"skin_heal":u="PERFECT_SKIN"}n?BFN.BfnService.upgrade(e||"TOUCHUP",u+t,"touchup"):BFN.BfnService.track("CREATE","BASIC",u);break;case this.effect:if(r=BFN.EffectManager.effectID&&BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("effectName")?BFN.EffectManager.parameters.effectName:BFN.EffectManager.effectID,l.hasParameters=!!BFN.EffectManager.parameters,l.hasParameters&&(l.effectName=BFN.EffectManager.parameters.effectName),l.effectID=BFN.EffectManager.effectID,null!=BFN.EffectManager.parameters&&BFN.EffectManager.parameters.hasOwnProperty("toolID"))try{var c="",h=BFN.effectPresetMap[BFN.EffectManager.parameters.toolID]?"photo_effects":BFN.EffectManager.parameters.toolID;BFN.UIToolData.hasOwnProperty(BFN.EffectManager.parameters.toolID)?(c=BFN.EffectManager.parameters.toolID.toUpperCase(),o=BFN.EffectManager.parameters.toolID):(c=BFN.EffectManager.parameters.toolID.split("_").slice(1).join("_").toUpperCase(),o=BFN.EffectManager.parameters.toolID),n?BFN.BfnService.upgrade(e||"BASIC_EFFECTS",c+t,h):BFN.BfnService.track("CREATE","BASIC_EFFECTS",c)}catch(e){}break;case this.artsy:if(r="artsy",o=BFN.ImageArtsy.currentToolID?BFN.ImageArtsy.currentToolID:null,BFN.ImageArtsy.currentToolID)if(BFN.ArtsyPresetObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID]&&BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name)r=BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].name;else if(BFN.ArtsyAdjustAndPaintToolObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)){var d=BFN.ImageArtsy.currentToolID;r=BFN.ArtsyAdjustAndPaintToolObjects[d].name||d,o=d}if(void 0!==BFN.ImageArtsy.currentToolID&&null!=BFN.ImageArtsy.currentToolID){var m=BFN.ArtsyPresetObjects.hasOwnProperty(BFN.ImageArtsy.currentToolID)?BFN.ArtsyPresetObjects[BFN.ImageArtsy.currentToolID].isArtsy?"artsy":"enhance_dlx":void 0;n?BFN.BfnService.upgrade(e||"EFFECTS",BFN.ImageArtsy.currentToolID.toUpperCase()+t,m):BFN.BfnService.track("CREATE","EFFECTS",BFN.ImageArtsy.currentToolID.toUpperCase())}break;case this.border:r="border",this.fitAfterApply=!0,BFN.BfnService.track("CREATE","FRAMES","BORDER");break;case this.dropShadow:r="drop_shadow",this.fitAfterApply=!0,BFN.BfnService.track("CREATE","FRAMES","DROP_SHADOW");break;case this.frame:r=BFN.ImageFrame.currentFrameName,o=BFN.ImageFrame.currentFrameID?BFN.ImageFrame.currentFrameID:null,this.fitAfterApply=!0;try{var p=BFN.ImageFrame.currentFrameID.split("_").slice(2).join("_").toUpperCase();n?BFN.BfnService.upgrade(e||"FRAMES",p+t,"frames"):BFN.BfnService.track("CREATE","FRAMES","FRAMES_".concat(p))}catch(e){}break;case this.texture:r=BFN.ImageTexture.currentTextureName,o=BFN.ImageTexture.currentTextureID?BFN.ImageTexture.currentTextureID:null;try{var g=BFN.ImageTexture.currentTextureID.split("_").slice(1).join("_").toUpperCase();n?BFN.BfnService.upgrade(e||"TEXTURE",g+t,"texture"):BFN.BfnService.track("CREATE","TEXTURE",g)}catch(e){}break;case this.overlay:r=BFN.ImageOverlay.currentOverlayName,i=BFN.ImageOverlay.currentOverlayLang,o=BFN.ImageOverlay.currentOverlayID?BFN.ImageOverlay.currentOverlayID:null;try{var f=BFN.ImageOverlay.currentOverlayID.split("_").slice(1).join("_").toUpperCase();n?BFN.BfnService.upgrade(e||"OVERLAY",f+t,"template"):BFN.BfnService.track("CREATE","OVERLAY",f)}catch(e){}break;case this.flare:r=BFN.ImageLensFlare.currentPresetName,o=BFN.ImageLensFlare.currentPresetID?BFN.ImageLensFlare.currentPresetID:null;try{var y=BFN.ImageLensFlare.currentPresetID.replace(" ","_").toUpperCase();n?BFN.BfnService.upgrade(e||"LENS_FLARE",y+t,"lens_flares"):BFN.BfnService.track("CREATE","LENS_FLARE",y)}catch(e){}break;case this.crop:BFN.BfnService.track("CREATE","BASIC","CROP"),r="crop",a=new PIXI.Point(this.crop.cropOffsetLeft,this.crop.cropOffsetTop),this.fitAfterApply=!0;break;case this.rotator:BFN.BfnService.track("CREATE","BASIC","ROTATE"),r="rotate",this.fitAfterApply=!0;break;case this.resizer:BFN.BfnService.track("CREATE","BASIC","RESIZE"),r="resize",this.fitAfterApply=!0;break;case this.slimming:n?BFN.BfnService.upgrade(e||"TOUCHUP","SLIMMING".concat(t),"touchup"):BFN.BfnService.track("CREATE","BASIC","WEIGHT_LOSS"),r="slimming";break;case this.reshape:n?BFN.BfnService.upgrade(e||"RESHAPE","RESHAPE".concat(t),"reshape"):BFN.BfnService.track("CREATE","BASIC","RESHAPE"),r="reshape";break;case this.tilter:BFN.BfnService.track("CREATE","BASIC","TILT"),r="tilt",this.fitAfterApply=!0;break;case this.focus:n?BFN.BfnService.upgrade(e||"EDIT","FUNKY_FOCUS".concat(t),"funky_focus"):BFN.BfnService.track("CREATE","BASIC","FUNKYFOCUS"),r="funky_focus";break;case this.vignette:n?BFN.BfnService.upgrade(e||"EDIT","VIGNETTE".concat(t),"vignette"):BFN.BfnService.track("CREATE","BASIC","VIGNETTE"),r="vignette";break;case this.paintBrush:BFN.BfnService.track("CREATE","BASIC","PAINT_BRUSH"),r="paint_brush";break;case this.clone:n?BFN.BfnService.upgrade(e||"TOUCHUP","CLONE".concat(t),"clone"):BFN.BfnService.track("CREATE","BASIC","CLONE"),r="clone";break;case this.blemish:BFN.BfnService.track("CREATE","BASIC","BLEMISH"),r="blemish_fix";break;case this.background:n?BFN.BfnService.upgrade(e||"EDIT","BACKGROUND".concat(t),"background"):BFN.BfnService.track("CREATE","BASIC","BACKGROUND"),r="background";break;case this.matting:n?BFN.BfnService.upgrade(e||"EDIT","MATTING".concat(t),"matting"):BFN.BfnService.track("CREATE","BASIC","MATTING"),r="matting";break;case this.cutout:n?BFN.BfnService.upgrade(e||"EDIT","CUTOUT".concat(t),"cutout"):BFN.BfnService.track("CREATE","BASIC","CUTOUT"),r="cutout"}r||(BeFunky.throwError("Missing historyTag",BFN.PhotoEditorCanvasModel.viewState,JSON.stringify(l)),r="image_updated"),o||(o=r);var x,_=BFN.UserActionManager.getEditorToolObject(o);if(_.imageLayer=!1,n){var I=[_.toolType,_.toolName];return _.toolSearchID&&I.push(_.toolSearchID),BFN.UserActionManager.addUpgradeAction(I),!1}if(BFN.TransformModel.layerItem&&BFN.TransformItemIsolator.active){if(!["texture","frame_texture"].includes(BFN.TransformModel.layerItem.type))return!1;var T=BFN.TransformItemIsolator.isolatedTransformItem,b=BFN.TransformItemIsolator.itemTexture,S=this.currentTool.sourceTexture,C=this.currentTool.modifiedTexture,B=new BFN.Rectangle((S.width-C.width)/2,(S.height-C.height)/2,C.width,C.height);switch(this.currentTool){case this.crop:B=this.crop.cropRect;break;case this.cutout:this.cutout.trimTransparency&&(B=this.cutout.cutoutRect)}if(!B)return!1;C.rotate="texture"===T.type?0:[0,12,8,4][T.flippedHorizontal+2*T.flippedVertical];var F=C.renderClone();C.copyPixels(F),F.destroyGC(!0),BFN.TransformItemIsolator.usingAlternateMenu&&(this.fitAfterApply=!1,C.width>b.width||C.height>b.height?(b.resize(C.width,C.height),b.copyPixels(C)):b.copyPixels(C,{x:B.x,y:B.y}));var E=BFN.ImageLibraryManager.createMenuImageVOFromTexture(C,null,!1).id;switch(T.type){case"texture":var P=T.itemContentW*T.scale.x,k=T.itemContentH*T.scale.y,N=P*(B.x/S.width),M=k*(B.y/S.height),D=Math.sqrt(Math.pow(N,2)+Math.pow(M,2)),w=Math.atan2(M,N)+T.rotation,L={x:Math.cos(w)*D,y:Math.sin(w)*D};T.replaceImage(E,C,r,L.x,L.y);break;case"frame_texture":var O=T.itemContent,R=O.frameWidth*(B.x/S.width),A=O.frameHeight*(B.y/S.height),V=Math.sqrt(Math.pow(R,2)+Math.pow(A,2)),U=Math.atan2(A,R)+T.rotation,G={x:Math.cos(U)*V,y:Math.sin(U)*V},H={frameWidth:O.frameWidth*(C.width/S.width),frameHeight:O.frameHeight*(C.height/S.height)},z=Math.max(H.frameWidth/C.width,H.frameHeight/C.height),j=C.width*z,X=C.height*z;H.textureScaleX=H.frameWidth/j,H.textureScaleY=H.frameHeight/X,T.replaceImage(E,C,r,G.x,G.y,!1,H,!0)}C.baseTexture.imageOffset={x:-C.width/2-(B.x-S.width/2),y:-C.height/2-(B.y-S.height/2)},T.transitionVO&&(s=T.transitionVO.timestamp),_.imageLayer=!0,BFN.TransformItemIsolator.imageLayerEdited=!0}else BFN.AppModel.viewingEditor&&(s=BFN.PhotoEditorHistoryModel.addTextureToHistory(r,BFN.PhotoEditorModel.currentTexture),a&&(BFN.PhotoEditorCanvasModel.itemOffsetPoint=a));if(Array.isArray(i))UIMessages.display("".concat((x=BeFunky.LanguageManager).getStringReplacements.apply(x,v(i))," ").concat(BeFunky.LanguageManager.getString("applied")));else UIMessages.display("".concat(BeFunky.LanguageManager.getString(i||r)," ").concat(BeFunky.LanguageManager.getString("applied")));var W=new BFN.UserActionVO;return W.eventID="editing_applied",W.eventObject=_,W.actionSection=BFN.AppModel.sectionValue("editor","collage","designer"),W.actionTimestamp=s,W.register(),!0}},$x.prototype.updateToolView=function(){var e=!1;!this.altSourceTexture&&BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.altSourceTexture&&(this.altSourceTexture=BFN.TransformItemIsolator.altSourceTexture,e=!0);var t=this.altSourceTexture?this.altSourceTexture:BFN.PhotoEditorModel.currentTexture;if(e&&(this.altSourceTexture=null),this.toolMap.hasOwnProperty(BFN.PhotoEditorCanvasModel.viewState)){var n=this.toolMap[BFN.PhotoEditorCanvasModel.viewState];this.hasOwnProperty(n.id)||n.init()}for(var i in BFN.applyCancelMenu.alternateApply=!1,this.toolMap){var r=this.toolMap[i];if(this.hasOwnProperty(r.id)){var a=this[r.id];a.visible=BFN.PhotoEditorCanvasModel.viewState===i,a.setSourceTexture(a.visible&&null!=t?t:null)}}this.updateToolScales(),this.currentTool&&(this.currentTool.off("pointerover",this.handleToolOverBind),this.currentTool.off("pointerout",this.handleToolOutBind),this.currentTool.off("pointerdown",this.handleToolPressedBind)),this.currentTool=null;for(var o=0;o<this.tools.length;o++){var s=this.tools[o];s.visible&&(this.currentTool=s)}if(this.currentTool)this.currentTool.interactive&&(this.currentTool.on("pointerover",this.handleToolOverBind),this.currentTool.on("pointerout",this.handleToolOutBind),this.currentTool.on("pointerdown",this.handleToolPressedBind)),this.updatePremiumWatermarkDimensions();else{this.premiumWatermark.currentToolID=null,this.premiumWatermark.updateDisplay(),BFN.ImagePainterUndoManager.reset();try{BFN.FilterHelper.emptyPoolForFilter()}catch(e){}}var l=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel),u=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED,BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME_ANIMATED,BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME_ANIMATED);switch(this.currentTool){case this.border:case this.dropShadow:case this.frame:case this.overlay:case this.flare:case this.crop:case this.rotator:case this.resizer:case this.slimming:case this.tilter:case this.focus:case this.vignette:l.dispatchEvent(u);break;default:this.altSourceTexture&&l.dispatchEvent(u)}BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.currentTool||setTimeout(function(){BFN.MainUI.renderCanvas(),setTimeout(function(){BFN.MainUI.renderCanvas()},BFN.frameInterval)},BFN.frameInterval)},$x.prototype.updateToolScales=function(){switch(this.premiumWatermark.canvasScale=this._scale,this.effect&&(this.effect.toolScale=this._scale),BFN.PhotoEditorCanvasModel.viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TOUCH_UP:this.touchup.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_EFFECT:this.effect.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ARTSY:this.artsy.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER:this.border.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW:this.dropShadow.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME:this.frame.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TEXTURE:this.texture.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_OVERLAY:this.overlay.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_LENS_FLARE:this.flare.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CROP:this.crop.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE:this.rotator.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE:this.resizer.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING:this.slimming.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESHAPE:this.reshape.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT:this.tilter.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_FOCUS:this.focus.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_VIGNETTE:this.vignette.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_PAINT_BRUSH:this.paintBrush.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CLONE:this.clone.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_BLEMISH_FIX:this.blemish.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_BACKGROUND:this.background.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING:this.matting.toolScale=this._scale;break;case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CUTOUT:this.cutout.toolScale=this._scale}},$x.prototype.updatePremiumWatermarkDimensions=function(){if(this.currentTool){var e=0,t=0;this.currentTool.hasOwnProperty("itemWidth")&&this.currentTool.hasOwnProperty("itemHeight")?(e=this.currentTool.itemWidth,t=this.currentTool.itemHeight):BFN.TransformItemIsolator.active?(e=BFN.TransformItemIsolator.itemWidth,t=BFN.TransformItemIsolator.itemHeight):BFN.AppModel.viewingEditor&&BFN.PhotoEditorModel.currentTexture&&(e=BFN.PhotoEditorModel.currentTexture.width,t=BFN.PhotoEditorModel.currentTexture.height),this.premiumWatermark.setDimensions(e,t)}},$x.prototype.handleCanvasViewStateUpdated=function(e){this.updateToolView(),BFN.PhotoEditorCanvas.updateCheckerPanel(),BFN.PhotoEditorCanvas.updateToolPosition()},$x.prototype.handleToolDimensionsUpdated=function(e){this.updatePremiumWatermarkDimensions()},$x.prototype.handleToolOver=function(e){(!BFN.ImagePainterUndoManager.currentImagePainter||BFN.ImagePainterUndoManager.currentImagePainter&&!BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled)&&this.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_OVER)},$x.prototype.handleToolOut=function(e){this.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.TOOL_OUT)},$x.prototype.handleToolPressed=function(e){(!BFN.ImagePainterUndoManager.currentImagePainter||BFN.ImagePainterUndoManager.currentImagePainter&&!BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled)&&this.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG),this.toolPressed=!0,document.addEventListener(BeFunky.pointerup,this.handleToolReleasedBind)},$x.prototype.handleToolReleased=function(e){this.toolPressed=!1,document.removeEventListener(BeFunky.pointerup,this.handleToolReleasedBind)},Object.defineProperty($x.prototype,"scale",{set:function(e){this._scale=e,this.updateToolScales()},get:function(){return this._scale}}),Object.defineProperty($x.prototype,"scaling",{set:function(e){this._scaling=e,this.premiumWatermark.canvasScaling=this._scaling,this.currentTool&&(this.currentTool.toolScaling=this._scaling)},get:function(){return this._scaling}}),BFN.SingletonQueue.add(function(){BFN.PhotoEditorCanvasTools=new $x}),e_.prototype=Object.create(PIXI.Sprite.prototype),e_.prototype.init=function(){BeFunky.log("PhotoEditorCanvas Init"),this.initDefaultValues(),this.initCheckerPanel(),this.initCanvas(),this.initCanvasImageOriginal(),this.initCanvasImage(),this.initCanvasTools(),this.initTransformCanvas(),this.initTransformLayer(),this.initCanvasPixelGrid(),this.initTransformLayerVeil(),this.initCanvasGlow(),this.initTransformIndicatorContainer(),this.initTransformGuidesContainer(),this.initTransformItemBoundingBoxesContainer(),this.initTransformTool(),this.initTransformToolSnapGaps(),this.initTransformItemIsolator(),this.initLayerToolContainer(),this.initMoveTouchSurface(),this.initCanvasDragger(),this.initAnimators(),BFN.AppModel.viewingEditor&&this.updateCanvasView()},e_.prototype.initDefaultValues=function(){this.interactive=!0,this.mouseOver=!1,this.hoverSurfaceOver=!1,this.model=BFN.PhotoEditorCanvasModel,BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.SOURCE_IMAGE_UPDATED.type,this.handleSourceImageUpdated.bind(this)),BFN.PhotoEditorModel.addEventListener(BFN.PhotoEditorModelEvents.CURRENT_IMAGE_UPDATED.type,this.handleCurrentImageUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.VIEWSTATE_UPDATED.type,this.handleCanvasViewStateUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALING_UPDATED.type,this.handleCanvasScalingUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME.type,this.handleFitImageToFrame.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.FIT_IMAGE_TO_FRAME_ANIMATED.type,this.handleFitImageToFrameAnimated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.ITEM_ADDED.type,this.handleItemAdded.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.OFFSET_ITEMS.type,this.handleOffsetItems.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.FLATTEN_ITEMS.type,this.handleFlattenItems.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CLEAR_ITEMS.type,this.handleClearItems.bind(this)),this.on("pointerover",this.handleCanvasMouseOver.bind(this)),this.on("pointerout",this.handleCanvasMouseOut.bind(this)),this.handleCanvasKeyDownBind=this.handleCanvasKeyDown.bind(this),this.handleCanvasSpaceKeyUpBind=this.handleCanvasSpaceKeyUp.bind(this),this.handleCanvasOKeyUpBind=this.handleCanvasOKeyUp.bind(this),document.addEventListener("keydown",this.handleCanvasKeyDownBind,!0)},e_.prototype.initCheckerPanel=function(){this.checkerPanel=new BFN.CheckerPanel,this.checkerPanel.setDimensions(0,0),this.addChild(this.checkerPanel)},e_.prototype.initCanvas=function(){this.canvasContainer=new PIXI.Sprite,this.canvasContainer.interactive=!0,this.addChild(this.canvasContainer),this.canvas=new PIXI.Sprite,this.canvasContainer.addChild(this.canvas)},e_.prototype.initCanvasImageOriginal=function(){this.canvasImageOriginal=new PIXI.Sprite,this.canvasImageOriginal.interactive=!0,this.canvasImageOriginal.visible=!1,this.canvasImageOriginal.pluginName="smooth_picture",this.canvasImageOriginal.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.canvasImageOriginal.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.canvasImageOriginal.on("pointerdown",this.handleCanvasImagePressed.bind(this)),this.canvas.addChild(this.canvasImageOriginal)},e_.prototype.initCanvasImage=function(){this.canvasImage=BFN.PhotoEditorCanvasImage,this.canvasImage.pluginName="smooth_picture",this.canvasImage.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.canvasImage.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.canvasImage.on("pointerdown",this.handleCanvasImagePressed.bind(this)),this.canvas.addChild(this.canvasImage)},e_.prototype.initCanvasTools=function(){this.canvasToolsContainer=new PIXI.Container,this.canvasContainer.addChild(this.canvasToolsContainer),this.canvasTools=BFN.PhotoEditorCanvasTools,this.canvasToolsContainer.addChild(this.canvasTools),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_OVER.type,this.handleHoverSurfaceOver.bind(this)),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_OUT.type,this.handleHoverSurfaceOut.bind(this)),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG.type,this.handleToolStartCanvasDrag.bind(this)),this.canvasTools.addEventListener(BFN.PhotoEditorCanvasToolsEvents.TOOL_DIMENSIONS_UPDATED.type,this.handleToolDimensionsUpdated.bind(this))},e_.prototype.initTransformCanvas=function(){this.transformCanvas=new PIXI.Container,this.transformCanvas.interactive=!1,this.canvasContainer.addChild(this.transformCanvas)},e_.prototype.initTransformLayer=function(){this.transformLayer=new BFN.TransformLayer(BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,this),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformItemsUpdated.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_SELECTED.type,this.handleTransformItemSelected.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED.type,this.handleTransformItemDisplayUpdated.bind(this)),this.canvas.addChild(this.transformLayer)},e_.prototype.initCanvasPixelGrid=function(){BFN.PhotoEditorCanvasModel.usePixelGrid&&(this.canvasPixelGrid=new BFN.PixelGrid,this.canvas.addChild(this.canvasPixelGrid))},e_.prototype.initTransformLayerVeil=function(){var e=this;this.transformLayerVeil=new BFN.CanvasFrame(mn().hex,1,BFN.PhotoEditorCanvasModel.imageFitPaddingX,BFN.PhotoEditorCanvasModel.imageFitPaddingY),this.addChild(this.transformLayerVeil),gn(function(t){var n=t.hex;e.transformLayerVeil.color=n})},e_.prototype.initCanvasGlow=function(){this.canvasGlow=new BFN.CanvasGlow,this.addChild(this.canvasGlow)},e_.prototype.initTransformIndicatorContainer=function(){this.transformIndicatorContainer=new PIXI.Container,this.transformIndicatorContainer.interactiveChildren=!1,this.addChild(this.transformIndicatorContainer)},e_.prototype.initTransformGuidesContainer=function(){this.transformGuidesContainer=new PIXI.Container,this.addChild(this.transformGuidesContainer)},e_.prototype.initTransformItemBoundingBoxesContainer=function(){this.transformItemBoundingBoxesContainer=new PIXI.Container,this.addChild(this.transformItemBoundingBoxesContainer)},e_.prototype.initTransformTool=function(){this.transformTool=new BFN.TransformTool(this.transformLayer),this.addChild(this.transformTool),this.transformLayer.transformTool=this.transformTool},e_.prototype.initTransformToolSnapGaps=function(){this.transformToolSnapGapsContainer=new PIXI.Container,this.addChild(this.transformToolSnapGapsContainer)},e_.prototype.initTransformItemIsolator=function(){this.transformItemIsolatorContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformItemIsolatorContainer)},e_.prototype.initLayerToolContainer=function(){this.layerToolContainer=new PIXI.Container,this.addChild(this.layerToolContainer)},e_.prototype.initMoveTouchSurface=function(){this.moveTouchSurface=new PIXI.Graphics,this.moveTouchSurface.interactive=!0,this.moveTouchSurface.visible=!1,this.moveTouchSurface.beginFill(0,0),this.moveTouchSurface.drawRect(-50,-50,100,100),this.moveTouchSurface.endFill(),this.moveTouchSurface.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.moveTouchSurface.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.moveTouchSurface.on("pointerdown",this.handleMoveTouchSurfacePressed.bind(this)),this.addChild(this.moveTouchSurface)},e_.prototype.initCanvasDragger=function(){this.canvasDragger=new BFN.Dragger,this.canvasDragger.pixelDragThreshold=5,this.canvasDragger.pixelDragThresholdPreventEvent=!0,this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasDraggerDraggingComplete.bind(this))},e_.prototype.initAnimators=function(){this.fitImageAnimator=new BFN.Animator,this.fitImageAnimator.linearSteps=10,this.fitImageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFitImageAnimatorUpdate.bind(this)),this.fitImageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleFitImageAnimatorUpdateComplete.bind(this))},e_.prototype.updateCanvasContainerDisplay=function(){var e=2*BFN.PhotoEditorCanvasModel.imageFitPaddingX,t=2*BFN.PhotoEditorCanvasModel.imageFitPaddingY,n=this.canvasImageOriginal.visible?this.canvasImageOriginal.texture.width:this.canvasImage.imageWidth,i=this.canvasImageOriginal.visible?this.canvasImageOriginal.texture.height:this.canvasImage.imageHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(n-=(n-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,i-=(i-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),!this.canvasImageOriginal.visible&&BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(n=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,i=BFN.PhotoEditorCanvasTools.currentTool.itemHeight),this.canvasImageOriginal.visible&&(this.canvasImageOriginal.x=(this.canvasImage.imageWidth-this.canvasImageOriginal.texture.width)/2,this.canvasImageOriginal.y=(this.canvasImage.imageHeight-this.canvasImageOriginal.texture.height)/2);var r=n?this.scale.x*n:1,a=i?this.scale.y*i:1,o=Math.max(0,n-BFN.StageModel.stageW/r*n+1/this.scale.x*e),s=Math.max(0,i-BFN.StageModel.stageH/a*i+1/this.scale.y*t);this.canvasDragger.setBounds(-o/2,-s/2,o/2,s/2),this.canvasContainer.x=Math.round(Math.min(this.canvasDragger.bounds.maxX,Math.max(this.canvasDragger.bounds.minX,this.canvasContainer.x))),this.canvasContainer.y=Math.round(Math.min(this.canvasDragger.bounds.maxY,Math.max(this.canvasDragger.bounds.minY,this.canvasContainer.y))),this.layerToolContainer.x=this.canvasContainer.x,this.layerToolContainer.y=this.canvasContainer.y,this.transformItemBoundingBoxesContainer.x=this.canvasContainer.x,this.transformItemBoundingBoxesContainer.y=this.canvasContainer.y,this.updateCheckerPanel(),this.updateTransformLayerVeil(),this.updateToolPosition(),BFN.TransformGuides.updateDisplay(),BFN.MainUI.requestRender()},e_.prototype.updateToolPosition=function(){this.transformTool.x=this.canvasContainer.x,this.transformTool.y=this.canvasContainer.y,this.transformLayerVeil.x=this.canvasContainer.x+this.canvas.x+this.canvasImage.imageWidth/2,this.transformLayerVeil.y=this.canvasContainer.y+this.canvas.y+this.canvasImage.imageHeight/2},e_.prototype.updateCanvasImage=function(){null==BFN.PhotoEditorModel.currentTexture?(this.canvasImage.texture=PIXI.Texture.EMPTY,this.canvas.x=this.transformCanvas.x=0,this.canvas.y=this.transformCanvas.y=0):(this.canvasImage.texture=BFN.PhotoEditorModel.currentTexture,this.canvas.x=this.transformCanvas.x=-Math.round(this.canvasImage.texture.width/2),this.canvas.y=this.transformCanvas.y=-Math.round(this.canvasImage.texture.height/2)),this.transformLayer.x=-this.canvas.x,this.transformLayer.y=-this.canvas.y,this.canvasPixelGrid&&(this.canvasPixelGrid.x=this.transformLayer.x,this.canvasPixelGrid.y=this.transformLayer.y),this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},e_.prototype.updateCanvasView=function(){switch(this.canvasImage.visible=BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,this.canvasTools.visible=!this.canvasImage.visible,this.transformLayer.visible=this.canvasImage.visible,this.transformTool.visible=this.canvasImage.visible,BFN.PhotoEditorCanvasModel.viewState){case BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS:this.transformLayer.visible=!0,this.transformLayer.enableChildren(),this.canvas.addChild(this.transformLayer),this.canvasPixelGrid&&this.canvas.addChild(this.canvasPixelGrid);break;default:this.transformLayer.visible=!1,this.transformLayer.disableChildren(),this.transformCanvas.addChild(this.transformLayer)}this.transformLayerVeil.visible=BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS,this.updateTransformLayerVeil(),BFN.ZoomManager.updateZoomRange(),BFN.MainUI&&BFN.MainUI.requestRender()},e_.prototype.updatePosition=function(){this.x=Math.round(BFN.StageModel.stageW/2),this.y=Math.round(BFN.StageModel.stageH/2),this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.updateTransformLayerVeilOuterDimensions(),this.updateCanvasContainerDisplay()},e_.prototype.updateScale=function(){this.scale.x=this.scale.y=this.canvasTools.scale=this.transformLayer.canvasScale=this.transformTool.scale=this.canvasDragger.scale=BFN.PhotoEditorCanvasModel.canvasScale,this.transformItemBoundingBoxesContainer.children.includes(BFN.TransformItemBoundingBoxes)&&(BFN.TransformItemBoundingBoxes.lineScale=BFN.PhotoEditorCanvasModel.canvasScale),this.transformGuidesContainer.scale.x=1/this.scale.x,this.transformGuidesContainer.scale.y=1/this.scale.y,this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.canvasImage.currentScale=this.canvasImageOriginal.currentScale=BFN.PhotoEditorCanvasModel.canvasScale,this.transformLayerVeil.canvasScale=BFN.PhotoEditorCanvasModel.canvasScale,this.canvasGlow.canvasScale=BFN.PhotoEditorCanvasModel.canvasScale,this.canvasPixelGrid&&(this.canvasPixelGrid.canvasScale=BFN.PhotoEditorCanvasModel.canvasScale),this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},e_.prototype.fitImageToFrame=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=2*BFN.PhotoEditorCanvasModel.imageFitPaddingX,n=2*BFN.PhotoEditorCanvasModel.imageFitPaddingY,i=this.canvasImage.width,r=this.canvasImage.height;BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.itemWidth>0&&BFN.TransformItemIsolator.itemHeight>0&&(i=BFN.TransformItemIsolator.itemWidth,r=BFN.TransformItemIsolator.itemHeight);var a=BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?BFN.PhotoEditorCanvasTools.currentTool:null;a&&(i=a.hasOwnProperty("itemWidth")?a.itemWidth:i,r=a.hasOwnProperty("itemHeight")?a.itemHeight:r),i<=0||r<=0||(this.fitScale=Math.min(1,(BFN.StageModel.stageW-t)/i,(BFN.StageModel.stageH-n)/r),e?(BFN.PhotoEditorCanvasModel.canvasScaling=!0,this.startScale=BFN.PhotoEditorCanvasModel.canvasScale,Math.abs(this.fitScale-this.startScale)>.001?this.fitImageAnimator.setAnimatorFactor(0):this.fitImageAnimator.setAnimatorFactor(1),this.fitImageAnimator.increase()):(BFN.PhotoEditorCanvasModel.canvasScale=this.fitScale,BFN.PhotoEditorCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()))},e_.prototype.updateCheckerPanel=function(){this.checkerPanel.x=this.canvasContainer.x+this.canvas.x+this.canvasImage.imageWidth/2,this.checkerPanel.y=this.canvasContainer.y+this.canvas.y+this.canvasImage.imageHeight/2,this.checkerPanel.scale=BFN.PhotoEditorCanvasModel.canvasScale;var e={x:0,y:0};if(this.canvasImageOriginal.visible)this.canvasImageOriginal.texture.width>1&&this.canvasImageOriginal.texture.height>1&&(e.x=this.canvasImageOriginal.texture.width,e.y=this.canvasImageOriginal.texture.height);else if(BFN.PhotoEditorCanvasModel.viewState===BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)this.canvasImage.imageWidth>1&&this.canvasImage.imageHeight>1&&(e.x=this.canvasImage.imageWidth,e.y=this.canvasImage.imageHeight);else{var t=BFN.PhotoEditorCanvasTools.currentTool;if(t&&void 0!==t.itemWidth&&void 0!==t.itemHeight){var n=t.itemWidth,i=t.itemHeight;e.x=n,e.y=i}else e.x=this.canvasImage.imageWidth,e.y=this.canvasImage.imageHeight}if(BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)){var r=BFN.TransformItemIsolator.itemWidth,a=BFN.TransformItemIsolator.itemHeight;BFN.TransformItemIsolator.shiftAnimator.animating&&(r=BFN.TransformItemIsolator.shiftParamsEnd.w-(BFN.TransformItemIsolator.shiftParamsEnd.w-BFN.TransformItemIsolator.shiftParamsStart.w)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor),a=BFN.TransformItemIsolator.shiftParamsEnd.h-(BFN.TransformItemIsolator.shiftParamsEnd.h-BFN.TransformItemIsolator.shiftParamsStart.h)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor)),e.x=e.x-(e.x-r)*BFN.TransformItemIsolator.activeFactor,e.y=e.y-(e.y-a)*BFN.TransformItemIsolator.activeFactor}this.checkerPanel.setDimensions(e.x,e.y),this.updateCanvasGlow()},e_.prototype.updateCanvasGlow=function(){var e=this.checkerPanel.width,t=this.checkerPanel.height;this.canvasGlow.x=this.canvasContainer.x-e/2%1,this.canvasGlow.y=this.canvasContainer.y-t/2%1,this.canvasGlow.setDimensions(e,t)},e_.prototype.updateTransformLayerVeil=function(){if(this.canvasImageOriginal.visible)this.transformLayer.frameWidth=this.canvasImageOriginal.texture.width,this.transformLayer.frameHeight=this.canvasImageOriginal.texture.height,this.transformTool.frameWidth=this.canvasImageOriginal.texture.width,this.transformTool.frameHeight=this.canvasImageOriginal.texture.height;else if(BFN.PhotoEditorCanvasModel.viewState==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS)this.transformLayer.frameWidth=this.canvasImage.imageWidth,this.transformLayer.frameHeight=this.canvasImage.imageHeight,this.transformTool.frameWidth=this.canvasImage.imageWidth,this.transformTool.frameHeight=this.canvasImage.imageHeight;else{var e=BFN.PhotoEditorCanvasTools.currentTool;if(e&&void 0!==e.itemWidth&&void 0!==e.itemHeight){var t=e.itemWidth,n=e.itemHeight;this.transformLayer.frameWidth=t,this.transformLayer.frameHeight=n,this.transformTool.frameWidth=t,this.transformTool.frameHeight=n}else this.transformLayer.frameWidth=this.canvasImage.imageWidth,this.transformLayer.frameHeight=this.canvasImage.imageHeight,this.transformTool.frameWidth=this.canvasImage.imageWidth,this.transformTool.frameHeight=this.canvasImage.imageHeight}var i=this.transformLayer.frameWidth,r=this.transformLayer.frameHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(i=this.transformLayer.frameWidth-(this.transformLayer.frameWidth-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,r=this.transformLayer.frameHeight-(this.transformLayer.frameHeight-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),this.canvasPixelGrid&&(this.canvasPixelGrid.active!=BFN.PhotoEditorCanvasModel.usePixelGrid&&(this.canvasPixelGrid.active=BFN.PhotoEditorCanvasModel.usePixelGrid),this.canvasPixelGrid.setFrameDimensions(i,r)),this.moveTouchSurface.scale.x=i/100,this.moveTouchSurface.scale.y=r/100,this.drawTransformLayerVeil(i,r)},e_.prototype.updateTransformLayerVeilOuterDimensions=function(){this.transformLayerVeil.setOuterDimensions(BFN.StageModel.stageW+20,BFN.StageModel.stageH+2)},e_.prototype.drawTransformLayerVeil=function(e,t){e=Math.round(e),t=Math.round(t),this.transformLayerVeil.setInnerDimensions(e,t)},e_.prototype.getFlattenedImage=function(){if(this.canvasImage.texture&&this.canvasImage.texture.width&&this.canvasImage.texture.height){var e={x:this.canvas.x,y:this.canvas.y};this.canvas.x=this.canvas.y=0,this.transformLayer.toggleFlattenDisplayMode(!0),this.canvasImage.currentScale=1,this.canvasContainer.removeChild(this.canvas);var t=PIXI.RenderTexture.create(this.canvasImage.texture.width,this.canvasImage.texture.height);return BFN.Stage.render(this.canvas,t),this.canvas.x=e.x,this.canvas.y=e.y,this.canvasContainer.addChildAt(this.canvas,0),this.canvasImage.currentScale=BFN.PhotoEditorCanvasModel.canvasScale,this.transformLayer.toggleFlattenDisplayMode(!1),t}return null},e_.prototype.handleStageDimensionsUpdated=function(){this.updatePosition()},e_.prototype.handleSourceImageUpdated=function(){this.canvasImageOriginal.texture=BFN.PhotoEditorModel.sourceTexture},e_.prototype.handleCurrentImageUpdated=function(){this.updateCanvasImage()},e_.prototype.handleCanvasViewStateUpdated=function(){this.updateCanvasView()},e_.prototype.handleCanvasScaleUpdated=function(){this.updateScale()},e_.prototype.handleCanvasScalingUpdated=function(){this.canvasTools.scaling=BFN.PhotoEditorCanvasModel.canvasScaling},e_.prototype.handleFitImageToFrame=function(){this.fitImageToFrame()},e_.prototype.handleFitImageToFrameAnimated=function(){this.fitImageToFrame(!0)},e_.prototype.handleItemAdded=function(){BFN.PhotoEditorCanvasModel.addedItem&&(BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.transformLayer.addItem(BFN.PhotoEditorCanvasModel.addedItem),BFN.PhotoEditorCanvasModel.addedItem=null)},e_.prototype.handleOffsetItems=function(){this.transformLayer.offsetAllItems(BFN.PhotoEditorCanvasModel.itemOffsetPoint.x,BFN.PhotoEditorCanvasModel.itemOffsetPoint.y)},e_.prototype.handleFlattenItems=function(){var e=this.getFlattenedImage();if(e){BFN.PhotoEditorModel.updateCurrentTexture(e);var t=BFN.PhotoEditorHistoryModel.addTextureToHistory("layers_flattened",BFN.PhotoEditorModel.currentTexture),n=new BFN.UserActionVO;n.eventID="editing_applied",n.eventObject={toolType:"Other",toolName:"Flatten"},n.actionSection="editor",n.actionTimestamp=t,this.transformLayer.children.forEach(function(e){e instanceof BFN.TransformItem&&(n.transformItems||(n.transformItems=[]),n.transformItems.push(e))}),n.register(),this.transformLayer.removeAllItems(),UIMessages.display("layers_flattened")}},e_.prototype.handleClearItems=function(){this.transformLayer.destroyAllItems()},e_.prototype.handleCanvasImagePressed=function(e){BFN.CursorScreen.cursor="grabbing",BFN.CursorScreen.cursorLock=!0,this.canvasDragger.drag(this.canvasContainer)},e_.prototype.handleToolStartCanvasDrag=function(e){this.handleCanvasImagePressed(e)},e_.prototype.handleToolDimensionsUpdated=function(e){this.updateCanvasContainerDisplay(),BFN.ZoomManager.updateZoomRange()},e_.prototype.handleTransformItemsUpdated=function(){var e=this.transformLayer.itemsExist;BFN.PhotoEditorCanvasModel.itemsExist!=e&&(BFN.PhotoEditorCanvasModel.itemsExist=e)},e_.prototype.handleTransformItemSelected=function(){this.transformLayer.selectedItem?(this.transformTool.selectItem(this.transformLayer.selectedItem),BFN.TransformModel.selectedTransformItem!=this.transformLayer.selectedItem&&(BFN.TransformModel.selectedTransformItem=this.transformLayer.selectedItem)):(this.transformTool.deselectItem(),BFN.TransformModel.selectedTransformItem=null)},e_.prototype.handleTransformItemDisplayUpdated=function(){this.transformTool.updateDisplay()},e_.prototype.handleHoverSurfaceOver=function(e){setTimeout(function(){this.hoverSurfaceOver=!0,BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"grab"}.bind(this),0)},e_.prototype.handleHoverSurfaceOut=function(e){this.hoverSurfaceOver=!1,BFN.CursorScreen&&(BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"auto")},e_.prototype.handleMoveTouchSurfacePressed=function(e){e.stopPropagation(),this.handleCanvasImagePressed(null)},e_.prototype.handleCanvasMouseOver=function(e){this.mouseOver=!0},e_.prototype.handleCanvasMouseOut=function(e){this.mouseOver=!1},e_.prototype.handleCanvasKeyDown=function(e){BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR||BeFunky.isTextBoxFocused()||(32!=e.keyCode||this.moveTouchSurface.visible?79!==e.keyCode||e.ctrlKey||e.metaKey||!BFN.PhotoEditorModel.currentTexture||(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasOKeyUpBind,!0),window.addEventListener("blur",this.handleCanvasOKeyUpBind,!0),this.canvasImageOriginal.visible=!0,this.canvasImage.visible=!1,this.canvasTools.visible=!1,this.transformLayer.visible=!1,this.transformTool.visible=!1,this.updateCanvasContainerDisplay()):(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!0),window.addEventListener("blur",this.handleCanvasSpaceKeyUpBind,!0),this.moveTouchSurface.visible=!0,BFN.MainUI.requestRender(),this.canvasTools.toolPressed&&this.canvasTools.dispatchEvent(BFN.PhotoEditorCanvasToolsEvents.START_CANVAS_DRAG)))},e_.prototype.handleCanvasSpaceKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!0),window.removeEventListener("blur",this.handleCanvasSpaceKeyUpBind,!0),this.moveTouchSurface.visible=!1,BFN.MainUI.requestRender(),this.canvasTools.toolPressed&&this.canvasDragger.stopDrag(),BFN.PIXITicker.nudge()},e_.prototype.handleCanvasOKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasOKeyUpBind,!0),window.removeEventListener("blur",this.handleCanvasOKeyUpBind,!0),this.canvasImageOriginal.visible=!1,this.canvasImage.visible=null==this.canvasTools.currentTool,this.canvasTools.visible=!this.canvasImage.visible,this.transformLayer.visible=this.canvasImage.visible,this.transformTool.visible=this.canvasImage.visible,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender(),BFN.PIXITicker.nudge()},e_.prototype.handleCanvasDraggerDragging=function(){this.updateCanvasContainerDisplay(),BFN.TransformModel.selectedTransformItem&&"group"===BFN.TransformModel.selectedTransformItem.type&&BFN.TransformModel.selectedTransformItem.updateGroupTransform()},e_.prototype.handleCanvasDraggerDraggingComplete=function(){BFN.CursorScreen.cursorLock=!1,BFN.CursorScreen.cursor=this.hoverSurfaceOver?"grab":"auto"},e_.prototype.handleFitImageAnimatorUpdate=function(){BFN.PhotoEditorCanvasModel.canvasScale=(this.fitScale-this.startScale)*this.fitImageAnimator.animationSinFactor+this.startScale},e_.prototype.handleFitImageAnimatorUpdateComplete=function(){BFN.PhotoEditorCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()},BFN.SingletonQueue.add(function(){BFN.PhotoEditorCanvas=new e_}),t_.prototype=Object.create(PIXI.Sprite.prototype),t_.prototype.init=function(){BeFunky.log("PhotoEditor Init"),this.initDefaultValues(),this.initCanvas()},t_.prototype.initDefaultValues=function(){BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this))},t_.prototype.initCanvas=function(){this.addChild(BFN.PhotoEditorCanvas)},t_.prototype.handleAppReady=function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIPressed.bind(this))},t_.prototype.handleMainUIPressed=function(e){if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR&&!BFN.ColorPickerPanel.colorButton&&!BeFunky.isLoadScreenActive()&&BFN.TransformModel.selectedTransformItem){var t=e.data.canvasPressed,n=e.data.originalEvent,i=!(t&&(n.ctrlKey||n.metaKey||n.altKey));BFN.PhotoEditorCanvas.transformLayer.deselectItem(i,n.shiftKey)}},BFN.SingletonQueue.add(function(){BFN.PhotoEditor=new t_}),n_.prototype=Object.create(PIXI.Container.prototype),n_.prototype.init=function(){BeFunky.log("CollageMakerCanvasBackground Init"),this.initDefaultValues(),this.initBackgroundGraphic(),this.updateDisplay()},n_.prototype.initDefaultValues=function(){this._itemWidth=340,this._itemHeight=340,this._color=UITools.getToolValue("collage_customize","background_color"),this.updateDisplayQueued=!1},n_.prototype.initBackgroundGraphic=function(){this.backgroundGraphic=new PIXI.Graphics,this.addChild(this.backgroundGraphic)},n_.prototype.queueUpdateDisplay=function(){this.updateDisplayQueued||(this.updateDisplayQueued=!0,requestAnimationFrame(function(){this.updateDisplayQueued=!1,this.updateDisplay()}.bind(this)))},n_.prototype.updateDisplay=function(){this.backgroundGraphic.clear(),-1!=this._color&&this._itemWidth>0&&this._itemHeight>0&&(this.backgroundGraphic.beginFill(parseInt("0x"+this._color)),this.backgroundGraphic.drawRect(0,0,this._itemWidth,this._itemHeight),this.backgroundGraphic.endFill());try{BFN.MainUI.requestRender()}catch(e){}},Object.defineProperty(n_.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(n_.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),Object.defineProperty(n_.prototype,"color",{set:function(e){this._color=e,this.updateDisplay()},get:function(){return this._color}}),BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvasBackground=new n_}),i_.prototype=Object.create(PIXI.Container.prototype),i_.prototype.init=function(){BeFunky.log("PhotoGridChildContentImage Init"),this.initDefaultValues(),this.initFrameSprite(),this.initDragger()},i_.prototype.initDefaultValues=function(){this._scale=1,this.photoGridDimensions=new PIXI.Point},i_.prototype.initFrameSprite=function(){this.frameSprite=new BFN.FrameSprite,this.frameSprite.pluginName="smooth_picture",this.frameSprite.expandVertex=0,this.addChild(this.frameSprite)},i_.prototype.initDragger=function(){this.frameSpriteOffsetFactorStartX=0,this.frameSpriteOffsetFactorStartY=0,this.handleDraggingStartedBind=this.handleDraggingStarted.bind(this),this.handleDraggingCompleteBind=this.handleDraggingComplete.bind(this),this.handleDraggingBind=this.handleDragging.bind(this),this._dragger=new BFN.Dragger,this._dragger.stickyDrag=!0,this._dragger.useBounds=!0,this._dragger.autoDrag=!1,this._dragger.addEventListener(BFN.DraggerEvents.DRAGGING_STARTED.type,this.handleDraggingStartedBind),this._dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingCompleteBind),this._dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleDraggingBind)},i_.prototype.setBaseTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{this.frameSprite.texture.destroyGC(!1)}catch(e){}this.frameSprite.texture=PIXI.Texture.EMPTY,e&&this.frameSprite.setTexture(new PIXI.Texture(e)),t?this.reset(n):0!=n&&(this.frameSprite.texture.rotate=n,this.frameSprite.updateDisplay()),this.updateSmoothing()},i_.prototype.setSize=function(e,t){this._itemWidth=e,this._itemHeight=t,this.frameSprite.frameWidth=this._itemWidth,this.frameSprite.frameHeight=this._itemHeight,this.frameSprite.updateDisplay(),this.updateSmoothing()},i_.prototype.resize=function(e){this.frameSprite.textureScale=e,this.frameSprite.updateDisplay(),this.updateSmoothing()},i_.prototype.setPhotoGridDimensions=function(e,t){this.photoGridDimensions.x=e,this.photoGridDimensions.y=t},i_.prototype.drag=function(){this.updateDragBounds(),this._dragger.drag(this.frameSprite)},i_.prototype.revertImagePosition=function(){this.frameSprite.offsetFactorX=this.frameSpriteOffsetFactorStartX,this.frameSprite.offsetFactorY=this.frameSpriteOffsetFactorStartY,this.frameSprite.updateDisplay()},i_.prototype.updateSmoothing=function(){this.frameSprite.currentScale=this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale},i_.prototype.flip=function(e){switch(e){case"horizontal":this.frameSprite.flipH();break;case"vertical":this.frameSprite.flipV()}},i_.prototype.rotate=function(e){switch(e){case"left":this.frameSprite.rotateL();break;case"right":this.frameSprite.rotateR()}this.updateSmoothing()},i_.prototype.reset=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;this.frameSprite&&(this.frameSprite.texture.rotate=e,this.frameSprite.textureScale=t,this.frameSprite.offsetFactorX=n,this.frameSprite.offsetFactorY=i,this.frameSprite.updateDisplay(),this.updateSmoothing())},i_.prototype.updateDragBounds=function(){this.frameSpriteOffsetFactorStartX=this.frameSprite.offsetFactorX,this.frameSpriteOffsetFactorStartY=this.frameSprite.offsetFactorY;var e=this.frameSprite.excessX*this.frameSprite.offsetFactorX*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),t=(this.frameSprite.excessX-this.frameSprite.excessX*this.frameSprite.offsetFactorX)*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),n=this.frameSprite.excessY*this.frameSprite.offsetFactorY*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),i=(this.frameSprite.excessY-this.frameSprite.excessY*this.frameSprite.offsetFactorY)*(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale);switch(this.frameSprite.texture.rotate){case 0:this._dragger.setBounds(-t,-i,e,n);break;case 2:this._dragger.setBounds(-i,-e,n,t);break;case 4:this._dragger.setBounds(-e,-n,t,i);break;case 6:this._dragger.setBounds(-n,-t,i,e);break;case 8:this._dragger.setBounds(-t,-n,e,i);break;case 10:this._dragger.setBounds(-i,-t,n,e);break;case 12:this._dragger.setBounds(-e,-i,t,n);break;case 14:this._dragger.setBounds(-n,-e,i,t)}},i_.prototype.destroy=function(){this._dragger.removeEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleDraggingBind),this._dragger=null,this.frameSprite.destroy(),this.removeChild(this.frameSprite),this.frameSprite=null},i_.prototype.handleDraggingStarted=function(e){BFN.smoothPictureDisabled=!0},i_.prototype.handleDraggingComplete=function(e){BFN.smoothPictureDisabled=!1},i_.prototype.handleDragging=function(e){var t=this._dragger.draggedX/(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),n=this._dragger.draggedY/(this._scale*this.frameSprite.adjustScale*this.frameSprite.textureScale),i=t,r=n;switch(this.frameSprite.texture.rotate){case 0:i=t,r=n;break;case 2:i=-n,r=t;break;case 4:i=-t,r=-n;break;case 6:i=n,r=-t;break;case 8:i=t,r=-n;break;case 10:i=n,r=t;break;case 12:i=-t,r=n;break;case 14:i=-n,r=-t}var a=this.frameSpriteOffsetFactorStartX-i/this.frameSprite.excessX,o=this.frameSpriteOffsetFactorStartY-r/this.frameSprite.excessY;this.frameSprite.offsetFactorX=this.frameSprite.excessX?a:this.frameSprite.offsetFactorX,this.frameSprite.offsetFactorY=this.frameSprite.excessY?o:this.frameSprite.offsetFactorY,this.frameSprite.updateDisplay()},Object.defineProperty(i_.prototype,"texture",{get:function(){return this.frameSprite?this.frameSprite.texture:null}}),Object.defineProperty(i_.prototype,"dragger",{get:function(){return this._dragger}}),Object.defineProperty(i_.prototype,"scale",{set:function(e){this._scale=e,this.updateSmoothing()},get:function(){return this._scale}}),Object.defineProperty(i_.prototype,"resizeScale",{get:function(){return this.frameSprite.textureScale}}),Object.defineProperty(i_.prototype,"resizeScaleX",{get:function(){return this.frameSprite.textureScaleX}}),Object.defineProperty(i_.prototype,"resizeScaleY",{get:function(){return this.frameSprite.textureScaleY}}),Object.defineProperty(i_.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(i_.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.PhotoGridChildContentImage=i_,BFN.PhotoGridChildContentEvents={SELECT:new Event("EDGE_BAR_HOVERED"),DRAG:new Event("EDGE_BAR_PRESSED"),DELETE:new Event("INSERT_CHILD"),FORCE_ISOLATION_RELEASE:new Event("SELECT_CHILD"),IMAGE_UPDATED:new Event("DRAG_CHILD"),IMAGE_POSITION_UPDATED:new Event("DELETE_CHILD")},r_.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),r_.prototype.init=function(){BeFunky.log("PhotoGridChildContent Init"),this.initDefaultValues(),this.initContentContainer(),this.initBackground(),this.initContentImage(),this.initHoverVeil(),this.initRoundedRectFilter(),this.initAnimators()},r_.prototype.initDefaultValues=function(){this.strokeWidth=2,this._isEmpty=!0,this._scale=1,this._rounding=0,this._cleanDelete=!1,this._directSelect=!1,this._awaitingDrop=!1,this._highlightEnabled=!1,this._isolated=!1,this._imageEnabled=!0,this._itemWidth=100,this._itemHeight=100,this._backgroundColor="FFFFFF",this._borderColor="D6D6EE ",this.mouseMoved=!1,this.mouseOver=!1,this.pressed=!1},r_.prototype.initContentContainer=function(){this.contentContainer=new PIXI.Container,this.addChild(this.contentContainer)},r_.prototype.initBackground=function(){this.background=new PIXI.Graphics,this.background.beginFill(16777215,.5),this.background.drawRect(0,0,100,100),this.background.endFill(),this.contentContainer.addChild(this.background),this.backgroundColor=this._backgroundColor},r_.prototype.initContentImage=function(){this.handleContentImageDraggingBind=this.handleContentImageDragging.bind(this),this.handleContentImageDraggingCompleteBind=this.handleContentImageDraggingComplete.bind(this),this._contentImage=new BFN.PhotoGridChildContentImage,this._contentImage.visible=!1,this._contentImage.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleContentImageDraggingBind),this.contentContainer.addChild(this._contentImage)},r_.prototype.initHoverVeil=function(){this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.handleMouseDownBind=this.handleMouseDown.bind(this),this.handleMouseMoveBind=this.handleMouseMove.bind(this),this.handleMouseUpBind=this.handleMouseUp.bind(this),this._hoverVeil=new PIXI.Graphics,this._hoverVeil.interactive=!0,this._hoverVeil.beginFill(16777215,.7),this._hoverVeil.drawRect(0,0,100,100),this._hoverVeil.endFill(),this._hoverVeil.on("pointerover",this.handleMouseOverBind),this._hoverVeil.on("pointerout",this.handleMouseOutBind),this._hoverVeil.on("pointerdown",this.handleMouseDownBind),this.contentContainer.addChild(this._hoverVeil)},r_.prototype.initRoundedRectFilter=function(){this.roundedRectFilter=new BFN.filters.RoundedRectFilter,this.roundedRectFilter.autoFit=!1,this.roundedRectFilter.edgePadding=0,this.roundedRectFilter.strokeWidth=this.strokeWidth,this.roundedRectFilter.useTexture=1,this.roundedRectFilter.roundingDisabled=!0,this.borderColor=this._borderColor},r_.prototype.initAnimators=function(){this.handleHoverAnimatorUpdateBind=this.handleHoverAnimatorUpdate.bind(this),this.handleFadeAnimatorUpdateBind=this.handleFadeAnimatorUpdate.bind(this),this.hoverAnimator=new BFN.Animator,this.hoverAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverAnimatorUpdateBind),this.hoverAnimator.setAnimatorFactor(0),this.fadeAnimator=new BFN.Animator,this.fadeAnimator.linearSteps=12,this.fadeAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdateBind),this.fadeAnimator.setAnimatorFactor(1)},r_.prototype.setImage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e?(this.roundedRectFilter.strokeWidth=0,this.contentContainer.filters=[this.roundedRectFilter],this._isEmpty=!1,this.background.visible=!1,this._contentImage.visible=!0,this._contentImage.setBaseTexture(e.baseTexture,t,i),this.updateSize()):(this.roundedRectFilter.strokeWidth=this.strokeWidth,this.contentContainer.filters=[this.roundedRectFilter],this._isEmpty=!0,this.background.visible=!0,this._contentImage.visible=!1,this._contentImage.setBaseTexture(null)),n||this.dispatchEvent(BFN.PhotoGridChildContentEvents.IMAGE_UPDATED),BFN.MainUI.requestRender()},r_.prototype.setSize=function(e,t){this._itemWidth=Math.max(0,e),this._itemHeight=Math.max(0,t),this.updateSize()},r_.prototype.updateSize=function(){this._itemWidth<=1||this._itemHeight<=1?this.visible=!1:(this.visible=!0,this.background.width=this._hoverVeil.width=this._itemWidth,this.background.height=this._hoverVeil.height=this._itemHeight,this.updateRoundedRectFilter(),this._contentImage.setSize(this._itemWidth,this._itemHeight))},r_.prototype.updateRoundedRectFilter=function(){this.roundedRectFilter.quality=this.roundedRectFilter.cornerRadius?.75:0,this.roundedRectFilter.cornerRadius=this._rounding*Math.min(this._itemWidth,this._itemHeight)/2,this.roundedRectFilter.spriteSize=[this._itemWidth,this._itemHeight],this.contentContainer.filters=[this.roundedRectFilter]},r_.prototype.flashItem=function(){this.fadeAnimator.setAnimatorFactor(0),this.fadeAnimator.increase()},r_.prototype.selectItem=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._directSelect=e,this.dispatchEvent(BFN.PhotoGridChildContentEvents.SELECT)},r_.prototype.deleteItem=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isEmpty?(this._cleanDelete=e,this.dispatchEvent(BFN.PhotoGridChildContentEvents.DELETE)):this.setImage(null)},r_.prototype.toggleBorder=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.roundedRectFilter.strokeWidth=e&&this._isEmpty?this.strokeWidth:this._isEmpty||!this._imageEnabled?t:0,this.contentContainer.filters=[this.roundedRectFilter]},r_.prototype.destroy=function(){this.hoverAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleHoverAnimatorUpdateBind),this.hoverAnimator=null,this.fadeAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFadeAnimatorUpdateBind),this.fadeAnimator=null,this.filters=[],this.roundedRectFilter=null,this._hoverVeil.off("pointerover",this.handleMouseOverBind),this._hoverVeil.off("pointerout",this.handleMouseOutBind),this._hoverVeil.off("pointerdown",this.handleMouseDownBind),this.removeChild(this._hoverVeil),this._hoverVeil=null,this.contentContainer.removeChild(this._contentImage),this._contentImage.destroy(),this._contentImage=null,this.contentContainer.removeChild(this.background),this.background=null,this.contentContainer.mask=null,this.removeChild(this.contentContainer),this.contentContainer=null},r_.prototype.handleContentImageDragging=function(e){this._isolated||this.mouseOver||(this._contentImage.revertImagePosition(),this._contentImage.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleContentImageDraggingCompleteBind),this._contentImage.dragger.stopDrag(),this.dispatchEvent(BFN.PhotoGridChildContentEvents.DRAG))},r_.prototype.handleMouseOver=function(e){setTimeout(function(){this.mouseOver=!0,(!BFN.PhotoGrid.draggedChild||BFN.PhotoGrid.draggedChild&&BFN.PhotoGrid.draggedChild.content!=this)&&(this._awaitingDrop?this.hoverAnimator.increase():this._isEmpty||(BFN.CursorScreen.cursorLock||(BFN.CursorScreen.cursorRotation=0),BFN.CursorScreen.cursor="move"))}.bind(this),0)},r_.prototype.handleMouseOut=function(e){this.mouseOver=!1,this._highlightEnabled||this.hoverAnimator.decrease(),this._contentImage.dragger.dragging||(BFN.CursorScreen.cursor=null)},r_.prototype.handleMouseDown=function(e){if(!BFN.GestureManager.multiplePointersActive){this.mouseOver=!0,"touch"==e.data.pointerType&&BFN.PhotoGrid.startTouchDragHoverDetection();var t=e.data.originalEvent;this.rightClick=2===t.button,this.mouseDownPoint=BFN.MainUI.getPointerPosition(e),!this._isEmpty&&(t.ctrlKey||t.metaKey||t.altKey)||(BFN.ActiveDraggers.includes(this._contentImage.dragger)||this._isEmpty||BFN.ActiveDraggers.push(this._contentImage.dragger),this.mouseMoved=!1,this.pressed=!0,document.addEventListener(BeFunky.pointermove,this.handleMouseMoveBind),document.addEventListener(BeFunky.pointerup,this.handleMouseUpBind))}},r_.prototype.handleMouseMove=function(e){this.mouseMovePoint=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent);var t=this.mouseMovePoint.x-this.mouseDownPoint.x,n=this.mouseMovePoint.y-this.mouseDownPoint.y;Math.sqrt(Math.pow(t,2)+Math.pow(n,2))>5&&(this.mouseMoved=!0,this.handleMouseUpBind())},r_.prototype.handleMouseUp=function(e){this.pressed=!1,document.removeEventListener(BeFunky.pointermove,this.handleMouseMoveBind),document.removeEventListener(BeFunky.pointerup,this.handleMouseUpBind),BFN.ActiveDraggers.includes(this._contentImage.dragger)&&BFN.ActiveDraggers.splice(BFN.ActiveDraggers.indexOf(this._contentImage.dragger),1),BFN.GestureManager.multiplePointersActive||(this.mouseMoved&&!this.rightClick?this._isEmpty||(this._contentImage.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleContentImageDraggingCompleteBind),this._contentImage.drag()):BFN.PhotoGrid.gridChildIsolated||this.selectItem(!0))},r_.prototype.handleContentImageDraggingComplete=function(e){this._contentImage.dragger.removeEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleContentImageDraggingCompleteBind),BFN.PhotoGrid.gridChildIsolated||this.dispatchEvent(BFN.PhotoGridChildContentEvents.IMAGE_POSITION_UPDATED)},r_.prototype.handleHoverAnimatorUpdate=function(e){this._hoverVeil.alpha=this.hoverAnimator.animationFactor},r_.prototype.handleFadeAnimatorUpdate=function(e){this.alpha=this.fadeAnimator.animationFactor},Object.defineProperty(r_.prototype,"isEmpty",{get:function(){return this._isEmpty}}),Object.defineProperty(r_.prototype,"image",{get:function(){return this._contentImage}}),Object.defineProperty(r_.prototype,"veil",{get:function(){return this._hoverVeil}}),Object.defineProperty(r_.prototype,"backgroundColor",{set:function(e){this._backgroundColor=e,this.background.tint=parseInt("0x"+this._backgroundColor)},get:function(){return this._backgroundColor}}),Object.defineProperty(r_.prototype,"borderColor",{set:function(e){this._borderColor=e,this.roundedRectFilter.strokeColor=parseInt("0xFF"+this._borderColor),this._hoverVeil.tint=parseInt("0x"+this._borderColor)},get:function(){return this._borderColor}}),Object.defineProperty(r_.prototype,"rounding",{set:function(e){this._rounding=e,this.updateRoundedRectFilter()},get:function(){return this._rounding}}),Object.defineProperty(r_.prototype,"cleanDelete",{get:function(){return this._cleanDelete}}),Object.defineProperty(r_.prototype,"directSelect",{get:function(){return this._directSelect}}),Object.defineProperty(r_.prototype,"awaitingDrop",{set:function(e){this._awaitingDrop=e,this._awaitingDrop||this.hoverAnimator.decrease()},get:function(){return this._awaitingDrop}}),Object.defineProperty(r_.prototype,"highlightEnabled",{set:function(e){this._highlightEnabled=e,this._highlightEnabled?this.hoverAnimator.increase():this.hoverAnimator.decrease()},get:function(){return this._highlightEnabled}}),Object.defineProperty(r_.prototype,"isolated",{set:function(e){this._isolated=e},get:function(){return this._isolated}}),Object.defineProperty(r_.prototype,"imageEnabled",{set:function(e){this._imageEnabled=e,!this._imageEnabled||this._isEmpty?(this.contentContainer.filters=[this.roundedRectFilter],this.background.visible=!0,this._contentImage.visible=!1):(this.contentContainer.filters=[],this.background.visible=!1,this._contentImage.visible=!0)},get:function(){return this._imageEnabled}}),Object.defineProperty(r_.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateSize()},get:function(){return this._itemWidth}}),Object.defineProperty(r_.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateSize()},get:function(){return this._itemHeight}}),BFN.PhotoGridChildContent=r_,a_.prototype=Object.create(PIXI.Container.prototype),a_.prototype.init=function(){BeFunky.log("PhotoGridChildEdgeBar Init"),this.initDefaultValues(),this.initContainer(),this.initShapes(),this.initAnimator(),this.updateDisplay()},a_.prototype.initDefaultValues=function(){this.interactive=!0,this.showEdgeBar=!1,this.baseSize=50,this.color=13413119,this._id=null,this.cornerAWidth=this.baseSize,this.cornerBWidth=this.baseSize,this.blockWidth=this.baseSize,this._itemWidth=3*this.baseSize,this._itemHeight=this.baseSize,this.handleMouseOverBind=this.handleMouseOver.bind(this),this.handleMouseOutBind=this.handleMouseOut.bind(this),this.on("pointerover",this.handleMouseOverBind),this.on("pointerout",this.handleMouseOutBind)},a_.prototype.initContainer=function(){switch(this.container=new PIXI.Container,this.container.alpha=0,this.addChild(this.container),this.side){case"left":this.container.rotation=-Math.PI/2;break;case"top":this.container.rotation=0;break;case"right":this.container.rotation=Math.PI/2;break;case"bottom":this.container.rotation=Math.PI}},a_.prototype.initShapes=function(){this.cornerA=new PIXI.Graphics,this.cornerA.beginFill(this.color),this.cornerA.moveTo(0,0),this.cornerA.lineTo(0,this.baseSize),this.cornerA.lineTo(-this.baseSize,0),this.cornerA.lineTo(0,0),this.cornerA.endFill(),this.container.addChild(this.cornerA),this.cornerAPolygon=[new PIXI.Point(0,0),new PIXI.Point(0,this.baseSize),new PIXI.Point(-this.baseSize,0)],this.cornerATriangle=new BFN.Triangle,this.cornerB=new PIXI.Graphics,this.cornerB.beginFill(this.color),this.cornerB.moveTo(0,0),this.cornerB.lineTo(0,this.baseSize),this.cornerB.lineTo(this.baseSize,0),this.cornerB.lineTo(0,0),this.cornerB.endFill(),this.container.addChild(this.cornerB),this.cornerBPolygon=[new PIXI.Point(0,0),new PIXI.Point(0,this.baseSize),new PIXI.Point(this.baseSize,0)],this.cornerBTriangle=new BFN.Triangle,this.block=new PIXI.Graphics,this.block.beginFill(this.color),this.block.drawRect(-this.baseSize/2,0,this.baseSize,this.baseSize),this.block.endFill(),this.container.addChild(this.block),this.blockPolygon=[new PIXI.Point(-this.baseSize/2,0),new PIXI.Point(this.baseSize/2,0),new PIXI.Point(this.baseSize/2,this.baseSize),new PIXI.Point(-this.baseSize/2,this.baseSize)],this.blockRectangle=new BFN.Rectangle},a_.prototype.initAnimator=function(){this.showEdgeBar&&(this.handleAnimatorUpdateBind=this.handleAnimatorUpdate.bind(this),this._animator=new BFN.Animator,this._animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this._animator.setAnimatorFactor(0))},a_.prototype.setSize=function(e,t,n,i){this.cornerAWidth=e,this.blockWidth=t,this.cornerBWidth=n,this._itemWidth=this.cornerAWidth+this.blockWidth+this.cornerBWidth,this._itemHeight=i,this.updateDisplay()},a_.prototype.updateDisplay=function(){this.cornerA.x=-this.blockWidth/2,this.cornerA.width=this.cornerAWidth,this.cornerA.height=this._itemHeight,this.cornerB.x=this.blockWidth/2,this.cornerB.width=this.cornerBWidth,this.cornerB.height=this._itemHeight,this.block.width=this.blockWidth,this.block.height=this._itemHeight},a_.prototype.destroy=function(){this.showEdgeBar&&(this._animator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this._animator=null),this.container.removeChild(this.block),this.block=null,this.container.removeChild(this.cornerB),this.cornerB=null,this.container.removeChild(this.cornerA),this.cornerA=null,this.removeChild(this.container),this.container=null,this.off("pointerover",this.handleMouseOverBind),this.off("pointerout",this.handleMouseOutBind)},a_.prototype.updateGlobalBounds=function(){var e=this;this.cornerAPolygon.forEach(function(t,n){var i=BFN.MainUI.toLocal(t,e.cornerA);e.cornerATriangle["x"+(n+1)]=i.x+BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,e.cornerATriangle["y"+(n+1)]=i.y+BFN.MainUI.y+BFN.CSS.topMenuBarHeight}),this.cornerBPolygon.forEach(function(t,n){var i=BFN.MainUI.toLocal(t,e.cornerB);e.cornerBTriangle["x"+(n+1)]=i.x+BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,e.cornerBTriangle["y"+(n+1)]=i.y+BFN.MainUI.y+BFN.CSS.topMenuBarHeight}),this.blockRectangle=null,this.blockPolygon.forEach(function(t){var n=BFN.MainUI.toLocal(t,e.block);e.blockRectangle?(e.blockRectangle.left=Math.min(e.blockRectangle.left,n.x),e.blockRectangle.right=Math.max(e.blockRectangle.right,n.x),e.blockRectangle.top=Math.min(e.blockRectangle.top,n.y),e.blockRectangle.bottom=Math.max(e.blockRectangle.bottom,n.y)):e.blockRectangle=new BFN.Rectangle(n.x,n.y)}),this.blockRectangle?(this.blockRectangle.x+=BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,this.blockRectangle.y+=BFN.MainUI.y+BFN.CSS.topMenuBarHeight):this.blockRectangle=new BFN.Rectangle},a_.prototype.containsGlobalPoint=function(e,t){return this.cornerATriangle.contains(e,t)||this.cornerBTriangle.contains(e,t)||this.blockRectangle.contains(e,t)},a_.prototype.handleMouseOver=function(e){this.showEdgeBar&&this._animator.increase()},a_.prototype.handleMouseOut=function(e){this.showEdgeBar&&this._animator.decrease()},a_.prototype.handleAnimatorUpdate=function(e){this.container.alpha=.8*this._animator.animationFactor+.2},Object.defineProperty(a_.prototype,"id",{set:function(e){this._id=e},get:function(){return this._id}}),Object.defineProperty(a_.prototype,"animator",{get:function(){return this._animator}}),Object.defineProperty(a_.prototype,"itemWidth",{get:function(){return this._itemWidth}}),Object.defineProperty(a_.prototype,"itemHeight",{get:function(){return this._itemHeight}}),BFN.PhotoGridChildEdgeBar=a_,BFN.PhotoGridChildEvents={EDGE_BAR_HOVERED:new Event("EDGE_BAR_HOVERED"),EDGE_BAR_PRESSED:new Event("EDGE_BAR_PRESSED"),INSERT_CHILD:new Event("INSERT_CHILD"),SELECT_CHILD:new Event("SELECT_CHILD"),DRAG_CHILD:new Event("DRAG_CHILD"),DELETE_CHILD:new Event("DELETE_CHILD"),CHILD_IMAGE_UPDATED:new Event("CHILD_IMAGE_UPDATED"),CHILD_IMAGE_POSITION_UPDATED:new Event("CHILD_IMAGE_POSITION_UPDATED"),TRANSITION_COMPLETE:new Event("TRANSITION_COMPLETE")},o_.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),o_.prototype.init=function(){BeFunky.log("PhotoGridChild Init"),this.initDefaultValues(),this.initBackground(),this.initChildContent(),this.initEdgeBars(),this.initTransitionAnimator()},o_.prototype.initDefaultValues=function(){this.interactive=!0,this._destroyed=!1,this._id=null,this._gap=0,this._rounding=0,this._scale=1,this._hoveredEdge=null,this._rect=new BFN.Rectangle,this._factorRect=new BFN.Rectangle,this._attemptUngrouping=!1,this._attemptSeparation=!1,this._itemWidth=100,this._itemHeight=100,this._transitionRect=new BFN.Rectangle,this._awaitingDrop=!1,this.globalRect=new BFN.Rectangle,this._menuImageVO=null,this.projectItemVO=new BFN.ProjectItemVO,this.projectItemVO.type="grid_cell",this.handleKeyDownBind=this.handleKeyDown.bind(this),this.handleKeyUpBind=this.handleKeyUp.bind(this)},o_.prototype.initBackground=function(){this.background=new PIXI.Graphics},o_.prototype.initChildContent=function(){this.childContentContainer=new PIXI.Container,this.addChild(this.childContentContainer),this.gridChildContentEventHandlers=[{event:BFN.PhotoGridChildContentEvents.SELECT,handler:this.handleChildContentSelect.bind(this)},{event:BFN.PhotoGridChildContentEvents.DRAG,handler:this.handleChildContentDrag.bind(this)},{event:BFN.PhotoGridChildContentEvents.DELETE,handler:this.handleChildContentDelete.bind(this)},{event:BFN.PhotoGridChildContentEvents.IMAGE_UPDATED,handler:this.handleChildContentImageUpdated.bind(this)},{event:BFN.PhotoGridChildContentEvents.IMAGE_POSITION_UPDATED,handler:this.handleChildContentImagePositionUpdated.bind(this)}],this.childContent=new BFN.PhotoGridChildContent;for(var e=0;e<this.gridChildContentEventHandlers.length;e++)this.childContent.addEventListener(this.gridChildContentEventHandlers[e].event.type,this.gridChildContentEventHandlers[e].handler);this.childContentContainer.addChild(this.childContent)},o_.prototype.initEdgeBars=function(){this.edgeBarData=["left","top","right","bottom"],this.edgeBars={},this.edgeBarContainer=new PIXI.Container,this.addChild(this.edgeBarContainer),this.handleEdgeBarOverBind=this.handleEdgeBarOver.bind(this),this.handleEdgeBarOutBind=this.handleEdgeBarOut.bind(this),this.handleEdgeBarPressedBind=this.handleEdgeBarPressed.bind(this);for(var e=0;e<this.edgeBarData.length;e++){var t=new BFN.PhotoGridChildEdgeBar(this.edgeBarData[e],this);t.id=this.edgeBarData[e],t.on("pointerover",this.handleEdgeBarOverBind),t.on("pointerout",this.handleEdgeBarOutBind),t.on("pointerdown",this.handleEdgeBarPressedBind),this.edgeBarContainer.addChild(t),this.edgeBars[t.id]=t}},o_.prototype.initTransitionAnimator=function(){this.handleTransitionAnimatorUpdateBind=this.handleTransitionAnimatorUpdate.bind(this),this.handleTransitionAnimatorUpdateCompleteBind=this.handleTransitionAnimatorUpdateComplete.bind(this),this.transitionAnimator=new BFN.Animator,this.transitionAnimator.linearSteps=16,this.transitionAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleTransitionAnimatorUpdateBind),this.transitionAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleTransitionAnimatorUpdateCompleteBind)},o_.prototype.setSize=function(e,t){this._itemWidth=Math.max(0,e),this._itemHeight=Math.max(0,t),this.updateSize()},o_.prototype.makeTransition=function(){this.updateRect(),BFN.smoothPictureDisabled=!0,this.transitionAnimator.setAnimatorFactor(0),this.transitionAnimator.increase()},o_.prototype.updateSize=function(){if(!this.destroyed)if(this._itemWidth<=1||this._itemHeight<=1)this.visible=!1;else{this.visible=!0,this.drawBackground(),this.childContent.isolated||(this.childContent.x=this._gap/2,this.childContent.y=this._gap/2,this.childContent.setSize(Math.max(0,this._itemWidth-this._gap),Math.max(0,this._itemHeight-this._gap)));var e=6/this._scale,t=new BFN.Rectangle(Math.max(e,this.childContent.x),Math.max(e,this.childContent.y),Math.min(this._itemWidth-2*e,this.childContent.itemWidth),Math.min(this._itemHeight-2*e,this.childContent.itemHeight));for(var n in this.edgeBars){var i=this.edgeBars[n];switch(n){case"top":i.x=t.x+t.width/2,i.y=0,i.setSize(t.x,t.width,this._itemWidth-t.x-t.width,t.y);break;case"bottom":i.x=t.x+t.width/2,i.y=this._itemHeight,i.setSize(this._itemWidth-t.x-t.width,t.width,t.x,this._itemHeight-t.y-t.height);break;case"left":i.x=0,i.y=t.y+t.height/2,i.setSize(this._itemHeight-t.y-t.height,t.height,t.y,t.x);break;case"right":i.x=this._itemWidth,i.y=t.y+t.height/2,i.setSize(t.y,t.height,this._itemHeight-t.y-t.height,this._itemWidth-t.x-t.width)}}}},o_.prototype.drawBackground=function(){},o_.prototype.updateRounding=function(){this.drawBackground(),this.childContent.rounding=this._rounding},o_.prototype.handleDrop=function(){BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this),"drop_grid_child_image"),this._hoveredEdge?this.dispatchEvent(BFN.PhotoGridChildEvents.INSERT_CHILD):this.childContent&&this.childContent.selectItem()},o_.prototype.updateProjectItemVO=function(){this.projectItemVO.gridCellImageID=this._menuImageVO?this._menuImageVO.id:null,this.projectItemVO.gridCellRect=this._rect.rectangleObject,this.projectItemVO.gridCellTextureOffsetFactorX=this.content.image.frameSprite.offsetFactorX,this.projectItemVO.gridCellTextureOffsetFactorY=this.content.image.frameSprite.offsetFactorY,this.projectItemVO.gridCellTextureRotate=this.content.image.frameSprite.rotate,this.projectItemVO.gridCellTextureScale=this.content.image.frameSprite.textureScale},o_.prototype.destroy=function(){if(!this._destroyed){for(var e in this._destroyed=!0,this.transitionAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleTransitionAnimatorUpdateBind),this.transitionAnimator.removeEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleTransitionAnimatorUpdateCompleteBind),this.edgeBars){var t=this.edgeBars[e];t.off("pointerover",this.handleEdgeBarOverBind),t.off("pointerout",this.handleEdgeBarOutBind),t.off("pointerdown",this.handleEdgeBarPressedBind),this.edgeBarContainer.removeChild(t),t.destroy(),this.edgeBars[e]=null,delete this.edgeBars[e]}this.edgeBars=null,this.removeChild(this.edgeBarContainer),this.edgeBarContainer=null,this.childContent.isolated&&this.childContent.dispatchEvent(BFN.PhotoGridChildContentEvents.FORCE_ISOLATION_RELEASE),this.childContentContainer.removeChild(this.childContent);for(var n=0;n<this.gridChildContentEventHandlers.length;n++)this.childContent.removeEventListener(this.gridChildContentEventHandlers[n].event.type,this.gridChildContentEventHandlers[n].handler);this.childContent.destroy(),this.childContent=null,this.removeChild(this.childContentContainer),this.childContentContainer=null,this.removeChild(this.background),this.background=null,this._menuImageVO=null,this.projectItemVO=null}},o_.prototype.updateRect=function(){this._rect.left=Math.round(this.x),this._rect.right=Math.round(this.x+this._itemWidth),this._rect.top=Math.round(this.y),this._rect.bottom=Math.round(this.y+this._itemHeight)},o_.prototype.updateGlobalBounds=function(){var e=this,t=[new PIXI.Point(0,0),new PIXI.Point(this._itemWidth,0),new PIXI.Point(this._itemWidth,this._itemHeight),new PIXI.Point(0,this._itemHeight)];for(var n in this.globalRect=null,t.forEach(function(t){var n=BFN.MainUI.toLocal(t,e);e.globalRect?(e.globalRect.left=Math.min(e.globalRect.left,n.x),e.globalRect.right=Math.max(e.globalRect.right,n.x),e.globalRect.top=Math.min(e.globalRect.top,n.y),e.globalRect.bottom=Math.max(e.globalRect.bottom,n.y)):e.globalRect=new BFN.Rectangle(n.x,n.y)}),this.globalRect?(this.globalRect.x+=BFN.MainUI.x+BFN.CSS.leftMenuBarWidth,this.globalRect.y+=BFN.MainUI.y+BFN.CSS.topMenuBarHeight):this.globalRect=new BFN.Rectangle,this.edgeBars){this.edgeBars[n].updateGlobalBounds()}},o_.prototype.handleChildContentSelect=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.SELECT_CHILD)},o_.prototype.handleChildContentDrag=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.DRAG_CHILD)},o_.prototype.handleChildContentDelete=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.DELETE_CHILD)},o_.prototype.handleChildContentImageUpdated=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.CHILD_IMAGE_UPDATED)},o_.prototype.handleChildContentImagePositionUpdated=function(e){this.dispatchEvent(BFN.PhotoGridChildEvents.CHILD_IMAGE_POSITION_UPDATED)},o_.prototype.handleEdgeBarOver=function(e){if(!BeFunky.isPointerDown||BeFunky.isPointerDown&&this._awaitingDrop){var t=e.currentTarget,n=e.data.originalEvent.shiftKey,i=e.data.originalEvent.ctrlKey||e.data.originalEvent.metaKey;this._hoveredEdge=t.id,this._attemptUngrouping=n,this._attemptSeparation=i||this._awaitingDrop,document.addEventListener("keydown",this.handleKeyDownBind),document.addEventListener("keyup",this.handleKeyUpBind),setTimeout(function(){this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)}.bind(this),0)}},o_.prototype.handleEdgeBarOut=function(e){this._hoveredEdge=null,this._attemptUngrouping=!1,this._attemptSeparation=!1,document.removeEventListener("keydown",this.handleKeyDownBind),document.removeEventListener("keyup",this.handleKeyUpBind),this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)},o_.prototype.handleEdgeBarPressed=function(e){var t=e.currentTarget,n=e.data.originalEvent.shiftKey,i=e.data.originalEvent.ctrlKey||e.data.originalEvent.metaKey,r=e.data.originalEvent.altKey;i&&r?(t.showEdgeBar&&t.animator.setAnimatorFactor(0),this.dispatchEvent(BFN.PhotoGridChildEvents.INSERT_CHILD)):("touch"==e.data.pointerType&&(this._hoveredEdge=t.id,this._attemptUngrouping=n,this._attemptSeparation=i,this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)),this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_PRESSED))},o_.prototype.handleKeyDown=function(e){e.shiftKey&&(this._attemptUngrouping=!0),(e.metaKey||e.ctrlKey)&&(this._attemptSeparation=!0),(e.metaKey||e.ctrlKey||e.shiftKey)&&this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)},o_.prototype.handleKeyUp=function(e){16==e.keyCode&&(this._attemptUngrouping=!1),17!=e.keyCode&&91!=e.keyCode&&93!=e.keyCode||(this._attemptSeparation=!1),16!=e.keyCode&&17!=e.keyCode&&91!=e.keyCode&&93!=e.keyCode||this.dispatchEvent(BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED)},o_.prototype.handleTransitionAnimatorUpdate=function(e){this.x=(this._transitionRect.x-this._rect.x)*this.transitionAnimator.animationSinFactor+this._rect.x,this.y=(this._transitionRect.y-this._rect.y)*this.transitionAnimator.animationSinFactor+this._rect.y,this.setSize((this._transitionRect.width-this._rect.width)*this.transitionAnimator.animationSinFactor+this._rect.width,(this._transitionRect.height-this._rect.height)*this.transitionAnimator.animationSinFactor+this._rect.height)},o_.prototype.handleTransitionAnimatorUpdateComplete=function(e){this.updateRect(),BFN.smoothPictureDisabled=!1,this.dispatchEvent(BFN.PhotoGridChildEvents.TRANSITION_COMPLETE)},Object.defineProperty(o_.prototype,"destroyed",{get:function(){return this._destroyed}}),Object.defineProperty(o_.prototype,"id",{set:function(e){this._id=e},get:function(){return this._id}}),Object.defineProperty(o_.prototype,"contentContainer",{get:function(){return this.childContentContainer}}),Object.defineProperty(o_.prototype,"content",{get:function(){return this.childContent}}),Object.defineProperty(o_.prototype,"backgroundColor",{set:function(e){this.childContent.backgroundColor=e},get:function(){return this.childContent.backgroundColor}}),Object.defineProperty(o_.prototype,"borderColor",{set:function(e){this.childContent.borderColor=e},get:function(){return this.childContent.borderColor}}),Object.defineProperty(o_.prototype,"gap",{set:function(e){this._gap=e,this.updateSize()},get:function(){return this._gap}}),Object.defineProperty(o_.prototype,"rounding",{set:function(e){this._rounding=e,this.updateRounding()},get:function(){return this._rounding}}),Object.defineProperty(o_.prototype,"scale",{set:function(e){this._scale=e,this.childContent.image.scale=this._scale,this.updateSize()},get:function(){return this._scale}}),Object.defineProperty(o_.prototype,"hoveredEdge",{get:function(){return this._hoveredEdge}}),Object.defineProperty(o_.prototype,"hoveredEdgeLocked",{get:function(){return"left"==this._hoveredEdge&&0==this._factorRect.left||"top"==this._hoveredEdge&&0==this._factorRect.top||"right"==this._hoveredEdge&&1==this._factorRect.right||"bottom"==this._hoveredEdge&&1==this._factorRect.bottom}}),Object.defineProperty(o_.prototype,"rect",{get:function(){return this._rect}}),Object.defineProperty(o_.prototype,"factorRect",{get:function(){return this._factorRect}}),Object.defineProperty(o_.prototype,"attemptUngrouping",{get:function(){return this._attemptUngrouping}}),Object.defineProperty(o_.prototype,"attemptSeparation",{get:function(){return this._attemptSeparation}}),Object.defineProperty(o_.prototype,"dragPosition",{set:function(e){this._dragPosition=e},get:function(){return this._dragPosition}}),Object.defineProperty(o_.prototype,"transitionRect",{get:function(){return this._transitionRect}}),Object.defineProperty(o_.prototype,"awaitingDrop",{set:function(e){this._awaitingDrop=this.childContent.awaitingDrop=e},get:function(){return this._awaitingDrop}}),Object.defineProperty(o_.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateSize()},get:function(){return this._itemWidth}}),Object.defineProperty(o_.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateSize()},get:function(){return this._itemHeight}}),Object.defineProperty(o_.prototype,"menuImageVO",{set:function(e){this._menuImageVO=e,this.updateProjectItemVO()},get:function(){return this._menuImageVO}}),BFN.PhotoGridChild=o_,s_.prototype=Object.create(PIXI.Container.prototype),s_.prototype.init=function(){BeFunky.log("PhotoGridIsolator Init"),this.initDefaultValues(),this.initVeil(),this.initContentContainer(),this.initAnimator()},s_.prototype.initDefaultValues=function(){this.visible=!1,this._padding=0,this._itemWidth=0,this._itemHeight=0,this.originalPosition=new PIXI.Point,this.hovered=!1,this.dragging=!1,this.gridChild=null,this.handleMainUIMouseDownBind=this.handleMainUIMouseDown.bind(this),this.handleForceIsolationReleaseBind=this.handleForceIsolationRelease.bind(this)},s_.prototype.initVeil=function(){this.veil=new PIXI.Graphics,this.veil.interactive=!0,this.veil.beginFill(1909805,.7),this.veil.drawRect(0,0,100,100),this.veil.endFill(),this.addChild(this.veil)},s_.prototype.initContentContainer=function(){this.contentContainer=new PIXI.Container,this.addChild(this.contentContainer)},s_.prototype.initAnimator=function(){this.handleAnimatorUpdateBind=this.handleAnimatorUpdate.bind(this),this.handleAnimatorDecreaseCompleteBind=this.handleAnimatorDecreaseComplete.bind(this),this.animator=new BFN.Animator,this.animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this.animator.addEventListener(BFN.AnimatorEvents.DECREASE_COMPLETE.type,this.handleAnimatorDecreaseCompleteBind),this.animator.setAnimatorFactor(0)},s_.prototype.captureGridChild=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&!this.gridChild&&(this.gridChild=e,this.gridChild.content.isolated=!0,this.originalPosition.x=this.gridChild.content.x,this.originalPosition.y=this.gridChild.content.y,this.gridChild.content.addEventListener(BFN.PhotoGridChildContentEvents.FORCE_ISOLATION_RELEASE.type,this.handleForceIsolationReleaseBind),this.gridChild.content.x=this.gridChild.x+this.gridChild.content.x,this.gridChild.content.y=this.gridChild.y+this.gridChild.content.y,this.contentContainer.addChild(this.gridChild.content),this.frameSprite=this.gridChild.content.image.frameSprite,this.initialOffsetFactorX=this.frameSprite.offsetFactorX,this.initialOffsetFactorY=this.frameSprite.offsetFactorY,this.initialScale=this.frameSprite.textureScale,this.initialRotate=this.frameSprite.texture.rotate,BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIMouseDownBind),this.visible=!0,t?(this.animator.setAnimatorFactor(1),this.animator.dispatchEvent(BFN.AnimatorEvents.INCREASE_COMPLETE)):this.animator.increase(),document.querySelectorAll(".draggable-panel").addClass("disabled"),BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this.gridChild),"enter_grid_child_edit","app_action"))},s_.prototype.releaseGridChild=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];BFN.MainUI.removeEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIMouseDownBind),e?(this.animator.setAnimatorFactor(0),this.animator.dispatchEvent(BFN.AnimatorEvents.DECREASE_COMPLETE)):this.animator.decrease()},s_.prototype.updateDisplay=function(){this.veil.x=-this._padding,this.veil.y=-this._padding,this.veil.width=this._itemWidth+2*this._padding,this.veil.height=this._itemHeight+2*this._padding},s_.prototype.revertChanges=function(){this.gridChild&&this.frameSprite&&(this.frameSprite.offsetFactorX=this.initialOffsetFactorX,this.frameSprite.offsetFactorY=this.initialOffsetFactorY,this.frameSprite.textureScale=this.initialScale,this.frameSprite.texture.rotate=this.initialRotate,this.frameSprite.updateDisplay(),this.gridChild.content.image.updateSmoothing())},s_.prototype.handleMainUIMouseDown=function(e){this.gridChild&&!this.gridChild.content.pressed&&BFN.PhotoGrid.isolateGridChild(null)},s_.prototype.handleForceIsolationRelease=function(e){this.animator.setAnimatorFactor(0),this.handleAnimatorDecreaseCompleteBind(null)},s_.prototype.handleAnimatorUpdate=function(e){this.veil.alpha=this.animator.animationFactor},s_.prototype.handleAnimatorDecreaseComplete=function(e){this.gridChild&&(this.gridChild.content.isolated=!1,this.gridChild.content.removeEventListener(BFN.PhotoGridChildContentEvents.FORCE_ISOLATION_RELEASE.type,this.handleForceIsolationReleaseBind),this.gridChild.content.x=this.originalPosition.x,this.gridChild.content.y=this.originalPosition.y,this.gridChild.contentContainer.addChild(this.gridChild.content),e&&(this.initialOffsetFactorX==this.frameSprite.offsetFactorX&&this.initialOffsetFactorY==this.frameSprite.offsetFactorY&&this.initialScale==this.frameSprite.textureScale&&this.initialRotate==this.frameSprite.texture.rotate||this.gridChild.content.dispatchEvent(BFN.PhotoGridChildContentEvents.IMAGE_UPDATED)),BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this.gridChild),"exit_grid_child_edit","app_action"),this.gridChild=null,this.frameSprite=null),this.visible=!1,document.querySelectorAll(".draggable-panel").removeClass("disabled"),BFN.HiResTextManager.updateHighResText()},Object.defineProperty(s_.prototype,"padding",{set:function(e){this._padding=e,this.updateDisplay()},get:function(){return this._padding}}),Object.defineProperty(s_.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(s_.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),BFN.PhotoGridIsolator=s_,l_.prototype=Object.create(PIXI.Container.prototype),l_.prototype.init=function(){BeFunky.log("PhotoGridDragBar Init"),this.initDefaultValues(),this.initBlock(),this.initIndicator(),this.initAnimator()},l_.prototype.initDefaultValues=function(){this.baseSize=2,this._direction="horizontal",this._length=this.baseSize,this._scale=1,this._indicatorSide=null},l_.prototype.initBlock=function(){this.blockContainer=new PIXI.Container,this.addChild(this.blockContainer),this.block=new PIXI.Graphics,this.block.beginFill(0),this.block.drawRect(-this.baseSize/2,-this.baseSize/2,this.baseSize,this.baseSize),this.block.endFill(),this.blockContainer.addChild(this.block),this.block.dashedLineFilter=new BFN.filters.DashedLineFilter,this.block.dashedLineFilter.dashSize=10,this.block.filters=[this.block.dashedLineFilter]},l_.prototype.initIndicator=function(){this.indicatorContainer=new PIXI.Container,this.addChild(this.indicatorContainer),this.indicator=new PIXI.Graphics,this.indicator.beginFill(0),this.indicator.drawRect(-this.baseSize/2,-this.baseSize/2,this.baseSize,this.baseSize),this.indicator.endFill(),this.indicatorContainer.addChild(this.indicator),this.indicator.dashedLineFilter=new BFN.filters.DashedLineFilter,this.indicator.dashedLineFilter.dashSize=10,this.indicator.filters=[this.indicator.dashedLineFilter]},l_.prototype.initAnimator=function(){this.handleAnimatorUpdateBind=this.handleAnimatorUpdate.bind(this),this._animator=new BFN.Animator,this._animator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleAnimatorUpdateBind),this._animator.setAnimatorFactor(0)},l_.prototype.show=function(){this._animator.increase()},l_.prototype.hide=function(){this._animator.decrease()},l_.prototype.updateDisplay=function(){this.block.width="horizontal"==this._direction?this._length:this.baseSize,this.block.height="vertical"==this._direction?this._length:this.baseSize,this.indicator.width="horizontal"==this._direction?.96*this._length:this.baseSize,this.indicator.height="vertical"==this._direction?.96*this._length:this.baseSize,this.updateScale()},l_.prototype.updateScale=function(){if(this.blockContainer.scale.x=this.indicatorContainer.scale.x="vertical"==this._direction?1/this._scale:1,this.blockContainer.scale.y=this.indicatorContainer.scale.y="horizontal"==this._direction?1/this._scale:1,this.indicatorContainer.x=0,this.indicatorContainer.y=0,this._indicatorSide)switch(this.indicator.visible=!0,this._indicatorSide){case"left":this.indicatorContainer.x=4*this.baseSize/this._scale;break;case"top":this.indicatorContainer.y=4*this.baseSize/this._scale;break;case"right":this.indicatorContainer.x=-4*this.baseSize/this._scale;break;case"bottom":this.indicatorContainer.y=-4*this.baseSize/this._scale}else this.indicator.visible=!1},l_.prototype.handleAnimatorUpdate=function(e){this.blockContainer.alpha=.8*this._animator.animationFactor+.2,this.visible=this._animator.animationFactor>0},Object.defineProperty(l_.prototype,"animator",{get:function(){return this._animator}}),Object.defineProperty(l_.prototype,"direction",{set:function(e){this._direction=e,this.updateDisplay()},get:function(){return this._direction}}),Object.defineProperty(l_.prototype,"length",{set:function(e){this._length=e,this.updateDisplay()},get:function(){return this._length}}),Object.defineProperty(l_.prototype,"scale",{set:function(e){this._scale=e,this.updateScale()},get:function(){return this._scale}}),Object.defineProperty(l_.prototype,"indicatorSide",{set:function(e){this._indicatorSide=e,this.updateDisplay()},get:function(){return this._indicatorSide}}),BFN.PhotoGridDragBar=l_,u_.prototype=Object.create(PIXI.Container.prototype),u_.prototype.init=function(){BeFunky.log("PhotoGridEdgeIndicator Init"),this.initDefaultValues(),this.initDisplay(),this.initDashedFilter()},u_.prototype.initDefaultValues=function(){this.visible=!1,this._direction="horizontal",this._length=100,this._offset=0,this._scale=1},u_.prototype.initDisplay=function(){this.holder=new PIXI.Container,this.addChild(this.holder),this.outerIndicator=new PIXI.Graphics,this.holder.addChild(this.outerIndicator),this.innerIndicator=new PIXI.Graphics,this.innerIndicator.visible=!1,this.holder.addChild(this.innerIndicator)},u_.prototype.initDashedFilter=function(){this.dashedLineFilter=new BFN.filters.DashedLineFilter,this.dashedLineFilter.dashSize=10,this.filters=[this.dashedLineFilter]},u_.prototype.drawIndicators=function(){switch(this.outerIndicator.clear(),this.innerIndicator.clear(),this.holder.scale.x=this.holder.scale.y=1,this.outerIndicator.beginFill(0),this.innerIndicator.beginFill(8421504),this._direction){case"horizontal":this.outerIndicator.drawRect(-50,-1,100,2),this.innerIndicator.drawRect(-50,-1,100,2);break;case"vertical":this.outerIndicator.drawRect(-1,-50,2,100),this.innerIndicator.drawRect(-1,-50,2,100)}this.updateLength(),this.updateOffset(),this.updateScale()},u_.prototype.updateLength=function(){switch(this._direction){case"horizontal":this.holder.scale.x=(this._length-4*Math.abs(this._offset/this._scale))/100,this.holder.scale.y=1/this._scale;break;case"vertical":this.holder.scale.x=1/this._scale,this.holder.scale.y=(this._length-4*Math.abs(this._offset/this._scale))/100}},u_.prototype.updateOffset=function(){switch(this.holder.x=this.holder.y=0,this._direction){case"horizontal":this.holder.y=this._offset/this._scale;break;case"vertical":this.holder.x=this._offset/this._scale}this.updateLength()},u_.prototype.updateScale=function(){this.updateLength()},Object.defineProperty(u_.prototype,"direction",{set:function(e){"horizontal"!=e&&"vertical"!=e||(this._direction=e,this.drawIndicators())},get:function(){return this._direction}}),Object.defineProperty(u_.prototype,"length",{set:function(e){this._length=e,this.updateLength()},get:function(){return this._length}}),Object.defineProperty(u_.prototype,"offset",{set:function(e){this._offset=e,this.updateOffset()},get:function(){return this._length}}),Object.defineProperty(u_.prototype,"scale",{set:function(e){this._scale=e,this.updateOffset(),this.updateScale()},get:function(){return this._scale}}),Object.defineProperty(u_.prototype,"showing",{set:function(e){this.visible=e},get:function(){return this.visible}}),Object.defineProperty(u_.prototype,"selected",{set:function(e){this.outerIndicator=!e,this.innerIndicator.visible=e},get:function(){return this.innerIndicator.visible}}),BFN.PhotoGridEdgeIndicator=u_,BFN.PhotoGridEvents={PHOTO_GRID_SNAP_SHOT:new Event("PHOTO_GRID_SNAP_SHOT")},c_.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),c_.prototype.init=function(){BeFunky.log("PhotoGrid Init"),this.initDefaultValues(),this.initGridContainer(),this.initChildContainer(),this.initDragBar(),this.initEdgeIndicators(),this.initMenu(),this.initGridIsolator(),this.initDragger(),this.setSize(0,0)},c_.prototype.initDefaultValues=function(){this.minSize=2*BFN.minImageSize,this.snapDistance=5,this.maxGap=0,this.maxGapFactor=.1,this._gridChildIsolated=!1,this._scale=1,this._backgroundColor="FFFFFF",this._gap=0,this._rounding=0,this.childBackgroundColor="000000",this.childBorderColor="000000",this._gridChildren=[],this._focusedChild=null,this._targetChild=null,this._selectedChild=null,this._draggedChild=null,this._awaitingDrop=!1,this._matchesTemplate=!1,this.includedChildren=[],this.excludedChildren=[],this.attachedChildren=[],this.transitionChildren=[],this.positions=[],this.intersectRect=new BFN.Rectangle,this.snapCoords=[],this.separationAchieved=!1,this.dragBarPosition=0,this._insertedGridChild=null,this.handleChildMouseOverBind=this.handleChildMouseOver.bind(this),this.handleChildMouseOutBind=this.handleChildMouseOut.bind(this),this.gridChildEventHandlers=[{event:BFN.PhotoGridChildEvents.EDGE_BAR_HOVERED,handler:this.handleEdgeBarHovered.bind(this)},{event:BFN.PhotoGridChildEvents.EDGE_BAR_PRESSED,handler:this.handleEdgeBarPressed.bind(this)},{event:BFN.PhotoGridChildEvents.INSERT_CHILD,handler:this.handleInsertChild.bind(this)},{event:BFN.PhotoGridChildEvents.SELECT_CHILD,handler:this.handleSelectChild.bind(this)},{event:BFN.PhotoGridChildEvents.DRAG_CHILD,handler:this.handleDragChild.bind(this)},{event:BFN.PhotoGridChildEvents.DELETE_CHILD,handler:this.handleDeleteChild.bind(this)},{event:BFN.PhotoGridChildEvents.CHILD_IMAGE_UPDATED,handler:this.handleChildImageUpdated.bind(this)},{event:BFN.PhotoGridChildEvents.CHILD_IMAGE_POSITION_UPDATED,handler:this.handleChildImagePositionUpdated.bind(this)},{event:BFN.PhotoGridChildEvents.TRANSITION_COMPLETE,handler:this.handleChildTransitionComplete.bind(this)}],this.handleEdgeBarReleasedBind=this.handleEdgeBarReleased.bind(this),this.handleDropChildBind=this.handleDropChild.bind(this),this.detectingTouchDragHovers=!1,this.detectHoversManuallyBind=this.detectHoversManually.bind(this),this.stopTouchDragHoverDetectionBind=this.stopTouchDragHoverDetection.bind(this)},c_.prototype.initGridContainer=function(){this.gridContainer=new PIXI.Container,this.addChild(this.gridContainer)},c_.prototype.initChildContainer=function(){this.childContainer=new PIXI.Container,this.gridContainer.addChild(this.childContainer)},c_.prototype.initDragBar=function(){this.dragBar=new BFN.PhotoGridDragBar,this.gridContainer.addChild(this.dragBar)},c_.prototype.initEdgeIndicators=function(){this.edgeIndicatorData=[{id:"left",direction:"vertical",offset:5},{id:"top",direction:"horizontal",offset:5},{id:"right",direction:"vertical",offset:-5},{id:"bottom",direction:"horizontal",offset:-5}],this.edgeIndicators={},this.edgeIndicatorContainer=new PIXI.Container,this.addChild(this.edgeIndicatorContainer);for(var e=0;e<this.edgeIndicatorData.length;e++){var t=this.edgeIndicatorData[e],n=new BFN.PhotoGridEdgeIndicator;n.direction=t.direction,n.offset=t.offset,this.edgeIndicators[t.id]=n,this.edgeIndicatorContainer.addChild(n)}},c_.prototype.initMenu=function(){var e=this;this.contextMenu=document.getElementById("context_menu_collage"),BeFunky.contextMenu(this.contextMenu,{add_image:{onClick:this.handleAddImage.bind(this)},edit_image:{onClick:this.handleEditImage.bind(this)},remove_image:{onClick:this.handleRemoveImage.bind(this)},delete_cell:{onClick:this.handleDeleteCell.bind(this)}}),this.contextMenu.target=document.querySelector("#appStage canvas"),this.contextMenu.enabled=!1,this.contextMenu.addEventListener("SHOW",function(){e.contextMenu.enabled=!1})},c_.prototype.initGridIsolator=function(){this.gridIsolator=new BFN.PhotoGridIsolator,this.addChild(this.gridIsolator)},c_.prototype.initDragger=function(){this.dragger=new BFN.Dragger,this.dragger.autoDrag=!1,this.dragger.stickyDrag=!1,this.dragger.preventSelectionDrag=!0,this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleDragging.bind(this)),this.dragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleDraggingComplete.bind(this))},c_.prototype.setSize=function(e,t){this._itemWidth=e,this._itemHeight=t,this.hitArea=new PIXI.Rectangle(0,0,e,t),this.updateDisplay(),this.updateGaps(),this._matchesTemplate&&(this._matchesTemplate=!1)},c_.prototype.showEdgeIndicators=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.edgeIndicators.left.showing=e>0,this.edgeIndicators.left.selected=e>1,this.edgeIndicators.top.showing=t>0,this.edgeIndicators.top.selected=t>1,this.edgeIndicators.right.showing=n>0,this.edgeIndicators.right.selected=n>1,this.edgeIndicators.bottom.showing=i>0,this.edgeIndicators.bottom.selected=i>1,BFN.MainUI.requestRender()},c_.prototype.updateDisplay=function(){this.gridIsolator.itemWidth=this._itemWidth,this.gridIsolator.itemHeight=this._itemHeight,this.edgeIndicators.left.x=-this.gapPixels,this.edgeIndicators.left.y=this._itemHeight/2,this.edgeIndicators.left.length=this._itemHeight+2*this.gapPixels,this.edgeIndicators.left.scale=this._scale,this.edgeIndicators.top.x=this._itemWidth/2,this.edgeIndicators.top.y=-this.gapPixels,this.edgeIndicators.top.length=this._itemWidth+2*this.gapPixels,this.edgeIndicators.top.scale=this._scale,this.edgeIndicators.right.x=this._itemWidth+this.gapPixels,this.edgeIndicators.right.y=this._itemHeight/2,this.edgeIndicators.right.length=this._itemHeight+2*this.gapPixels,this.edgeIndicators.right.scale=this._scale,this.edgeIndicators.bottom.x=this._itemWidth/2,this.edgeIndicators.bottom.y=this._itemHeight+this.gapPixels,this.edgeIndicators.bottom.length=this._itemWidth+2*this.gapPixels,this.edgeIndicators.bottom.scale=this._scale;for(var e=0;e<this._gridChildren.length;e++){var t=this._gridChildren[e];t.x=Math.round(t.factorRect.left*this._itemWidth),t.y=Math.round(t.factorRect.top*this._itemHeight),t.setSize(Math.round(t.factorRect.right*this._itemWidth)-t.x,Math.round(t.factorRect.bottom*this._itemHeight)-t.y),t.content.image.setPhotoGridDimensions(this._itemWidth,this._itemHeight)}},c_.prototype.setMaxGapFromDimensions=function(e,t){this.maxGap=Math.round(Math.min(e,t)*this.maxGapFactor)},c_.prototype.updateGaps=function(){for(var e=0;e<this._gridChildren.length;e++){this._gridChildren[e].gap=this._gap*this.maxGap}this.gridIsolator.padding=this._gap*this.maxGap},c_.prototype.updateRounding=function(){for(var e=0;e<this._gridChildren.length;e++){this._gridChildren[e].rounding=this._rounding}},c_.prototype.addGridChild=function(e,t,n,i){var r=new BFN.PhotoGridChild;r.x=e,r.y=t,r.setSize(n,i),r.backgroundColor=this.childBackgroundColor,r.borderColor=this.childBorderColor,r.gap=this._gap*this.maxGap,r.rounding=this._rounding,r.scale=this._scale,r.on("pointerover",this.handleChildMouseOverBind),r.on("pointerout",this.handleChildMouseOutBind);for(var a=0;a<this.gridChildEventHandlers.length;a++)r.addEventListener(this.gridChildEventHandlers[a].event.type,this.gridChildEventHandlers[a].handler);return this.childContainer.addChild(r),this._gridChildren.push(r),this.updateRect(r),this.updateFactorRect(r),r.content.image.setPhotoGridDimensions(this._itemWidth,this._itemHeight),this._matchesTemplate&&(this._matchesTemplate=!1),r},c_.prototype.clearAllGridChildren=function(){for(var e=this._gridChildren.length;--e>-1;){var t=this._gridChildren[e];this.clearGridChild(t)}},c_.prototype.clearGridChild=function(e){e.menuImageVO=null,e.content.setImage(null)},c_.prototype.removeAllGridChildren=function(){for(var e=this._gridChildren.length;--e>-1;){var t=this._gridChildren[e];this.removeGridChild(t)}this._gridChildren.splice(0)},c_.prototype.removeGridChild=function(e){if(-1!==this._gridChildren.indexOf(e)&&-1!==this.childContainer.getChildIndex(e)){e.off("pointerover",this.handleChildMouseOverBind),e.off("pointerout",this.handleChildMouseOutBind);for(var t=0;t<this.gridChildEventHandlers.length;t++)e.removeEventListener(this.gridChildEventHandlers[t].event.type,this.gridChildEventHandlers[t].handler);e.destroy(),this.childContainer.removeChild(e),this._gridChildren.splice(this._gridChildren.indexOf(e),1),e=null,this._matchesTemplate&&(this._matchesTemplate=!1)}},c_.prototype.isolateGridChild=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(this._gridChildIsolated=!0,BFN.CollageMakerCanvas.canvasScaleBars.enabled=!1,this.gridIsolator.captureGridChild(e),BFN.CollageMakerCanvas.transformLayer.visible=!1,UIToggler.toggleAlternateMenu(!0,"collage_image_header","collage_image_menu"),UITools.setToolValue("collage_image","size",100*e.content.image.resizeScale),UITools.updateToolControl("collage_image_size")):(this._gridChildIsolated=!1,BFN.CollageMakerCanvas.canvasScaleBars.enabled=!0,this.gridIsolator.releaseGridChild(t),BFN.CollageMakerCanvas.transformLayer.visible=!0,UIToggler.toggleAlternateMenu(!1),this.selectedChild=null)},c_.prototype.hideDragBar=function(){this.dragBar.hide()},c_.prototype.getPhotoGridSnapShot=function(){this.dispatchEvent(BFN.PhotoGridEvents.PHOTO_GRID_SNAP_SHOT)},c_.prototype.toggleEmptyCells=function(e){for(var t=0;t<this._gridChildren.length;t++){var n=this._gridChildren[t];n.visible=!((n.content.isEmpty||!n.content.imageEnabled)&&!e),n.content.background.visible=(n.content.isEmpty||!n.content.imageEnabled)&&e}},c_.prototype.toggleBorders=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this._gridChildren.length;n++){this._gridChildren[n].content.toggleBorder(e,t)}},c_.prototype.repair=function(){for(var e={},t={},n=0;n<this._gridChildren.length;n++){var i=this._gridChildren[n];this.updateRect(i),this.updateFactorRect(i),e.hasOwnProperty(i.rect.left)||(e[i.rect.left]=[]),e.hasOwnProperty(i.rect.right)||(e[i.rect.right]=[]),e[i.rect.left].push(i),e[i.rect.right].push(i),t.hasOwnProperty(i.rect.top)||(t[i.rect.top]=[]),t.hasOwnProperty(i.rect.bottom)||(t[i.rect.bottom]=[]),t[i.rect.top].push(i),t[i.rect.bottom].push(i)}var r=this.repairChildren(e,"x"),a=this.repairChildren(t,"y");(r||a)&&(console.log(""),r&&console.log("Repaired Coordinates for ".concat(r," Children on X-Axis")),a&&console.log("Repaired Coordinates for ".concat(a," Children on Y-Axis")))},c_.prototype.repairChildren=function(e,t){var n=this,i=[],r={},a=Object.keys(e);a.sort(function(e,t){return e-t});for(var o=a.length;--o>0;){var s=a[o],l=a[o-1];Math.abs(s-l)<=1&&(i=i.concat(e[s]),e[l]=e[l].concat(e[s]),e[s].splice(0),delete e[s],r[s]=parseInt(l),a.splice(o,1))}return(i=i.unique()).forEach(function(e){var i=e.itemWidth,a=e.itemHeight;switch(t){case"x":r.hasOwnProperty(e.rect.left)&&(i+=e.rect.left-r[e.rect.left],e.x=r[e.rect.left]),r.hasOwnProperty(e.rect.right)&&(i+=r[e.rect.right]-e.rect.right),e.setSize(i,a);break;case"y":r.hasOwnProperty(e.rect.top)&&(a+=e.rect.top-r[e.rect.top],e.y=r[e.rect.top]),r.hasOwnProperty(e.rect.bottom)&&(a+=r[e.rect.bottom]-e.rect.bottom),e.setSize(i,a)}n.updateRect(e),n.updateFactorRect(e)}),i.length},c_.prototype.updateRect=function(e){e.updateRect()},c_.prototype.updateFactorRect=function(e){e.factorRect.left=Math.max(0,e.x/this._itemWidth),e.factorRect.right=Math.min(1,(e.x+e.itemWidth)/this._itemWidth),e.factorRect.top=Math.max(0,e.y/this._itemHeight),e.factorRect.bottom=Math.min(1,(e.y+e.itemHeight)/this._itemHeight)},c_.prototype.setChildVeilVisibility=function(e){for(var t=0;t<this._gridChildren.length;t++){this._gridChildren[t].content.veil.visible=e}},c_.prototype.getGridMenuImageVOs=function(){for(var e=[],t=0;t<this.gridChildren.length;t++){var n=this.gridChildren[t];n.menuImageVO&&e.push(n.menuImageVO)}return e},c_.prototype.getChildUnderPosition=function(e,t){var n=BFN.CollageMakerCanvas.toLocal(new PIXI.Point,this.childContainer);e-=n.x,t-=n.y;for(var i=0;i<this.gridChildren.length;i++){var r=this.gridChildren[i];if(r.rect.contains(e,t))return r}return null},c_.prototype.handleAddImage=function(e){this._selectedChild&&!this._selectedChild.destroyed&&(this._targetChild=this._selectedChild,BFN.ImageLibraryManager.uploadImages(function(e){!e.isComplete&&e.menuImageVO&&BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO)},{allowMultiple:!1}))},c_.prototype.handleEditImage=function(e){this._selectedChild&&!this._selectedChild.destroyed&&this.isolateGridChild(this._selectedChild)},c_.prototype.handleRemoveImage=function(e){this._selectedChild&&!this._selectedChild.destroyed&&(this._selectedChild.content.isEmpty||(this._selectedChild.menuImageVO=null,this._selectedChild.content.setImage(null)))},c_.prototype.handleDeleteCell=function(e){this._selectedChild&&!this._selectedChild.destroyed&&(this._selectedChild.content.isEmpty||(this._selectedChild.menuImageVO=null,this._selectedChild.content.setImage(null,!0,!0)),this._selectedChild.content.deleteItem(e.ctrlKey||e.metaKey))},c_.prototype.handleDragging=function(e){if(this.dragger.wasDragged){this.dragBar.x=Math.round(this.dragger.draggedX),this.dragBar.y=Math.round(this.dragger.draggedY);for(var t=!0,n=null,i=0;i<this.snapCoords.length;i++){var r=this.snapCoords[i];switch(this.dragBar.direction){case"horizontal":Math.abs(this.dragBar.y-r)<this.snapDistance/this._scale&&(n=Math.round(r));break;case"vertical":Math.abs(this.dragBar.x-r)<this.snapDistance/this._scale&&(n=Math.round(r))}}if(null!==n){for(var a=0;a<this.includedChildren.length;a++){var o=this.includedChildren[a],s=void 0;switch(this.dragBar.direction){case"horizontal":s="after"==o.dragPosition?o.rect.bottom-n:n-o.rect.top;break;case"vertical":s="after"==o.dragPosition?o.rect.right-n:n-o.rect.left}if(s<this.minSize+2*this.gapPixels){t=!1;break}}if(t)switch(this.dragBar.direction){case"horizontal":this.dragBar.y=n;break;case"vertical":this.dragBar.x=n}}for(var l=0;l<this.includedChildren.length;l++){var u=this.includedChildren[l];switch(this.dragBar.direction){case"horizontal":u.y="after"==u.dragPosition?this.dragBar.y:u.y,u.itemHeight="after"==u.dragPosition?u.rect.bottom-this.dragBar.y:this.dragBar.y-u.rect.top;break;case"vertical":u.x="after"==u.dragPosition?this.dragBar.x:u.x,u.itemWidth="after"==u.dragPosition?u.rect.right-this.dragBar.x:this.dragBar.x-u.rect.left}this.updateFactorRect(u)}}},c_.prototype.handleDraggingComplete=function(e){this.dragBar.hide(),this._matchesTemplate&&(this._matchesTemplate=!1)},c_.prototype.handleChildMouseOver=function(e){var t=this,n=e.currentTarget;setTimeout(function(){t._focusedChild=n},0)},c_.prototype.handleChildMouseOut=function(e){this._focusedChild=null},c_.prototype.handleEdgeBarHovered=function(e){var t=e.dispatcher;if(t.hoveredEdge&&!this.dragger.item){this.includedChildren.splice(0),this.includedChildren.push(t);var n=new BFN.Rectangle,i=null;switch(t.hoveredEdge){case"left":case"right":n.top=t.y,n.bottom=t.y+t.itemHeight,n.left=n.right=t.x+("right"==t.hoveredEdge?t.itemWidth:0),i="vertical";break;case"top":case"bottom":n.left=t.x,n.right=t.x+t.itemWidth,n.top=n.bottom=t.y+("bottom"==t.hoveredEdge?t.itemHeight:0),i="horizontal"}if(this.separationAchieved=!1,t.attemptSeparation)this.separationAchieved=!0;else if(t.attemptUngrouping&&!t.hoveredEdgeLocked)for(var r=0;r<this._gridChildren.length;r++)if(t=this._gridChildren[r],-1==this.includedChildren.indexOf(t))switch(i){case"vertical":t.x!=n.x&&t.x+t.itemWidth!=n.x||t.y==n.top&&t.y+t.itemHeight==n.bottom&&(this.includedChildren.push(t),this.separationAchieved=!0);break;case"horizontal":t.y!=n.y&&t.y+t.itemHeight!=n.y||t.x==n.left&&t.x+t.itemWidth==n.right&&(this.includedChildren.push(t),this.separationAchieved=!0)}if(t=e.dispatcher,!this.separationAchieved&&!t.hoveredEdgeLocked)for(;;){for(var a=!1,o=0;o<this._gridChildren.length;o++)if(t=this._gridChildren[o],-1==this.includedChildren.indexOf(t))switch(i){case"vertical":t.x!=n.x&&t.x+t.itemWidth!=n.x||(t.y>=n.top&&t.y<=n.bottom||t.y+t.itemHeight>=n.top&&t.y+t.itemHeight<=n.bottom||t.y<n.top&&t.y+t.itemHeight>n.bottom)&&(n.top=Math.min(n.top,t.y),n.bottom=Math.max(n.bottom,t.y+t.itemHeight),this.includedChildren.push(t),a=!0);break;case"horizontal":t.y!=n.y&&t.y+t.itemHeight!=n.y||(t.x>=n.left&&t.x<=n.right||t.x+t.itemWidth>=n.left&&t.x+t.itemWidth<=n.right||t.x<n.left&&t.x+t.itemWidth>n.right)&&(n.left=Math.min(n.left,t.x),n.right=Math.max(n.right,t.x+t.itemWidth),this.includedChildren.push(t),a=!0)}if(!a)break}if(t=e.dispatcher,this.separationAchieved||!t.hoveredEdgeLocked){switch(i){case"horizontal":this.intersectRect.left=n.left,this.intersectRect.right=n.right,this.intersectRect.top=0,this.intersectRect.bottom=this._itemHeight;break;case"vertical":this.intersectRect.left=0,this.intersectRect.right=this._itemWidth,this.intersectRect.top=n.top,this.intersectRect.bottom=n.bottom}this.dragBar.direction=i,this.dragBar.length="horizontal"==this.dragBar.direction?n.width:n.height,this.dragBar.indicatorSide=this.separationAchieved&&t.attemptSeparation?t.hoveredEdge:null,this.dragBar.x=n.x+n.width/2,this.dragBar.y=n.y+n.height/2,this.dragBar.show(),t.awaitingDrop||(BFN.CursorScreen.cursor="arrow",BFN.CursorScreen.cursorRotation="horizontal"==this.dragBar.direction?Math.PI/2:0)}else t.hoveredEdgeLocked&&!this.separationAchieved&&(this.dragger.dragging||(this.dragBar.hide(),BFN.CursorScreen.cursor=null))}else this.dragger.dragging||(this.dragBar.hide(),BFN.CursorScreen.cursor=null)},c_.prototype.handleEdgeBarPressed=function(e){document.addEventListener(BeFunky.pointerup,this.handleEdgeBarReleasedBind),BFN.smoothPictureDisabled=!0,BFN.CursorScreen.cursorLock=!0;var t=e.dispatcher;if(!t.hoveredEdgeLocked||t.hoveredEdgeLocked&&this.separationAchieved){this.excludedChildren.splice(0);for(var n=0;n<this._gridChildren.length;n++)t=this.gridChildren[n],-1==this.includedChildren.indexOf(t)&&this.excludedChildren.push(t);this.snapCoords.splice(0),this.snapCoords.push(0),this.snapCoords.push("horizontal"==this.dragBar.direction?this._itemHeight:this._itemWidth);for(var i=0;i<this.excludedChildren.length;i++){t=this.excludedChildren[i];var r=Math.floor("horizontal"==this.dragBar.direction?t.y:t.x),a=Math.floor("horizontal"==this.dragBar.direction?t.y+t.itemHeight:t.x+t.itemWidth);-1==this.snapCoords.indexOf(r)&&this.snapCoords.push(r),-1==this.snapCoords.indexOf(a)&&this.snapCoords.push(a)}for(var o=new BFN.Rectangle(this.intersectRect.x,this.intersectRect.y,this.intersectRect.width,this.intersectRect.height),s=0;s<this.excludedChildren.length;s++)if((t=this.excludedChildren[s]).rect.x=t.x,t.rect.y=t.y,t.rect.width=t.itemWidth,t.rect.height=t.itemHeight,t.rect.intersects(this.intersectRect))switch(this.dragBar.direction){case"horizontal":t.rect.bottom<=this.dragBar.y?o.top=Math.max(o.top,t.rect.bottom):t.rect.top>=this.dragBar.y&&(o.bottom=Math.min(o.bottom,t.rect.top));break;case"vertical":t.rect.right<=this.dragBar.x?o.left=Math.max(o.left,t.rect.right):t.rect.left>=this.dragBar.x&&(o.right=Math.min(o.right,t.rect.left))}for(var l=0;l<this.includedChildren.length;l++)if((t=this.includedChildren[l]).rect.x=t.x,t.rect.y=t.y,t.rect.width=t.itemWidth,t.rect.height=t.itemHeight,t.rect.intersects(this.intersectRect)){var u=this.minSize+2*this.gapPixels;switch(this.dragBar.direction){case"horizontal":t.rect.top<this.dragBar.y?o.top=Math.max(o.top,t.rect.top+u):t.rect.bottom>this.dragBar.y&&(o.bottom=Math.min(o.bottom,t.rect.bottom-u)),t.rect.bottom==this.dragBar.y?t.dragPosition="before":t.rect.top==this.dragBar.y&&(t.dragPosition="after");break;case"vertical":t.rect.left<this.dragBar.x?o.left=Math.max(o.left,t.rect.left+u):t.rect.right>this.dragBar.x&&(o.right=Math.min(o.right,t.rect.right-u)),t.rect.right==this.dragBar.x?t.dragPosition="before":t.rect.left==this.dragBar.x&&(t.dragPosition="after")}}switch(this.intersectRect.x=o.x,this.intersectRect.y=o.y,this.intersectRect.width=o.width,this.intersectRect.height=o.height,this.dragBar.direction){case"horizontal":this.dragBarPosition=this.dragBar.y,this.intersectRect.top<this.intersectRect.bottom?this.dragger.setBounds(this.dragBar.x,this.intersectRect.top,this.dragBar.x,this.intersectRect.bottom):this.dragger.setBounds(this.dragBar.x,this.dragBar.y,this.dragBar.x,this.dragBar.y);break;case"vertical":this.dragBarPosition=this.dragBar.x,this.intersectRect.left<this.intersectRect.right?this.dragger.setBounds(this.intersectRect.left,this.dragBar.y,this.intersectRect.right,this.dragBar.y):this.dragger.setBounds(this.dragBar.x,this.dragBar.y,this.dragBar.x,this.dragBar.y)}this.dragger.drag(this.dragBar)}},c_.prototype.handleEdgeBarReleased=function(e){switch(document.removeEventListener(BeFunky.pointerup,this.handleEdgeBarReleasedBind),BFN.smoothPictureDisabled=!1,BFN.CursorScreen.cursorLock=!1,this.dragBar.direction){case"horizontal":this.dragBar.y!=this.dragBarPosition&&(BFN.CollageMakerHistoryModel.historyAction="layout_updated",this.getPhotoGridSnapShot());break;case"vertical":this.dragBar.x!=this.dragBarPosition&&(BFN.CollageMakerHistoryModel.historyAction="layout_updated",this.getPhotoGridSnapShot())}},c_.prototype.handleInsertChild=function(e){BFN.CollageMakerHistoryModel.historyAction="grid_cell_inserted";var t=e.dispatcher,n=t.hoveredEdge;this.attachedChildren.splice(0),this.attachedChildren.push(t);for(var i,r,a,o,s=new BFN.Rectangle(t.x,t.y,t.itemWidth,t.itemHeight);;){for(var l=!1,u=0;u<this._gridChildren.length;u++){var c=this._gridChildren[u];if(-1==this.attachedChildren.indexOf(c))switch(this.dragBar.direction){case"vertical":c.x!=s.right&&c.x+c.itemWidth!=s.left||c.y==s.top&&c.y+c.itemHeight==s.bottom&&(s.left=Math.min(s.left,c.x),s.right=Math.max(s.right,c.x+c.itemWidth),this.attachedChildren.push(c),l=!0);break;case"horizontal":c.y!=s.bottom&&c.y+c.itemHeight!=s.top||c.x==s.left&&c.x+c.itemWidth==s.right&&(s.top=Math.min(s.top,c.y),s.bottom=Math.max(s.bottom,c.y+c.itemHeight),this.attachedChildren.push(c),l=!0)}}if(!l)break}switch(this._insertedGridChild=null,this.dragBar.direction){case"vertical":this.attachedChildren.sort(function(e,t){return e.x-t.x}),i=s.width/(this.attachedChildren.length+1),r=(s.width-i)/s.width,i=s.width;for(var h=0;h<this.attachedChildren.length;h++){var d=this.attachedChildren[h];d.transitionRect.width=Math.round(d.itemWidth*r),d.transitionRect.height=d.itemHeight,i-=d.transitionRect.width,d==e.dispatcher&&(a="left"==n?h:h+1)}this._insertedGridChild=this.addGridChild(t.x+("left"==n?0:t.itemWidth),s.y,0,s.height),this._insertedGridChild.content.flashItem(),this._insertedGridChild.content.selectItem(),this.attachedChildren.splice(a,0,this._insertedGridChild),o=s.x;for(var m=0;m<this.attachedChildren.length;m++){var p=this.attachedChildren[m];p==this._insertedGridChild?(p.transitionRect.width=i,p.transitionRect.height=p.itemHeight,p.transitionRect.x=o,p.transitionRect.y=p.y,this.transitionChildren.push(p),p.makeTransition(),o+=p.transitionRect.width):(p.transitionRect.x=o,p.transitionRect.y=p.y,this.transitionChildren.push(p),p.makeTransition(),o+=p.transitionRect.width)}break;case"horizontal":this.attachedChildren.sort(function(e,t){return e.y-t.y}),i=s.height/(this.attachedChildren.length+1),r=(s.height-i)/s.height,i=s.height;for(var g=0;g<this.attachedChildren.length;g++){var f=this.attachedChildren[g];f.transitionRect.width=f.itemWidth,f.transitionRect.height=Math.round(f.itemHeight*r),i-=f.transitionRect.height,f==e.dispatcher&&(a="top"==n?g:g+1)}this._insertedGridChild=this.addGridChild(s.x,t.y+("top"==n?0:t.itemHeight),s.width,0),this._insertedGridChild.content.flashItem(),this._insertedGridChild.content.selectItem(),this.attachedChildren.splice(a,0,this._insertedGridChild),o=s.y;for(var v=0;v<this.attachedChildren.length;v++){var y=this.attachedChildren[v];y==this._insertedGridChild?(y.transitionRect.width=y.itemWidth,y.transitionRect.height=i,y.transitionRect.x=y.x,y.transitionRect.y=o,this.transitionChildren.push(y),y.makeTransition(),o+=y.transitionRect.height):(y.transitionRect.x=y.x,y.transitionRect.y=o,this.transitionChildren.push(y),y.makeTransition(),o+=y.transitionRect.height)}}this.dragBar.animator.setAnimatorFactor(0)},c_.prototype.handleSelectChild=function(e){this._selectedChild=e.dispatcher,this._selectedChild.content.directSelect&&(this._selectedChild.content.isEmpty?(this.contextMenu.showButton("add_image"),this.contextMenu.hideButton("edit_image"),this.contextMenu.hideButton("remove_image")):(this.contextMenu.hideButton("add_image"),this.contextMenu.showButton("edit_image"),this.contextMenu.showButton("remove_image")),this._gridChildren.length>1?this.contextMenu.showButton("delete_cell"):this.contextMenu.hideButton("delete_cell"),this.contextMenu.enabled=!0)},c_.prototype.handleDragChild=function(e){this._draggedChild=e.dispatcher,BFN.DragScreen.show(this._draggedChild.menuImageVO.thumbURL),this.awaitingDrop=!0,document.addEventListener(BeFunky.pointerup,this.handleDropChildBind),BFN.SentryManager.reportBreadcrumb(BFN.SentryManager.getDisplayObjectInfo(this._draggedChild),"drag_grid_child_image")},c_.prototype.handleDropChild=function(e){if(this.awaitingDrop=!1,document.removeEventListener(BeFunky.pointerup,this.handleDropChildBind),this._focusedChild){if(this._draggedChild&&this._draggedChild==this._focusedChild&&!this._draggedChild.hoveredEdge)return void(this.draggedChild=null);if(this._focusedChild.handleDrop(),this._selectedChild&&this._draggedChild){BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;var t=this._draggedChild.content.image.frameSprite.rotate,n=this._draggedChild.menuImageVO;if(this._selectedChild.content.isEmpty)this._draggedChild.menuImageVO=null,this._draggedChild.content.setImage(null);else{var i=this._selectedChild.content.image.frameSprite.rotate;this._draggedChild.menuImageVO=this._selectedChild.menuImageVO,this._draggedChild.content.setImage(this._selectedChild.content.image.texture,!0,!1,i),this._draggedChild.content.image.frameSprite.rotate=i}BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this._selectedChild.menuImageVO=n,this._selectedChild.content.setImage(n.imageTexture,!0,!1,t)}}this.draggedChild=null,this.selectedChild=null},c_.prototype.handleDeleteChild=function(e){if(this._gridChildren.length>1){BFN.CollageMakerHistoryModel.historyAction="grid_cell_deleted";var t,n,i,r,a=e.dispatcher,o=new BFN.Rectangle(0,a.y,this._itemWidth,a.itemHeight),s=new BFN.Rectangle(a.x,0,a.itemWidth,this._itemHeight),l=[],u=[];for(t=0;t<this._gridChildren.length;t++)i=this._gridChildren[t],this.updateRect(i),i!=a&&(o.intersects(i.rect)&&l.push(i),s.intersects(i.rect)&&u.push(i));var c=!1,h=!1;for(t=l.length;--t>-1;)(i=l[t]).rect.top<o.top||i.rect.bottom>o.bottom?i.rect.right<=a.rect.left?o.left=Math.max(o.left,i.rect.right):i.rect.left>=a.rect.right&&(o.right=Math.min(o.right,i.rect.left)):i.rect.right==a.rect.left?c=!0:i.rect.left==a.rect.right&&(h=!0);var d=!1,m=!1;for(t=u.length;--t>-1;)(i=u[t]).rect.left<s.left||i.rect.right>s.right?i.rect.bottom<=a.rect.top?s.top=Math.max(s.top,i.rect.bottom):i.rect.top>=a.rect.bottom&&(s.bottom=Math.min(s.bottom,i.rect.top)):i.rect.bottom==a.rect.top?d=!0:i.rect.top==a.rect.bottom&&(m=!0);for(o.left=c?o.left:a.rect.left,o.right=h?o.right:a.rect.right,s.top=d?s.top:a.rect.top,s.bottom=m?s.bottom:a.rect.bottom,l.splice(0),u.splice(0),t=0;t<this._gridChildren.length;t++)(i=this._gridChildren[t])==a||i.rect.intersects(a.rect)||(o.intersects(i.rect)&&l.push(i),s.intersects(i.rect)&&u.push(i));var p,g,f,v=null;if(l.sort(function(e,t){return e.x-t.x}),u.sort(function(e,t){return e.y-t.y}),l.length&&u.length?v=Math.random()<.5?l:u:l.length?v=l:u.length&&(v=u),v&&v.length&&!a.content.cleanDelete){for(this.positions.splice(0),t=0;t<v.length;t++)if(!(i=v[t]).rect.intersects(a.rect))if(v==l){if(p=Math.round(a.x+a.itemWidth/2),g=o.width/(o.width-a.itemWidth),(f=i.x)>p&&(f-=a.itemWidth),i.transitionRect.x=Math.round((f-o.left)*g)+o.left,i.transitionRect.y=i.y,i.transitionRect.width=Math.round(i.itemWidth*g),i.transitionRect.height=i.itemHeight,-1==this.positions.indexOf(i.transitionRect.x)||-1==this.positions.indexOf(i.transitionRect.x+i.transitionRect.width))for(n=0;n<this.positions.length;n++)r=this.positions[n]-i.transitionRect.x,1==Math.abs(r)&&(console.log("ADJUST HORIZONTAL POSITION"),i.transitionRect.x+=r,i.transitionRect.width-=r);-1==this.positions.indexOf(i.transitionRect.x)&&this.positions.push(i.transitionRect.x),-1==this.positions.indexOf(i.transitionRect.x+i.transitionRect.width)&&this.positions.push(i.transitionRect.x+i.transitionRect.width),this.transitionChildren.push(i),i.makeTransition()}else if(v==u){if(p=Math.round(a.y+a.itemHeight/2),g=s.height/(s.height-a.itemHeight),(f=i.y)>p&&(f-=a.itemHeight),i.transitionRect.x=Math.max(0,i.x),i.transitionRect.y=Math.max(0,Math.round((f-s.top)*g)+s.top),i.transitionRect.width=Math.min(i.itemWidth,this._itemWidth-i.transitionRect.x),i.transitionRect.height=Math.min(Math.round(i.itemHeight*g),this._itemHeight-i.transitionRect.y),-1==this.positions.indexOf(i.transitionRect.y)||-1==this.positions.indexOf(i.transitionRect.y+i.transitionRect.height))for(n=0;n<this.positions.length;n++)r=this.positions[n]-i.transitionRect.y,1==Math.abs(r)&&(console.log("ADJUST VERTICAL POSITION"),i.transitionRect.y+=r,i.transitionRect.height-=r);-1==this.positions.indexOf(i.transitionRect.y)&&this.positions.push(i.transitionRect.y),-1==this.positions.indexOf(i.transitionRect.y+i.transitionRect.height)&&this.positions.push(i.transitionRect.y+i.transitionRect.height),this.transitionChildren.push(i),i.makeTransition()}this.positions.splice(0)}this.removeGridChild(a),this.transitionChildren.length||this.handleChildTransitionCompleteTimeout()}},c_.prototype.handleChildImageUpdated=function(e){this._insertedGridChild||(BFN.CollageMakerHistoryModel.historyAction="image_updated",this.getPhotoGridSnapShot())},c_.prototype.handleChildImagePositionUpdated=function(e){BFN.CollageMakerHistoryModel.historyAction="image_position_updated",BFN.CollageMakerHistoryModel.focusedGridChild=e.dispatcher,this.getPhotoGridSnapShot(),BFN.CollageMakerHistoryModel.focusedGridChild=null},c_.prototype.handleChildTransitionComplete=function(e){var t=e.dispatcher;this.updateFactorRect(t),-1!=this.transitionChildren.indexOf(t)&&(this.transitionChildren.splice(this.transitionChildren.indexOf(t),1),this.transitionChildren.length||setTimeout(this.handleChildTransitionCompleteTimeout.bind(this),10))},c_.prototype.handleChildTransitionCompleteTimeout=function(e){if(this._insertedGridChild&&(this._insertedGridChild.content.imageEnabled=!1),this.getPhotoGridSnapShot(),this._insertedGridChild&&(this._insertedGridChild.content.imageEnabled=!0),this._insertedGridChild){var t=this._insertedGridChild.content.isEmpty;this._insertedGridChild=null,t||this.handleChildImageUpdated(null)}},c_.prototype.startTouchDragHoverDetection=function(){this.detectingTouchDragHovers||(this.detectingTouchDragHovers=!0,this.gridChildren.forEach(function(e){e.updateGlobalBounds()}),this.unhoverHoveredItem(),this.detectHoversManuallyBind(BeFunky.globalPointerEvent),document.addEventListener(BeFunky.pointermove,this.detectHoversManuallyBind,!0),document.addEventListener(BeFunky.pointerup,this.stopTouchDragHoverDetectionBind,!0))},c_.prototype.stopTouchDragHoverDetection=function(){var e=this;this.detectingTouchDragHovers&&(this.detectingTouchDragHovers=!1,setTimeout(function(){e.unhoverHoveredItem()},0),document.removeEventListener(BeFunky.pointermove,this.detectHoversManuallyBind,!0),document.removeEventListener(BeFunky.pointerup,this.stopTouchDragHoverDetectionBind,!0))},c_.prototype.unhoverHoveredItem=function(){if(this.hoveredItem)switch(this.hoveredItemType){case"content":this.hoveredItem.content.handleMouseOutBind();break;case"edge":var e=this.hoveredItem;e.handleMouseOutBind(),e.gridChild.handleEdgeBarOutBind()}this.handleChildMouseOutBind(),this.hoveredItem=null,this.hoveredItemType=null},c_.prototype.detectHoversManually=function(e){var t=this,n=BeFunky.globalPointerCoords.x,i=BeFunky.globalPointerCoords.y,r=null,a=null;this.gridChildren.forEach(function(e){if(e.globalRect.contains(n,i)){var t=null;for(var o in e.edgeBars){var s=e.edgeBars[o];s.containsGlobalPoint(n,i)&&(t=s)}t?(r=t,a="edge"):(r=e,a="content")}}),function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n!=t.hoveredItem&&(t.unhoverHoveredItem(),t.hoveredItem=n,t.hoveredItemType=i,t.hoveredItem&&t.hoveredItemType))switch(t.hoveredItemType){case"content":t.hoveredItem.content.handleMouseOverBind(),t.handleChildMouseOverBind({currentTarget:t.hoveredItem});break;case"edge":var r=t.hoveredItem;r.handleMouseOverBind(),r.gridChild.handleEdgeBarOverBind({currentTarget:r,data:{originalEvent:e}}),t.handleChildMouseOverBind({currentTarget:r.gridChild})}}(r,a)},Object.defineProperty(c_.prototype,"isEmpty",{get:function(){for(var e=!0,t=0;t<this._gridChildren.length;t++){if(!this._gridChildren[t].content.isEmpty){e=!1;break}}return e}}),Object.defineProperty(c_.prototype,"gridChildIsolated",{get:function(){return this._gridChildIsolated}}),Object.defineProperty(c_.prototype,"scale",{set:function(e){this._scale=e;for(var t=0;t<this._gridChildren.length;t++){this._gridChildren[t].scale=this._scale}this.dragBar.scale=this._scale,this.edgeIndicators.left.scale=this._scale,this.edgeIndicators.top.scale=this._scale,this.edgeIndicators.right.scale=this._scale,this.edgeIndicators.bottom.scale=this._scale,this.dragger.scale=this._scale},get:function(){return this._scale}}),Object.defineProperty(c_.prototype,"backgroundColor",{set:function(e){if(this._backgroundColor=e,this.childBackgroundColor="000000",this.childBorderColor="000000",-1==this._backgroundColor)this.childBackgroundColor="FFFFFF",this.childBorderColor="000000";else{var t=parseInt("0x".concat(this._backgroundColor)),n=BFN.Util.hex2hsv(t),i=n.v,r=n.v;n.v>.65?(i-=.3*n.v,r-=.4*n.v):(i+=.3*(1-n.v),r+=.4*(1-n.v)),n.v=i,this.childBackgroundColor=BFN.Util.hsv2rgb(n).hex.split("#").join(""),n.v=r,this.childBorderColor=BFN.Util.hsv2rgb(n).hex.split("#").join("")}for(var a=0;a<this._gridChildren.length;a++){var o=this._gridChildren[a];o.backgroundColor=this.childBackgroundColor,o.borderColor=this.childBorderColor}},get:function(){return this._backgroundColor}}),Object.defineProperty(c_.prototype,"gap",{set:function(e){this._gap=e,this.updateGaps()},get:function(){return this._gap}}),Object.defineProperty(c_.prototype,"gapPixels",{get:function(){return Math.round(this._gap*this.maxGap/2)}}),Object.defineProperty(c_.prototype,"rounding",{set:function(e){this._rounding=e,this.updateRounding()},get:function(){return this._rounding}}),Object.defineProperty(c_.prototype,"gridChildren",{get:function(){return this._gridChildren}}),Object.defineProperty(c_.prototype,"focusedChild",{get:function(){return this._focusedChild}}),Object.defineProperty(c_.prototype,"targetChild",{set:function(e){this._targetChild=e},get:function(){return this._targetChild}}),Object.defineProperty(c_.prototype,"randomEmptyChild",{get:function(){for(var e=null,t=[],n=0;n<this.gridChildren.length;n++){var i=this.gridChildren[n];i.content.isEmpty&&t.push(i)}return t.length&&(e=t[Math.floor(Math.random()*t.length)]),t.splice(0),e}}),Object.defineProperty(c_.prototype,"selectedChild",{set:function(e){this._selectedChild=e},get:function(){return this._selectedChild}}),Object.defineProperty(c_.prototype,"draggedChild",{set:function(e){this._draggedChild=e},get:function(){return this._draggedChild}}),Object.defineProperty(c_.prototype,"awaitingDrop",{set:function(e){this._awaitingDrop!=e&&(e?"touch"==BeFunky.globalPointerEvent.pointerType&&this.startTouchDragHoverDetection():this.stopTouchDragHoverDetection()),this._awaitingDrop=e;for(var t=0;t<this._gridChildren.length;t++){this._gridChildren[t].awaitingDrop=this._awaitingDrop}},get:function(){return this._awaitingDrop}}),Object.defineProperty(c_.prototype,"matchesTemplate",{set:function(e){this._matchesTemplate=e},get:function(){return this._matchesTemplate}}),Object.defineProperty(c_.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.setSize(this._itemWidth,this._itemHeight)},get:function(){return this._itemWidth}}),Object.defineProperty(c_.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.setSize(this._itemWidth,this._itemHeight)},get:function(){return this._itemHeight}}),BFN.SingletonQueue.add(function(){BFN.PhotoGrid=new c_}),BFN.CollageMakerCanvasPhotoGridEvents={RESIZING:new Event("RESIZING"),RESIZING_COMPLETE:new Event("RESIZING_COMPLETE")},h_.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),h_.prototype.init=function(){BeFunky.log("CollageMakerCanvasPhotoGrid Init"),this.initDefaultValues(),this.initPhotoGridContainer(),this.initPatternBackground(),this.initPhotoGrid()},h_.prototype.initDefaultValues=function(){this.interactive=!0,this._canvasScale=1,this._gridWidth=1,this._gridHeight=1,this.longestSide=Math.max(this._gridWidth,this._gridHeight),this.adjustmentScaleFactor=1,this.currentAspectRatio=1,this.originalAspectRatio=1,this.aspectRatios=BFN.CropRatioMap,this.manualGridResize=!1,this.lastTemplate=null,this.customizePending=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this),this.targetGridChildren=[],this.gridImageIDs=[],this.autoFillMenuImageVOIndex=0,this.autoFillMenuImageVOs=null,this.updateCurrentTransition=!1,this.transitionVO=null,this.transitionUpdating=!1,this.uniqueTransitionTags=["background_color","background_pattern"],this.pendingAutoCollageBaseTextures=[],window.addEventListener("INIT_COMPLETE",function(){document.getElementById("collage_customize_width").paramObject.max=BFN.maxImageSize,document.getElementById("collage_customize_height").paramObject.max=BFN.maxImageSize}),BFN.CollageMakerTemplateModel.addEventListener(BFN.CollageMakerTemplateModelEvents.CURRENT_TEMPLATE_UPDATED.type,this.handleCurrentTemplateUpdated.bind(this)),BFN.CollageMakerTemplateModel.addEventListener(BFN.CollageMakerTemplateModelEvents.FREEFORM.type,this.handleFreeformTemplate.bind(this)),BFN.CollageMakerHistoryModel.addEventListener(BFN.CollageMakerHistoryModelEvents.APPLY_CURRENT_SNAPSHOT.type,this.handleApplyCurrentSnapShot.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.COLLAGE_SETTINGS_UPDATED.type,this.handleCollageSettingsUpdated.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.CLEAR_ALL.type,this.handleClearAll.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.AUTO_COLLAGE_LAYOUT_OBJECT.type,this.handleAutoCollageLayoutObject.bind(this))},h_.prototype.initPhotoGridContainer=function(){this.photoGridContainer=new PIXI.Container,this.addChild(this.photoGridContainer)},h_.prototype.initPatternBackground=function(){this.patternBackgroundTextureSourceSprite=new PIXI.Sprite,this.patternBackgroundTextureSourceSprite.pluginName="smooth_picture",this.patternBackgroundTextureSourceSprite.smoothing=!0,this.patternBackgroundTexture=PIXI.RenderTexture.create(32,32),this.patternBackgroundTexture.clear(),this.patternBackground=new BFN.TileContainer(this.patternBackgroundTexture,32,32),this.patternBackground.visible=!1,this.photoGridContainer.addChild(this.patternBackground)},h_.prototype.initPhotoGrid=function(){this.photoGrid=BFN.PhotoGrid,this.photoGrid.addEventListener(BFN.PhotoGridEvents.PHOTO_GRID_SNAP_SHOT.type,this.handlePhotoGridSnapShot.bind(this)),this.photoGridContainer.addChild(this.photoGrid)},h_.prototype.initInitialTemplate=function(){this.resetBackground(),BFN.CollageMakerTemplateModel.currentTemplate=BFN.CollageMakerTemplateData.templateCategoryVOs[0].templateVOs[0]},h_.prototype.handleCustomize=function(){this.customizePending||(this.customizePending=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),BFN.MainUI.requestRender()},h_.prototype.handleMainUIPreRender=function(){if(this.customizePending){this.customizePending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind);var e=UITools.getToolVO("collage_customize");switch(e.updating_id){case"lock_aspect_ratio":return void(e.lock_aspect_ratio||this.setFreeformAspectRatio(e));case"aspect_ratio":if(!this.aspectRatios.hasOwnProperty(e.aspect_ratio))return void this.setFreeformAspectRatio(e);var t="freeform"===e.aspect_ratio;if(!!e.lock_aspect_ratio===t&&(e.lock_aspect_ratio=!t,UITools.updateToolControl("collage_customize_lock_aspect_ratio")),t)return;var n=this.aspectRatios[e.aspect_ratio];-1===n?n=this.originalAspectRatio:(this.currentAspectRatio-1)*(n-1)<0&&(n=1/n);var i=n<=1?this.longestSide:Math.round(this.longestSide/n),r=n<=1?Math.round(this.longestSide*n):this.longestSide;if(i===this._gridWidth&&r===this._gridHeight)return;e.width=i,e.height=r,e.updating_id="width",this.currentAspectRatio=n;break;case"orientation":if((this._gridHeight/this._gridWidth<=1?"landscape":"portrait")===e.orientation)return;var a=this._gridHeight,o=this._gridWidth;if(a===this._gridWidth&&o===this._gridHeight)return;e.width=a,e.height=o,e.updating_id="width",this.currentAspectRatio=o/a}if(!this.transitionUpdating){this.transitionUpdating=!0;var s="settings";switch(e.updating_id){case"width":case"height":s="dimensions_changed";break;case"background_color":s=-1==e.background_color?"background_transparent":"background_color";break;case"spacing":s="spacing";break;case"corner_rounding":s="corner_rounding"}this.createHistoryTransition(s)}BFN.CollageMakerCanvasBackground.color!=e.background_color&&(BFN.CollageMakerCanvasBackground.color=e.background_color),"background_color"==e.updating_id&&this.patternBackground.visible&&this.setPatternBackgroundTexture(null),this.photoGrid.backgroundColor==BFN.CollageMakerCanvasBackground.color||this.patternBackground.visible||(this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color);var l=!1;"spacing"==e.updating_id&&this.photoGrid.gap!=e.spacing/100&&(this.photoGrid.gap=e.spacing/100,l=!0);var u=!1;"corner_rounding"==e.updating_id&&this.photoGrid.rounding!=e.corner_rounding/100&&(this.photoGrid.rounding=e.corner_rounding/100,u=!0);var c=!1;if("width"==e.updating_id||"height"==e.updating_id){if(e.width!=this._gridWidth||e.height!=this._gridHeight){var h=e.width,d=e.height;if(this.manualGridResize)this.setFreeformAspectRatio(e);else{if(e.lock_aspect_ratio)switch(e.updating_id){case"width":d=Math.min(BFN.maxImageSize,Math.max(BFN.minCollageSize,Math.round(h*this.currentAspectRatio))),h=Math.round(d/this.currentAspectRatio);break;case"height":h=Math.min(BFN.maxImageSize,Math.max(BFN.minCollageSize,Math.round(d/this.currentAspectRatio))),d=Math.round(h*this.currentAspectRatio)}UITools.setToolValue("collage_customize","width",h,e.updating),UITools.setToolValue("collage_customize","height",d,e.updating),UITools.updateToolControls("collage_customize"),this.longestSide=Math.max(h,d)}this._gridWidth=h,this._gridHeight=d;var m=this._gridHeight/this._gridWidth<=1?"landscape":"portrait";m!==e.orientation&&(e.orientation=m,UITools.updateToolControl("collage_customize_orientation")),this.updatePhotoGridDisplay(),this.updatePatternBackgroundDisplay()}e.updating?this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING):(this.adjustGridSizeToLongestSide(),this.updatePhotoGridDisplay(),this.updatePatternBackgroundDisplay(),c=!0,this.dispatchEvent(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING_COMPLETE),this.adjustmentScaleFactor=1)}c||!l&&!u||this.updatePhotoGridDisplay(!1),!e.updating&&this.transitionUpdating&&(this.transitionUpdating=!1,this.registerHistoryTransition()),!e.updating&&this.manualGridResize&&(this.manualGridResize=!1)}},h_.prototype.handleCollageImage=function(){var e=this,t=UITools.getToolVO("collage_image");if(this.photoGrid.selectedChild&&this.photoGrid.selectedChild.content&&this.photoGrid.selectedChild.content.image)switch(t.updating_id){case"size":this.photoGrid.selectedChild.content.image.resize(t.size/100);break;case"rotate_clockwise":this.photoGrid.selectedChild.content.image.rotate("right");break;case"rotate_counter_clockwise":this.photoGrid.selectedChild.content.image.rotate("left");break;case"flip_horizontal":this.photoGrid.selectedChild.content.image.flip("horizontal");break;case"flip_vertical":this.photoGrid.selectedChild.content.image.flip("vertical");break;case"open_in_editor":if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("COLLAGE","EDIT_IMAGE_UPGRADE"),void BFN.UserActionManager.addUpgradeAction(["Open Grid Image in Editor"]);var n=this.photoGrid.selectedChild;this.photoGrid.isolateGridChild(null,!0);try{BFN.BfnService.track("CREATE","COLLAGE","OPEN_IMAGE_EDITOR")}catch(e){}BFN.PhotoEditorModel.currentTexture&&BFN.IndexedDB.disabledReason?BeFunky.confirm("confirm_edit_image",{onConfirm:function(){BFN.ImageEditManager.openGridCellInEditor(n)},onCancel:function(){e.photoGrid.selectedChild=n,e.photoGrid.isolateGridChild(n)},focusConfirmButton:!1}):BFN.ImageEditManager.openGridCellInEditor(n)}BFN.MainUI.requestRender()},h_.prototype.autoFill=function(e){if(e&&e.length){if(!this.autoFillMenuImageVOs){this.autoFillMenuImageVOs=[];for(var t=0;t<e.length;t++)this.autoFillMenuImageVOs.push(e[t])}if(BFN.CollageMakerCanvasPhotoGridModel.freeform)this.autoFillMenuImageVOs.shuffle(),this.autoFillMenuImageVOs.length>3&&this.autoFillMenuImageVOs.splice(3),BFN.BfnService.getTexturesForMenuImageVOs(this.autoFillMenuImageVOs).then(this.processAutoFillMenuImageVOs.bind(this));else{this.targetGridChildren.splice(0),this.gridImageIDs.splice(0);for(var n=0;n<this.photoGrid.gridChildren.length;n++){var i=this.photoGrid.gridChildren[n];i.content.isEmpty?this.targetGridChildren.push(i):-1==this.gridImageIDs.indexOf(i.menuImageVO.id)&&this.gridImageIDs.push(i.menuImageVO.id)}if(this.targetGridChildren.shuffle(),this.targetGridChildren.length){for(var r=this.autoFillMenuImageVOs.length;--r>-1&&this.autoFillMenuImageVOs.length>this.targetGridChildren.length;){var a=this.autoFillMenuImageVOs[r];this.gridImageIDs.includes(a.id)&&this.autoFillMenuImageVOs.splice(r,1)}this.autoFillMenuImageVOs.length>this.targetGridChildren.length&&this.autoFillMenuImageVOs.splice(this.targetGridChildren.length),this.autoFillMenuImageVOIndex=0,BFN.BfnService.getTexturesForMenuImageVOs(this.autoFillMenuImageVOs).then(this.processAutoFillMenuImageVOs.bind(this))}else this.autoFillMenuImageVOs.splice(0),this.autoFillMenuImageVOs=null}}},h_.prototype.processAutoFillMenuImageVOs=function(){if(this.autoFillMenuImageVOs&&this.autoFillMenuImageVOs.length)if(BFN.CollageMakerCanvasPhotoGridModel.freeform){for(var e=0;e<this.autoFillMenuImageVOs.length;e++){var t=this.autoFillMenuImageVOs[e],n=Math.round(this._gridWidth/2*Math.random())-this._gridWidth/4,i=Math.round(this._gridHeight/2*Math.random())-this._gridHeight/4;BFN.CollageMakerCanvasModel.addedItem={type:"texture",texture:t.imageTexture,initialCenterPosition:new PIXI.Point(n,i),projectItemAssetID:t.id},BFN.BfnService.storeBlobForMenuImageVO(t,"collage")}BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.deselectItem()}else{if("auto_fill"!=BFN.CollageMakerHistoryModel.historyAction&&(BFN.CollageMakerHistoryModel.ignoreSnapshot=!0,BFN.CollageMakerHistoryModel.historyAction="auto_fill"),this.targetGridChildren.length){var r;for(BFN.PhotoGrid.targetChild=this.targetGridChildren.shift();r=this.autoFillMenuImageVOs[this.autoFillMenuImageVOIndex],this.autoFillMenuImageVOIndex=(this.autoFillMenuImageVOIndex+1)%this.autoFillMenuImageVOs.length,this.gridImageIDs.length&&-1!==this.gridImageIDs.indexOf(r.id);)if(!this.autoFillMenuImageVOIndex){this.gridImageIDs.splice(0);break}return this.autoFillMenuImageVOIndex||this.autoFillMenuImageVOs.shuffle(),void(r&&BFN.ImageLibraryManager.addImageToCanvas(r,{hasTexture:!0}))}"auto_fill"===BFN.CollageMakerHistoryModel.historyAction&&(BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.photoGrid.getPhotoGridSnapShot(),BFN.CollageMakerHistoryModel.historyAction=null)}this.autoFillMenuImageVOs=null},h_.prototype.assignImageToTargetGridChild=function(e){this.photoGrid.targetChild&&null!=this.photoGrid.targetChild.content&&(BFN.TransformStateModel.safeBaseTextures.includes(e.imageTexture.baseTexture)||BFN.TransformStateModel.safeBaseTextures.push(e.imageTexture.baseTexture),this.photoGrid.targetChild.menuImageVO=e,this.photoGrid.targetChild.content.setImage(e.imageTexture),this.photoGrid.targetChild=null,BFN.TransformStateModel.safeBaseTextures.splice(0)),this.processAutoFillMenuImageVOs()},h_.prototype.preparePhotoGrid=function(e,t,n,i){this.photoGrid.removeAllGridChildren(),this.photoGrid.setSize(e,t),this.photoGrid.gap=n,this.photoGrid.rounding=i},h_.prototype.updatePhotoGridDisplay=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.currentAspectRatio=this._gridHeight/this.gridWidth,this.photoGridContainer.x=-this._gridWidth/2,this.photoGridContainer.y=-this._gridHeight/2,this.photoGrid.setMaxGapFromDimensions(this._gridWidth,this._gridHeight),this.photoGrid.x=this.photoGrid.gapPixels,this.photoGrid.y=this.photoGrid.gapPixels,this.photoGrid.setSize(this._gridWidth-2*this.photoGrid.gapPixels,this._gridHeight-2*this.photoGrid.gapPixels),e&&BFN.CollageMakerCanvasPhotoGridModel.dispatchEvent(BFN.CollageMakerCanvasPhotoGridModelEvents.GRID_SIZE_CHANGED)},h_.prototype.adjustGridSizeToLongestSide=function(){this.adjustmentScaleFactor=Math.min(this.longestSide/Math.round(this._gridWidth),this.longestSide/Math.round(this._gridHeight)),this._gridWidth=Math.max(BFN.minCollageSize,Math.round(this._gridWidth*this.adjustmentScaleFactor)),this._gridHeight=Math.max(BFN.minCollageSize,Math.round(this._gridHeight*this.adjustmentScaleFactor)),this.updateToolVO(this._gridWidth,this._gridHeight)},h_.prototype.setPatternBackgroundTexture=function(e){this.patternBackground.visible=!1;try{this.patternBackgroundTextureSourceSprite.texture.destroy(!1)}catch(e){}this.patternBackgroundTextureSourceSprite.texture=PIXI.Texture.EMPTY,BFN.CollageMakerCanvasPhotoGridModel.backgroundPatternTexture=e?new PIXI.Texture(e.baseTexture):null,e&&(e.baseTexture.hasOwnProperty("averageColor")&&(this.photoGrid.backgroundColor=e.baseTexture.averageColor.toString(16)),this.patternBackgroundTextureSourceSprite.texture=new PIXI.Texture(e.baseTexture),this.patternBackground.visible=!0),this.updatePatternBackgroundDisplay()},h_.prototype.updatePatternBackgroundDisplay=function(){if(this.patternBackground.visible){var e=Math.max(this._gridWidth/this.patternBackgroundTextureSourceSprite.texture.width,this._gridHeight/this.patternBackgroundTextureSourceSprite.texture.height)/2,t=Math.round(this.patternBackgroundTextureSourceSprite.texture.baseTexture.width*e),n=Math.round(this.patternBackgroundTextureSourceSprite.texture.baseTexture.height*e);this.patternBackgroundTextureSourceSprite.scale.x=this.patternBackgroundTextureSourceSprite.scale.y=this.patternBackgroundTextureSourceSprite.currentScale=e,this.patternBackgroundTexture.resize(t,n),BFN.Stage.render(this.patternBackgroundTextureSourceSprite,this.patternBackgroundTexture),this.patternBackground.width=this._gridWidth,this.patternBackground.height=this._gridHeight,this.patternBackground.updateDisplay()}else this.patternBackgroundTexture.clear(),this.patternBackgroundTexture.resize(32,32),this.patternBackground.width=32,this.patternBackground.height=32,this.patternBackground.updateDisplay()},h_.prototype.resetBackground=function(e){BFN.CollageMakerCanvasBackground.color="FFFFFF",this.setPatternBackgroundTexture(null),this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color},h_.prototype.getScreenCapture=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=PIXI.RenderTexture.create(this._gridWidth,this._gridHeight);return this.patternBackground.visible?(this.patternBackground.smoothScale=1,BFN.Stage.render(this.patternBackground,n),this.patternBackground.smoothScale=this._canvasScale):-1!=BFN.CollageMakerCanvasBackground.color&&n.fillColor(parseInt("0x"+BFN.CollageMakerCanvasBackground.color)),BFN.CollageMakerCanvasPhotoGridModel.freeform||(this.photoGrid.childContainer.x=this.photoGrid.childContainer.y=this.photoGrid.gapPixels,this.photoGrid.setChildVeilVisibility(!1),this.photoGrid.toggleBorders(!1,t),this.photoGrid.toggleEmptyCells(e),this.photoGrid.scale=1,BFN.Stage.render(this.photoGrid.childContainer,n,!1),this.photoGrid.childContainer.x=this.photoGrid.childContainer.y=0,this.photoGrid.setChildVeilVisibility(!0),this.photoGrid.toggleBorders(!0),this.photoGrid.toggleEmptyCells(!0),this.photoGrid.scale=this._canvasScale),n},h_.prototype.updateToolVO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(null!==e&&UITools.setToolValue("collage_customize","width",e),null!==t&&UITools.setToolValue("collage_customize","height",t),null!==n&&UITools.setToolValue("collage_customize","spacing",n),null!==i&&UITools.setToolValue("collage_customize","corner_rounding",i),null!==r&&UITools.setToolValue("collage_customize","background_color",r),null!==a&&UITools.setToolValue("collage_customize","lock_aspect_ratio",a),null!==e&&null!==t){var l=t/e<=1?"landscape":"portrait";UITools.setToolValue("collage_customize","orientation",l)}null!==o&&UITools.toggleControlItem("collage_customize_spacing",o),null!==s&&UITools.toggleControlItem("collage_customize_corner_rounding",s),UITools.updateToolControls("collage_customize")},h_.prototype.updateOriginalAspectRatio=function(){this.originalAspectRatio=this._gridHeight/this.gridWidth},h_.prototype.setFreeformAspectRatio=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||UITools.getToolVO("collage_customize");"freeform"!==e.aspect_ratio&&(e.aspect_ratio="freeform",UITools.updateToolControl("collage_customize_aspect_ratio"))},h_.prototype.updateSettings=function(e){var t=UITools.getToolVO("collage_customize");this.photoGrid.contextMenu.hide(),this.photoGrid.gap=t.spacing/100,this.photoGrid.rounding=t.corner_rounding/100,this._gridWidth=t.width,this._gridHeight=t.height,this.longestSide=Math.max(this._gridWidth,this._gridHeight),BFN.CollageMakerCanvasBackground.color=t.background_color,this.updatePhotoGridDisplay(),this.updatePatternBackgroundDisplay(),BFN.ZoomManager.updateZoomRange(),BFN.CollageMakerCanvas.fitCollageToFrame(),BFN.CollageMakerModel.updateProjectVO()},h_.prototype.createPhotoGridSnapshot=function(){if(!BFN.CollageMakerHistoryModel.ignoreSnapshot){this.photoGrid.repair();var e=new BFN.PhotoGridSnapshotVO;e.historyAction=BFN.CollageMakerHistoryModel.historyAction,e.snapshotWidth=this._gridWidth,e.snapshotHeight=this._gridHeight,e.gridWidth=this.photoGrid.itemWidth,e.gridHeight=this.photoGrid.itemHeight,e.rounding=this.photoGrid.rounding,e.gap=this.photoGrid.gap,e.backgroundColor=BFN.CollageMakerCanvasBackground.color,e.backgroundPatternBaseTexture=this.patternBackground.visible?this.patternBackgroundTextureSourceSprite.texture.baseTexture:null;var t=2/BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize*Math.max(this._gridWidth,this._gridHeight),n=this.getScreenCapture(!0,t);if(e.previewTexture=BFN.Util.getThumbTexture(n,Math.min(Math.max(n.width,n.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1),e.thumbTexture=BFN.Util.getThumbTexture(n,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1),n.destroyGC(!0),!BFN.CollageMakerCanvasPhotoGridModel.freeform)for(var i=0;i<this.photoGrid.gridChildren.length;i++){var r=this.photoGrid.gridChildren[i];r.updateRect(),r.updateProjectItemVO();var a=new BFN.PhotoGridSnapshotChildVO;a.rect=r.rect.clone(),a.menuImageVO=r.menuImageVO,r.content.imageEnabled&&!r.content.isEmpty&&r.content.image.frameSprite.texture.valid&&(a.texture=new PIXI.Texture(r.content.image.frameSprite.texture.baseTexture),a.offsetFactorX=r.content.image.frameSprite.offsetFactorX,a.offsetFactorY=r.content.image.frameSprite.offsetFactorY,a.rotate=r.content.image.frameSprite.rotate,a.textureScale=r.content.image.frameSprite.textureScale),e.snapshotChildren.push(a)}BFN.CollageMakerHistoryModel.addPhotoGridSnapshotToHistory(e),BFN.CollageMakerModel.updateProjectVO()}},h_.prototype.createHistoryTransition=function(e){if(this.updateCurrentTransition=!1,this.transitionVO){if(-1==this.uniqueTransitionTags.indexOf(e)&&this.transitionVO.id==e&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp())return void(this.updateCurrentTransition=!0);this.transitionVO=null}this.transitionVO||(this.transitionVO=new BFN.TransformItemTransitionVO,this.transitionVO.id=e,this.transitionVO.alternateHistoryAction="collage_settings_updated",this.transitionVO.startState.collageSettings.background_color=BFN.CollageMakerCanvasBackground.color,this.transitionVO.startState.collageSettings.spacing=100*this.photoGrid.gap,this.transitionVO.startState.collageSettings.corner_rounding=100*this.photoGrid.rounding,this.transitionVO.startState.collageSettings.width=this._gridWidth,this.transitionVO.startState.collageSettings.height=this._gridHeight,this.transitionVO.startState.collageSettings.backgroundPatternBaseTexture=this.patternBackground.visible?this.patternBackgroundTextureSourceSprite.texture.baseTexture:null)},h_.prototype.registerHistoryTransition=function(){this.photoGrid.repair();var e=this.updateCurrentTransition&&this.transitionVO&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp();this.transitionVO.previewTexture&&this.transitionVO.previewTexture.destroyGC(!0),this.transitionVO.previewImage=null,this.transitionVO.thumbTexture&&this.transitionVO.thumbTexture.destroyGC(!0),this.transitionVO.thumbImage=null;var t=null;try{var n=2/BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize*Math.max(this._gridWidth,this._gridHeight);t=this.getScreenCapture(!0,n)}catch(e){}try{this.transitionVO.previewTexture=BFN.Util.getThumbTexture(t,Math.min(Math.max(t.width,t.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1)}catch(e){this.transitionVO.previewTexture=null}try{this.transitionVO.thumbTexture=BFN.Util.getThumbTexture(t,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1)}catch(e){this.transitionVO.thumbTexture=null}try{t.destroyGC(!0)}catch(e){}t=null,this.transitionVO.endState.collageSettings.background_color=BFN.CollageMakerCanvasBackground.color,this.transitionVO.endState.collageSettings.spacing=100*this.photoGrid.gap,this.transitionVO.endState.collageSettings.corner_rounding=100*this.photoGrid.rounding,this.transitionVO.endState.collageSettings.width=this._gridWidth,this.transitionVO.endState.collageSettings.height=this._gridHeight,this.transitionVO.endState.collageSettings.backgroundPatternBaseTexture=this.patternBackground.visible?this.patternBackgroundTextureSourceSprite.texture.baseTexture:null,e?BFN.TransformStateModel.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED):BFN.TransformStateModel.addTransition(this.transitionVO),BFN.CollageMakerModel.updateProjectVO()},h_.prototype.applyCurrentTemplate=function(){BFN.CollageMakerCanvasPhotoGridModel.freeform&&BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerCanvasPhotoGridModel.freeform=!1;for(var e=this.lastTemplate=BFN.CollageMakerTemplateModel.currentTemplate,t=[],n=0;n<this.photoGrid.gridChildren.length&&t.length<e.preset.matrix.items.length;n++){var i=this.photoGrid.gridChildren[n];i.menuImageVO&&!i.content.isEmpty&&t.push(i.menuImageVO)}this.updateToolVO(e.preset.matrix.width,e.preset.matrix.height,e.preset.gap,e.preset.itemRoundness,BFN.CollageMakerCanvasBackground.color,!1,!0,!0),this.preparePhotoGrid(e.preset.matrix.width,e.preset.matrix.height,e.preset.gap/100,e.preset.itemRoundness/100),this._gridWidth=e.preset.matrix.width,this._gridHeight=e.preset.matrix.height,BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;for(var r=0;r<e.preset.matrix.items.length;r++){var a=e.preset.matrix.items[r];if(a&&a.hasOwnProperty("x")&&a.hasOwnProperty("y")&&a.hasOwnProperty("width")&&a.hasOwnProperty("height")){var o=this.photoGrid.addGridChild(a.x,a.y,a.width,a.height);t.length&&(o.menuImageVO=t.shift(),o.content.setImage(o.menuImageVO.imageTexture)),o.updateProjectItemVO()}}t.splice(0),BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateOriginalAspectRatio(),this.setFreeformAspectRatio(),this.updateSettings(),BFN.CollageMakerHistoryModel.historyAction="new_grid_template",this.photoGrid.getPhotoGridSnapShot(),this.photoGrid.matchesTemplate=!0;var s=null,l=null;if(BFN.CollageMakerTemplateData.templateCategories.forEach(function(t){s||e.categoryID!==t.id||(s=t.name,l=BFN.CollageMakerHistoryModel.snapshotVOs.length?BFN.CollageMakerHistoryModel.snapshotVOs[BFN.CollageMakerHistoryModel.snapshotVOs.length-1]:null)}),s&&l){var u=new BFN.UserActionVO;u.eventID="collage_layout_selected",u.eventObject={templateType:"Constrained",templateCategory:s},u.actionSection="collage",u.actionTimestamp=l.timestamp,u.register()}},h_.prototype.applyFreeformTemplate=function(){BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),BFN.CollageMakerHistoryModel.resetHistory(),BFN.CollageMakerCanvasPhotoGridModel.freeform=!0,this.updateToolVO(BFN.CollageMakerTemplateModel.freeformWidth,BFN.CollageMakerTemplateModel.freeformHeight,0,0,BFN.CollageMakerCanvasBackground.color,!1,!1,!1),this.preparePhotoGrid(BFN.CollageMakerTemplateModel.freeformWidth,BFN.CollageMakerTemplateModel.freeformHeight,0,0),this._gridWidth=BFN.CollageMakerTemplateModel.freeformWidth,this._gridHeight=BFN.CollageMakerTemplateModel.freeformHeight,this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateOriginalAspectRatio(),this.setFreeformAspectRatio(),this.updateSettings();var e=new BFN.UserActionVO;e.eventID="collage_layout_selected",e.eventObject={templateType:"Freeform",templateCategory:"Blank"},e.actionSection="collage",e.actionTimestamp=0,e.register()},h_.prototype.applyAutoCollageLayoutObject=function(){var e=BFN.CollageMakerCanvasPhotoGridModel.autoCollageLayoutObject;if(e){this.updateToolVO(e.width,e.height,0,0,BFN.CollageMakerCanvasBackground.color,!1,!BFN.CollageMakerCanvasPhotoGridModel.freeform,!BFN.CollageMakerCanvasPhotoGridModel.freeform),this.preparePhotoGrid(e.width,e.height,0,0),this._gridWidth=e.width,this._gridHeight=e.height;var t=null;if(BFN.CollageMakerCanvasPhotoGridModel.freeform){this.pendingAutoCollageBaseTextures.splice(0);for(var n=0;n<e.data.length;n++){var i=e.data[n].menuImageVO.imageTexture.baseTexture;this.pendingAutoCollageBaseTextures.includes(i)||this.pendingAutoCollageBaseTextures.push(i)}BFN.CollageMakerCanvasModel.dispatchEvent(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS),this.pendingAutoCollageBaseTextures.splice(0),this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateOriginalAspectRatio(),this.setFreeformAspectRatio(),this.updateSettings(),BFN.TransformStateModel.blockAddedTransitions=!0;for(var r=this.longestSide/Math.max(e.width,e.height),a=0;a<e.data.length;a++){var o=e.data[a],s=o.rect,l=new PIXI.Point(s.x*r,s.y*r),u=new PIXI.Point(s.width*r,s.height*r);BFN.CollageMakerCanvasModel.addedItem={type:"frame_texture",texture:o.menuImageVO.imageTexture,projectItemAssetID:o.menuImageVO.id,initialPosition:l,initialDimensions:u},BFN.BfnService.storeBlobForMenuImageVO(o.menuImageVO,"collage"),BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.preloadThumbnail(5*a+50)}BFN.TransformModel.selectedTransformItem&&BFN.TransformModel.selectedTransformItem.deselectItem(),BFN.TransformStateModel.blockAddedTransitions=!1,BFN.TransformStateModel.clearTransitions()}else{BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;for(var c=0;c<e.data.length;c++){var h=e.data[c],d=h.rect,m=this.photoGrid.addGridChild(d.x,d.y,d.width,d.height);m.menuImageVO=h.menuImageVO,m.content.setImage(m.menuImageVO.imageTexture),m.updateProjectItemVO()}BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.longestSide=BFN.defaultCollageSize,this.adjustGridSizeToLongestSide(),this.updateOriginalAspectRatio(),this.setFreeformAspectRatio(),this.updateSettings(),BFN.CollageMakerHistoryModel.historyAction="collage_wizard",this.photoGrid.getPhotoGridSnapShot(),t=BFN.CollageMakerHistoryModel.snapshotVOs.length?BFN.CollageMakerHistoryModel.snapshotVOs[BFN.CollageMakerHistoryModel.snapshotVOs.length-1]:null}var p=new BFN.UserActionVO;p.eventID="collage_layout_selected",p.eventObject={templateType:BFN.CollageMakerCanvasPhotoGridModel.freeform?"Freeform":"Constrained",templateCategory:"Collage Wizard"},p.actionSection="collage",p.actionTimestamp=!BFN.CollageMakerCanvasPhotoGridModel.freeform&&t?t.timestamp:0,p.register()}},h_.prototype.applyPhotoGridSnapshot=function(){if(BFN.CollageMakerHistoryModel.currentSnapshotVO){this.photoGrid.hideDragBar();var e=BFN.CollageMakerHistoryModel.currentSnapshotVO;if(this.updateToolVO(e.snapshotWidth,e.snapshotHeight,100*e.gap,100*e.rounding,e.backgroundColor),this.preparePhotoGrid(e.gridWidth,e.gridHeight,e.gap,e.rounding),this._gridWidth=e.snapshotWidth,this._gridHeight=e.snapshotHeight,BFN.CollageMakerCanvasBackground.color!=e.backgroundColor&&(BFN.CollageMakerCanvasBackground.color=e.backgroundColor),e.backgroundPatternBaseTexture){var t=new PIXI.Texture(e.backgroundPatternBaseTexture);this.setPatternBackgroundTexture(t),t.destroyGC(!1)}else this.patternBackground.visible&&this.setPatternBackgroundTexture(null);this.photoGrid.backgroundColor==BFN.CollageMakerCanvasBackground.color||this.patternBackground.visible||(this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color),BFN.CollageMakerHistoryModel.ignoreSnapshot=!0;for(var n=0;n<e.snapshotChildren.length;n++){var i=e.snapshotChildren[n],r=this.photoGrid.addGridChild(i.rect.x,i.rect.y,i.rect.width,i.rect.height);r.menuImageVO=i.menuImageVO,i.texture&&i.texture.valid&&r.content.setImage(i.texture),r.content.image.frameSprite.offsetFactorX=i.offsetFactorX,r.content.image.frameSprite.offsetFactorY=i.offsetFactorY,r.content.image.frameSprite.rotate=i.rotate,r.content.image.frameSprite.textureScale=i.textureScale,r.content.image.frameSprite.offsetFactorX=i.offsetFactorX,r.content.image.frameSprite.offsetFactorY=i.offsetFactorY,r.content.image.frameSprite.updateDisplay(),r.updateProjectItemVO()}BFN.CollageMakerHistoryModel.ignoreSnapshot=!1,this.setFreeformAspectRatio(),this.updateSettings()}},h_.prototype.applyCollageSettings=function(){if(BFN.CollageMakerCanvasPhotoGridModel.collageSettings){var e=BFN.CollageMakerCanvasPhotoGridModel.collageSettings;if(this.updateToolVO(e.width,e.height,e.spacing,e.corner_rounding,e.background_color),this._gridWidth=e.width,this._gridHeight=e.height,BFN.CollageMakerCanvasBackground.color!=e.background_color&&(BFN.CollageMakerCanvasBackground.color=e.background_color),e.backgroundPatternBaseTexture){var t=new PIXI.Texture(e.backgroundPatternBaseTexture);this.setPatternBackgroundTexture(t),t.destroyGC(!1)}else this.patternBackground.visible&&this.setPatternBackgroundTexture(null);this.photoGrid.backgroundColor==BFN.CollageMakerCanvasBackground.color||this.patternBackground.visible||(this.photoGrid.backgroundColor=BFN.CollageMakerCanvasBackground.color),this.setFreeformAspectRatio(),this.updateSettings()}},h_.prototype.handlePhotoGridSnapShot=function(e){this.createPhotoGridSnapshot()},h_.prototype.handleCurrentTemplateUpdated=function(e){if(!this.photoGrid.matchesTemplate||BFN.CollageMakerTemplateModel.currentTemplate!=this.lastTemplate){var t=BFN.CollageMakerCanvasModel.itemsExist;BFN.CollageMakerCanvasPhotoGridModel.freeform&&t?BeFunky.confirm("confirm_template_mode_change",{onConfirm:this.applyCurrentTemplate.bind(this)}):this.applyCurrentTemplate()}},h_.prototype.handleFreeformTemplate=function(){var e=BFN.CollageMakerCanvasModel.itemsExist||!this.photoGrid.isEmpty;BFN.CollageMakerCanvasPhotoGridModel.freeform?console.log("ALREADY IN FREEFORM MODE"):e?BeFunky.confirm("confirm_template_mode_change",{onConfirm:this.applyFreeformTemplate.bind(this)}):this.applyFreeformTemplate()},h_.prototype.handleAutoCollageLayoutObject=function(e){this.applyAutoCollageLayoutObject()},h_.prototype.handleApplyCurrentSnapShot=function(e){this.applyPhotoGridSnapshot()},h_.prototype.handleCollageSettingsUpdated=function(e){this.applyCollageSettings()},h_.prototype.handleClearAll=function(e){BFN.CollageMakerCanvasPhotoGridModel.freeform?(this.resetBackground(),this.applyFreeformTemplate()):(this.photoGrid.removeAllGridChildren(),BFN.CollageMakerHistoryModel.resetHistory(),this.initInitialTemplate())},Object.defineProperty(h_.prototype,"canvasScale",{set:function(e){this._canvasScale=e,this.patternBackground.smoothScale=this._canvasScale,this.photoGrid.scale=this._canvasScale},get:function(){return this._canvasScale}}),Object.defineProperty(h_.prototype,"gridWidth",{get:function(){return this._gridWidth}}),Object.defineProperty(h_.prototype,"gridHeight",{get:function(){return this._gridHeight}}),BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvasPhotoGrid=new h_}),d_.prototype=Object.create(PIXI.Sprite.prototype),d_.prototype.init=function(){BeFunky.log("CollageMakerCanvas Init"),this.initDefaultValues(),this.initCheckerPanel(),this.initCanvas(),this.initBackground(),this.initPhotoGrid(),this.initTransformLayer(),this.initTransformLayerVeil(),this.initCanvasGlow(),this.initCanvasScaleBars(),this.initTransformIndicatorContainer(),this.initTransformGuidesContainer(),this.initTransformItemBoundingBoxesContainer(),this.initTransformTool(),this.initTransformToolSnapGaps(),this.initTransformItemIsolator(),this.initLayerToolContainer(),this.initMoveTouchSurface(),this.initCanvasDragger(),this.initAnimators(),setTimeout(function(){this.updateLayout(),this.updateCanvasView(),this.updateDisplay()}.bind(this),0)},d_.prototype.initDefaultValues=function(){this.interactive=!0,this.mouseOver=!1,this.model=BFN.CollageMakerCanvasModel,BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME.type,this.handleFitCollageToFrame.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.FIT_COLLAGE_TO_FRAME_ANIMATED.type,this.handleFitCollageToFrameAnimated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.ITEM_ADDED.type,this.handleItemAdded.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CLEAR_ITEMS.type,this.handleClearItems.bind(this)),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.GRID_SIZE_CHANGED.type,this.handleGridSizeChanged.bind(this)),this.on("pointerover",this.handleCanvasMouseOver.bind(this)),this.on("pointerout",this.handleCanvasMouseOut.bind(this)),this.handleCanvasKeyDownBind=this.handleCanvasKeyDown.bind(this),this.handleCanvasSpaceKeyUpBind=this.handleCanvasSpaceKeyUp.bind(this),document.addEventListener("keydown",this.handleCanvasKeyDownBind,!1)},d_.prototype.initCheckerPanel=function(){this.checkerPanel=new BFN.CheckerPanel,this.checkerPanel.setDimensions(0,0),this.addChild(this.checkerPanel)},d_.prototype.initCanvas=function(){this.canvasContainer=new PIXI.Sprite,this.canvasContainer.interactive=!0,this.addChild(this.canvasContainer),this.canvas=new PIXI.Sprite,this.canvasContainer.addChild(this.canvas)},d_.prototype.initBackground=function(){this.background=BFN.CollageMakerCanvasBackground,this.canvas.addChild(this.background)},d_.prototype.initPhotoGrid=function(){this.canvasPhotoGrid=BFN.CollageMakerCanvasPhotoGrid,this.canvasPhotoGrid.addEventListener(BFN.CollageMakerCanvasPhotoGridEvents.RESIZING_COMPLETE.type,this.handleCanvasPhotoGridResizingComplete.bind(this)),this.canvas.addChild(this.canvasPhotoGrid)},d_.prototype.initTransformLayer=function(){this.transformLayerContainer=new PIXI.Container,this.canvas.addChild(this.transformLayerContainer),this.transformLayer=new BFN.TransformLayer(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,this),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformItemsUpdated.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_SELECTED.type,this.handleTransformItemSelected.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED.type,this.handleTransformItemDisplayUpdated.bind(this)),this.transformLayerContainer.addChild(this.transformLayer)},d_.prototype.initTransformLayerVeil=function(){var e=this;this.transformLayerVeil=new BFN.CanvasFrame(mn().hex,1,BFN.CollageMakerCanvasModel.collageFitPaddingX,BFN.CollageMakerCanvasModel.collageFitPaddingY),this.addChild(this.transformLayerVeil),gn(function(t){var n=t.hex;e.transformLayerVeil.color=n})},d_.prototype.initCanvasGlow=function(){this.canvasGlow=new BFN.CanvasGlow,this.addChild(this.canvasGlow)},d_.prototype.initCanvasScaleBars=function(){this.canvasScaleBars=new BFN.CanvasScaleBars(BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER),this.canvasScaleBars.minSize=BFN.minCollageSize,this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.SCALING_STARTED.type,this.handleCanvasScaleBarsScalingStarted.bind(this)),this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.SCALING_COMPLETE.type,this.handleCanvasScaleBarsScalingComplete.bind(this)),this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.DIMENSIONS_UPDATED.type,this.handleCanvasScaleBarsDimensionsUpdated.bind(this)),this.canvasScaleBars.addEventListener(BFN.CanvasScaleBarsEvents.SCALE_BAR_ACTION.type,this.handleCanvasScaleBarsScaleBarAction.bind(this)),this.addChild(this.canvasScaleBars)},d_.prototype.initTransformIndicatorContainer=function(){this.transformIndicatorContainer=new PIXI.Container,this.transformIndicatorContainer.interactiveChildren=!1,this.addChild(this.transformIndicatorContainer)},d_.prototype.initTransformGuidesContainer=function(){this.transformGuidesContainer=new PIXI.Container,this.addChild(this.transformGuidesContainer)},d_.prototype.initTransformItemBoundingBoxesContainer=function(){this.transformItemBoundingBoxesContainer=new PIXI.Container,this.addChild(this.transformItemBoundingBoxesContainer)},d_.prototype.initTransformTool=function(){this.transformTool=new BFN.TransformTool(this.transformLayer),this.addChild(this.transformTool),this.transformLayer.transformTool=this.transformTool},d_.prototype.initTransformToolSnapGaps=function(){this.transformToolSnapGapsContainer=new PIXI.Container,this.addChild(this.transformToolSnapGapsContainer)},d_.prototype.initTransformItemIsolator=function(){this.transformItemIsolatorContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformItemIsolatorContainer)},d_.prototype.initLayerToolContainer=function(){this.layerToolContainer=new PIXI.Container,this.addChild(this.layerToolContainer)},d_.prototype.initMoveTouchSurface=function(){this.moveTouchSurface=new PIXI.Graphics,this.moveTouchSurface.interactive=!0,this.moveTouchSurface.visible=!1,this.moveTouchSurface.beginFill(0,0),this.moveTouchSurface.drawRect(-50,-50,100,100),this.moveTouchSurface.endFill(),this.moveTouchSurface.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.moveTouchSurface.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.moveTouchSurface.on("pointerdown",this.handleMoveTouchSurfacePressed.bind(this)),this.addChild(this.moveTouchSurface)},d_.prototype.initCanvasDragger=function(){this.canvasDragger=new BFN.Dragger,this.canvasDragger.pixelDragThreshold=5,this.canvasDragger.pixelDragThresholdPreventEvent=!0,this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasDraggerDraggingComplete.bind(this))},d_.prototype.initAnimators=function(){this.fitCollageAnimator=new BFN.Animator,this.fitCollageAnimator.linearSteps=10,this.fitCollageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFitCollageAnimatorUpdate.bind(this)),this.fitCollageAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleFitCollageAnimatorUpdateComplete.bind(this))},d_.prototype.handleCustomize=function(){this.canvasPhotoGrid.handleCustomize()},d_.prototype.handleCollageImage=function(){this.canvasPhotoGrid.handleCollageImage()},d_.prototype.updateLayout=function(){this.canvas.x=-this.canvasPhotoGrid.gridWidth/2,this.canvas.y=-this.canvasPhotoGrid.gridHeight/2,this.background.itemWidth=this.canvasPhotoGrid.gridWidth,this.background.itemHeight=this.canvasPhotoGrid.gridHeight,this.canvasScaleBars.canvasWidth=this.canvasPhotoGrid.gridWidth,this.canvasScaleBars.canvasHeight=this.canvasPhotoGrid.gridHeight,this.canvasPhotoGrid.x=-this.canvas.x,this.canvasPhotoGrid.y=-this.canvas.y,this.transformLayer.x=-this.canvas.x,this.transformLayer.y=-this.canvas.y},d_.prototype.updateCanvasContainerDisplay=function(){var e=2*BFN.CollageMakerCanvasModel.collageFitPaddingX,t=2*BFN.CollageMakerCanvasModel.collageFitPaddingY,n=this.canvasPhotoGrid.gridWidth,i=this.canvasPhotoGrid.gridHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(n-=(n-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,i-=(i-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(n=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,i=BFN.PhotoEditorCanvasTools.currentTool.itemHeight);var r=this.scale.x*n,a=this.scale.y*i,o=Math.max(0,n-BFN.StageModel.stageW/r*n+1/this.scale.x*e),s=Math.max(0,i-BFN.StageModel.stageH/a*i+1/this.scale.y*t);this.canvasDragger.setBounds(-o/2,-s/2,o/2,s/2),this.canvasContainer.x=Math.round(Math.min(this.canvasDragger.bounds.maxX,Math.max(this.canvasDragger.bounds.minX,this.canvasContainer.x))),this.canvasContainer.y=Math.round(Math.min(this.canvasDragger.bounds.maxY,Math.max(this.canvasDragger.bounds.minY,this.canvasContainer.y))),this.layerToolContainer.x=this.canvasContainer.x,this.layerToolContainer.y=this.canvasContainer.y,this.transformItemBoundingBoxesContainer.x=this.canvasContainer.x,this.transformItemBoundingBoxesContainer.y=this.canvasContainer.y,this.canvasScaleBars.x=this.canvasContainer.x,this.canvasScaleBars.y=this.canvasContainer.y,this.updateCheckerPanel(),this.updateTransformLayerVeil(),this.updateToolPosition(),BFN.TransformGuides.updateDisplay(),BFN.MainUI.requestRender()},d_.prototype.updateToolPosition=function(){this.transformTool.x=this.transformLayerVeil.x=this.canvasContainer.x,this.transformTool.y=this.transformLayerVeil.y=this.canvasContainer.y},d_.prototype.updateDisplay=function(){this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},d_.prototype.updateCanvasView=function(){this.updateTransformLayerVeil(),BFN.ZoomManager.updateZoomRange(),BFN.MainUI&&BFN.MainUI.requestRender()},d_.prototype.updatePosition=function(){this.x=Math.round(BFN.StageModel.stageW/2),this.y=Math.round(BFN.StageModel.stageH/2),this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.updateTransformLayerVeilOuterDimensions(),this.updateCanvasContainerDisplay()},d_.prototype.updateScale=function(){this.scale.x=this.scale.y=this.transformLayer.canvasScale=this.transformTool.scale=this.canvasDragger.scale=BFN.CollageMakerCanvasModel.canvasScale,this.transformItemBoundingBoxesContainer.children.includes(BFN.TransformItemBoundingBoxes)&&(BFN.TransformItemBoundingBoxes.lineScale=BFN.CollageMakerCanvasModel.canvasScale),this.transformGuidesContainer.scale.x=1/this.scale.x,this.transformGuidesContainer.scale.y=1/this.scale.y,this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.layerToolContainer.children.includes(BFN.PhotoEditorCanvasTools)&&(BFN.PhotoEditorCanvasTools.scale=BFN.CollageMakerCanvasModel.canvasScale),this.canvasPhotoGrid.canvasScale=BFN.CollageMakerCanvasModel.canvasScale,this.canvasScaleBars.canvasScale=BFN.CollageMakerCanvasModel.canvasScale,this.transformLayerVeil.canvasScale=BFN.CollageMakerCanvasModel.canvasScale,this.canvasGlow.canvasScale=BFN.CollageMakerCanvasModel.canvasScale,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},d_.prototype.fitCollageToFrame=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=2*BFN.CollageMakerCanvasModel.collageFitPaddingX,n=2*BFN.CollageMakerCanvasModel.collageFitPaddingY,i=this.canvasPhotoGrid.gridWidth,r=this.canvasPhotoGrid.gridHeight;BFN.TransformItemIsolator.active&&(i=BFN.TransformItemIsolator.itemWidth,r=BFN.TransformItemIsolator.itemHeight),i<=0||r<=0||(this.fitScale=Math.min(1,(BFN.StageModel.stageW-t)/i,(BFN.StageModel.stageH-n)/r),e?(BFN.CollageMakerCanvasModel.canvasScaling=!0,BFN.CollageMakerCanvasModel.disregardScaleRange=!0,BFN.CollageMakerCanvasModel.canvasScale/=this.canvasPhotoGrid.adjustmentScaleFactor,this.startScale=BFN.CollageMakerCanvasModel.canvasScale,Math.abs(this.fitScale-this.startScale)>.001?this.fitCollageAnimator.setAnimatorFactor(0):this.fitCollageAnimator.setAnimatorFactor(1),this.fitCollageAnimator.increase()):(BFN.CollageMakerCanvasModel.canvasScale=this.fitScale,BFN.CollageMakerCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()))},d_.prototype.updateCheckerPanel=function(){this.checkerPanel.x=this.canvasContainer.x,this.checkerPanel.y=this.canvasContainer.y,this.checkerPanel.scale=BFN.CollageMakerCanvasModel.canvasScale;var e={x:0,y:0};if(this.canvasPhotoGrid.gridWidth>1&&this.canvasPhotoGrid.gridHeight>1&&(e.x=this.canvasPhotoGrid.gridWidth,e.y=this.canvasPhotoGrid.gridHeight),BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)){var t=BFN.TransformItemIsolator.itemWidth,n=BFN.TransformItemIsolator.itemHeight;BFN.TransformItemIsolator.shiftAnimator.animating&&(t=BFN.TransformItemIsolator.shiftParamsEnd.w-(BFN.TransformItemIsolator.shiftParamsEnd.w-BFN.TransformItemIsolator.shiftParamsStart.w)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor),n=BFN.TransformItemIsolator.shiftParamsEnd.h-(BFN.TransformItemIsolator.shiftParamsEnd.h-BFN.TransformItemIsolator.shiftParamsStart.h)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor)),e.x=e.x-(e.x-t)*BFN.TransformItemIsolator.activeFactor,e.y=e.y-(e.y-n)*BFN.TransformItemIsolator.activeFactor}this.checkerPanel.setDimensions(e.x,e.y),this.updateCanvasGlow()},d_.prototype.updateCanvasGlow=function(){var e=this.checkerPanel.width,t=this.checkerPanel.height;this.canvasGlow.x=this.canvasContainer.x-e/2%1,this.canvasGlow.y=this.canvasContainer.y-t/2%1,this.canvasGlow.setDimensions(e,t)},d_.prototype.updateTransformLayerVeil=function(){this.transformLayer.frameWidth=this.canvasPhotoGrid.gridWidth,this.transformLayer.frameHeight=this.canvasPhotoGrid.gridHeight,this.transformTool.frameWidth=this.canvasPhotoGrid.gridWidth,this.transformTool.frameHeight=this.canvasPhotoGrid.gridHeight;var e=this.transformLayer.frameWidth,t=this.transformLayer.frameHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(e=this.transformLayer.frameWidth-(this.transformLayer.frameWidth-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,t=this.transformLayer.frameHeight-(this.transformLayer.frameHeight-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),this.moveTouchSurface.scale.x=e/100,this.moveTouchSurface.scale.y=t/100,this.drawTransformLayerVeil(e,t)},d_.prototype.updateTransformLayerVeilOuterDimensions=function(){this.transformLayerVeil.setOuterDimensions(BFN.StageModel.stageW+20,BFN.StageModel.stageH+2)},d_.prototype.drawTransformLayerVeil=function(e,t){e=Math.round(e),t=Math.round(t),this.transformLayerVeil.setInnerDimensions(e,t)},d_.prototype.getFlattenedImage=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.canvasPhotoGrid.getScreenCapture(e);return this.transformLayer.itemsExist&&(this.transformLayerContainer.removeChild(this.transformLayer),this.transformLayer.toggleFlattenDisplayMode(!0),BFN.Stage.render(this.transformLayer,t,!1),this.transformLayer.toggleFlattenDisplayMode(!1),this.transformLayerContainer.addChild(this.transformLayer)),t},d_.prototype.handleStageDimensionsUpdated=function(){this.updatePosition()},d_.prototype.handleCanvasScaleUpdated=function(){this.updateScale()},d_.prototype.handleFitCollageToFrame=function(){this.fitCollageToFrame()},d_.prototype.handleFitCollageToFrameAnimated=function(){this.fitCollageToFrame(!0)},d_.prototype.handleItemAdded=function(){BFN.CollageMakerCanvasModel.addedItem&&(BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.transformLayer.addItem(BFN.CollageMakerCanvasModel.addedItem),BFN.CollageMakerCanvasModel.addedItem=null)},d_.prototype.handleClearItems=function(){this.transformLayer.destroyAllItems(),BFN.TransformStateModel.clearTransitions()},d_.prototype.handleGridSizeChanged=function(){this.updateLayout(),this.updateCanvasContainerDisplay(),this.transformLayer.frameWidth=this.canvasPhotoGrid.gridWidth,this.transformLayer.frameHeight=this.canvasPhotoGrid.gridHeight,this.updateTransformLayerVeil()},d_.prototype.handleCanvasPhotoGridResizingComplete=function(e){this.fitCollageToFrame(!0)},d_.prototype.handleCanvasScaleBarsScalingStarted=function(e){this.canvasPhotoGrid.manualGridResize=!0},d_.prototype.handleCanvasScaleBarsScalingComplete=function(e){UITools.setToolValue("collage_customize","width",this.canvasScaleBars.canvasWidth,!1),UITools.setToolValue("collage_customize","height",this.canvasScaleBars.canvasHeight,!1),UITools.updateToolControls("collage_customize"),UITools.applyTool("collage_customize")},d_.prototype.handleCanvasScaleBarsDimensionsUpdated=function(e){UITools.setToolValue("collage_customize","width",this.canvasScaleBars.canvasWidth,!0),UITools.setToolValue("collage_customize","height",this.canvasScaleBars.canvasHeight,!0),UITools.updateToolControls("collage_customize"),UITools.applyTool("collage_customize")},d_.prototype.handleCanvasScaleBarsScaleBarAction=function(e){var t=e.data.id;switch(e.data.action){case"over":BFN.PhotoGrid.showEdgeIndicators("topLeft"==t||"left"==t||"bottomLeft"==t?1:0,"topLeft"==t||"top"==t||"topRight"==t?1:0,"topRight"==t||"right"==t||"bottomRight"==t?1:0,"bottomRight"==t||"bottom"==t||"bottomLeft"==t?1:0);break;case"out":t||BFN.PhotoGrid.showEdgeIndicators();break;case"press":BFN.PhotoGrid.showEdgeIndicators("topLeft"==t||"left"==t||"bottomLeft"==t?2:0,"topLeft"==t||"top"==t||"topRight"==t?2:0,"topRight"==t||"right"==t||"bottomRight"==t?2:0,"bottomRight"==t||"bottom"==t||"bottomLeft"==t?2:0);break;case"release":t?BFN.PhotoGrid.showEdgeIndicators("topLeft"==t||"left"==t||"bottomLeft"==t?1:0,"topLeft"==t||"top"==t||"topRight"==t?1:0,"topRight"==t||"right"==t||"bottomRight"==t?1:0,"bottomRight"==t||"bottom"==t||"bottomLeft"==t?1:0):BFN.PhotoGrid.showEdgeIndicators()}},d_.prototype.handleTransformItemsUpdated=function(){var e=this.transformLayer.itemsExist;BFN.CollageMakerCanvasModel.itemsExist!=e&&(BFN.CollageMakerCanvasModel.itemsExist=e)},d_.prototype.handleTransformItemSelected=function(){this.transformLayer.selectedItem?(this.transformTool.selectItem(this.transformLayer.selectedItem),BFN.TransformModel.selectedTransformItem!=this.transformLayer.selectedItem&&(BFN.TransformModel.selectedTransformItem=this.transformLayer.selectedItem)):(this.transformTool.deselectItem(),BFN.TransformModel.selectedTransformItem=null)},d_.prototype.handleTransformItemDisplayUpdated=function(){this.transformTool.updateDisplay()},d_.prototype.handleHoverSurfaceOver=function(e){setTimeout(function(){this.hoverSurfaceOver=!0,BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"grab"}.bind(this),0)},d_.prototype.handleHoverSurfaceOut=function(e){this.hoverSurfaceOver=!1,BFN.CursorScreen&&(BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"auto")},d_.prototype.handleMoveTouchSurfacePressed=function(e){e.stopPropagation(),this.canvasDragger.drag(this.canvasContainer)},d_.prototype.handleCanvasMouseOver=function(e){this.mouseOver=!0},d_.prototype.handleCanvasMouseOut=function(e){this.mouseOver=!1},d_.prototype.handleCanvasKeyDown=function(e){BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||32!=e.keyCode||this.moveTouchSurface.visible||(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!1),this.moveTouchSurface.visible=!0,BFN.MainUI.requestRender(),e.preventDefault())},d_.prototype.handleCanvasSpaceKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasSpaceKeyUpBind),this.moveTouchSurface.visible=!1,BFN.MainUI.requestRender(),BFN.PIXITicker.nudge()},d_.prototype.handleCanvasDraggerDragging=function(){this.updateCanvasContainerDisplay(),BFN.TransformModel.selectedTransformItem&&"group"===BFN.TransformModel.selectedTransformItem.type&&BFN.TransformModel.selectedTransformItem.updateGroupTransform()},d_.prototype.handleCanvasDraggerDraggingComplete=function(){BeFunky.log("DRAGGING CANVAS COMPLETED")},d_.prototype.handleFitCollageAnimatorUpdate=function(){BFN.CollageMakerCanvasModel.canvasScale=(this.fitScale-this.startScale)*this.fitCollageAnimator.animationSinFactor+this.startScale},d_.prototype.handleFitCollageAnimatorUpdateComplete=function(){BFN.CollageMakerCanvasModel.canvasScaling=!1,BFN.CollageMakerCanvasModel.disregardScaleRange=!1,BFN.ZoomManager.updateZoomRange()},BFN.SingletonQueue.add(function(){BFN.CollageMakerCanvas=new d_}),m_.prototype=Object.create(PIXI.Sprite.prototype),m_.prototype.init=function(){BeFunky.log("CollageMaker Init"),this.initDefaultValues(),this.initCanvas()},m_.prototype.initDefaultValues=function(){BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this))},m_.prototype.initCanvas=function(){this.addChild(BFN.CollageMakerCanvas)},m_.prototype.handleAppReady=function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIPressed.bind(this))},m_.prototype.handleMainUIPressed=function(e){if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER&&!BFN.ColorPickerPanel.colorButton&&!BeFunky.isLoadScreenActive()&&BFN.TransformModel.selectedTransformItem){var t=e.data.canvasPressed,n=e.data.originalEvent,i=!(t&&(n.ctrlKey||n.metaKey||n.altKey));BFN.CollageMakerCanvas.transformLayer.deselectItem(i,n.shiftKey)}},BFN.SingletonQueue.add(function(){BFN.CollageMaker=new m_}),p_.prototype=Object.create(PIXI.Container.prototype),p_.prototype.init=function(){BeFunky.log("DesignerCanvasBackground Init"),this.initDefaultValues(),this.initBackgroundGraphic(),this.updateDisplay()},p_.prototype.initDefaultValues=function(){this.interactive=!0,this._itemWidth=340,this._itemHeight=340,this._color=UITools.getToolValue("collage_customize","background_color"),this.updateDisplayQueued=!1},p_.prototype.initBackgroundGraphic=function(){this.backgroundGraphic=new PIXI.Graphics,this.addChild(this.backgroundGraphic)},p_.prototype.queueUpdateDisplay=function(){this.updateDisplayQueued||(this.updateDisplayQueued=!0,setTimeout(function(){this.updateDisplayQueued=!1,this.updateDisplay()}.bind(this),0))},p_.prototype.updateDisplay=function(){this.backgroundGraphic.clear(),-1!=this._color&&this._itemWidth>0&&this._itemHeight>0&&(this.backgroundGraphic.beginFill(parseInt("0x"+this._color)),this.backgroundGraphic.drawRect(0,0,this._itemWidth,this._itemHeight),this.backgroundGraphic.endFill());try{BFN.MainUI.requestRender()}catch(e){}},Object.defineProperty(p_.prototype,"itemWidth",{set:function(e){this._itemWidth=e,this.updateDisplay()},get:function(){return this._itemWidth}}),Object.defineProperty(p_.prototype,"itemHeight",{set:function(e){this._itemHeight=e,this.updateDisplay()},get:function(){return this._itemHeight}}),Object.defineProperty(p_.prototype,"color",{set:function(e){this._color=e,this.updateDisplay()},get:function(){return this._color}}),BFN.SingletonQueue.add(function(){BFN.DesignerCanvasBackground=new p_}),g_.prototype=Object.create(PIXI.Sprite.prototype),g_.prototype.init=function(){var e=this;BeFunky.log("DesignerCanvas Init"),this.initDefaultValues(),this.initCheckerPanel(),this.initCanvas(),this.initBackground(),this.initTransformLayer(),this.initTransformLayerVeil(),this.initCanvasGlow(),this.initTransformIndicatorContainer(),this.initTransformGuidesContainer(),this.initTransformItemBoundingBoxesContainer(),this.initTransformTool(),this.initTransformToolSnapGaps(),this.initTransformItemIsolator(),this.initLayerToolContainer(),this.initMoveTouchSurface(),this.initCanvasDragger(),this.initAnimators(),setTimeout(function(){e.setSize(1,1),BFN.ZoomManager.updateZoomRange()},0)},g_.prototype.initDefaultValues=function(){this.interactive=!0,this.mouseOver=!1,this._canvasWidth=20,this._canvasHeight=20,this.customizePending=!1,this.handleMainUIPreRenderBind=this.handleMainUIPreRender.bind(this),this.updateCurrentTransition=!1,this.transitionVO=null,this.transitionUpdating=!1,this.uniqueTransitionTags=["background_color","resize_template"],this.fitToFrameAfterResize=!1,this.dimensionsLabel=document.getElementById("designer_settings_dimensions"),this.model=BFN.DesignerCanvasModel,BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME.type,this.handleFitDesignerToFrame.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.FIT_DESIGNER_TO_FRAME_ANIMATED.type,this.handleFitDesignerToFrameAnimated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.ITEM_ADDED.type,this.handleItemAdded.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CLEAR_ITEMS.type,this.handleClearItems.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.DESIGNER_SETTINGS_UPDATED.type,this.handleDesignerSettingsUpdated.bind(this)),this.on("pointerover",this.handleCanvasMouseOver.bind(this)),this.on("pointerout",this.handleCanvasMouseOut.bind(this)),this.handleCanvasKeyDownBind=this.handleCanvasKeyDown.bind(this),this.handleCanvasSpaceKeyUpBind=this.handleCanvasSpaceKeyUp.bind(this),document.addEventListener("keydown",this.handleCanvasKeyDownBind,!1)},g_.prototype.initCheckerPanel=function(){this.checkerPanel=new BFN.CheckerPanel,this.checkerPanel.setDimensions(0,0),this.addChild(this.checkerPanel)},g_.prototype.initCanvas=function(){this.canvasContainer=new PIXI.Sprite,this.canvasContainer.interactive=!0,this.addChild(this.canvasContainer),this.canvas=new PIXI.Sprite,this.canvasContainer.addChild(this.canvas)},g_.prototype.initBackground=function(){this.background=BFN.DesignerCanvasBackground,this.canvas.addChild(this.background)},g_.prototype.initTransformLayer=function(){this.transformLayerContainer=new PIXI.Container,this.canvas.addChild(this.transformLayerContainer),this.transformLayer=new BFN.TransformLayer(BFN.AppModelViewStates.VIEWING_DESIGNER,this),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEMS_UPDATED.type,this.handleTransformItemsUpdated.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_SELECTED.type,this.handleTransformItemSelected.bind(this)),this.transformLayer.addEventListener(BFN.TransformLayerEvents.ITEM_DISPLAY_UPDATED.type,this.handleTransformItemDisplayUpdated.bind(this)),this.transformLayerContainer.addChild(this.transformLayer)},g_.prototype.initTransformLayerVeil=function(){var e=this;this.transformLayerVeil=new BFN.CanvasFrame(mn().hex,1,BFN.DesignerCanvasModel.designerFitPaddingX,BFN.DesignerCanvasModel.designerFitPaddingY),this.addChild(this.transformLayerVeil),gn(function(t){var n=t.hex;e.transformLayerVeil.color=n})},g_.prototype.initCanvasGlow=function(){this.canvasGlow=new BFN.CanvasGlow,this.addChild(this.canvasGlow)},g_.prototype.initTransformIndicatorContainer=function(){this.transformIndicatorContainer=new PIXI.Container,this.transformIndicatorContainer.interactiveChildren=!1,this.addChild(this.transformIndicatorContainer)},g_.prototype.initTransformGuidesContainer=function(){this.transformGuidesContainer=new PIXI.Container,this.addChild(this.transformGuidesContainer)},g_.prototype.initTransformItemBoundingBoxesContainer=function(){this.transformItemBoundingBoxesContainer=new PIXI.Container,this.addChild(this.transformItemBoundingBoxesContainer)},g_.prototype.initTransformTool=function(){this.transformTool=new BFN.TransformTool(this.transformLayer),this.addChild(this.transformTool),this.transformLayer.transformTool=this.transformTool},g_.prototype.initTransformToolSnapGaps=function(){this.transformToolSnapGapsContainer=new PIXI.Container,this.addChild(this.transformToolSnapGapsContainer)},g_.prototype.initTransformItemIsolator=function(){this.transformItemIsolatorContainer=new PIXI.Container,this.canvasContainer.addChild(this.transformItemIsolatorContainer)},g_.prototype.initLayerToolContainer=function(){this.layerToolContainer=new PIXI.Container,this.addChild(this.layerToolContainer)},g_.prototype.initMoveTouchSurface=function(){this.moveTouchSurface=new PIXI.Graphics,this.moveTouchSurface.interactive=!0,this.moveTouchSurface.visible=!1,this.moveTouchSurface.beginFill(0,0),this.moveTouchSurface.drawRect(-50,-50,100,100),this.moveTouchSurface.endFill(),this.moveTouchSurface.on("pointerover",this.handleHoverSurfaceOver.bind(this)),this.moveTouchSurface.on("pointerout",this.handleHoverSurfaceOut.bind(this)),this.moveTouchSurface.on("pointerdown",this.handleMoveTouchSurfacePressed.bind(this)),this.addChild(this.moveTouchSurface)},g_.prototype.initCanvasDragger=function(){this.canvasDragger=new BFN.Dragger,this.canvasDragger.pixelDragThreshold=5,this.canvasDragger.pixelDragThresholdPreventEvent=!0,this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),this.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING_COMPLETE.type,this.handleCanvasDraggerDraggingComplete.bind(this))},g_.prototype.initAnimators=function(){this.fitDesignerAnimator=new BFN.Animator,this.fitDesignerAnimator.linearSteps=10,this.fitDesignerAnimator.addEventListener(BFN.AnimatorEvents.UPDATE.type,this.handleFitDesignerAnimatorUpdate.bind(this)),this.fitDesignerAnimator.addEventListener(BFN.AnimatorEvents.UPDATE_COMPLETE.type,this.handleFitDesignerAnimatorUpdateComplete.bind(this))},g_.prototype.handleCustomize=function(){this.customizePending||(this.customizePending=!0,BFN.MainUI.addEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind)),BFN.MainUI.requestRender()},g_.prototype.handleMainUIPreRender=function(){if(this.customizePending){this.customizePending=!1,BFN.MainUI.removeEventListener(BFN.MainUIEvents.PRE_RENDER.type,this.handleMainUIPreRenderBind);var e=UITools.getToolVO("collage_customize");if(!this.transitionUpdating){this.transitionUpdating=!0;var t="settings";switch(e.updating_id){case"background_color":t=-1==e.background_color?"background_transparent":"background_color";break;case"width":case"height":t="resize_template"}this.createHistoryTransition(t)}if(BFN.DesignerCanvasBackground.color!=e.background_color&&(BFN.DesignerCanvasBackground.color=e.background_color),["width","height"].includes(e.updating_id)&&(this._canvasWidth!=e.width||this._canvasHeight!=e.height)){if(e.smart_resize){var n=BFN.TransformLayerManager.smartResizeLayers(e.width,e.height);n&&(this.transitionVO.batchIDPlaceholder=n,this.transitionVO.isSettingsTransition=!0)}this.setSize(e.width,e.height),UITools.setToolValue("collage_customize","width",BFN.CollageMakerCanvas.canvasPhotoGrid.gridWidth),UITools.setToolValue("collage_customize","height",BFN.CollageMakerCanvas.canvasPhotoGrid.gridHeight),UITools.updateToolControls("collage_customize"),this.fitToFrameAfterResize&&(this.fitToFrameAfterResize=!1,this.fitDesignerToFrame(!0))}!e.updating&&this.transitionUpdating&&(this.transitionUpdating=!1,this.registerHistoryTransition())}},g_.prototype.createHistoryTransition=function(e){if(this.updateCurrentTransition=!1,this.transitionVO){if(-1==this.uniqueTransitionTags.indexOf(e)&&this.transitionVO.id==e&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp())return void(this.updateCurrentTransition=!0);this.transitionVO=null}this.transitionVO||(this.transitionVO=new BFN.TransformItemTransitionVO,this.transitionVO.id=e,this.transitionVO.alternateHistoryAction="designer_settings_updated",this.transitionVO.startState.designerSettings.background_color=BFN.DesignerCanvasBackground.color,this.transitionVO.startState.designerSettings.width=this._canvasWidth,this.transitionVO.startState.designerSettings.height=this._canvasHeight)},g_.prototype.registerHistoryTransition=function(){var e=this.updateCurrentTransition&&this.transitionVO&&this.transitionVO==BFN.TransformStateModel.currentTransition&&this.transitionVO.timestamp==BFN.UndoManager.getTimestamp(),t=this.getFlattenedImage();this.transitionVO.previewTexture&&this.transitionVO.previewTexture.destroyGC(!0),this.transitionVO.previewImage=null,this.transitionVO.thumbTexture&&this.transitionVO.thumbTexture.destroyGC(!0),this.transitionVO.thumbImage=null,this.transitionVO.previewTexture=BFN.Util.getThumbTexture(t,Math.min(Math.max(t.width,t.height),BFN.GlobalHistoryModel.globalHistoryMenuPreviewSize),!1,!1),this.transitionVO.thumbTexture=BFN.Util.getThumbTexture(t,BFN.GlobalHistoryModel.globalHistoryMenuThumbSize,!0,!1),t.destroyGC(!0),t=null,this.transitionVO.endState.designerSettings.background_color=BFN.DesignerCanvasBackground.color,this.transitionVO.endState.designerSettings.width=this._canvasWidth,this.transitionVO.endState.designerSettings.height=this._canvasHeight,e?BFN.TransformStateModel.dispatchEvent(BFN.TransformStateModelEvents.TRANSITIONS_UPDATED):BFN.TransformStateModel.addTransition(this.transitionVO),BFN.DesignerModel.updateProjectVO(!1)},g_.prototype.setSize=function(e,t){this._canvasWidth=this.background.itemWidth=e,this._canvasHeight=this.background.itemHeight=t,this.dimensionsLabel.innerHTML="".concat(this._canvasWidth," × ").concat(this._canvasHeight,'<span style="padding-left: 2px;">px</span>'),BFN.ZoomManager.updateZoomRange(),this.updateDisplay()},g_.prototype.updateCanvasContainerDisplay=function(){this.visible=this._canvasWidth>1&&this._canvasHeight>1;var e=2*BFN.DesignerCanvasModel.designerFitPaddingX,t=2*BFN.DesignerCanvasModel.designerFitPaddingY,n=this._canvasWidth,i=this._canvasHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(n-=(n-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,i-=(i-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),BFN.PhotoEditorCanvasTools.currentTool&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemWidth")&&BFN.PhotoEditorCanvasTools.currentTool.hasOwnProperty("itemHeight")&&(n=BFN.PhotoEditorCanvasTools.currentTool.itemWidth,i=BFN.PhotoEditorCanvasTools.currentTool.itemHeight);var r=this.scale.x*n,a=this.scale.y*i,o=Math.max(0,n-BFN.StageModel.stageW/r*n+1/this.scale.x*e),s=Math.max(0,i-BFN.StageModel.stageH/a*i+1/this.scale.y*t);this.canvasDragger.setBounds(-o/2,-s/2,o/2,s/2),this.canvasContainer.x=Math.round(Math.min(this.canvasDragger.bounds.maxX,Math.max(this.canvasDragger.bounds.minX,this.canvasContainer.x))),this.canvasContainer.y=Math.round(Math.min(this.canvasDragger.bounds.maxY,Math.max(this.canvasDragger.bounds.minY,this.canvasContainer.y))),this.layerToolContainer.x=this.canvasContainer.x,this.layerToolContainer.y=this.canvasContainer.y,this.transformItemBoundingBoxesContainer.x=this.canvasContainer.x,this.transformItemBoundingBoxesContainer.y=this.canvasContainer.y,this.updateCheckerPanel(),this.updateTransformLayerVeil(),this.updateToolPosition(),BFN.TransformGuides.updateDisplay(),BFN.MainUI.requestRender()},g_.prototype.updateToolPosition=function(){this.transformTool.x=this.transformLayerVeil.x=this.canvasContainer.x,this.transformTool.y=this.transformLayerVeil.y=this.canvasContainer.y},g_.prototype.updateDisplay=function(){this.canvas.x=-this._canvasWidth/2,this.canvas.y=-this._canvasHeight/2,this.transformLayer.x=-this.canvas.x,this.transformLayer.y=-this.canvas.y,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},g_.prototype.updatePosition=function(){this.x=Math.round(BFN.StageModel.stageW/2),this.y=Math.round(BFN.StageModel.stageH/2),this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.updateTransformLayerVeilOuterDimensions(),this.updateCanvasContainerDisplay()},g_.prototype.updateScale=function(){this.scale.x=this.scale.y=this.transformLayer.canvasScale=this.transformTool.scale=this.canvasDragger.scale=BFN.DesignerCanvasModel.canvasScale,this.transformItemBoundingBoxesContainer.children.includes(BFN.TransformItemBoundingBoxes)&&(BFN.TransformItemBoundingBoxes.lineScale=BFN.DesignerCanvasModel.canvasScale),this.transformGuidesContainer.scale.x=1/this.scale.x,this.transformGuidesContainer.scale.y=1/this.scale.y,this.transformGuidesContainer.x=-this.x/this.scale.x,this.transformGuidesContainer.y=-this.y/this.scale.y,BFN.TransformGuides.updateDisplay(),this.layerToolContainer.children.includes(BFN.PhotoEditorCanvasTools)&&(BFN.PhotoEditorCanvasTools.scale=BFN.DesignerCanvasModel.canvasScale),this.transformLayerVeil.canvasScale=BFN.DesignerCanvasModel.canvasScale,this.canvasGlow.canvasScale=BFN.DesignerCanvasModel.canvasScale,this.updateCanvasContainerDisplay(),BFN.MainUI.requestRender()},g_.prototype.fitDesignerToFrame=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=2*BFN.DesignerCanvasModel.designerFitPaddingX,n=2*BFN.DesignerCanvasModel.designerFitPaddingY,i=this._canvasWidth,r=this._canvasHeight;BFN.TransformItemIsolator.active&&(i=BFN.TransformItemIsolator.itemWidth,r=BFN.TransformItemIsolator.itemHeight),i<=0||r<=0||(this.fitScale=Math.min(1,(BFN.StageModel.stageW-t)/i,(BFN.StageModel.stageH-n)/r),e?(BFN.DesignerCanvasModel.canvasScaling=!0,this.startScale=BFN.DesignerCanvasModel.canvasScale,Math.abs(this.fitScale-this.startScale)>.001?this.fitDesignerAnimator.setAnimatorFactor(0):this.fitDesignerAnimator.setAnimatorFactor(1),this.fitDesignerAnimator.increase()):(BFN.DesignerCanvasModel.canvasScale=this.fitScale,BFN.DesignerCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()))},g_.prototype.updateCheckerPanel=function(){this.checkerPanel.x=this.canvasContainer.x,this.checkerPanel.y=this.canvasContainer.y,this.checkerPanel.scale=BFN.DesignerCanvasModel.canvasScale;var e={x:0,y:0};if(this._canvasWidth>1&&this._canvasHeight>1&&(e.x=this._canvasWidth,e.y=this._canvasHeight),BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)){var t=BFN.TransformItemIsolator.itemWidth,n=BFN.TransformItemIsolator.itemHeight;BFN.TransformItemIsolator.shiftAnimator.animating&&(t=BFN.TransformItemIsolator.shiftParamsEnd.w-(BFN.TransformItemIsolator.shiftParamsEnd.w-BFN.TransformItemIsolator.shiftParamsStart.w)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor),n=BFN.TransformItemIsolator.shiftParamsEnd.h-(BFN.TransformItemIsolator.shiftParamsEnd.h-BFN.TransformItemIsolator.shiftParamsStart.h)*(1-BFN.TransformItemIsolator.shiftAnimator.animationSinFactor)),e.x=e.x-(e.x-t)*BFN.TransformItemIsolator.activeFactor,e.y=e.y-(e.y-n)*BFN.TransformItemIsolator.activeFactor}this.checkerPanel.setDimensions(e.x,e.y),this.updateCanvasGlow()},g_.prototype.updateCanvasGlow=function(){var e=this.checkerPanel.width,t=this.checkerPanel.height;this.canvasGlow.x=this.canvasContainer.x-e/2%1,this.canvasGlow.y=this.canvasContainer.y-t/2%1,this.canvasGlow.setDimensions(e,t)},g_.prototype.updateTransformLayerVeil=function(){this.transformLayer.frameWidth=this._canvasWidth,this.transformLayer.frameHeight=this._canvasHeight,this.transformTool.frameWidth=this._canvasWidth,this.transformTool.frameHeight=this._canvasHeight;var e=this.transformLayer.frameWidth,t=this.transformLayer.frameHeight;BFN.TransformItemIsolator.active&&this.transformItemIsolatorContainer.children.includes(BFN.TransformItemIsolator)&&(e=this.transformLayer.frameWidth-(this.transformLayer.frameWidth-BFN.TransformItemIsolator.itemWidth)*BFN.TransformItemIsolator.activeFactor,t=this.transformLayer.frameHeight-(this.transformLayer.frameHeight-BFN.TransformItemIsolator.itemHeight)*BFN.TransformItemIsolator.activeFactor),this.moveTouchSurface.scale.x=e/100,this.moveTouchSurface.scale.y=t/100,this.drawTransformLayerVeil(e,t)},g_.prototype.updateTransformLayerVeilOuterDimensions=function(){this.transformLayerVeil.setOuterDimensions(BFN.StageModel.stageW+20,BFN.StageModel.stageH+2)},g_.prototype.drawTransformLayerVeil=function(e,t){e=Math.round(e),t=Math.round(t),this.transformLayerVeil.setInnerDimensions(e,t)},g_.prototype.getFlattenedImage=function(){var e=PIXI.RenderTexture.create(this._canvasWidth,this._canvasHeight);return-1!=BFN.DesignerCanvasBackground.color?e.fillColor(parseInt("0x".concat(BFN.DesignerCanvasBackground.color))):e.clear(),this.transformLayer.itemsExist&&(this.transformLayerContainer.removeChild(this.transformLayer),this.transformLayer.toggleFlattenDisplayMode(!0),BFN.Stage.render(this.transformLayer,e,!1),this.transformLayer.toggleFlattenDisplayMode(!1),this.transformLayerContainer.addChild(this.transformLayer)),BFN.MainUI.requestRender(),e},g_.prototype.getResizedImage=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n){!BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_DESIGNER&&n(null);var i=(t=Math.max(BFN.minImageSize,Math.min(BFN.maxImageSize,t)))/Math.max(this._canvasWidth,this._canvasHeight),r=Math.round(i*this._canvasWidth),a=Math.round(i*this._canvasHeight);UIHistory.addEventListener(UIHistoryEvents.HISTORY_ITEMS_UPDATED.type,function t(i){UIHistory.removeEventListener(UIHistoryEvents.HISTORY_ITEMS_UPDATED.type,t),requestAnimationFrame(function(){var t=e.getFlattenedImage();BFN.UndoManager.undo(),BFN.TransformStateModel.purgeLaterTransitions(),n(t)})}),UITools.setToolValue("collage_customize","smart_resize",!0),UITools.setToolValue("collage_customize","width",r),UITools.setToolValue("collage_customize","height",a),UITools.applyTool("collage_customize")}},g_.prototype.handleStageDimensionsUpdated=function(){this.updatePosition()},g_.prototype.handleCanvasScaleUpdated=function(){this.updateScale()},g_.prototype.handleFitDesignerToFrame=function(){this.fitDesignerToFrame()},g_.prototype.handleFitDesignerToFrameAnimated=function(){this.fitDesignerToFrame(!0)},g_.prototype.handleItemAdded=function(){BFN.DesignerCanvasModel.addedItem&&(BFN.GlobalHistoryModel.updateGlobalHistoryMenuState(),this.transformLayer.addItem(BFN.DesignerCanvasModel.addedItem),BFN.DesignerCanvasModel.addedItem=null)},g_.prototype.handleClearItems=function(){this.transformLayer.destroyAllItems(),BFN.TransformStateModel.clearTransitions()},g_.prototype.handleDesignerSettingsUpdated=function(){if(BFN.DesignerCanvasModel.designerSettings){var e=BFN.DesignerCanvasModel.designerSettings,t=UITools.getToolVO("collage_customize");UITools.setToolValue("collage_customize","background_color",e.background_color),UITools.updateToolControls("collage_customize"),BFN.DesignerCanvasBackground.color!=t.background_color&&(BFN.DesignerCanvasBackground.color=t.background_color),e.width&&e.height&&(this._canvasWidth!==e.width||this._canvasHeight!==e.height)&&this.setSize(e.width,e.height),BFN.DesignerModel.updateProjectVO(!1)}else BeFunky.logError("No Designer Settings Available")},g_.prototype.handleTransformItemsUpdated=function(){var e=this.transformLayer.itemsExist;BFN.DesignerCanvasModel.itemsExist!=e&&(BFN.DesignerCanvasModel.itemsExist=e)},g_.prototype.handleTransformItemSelected=function(){this.transformLayer.selectedItem?(this.transformTool.selectItem(this.transformLayer.selectedItem),BFN.TransformModel.selectedTransformItem!=this.transformLayer.selectedItem&&(BFN.TransformModel.selectedTransformItem=this.transformLayer.selectedItem)):(this.transformTool.deselectItem(),BFN.TransformModel.selectedTransformItem=null)},g_.prototype.handleTransformItemDisplayUpdated=function(){this.transformTool.updateDisplay()},g_.prototype.handleHoverSurfaceOver=function(e){var t=this;setTimeout(function(){t.hoverSurfaceOver=!0,BFN.CursorScreen.cursor=t.canvasDragger.dragging?"grabbing":"grab"},0)},g_.prototype.handleHoverSurfaceOut=function(e){this.hoverSurfaceOver=!1,BFN.CursorScreen&&(BFN.CursorScreen.cursor=this.canvasDragger.dragging?"grabbing":"auto")},g_.prototype.handleMoveTouchSurfacePressed=function(e){e.stopPropagation(),this.canvasDragger.drag(this.canvasContainer)},g_.prototype.handleCanvasMouseOver=function(e){this.mouseOver=!0},g_.prototype.handleCanvasMouseOut=function(e){this.mouseOver=!1},g_.prototype.handleCanvasKeyDown=function(e){BFN.AppModel.viewState!=BFN.AppModelViewStates.VIEWING_DESIGNER||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||32!=e.keyCode||this.moveTouchSurface.visible||(BFN.PIXITicker.nudge(),document.addEventListener("keyup",this.handleCanvasSpaceKeyUpBind,!1),this.moveTouchSurface.visible=!0,BFN.MainUI.requestRender(),e.preventDefault())},g_.prototype.handleCanvasSpaceKeyUp=function(e){this.handleHoverSurfaceOut(),document.removeEventListener("keyup",this.handleCanvasSpaceKeyUpBind),this.moveTouchSurface.visible=!1,BFN.MainUI.requestRender(),BFN.PIXITicker.nudge()},g_.prototype.handleCanvasDraggerDragging=function(){this.updateCanvasContainerDisplay(),BFN.TransformModel.selectedTransformItem&&"group"===BFN.TransformModel.selectedTransformItem.type&&BFN.TransformModel.selectedTransformItem.updateGroupTransform()},g_.prototype.handleCanvasDraggerDraggingComplete=function(){BeFunky.log("DRAGGING CANVAS COMPLETED")},g_.prototype.handleFitDesignerAnimatorUpdate=function(){BFN.DesignerCanvasModel.canvasScale=(this.fitScale-this.startScale)*this.fitDesignerAnimator.animationSinFactor+this.startScale},g_.prototype.handleFitDesignerAnimatorUpdateComplete=function(){BFN.DesignerCanvasModel.canvasScaling=!1,BFN.ZoomManager.updateZoomRange()},Object.defineProperty(g_.prototype,"canvasWidth",{get:function(){return this._canvasWidth}}),Object.defineProperty(g_.prototype,"canvasHeight",{get:function(){return this._canvasHeight}}),BFN.SingletonQueue.add(function(){BFN.DesignerCanvas=new g_}),f_.prototype=Object.create(PIXI.Sprite.prototype),f_.prototype.init=function(){BeFunky.log("Designer Init"),this.initDefaultValues(),this.initCanvas()},f_.prototype.initDefaultValues=function(){BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this))},f_.prototype.initCanvas=function(){this.addChild(BFN.DesignerCanvas)},f_.prototype.handleAppReady=function(){BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIPressed.bind(this))},f_.prototype.handleMainUIPressed=function(e){if(BFN.AppModel.viewState==BFN.AppModelViewStates.VIEWING_DESIGNER&&!BFN.ColorPickerPanel.colorButton&&!BeFunky.isLoadScreenActive()&&BFN.TransformModel.selectedTransformItem){var t=e.data.canvasPressed,n=e.data.originalEvent,i=!(t&&(n.ctrlKey||n.metaKey||n.altKey));BFN.DesignerCanvas.transformLayer.deselectItem(i,n.shiftKey)}},BFN.SingletonQueue.add(function(){BFN.Designer=new f_}),BFN.MainUIEvents={MOUSE_OVER:new Event("MOUSE_OVER"),MOUSE_OUT:new Event("MOUSE_OUT"),MOUSE_DOWN:new Event("MOUSE_DOWN"),MOUSE_WHEEL:new Event("MOUSE_WHEEL"),PRE_RENDER:new Event("PRE_RENDER"),POST_PRE_RENDER:new Event("POST_PRE_RENDER"),RENDERED:new Event("RENDERED")},v_.prototype=window.azrc.extend(Object.create(PIXI.Container.prototype),Object.create(BFN.EventDispatcher.prototype)),v_.prototype.init=function(){BeFunky.log("MainUI Init"),this.initDefaultValues(),this.initPhotoEditor(),this.initCollageMaker(),this.initDesigner(),this.initBrushCircle(),this.initEyeDropper(),this.initTransformGuides(),this.initHiResTextViewport(),this.initMainUIMask()},v_.prototype.initDefaultValues=function(){var e=this;this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,1e3,1e3),this.renderRequested=!0,this.rendering=!0,this.renderTime=0,this.renderAvailable=!1,this._viewportUpdating=!1,this.animationFrameRequested=!1,this._tooltip=null,this.idleRenderFunctions=[],BFN.AppModel.addEventListener(BFN.AppModelEvents.APP_READY.type,this.handleAppReady.bind(this)),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleViewStateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),document.addEventListener(BeFunky.pointerdown,function(t){t.target instanceof HTMLCanvasElement||t.target&&t.target.preventItemDeselect||BeFunky.isModalOpen()||BeFunky.isLoadScreenActive()||(BFN.MainUIEvents.MOUSE_DOWN.data={canvasPressed:!1,originalEvent:t},e.dispatchEvent(BFN.MainUIEvents.MOUSE_DOWN))}),this.on("pointerdown",function(t){var n=t.data.originalEvent;try{if(2===n.button)e.showMainUIContextMenu(t.target,n.pageX,n.pageY);else{var i=t.target;BFN.LongPressManager.initiateLongPress(function(t){BFN.TransformItemGroup.documentMouseMoved=!0,e.showMainUIContextMenu(i,t.pageX,t.pageY)})}}catch(e){}BFN.MainUIEvents.MOUSE_DOWN.data={canvasPressed:!0,originalEvent:n},e.dispatchEvent(BFN.MainUIEvents.MOUSE_DOWN)}),this.on(BeFunky.pointerover,function(t){e.dispatchEvent(BFN.MainUIEvents.MOUSE_OVER)}),this.on(BeFunky.pointerout,function(t){e.dispatchEvent(BFN.MainUIEvents.MOUSE_OUT)}),BFN.StageModel.appStage.addEventListener("wheel",function(t){t.altKey&&(BFN.MainUIEvents.MOUSE_WHEEL.deltaY=t.deltaY,e.dispatchEvent(BFN.MainUIEvents.MOUSE_WHEEL),t.preventDefault())}),this.pointerEvent=null,BFN.Stage.plugins.interaction.on("pointerdown",function(t){e.pointerEvent=t}),BFN.Stage.plugins.interaction.on("pointermove",function(t){e.pointerEvent=t}),BFN.Stage.plugins.interaction.on("pointerup",function(t){e.pointerEvent=t})},v_.prototype.showMainUIContextMenu=function(e,t,n){var i=null;e!==BFN.PhotoEditorCanvas&&e!==BFN.PhotoEditorCanvasImage||BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS?e===BFN.CollageMakerCanvas?i=BFN.CollageMakerCanvasModel.contextMenu:e===BFN.DesignerCanvas&&(i=BFN.DesignerCanvasModel.contextMenu):i=BFN.PhotoEditorCanvasModel.contextMenu,i&&(i.toggleButton("undo",BFN.UndoManager.undoExists),i.toggleButton("redo",BFN.UndoManager.redoExists),i.toggleButton("reset",!!BFN.GlobalHistoryModel.globalHistoryVOs.length),i.toggleButton("save_to_image_manager",!!BFN.GlobalHistoryModel.globalHistoryVOs.length),i.show(t,n))},v_.prototype.initPhotoEditor=function(){this.photoEditor=BFN.PhotoEditor,this.photoEditor.visible=!1,this.addChild(this.photoEditor)},v_.prototype.initCollageMaker=function(){this.collageMaker=BFN.CollageMaker,this.collageMaker.visible=!1,this.addChild(this.collageMaker)},v_.prototype.initDesigner=function(){this.designer=BFN.Designer,this.designer.visible=!1,this.addChild(this.designer)},v_.prototype.initBrushCircle=function(){this.addChild(BFN.BrushCircle),this.addChild(BFN.BrushCirclePreview)},v_.prototype.initEyeDropper=function(){this.eyeDropperContainer=new PIXI.Container,this.addChild(this.eyeDropperContainer)},v_.prototype.initTransformGuides=function(){this.transformGuides=BFN.TransformGuides,this.addChild(this.transformGuides)},v_.prototype.initHiResTextViewport=function(){BFN.HiResTextManager.showHiResTextHelpers&&this.addChild(BFN.HiResTextManager.hiResTextViewport)},v_.prototype.initMainUIMask=function(){this.mainUIMask=new PIXI.Graphics,this.addChild(this.mainUIMask)},v_.prototype.requestRender=function(){BFN.MainUI.renderRequested=!0},v_.prototype.addIdleRenderFunction=function(e){if("function"!=typeof e)return BeFunky.logError("Non-function passed to addIdleRenderFunction",e);BFN.MainUI.idleRenderFunctions.push(e)},v_.prototype.updateAppView=function(){this.photoEditor.visible=BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_PHOTO_EDITOR,this.collageMaker.visible=BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_COLLAGE_MAKER,this.designer.visible=BFN.AppModel.viewState===BFN.AppModelViewStates.VIEWING_DESIGNER,BFN.MainUI.requestRender()},v_.prototype.updateDimensions=function(){this.hitArea.width=BFN.StageModel.stageW,this.hitArea.height=BFN.StageModel.stageH,this.mainUIMask.clear(),this.mainUIMask.beginFill(16777215,1),this.mainUIMask.drawRect(0,0,BFN.StageModel.stageW,BFN.StageModel.stageH),this.mainUIMask.endFill(),this.mask=this.mainUIMask,BFN.MainUI.requestRender()},v_.prototype.animate=function(e){if(BFN.MainUI.viewportUpdating&&BFN.StageModel.updateStageDimensions(),e>=BFN.MainUI.renderTime-1&&(BFN.MainUI.renderTime=e+BFN.frameInterval,BFN.MainUI.renderAvailable=!0),BFN.MainUI.renderRequested&&BFN.MainUI.renderAvailable&&!BFN.MainUI.animationFrameRequested&&(BFN.MainUI.animationFrameRequested=!0,BFN.MainUI.renderRequested=!1,BFN.MainUI.renderAvailable=!1,BFN.MainUI.animationFrameRequested=!1,BFN.MainUI.rendering&&(BFN.MainUI.dispatchEvent(BFN.MainUIEvents.PRE_RENDER),BFN.MainUI.dispatchEvent(BFN.MainUIEvents.POST_PRE_RENDER),BFN.MainUI.renderCanvas(),BFN.MainUI.dispatchEvent(BFN.MainUIEvents.RENDERED))),BFN.MainUI.idleRenderFunctions.length&&!BFN.MainUI.renderRequested&&!BFN.MainUI.animationFrameRequested&&BFN.MainUI.renderAvailable){var t=BFN.MainUI.idleRenderFunctions.shift();requestIdleCallback(t)}requestAnimationFrame(BFN.MainUI.animate)},v_.prototype.renderCanvas=function(){BFN.Stage.render(BFN.MainUI)},v_.prototype.getFlattenedImage=function(){var e=PIXI.RenderTexture.create(BFN.StageModel.stageW,BFN.StageModel.stageH);e.fillColor(mn().hex);var t=new PIXI.Point(BFN.MainUI.x,BFN.MainUI.y);return BFN.MainUI.x=BFN.MainUI.y=0,BFN.Stage.render(BFN.MainUI,e,!1),BFN.MainUI.x=t.x,BFN.MainUI.y=t.y,e},v_.prototype.handleAppReady=function(){this.updateAppView()},v_.prototype.handleViewStateUpdated=function(){this.updateAppView()},v_.prototype.handleStageDimensionsUpdated=function(){this.updateDimensions()},Object.defineProperty(v_.prototype,"viewportUpdating",{set:function(e){this._viewportUpdating=e,this._viewportUpdating||BFN.StageModel.updateStageDimensions()},get:function(){return this._viewportUpdating}}),Object.defineProperty(v_.prototype,"tooltip",{set:function(e){this._tooltip!==e&&(this._tooltip=e,this._tooltip||BFN.TooltipScreen.hide())},get:function(){return this._tooltip}}),BFN.SingletonQueue.add(function(){BFN.MainUI=new v_,BFN.MainUI.animate()}),BFN.UI.accordionLayout=function(e,t){var n=t.sections,i=void 0===n?{}:n,r=t.maxActiveSections;return function(){var e=this,t=document.createDocumentFragment(),n=Object.keys(i);n.length?(n.forEach(function(e){var n=i[e],r=n.content,a=void 0===r?"":r,o=n.isOpen,s=void 0!==o&&o,l='\n            <button class="accordion__header button button--fullwidth">\n                <string data-lang="'.concat(e,'">').concat(BeFunky.LanguageManager.getString(e),'</string>\n                <span data-tooltip="').concat(s?"collapse":"expand",'">\n                    <svg class="icon icon--8"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#chevron-icon"></use></svg>\n                </span>\n            </button>\n            <div class="accordion__panel ').concat(s?"":"focus-avoid",'">').concat(a,"</div>\n        "),u=document.createElement("div").addClass("accordion__section");s&&u.addClass("accordion__section--open"),u.innerHTML=l,t.appendChild(u)}),this.appendChild(t),this.init=function(){this.initDefaultValues(),this.initAccordion()},this.initDefaultValues=function(){var e=this;this.sections={};var t=v(this.querySelectorAll(".accordion__section"));n.forEach(function(n,r){var a=t[r],o=v(a.children),s=o[0],l=o[1],u=s.querySelector("span"),c=i[n].isOpen||!1;e.sections[n]={container:a,header:s,panel:l,arrowButton:u,isOpen:c}}),this._activeSections=n.filter(function(t){return e.sections[t].isOpen}),this.headerHeight=36},this.initAccordion=function(){var e=this;Object.entries(this.sections).forEach(function(t){var n=f(t,2),i=n[0],a=n[1],o=a.header,s=a.container,l=a.isOpen;o.addEventListener("click",function(){var t=e._activeSections.indexOf(i),n=e._activeSections.slice(0);-1===t?n.unshift(i):n.splice(t,1),r&&n.length>r&&n.splice(r),e.activeSections=n}),l||s.setStyles({height:"".concat(e.headerHeight,"px")}),BeFunky.isSafari&&e.fixIconsInSafari(l,o)})},this.updateActiveSections=function(){Object.entries(e.sections).filter(function(t){var n=f(t,2),i=n[0];return n[1].isOpen!==e._activeSections.includes(i)}).forEach(function(t){var n=f(t,2)[1];return e.toggleSection(n)})},this.toggleSection=function(t){var n=t.container,i=t.panel,a=t.animationTimeout,o=t.arrowButton,s=t.header;a&&clearTimeout(a),t.isOpen=!t.isOpen,n.toggleClass("accordion__section--open",t.isOpen),i.toggleClass("focus-avoid",!t.isOpen),o.setAttribute("data-tooltip",t.isOpen?"collapse":"expand"),e.fixIconsInSafari(t.isOpen,s);var l=i.getBoundingClientRect().height+e.headerHeight,u=r?250:Math.max(100,Math.min(l,300)*(t.isOpen?1.1:.75));n.setStyles({height:"".concat(l,"px"),transition:"height ".concat(u/1e3,"s ease-in-out")}),t.isOpen?t.animationTimeout=setTimeout(function(){return n.setStyles({height:""})},u+10):requestAnimationFrame(function(){setTimeout(function(){return n.setStyles({height:"".concat(e.headerHeight,"px")})},0)})},this.fixIconsInSafari=function(e,t){t._useElement||(t._useElement=t.querySelector("use"),t._useElement.parentElement.style.transform="none"),t._useElement.setAttribute("xlink:href",e?"#chevron-up-icon":"#chevron-icon")},Object.defineProperty(this,"activeSections",{set:function(e){var t=this;if(Array.isArray(e)){var n=Object.keys(this.sections);e=e.filter(function(e){return!!n.includes(e)||(BeFunky.logError("Invalid accordion active section specified:",e),!1)});var i=n.filter(function(e){return t.sections[e].isOpen});e.length===i.length&&e.every(function(e){return i.includes(e)})||(this._activeSections=e,this.updateActiveSections())}else BeFunky.logError("Accordion active sections must be an array")},get:function(){return this._activeSections}}),this.init()):BeFunky.logError("No sections provided to accordionLayout() component")}.bind(e)()},BFN.UI.accountMenu=function(e){return function(){this.init=function(){this.initDefaultValues(),this.updateMenu()},this.initDefaultValues=function(){var e=this;this._accountMode="non_user",BFN.BfnService.userLoggedIn&&(this._accountMode=BFN.BfnService.userIsPlus?"plus_user":"free_user"),this.feedbackFormSetup=!1,this.getUpgradeButtonMarkup=function(){var e=BeFunky.getFreeTrialEnabled()?"start_free_trial":"upgrade";return'\n            <button id="user_account_upgrade" class="button button--blue">\n                <string data-lang='.concat(e,' style="text-transform: capitalize">').concat(BeFunky.LanguageManager.getString(e),"</string>\n            </button>\n        ").trim()},BeFunky.onFreeTrialEnabledChange(function(){return e.updateMenu()},!1),this.feedbackButtonMarkup='\n            <button id="user_account_feedback" class="button button--icon button--grey-200 button--md" data-tooltip="leave_feedback" data-tooltip-below style="padding: 5px">\n                <svg class="icon icon--20 icon-stroke"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#feedback-icon"></use></svg>\n            </button>\n        ',this.dropdownButtonGenericMarkup='\n            <svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-menu-icon"></use></svg>\n        ',this.getDropdownButtonUserMarkup=function(e,t){return'\n            <div class="navbar__user-button '.concat(t?"navbar__user-button--plus":"",'">').concat(e,'</div>\n            <svg class="icon icon--8"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#chevron-icon"></use></svg>\n        ')},this.accountPlusItem=this.querySelector(".account-plus-item"),this.dropdownList=this.querySelector(".navbar-dropdown-items")},this.updateMenu=function(){var e=this;switch(this._accountMode){case"non_user":case"free_user":BeFunky.isInDemoMode()||(this.accountPlusItem.innerHTML=this.getUpgradeButtonMarkup(),UITools.registerControl("user_account_upgrade"));break;case"plus_user":this.accountPlusItem.innerHTML=this.feedbackButtonMarkup,UITools.registerControl("user_account_feedback")}var t=document.getElementById("account_dropdown_button");switch(this._accountMode){case"non_user":t.className="navbar-dropdown-button button button--icon button--grey-200",t.innerHTML=this.dropdownButtonGenericMarkup;break;case"free_user":case"plus_user":var n=(BeFunky.User.username||"?").charAt(0).toUpperCase();t.className="navbar-dropdown-button button",t.innerHTML=this.getDropdownButtonUserMarkup(n,"plus_user"===this._accountMode),t.setAttribute("data-tooltip",BeFunky.User.email)}var i=[],r=[{id:"user_account_sign_in",name:"sign_in",accountModes:["non_user"],icon:"sign-in-icon"},{id:"user_account_sign_up",name:"register",accountModes:["non_user"],icon:"register-icon"},{id:"user_account_account",name:"my_account",type:"link",target:"_blank",href:"".concat(BeFunky.Params.siteUrl,"my-account/?cmfrm=1"),accountModes:["free_user","plus_user"],icon:"account-icon"},{id:"user_account_settings",name:"settings",accountModes:["non_user","free_user","plus_user"],icon:"gear-icon"},{id:"user_account_help_support",name:"help_support",type:"link",target:"_blank",href:"https://support.befunky.com/hc/en-us",accountModes:["non_user","free_user","plus_user"],icon:"help-icon"},{id:"user_account_logout",name:"sign_out",accountModes:["free_user","plus_user"],icon:"logout-icon"}];this.dropdownList.innerHTML=r.filter(function(t){return t.accountModes.includes(e.accountMode)}).map(function(e){return e.hasOwnProperty("type")&&"link"===e.type?'\n                    <a id="'.concat(e.id,'" class="dropdown-item button button--transparent button--has-icon button--fullwidth allow-window-event" href="').concat(e.href,'" target="').concat(e.target,'">\n                        <svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(e.icon,'"></use></svg>\n                        <string data-lang="').concat(e.name,'">').concat(BeFunky.LanguageManager.getString(e.name),"</string>\n                    </a>\n                    "):(i.push(e.id),'\n                <button id="'.concat(e.id,'" class="dropdown-item button button--transparent button--has-icon button--fullwidth">\n                    <svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(e.icon,'"></use></svg>\n                    <string data-lang="').concat(e.name,'">').concat(BeFunky.LanguageManager.getString(e.name),"</string>\n                </button>\n                "))}).join(""),i.forEach(function(e){document.getElementById(e).allowEvent=!0,UITools.registerControl(e)})},this.showFeedbackForm=function(){var e=document.getElementById("feedback_form_modal"),t=e.querySelector("textarea"),n=function(){return BeFunky.closeModal(e)};this.feedbackFormSetup||(this.feedbackFormSetup=!0,e.querySelector(".feedback__cancel").addEventListener("click",n),e.querySelector(".feedback__submit").addEventListener("click",function(e){var i=t.value.trim();if(!i)return;var r=e.currentTarget;r.disabled=!0,BeFunky.requestAPI("auth/send-feedback",{message:i},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";t.value="",n(),UIMessages.display("thank_you_befunky")}).catch(function(e){console.log("Feedback:",i),"invalid_response"===e?BeFunky.throwError("Unable to send feedback",e):BeFunky.logError("Unable to send feedback",e),UIMessages.display(BeFunky.failureReason(e))}).then(function(){r.disabled=!1})})),BeFunky.openModal(e,{size:"small",onOpen:function(){t.focus()}})},Object.defineProperty(this,"accountMode",{set:function(e){this._accountMode!==e&&(this._accountMode=e,this.updateMenu())},get:function(){return this._accountMode}}),this.init()}.bind(e)()},BFN.UI.applyCancelUpgradeButtons=function(e,t){var n=t.id;return function(){var e=this;this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this;this.upgradeMode=!1,this.cancelButton=document.getElementById("".concat(n,"_cancel")),this.applyButton=document.getElementById("".concat(n,"_apply")),this.upgradeButton=document.getElementById("".concat(n,"_upgrade")),this._alternateApply=!1,this.applyButton.addEventListener("click",this.handleClick),this.upgradeButton.addEventListener("click",this.handleClick),BeFunky.onFreeTrialEnabledChange(function(t){e.upgradeButton.setLang(t?"Start Free Trial":"upgrade")})},this.handleClick=function(t){e._upgradeMode&&(t.stopImmediatePropagation(),BFN.PhotoEditorCanvasTools.applyCurrentTool())},Object.defineProperty(this,"upgradeMode",{set:function(e){this._upgradeMode=e,this.toggleClass("button-group--must-upgrade",this._upgradeMode)},get:function(){return this._upgradeMode}}),Object.defineProperty(this,"alternateApply",{set:function(e){this._alternateApply=e},get:function(){return this._alternateApply}}),this.init()}.bind(e)()},BFN.UI.autocomplete=BeFunky.autocomplete,BFN.UI.batchProcessingIcon=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.iconClass,i=void 0===n?"":n;t.size;return function(){this.batchToolID=this.id.replace("batch_processing_",""),this.addClass("batch-processing-icon"),this.init=function(){this.selected=!1},this.updateDisplay=function(){BeFunky.isChromeOnIOS&&this.setStyles({display:"none"}),this.setStyles({color:this.selected?"var(--selected-text-color)":""});var e=this.selected?"batch-processing-selected-icon":"batch-processing-icon";this.innerHTML='<svg class="icon '.concat(i,'"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(e,'"></use></svg>');var t=this.selected?"batch_tool_remove":"batch_tool_add";this.dataset.tooltip=t},Object.defineProperty(this,"selected",{set:function(e){e=!!e,this._selected!==e&&(this._selected=e,this.updateDisplay())},get:function(){return this._selected}}),this.init()}.bind(e)()},BFN.UI.batchProcessingImageItem=function(e,t){return function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.batchImageVO=t,this.addClass("batch-item"),this.background=document.createElement("div"),this.background.addClass("batch-item__background"),this.appendChild(this.background),this.image=document.createElement("div"),this.image.addClass("batch-item__image"),this.background.appendChild(this.image),this.imageOverlay=document.createElement("div"),this.imageOverlay.addClass("batch-item__image-overlay"),this.image.appendChild(this.imageOverlay),this.imageOverlayVeil=document.createElement("div"),this.imageOverlayVeil.addClass("batch-item__image-overlay-veil"),this.imageOverlayVeil.innerHTML='<div class="loading-spinner"></div>',this.image.appendChild(this.imageOverlayVeil),this.imageOverlayLoader=this.imageOverlayVeil.querySelector(".loading-spinner"),this.cropControls=document.createElement("div"),this.cropControls.addClass("batch-item__crop-controls"),this.image.appendChild(this.cropControls),this.cropVeilT=this.addCropVeil(this.cropControls,"top"),this.cropVeilL=this.addCropVeil(this.cropControls,"left"),this.cropVeilR=this.addCropVeil(this.cropControls,"right"),this.cropVeilB=this.addCropVeil(this.cropControls,"bottom"),this.cropRegion=this.addCropRegion(this.cropControls),this.label=document.createElement("div"),this.label.addClass("batch-item__label"),this.label.textContent="".concat(t.imageW," × ").concat(t.imageH),this.appendChild(this.label),this.isNew=!0,this.setStyles({display:"none"}),this.updateImageDisplay()},this.setBatchMode=function(e){switch(this.imageOverlay.removeClass("active"),e){case"resize":this.cropControls.removeClass("active");break;case"crop":this.cropControls.addClass("active"),this.resize("none");break;default:this.cropControls.removeClass("active"),this.resize("none"),"dynamic"===e&&this.imageOverlay.addClass("active")}},this.setImageOverlayOpacity=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this.imageOverlay.setStyles({opacity:e/100})},this.setImageOverlaySRC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.hasOwnProperty("imageOverlayObjectURL")&&(URL.revokeObjectURL(this.imageOverlayObjectURL),delete this.imageOverlayObjectURL),e&&(this.imageOverlayObjectURL=e),this.imageOverlaySRC=e,this.imageOverlayFadeable=t,n||this.applyImageOverlaySRC()},this.applyImageOverlaySRC=function(){if(this.hasOwnProperty("imageOverlaySRC")&&this.hasOwnProperty("imageOverlayFadeable")){var e=this.imageOverlaySRC,t=this.imageOverlayFadeable;delete this.imageOverlaySRC,delete this.imageOverlayFadeable,this.imageOverlay.setStyles({background:e?"url(".concat(e,")"):"",backgroundSize:"100% 100%",width:"100%",height:"100%"}),e&&!t?this.image.setStyles({background:""}):this.image.setStyles({background:"url(".concat(this.batchImageVO.thumbSRC,")"),backgroundSize:"100% 100%",width:"100%",height:"100%"})}},this.setBackgroundColor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.batchImageVO.backgroundColor=e,this.updateBackgroundDisplay()},this.setImageType=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jpg";["jpg","png"].includes(e)&&(this.batchImageVO.imageType=e)},this.updateBackgroundDisplay=function(){this.background.setStyles({background:-1===this.batchImageVO.backgroundColor?"":"#".concat(this.batchImageVO.backgroundColor)})},this.updateImageDisplay=function(){var e=this,n=new Image;n.addEventListener("load",function(){var i=Math.max(t.imageW,t.imageH);e.background.setStyles({width:"".concat(t.imageW/i*100,"%"),height:"".concat(t.imageH/i*100,"%")}),e.image.setStyles({background:"url(".concat(n.src,")"),backgroundSize:"100% 100%",width:"100%",height:"100%"}),e.isNew&&(e.isNew=!1,e.setStyles({display:""}))}),n.src=t.thumbSRC},this.toggleImageOverlayVeil=function(e,t){this.imageOverlayVeil.toggleClass("active",e),this.imageOverlayLoader.toggleClass("active",e&&t)},this.resize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"none";this.resizeToolVO||(this.resizeToolVO=UITools.getToolVO("batch_resize"));var n=t.imageW,i=t.imageH,r=Math.max(t.imageW,t.imageH),a=i/n,o=n,s=i;switch(e){case"scale":var l=this.resizeToolVO.scale;o=Math.round(n*(l/100)),s=Math.round(i*(l/100));break;case"longest_side":var u=this.resizeToolVO.longest_side;o=Math.round(a>1?u/a:u),s=Math.round(a>1?u:u*a);break;case"width":var c=this.resizeToolVO.width;o=c,s=Math.round(c*a);break;case"height":var h=this.resizeToolVO.height;o=Math.round(h/a),s=h;break;case"exact_size":o=this.resizeToolVO.exact_width,s=this.resizeToolVO.exact_height}var d=Math.min(o,s),m=Math.max(o,s);d<BFN.minImageSize?(o=Math.round(a>1?BFN.minImageSize:BFN.minImageSize/a),s=Math.round(a>1?BFN.minImageSize*a:BFN.minImageSize)):m>BFN.maxImageSize&&(o=Math.round(a>1?BFN.maxImageSize/a:BFN.maxImageSize),s=Math.round(a>1?BFN.maxImageSize:BFN.maxImageSize*a));var p=this.resizeToolVO.use_padding;if("exact_size"===e)if(m=Math.max(o,s),this.background.setStyles({width:"".concat(o/m*100,"%"),height:"".concat(s/m*100,"%")}),p){var g=a/(s/o),f=g>1?100/g:100,v=g>1?100:100*g;this.image.setStyles({width:"".concat(f,"%"),height:"".concat(v,"%")})}else this.image.setStyles({width:"100%",height:"100%"});else this.background.setStyles({width:"".concat(n/r*100,"%"),height:"".concat(i/r*100,"%")}),this.image.setStyles({width:"100%",height:"100%"});var y="".concat(n," × ").concat(i);n===o&&i===s||(y+=" ".concat('<svg class="icon icon--12" style="margin: -3px 3px 0 2px;"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-icon"></use></svg>'," <strong>").concat(o," × ").concat(s,"</strong>")),this.label.innerHTML=y,this.label.setStyles({visibility:"none"===e?"hidden":"visible"}),this.batchImageVO.resizeData.width=o,this.batchImageVO.resizeData.height=s,this.batchImageVO.resizeData.padding=p},this.setCropRatio=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"landscape",i=t.imageW,r=t.imageH/i;-1===e&&(e=r>1?1/r:r),"portrait"===n&&-2!==e&&(e=1/e),-2===e&&(e=r);var a=e/r,o=a>1?100/a:100,s=a>1?100:100*a,l=50-o/2,u=50-s/2;this.cropRegion.setStyles({left:"".concat(l,"%"),top:"".concat(u,"%"),width:"".concat(o,"%"),height:"".concat(s,"%")}),this.updateCropVeil(),this.updateCropData()},this.updateCropVeil=function(){var e=parseFloat(this.cropRegion.style.left.replace("%","")),t=parseFloat(this.cropRegion.style.top.replace("%","")),n=parseFloat(this.cropRegion.style.width.replace("%","")),i=parseFloat(this.cropRegion.style.height.replace("%",""));this.cropVeilT.setStyles({bottom:"".concat(100-t,"%")}),this.cropVeilB.setStyles({top:"".concat(t+i,"%")}),this.cropVeilL.setStyles({top:"".concat(t,"%"),bottom:"".concat(100-t-i,"%"),right:"".concat(100-e,"%")}),this.cropVeilR.setStyles({top:"".concat(t,"%"),bottom:"".concat(100-t-i,"%"),left:"".concat(e+n,"%")})},this.updateCropData=function(){var e=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.left.replace("%",""))/100)),t=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.top.replace("%",""))/100)),n=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.width.replace("%",""))/100)),i=Math.max(0,Math.min(1,parseFloat(this.cropRegion.style.height.replace("%",""))/100)),r=this.batchImageVO.cropData;r.x=Math.round(e*this.batchImageVO.imageW),r.y=Math.round(t*this.batchImageVO.imageH),r.width=Math.round(n*this.batchImageVO.imageW),r.height=Math.round(i*this.batchImageVO.imageH)},this.destroy=function(){if(this.parentNode){this.parentNode.removeChild(this),this.image.setStyles({background:""}),this.imageOverlay.setStyles({background:""});try{this.batchImageVO.thumbTexture.destroyGC(!0)}catch(e){}this.batchImageVO.thumbTexture=null,this.batchImageVO.thumbSRC&&(URL.revokeObjectURL(this.batchImageVO.thumbSRC),this.batchImageVO.thumbSRC=null),this.batchImageVO=null}},this.addCropVeil=function(e,t){var n=document.createElement("div");return n.addClass("batch-item__crop-veil"),n.addClass(t),e.appendChild(n),n},this.addCropRegion=function(e){var t=this,n=document.createElement("div");n.addClass("batch-item__crop-region"),n.imageItem=this,n.container=e,n.region=n,e.appendChild(n);var i=["top","middle","bottom"];return["left","center","right"].forEach(function(r){var a=document.createElement("div");a.addClass("batch-item__crop-region-column"),n.appendChild(a),i.forEach(function(i){if("middle"!==i||"center"!==r){var o=document.createElement("div");o.addClass("batch-item__crop-region-handle"),o.addClass(i),o.addClass(r),o.handleID="".concat(i,"_").concat(r),o.handleType="middle"===i||"center"===r?"side":"corner",o.imageItem=t,o.container=e,o.region=n,a.appendChild(o)}})}),n},this.init()}.bind(e)()},BFN.UI.batchProcessingModal=function(e){return function(){var e=this;this.init=function(){this.initDefaultValues(),this.initSaveModal()},this.initDefaultValues=function(){this.scrollContainerHeight=0,this.imagesPerRow=0,this.imageItemSize=BFN.BatchProcessingManager.itemSize,this.toolButtonData=[],this.menu=this.querySelector(".batch-processing__menu");var e=v(this.querySelectorAll(".batch-processing__menu-section"));this.menuToolsSection=e[0],this.menuControlsSection=e[1],this.selectedToolButtonList=this.querySelector(".batch-processing__tool-list"),this.selectedToolButtonList.innerHTML="",BFN.UI.sortableList(this.selectedToolButtonList),this.selectedToolButtonList.addEventListener("LIST_ORDER_UPDATED",this.handlePrimaryButtonListOrderUpdated.bind(this)),this.controlsHeader=this.querySelector(".batch-processing__controls-header"),this.controlsContainer=this.querySelector(".batch-processing__controls-container"),this.controlsCancelApplyButtons=document.getElementById("batch_processing_apply_cancel_menu"),this.batchDynamicControls=this.controlsContainer.querySelector("#batch_dynamic_controls"),this.navbar=this.querySelector(".batch-processing__navbar"),this.clearButton=document.getElementById("batch_processing_clear_images"),this.saveButton=document.getElementById("batch_processing_save_images"),this.imageItems=[],this.imagesContainer=this.querySelector(".batch-processing__images-container"),this.scrollContainer=document.getElementById("batch_processing_images_scroll_container"),BFN.UI.scrollStopDispatcher(this.scrollContainer,function(){BFN.BatchProcessingManager.processVisibleImageItems()}),this.scrollContainer.addEventListener("scroll",function(e){BeFunky.isLoadScreenActive()&&(e.stopImmediatePropagation(),e.preventDefault())},!0),this.dragDropArea=document.getElementById("batch_processing_drag_drop_area"),this.updateImageItems(),this.maxWidth=1280,this.maxHeight=800,BFN.HelpClueManager.setup("batch_processing",{side:"top",positionFactor:.89,left:"auto",right:"3.9rem",top:"2.75rem",zIndex:"1",container:this.querySelector(".popover-placeholder")})},this.initSaveModal=function(){var e=this;this.saveModal=document.getElementById("batch_processing_save");var t=v(this.saveModal.querySelectorAll(".modal__button")),n=t[0],i=t[1];n.addEventListener("click",function(){return BeFunky.closeModal(e.saveModal)}),i.addEventListener("click",function(){BeFunky.closeModal(e.saveModal),BFN.BatchProcessingManager.saveImages()})},this.open=function(){var e=this;BeFunky.openModal(this,{closeOnClickOutside:!1,onOpen:function(){BFN.AppModel.viewingEditor&&BFN.PhotoEditorCanvasModel.viewState!==BFN.PhotoEditorCanvasModelViewStates.VIEWING_CANVAS&&BFN.PhotoEditorCanvasModel.exitCurrentEditorTool(),BFN.retrievePresetThumbHelperGraphics("effect"),UITools.setToolValue("batch_processing","section",null,!1),UITools.applyToolControl("batch_processing_section"),e.showWalkthrough()},onClose:function(){UITools.setToolValue("batch_processing","section",null,!1),UITools.applyToolControl("batch_processing_section")},closeOnEscape:function(){return!UITools.getToolValue("batch_processing","section")||(UITools.setToolValue("batch_processing","section",null,!1),UITools.applyToolControl("batch_processing_section"),!1)},onWindowResize:this.updateModalSize.bind(this),size:"xxl"})},this.close=function(){BeFunky.closeModal(this)},this.showWalkthrough=function(){BFN.HelpClueManager.setup("batch_upload",{side:"top",top:"1.5rem",left:"-3.5rem",zIndex:"1",container:function(){return document.getElementById("batch_upload_placeholder")}}),BFN.HelpClueManager.setup("batch_edit",{side:"left",positionFactor:0,top:"2.5rem",left:"-1.25rem",zIndex:"1",container:function(){return document.getElementById("batch_edit_placeholder")}}),BFN.HelpClueManager.showWalkthrough(["batch_upload","batch_edit"])},this.updateToolButtons=function(e){var t,n=this;e&&(this.toolButtonData.forEach(function(t){e.includes(t)||t.button.parentNode.removeChild(t.button)}),e.forEach(function(e){n.toolButtonData.includes(e)||e.button||(e.button=n.createToolButton(e.id,e.name))}),this.toolButtonData.splice(0),(t=this.toolButtonData).push.apply(t,v(e)),this.toolButtonData.forEach(function(e){e.button.string.textContent=BeFunky.LanguageManager.getString(e.name),n.selectedToolButtonList.appendChild(e.button)}),this.selectedToolButtonList.refreshList())},this.createToolButton=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=document.createElement("div").setClass("batch-processing__tool-button-row sortable-list__item");n.dataset.batchId=e;var i=document.createElement("button").setClass("button button--grey-200 batch-processing__open-tool");t=t||e;var r=document.createElement("string").setLang(t);i.appendChild(r),n.string=r,i.addEventListener("click",function(){UITools.setToolValue("batch_processing","section",e,!1),UITools.applyTool("batch_processing")});var a=document.createElement("button").setClass("button button--grey-200 button--icon batch-processing__remove-tool");return a.innerHTML='<svg class="icon icon--10"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#cancel-icon"></use></svg>',a.addEventListener("click",function(){BFN.BatchToolManager.selectedIDs=BFN.BatchToolManager.selectedIDs.filter(function(t){return t!==e})}),n.appendChild(i),n.appendChild(a),n},this.showControls=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){this.controlsHeader.langId=n||t;var i="batch_".concat(t,"_controls");v(this.controlsContainer.querySelectorAll(".control-item-set")).forEach(function(t){var n=t.id===i;t.setStyles({display:n?"block":"none"}),n&&t.appendChild(e.controlsCancelApplyButtons)}),this.menu.addClass("slide"),this.menuToolsSection.addClass("focus-avoid"),this.menuControlsSection.removeClass("focus-avoid")}else this.menu.removeClass("slide"),this.menuToolsSection.removeClass("focus-avoid"),this.menuControlsSection.addClass("focus-avoid")},this.setDynamicControls=function(e,t){if(!e||!t)return!1;for(;this.batchDynamicControls.lastChild;)this.batchDynamicControls.removeChild(this.batchDynamicControls.lastChild);delete this.batchDynamicControls.buttonContainer;var n="batch_effect";UITools.removeToolVO(n);var i=UITools.createToolVO(n);return i.toolID=t,e.forEach(function(e){var t=e.controlID.replace("batch_effect_",""),r=e.controlParamObject,a=e.controlID,o=r.type;UITools.toolControlIDs[n].push(a),UITools.controlToolIDs[a]=n,UITools.controlParamObjects[a]=r;var s=!!r.hasOwnProperty("defaultValue")&&r.defaultValue;switch(UITools.setToolValue(n,t,s),o){case"color":case"color_item":case"color_palette":r.hasOwnProperty("intensityEnabled")&&r.intensityEnabled&&UITools.setToolValue(n,"".concat(r.name,"_intensity"),1)}i.defaultValues[t]=s}),i.updating_id=null,UITools.setupControlItems(e,this.batchDynamicControls),e.forEach(function(e){UITools.registerControl(e.controlID)}),!0},this.setResizeMode=function(e){var t="batch_resize_".concat(e,"_controls");v(this.controlsContainer.querySelectorAll(".batch-resize-control-container")).forEach(function(e){e.setStyles({display:e.id==t?"block":"none"})})},this.addBatchImage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){var t=document.createElement("div");return BFN.UI.batchProcessingImageItem(t,e),this.updateImageItemSize(t),this.imagesContainer.appendChild(t),this.toggleDragArea(!1),t}},this.updateImageItemSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&e.setStyles({width:"".concat(this.imageItemSize,"px"),height:"".concat(this.imageItemSize,"px")})},this.openSaveDialog=function(){var e=this;BeFunky.openModal(this.saveModal,{closeOnClickOutside:!1,size:"extra-small"}),BFN.WatermarkManager.activate();var t=this.getImageItems();if(t.length){var n=t[0].batchImageVO.imageBlob;BFN.TextureUtils.blobOrBase64ToTexture(n,function(t){var n=t.texture;e.saveModal.querySelector(".watermark-control").sourceTexture=n},{textureSize:BFN.maxImageSize})}},this.toggleDragArea=function(e){this.dragDropArea.toggleClass("drag-drop-area--initial",e)},this.updateImageItems=function(){var e;this.imageItems.splice(0),(e=this.imageItems).push.apply(e,v(this.imagesContainer.querySelectorAll(".batch-item"))),this.clearButton.setStyles({display:this.imageItems.length?"block":"none"}),this.saveButton.disabled=!this.imageItems.length,this.toggleDragArea(!this.imageItems.length)},this.getImageItems=function(){return v(this.imageItems)},this.getVisibleImageItems=function(){var e=this,t=[];return this.getImageItems().forEach(function(n,i){var r=Math.floor(i/e.imagesPerRow)*(e.imageItemSize+8)+16-e.scrollContainer.scrollTop,a=r+e.imageItemSize;(r>0&&r<e.scrollContainerHeight||a>0&&a<e.scrollContainerHeight)&&t.push(n)}),t},this.getTotalImageBytes=function(){var e=0;return this.getImageItems().forEach(function(t){var n=t.batchImageVO;n.imageBlob&&(e+=n.imageBlob.size)}),e},this.handleClose=function(){e.close()},this.updateModalSize=function(t){var n=t.availableWidth,i=t.availableHeight,r=n-272-48;e.scrollContainer.style.setProperty("--scrollable-content-width","".concat(r,"px")),e.imagesPerRow=Math.ceil(r/(BFN.BatchProcessingManager.itemSize+8)),e.imagesContainer.setStyles({gridTemplateColumns:"repeat(".concat(e.imagesPerRow,", 1fr)")});var a=8*(e.imagesPerRow-1);e.imageItemSize=Math.floor((r-a)/e.imagesPerRow),e.getImageItems().forEach(function(t){e.updateImageItemSize(t)});e.scrollContainerHeight=i-56-48},this.handlePrimaryButtonListOrderUpdated=function(){var t,n=e.selectedToolButtonList.listItems.map(function(e){return e.dataset.batchId});BFN.BatchToolManager._selectedIDs.splice(0),(t=BFN.BatchToolManager._selectedIDs).push.apply(t,v(n)),BFN.SettingsManager.updateSetting("batch_processing_fav",n.slice())},this.init()}.bind(e)()},BFN.UI.checkboxItem=function(e,t){var n=t.controlID,i=t.paramObject,r=i.name,a=i.description,o=i.checkboxColor;return function(){this.datasetClone=this.dataset,this.outerHTML='\n        <div class="checkbox '.concat(o?"checkbox--".concat(o):"",'">\n            <input type="checkbox" id="').concat(n,'">\n                <label class="checkbox__label" for="').concat(n,'">\n                <span class="checkbox__box checkbox__box--sm">\n                    <svg class="icon checkbox__icon icon--12">\n                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkmark-icon"></use>\n                    </svg>\n                </span>\n                <string data-lang="').concat(r,'">').concat(BeFunky.LanguageManager.getString(r),"</string>\n            </label>\n            ").concat(a?'<p class="checkbox__description" data-lang="'.concat(a,'">').concat(BeFunky.LanguageManager.getString(a),"</p>"):"","\n        </div>\n    "),this.init=function(){Object.assign(document.getElementById(n).dataset,this.datasetClone),UITools.registerCheckBoxControl(n)},this.init()}.bind(e)()},BFN.UI.collageWizardModal=function(e){return function(){var e=this;this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.imageGallery=this.querySelector("image-gallery"),this.imageGallery.rowHeight=80,this.imageGallery.currentWidth=224,this.imageGallery.gutterWidth=4,this.imageGallery.onSelectItem=this.handleImageSelection.bind(this),this.querySelector("panel-header").isPlus=!0,this.selectImagesHeader=this.querySelector(".collage-wizard__left-panel panel-header"),this.selectImagesHeader.addEventListener("SELECT",this.handleSelectAll),this.selectImagesHeader.addEventListener("DESELECT",this.handleDeselectAll),this.useImagesButton=this.querySelector(".collage-wizard__use-images"),this.useImagesButton.addEventListener("click",this.handleUseImages),this.previewBox=this.querySelector(".collage-wizard__preview-inner"),this.previewImage=this.querySelector(".collage-wizard__preview-image"),this.prevButton=this.querySelector(".collage-wizard__prev-button"),this.prevButton.addEventListener("click",this.handlePrev),this.nextButton=this.querySelector(".collage-wizard__next-button"),this.nextButton.addEventListener("click",this.handleNext),this.selectCollageButton=this.querySelector(".collage-wizard__select-collage"),this.selectCollageButton.addEventListener("click",this.handleSelectCollage),BFN.HelpClueManager.setup("collage_wizard",{side:"right",positionFactor:0,container:this.querySelector(".collage-wizard__popover-placeholder")})},this.open=function(){var e=this;BeFunky.openModal(this,{onOpen:function(){e.toggleSelectCollageButton(!1),e.populateImages(),e.updateUseImagesButton(),e.handleUseImages()},onClose:function(){e.clearImages(),e.updateUseImagesButton(),BFN.AutoCollage.reset()},onWindowResize:this.updateModalSize.bind(this)})},this.close=function(){BeFunky.closeModal(this)},this.populateImages=function(){var e=this,t=BFN.ImageLibraryManager.selectedMenuImageVOs;t.length||(t=BFN.ImageLibraryManager.sampleMenuImageVOs),t=t.map(function(e){return e.thumbWidth=e.thumbHeight=Math.min(e.thumbWidth,e.thumbHeight),e}),this.imageGallery.images=t,this.imageGallery.selectedImageIDs=t.map(function(e){return e.id}).filter(function(t){return e.isSelectedByDefault(t)})},this.clearImages=function(){this.imageGallery.images=[],this.imageGallery.selectedImageIDs=[]},this.isSelectedByDefault=function(e){return!!BFN.PhotoGrid.getGridMenuImageVOs().find(function(t){return t.id===e})},this.togglePrevButton=function(e){this.prevButton.disabled=!e},this.toggleNextButton=function(e){var t=this;this.nextButton.disabled=!e,e&&BFN.HelpClueManager.show("collage_wizard").then(function(e){if(e){t.nextButton.addEventListener("click",function e(){t.nextButton.removeEventListener("click",e),BFN.HelpClueManager.hide("collage_wizard")})}})},this.updatePreviewImage=function(e){var t=this;"string"!=typeof e&&(e=""),requestAnimationFrame(function(){var n=BFN.CollageMakerCanvasBackground.color;t.previewImage.toggleClass("collage-wizard__preview-image--is-transparent",-1===n).setStyles({backgroundColor:-1===n?"":"#".concat(n)}).src=e,t.previewBox.toggleClass("collage-wizard__preview-inner--has-image",!!e)})},this.toggleSelectCollageButton=function(e){this.selectCollageButton.disabled=!e},this.updateUseImagesButton=function(){this.useImagesButton.disabled=!this.selectedMenuImageVOs.length},this.handleImageSelection=function(e,t){var n=e.id;this.imageGallery.selectedImageIDs=t?[].concat(v(this.imageGallery.selectedImageIDs),[n]):this.imageGallery.selectedImageIDs.filter(function(e){return e!==n}),this.handleImageSelectionChange()},this.handleImageSelectionChange=BeFunky.debounce(function(){e.updateUseImagesButton(),BFN.AutoCollage.reset()},0),this.handleSelectAll=function(){requestAnimationFrame(function(){e.imageGallery.selectedImageIDs=e.imageGallery.images.map(function(e){return e.id}),e.handleImageSelectionChange()})},this.handleDeselectAll=function(){requestAnimationFrame(function(){e.imageGallery.selectedImageIDs=[],e.handleImageSelectionChange()})},this.handleUseImages=function(){var t=e.selectedMenuImageVOs;t.length&&(e.useImagesButton.disabled=!0,BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD_USEDIMAGES"),BFN.AutoCollage.generateAutoCollage(t))},this.handlePrev=function(){BFN.AutoCollage.prevLayout()},this.handleNext=function(){BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD_BROWSED"),BFN.AutoCollage.nextLayout()},this.handleSelectCollage=function(){if(!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("COLLAGE","COLLAGE_WIZARD_UPGRADE","collage_wizard"),void BFN.UserActionManager.addUpgradeAction(["Select Collage Wizard Layout"]);BFN.CollageMakerCanvasPhotoGridModel.freeform&&BFN.CollageMakerCanvasModel.itemsExist?BeFunky.confirm("confirm_template_change",{onConfirm:e.selectCurrentLayout}):e.selectCurrentLayout()},this.selectCurrentLayout=function(){BFN.AutoCollage.selectCurrentLayout(),BFN.BfnService.track("CREATE","COLLAGE","COLLAGE_WIZARD_SELECTED"),e.close()},this.updateModalSize=function(t){var n=t.availableWidth,i=t.availableHeight,r=f(BFN.TextureUtils.getScaledDimensions({width:672,height:528},{maxWidth:n-272,maxHeight:i-56-48}),2),a=r[0],o=r[1];e.setStyles({width:"".concat(a+272,"px"),height:"".concat(o+56+48,"px")})},Object.defineProperty(this,"selectedMenuImageVOs",{get:function(){var t=e.imageGallery,n=t.selectedImageIDs;return t.images.filter(function(e){var t=e.id;return n.includes(t)})}}),this.init()}.bind(e)()},BFN.UI.colorButton=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(){var e=this;this.addClass("color-button"),this.innerHTML=n?'<span class="color-button__triangle"></span>\n        <div class="color-button-border">'.concat(t?"<string></string>":"","</div>"):'<div class="color-button-border">'.concat(t?"<string></string>":"","</div>"),this.init=function(){this.initDefaultValues(),this.updateButtonDisplay(),BeFunky.isEdgeHTML&&(this.updateButtonDisplay=BeFunky.debounce(this.updateButtonDisplay.bind(this),150,!0))},this.initDefaultValues=function(){this._color=-1,this._hashColor=-1,this._isMixed=!1,this._intensity=1,this._intensityEnabled=!1,this._emptyEnabled=!0,this._resetColorEnabled=!1,this._mixedColorEnabled=!1,this._borderEnabled=!1,this._fineChangeEnabled=!1,this._pickerName=null,t&&(this.innerString=this.querySelector("string")),this.emptyButtonClasses=["button","button--has-icon","button--grey-200","empty"],this.buttonDisplayUpdatedEvent=new Event("button_display_updated")},this.updateButtonDisplay=function(){return requestAnimationFrame(function(){var i,r;(e.removeClass("color-button--mixed"),-1!==e.hashColor||e._isMixed)?((i=e.classList).remove.apply(i,v(e.emptyButtonClasses)),e.innerHTML=n?'<span class="color-button__triangle"></span>\n                <div class="color-button-border">'.concat(t?"<string></string>":"","</div>"):'<div class="color-button-border">'.concat(t?"<string></string>":"","</div>"),e._isMixed&&!e.hasClass("color-button--mixed")&&(e.appendChild(document.createElement("div").setClass("color-button--dash")),e.addClass("color-button--mixed"))):((r=e.classList).add.apply(r,v(e.emptyButtonClasses)),e.innerHTML='<svg class="icon icon--18s"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#no-color-icon"></use></svg>');e.setStyles({backgroundColor:e._isMixed?"var(--secondary-000)":-1===e.hashColor?"":"#".concat(e.hashColor)}),e.dispatchEvent(e.buttonDisplayUpdatedEvent)})},Object.defineProperty(this,"color",{set:function(e){(this._color!==e||this._isMixed)&&(this._color=e,this._hashColor=-1===e?-1:BFN.ColorUtil.hexNumberToHexString(e),"0"===this._hashColor&&(this._hashColor="000"),this._isMixed=!1,this.updateButtonDisplay())},get:function(){return this._color}}),Object.defineProperty(this,"hashColor",{set:function(e){(this._hashColor!==e||this._isMixed)&&(t&&(this.innerString.innerHTML=e),this._hashColor=e,this._color=-1===e?-1:parseInt("0x".concat(e)),this._isMixed=!1,this.updateButtonDisplay())},get:function(){return this._hashColor}}),Object.defineProperty(this,"isMixed",{set:function(e){this._isMixed!==e&&(this._isMixed=e,this.updateButtonDisplay())},get:function(){return this._isMixed}}),Object.defineProperty(this,"intensity",{set:function(e){this._intensity=e},get:function(){return this._intensity}}),Object.defineProperty(this,"intensityEnabled",{set:function(e){this._intensityEnabled=e},get:function(){return this._intensityEnabled}}),Object.defineProperty(this,"emptyEnabled",{set:function(e){this._emptyEnabled=e},get:function(){return this._emptyEnabled}}),Object.defineProperty(this,"resetColorEnabled",{set:function(e){this._resetColorEnabled=e},get:function(){return this._resetColorEnabled}}),Object.defineProperty(this,"mixedColorEnabled",{set:function(e){e&&(this.displayMixedColorButton(),this._mixedColorEnabled=e)},get:function(){return this._mixedColorEnabled}}),Object.defineProperty(this,"borderEnabled",{set:function(e){this._borderEnabled!==e&&(this._borderEnabled=e,this.addClass("color-button-picker"))},get:function(){return this._borderEnabled}}),Object.defineProperty(this,"fineChangeEnabled",{set:function(e){this._fineChangeEnabled=e},get:function(){return this._fineChangeEnabled}}),Object.defineProperty(this,"pickerName",{set:function(e){this._pickerName=e},get:function(){return this._pickerName}}),this.init()}.bind(e)()},BFN.UI.colorItem=function(e,t){var n=t.controlID,i=t.paramObject,r=i.name,a=i.colorExistsButtonID,o=void 0===a?null:a;return function(){this.outerHTML='\n            <div id="'.concat(n,'_color_container" class="color-item">\n                <label class="control-item-label" data-lang="').concat(r,'">\n                    ').concat(BeFunky.LanguageManager.getString(r),"\n                </label>\n                ").concat(o?'<span class="color-exists-button-placeholder"></span>':"",'\n                <button id="').concat(n,'"></button>\n            </div>\n        '),this.init=function(){var e=document.getElementById("".concat(n,"_color_container")),t=document.getElementById(n);if(UITools.registerColorControl(n),o){var i=document.getElementById(o);i&&(t.colorExistsButton=i,e.querySelector(".color-exists-button-placeholder").appendChild(i),r())}function r(){t.colorExistsButton&&t.colorExistsButton.setStyles({display:-1==t.color?"none":"block"})}t.addEventListener("button_display_updated",r)},this.init()}.bind(e)()},BFN.UI.colorPalette=function(e,t){var n=t.controlID,i=t.paramObject,r=i.name,a=i.defaultValue,o=i.colors,s=void 0===o?null:o,l=i.presetsOnly,u=void 0!==l&&l,c=i.useLabel,h=void 0!==c&&c,d=i.displayValues,m=void 0!==d&&d,p=i.styleOverrides,g=void 0===p?null:p;return function(){var e='\n        <label class="control-item-label" style="margin-bottom: 0.75rem;" data-lang="'.concat(r,'">\n            ').concat(BeFunky.LanguageManager.getString(r),"\n        </label>\n    ");this.setAttribute("id","".concat(n,"_color_container")),h&&this.insertAdjacentHTML("beforebegin",e),this.init=function(){var e=this;if(this.colorPresetButtons=[],s){var t=new Event("change"),i=0;s.map(function(r,o){var s=document.createElement("div").addClass("color-button-row");e.appendChild(s),0===o&&(e.colorButton=document.createElement("button"),e.colorButton.id=n,e.colorButton.hashColor=a,e.colorButton.presetButtons=e,e.colorButton.setStyles({width:"2rem",height:"2rem"}),e.colorButton.addEventListener("change",function(){return e.updateColorPresetButtons()}),u&&e.colorButton.setStyles({display:"none"}),s.appendChild(e.colorButton),UITools.registerColorControl(n)),r.map(function(r,a){var l=document.createElement("button").addClass("color-button--preset");l.id="".concat(n,"_preset_").concat(++i),BFN.UI.colorButton(l,m,!1),l.addEventListener("click",function(n){e.colorButton.hashColor=n.currentTarget.hashColor,e.colorButton.dispatchEvent(t)}),l.hashColor=r,l.emptyEnabled=-1===r,g&&(g.global&&l.setStyles(g.global),g.unique&&g.unique[o]&&g.unique[o][a]&&l.setStyles(g.unique[o][a])),e.colorPresetButtons.push(l),s.appendChild(l)})}),this.updateColorPresetButtons()}},this.updateColorPresetButtons=function(){var e=this;this.colorPresetButtons.forEach(function(t){t.toggleClass("color-button--selected",t.color===e.colorButton.color)})},this.hexToRGB=function(e){return[e>>16&255,e>>8&255,255&e]},this.init()}.bind(e)()},BFN.UI.colorGroup=function(e,t){var n=t.controlID,i=t.paramObject,r=i.name,a=(i.defaultValue,i.colorGroupData),o=void 0===a?null:a,s=i.useLabel,l=void 0!==s&&s,u=i.intensityEnabled,c=void 0!==u&&u,h=i.intensityWhileTransparent,d=void 0!==h&&h,m=i.emptyEnabled,p=void 0!==m&&m,g=i.resetColorEnabled,f=void 0===g||g,y=i.hueLocked,x=void 0!==y&&y,_=i.fineChangeEnabled,I=void 0!==_&&_,T=i.colorsPerRow,b=void 0===T?5:T,S=i.maxVisibleRows,C=void 0===S?2:S,B=i.rowMarginAdjustment,F=void 0===B?12:B;return function(){var e=new Event("change"),t=new Event("finechange"),i='\n        <label class="control-item-label" style="margin-bottom: 0.75rem;" data-lang="'.concat(r,'">\n            ').concat(BeFunky.LanguageManager.getString(r),"\n        </label>\n    ");this.setAttribute("id","".concat(n,"_color_container"));var a=31*C+(C-1)*F+2*Math.min(2,C);this.setStyles({overflowY:"auto",overflowX:"hidden",maxHeight:"".concat(a,"px")}),l&&this.insertAdjacentHTML("beforebegin",i),this.init=function(){this.colorButtons=[],this.colorButtonPool=[],this.colorButtonPlaceholders=[],this.colorButtonPlaceholderPool=[],this.colorButtonRows=[],this.colorButtonRowPool=[],this.masterColorButton=document.createElement("button"),this.masterColorButton.id=n,this.masterColorButton.setStyles({display:"none",width:"2rem",height:"2rem"}),this.masterColorButton.colorGroup=this,this.appendChild(this.masterColorButton),UITools.registerColorControl(n),this.setColorGroupData(o)},this.setColorGroupData=function(e){var t=this;if(this.resetColorGroup(),e&&e.length){e.forEach(function(e){if(e.hasOwnProperty("color")){var n=t.getColorButton();n.index=t.colorButtons.length,n.groupID=e.hasOwnProperty("id")?e.id:n.index,n.pickerName="".concat(BeFunky.LanguageManager.getString("color")," # ").concat(n.index+1),n.hashColor=e.color,n.intensity=c&&e.hasOwnProperty("intensity")?Math.max(0,Math.min(1,e.intensity)):1,t.colorButtons.push(n)}});var n=null;if(this.colorButtons.forEach(function(e){e.index%b==0&&((n=t.getColorButtonRow()).colorsNum=0,t.colorButtonRows.push(n),t.appendChild(n)),n.colorsNum++,n.appendChild(e)}),n)for(var i=n.colorsNum;i<b;i++){var r=this.getColorButtonPlaceholder();this.colorButtonPlaceholders.push(r),n.appendChild(r)}}},this.resetColorGroup=function(){var e,t,n;this.colorButtons.forEach(function(e){e.parentElement.removeChild(e)}),(e=this.colorButtonPool).push.apply(e,v(this.colorButtons)),this.colorButtons.splice(0),this.colorButtonPlaceholders.forEach(function(e){e.parentElement.removeChild(e)}),(t=this.colorButtonPlaceholderPool).push.apply(t,v(this.colorButtonPlaceholders)),this.colorButtonPlaceholders.splice(0),this.colorButtonRows.forEach(function(e){e.parentElement.removeChild(e)}),(n=this.colorButtonRowPool).push.apply(n,v(this.colorButtonRows)),this.colorButtonRows.splice(0)},this.getColorButton=function(){return this.colorButtonPool.shift()||this.createColorButton()},this.createColorButton=function(){var i=this,r=document.createElement("button");return BFN.UI.colorButton(r),r.intensityEnabled=c,r.intensityWhileTransparent=d,r.emptyEnabled=p,r.resetColorEnabled=f,r.hueLocked=x,r.borderEnabled=!0,r.fineChangeEnabled=I,r.addEventListener("click",function(e){var t=e.currentTarget,i=UITools.controlToolIDs[n],r=n.replace("".concat(i,"_"),"");UITools.setToolValue(i,"".concat(r,"_index"),t.index),UITools.setToolValue(i,"".concat(r,"_group_id"),t.groupID),BFN.ColorPickerPanel.colorButton=t}),r.addEventListener("change",function(t){var n=t.currentTarget;i.masterColorButton.hashColor=n.hashColor,c&&(i.masterColorButton.intensity=n.intensity),i.masterColorButton.dispatchEvent(e)}),I&&r.addEventListener("finechange",function(e){var n=e.currentTarget;i.masterColorButton.hashColor=n.hashColor,c&&(i.masterColorButton.intensity=n.intensity),i.masterColorButton.dispatchEvent(t)}),r},this.getColorButtonPlaceholder=function(){return this.colorButtonPlaceholderPool.shift()||this.createColorButtonPlaceholder()},this.createColorButtonPlaceholder=function(){return document.createElement("div").setStyles({width:"2rem",height:"2rem"})},this.getColorButtonRow=function(){return this.colorButtonRowPool.shift()||this.createColorButtonRow()},this.createColorButtonRow=function(){return document.createElement("div").addClass("color-button-row")},this.init()}.bind(e)()},BFN.UI.colorPickerHSV=function(e){return function(){var e=this;this.addClass("color-picker__hsv"),this.innerHTML='\n        <div class="color-picker__hsv-sv">\n            <div class="color-picker__hsv-sv-indicator">\n                <div class="color-picker__hsv-sv-indicator-display"></div>\n            </div>\n        </div>\n        <div class="color-picker__hsv-h">\n            <div class="color-picker__hsv-h-indicator">\n                <div class="color-picker__hsv-h-indicator-display"></div>\n            </div>\n        </div>\n    ',this.init=function(){this.initDefaultValues(),this.initPickerHSV(),this.updateIndicators()},this.initDefaultValues=function(){this._color=16711680,this.h=0,this.s=1,this.v=1,this.updating=!1,this.baseRect={width:0,height:0,left:0,top:0,right:0,bottom:0},this.changeEvent=new Event("change")},this.initPickerHSV=function(){var e=this;function t(e,t,n){var i=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)i.setAttribute(r,t[r]);i.classList.add("color-picker__graphic"),"[object Array]"!==Object.prototype.toString.call(n)&&(n=[n]);for(var a=0,o=n[0]&&n.length||0;a<o;a++)i.appendChild(n[a]);return i}var n={xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",oncontextmenu:"return false"},i=t("svg",n,[t("defs",{},t("linearGradient",{id:"gradient-hsv",x1:"100%",y1:"0%",x2:"0%",y2:"0%"},[t("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),t("stop",{offset:"16.7%","stop-color":"#FF00FF","stop-opacity":"1"}),t("stop",{offset:"33.3%","stop-color":"#0000FF","stop-opacity":"1"}),t("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),t("stop",{offset:"66.7%","stop-color":"#00FF00","stop-opacity":"1"}),t("stop",{offset:"83.3%","stop-color":"#FFFF00","stop-opacity":"1"}),t("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),t("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]);this.pickerH=this.querySelector(".color-picker__hsv-h"),this.pickerH.appendChild(i),this.pickerH.addEventListener(BeFunky.pointerdown,this.handlePickerHPressed),this.pickerH.addEventListener("dragstart",function(e){return e.preventDefault()}),this.pickerIndicatorH=this.querySelector(".color-picker__hsv-h-indicator"),this.pickerIndicatorDisplayH=this.querySelector(".color-picker__hsv-h-indicator-display");var r=t("svg",n,[t("defs",{},[t("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[t("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),t("stop",{offset:"100%","stop-color":"#000000","stop-opacity":"0"})]),t("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[t("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),t("stop",{offset:"100%","stop-color":"#FFFFFF","stop-opacity":"0"})])]),t("rect",{x:"-1%",y:"-1%",width:"102%",height:"102%",fill:"url(#gradient-white)"}),t("rect",{x:"-1%",y:"-1%",width:"102%",height:"102%",fill:"url(#gradient-black)"})]);this.pickerSV=this.querySelector(".color-picker__hsv-sv"),this.pickerSV.appendChild(r),this.pickerSV.addEventListener(BeFunky.pointerdown,this.handlePickerSVPressed),this.pickerSV.addEventListener("dragstart",function(e){return e.preventDefault()}),this.pickerIndicatorSV=this.querySelector(".color-picker__hsv-sv-indicator"),this.pickerIndicatorDisplaySV=this.querySelector(".color-picker__hsv-sv-indicator-display"),this.pickerIndicatorDisplaySV.addEventListener(BeFunky.pointerdown,function(t){e.handlePickerSVPressed(t),t.stopPropagation()})},this.setColor=function(e){this._color=e;var t=this.hex2hsv(e);this.h=t.h,this.s=t.s,this.v=t.v,this.updateIndicators()},this.updateColor=function(){this._color=parseInt(this.hsv2rgb({h:this.h,s:this.s,v:this.v}).hex.replace("#",""),16)},this.updateIndicators=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];cancelAnimationFrame(e.updateIndicatorsAF),e.updateIndicatorsAF=requestAnimationFrame(function(){if(t){var n=e.hsv2rgb({h:e.h,s:1,v:1}).hex;e.pickerIndicatorDisplayH.setStyles({backgroundColor:n}),e.pickerSV.setStyles({backgroundColor:n}),e.pickerIndicatorH.setStyles({transform:"translateX(".concat(Math.round(e.h/360*212),"px)")})}var i=212,r=118,a=Math.round(e.s*i),o=Math.round((1-e.v)*r);e.pickerIndicatorSV.setStyles({transform:"translateX(".concat(a,"px) translateY(").concat(o,"px)")}),e.pickerIndicatorDisplaySV.setStyles({backgroundColor:"#".concat(e.hashColor)})})},this.hsv2rgb=function(e){var t,n,i,r,a,o=e.h,s=e.s,l=e.v;o=o%360/60,t=n=i=l-(a=l*s),t+=[a,r=a*(1-Math.abs(o%2-1)),0,0,r,a][o=~~o],n+=[r,a,a,r,0,0][o],i+=[0,0,r,a,a,r][o];var u=Math.floor(255*t),c=Math.floor(255*n),h=Math.floor(255*i);return{r:u,g:c,b:h,hex:"#".concat((16777216|h|c<<8|u<<16).toString(16).slice(1))}},this.rgb2hsv=function(e){var t,n,i=e.r,r=e.g,a=e.b;return(i>1||r>1||a>1)&&(i/=255,r/=255,a/=255),{h:(0===(n=(t=Math.max(i,r,a))-Math.min(i,r,a))?null:t===i?(r-a)/n+(r<a?6:0):t===r?(a-i)/n+2:(i-r)/n+4)%6*60,s:0===n?0:n/t,v:t}},this.hex2rgb=function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}},this.hex2hsv=function(e){return this.rgb2hsv(this.hex2rgb(e))},this.handlePickerHPressed=function(t){document.addEventListener(BeFunky.pointermove,e.handlePickerHMove),document.addEventListener(BeFunky.pointerup,e.handlePickerHReleased);var n=e.pickerH.getBoundingClientRect();e.baseRect.width=0,e.baseRect.height=n.height,e.baseRect.left=n.left,e.baseRect.top=n.top,e.updating=!0,e.handlePickerHMove(t,!1)},this.handlePickerSVPressed=function(t){document.addEventListener(BeFunky.pointermove,e.handlePickerSVMove),document.addEventListener(BeFunky.pointerup,e.handlePickerSVReleased);var n=e.pickerSV.getBoundingClientRect();e.baseRect.width=n.width,e.baseRect.height=n.height,e.baseRect.left=n.left,e.baseRect.top=n.top,e.updating=!0,e.handlePickerSVMove(t,!1)},this.handlePickerHMove=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=Math.max(0,Math.min(e.offsetWidth,t.pageX-e.baseRect.left));e.h=i/e.offsetWidth*360,e.updateColor(),e.updateIndicators(),n?e.throttleDispatchChangeEvent():e.dispatchEvent(e.changeEvent)},this.handlePickerSVMove=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=Math.max(0,Math.min(e.baseRect.width,t.pageX-e.baseRect.left)),r=Math.max(0,Math.min(e.baseRect.height,t.pageY-e.baseRect.top));e.s=i/e.baseRect.width,e.v=1-r/e.baseRect.height,e.updateColor(),e.updateIndicators(!1),n?e.throttleDispatchChangeEvent():e.dispatchEvent(e.changeEvent)},this.throttleDispatchChangeEvent=BeFunky.throttle(function(){return requestAnimationFrame(function(){e.updating&&e.dispatchEvent(e.changeEvent)})},BeFunky.isEdgeHTML?66:33,!0),this.handlePickerHReleased=function(){document.removeEventListener(BeFunky.pointermove,e.handlePickerHMove),document.removeEventListener(BeFunky.pointerup,e.handlePickerHReleased),e.updating=!1,e.dispatchEvent(e.changeEvent)},this.handlePickerSVReleased=function(){document.removeEventListener(BeFunky.pointermove,e.handlePickerSVMove),document.removeEventListener(BeFunky.pointerup,e.handlePickerSVReleased),e.updating=!1,e.dispatchEvent(e.changeEvent)},Object.defineProperty(this,"color",{set:function(e){this.setColor(e)},get:function(){return this._color}}),Object.defineProperty(this,"hashColor",{get:function(){return(16777216|this._color).toString(16).slice(1)}}),Object.defineProperty(this,"hLocked",{set:function(e){e?this.pickerH.addClass("locked"):this.pickerH.removeClass("locked")},get:function(){return this.pickerH.hasClass("locked")}}),this.init()}.bind(e)()},BFN.UI.cursorScreen=function(e){return function(){var e=this;this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this.getNativeArrowCursor,t="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M22.86 14v-3L28 16l-5.14 5v-3H9.14v3L4 16l5.14-5v3h13.72z'/%3e %3cfilter id='a' width='137.7%25' height='190.5%25' x='-18.9%25' y='-45.3%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' transform='rotate(0 16 16)'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M22.36 13.5V9.82L28.72 16l-6.36 6.18V18.5H9.64v3.68L3.28 16l6.36-6.18v3.68h12.72z'/%3e %3c/g%3e %3c/svg%3e",n="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cfilter id='a' width='142.5%25' height='142.5%25' x='-21.2%25' y='-21.2%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' result='shadowMatrixOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3cfeMerge%3e %3cfeMergeNode in='shadowMatrixOuter1'/%3e %3cfeMergeNode in='SourceGraphic'/%3e %3c/feMerge%3e %3c/filter%3e %3cpath id='b' d='M14.86 20.43h1.85L13 26l-3.71-5.57h1.85v-5.57H5.57v1.85L0 13l5.57-3.71v1.85h5.57V5.57H9.3L13 0l3.71 5.57h-1.85v5.57h5.57V9.3L26 13l-5.57 3.71v-1.85h-5.57v5.57z'/%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' filter='url(%23a)' transform='translate(3 3)'%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M15.36 19.93h2.29L13 26.9l-4.65-6.97h2.3v-4.57H6.06v2.29L-.9 13l6.97-4.65v2.3h4.57V6.06H8.35L13-.9l4.65 6.97h-2.3v4.57h4.58V8.35L26.9 13l-6.97 4.65v-2.3h-4.57v4.58z'/%3e %3c/g%3e %3c/svg%3e",i="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cfilter id='a' width='147.9%25' height='138.7%25' x='-21.5%25' y='-21.2%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' result='shadowMatrixOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3cfeMerge%3e %3cfeMergeNode in='shadowMatrixOuter1'/%3e %3cfeMergeNode in='SourceGraphic'/%3e %3c/feMerge%3e %3c/filter%3e %3cpath id='b' d='M12.8 8.36a7.5 7.5 0 1 0 5.2 7.55h3a10.5 10.5 0 1 1-8.2-10.66l-3.21-3.2L11.63 0l4.77 4.77 2.05 2.04-6.82 6.81-2.04-2.04 3.22-3.22z'/%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' filter='url(%23a)' transform='translate(5 3)'%3e %3cuse fill='%231E2024' xlink:href='%23b'/%3e %3cpath stroke='white' d='M11.83 8.63a7 7 0 1 0 5.66 7.26l.03-.48h4l-.02.52a11 11 0 1 1-10.13-11.4L8.88 2.04 11.63-.7l4.77 4.77 2.75 2.75-7.52 7.52-2.75-2.75 2.95-2.95z'/%3e %3c/g%3e %3c/svg%3e",r="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M27.07 16.81l1.97-1.22-.98 7.23-6.3-2.72 1.97-1.22C22.48 15.43 19.49 13 16 13c-3.5 0-6.5 2.44-7.74 5.91l1.92 1.2-6.3 2.7-.99-7.22 2.03 1.25C6.77 12.23 11.04 9 16 9c4.95 0 9.21 3.21 11.07 7.81z'/%3e %3cfilter id='a' width='134.8%25' height='164.6%25' x='-17.4%25' y='-32.3%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.18' result='shadowSpreadOuter1'/%3e %3cfeOffset in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' transform='rotate(0 16 16)'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M27.3 16.08l2.38-1.48-1.22 8.94-7.78-3.36 2.43-1.5c-1.28-3.13-4.04-5.18-7.11-5.18-3.08 0-5.85 2.06-7.13 5.2l2.38 1.48-7.78 3.36-1.22-8.94 2.44 1.5C6.76 11.52 11.12 8.5 16 8.5c4.87 0 9.22 3 11.3 7.58z'/%3e %3c/g%3e %3c/svg%3e",a="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M17.86 23.6c-.14.33-.39.75-.67 1.31A7.05 7.05 0 0 1 6 26.69l.6-1.33 1.9 1.14c2.4 1.37 5.4.41 6.87-1.98-1.98.57-4.02-.23-4.67-1.89-.35-.9-.22-1.9.27-2.75A6.83 6.83 0 0 1 9.5 15.7c0-4.42 4.48-8 10-8s10 3.58 10 8-4.48 8-10 8c-.56 0-1.1-.04-1.64-.1zm.53-1.96c.37.04.73.06 1.11.06 4.46 0 8-2.73 8-6s-3.54-6-8-6-8 2.73-8 6c0 .98.32 1.91.89 2.74.26-.17.55-.32.86-.43 2.1-.8 4.36 0 5.05 1.76a3 3 0 0 1 .1 1.87zm-4.7-2.45c-1.44.48-2.23 1.76-1.75 2.84.47 1.08 2.03 1.57 3.47 1.08 1.44-.48 2.23-1.76 1.75-2.84-.47-1.08-2.03-1.57-3.47-1.08z'/%3e %3cfilter id='a' width='135.7%25' height='140%25' x='-17.9%25' y='-15.2%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='.9' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3cpath id='d' d='M2.5 2.5l7 2.5L6 6 4.5 9.5z'/%3e %3cfilter id='c' width='235.3%25' height='232.9%25' x='-66.4%25' y='-52.1%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.05' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd'%3e %3cg fill-rule='nonzero'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' fill-rule='evenodd' xlink:href='%23b'/%3e %3cpath stroke='white' d='M18.16 24.13a14.97 14.97 0 0 1-.53 1.01 7.55 7.55 0 0 1-11.98 1.9l-.25-.24.98-2.16.48.3c.9.55 1.53.92 1.89 1.13a4.52 4.52 0 0 0 5.45-.87c-1.76.04-3.36-.86-3.96-2.39a3.6 3.6 0 0 1 .14-2.89A7.27 7.27 0 0 1 9 15.7c0-4.72 4.72-8.5 10.5-8.5S30 10.98 30 15.7c0 4.72-4.72 8.5-10.5 8.5-.45 0-.9-.02-1.34-.07zm.82-2.94l.52.01c4.17 0 7.5-2.52 7.5-5.5s-3.33-5.5-7.5-5.5-7.5 2.52-7.5 5.5c0 .71.19 1.41.56 2.07.16-.09.34-.16.51-.23 2.34-.88 4.9.01 5.7 2.05.2.51.27 1.05.21 1.6zm-5.13-1.53c-1.19.4-1.8 1.39-1.45 2.17.36.82 1.63 1.22 2.85.8 1.19-.4 1.8-1.38 1.45-2.16-.36-.82-1.63-1.22-2.85-.8z'/%3e %3c/g%3e %3cuse fill='black' filter='url(%23c)' xlink:href='%23d'/%3e %3cuse fill='black' xlink:href='%23d'/%3e %3cpath stroke='white' d='M6.37 6.42L4.4 10.99 1.75 1.7l9.38 3.35-4.76 1.37z'/%3e %3c/g%3e %3c/svg%3e",o="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='32' height='32'%3e %3cdefs%3e %3cpath id='b' d='M17.63 22.9c-.52 1.24-1 2.25-1.44 3.01-2.07 3.57-6.35 4.8-9.75 2.86A7.01 7.01 0 0 1 5 27.7l.6-1.33 1.9 1.14c2.4 1.37 5.4.41 6.87-1.98-1.98.57-4.02-.23-4.67-1.89a3.32 3.32 0 0 1 .8-3.46v-7.71l8.45 2.33L29.5 8.9v14H17.63zm-.16-1.5H27.6v-9.5l-8.55 4.5-6.65-1.5v4.05c2.05-.7 4.22.1 4.9 1.82.08.2.14.42.17.63zm-4.78-1.21c-1.44.48-2.23 1.76-1.75 2.84.47 1.08 2.03 1.57 3.47 1.08 1.44-.48 2.23-1.76 1.75-2.84-.47-1.08-2.03-1.57-3.47-1.08z'/%3e %3cfilter id='a' width='134.3%25' height='140.4%25' x='-17.1%25' y='-15.4%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='.9' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3cpath id='d' d='M2.5 2.5l7 2.5L6 6 4.5 9.5z'/%3e %3cfilter id='c' width='235.3%25' height='232.9%25' x='-66.4%25' y='-52.1%25' filterUnits='objectBoundingBox'%3e %3cfeMorphology in='SourceAlpha' operator='dilate' radius='1.05' result='shadowSpreadOuter1'/%3e %3cfeOffset dy='1' in='shadowSpreadOuter1' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='1'/%3e %3cfeComposite in='shadowBlurOuter1' in2='SourceAlpha' operator='out' result='shadowBlurOuter1'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.117647059 0 0 0 0 0.125490196 0 0 0 0 0.141176471 0 0 0 0.5 0'/%3e %3c/filter%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd'%3e %3cuse fill='black' filter='url(%23a)' xlink:href='%23b'/%3e %3cuse fill='black' xlink:href='%23b'/%3e %3cpath stroke='white' d='M17.96 23.4a26.57 26.57 0 0 1-1.34 2.76c-2.2 3.8-6.78 5.13-10.43 3.05a7.51 7.51 0 0 1-1.54-1.17l-.25-.24.98-2.16.48.3c.9.55 1.53.92 1.89 1.13a4.52 4.52 0 0 0 5.45-.87c-1.76.04-3.36-.86-3.96-2.39a3.78 3.78 0 0 1 .76-3.83V11.8l8.89 2.46L30 8.05V23.4H17.96zm-.09-2.5h9.23v-8.17l-7.98 4.2-6.22-1.4v2.77c2.09-.42 4.16.5 4.86 2.29l.11.31zm-5.02-.24c-1.19.4-1.8 1.39-1.45 2.17.36.82 1.63 1.22 2.85.8 1.19-.4 1.8-1.38 1.45-2.16-.36-.82-1.63-1.22-2.85-.8z'/%3e %3cuse fill='black' filter='url(%23c)' xlink:href='%23d'/%3e %3cuse fill='black' xlink:href='%23d'/%3e %3cpath stroke='white' d='M6.37 6.42L4.4 10.99 1.75 1.7l9.38 3.35-4.76 1.37z'/%3e %3c/g%3e %3c/svg%3e";this.cursors={auto:{native:"auto"},arrow:{get native(){return e()},svg:t,svgIsRotated:!0},move:{native:"move",svg:n},rotate:{cur:"".concat(BFN.imagesURL,"cursors/rotate-fallback.cur"),svg:BeFunky.isSafari?i:r,svgIsRotated:!BeFunky.isSafari},select_cross:{native:"crosshair"},select_poly:{cur:"".concat(BFN.imagesURL,"cursors/select-polygon.cur"),svg:o,svgOffset:"0 0"},select_lasso:{cur:"".concat(BFN.imagesURL,"cursors/select-lasso.cur"),svg:a,svgOffset:"0 0"},grab:{native:BeFunky.isChromium||BeFunky.isSafari?"-webkit-grab":"grab"},grabbing:{native:BeFunky.isChromium||BeFunky.isSafari?"-webkit-grabbing":"grabbing"},none:{native:"none"}},this.validCursors=Object.keys(this.cursors),this.cursor=this._cursor=this.defaultNativeCursor="auto",this.cursorRotation=this._cursorRotation=0,this.cursorLock=this._cursorLock=!1,this.lockedCursor=void 0,this.prevCursorStyle=""},this.updateCursor=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];clearTimeout(e.updateCursorST),cancelAnimationFrame(e.updateCursorAF);var n=function(){e.updateCursorAF=requestAnimationFrame(function(){var t=e.getCursorStyle();t!==e.prevCursorStyle&&(e.prevCursorStyle=t,e.setStyles(t))})};t?n():e.updateCursorST=setTimeout(n,0)},this.getCursorStyle=function(){var t=e.cursors[e.lockedCursor||e._cursor],n=[];if(t.svg&&!BeFunky.isEdgeHTML){var i='url("'.concat(t.svg,'") ').concat(t.svgOffset||"16 16");t.svgIsRotated&&0!==e._cursorRotation&&(i=i.replace("rotate(0 ","rotate(".concat(e._cursorRotation," "))),n.push(i)}return t.cur&&n.push('url("'.concat(t.cur,'")')),n.push(t.native||e.defaultNativeCursor),{cursor:n.join(", ")}},this.getNativeArrowCursor=function(){var t=45*(e._cursorRotation%45>=22.5?Math.ceil:Math.floor)(e._cursorRotation/45);return{0:"ew-resize",45:"nwse-resize",90:"ns-resize",135:"nesw-resize"}[t%=180]},Object.defineProperty(this,"cursor",{set:function(e){e&&this.validCursors.includes(e)||(e=this.defaultNativeCursor),e!==this._cursor&&(this._cursor=e,this._cursorLock||this.updateCursor())},get:function(){return this._cursor}}),Object.defineProperty(this,"cursorRotation",{set:function(e){"number"!=typeof e&&(e=0),(e=180*e/Math.PI)<0&&(e-=360*Math.floor(e/360)),(e=Math.round(e))!==this._cursorRotation&&(this._cursorRotation=e,this._cursorLock?this.cursors[this.lockedCursor].svgIsRotated&&this.updateCursor(!0):this.cursors[this._cursor].svgIsRotated&&this.updateCursor(!0))},get:function(){return this._cursorRotation}}),Object.defineProperty(this,"cursorLock",{set:function(e){(e=!!e)!==this._cursorLock&&(this._cursorLock=e,this._cursorLock?this.lockedCursor=this._cursor:(this.lockedCursor=void 0,this.updateCursor()))},get:function(){return this._cursorLock}}),this.init()}.bind(e)()},BFN.UI.cutoutOptionsModal=function(e){return function(){var e=this,t=function(){e.fullTexture=null,e.trimTexture=null,e.previewFullSRC="",e.previewTrimSRC="",e._trimTransparency=!1,e.previewImage=document.getElementById("cutout_options_image")};this.open=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&t.baseTexture&&n&&n.baseTexture){this.fullTexture=t,this.trimTexture=n;var i=f(BFN.TextureUtils.getScaledDimensions(this.fullTexture,{maxWidth:544,maxHeight:384}),2),r=i[0],a=i[1],o=f(BFN.TextureUtils.getScaledDimensions(this.trimTexture,{maxWidth:544,maxHeight:384}),2),s=o[0],l=o[1],u=BFN.Util.resizeTexture(this.fullTexture,4*r,4*a),c=BFN.Util.resizeTexture(this.trimTexture,4*s,4*l),h=BFN.Util.getThumbTexture(u,Math.max(r,a)),d=BFN.Util.getThumbTexture(c,Math.max(s,l));h.renderClone().destroyGC(!0),d.renderClone().destroyGC(!0),u.destroyGC(!0),c.destroyGC(!0);var m=BFN.Util.isTransparent(h),p=BFN.Util.isTransparent(d);this.previewFullSRC=BFN.TextureUtils.textureToBase64(h,{isTransparent:m}),this.previewTrimSRC=BFN.TextureUtils.textureToBase64(d,{isTransparent:p}),this.previewHeight=h.height,this.previewWidth=h.width,this.previewTrimHeight=d.height,this.previewTrimWidth=d.width,h.destroyGC(!0),d.destroyGC(!0),BeFunky.openModal(this,{onOpen:function(){e.updatePreview()},onClose:function(){e.clearPreview(),e.clearTextures()},size:[944,480],onWindowResize:this.updateImageSize.bind(this)})}},this.close=function(){BeFunky.closeModal(this,!1)},this.updatePreview=function(){this.previewImage.src=this._trimTransparency?this.previewTrimSRC:this.previewFullSRC;var e="".concat(this.previewHeight/this.previewWidth*100,"%"),t=this.previewImage.parentElement;if(this._trimTransparency){var n,i=this.previewTrimWidth/this.maxPreviewImageWidth,r=this.previewTrimHeight/this.maxPreviewImageHeight;n=i>r?this.maxPreviewImageWidth:Math.floor(this.maxPreviewImageWidth*i/r),t.parentElement.setStyles({width:"".concat(n,"px")}),e="".concat(this.previewTrimHeight/this.previewTrimWidth*100,"%")}else this.updateImageSize({availableWidth:this.clientWidth,availableHeight:this.clientHeight});t.setStyles({paddingBottom:e})},this.clearPreview=function(){this.previewFullSRC="",this.previewTrimSRC="",this.previewImage.src=""},this.clearTextures=function(){try{this.fullTexture.destroyGC(!0)}catch(e){}try{this.trimTexture.destroyGC(!0)}catch(e){}this.fullTexture=null,this.trimTexture=null},this.updateImageSize=function(t){var n=t.availableWidth,i=t.availableHeight;if(!e._trimTransparency){var r=n-320;e.maxPreviewImageWidth=r-48,e.maxPreviewImageHeight=i-48;var a,o=e.previewWidth/e.previewHeight,s=e.maxPreviewImageWidth/e.maxPreviewImageHeight;o>=s&&(a=100),a=100*o/s,e.previewImage.parentElement.parentElement.setStyles({width:"".concat(a,"%")})}},Object.defineProperty(this,"trimTransparency",{set:function(e){this._trimTransparency=e,this.updatePreview()},get:function(){return this._trimTransparency}}),t()}.bind(e)()},BFN.UI.dragScreen=function(e){return function(){var e=this;this.addClass("drag-screen"),this.innerHTML="<img><div></div>",this.init=function(){var e=this;this.active=!1,this.image=this.querySelector("img"),this.image.addClass("drag-screen__image"),this.nodeContainer=this.querySelector("div"),this.nodeContainer.setStyles({position:"absolute",left:"0",top:"0"}),this.image.onload=function(){e.active&&e.addClass("drag-screen--active")},this.updatePositionThrottled=BeFunky.throttleRAF(this.updatePosition.bind(this))},this.show=function(e){if(!this.active&&e){this.active=!0,BFN.smoothPictureDisabled=!0,document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUp,!0);var t=this.image.src;this.image.src=e,this.nodeContainer.innerHTML="",this.image.setStyles({width:BeFunky.isFirefox&&e.startsWith("data:image/svg+xml,")?"100px":""}),this.image.src===t&&this.addClass("drag-screen--active")}},this.showNode=function(e){!this.active&&e&&(this.active=!0,document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUp,!0),this.image.src="",this.image.setStyles({visibility:"hidden"}),this.nodeContainer.appendChild(e),this.addClass("drag-screen--active"))},this.hide=function(){this.nodeContainer.innerHTML="",this.image.setStyles({visibility:""}),this.active&&(this.active=!1,BFN.smoothPictureDisabled=!1,document.removeEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUp,!0),this.removeClass("drag-screen--active"))},this.updatePosition=function(){var e=BeFunky.globalPointerCoords,t=e.x,n=e.y;this.setStyles({transform:"translate(".concat(Math.round(t),"px, ").concat(Math.round(n),"px)")})},this.handlePointerMove=function(){e.updatePositionThrottled()},this.handlePointerUp=function(){e.hide()},this.init()}.bind(e)()},BFN.UI.draggableElement=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.fireMoveEvents,r=void 0!==i&&i,a=n.eventDispatcher;return function(){var e=this;this.init=function(){this.dragging=!1,this.oncontextmenu=function(){return!1},this.setStyles({touchAction:"none"}),this.addEventListener(BeFunky.pointerdown,this.handlePointerDown),this.eventDispatcher=a||this,this.debug="init"},this.handlePointerDown=function(n){if(e.debug="handlePointerDown",0===n.button){e.debug="handlePointerDown2",e.lastX=e.startX=n.pageX,e.lastY=e.startY=n.pageY,e.startScrollTop=t.scrollTop,e.lastScrollTime=Date.now(),e.scrollSpeed=0;var i=e.getBoundingClientRect();e.centerX=i.left+i.width/2,e.centerY=i.top+i.height/2,e.width=i.width,document.addEventListener(BeFunky.pointermove,e.handlePointerMove),document.addEventListener(BeFunky.pointerup,e.handlePointerUp)}},this.handlePointerMove=function(n){if(e.dragging){if(r){var i="touch"===n.pointerType?document.elementFromPoint(n.pageX,n.pageY):n.target;return void e.eventDispatcher.dispatchEvent(new CustomEvent("dragmoved",{detail:{dragTarget:i}}))}throw console.log("Dragged item:",e.debug,e.className,e),new Error("pointermove should not be fired while dragging")}e.debug="handlePointerMove";var a=n.pageX-e.lastX,o=n.pageY-e.lastY,s=Math.sqrt(Math.pow(a,2)+Math.pow(o,2)),l=Math.abs(o)/s,u=function(){var i=1.75*e.width,r=t.scrollTop,a=n.pageX-e.centerX,o=n.pageY-e.centerY+r-e.startScrollTop,s=Math.sqrt(Math.pow(a,2)+Math.pow(o,2)),l=n.pageX-e.startX,u=n.pageY-e.startY+r-e.startScrollTop,c=Math.sqrt(Math.pow(l,2)+Math.pow(u,2));return!(s<5||c<5)&&(!(s>i)&&!(a>0&&n.pageX<e.lastX||a<0&&n.pageX>e.lastX))},c=function(){e.dragging=!0,e.eventDispatcher.dispatchEvent(new CustomEvent("dragstarted",{detail:{draggedElement:e}})),r||document.removeEventListener(BeFunky.pointermove,e.handlePointerMove),e.debug="startDrag"};if("mousemove"===n.type||"mouse"===n.pointerType){if(u())return c()}else{if(l<.5&&e.scrollSpeed<.5&&u())return c();var h=t.scrollTop,d=e.startScrollTop-(n.pageY-e.startY)-h;t.scrollTop+=d;var m=t.scrollTop!==h,p=Date.now();e.scrollSpeed=m?Math.abs(d)/(p-e.lastScrollTime):0,e.lastScrollTime=p}e.lastX=n.pageX,e.lastY=n.pageY},this.handlePointerUp=function(t){if(e.debug="handlePointerUp",document.removeEventListener(BeFunky.pointermove,e.handlePointerMove),document.removeEventListener(BeFunky.pointerup,e.handlePointerUp),e.dragging){e.dragging=!1;var n="touch"===t.pointerType?document.elementFromPoint(t.pageX,t.pageY):t.target,i=n===BFN.Stage.view?BFN.getCanvasCoordinates(t.pageX,t.pageY):void 0;e.eventDispatcher.dispatchEvent(new CustomEvent("dragstopped",{detail:{dropTarget:n,canvasCoordinates:i}}))}},this.cancelDragging=function(){e.debug="cancelDragging",document.removeEventListener(BeFunky.pointermove,e.handlePointerMove),document.removeEventListener(BeFunky.pointerup,e.handlePointerUp),e.dragging&&(e.dragging=!1,e.eventDispatcher.dispatchEvent(new CustomEvent("dragstopped",{detail:{}}))),BFN.DragScreen.hide()},this.init()}.bind(e)()},BFN.UI.draggablePanel=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){var e=this;this.init=function(){this.initDefaultValues(),BFN.addFloatingElement(this)},this.initDefaultValues=function(){var e=this;this.addClass("draggable-panel"),this.addClass("focus-avoid"),setTimeout(function(){e.addClass("animated")},100),this.panelHeader=t||this.querySelector("panel-header"),this.panelHeader.addEventListener(BeFunky.pointerdown,this.handleTopBarPress),this.addEventListener(BeFunky.pointerdown,this.handlePanelPress,!0),this.cursorStartPoint={},this.topBarStartPoint={},this.deltaPoint={},this._panelSize=null,this.addEventListener(BeFunky.pointerdown,function(t){return e.handleDraggablePanelClick(t)}),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this))},this.show=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.addClass("active"),this.removeClass("focus-avoid"),null!==e&null!==t&&this.setPosition(e,t),BFN.focusFloatingElement(this)},this.hide=function(){var e=this;this.removeClass("active"),this.addClass("focus-avoid"),setTimeout(function(){e.hasClass("active")||e.setStyles({zIndex:-1})},300)},this.setPosition=function(e,t){var n=Math.max(0,Math.min(BFN.appRect.width-this.panelSize.width,e)),i=Math.max(0,Math.min(BFN.appRect.height-this.panelSize.height,t));this.setStyles({left:"".concat(Math.round(n),"px"),top:"".concat(Math.round(i),"px")})},this.handleTopBarPress=function(t){document.addEventListener(BeFunky.pointerup,e.handleTopBarRelease),document.addEventListener(BeFunky.pointermove,e.handleTopBarDrag),e.cursorStartPoint.x=t.pageX,e.cursorStartPoint.y=t.pageY;var n=function(t){return getComputedStyle(e).getPropertyValue(t)};e.topBarStartPoint.x=parseInt(n("left").replace("px","")),e.topBarStartPoint.y=parseInt(n("top").replace("px",""))},this.handleTopBarRelease=function(){document.removeEventListener(BeFunky.pointerup,e.handleTopBarRelease),document.removeEventListener(BeFunky.pointermove,e.handleTopBarDrag)},this.handleTopBarDrag=function(t){e.deltaPoint.x=t.pageX-e.cursorStartPoint.x,e.deltaPoint.y=t.pageY-e.cursorStartPoint.y,e.setPosition(e.topBarStartPoint.x+e.deltaPoint.x,e.topBarStartPoint.y+e.deltaPoint.y),n&&e.panelHeader.dispatchEvent(new CustomEvent("drag",{bubbles:!1}))},this.handlePanelPress=function(t){BFN.focusFloatingElement(e),e.hasClass("disabled")&&e.handleTopBarPress(t)},this.handleDraggablePanelClick=function(e){e.stopPropagation(),e.currentTarget!==BFN.ColorPickerPanel&&BFN.ColorPickerPanel.colorButton&&(BFN.ColorPickerPanel.colorButton=null)},this.handleStageDimensionsUpdated=function(e){if(this._panelSize){var t=parseInt(this.style.left.replace("px","")),n=parseInt(this.style.top.replace("px",""));this.setPosition(t,n)}},Object.defineProperty(this,"panelSize",{get:function(){return this._panelSize&&this._panelSize.width||(this._panelSize=this.getBoundingClientRect()),{width:this._panelSize.width,height:this._panelSize.height}}}),this.init()}.bind(e)()},BFN.UI.favoriteStar=function(e){return function(){this.presetID=this.id.replace("favorite_","");var e=BFN.effectPresetMap[this.presetID]||BFN.artsyPresetMap[this.presetID];this.favoriteID=e?this.presetID.replace("".concat(e,"_"),""):null,this.setClass("favorite-star button button--sm button--icon button--transparent"),this.init=function(){this.selectedMarkup='<svg class="icon icon--18"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#favorite-star-fill-icon"></use></svg>',this.deselectedMarkup='<svg class="icon icon--18"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#favorite-star-empty-icon"></use></svg>',this.selected=!1},this.updateDisplay=function(){this.toggleClass("favorite-star--selected",this._selected),this.innerHTML=this._selected?this.selectedMarkup:this.deselectedMarkup,this.dataset.tooltip=this._selected?"remove_from_favorites":"add_to_favorites"},Object.defineProperty(this,"selected",{set:function(e){e=!!e,this._selected!==e&&(this._selected=e,this.updateDisplay())},get:function(){return this._selected}}),this.init()}.bind(e)()},BFN.UI.graphicManager=function(e){return function(){var e=this;this.init=function(){this.initDefaultValues(),this.initAccordion(),this.initShapes()},this.initDefaultValues=function(){this.items={}},this.initAccordion=function(){this.accordion=document.querySelector(".graphic-manager__accordion"),BFN.UI.accordionLayout(this.accordion,{sections:{basic_shapes:{isOpen:!0,content:'<p class="graphic-manager__shapes"></p>'},your_graphics:{isOpen:!0,content:'\n                    <div class="graphic-manager__graphics"></div>\n                    <div class="graphic-manager__empty-message">\n                        <img class="graphic-manager__empty-state-image" src="'.concat(BFN.imagesURL,'app/illustrations/no-graphics.svg" alt="no graphics" />\n                        <p data-lang="no_graphics_selected" class="graphic-manager__empty-text">').concat(BeFunky.LanguageManager.getString("no_graphics_selected"),"</p>\n                    </div>\n                    ")}}}),this.graphicsContainer=this.querySelector(".graphic-manager__graphics")},this.initShapes=function(){var e=this,t=document.createDocumentFragment();[{name:"rectangle",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><rect fill="currentColor" width="44" height="44" /></svg>'},{name:"ellipse",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><circle fill="currentColor" cx="22" cy="22" r="22" /></svg>'},{name:"triangle",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><polygon fill="currentColor" points="0,44 22,0 44,44" /></svg>'},{name:"star",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><path fill="currentColor" d="M 22.000 35.000 L 36.107 43.416 L 32.462 27.399 L 44.825 16.584 L 28.466 15.101 L 22.000 0.000 L 15.534 15.101 L -0.825 16.584 L 11.538 27.399 L 7.893 43.416 L 22.000 35.000"/></svg>'},{name:"polygon",svg:'<svg xmlns="http://www.w3.org/2000/svg" style="transform: rotate(180deg)" width="44" height="44"><path fill="currentColor"  d="M 22.000 43.000 L 43.874 27.107 L 35.519 1.393 L 8.481 1.393 L 0.126 27.107 L 22.000 43.000"/></svg>'},{name:"line",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><rect fill="currentColor" width="44" height="4" y="20" /></svg>'},{name:"arrow",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44"><rect fill="currentColor" width="32" height="4" y="20" /><polygon fill="currentColor" points="32,14 44,22 32,30" /></svg>'}].forEach(function(n){var i=n.name,r=n.svg,a=document.createElement("button");BFN.UI.graphicManagerShape(a,i,r,e.accordion),t.appendChild(a)}),this.querySelector(".graphic-manager__shapes").appendChild(t)},this.addItem=function(t){var n=document.createElement("div");BFN.UI.graphicManagerItem(n,t,e.accordion),e.items[t.id]={element:n},1===Object.keys(e.items).length?e.graphicsContainer.appendChild(n):e.graphicsContainer.insertBefore(n,e.graphicsContainer.firstElementChild)},this.removeItem=function(t){var n=e.items[t];n&&(e.graphicsContainer.removeChild(n.element),delete e.items[t])},this.init()}.bind(e)()},BFN.UI.graphicManagerItem=function(e,t,n){return function(){var e=this,i=BFN.getImageType(t.id);this.setAttribute("class","graphic-manager__item graphic-manager__item--".concat(i," button")),this.init=function(){this.addGraphic(),this.addButtons(),this.addPlusBadge(),this.menuImageVO=t,BFN.UI.draggableElement(this,n),this.dataset.tooltip="drag_or_double_click",this.addEventListener("dblclick",this.handleDoubleClick),this.addEventListener("dragstarted",this.handleDragStarted),this.addEventListener("dragstopped",this.handleDragStopped)},this.addGraphic=function(){var e=this,n=t.thumbURL,i='url("'.concat(n,'") no-repeat center'),r=new Image;r.onload=function(){var t=document.createElement("div").addClass("graphic-manager__placeholder").setStyles({background:i,backgroundSize:"contain"}),n=e.firstElementChild,r=document.createElement("div").addClass("graphic-manager__hover-container");n?e.insertBefore(t,n):e.appendChild(t),e.appendChild(r)},r.onerror=function(){e.hasRetried?BeFunky.logError("Failed to load thumbnail for a second time"):(e.hasRetried=!0,BeFunky.logError("Failed to load thumbnail. Trying again in 3 seconds..."),setTimeout(e.addGraphic.bind(e),3e3))},r.src=n},this.addButtons=function(){if(t.isRemovable){var e=function(e,t,n){var i=document.createElement("button");i.setAttribute("class","button button--icon button--grey-200 graphic-manager__button graphic-manager__button--".concat(e)),n&&(i.dataset.tooltip=n);t&&(i.innerHTML='\n                <svg class="icon icon icon--12">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'.concat(t,'"></use>\n                </svg>\n            '));return i}("remove","cancel-icon","remove_from_graphic_manager");e.addEventListener("click",this.handleRemoveButtonClick),this.appendChild(e)}},this.addPlusBadge=function(){if(t.isPlus&&!BFN.BfnService.userIsPlus){var e=document.createElement("div").setClass("badge badge--plus");this.appendChild(e)}},this.handleRemoveButtonClick=function(){BFN.GraphicLibraryManager.removeGraphic(t.id)},this.handleDoubleClick=function(){-1!==BFN.GraphicLibraryManager.getIndex(t.id)&&e.addToCanvas()},this.handleDragStarted=function(){BFN.DragScreen.show(t.thumbURL),document.addEventListener("keyup",e.handleEscape)},this.handleDragStopped=function(t){var n=t.detail.canvasCoordinates;document.removeEventListener("keyup",e.handleEscape),n&&e.addToCanvas(n)},this.addToCanvas=function(e){if(t.isPlus&&!BFN.BfnService.userIsPlus)return BFN.BfnService.upgrade("GOODIES","".concat(t.trackingID,"_UPGRADE")),void BFN.UserActionManager.addUpgradeAction(["Add Plus Graphic"],!1);BFN.ImageLibraryManager.addImageToCanvas(t,{forceLayer:!0,isGoodie:!0,initialCenterPosition:e}),BFN.BfnService.track("CREATE","GOODIES",t.trackingID)},this.handleEscape=function(t){27===t.which&&e.cancelDragging()},this.init()}.bind(e)()},BFN.UI.graphicManagerShape=function(e,t,n,i){return function(){var e=this;this.setClass("graphic-manager__shape"),this.setAttribute("data-tooltip",t),this.innerHTML=n,this.init=function(){var e=this;this.addEventListener("click",function(){return e.addToCanvas()}),BFN.UI.draggableElement(this,i),this.addEventListener("dragstarted",this.handleDragStarted),this.addEventListener("dragstopped",this.handleDragStopped)},this.handleDragStarted=function(){var t="data:image/svg+xml,".concat(n.replace(/#EDEDED/,"white").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/#/g,"%23"));BFN.DragScreen.show(t),document.addEventListener("keyup",e.handleEscape)},this.handleDragStopped=function(t){var n=t.detail.canvasCoordinates;document.removeEventListener("keyup",e.handleEscape),n&&e.addToCanvas(n)},this.addToCanvas=function(e){BFN.BasicShapeManager.createShape(t,e),BFN.BfnService.track("CREATE","SHAPES",t)},this.handleEscape=function(t){27===t.which&&e.cancelDragging()},this.init()}.bind(e)()},BFN.UI.imageManager=function(e){return function(){var e=this;this.init=function(){this.initDefaultValues(),this.initContextMenu()},this.initDefaultValues=function(){var e=this;this.items={},this.scrollContainer=this.querySelector(".scrollable-content"),this.imagesContainer=this.querySelector(".image-manager__images"),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleViewstateUpdated),setTimeout(function(){return e.handleViewstateUpdated()},0),this.clearButton=document.getElementById("image_manager_clear"),BFN.CollageMakerCanvasPhotoGridModel.addEventListener(BFN.CollageMakerCanvasPhotoGridModelEvents.FREEFORM_UPDATED.type,this.handleFreeformModeUpdated),this.handleFreeformModeUpdated()},this.initContextMenu=function(){var e=this;this.contextMenuComponent=document.getElementById("context_menu_image_manager"),this.contextMenuTargetItem=null;var t=function(t){return{onClick:function(){t(e.contextMenuTargetItem)}}},n={x:-9,y:-10};BeFunky.contextMenu(this.contextMenuComponent,{add_to_cell:t(function(e){BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO)}),add_as_layer:t(function(e){BFN.ImageLibraryManager.addImageToCanvas(e.menuImageVO,{forceLayer:!0})}),set_as_background:t(function(e){BFN.PhotoEditorModel.confirmEditorLoadImage(function(){var t=e.menuImageVO,n=!1;UIToggler.toggleLoadScreen(!0,{onCancel:function(){return n=!0}}),BFN.BfnService.getImageBlobOrSVG(t,function(e){var i=e.blob,r=e.svgString,a=e.error;if(UIToggler.toggleLoadScreen(!1),a)return BeFunky.logError(a);if(!n){var o=BFN.getImageType(t.id);BFN.BfnService.track("CREATE","PHOTOEDITOR","SET_AS_BACKGROUND"),BFN.BfnService.trackMediaOpened("image",o),i||(i=new Blob([r],{type:"image/svg+xml"})),BFN.PhotoEditorModel.loadBase64OrBlob(i,{filename:t.name})}})})}),save_to_befunky:t(function(e){e.handleSaveButtonClick()}),remove:t(function(e){e.handleRemoveButtonClick()})},{offset:n,onHide:function(t,i){if(t&&!(i>400)){var r=-n.x,a=-n.y;if(Math.abs(r-t.offsetX)<=2){var o=Object.values(e.contextMenuComponent.items),s=o.reduce(function(e,t){return e+(t.hasClass("context-menu__item--hidden")?0:32)},0)+16,l=t.offsetY-s;Math.abs(a-l)<=2&&(console.log("Simulating double click"),o.find(function(e){return!e.hasClass("context-menu__item--hidden")}).click())}}}}),this.contextMenuComponent.target=this.imagesContainer,this.contextMenuComponent.enabled=!1,this.contextMenuComponent.addEventListener("SHOW",function(){e.contextMenuComponent.enabled=!1});var i=function(t){var n,i=!1;t.target&&t.target.hasClass("image-manager__placeholder")&&(n=t.target.parentElement)&&(i=!0),e.contextMenuComponent.enabled=i,e.contextMenuTargetItem=i?n:null,i&&(e.simulateDoubleClick(),e.contextMenuComponent.toggleButton("save_to_befunky",!n.menuImageVO.isSaved&&!n.menuImageVO.isSVG),e.contextMenuComponent.toggleButton("remove",n.menuImageVO.isRemovable),e.contextMenuComponent.toggleButton("add_to_cell",BFN.AppModel.viewingCollage&&!!BFN.PhotoGrid.randomEmptyChild))};this.imagesContainer.addEventListener("click",i),this.imagesContainer.addEventListener("contextmenu",i)},this.addItem=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.createElement("div");if(BFN.UI.imageManagerItem(r,t),e.items[t.id]={element:r},e.toggleSampleImages(),i)e.imagesContainer.appendChild(r);else{var a=e.imagesContainer.children;n=Math.min(n,a.length-6),a.length&&a.length>n?e.imagesContainer.insertBefore(r,a[n]):e.imagesContainer.appendChild(r)}},this.removeItem=function(t){var n=e.items[t];n&&(e.imagesContainer.removeChild(n.element),delete e.items[t],e.toggleSampleImages(),e.contextMenuComponent.hide())},this.toggleSampleImages=function(){e.imagesContainer.toggleClass("image-manager__images--hide-samples",Object.keys(e.items).some(function(e){return!e.startsWith("sample_")}))},this.simulateDoubleClick=function(){var t=e.contextMenuComponent;t.setStyles({opacity:"0",transition:"opacity .15s ease-out"}),document.addEventListener(BeFunky.pointermove,i);var n=setTimeout(i,150);function i(){t.setStyles({opacity:"",transition:""}),clearTimeout(n),document.removeEventListener(BeFunky.pointermove,i)}},this.handleViewstateUpdated=function(){e.toggleClass("image-manager--hide-controls",!BFN.AppModel.viewingCollage),e.contextMenuComponent.toggleButton("set_as_background",BFN.AppModel.viewingEditor)},this.handleFreeformModeUpdated=function(){e.clearButton.disabled=!!BFN.CollageMakerCanvasPhotoGridModel.freeform},this.init()}.bind(e)()},BFN.UI.imageManagerItem=function(e,t){return function(){var e=this,n=BFN.getImageType(t.id);function i(e,t,n){var i=document.createElement("button");return i.setAttribute("class","button button--icon button--xs button--grey-200 image-manager__button image-manager__button--".concat(e)),n&&(i.dataset.tooltip=n),t&&(i.innerHTML='\n                <svg class="icon icon--14">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'.concat(t,'"></use>\n                </svg>\n            ')),i}this.setAttribute("class","image-manager__item image-manager__item--".concat(n)),this.init=function(){this.addImage(),this.addButtons(),this.menuImageVO=t,this.lastPreloadedURL="",BFN.UI.draggableElement(this,BFN.ImageLibraryManager.sidebar.scrollContainer),this.dataset.tooltip="drag_or_double_click",this.addEventListener("dragstarted",this.handleDragStarted),this.addEventListener("dragstopped",this.handleDragStopped)},this.addImage=function(){var e=this,n=t.id,i=t.thumbURL,r=t.thumbWidth,a=void 0===r?0:r,o=t.thumbHeight,s=void 0===o?0:o,l=t.isTransparent,u=BFN.CSS.imageManagerThumbSize,c='url("'.concat(i,'") no-repeat center'),h=a>=u&&s>=u?"cover":"contain";l&&(c+=", url('".concat(BFN.imagesURL,"app/checker_pattern.jpg') repeat"),h+=", auto");var d=new Image;d.onload=function(){var t=document.createElement("div").addClass("image-manager__placeholder").setStyles({background:c,backgroundSize:h}),n=document.createElement("div").addClass("image-manager__hover-container"),i=e.firstElementChild;i?e.insertBefore(t,i):e.appendChild(t),e.appendChild(n)},d.onerror=function(){e.hasRetried?BeFunky.logError("Failed to load thumbnail for a second time"):(e.hasRetried=!0,"pixabay"===BFN.getImageType(n)?(BeFunky.logError("Failed to load expired Pixabay image. Trying again..."),BFN.ImageLibraryService.getPixabayImageById(n.replace("pixabay_","")).then(function(n){t.imageURL=n.imageURL,t.thumbURL=n.thumbURL,e.addImage(),requestIdleCallback(function(){return BFN.ImageLibraryManager.updateImageStore()})}).catch(function(e){BeFunky.throwError("Unable to get updated Pixabay image",e)})):(BeFunky.logError("Failed to load thumbnail. Trying again in 3 seconds..."),setTimeout(e.addImage.bind(e),3e3)))},d.src=i},this.addButtons=function(){if(!t.isSaved){var e=i("save","download-icon","save_to_befunky");e.addEventListener("click",this.handleSaveButtonClick),this.appendChild(e)}if(t.isRemovable){var n=i("remove","cancel-icon","remove_from_image_manager");n.addEventListener("click",this.handleRemoveButtonClick),this.appendChild(n)}},this.handleRemoveButtonClick=function(){BFN.ImageLibraryManager.removeImage(t.id)},this.handleSaveButtonClick=function(){BFN.ImageLibraryManager.saveImageAsLayer(t)},this.handleDragStarted=function(){BFN.DragScreen.show(t.thumbURL),document.addEventListener("keyup",e.handleEscape),BFN.AppModel.viewingCollage&&!BFN.CollageMakerCanvasPhotoGridModel.freeform&&(BFN.PhotoGrid.awaitingDrop=!0),BFN.TransformModel.awaitingDrop=!t.isSVG,t.imageURL&&t.imageURL!==e.lastPreloadedURL&&(BeFunky.isChromium||BeFunky.isSafari)&&(e.lastPreloadedURL=t.imageURL,BFN.RequestUtils.getBlob(t.imageURL,function(){}))},this.handleDragStopped=function(n){var i=n.detail.canvasCoordinates;document.removeEventListener("keyup",e.handleEscape),i?BFN.ImageLibraryManager.addImageToCanvas(t,{initialCenterPosition:i}):(BFN.PhotoGrid.awaitingDrop=!1,BFN.TransformModel.awaitingDrop=!1,BFN.TransformModel.focusedTransformItem=null,BFN.TransformModel.targetTransformItem=null)},this.handleEscape=function(t){27===t.which&&e.cancelDragging()},this.init()}.bind(e)()},BFN.UI.messageScreen=function(e){return function(){var e=this;this.addClass("message-screen");this.insertAdjacentHTML("beforeend",'<div class="center-container"></div>'),this.init=function(){var e=this;this.active=!1,this.messageQueue=[],this.transitionTimeQueue=[],this.centerContainer=this.querySelector(".center-container"),this.messageContainer=document.createElement("div").addClass("message-container"),this.transitionTime=750,this.easeInTransition=function(){return"all ".concat(e.transitionTime,"ms cubic-bezier(0, 0, 0.3, 0.7)")},this.easeOutTransition=function(){return"all ".concat(e.transitionTime,"ms cubic-bezier(0, 0, 0.7, 0.3)")}},this.show=function(e,t){(!(t=parseInt(t))||t<=0)&&(t=750),this.messageQueue.push(e),this.transitionTimeQueue.push(t),this.active||this.processMessageQueue()},this.processMessageQueue=function(){var e=this;if(this.messageQueue.length){this.active||(this.active=!0,this.addClass("active"));var t=this.messageQueue.shift();this.messageContainer.innerHTML=/^[a-z0-9_]+$/.test(t)?BeFunky.LanguageManager.getString(t):t,this.transitionTime=this.transitionTimeQueue.shift(),this.messageContainer.setStyles({opacity:0,transition:this.easeInTransition()}),this.centerContainer.appendChild(this.messageContainer),this.messageContainerHeight=parseInt(this.messageContainer.getBoundingClientRect().height),this.messageContainer.setStyles({transform:"translateY(-".concat(this.messageContainerHeight/2,"px)"),opacity:1}),setTimeout(function(){return requestAnimationFrame(e.handleEaseInEnd)},this.transitionTime)}else this.active=!1,this.removeClass("active")},this.handleEaseInEnd=function(){e.messageContainer.setStyles({transform:"translateY(-".concat(e.messageContainerHeight,"px)"),opacity:0,transition:e.easeOutTransition()}),setTimeout(function(){return requestAnimationFrame(e.handleEaseOutEnd)},e.transitionTime)},this.handleEaseOutEnd=function(){e.messageContainer.setStyles({transform:"unset",transition:""}),e.centerContainer.removeChild(e.messageContainer),setTimeout(e.processMessageQueue.bind(e),0)},this.init()}.bind(e)()},BFN.UI.navbarDropdown=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onOpen,i=void 0===n?function(){}:n,r=t.onClose,a=void 0===r?function(){}:r,o=t.onDisabledClick,s=void 0===o?function(){}:o;return function(){var e=this;this.init=function(){this.initDefaultValues(),this.initToggleButton()},this.initDefaultValues=function(){this.toggleButton=this.querySelector(".navbar-dropdown-button"),this.dropdownItems=this.querySelector(".navbar-dropdown-items"),v(this.querySelectorAll(".dropdown-item--has-submenu")).forEach(function(e){e.addEventListener("click",function(){e.focus()})})},this.initToggleButton=function(){var e=this;this.toggleButton.addEventListener("click",function(){var t=e.hasAttribute("disabled"),n=e.toggleButton.hasClass("button--selected");if(t)return s();n?e.close():e.open()})},this.open=function(){e.toggleButton.addClass("button--selected"),e.addEventListener("focusout",e.closeOnFocusout),document.addEventListener("click",e.closeOnClick,!0),i()},this.close=function(){e.toggleButton.removeClass("button--selected"),e.removeEventListener("focusout",e.closeOnFocusout),document.removeEventListener("click",e.closeOnClick,!0),a()},this.closeOnFocusout=function(){setTimeout(function(){e.toggleButton.hasClass("button--selected")&&!e.dropdownItems.contains(document.activeElement)&&e.close()},BeFunky.isEdgeHTML?100:30)},this.closeOnClick=function(t){t.target===e.toggleButton||t.target.hasClass("dropdown-item--has-submenu")||e.close()},this.init()}.bind(e)()},BFN.UI.popover=function(e){return function(){for(var e=this,t=document.createDocumentFragment();this.firstChild;)t.appendChild(this.firstChild);this.innerHTML='\n        <div class="popover-arrow"></div>\n        <div class="popover-container"></div>\n    ',this.querySelector(".popover-container").appendChild(t),this.setStyles({display:"block"}),this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this;this.isActive=!1,this.panelPressed=!1,this.sides=["left","top","right","bottom"],this._side=this.sides[0],this._positionFactor=.5,this._strong=!1,this._positionEdge=!1,this.arrow=this.querySelector(".popover-arrow"),this.container=this.querySelector(".popover-container"),this.arrowBase=null,this.addEventListener(BeFunky.pointerdown,function(){e.panelPressed=!0}),this.useTransform=!(this.dataset.transform&&"false"===this.dataset.transform),this.dataset.side&&(this.side=this.dataset.side),this.dataset.position&&(this.positionFactor=Number(this.dataset.position)),this.dataset.strong&&(this._strong=this.dataset.strong),this.dataset.positionEdge&&(this._positionEdge=this.dataset.positionEdge),BFN.MainUI.addIdleRenderFunction(this.updateDisplay.bind(this))},this.show=function(){this.updateDisplay(),this.addClass("active"),document.addEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),this.isActive=!0},this.bounce=function(){var e=this;this.addClass("bounce"),setTimeout(function(){e.removeClass("bounce")},100)},this.hide=function(){this.removeClass("active"),document.removeEventListener(BeFunky.pointerdown,this.handleDocumentMouseDown),this.isActive=!1},this.hideUnlessPressed=function(){this.panelPressed||this.hide(),this.panelPressed=!1},this.updateDisplay=function(){if(null!==this.offsetParent){this.arrowBase=28;var e=this.container.getBoundingClientRect(),t=this._positionEdge?this.arrowBase/2:this.arrowBase,n=-Math.round((e.width-2*t)*this._positionFactor+t),i=-Math.round((e.height-2*t)*this._positionFactor+t);this.arrow.setStyles({transform:"rotate(".concat({left:-45,right:-225,top:-315,bottom:-135}[this._side],"deg)")});var r={left:{x:10,y:i},right:{x:-(e.width+10),y:i},top:{x:n,y:10},bottom:{x:n,y:-(e.height+10)}},a=this.useTransform?{transform:"translateX(".concat(r[this._side].x,"px) translateY(").concat(r[this._side].y,"px)")}:{left:"".concat(r[this._side].x,"px"),top:"".concat(r[this._side].y,"px")};this.container.setStyles(a)}},this.handleDocumentMouseDown=function(){e._strong||(e.hideUnlessPressed(),e.panelPressed=!1)},Object.defineProperty(this,"side",{set:function(e){-1!==this.sides.indexOf(e)&&(this._side=e,this.isActive&&this.updateDisplay())},get:function(){return this._side}}),Object.defineProperty(this,"positionFactor",{set:function(e){this._positionFactor=Math.max(0,Math.min(1,e)),this.isActive&&this.updateDisplay()},get:function(){return this._positionFactor}}),Object.defineProperty(this,"strong",{set:function(e){this._strong=e},get:function(){return this._strong}}),Object.defineProperty(this,"positionEdge",{set:function(e){this._positionEdge=!!e,this.isActive&&this.updateDisplay()},get:function(){return this._positionEdge}}),this.init()}.bind(e)()};var T_=BeFunky.lit,b_=T_.html,S_=T_.elem;function C_(){var e=g(['\n            <div class="stock-search__author gallery__item-content">\n                <a href="','" @click=',' target="_blank" rel="noopener">','</a> |\n                <a href="','" @click=',' target="_blank" rel="noopener">',"</a>\n            </div>"]);return C_=function(){return e},e}BFN.UI.presetMenuItem=function(e,t){var n=t.presetID,i=t.presetLang,r=t.presetObject,a=t.useGeneric,o=t.usePaint,s=t.useFavoriteIcon,l=t.useBatchProcessingIcon,u=t.genericMenu,c=t.brushMenu,h=t.applyCancelMenu,d=t.imageThumbnailSrc,m=t.useProcessedThumb,p=t.useBasicAmount,g=t.presetAmountSliderID,y=t.helpClueID,x=t.helpCluePlaceholder,_=t.paintModeHelpClueID,I=t.categoryHeader;return function(){var e=this;this.addClass("preset-menu-item");var t=!1;function T(e,t){return'\n        <svg class="'.concat(t,'">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(e,'"></use>\n        </svg>\n        ')}this.isGenerated=!1,this.isSelected=!1,this.hasBadge=!1,this.isPlusFeature=Boolean(r.isPlus),this.isLoading=!1,this.loadingSpinner=document.createElement("span").addClass("loading-spinner"),this.thumbProcessed=!1,this.useProcessedThumb=m,this.presetID=n,this.presetObject=r,this.imageThumbnailSrc=d,this.markup='\n        <div class="preset-menu-item__hover-container"></div>\n        <div class="preset-menu-item__title-bar bold">\n        </div>\n        <div id="'.concat(n,'_basic_settings" class="preset-menu-item__basic-settings focus-avoid">\n            ').concat(s?'<button id="favorite_'.concat(n,'"></button>'):"","\n            ").concat(l?'<button id="batch_processing_'.concat(n,'" class="button button--sm button--icon button--transparent"></button>'):"",'\n            <div class="preset-menu-item__basic-settings-buttons">\n                <button id="').concat(n,'_advanced" class="button button--white-outline button--icon" data-tooltip="settings">\n                    ').concat(T("edit-icon","icon icon--18"),'\n                </button>\n                <button id="').concat(n,'_cancel" class="button button--white-outline button--icon" data-tooltip="cancel">\n                    ').concat(T("cancel-icon","icon icon--18"),'\n                </button>\n                <button id="').concat(n,'_apply" class="button button--white-outline button--icon" data-tooltip="apply">\n                    ').concat(T("checkmark-icon","icon icon--18"),'\n                </button>\n            </div>\n            <div class="preset-menu-item__slider">\n                <div id="').concat(n,'_amount_slider"></div>\n            </div>\n        </div>\n        <div class="preset-menu-item__advanced-settings focus-avoid">\n            <panel-header modifier="preset" buttons="close" clue-id="').concat(_||"",'"></panel-header>\n            <div class="preset-menu-item__advanced-settings-padding-container">\n                ').concat(o?"\n                <tabbed-layout></tabbed-layout>\n                ":'\n                <div class="generic_menu_container"></div>\n                <div class="custom_controls_container"></div>\n                ','\n                <div class="control-item control-item-bottom">\n                    <div class="apply_cancel_menu_container"></div>\n                </div>\n            </div>\n        </div>\n    '),this.generateItem=function(){if(!this.isGenerated){this.isGenerated=!0,this.innerHTML=this.markup;var e=this.querySelector(".preset-menu-item__title-bar");if(Array.isArray(i)?e.setLang.apply(e,v(i)):e.setLang(i),this.querySelector("panel-header").langId=i,this.setAttribute("tabindex","0"),n.startsWith("winter_holidays")){var t=function(){return e.toggleClass("bold","ru"!==BeFunky.LanguageManager.language.app||!n.startsWith("winter_holidays"))};t(),BeFunky.LanguageManager.addLanguageUpdateListener(t)}this.init()}},this.init=function(){this.initDefaultValues(),this.initHoverContainer(),this.initFavoriteIcon(),this.updateBadge(),d?this.setBackground(d,!0):this.handleCurrentImageThumbUpdated(),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,this.handleUserDataChanged)},this.initDefaultValues=function(){var e=this;this.setLoading(!d),this.isLoading&&(BFN.PhotoEditorMenuModel.addEventListener(BFN.PhotoEditorMenuModelEvents.CURRENT_IMAGE_THUMB_UPDATED.type,this.handleCurrentImageThumbUpdated),BFN.PresetMenuItemThumbManager.addEventListener(BFN.PresetMenuItemThumbManagerEvents.PROCESSING_QUEUE_UPDATED.type,this.handleProcessingThumbQueueUpdated)),p&&(this.presetAmountSlider=document.getElementById(g),this.handlePresetAmountSliderUpdate=function(){e.basicAmountSlider.noUiSlider.set(e.presetAmountSlider.noUiSlider.get())}),this.advancedSettings=this.querySelector(".preset-menu-item__advanced-settings"),this.basicSettings=document.getElementById("".concat(n,"_basic_settings")),o?(this.tabbedLayout=this.advancedSettings.querySelector("tabbed-layout"),this.genericMenuContainer=S_(I_()),this.brushMenuContainer=S_(__()),this.customControlsContainer=S_(x_()),this.tabbedLayout.tabs={adjust:b_(y_(),this.genericMenuContainer,this.customControlsContainer),erase:this.brushMenuContainer}):(this.genericMenuContainer=this.querySelector(".generic_menu_container"),this.customControlsContainer=this.querySelector(".custom_controls_container")),this.genericMenu=a?u:null,this.brushMenu=c,this.applyCancelMenu=h,this.applyCancelMenuContainer=this.advancedSettings.querySelector(".apply_cancel_menu_container")},this.initHoverContainer=function(){var e=this,t=function(){e.isLoading||(UITools.applyTool(n),e.selectItem())};v(this.querySelectorAll(".preset-menu-item__hover-container, .preset-menu-item__title-bar")).forEach(function(e){return e.addEventListener("click",t)}),this.addEventListener("keyup",function(n){"Enter"!==n.key&&13!==n.keyCode||document.activeElement===e&&e.hasClass("preset-menu-item--focus")&&t()})},this.initFavoriteIcon=function(){if(s){var e=document.getElementById("favorite_".concat(n));BFN.UI.favoriteStar(e),BFN.FavoritesManager.registerFavoriteStar(e)}},this.setupItem=function(){t||(t=!0,this.setupBasicSettings(),this.setupAdvancedSettings(),this.setupCustomControls(),this.setupBatchProcessingIcon())},this.setupBatchProcessingIcon=function(){if(l){var e=document.getElementById("batch_processing_".concat(n));BFN.UI.batchProcessingIcon(e,{iconClass:"icon--18"}),BFN.BatchIconManager.registerButtonIcon(e),BFN.BatchIconManager.registerPanelHeader(this.panelHeader,n)}},this.setupBasicSettings=function(){var e=this;if(document.getElementById("".concat(n,"_advanced")).addEventListener("click",function(){e.genericMenu&&e.genericMenuContainer.appendChild(e.genericMenu),e.brushMenu&&e.brushMenuContainer&&e.brushMenuContainer.appendChild(e.brushMenu),e.applyCancelMenu&&e.applyCancelMenuContainer.appendChild(e.applyCancelMenu),e.toggleAdvancedSettings(!0),e.togglePaintTab(!1)}),document.getElementById("".concat(n,"_cancel")).addEventListener("click",function(){BFN.applyCancelMenu.cancelButton.click()}),document.getElementById("".concat(n,"_apply")).addEventListener("click",function(){BFN.applyCancelMenu.applyButton.click()}),p){this.basicAmountSlider=document.getElementById("".concat(n,"_amount_slider"));BFN.UI.slider(this.basicAmountSlider,{start:.5,step:.1,behaviour:"snap",animationDuration:0,connect:[!0,!1],range:{min:0,max:1},keyboardPageMultiplier:10},function(e,t){var n=g,i="end"!==e;UITools.setControlValue(n,t,i),UITools.applyToolControl(n),UITools.updateToolControl(n)})}},this.setupAdvancedSettings=function(){var e=this;this.panelHeader=this.querySelector("panel-header"),this.panelHeader.addEventListener("CLOSE",function(){e.toggleAdvancedSettings(!1),e.focus()}),o&&this.tabbedLayout.addEventListener("TAB_CHANGE",function(){e.togglePaintTab("erase"===e.tabbedLayout.activeTab)})},this.setupCustomControls=function(){var e=[],t=r.params,i=n;t.forEach(function(t){var r="".concat(n,"_").concat(t.name),a=t.name;e.push({toolID:i,controlID:r,controlName:a,controlParamObject:Object.assign({},t)})}),a&&"slider_item"===t[0].type&&this.genericMenu.firstElementChild&&this.genericMenu.firstElementChild.hasClass("control-item--slider")&&this.customControlsContainer.setStyles({marginTop:"-0.5rem"}),UITools.setupControlItems(e,this.customControlsContainer),e.forEach(function(e){var t=e.controlID;UITools.registerControl(t)}),p||a||o||!t.every(function(e){return"static"===e.type})||(document.getElementById("".concat(n,"_advanced")).disabled=!0)},this.buildItem=function(){if(this.genericMenu&&this.genericMenuContainer.appendChild(this.genericMenu),this.brushMenu&&this.brushMenuContainer&&this.brushMenuContainer.appendChild(this.brushMenu),this.applyCancelMenu){try{this.applyCancelMenu.upgradeMode=!!this.isPlusFeature&&!BFN.BfnService.userIsPlus}catch(e){}this.applyCancelMenuContainer.appendChild(this.applyCancelMenu)}if(y&&BFN.HelpClueManager.setup(y,{side:"left",positionFactor:0,left:"260px",top:"-21px",container:x}),_&&BFN.HelpClueManager.setup(_,{side:"left",positionFactor:0,left:"256px",top:"0px",container:x}),o&&!this.advancedSettingsHeights){var e=this.advancedSettings.getBoundingClientRect().height,t=f(v(this.tabbedLayout.querySelectorAll(".tabs__panel")).map(function(e){return e.getBoundingClientRect().height}),2),n=t[0],i=t[1];this.advancedSettingsHeights=[e,e-n+i]}if(this.parentTop||(this.parentTop=this.parentElement.getBoundingClientRect().top),BFN.activePresetMenuItem){var r=BFN.activePresetMenuItem;r.genericMenu&&r.genericMenuContainer.appendChild(r.genericMenu),r.brushMenu&&r.brushMenuContainer&&r.brushMenuContainer.appendChild(r.brushMenu),r.applyCancelMenu&&r.applyCancelMenuContainer.appendChild(r.applyCancelMenu)}},this.selectItem=function(){var e=this;if(!this.isSelected){if(this.isSelected=!0,this.previousActiveSibling=null,BFN.activePresetMenuItem){if(BFN.activePresetMenuItem.parentElement===this.parentElement)for(var t=v(this.parentElement.children),n=0;n<t.length&&t[n]!==this;n++)if(t[n]===BFN.activePresetMenuItem){this.previousActiveSibling=BFN.activePresetMenuItem;break}BFN.activePresetMenuItem.deselectItem()}else v(this.parentElement.children).filter(function(t){return t!==e}).forEach(function(e){e.isSelected&&(BeFunky.logError("Selected preset_menu_item sibling found that was not BFN.activePresetMenuItem!",e),e.deselectItem())});this.setupItem(),this.buildItem(),BFN.activePresetMenuItem=this,this.toggleBasicSettings(!0),this.togglePaintTab(!1),p&&(this.basicAmountSlider.noUiSlider.updateOptions({range:this.presetAmountSlider.noUiSlider.options.range,step:this.presetAmountSlider.noUiSlider.options.step}),this.basicAmountSlider.noUiSlider.set(this.presetAmountSlider.noUiSlider.get()),this.presetAmountSlider.noUiSlider.on("update",this.handlePresetAmountSliderUpdate)),y&&BFN.HelpClueManager.show(y),I&&I.toggleButtons({help:!0}),this.scrollIntoView()}},this.deselectItem=function(){if(this.isSelected){this.isSelected=!1,this.toggleBasicSettings(!1),this.toggleAdvancedSettings(!1),BFN.activePresetMenuItem===this&&(BFN.activePresetMenuItem=null),p&&this.presetAmountSlider.noUiSlider.off("update",this.handlePresetAmountSliderUpdate),y&&BFN.HelpClueManager.hide(y),I&&I.toggleButtons({help:!1});var e=document.activeElement;this.contains(e)&&this.focus()}},this.toggleBasicSettings=function(e){this.basicSettings.toggleClass("active",e).toggleClass("focus-avoid",!e)},this.toggleAdvancedSettings=function(e){if(this.advancedSettings.toggleClass("active",e).toggleClass("focus-avoid",!e),this.togglePaintTab(!1),y&&BFN.HelpClueManager.toggle(y,!e,{force:!1}),o||(this.conformToCurrentHeight(),this.scrollIntoView()),I&&I.toggleButtons({help:!e}),e){var t=this.advancedSettings;t.setAttribute("tabindex","0"),t.focus(),t.addEventListener("blur",function e(){t.removeEventListener("blur",e),t.removeAttribute("tabindex")})}},this.togglePaintTab=function(e){if(o)if("erase"===this.tabbedLayout.activeTab===e){if(_&&(BFN.HelpClueManager.toggle(_,e,{force:!1}),this.panelHeader)){var t={help:e};l&&(t[BFN.BatchIconManager.isSelected(n)?"batch_remove":"batch_add"]=!e),this.panelHeader.toggleButtons(t)}this.conformToCurrentHeight(this.advancedSettingsHeights?this.advancedSettingsHeights[e?1:0]:void 0),this.scrollIntoView(),BFN.activePresetMenuItem===this&&o&&BFN.ImagePainterUndoManager.currentImagePainter&&(BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled=e,e&&BFN.ImagePainterUndoManager.currentImagePainter.brushSizeChanged&&BFN.ImagePainterUndoManager.currentImagePainter.updateBrush())}else this.tabbedLayout.activeTab=this.tabbedLayout.tabNames[e?1:0]},this.conformToCurrentHeight=function(e){var t=this.advancedSettings.hasClass("active")?e||this.advancedSettings.getBoundingClientRect().height:130;0!==t||this.isSelected||(t=130),this.setStyles({height:"".concat(t,"px")})},this.scrollIntoView=function(){var e=this;if(this.isSelected){if(this.isAnimatingScroll){if(!this.isScrollCancellable)return;this.cancelScroll()}this.isAnimatingScroll=!0;var t=this.advancedSettings.hasClass("active")?this.scrollAdvancedSettings():this.scrollBasicSettings();if(0!==t){var n=this.parentElement,i=n.scrollTop,r=i+t;this.cancelScroll=function(e,t,n){var i=function(e){return"number"==typeof e?e:null},r=function(e){return"function"==typeof e?e:function(e){return e}},a=r(n.onComplete),o=r(n.onUpdate),s=r(n.ease),l=Date.now(),u=Object.keys(e).reduce(function(t,r){var a=i(e[r]),o=i(n[r]);return null!==a&&null!==o&&(t[r]=[a,o]),t},{}),c=Object.keys(u),h=!1;return function i(){var r=Date.now(),d=t>0?(r-l)/t:1;c.forEach(function(n){var i,r=f(u[n],2),a=r[0],o=r[1],l=s(d,a,o,t);e[n]=(i=a)+l*(o-i)}),d>=1||h?(c.forEach(function(t){e[t]=n[t]}),o(e),a(e)):(o(e),requestAnimationFrame(i))}(),function(){h=!0}}({scrollPos:i},300,{scrollPos:r,onUpdate:function(e){n.scrollTop=e.scrollPos},onComplete:function(){e.isAnimatingScroll=!1},ease:function(e){return e<.5?2*e*e:(4-2*e)*e-1}})}else this.isScrollCancellable=!1,setTimeout(function(){e.isAnimatingScroll=!1,e.isScrollCancellable=!0},0)}},this.scrollBasicSettings=function(){var e=0;if(this.previousActiveSibling){var t=this.previousActiveSibling.getBoundingClientRect().height,n=parseInt(this.previousActiveSibling.style.height);t&&n&&n<t&&(e=t-n)}var i=this.getBoundingClientRect(),r=this.parentTop-i.top+e,a=i.bottom-BFN.appHeight-e;return r>0?-r:a>0?a:0},this.scrollAdvancedSettings=function(){return this.getBoundingClientRect().top-this.parentTop},this.setBackground=function(e,t){this.setStyles({backgroundImage:'url("'.concat(e,'")')}),this.thumbProcessed=t},this.updateBadge=function(){var e=BFN.BfnService.userIsPlus,t=this.isPlusFeature&&!e;if(t!==this.hasBadge){var n=this.querySelector(".preset-menu-item__title-bar");if(t)n.insertAdjacentHTML("beforeend",'<span class="badge badge--plus"></span>');else{var i=n.querySelector(".badge");n.removeChild(i)}this.hasBadge=t}},this.setLoading=function(e){this.isLoading!==e&&(this.isLoading=e,this.isLoading?(this.addClass("preset-menu-item--loading"),this.appendChild(this.loadingSpinner)):(this.removeClass("preset-menu-item--loading"),this.removeChild(this.loadingSpinner)))},this.handleCurrentImageThumbUpdated=function(){m&&BFN.PhotoEditorMenuModel.currentImageThumbImage&&e.setBackground(BFN.PhotoEditorMenuModel.currentImageThumbImage,!1)},this.handleProcessingThumbQueueUpdated=function(){e.setLoading(BFN.PresetMenuItemThumbManager.isProcessingQueue)},this.handleUserDataChanged=function(){e.updateBadge()}}.bind(e)()},BFN.UI.resizeTemplateModal=function(e){return function(){this.init=function(){this.initDefaultValues(),this.initAspectRatioDropdown(),this.initDimensionsScrubbers(),this.initCheckboxes(),this.initButtons()},this.initDefaultValues=function(){this.defaultAspectRatio="freeform",this.startSize=Math.min(3300,BFN.maxImageSize),this.smartResizeGuide=this.querySelector(".note")},this.initAspectRatioDropdown=function(){var e=this;this.aspectRatioDropdown=document.getElementById("resize_template_aspect_ratio"),this.presetSizes=BFN.DropDownData.resizeTemplateSizes,Pi(this.aspectRatioDropdown,{label:"template_size_presets",initialOptions:this.presetSizes,dropdownMaxHeight:260,onChange:function(t){var n=e.presetSizes.find(function(e){return e.value===t}).value.split("x").map(function(e){return parseInt(e)}).filter(Boolean);if(2===n.length){var i=f(n,2),r=i[0],a=i[1],o=Math.max(a,r);if(o>BFN.maxImageSize){var s=BFN.maxImageSize/o;a=Math.round(a*s),r=Math.round(r*s)}e.widthScrubber.minValue=e.heightScrubber.minValue=BFN.minImageSize,e.widthScrubber.maxValue=e.heightScrubber.maxValue=BFN.maxImageSize,e.widthScrubber.currentValue=r,e.heightScrubber.currentValue=a,e.updateLockedAspectRatio()}},isTemplateDropdown:!0})},this.initDimensionsScrubbers=function(){this.widthScrubber=document.getElementById("resize_template_width"),this.heightScrubber=document.getElementById("resize_template_height"),BFN.UI.scrubber(this.widthScrubber),BFN.UI.scrubber(this.heightScrubber),this.widthScrubber.unit=this.heightScrubber.unit="px",this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize,this.widthScrubber.addEventListener("change",this.switchAspectRatio.bind(this)),this.heightScrubber.addEventListener("change",this.switchAspectRatio.bind(this))},this.initCheckboxes=function(){var e=this;this.lockAspectRatioCheckbox=document.getElementById("resize_template_lock_aspect_ratio"),BFN.UI.checkboxItem(this.lockAspectRatioCheckbox,{controlID:"resize_template_lock_aspect_ratio",paramObject:{name:"lock_aspect_ratio"}}),this.lockAspectRatioCheckbox=document.getElementById("resize_template_lock_aspect_ratio"),this.lockAspectRatioCheckbox.addEventListener("change",function(){e.updateLockedAspectRatio()}),this.smartResizeCheckbox=document.getElementById("resize_template_smart_resize"),BFN.UI.checkboxItem(this.smartResizeCheckbox,{controlID:"resize_template_smart_resize",paramObject:{name:"smart_resize"}}),this.smartResizeCheckbox=document.getElementById("resize_template_smart_resize"),this.smartResizeCheckbox.addEventListener("change",function(){e.toggleSmartResizeGuide()})},this.initButtons=function(){var e=this;this.swapButton=this.querySelector(".resize-template__swap-dimensions"),this.cancelButton=this.querySelector(".resize-template__cancel"),this.resizeButton=this.querySelector(".resize-template__resize"),this.swapButton.addEventListener("click",function(){return e.swapDimensions()}),this.cancelButton.addEventListener("click",function(){return e.close()}),this.resizeButton.addEventListener("click",function(){return e.resizeProject()})},this.open=function(){var e=this;BeFunky.openModal(this,{onOpen:function(){var t=BFN.DesignerModel.projectVO.projectWidth||e.startSize,n=BFN.DesignerModel.projectVO.projectHeight||e.startSize;e.widthScrubber.minValue=e.heightScrubber.minValue=BFN.minImageSize,e.widthScrubber.maxValue=e.heightScrubber.maxValue=BFN.maxImageSize,e.widthScrubber.currentValue=t,e.heightScrubber.currentValue=n;var i="".concat(t," x ").concat(n),r=e.presetSizes.find(function(e){return e.value===i}),a=r?r.value:e.defaultAspectRatio;e.switchAspectRatio(a),e.updateLockedAspectRatio(),UITools.toggleControlItem("resize_template_lock_aspect_ratio",!0),e.lockAspectRatioCheckbox.checked=!0,UITools.toggleControlItem("resize_template_smart_resize",!0),e.smartResizeCheckbox.checked=!0,e.resizeButton.setStyles({display:"block"}),e.toggleSmartResizeGuide()},size:"small"})},this.close=function(){BeFunky.closeModal(this)},this.switchAspectRatio=function(e){this.lockAspectRatioCheckbox.checked&&(this.widthScrubber.changing&&(this.heightScrubber.currentValue=Math.round(this.widthScrubber.currentValue*this.lockedAspectRatio)),this.heightScrubber.changing&&(this.widthScrubber.currentValue=Math.round(this.heightScrubber.currentValue/this.lockedAspectRatio))),"string"!=typeof e&&(e=this.defaultAspectRatio),this.aspectRatioDropdown.selectedValue=e},this.updateLockedAspectRatio=function(){this.lockedAspectRatio=this.heightScrubber.currentValue/this.widthScrubber.currentValue,this.lockAspectRatioCheckbox.checked&&1!==this.lockedAspectRatio?this.lockedAspectRatio<1?(this.widthScrubber.minValue=Math.round(BFN.minImageSize/this.lockedAspectRatio),this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=BFN.maxImageSize,this.heightScrubber.maxValue=Math.round(BFN.maxImageSize*this.lockedAspectRatio)):this.lockedAspectRatio>1&&(this.widthScrubber.minValue=BFN.minImageSize,this.heightScrubber.minValue=Math.round(BFN.minImageSize*this.lockedAspectRatio),this.widthScrubber.maxValue=Math.round(BFN.maxImageSize/this.lockedAspectRatio),this.heightScrubber.maxValue=BFN.maxImageSize):(this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize)},this.swapDimensions=function(){this.widthScrubber.minValue=this.heightScrubber.minValue=BFN.minImageSize,this.widthScrubber.maxValue=this.heightScrubber.maxValue=BFN.maxImageSize;var e=this.heightScrubber.currentValue,t=this.widthScrubber.currentValue;this.widthScrubber.currentValue=e,this.heightScrubber.currentValue=t,this.updateLockedAspectRatio()},this.resizeProject=function(){var e=this;requestIdleCallback(function(){return e.close()}),BFN.DesignerCanvas.fitToFrameAfterResize=!0;var t=this.smartResizeCheckbox.checked;UITools.setToolValue("collage_customize","smart_resize",t),UITools.setToolValue("collage_customize","width",this.widthScrubber.currentValue),UITools.setToolValue("collage_customize","height",this.heightScrubber.currentValue),UITools.applyTool("collage_customize");var n=this.presetSizes.find(function(t){return t.value===e.aspectRatioDropdown.selectedValue});BFN.DesignerModel.projectVO.printDPI=n.dpi||300;var i=new BFN.UserActionVO;i.eventID="design_layout_resized",i.eventObject={preset:n.name,smartResize:t},i.track()},this.toggleSmartResizeGuide=function(){var e=this.smartResizeCheckbox.checked;this.smartResizeGuide.setStyles({display:"",visibility:e?"":"hidden"})},this.init()}.bind(e)()},BFN.UI.saveShareModal=function(e){return function(){var e=this;this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this;this._mode=null,this.modes={save:{computer:{heading:"save_to_computer",useFilename:!0},befunky:{heading:"save_to_befunky",useFilename:!0},google_drive:{heading:"save_to_google_drive",useFilename:!0},google_photos:{heading:"save_to_google_photos",useFilename:!0},dropbox:{heading:"save_to_drop_box",useFilename:!0},project:{heading:"save_as_project",useFilename:!0},complete:{showCloseButton:!0,promptUpgradeOnClose:!0}},share:{facebook:{heading:"share_on_facebook",useTextarea:!0},pinterest:{heading:"share_on_pinterest",useTextarea:!0},tumblr:{heading:"share_on_tumblr",useTextarea:!0},twitter:{heading:"share_on_twitter",useTextarea:!0}}},this.header=document.getElementById("sas_header"),this.leftColumn=this.querySelector(".save-image__left-column"),this.imagePreview=document.getElementById("sas_image_preview"),this.dimensions=document.getElementById("sas_project_dimensions"),this.textareaContainer=document.getElementById("sas_caption_area"),this.textarea=document.getElementById("sas_textarea"),this.filenameContainer=document.getElementById("sas_filename_area"),this.filenameInput=document.getElementById("sas_filename"),this.saveButton=document.getElementById("sas_save"),this.shareButton=document.getElementById("sas_share"),this.qualityGuide=document.getElementById("sas_quality_guide"),this.toggleLocationButtons=document.getElementById("sas_project_location"),this.watermarkControl=this.querySelector(".watermark-control"),this.applyCancelButtons=this.querySelector(".save-image__footer"),this.maxPreviewImageWidth=576,this.maxPreviewImageHeight=576,this.filenameInput.addEventListener("keyup",function(t){"Enter"===t.key&&13===t.keyCode&&("share"===e._mode[0]?e.shareButton.click():e.saveButton.click())})},this.updateAndOpen=function(){var t="share"===e._mode[0],n=e.modes[e._mode[0]][e._mode[1]],i=n.heading,r=n.useFilename,a=void 0!==r&&r,o=n.useTextarea,s=void 0!==o&&o,l=n.showCloseButton,u=void 0!==l&&l,c=n.promptUpgradeOnClose,h=void 0!==c&&c,d=BeFunky.isChromeOnIOS&&"save"===e._mode[0]&&"project"===e._mode[1];e.applyCancelButtons.setStyles({display:u?"none":""}),i?(e.header.setLang(i),e.header.setStyles({display:""})):e.header.setStyles({display:"none"}),v(e.classList).forEach(function(t){t.startsWith("save-image--")&&e.removeClass(t)}),e.addClass("save-image--".concat(e.mode[0],"-").concat(e.mode[1].replace(/_/g,"-"))),e.textareaContainer.setStyles({display:s?"block":"none"}),e.filenameContainer.setStyles({display:a?"block":"none"}),e.textarea.value="",e.saveButton.setStyles({display:t?"none":"block"}),e.shareButton.setStyles({display:t?"block":"none"}),d?(e.saveButton.setLang("save_to_befunky"),e.toggleLocationButtons.setStyles({display:"none"}),e.toggleLocationButtons.previousSibling.setStyles({display:"none"})):e.saveButton.setLang("save"),a?e.filenameInput.addClass("focus-initially"):s&&e.textarea.addClass("focus-initially"),BeFunky.openModal(e,{closeOnClickOutside:u,addCloseButton:u,onClose:function(){BFN.UploadSaveShareManager.saveAndShareModalDispose(),e.querySelectorAll(".focus-initially").removeClass("focus-initially"),h&&BFN.UploadSaveShareManager.showUpgradePromptAfterSaving()},onWindowResize:e.updateModalSize.bind(e),size:"large"})},this.getText=function(){var t,n=e.modes[e._mode[0]][e._mode[1]],i=n.useFilename,r=void 0!==i&&i,a=n.useTextarea,o=void 0!==a&&a;if(r&&(t=e.filenameInput),o&&(t=e.textarea),!t)return BeFunky.logError("All text inputs are hidden in save/share modal"),"";var s=t.value;return s=s.replace(/[\t\f\s\r\n]+/gim," ").replace(/\s{2,}/g,""),r&&(s=s.replace(/^[.\s]+/,"")),s.trim()},this.close=function(){BeFunky.closeModal(e)},this.updateModalSize=function(t){var n=t.availableHeight,i=t.availableWidth;n=Math.min(632,n),e.setStyles({maxHeight:"".concat(n,"px")});var r=i-320,a=Math.min(Math.max(447,n),Math.max(477,r+58));e.maxPreviewImageWidth=r-48,e.maxPreviewImageHeight=a-58-48,e.leftColumn.setStyles({width:"".concat(r,"px"),height:"".concat(a,"px")}),BFN.UploadSaveShareManager.previewCanvas=null,BFN.UploadSaveShareManager.updatePreviewImage()},this.setPreviewImageSrc=function(t,n,i,r){var a,o=e.imagePreview.parentElement,s=e.imagePreview.previousElementSibling,l=Math.min(n,e.maxPreviewImageWidth),u=Math.min(i,e.maxPreviewImageHeight);if(n<l&&i<u)a=n;else{var c=n/l,h=i/u;a=c>h?l:Math.floor(l*c/h)}o.setStyles({width:"".concat(a,"px")}),s.setStyles({paddingBottom:"".concat(100/(n/i),"%")}).toggleClass("save-image__preview-bg--checkered",r),e.imagePreview.setStyles({backgroundImage:'url("'.concat(t,'")'),backgroundSize:"".concat(a,"px"),visibility:""})},this.hidePreviewImage=function(){e.imagePreview.setStyles({visibility:"hidden"})},Object.defineProperty(this,"mode",{set:function(e){Array.isArray(e)&&2===e.length&&this.modes[e[0]]&&this.modes[e[0]][e[1]]?(this._mode=e,this.updateAndOpen()):BeFunky.logError("Invalid mode",e)},get:function(){return this._mode}}),this.init()}.bind(e)()},BFN.UI.scrollStopDispatcher=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this;this.awaitingPointerUp=!1;var n=function n(i){e.awaitingPointerUp=!1,document.removeEventListener(BeFunky.pointerup,n),document.removeEventListener("touchend",n),t()},i=function(t){e.awaitingPointerUp=!1,document.removeEventListener(BeFunky.pointerup,n),document.removeEventListener("touchend",n),e.debounceCallback()};this.addEventListener("scroll",function(){BeFunky.isPointerDown&&!e.awaitingPointerUp&&(e.awaitingPointerUp=!0,document.addEventListener(BeFunky.pointerup,n),document.addEventListener("touchend",i)),e.debounceCallback()})},this.debounceCallback=BeFunky.debounce(function(){this.awaitingPointerUp||t()},n),this.init()}.bind(e)()},BFN.UI.scrubber=function(e,t){return function(){var e=this;this.paramObject=t,this.innerHTML='\n        <div class="scrubber-unit"></div>\n        <input type="number" class="input scrubber__input" value="0" />\n        <button class="scrubber__btn scrubber__btn--plus" tabindex="-1">\n            <svg class="icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#chevron-icon"></use>\n            </svg>\n        </button>\n        <button class="scrubber__btn scrubber__btn--minus" tabindex="-1">\n            <svg class="icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#chevron-icon"></use>\n            </svg>\n        </button>\n      ',this.init=function(){this.initDefaultValues(),this.initDisplayElements()},this.initDefaultValues=function(){this._unit="",this._minValue=-2147483648,this._maxValue=2147483647,this._currentValue=0,this._divisor=2,this.arrowsAffectInputValue=!0,this.startValue=0,this.startPoint={},this.deltaPoint={},this.distanceThreshold=5,this.propagateInterval=0,this.propagateStep=0,this.propagating=!1,this.maxLength=-1,this.updating=!1,this.changing=!1,this.wasMixed=!1,this.changed=!1},this.initDisplayElements=function(){var e=this;this.unitHolder=this.querySelector(".scrubber-unit"),this.numberInput=this.querySelector("input");var t=this.querySelector(".scrubber__btn--plus"),n=this.querySelector(".scrubber__btn--minus");this.numberInput.addEventListener("wheel",this.handleNumberInputWheel),this.numberInput.addEventListener("keypress",this.handleNumberInputKeyPress),this.numberInput.addEventListener("change",this.handleNumberInputChange),this.numberInput.addEventListener("focus",this.handleNumberInputFocus),this.numberInput.addEventListener("blur",this.handleNumberInputBlur),t.addEventListener(BeFunky.pointerdown,this.handleIncreaseButtonPress),n.addEventListener(BeFunky.pointerdown,this.handleDecreaseButtonPress),t.oncontextmenu=function(){return!1},n.oncontextmenu=function(){return!1},this.numberInput.setAttribute("min",this._minValue),this.numberInput.setAttribute("max",this._maxValue),this.numberInput.value=this._currentValue,this.changeEvent=new Event("change"),BeFunky.isEdgeHTML&&this.numberInput.addEventListener("keyup",function(t){38!==t.keyCode&&40!==t.keyCode||e.handleNumberInputChange()})},this.propagate=function(){e.propagating&&(setTimeout(e.propagate,e.propagateInterval),50!==e.propagateInterval&&(e.propagateInterval=50),e.currentValue+=e.propagateStep,e.dispatchEvent(e.changeEvent))},this.handleNumberInputWheel=function(e){return e.preventDefault(),!1},this.handleNumberInputKeyPress=function(t){e.mixed&&(e.mixed=!1);if(![37,39,38,40,8,46].includes(t.keyCode)&&!t.ctrlKey&&!t.metaKey){var n="1234567890\r";e._minValue<0&&(n="-".concat(n));var i=String.fromCharCode(t.which);if(n.indexOf(i)<0)return t.preventDefault(),!1;if(!BeFunky.isFirefox){var r=window.getSelection().toString(),a=e.numberInput.value.toString();if(e.numberInput.value.length===e.maxLength&&-1!==e.maxLength&&"\r"!==i&&r!==a)return t.preventDefault(),!1}"\r"===i&&e.wasMixed&&!e.changed&&(e.changed=!0,e.dispatchEvent(e.changeEvent))}},this.handleNumberInputChange=function(t){e.mixed&&(e.mixed=!1),e.currentValue=parseInt(e.numberInput.value),t&&t.stopImmediatePropagation(),e.changing||(e.changed=!0,e.changing=!0,e.dispatchEvent(e.changeEvent),e.changing=!1)},this.handleNumberInputFocus=function(){if(e.wasMixed=!!e.mixed,e.changed=!1,e.mixed&&(e.mixed=!1),!BeFunky.isEdgeHTML){var t=e.numberInput;setTimeout(function(){document.activeElement===t&&t.select()},0)}},this.handleNumberInputBlur=function(){e.wasMixed&&!e.changed&&(e.mixed=!0)},this.handleIncreaseButtonPress=function(t){0===t.button&&(e.propagateStep=1,e.handleButtonPress(t))},this.handleDecreaseButtonPress=function(t){0===t.button&&(e.propagateStep=-1,e.handleButtonPress(t))},this.handleButtonPress=function(t){e.mixed&&(e.mixed=!1),document.addEventListener(BeFunky.pointerup,e.handleButtonRelease),document.addEventListener(BeFunky.pointermove,e.handleButtonDrag),e.startPoint.x=t.pageX,e.startPoint.y=t.pageY,e.propagateInterval=500,e.propagating=!0,e.updating=e.changing=!0,e.propagate()},this.handleButtonRelease=function(){document.removeEventListener(BeFunky.pointerup,e.handleButtonRelease),document.removeEventListener(BeFunky.pointermove,e.handleButtonDrag),e.propagateStep=0,e.propagating=!1,e.updating=e.changing=!1,e.dispatchEvent(e.changeEvent)},this.handleButtonDrag=function(t){e.deltaPoint.x=t.pageX-e.startPoint.x,e.deltaPoint.y=t.pageY-e.startPoint.y;var n=Math.sqrt(Math.pow(e.deltaPoint.x,2)+Math.pow(e.deltaPoint.y,2));if(e.propagating&&n>e.distanceThreshold&&(e.propagating=!1,e.startValue=e._currentValue,e.startPoint.x=t.pageX,e.startPoint.y=t.pageY),!e.propagating){var i=parseInt(e.startValue-e.deltaPoint.y/e._divisor);(i<e._minValue||i>e._maxValue)&&(e.startPoint.y=t.pageY,e.startValue=e._currentValue),e.arrowsAffectInputValue?e.currentValue=i:(i=isNaN(i)?0:i,i=Math.max(e._minValue,Math.min(e._maxValue,i)),e._currentValue=i),e.dispatchEvent(e.changeEvent)}},Object.defineProperty(this,"unit",{set:function(e){this._unit=e||"",this.unitHolder.textContent=this._unit},get:function(){return this._unit}}),Object.defineProperty(this,"minValue",{set:function(e){this._minValue=e,this._maxValue=Math.max(this._maxValue,this._minValue),this.numberInput.setAttribute("min",this._minValue),this.currentValue=this._currentValue},get:function(){return this._minValue}}),Object.defineProperty(this,"maxValue",{set:function(e){this._maxValue=e,this._minValue=Math.min(this._minValue,this._maxValue),this.numberInput.setAttribute("max",this._maxValue),this.currentValue=this._currentValue},get:function(){return this._maxValue}}),Object.defineProperty(this,"currentValue",{set:function(e){e=isNaN(e)?0:e;var t=Math.max(this._minValue,Math.min(this._maxValue,e));this._currentValue=t,this.numberInput.value=this._currentValue},get:function(){return this._currentValue}}),Object.defineProperty(this,"divisor",{set:function(e){this._divisor=Math.max(0,e||0)},get:function(){return this._divisor}}),Object.defineProperty(this,"mixed",{set:function(e){this.numberInput.value=e?"":this._currentValue,this.unitHolder.textContent=e?"—":this._unit},get:function(){return"—"===this.unitHolder.textContent}}),this.init()}.bind(e)()},BFN.UI.selectableList=function(e,t,n,i){return function(){this.addClass("selectable-list"),this.init=function(){this.initDefaultValues(),this.initFuse(),this.initHeader(),this.initList()},this.initDefaultValues=function(){this._selectedIDs=[],this._choices=[],this.listItems={}},this.initFuse=function(){var e=this,t={shouldSort:!0,includeScore:!0,threshold:.2,location:0,distance:100,maxPatternLength:32,minMatchCharLength:this.minValueLength,keys:["translatedName"]};this.setupFuse=function(){e.choices.forEach(function(e){return e.translatedName=BeFunky.LanguageManager.getString(e.name)}),e.fuse=new Km(e.choices,t)}},this.initHeader=function(){var e=this,n=document.createElement("div").addClass("selectable-list__header");n.innerHTML='\n            <svg class="icon selectable-list__search-icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#search-icon"></use>\n            </svg>\n            <input type="search" class="input selectable-list__input" placeholder="'.concat(BeFunky.LanguageManager.getString(t),'" data-lang="').concat(t,'">\n            <button class="button button--icon button--transparent selectable-list__clear-search">\n                <svg class="icon icon--14">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#cancel-icon"></use>\n                </svg>\n            </button>\n        '),this.appendChild(n),this.input=n.querySelector("input"),this.clearButton=n.querySelector("button");var i=BeFunky.debounce(this.handleTextUpdate.bind(this),25);this.input.addEventListener("change",i),this.input.addEventListener("keyup",i),this.clearButton.addEventListener("click",function(){e.input.value="",i()}),this.currentValue="",this.minValueLength=2,this.visibleChoices="all";var r=BeFunky.LanguageManager.language.app;BeFunky.LanguageManager.addLanguageUpdateListener(function(){e.choices.length&&r!==BeFunky.LanguageManager.language.app&&(r=BeFunky.LanguageManager.language.app,e.setupFuse(),e.displayVisibleChoices())})},this.initList=function(){this.list=document.createElement("div").addClass("selectable-list__list"),this.list.addClass("scrollable-content"),this.appendChild(this.list),this.noResultsItem=document.createElement("div").setClass("selectable-list__item selectable-list__item--no-results"),n&&(this.choices=n)},this.generateListItems=function(){var e=this;this.list.innerHTML="",this.listItems={},this.visibleChoices=this.getVisibleChoiceIDs();var t=document.createDocumentFragment();this.choices.forEach(function(n){var i=n.id,r=n.name,a=document.createElement("button").setClass("button button--grey-200 button--fullwidth button--has-icon selectable-list__item");"all"===e.visibleChoices||e.visibleChoices.includes(i)||a.setStyles({display:"none"}),a.innerHTML='\n                <string data-lang="'.concat(r,'">').concat(BeFunky.LanguageManager.getString(r),'</string>\n                <svg class="icon icon--14">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkmark-icon"></use>\n                </svg>\n            '),a.addEventListener("click",function(){return e.handleItemSelection(i,a)}),e.listItems[i]=a,t.appendChild(a)}),t.appendChild(this.noResultsItem),this.list.appendChild(t)},this.updateAllSelections=function(){var e=this;Object.entries(this.listItems).forEach(function(t){var n=f(t,2),i=n[0];n[1].toggleClass("button--selected",e._selectedIDs.includes(i))})},this.displayVisibleChoices=function(){var e=this,t=this.getVisibleChoiceIDs();if(!(this.visibleChoices===t||Array.isArray(this.visibleChoices)&&this.visibleChoices.length&&this.visibleChoices.isIdenticalTo(t))){this.visibleChoices=t;var n="all"===this.visibleChoices?function(){return!0}:function(t){return e.visibleChoices.includes(t)};Array.isArray(this.visibleChoices)&&!this.visibleChoices.length?(this.noResultsItem.innerHTML='\n                <img src="'.concat(BFN.imagesURL,'app/illustrations/no-search-results-sidebar.svg" alt="">\n                ').concat(BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'"<strong>'.concat(this.currentValue,'</strong>"')}),"\n            "),this.list.addClass("selectable-list__list--no-results")):requestAnimationFrame(function(){Object.entries(e.listItems).forEach(function(e){var t=f(e,2),i=t[0];t[1].setStyles({display:n(i)?"":"none"})}),e.list.removeClass("selectable-list__list--no-results")})}},this.getVisibleChoiceIDs=function(){return this.currentValue.length<this.minValueLength?"all":this.fuse.search(this.currentValue).filter(function(e){return e.score<.5}).map(function(e){return e.item.id})},this.handleTextUpdate=function(){var e=this.input.value;(e=e.toLowerCase().replace(/[^a-z0-9-_ \u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/g,"").trim())!==this.currentValue&&(this.currentValue=e,this.displayVisibleChoices())},this.handleItemSelection=function(e,t){var n=!t.hasClass("button--selected"),r=this._selectedIDs.includes(e);return n&&!r?(this._selectedIDs.splice(0,0,e),this.listItems[e].addClass("button--selected"),i(this._selectedIDs)):!n&&r?(this._selectedIDs.splice(this._selectedIDs.indexOf(e),1),this.listItems[e].removeClass("button--selected"),i(this._selectedIDs)):void 0},Object.defineProperty(this,"selectedIDs",{set:function(e){if(!this._selectedIDs.isIdenticalTo(e)){var t;if(this._selectedIDs.splice(0),e instanceof Array)(t=this._selectedIDs).push.apply(t,v(e));this.updateAllSelections()}},get:function(){return this._selectedIDs}}),Object.defineProperty(this,"choices",{set:function(e){if(Array.isArray(e)&&e.every(function(e){return e.id&&e.name})){if(!this._choices.isIdenticalTo(e)){this._choices=e.slice();var t=Object.keys(this._choices);this.selectedIDs=this.selectedIDs.filter(function(e){return t.includes(e)}),this.setupFuse(),this.generateListItems()}}else BeFunky.throwError("choices must be an array of objects with id and name properties")},get:function(){return this._choices}}),this.init()}.bind(e)()},BFN.UI.simpleSelector=function(e,t){return function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=v(this.querySelectorAll("."+t));e.forEach(function(t){t.dataset.container&&(t.container=document.getElementById(t.dataset.container)),t.addEventListener(BeFunky.pointerdown,function(t){e.forEach(function(e){e==t.target?(e.addClass("active"),e.container&&e.container.addClass("active")):(e.removeClass("active"),e.container&&e.container.removeClass("active"))})})})},this.init()}.bind(e)()},BFN.UI.slider=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(){var e=this;noUiSlider.create(this,t),this.addClass("bfn-slider"),this.addEventListener("focusout",function(){return e.removeClass("bfn-slider--active")}),this.init=function(){var e=this;this.handleElement=this.querySelector(".noUi-handle"),this.handleElement.slider=this,this.noUiSlider.on("slide",this.createUpdateHandler("slide")),this.noUiSlider.on("end",this.createUpdateHandler("end")),i&&this.noUiSlider.on("start",this.createUpdateHandler("start")),this.notches=this.querySelectorAll(".noUi-pips .noUi-marker.noUi-marker-large"),this.notches.length>0&&this.setNotchSliderStyles(this.notches,this.noUiSlider),this.lastEventValue=null,this.lastEventType="end",this.onUpdate=function(t,i){e.lastEventType=t,e.lastEventValue=i,n(t,i)}},this.update=function(t,n){var i={start:e.updateStart,slide:e.updateSlide,end:e.updateEnd};"slide"===t&&e.notches.length>0&&e.setNotchSliderStyles(e.notches,e.noUiSlider),i[t](n)},this.updateStart=function(t){"slide"!==e.lastEventType&&e.onUpdate("start",t)},this.updateSlide=BeFunky.throttle(function(t){"end"===e.lastEventType&&e.lastEventValue===t||e.onUpdate("slide",t)},BeFunky.isEdgeHTML?100:66),this.updateEnd=function(t){"end"===e.lastEventType&&e.lastEventValue===t||e.onUpdate("end",t)},this.createUpdateHandler=function(t){var n=BFN.StageModel.appStage;return function(i,r){if(e.update(t,i[r]),"end"===t){e.handleElement.focus();n.addEventListener("click",function t(){n.removeEventListener("click",t),document.activeElement===e.handleElement&&e.handleElement.blur()})}"slide"===t||"start"===t?e.addClass("bfn-slider--active"):"end"===t&&e.removeClass("bfn-slider--active")}},this.setNotchSliderStyles=function(e,t){var n=t.get();e.forEach(function(e,t){var i=1*n;return e.removeClass("notch--active"),e.removeClass("notch--invert"),!(t+1>i)&&(t+1===i?(e.addClass("notch--active"),!1):void e.addClass("notch--invert"))})},this.init()}.bind(e)()},BFN.UI.sliderItem=function(e,t){var n=t.toolID,i=t.paramID,r=t.controlID,a=t.paramObject,o=a.name,s=a.multiplier,l=void 0===s?1:s,u=a.unit,c=void 0===u?"":u,h=a.valueElementIDs,d=void 0===h?[]:h;return function(){var t=this,a=document.createElement("div"),s="px"===c?"slider-label__value--".concat(c):"",u=c?"":"slider-label__value--centered";return a.innerHTML='\n        <div class="slider-label">\n            <label class="control-item-label" data-lang="'.concat(o,'">\n                ').concat(BeFunky.LanguageManager.getString(o),'\n            </label>\n            <div class="slider-label__unit">').concat(c,'</div>\n            <input type="number" class="',"input input--sm slider__input slider-label__value ".concat(s," ").concat(u),'" />\n        </div>\n        <div id="').concat(r,'"></div>\n    '),this.parentElement&&this.parentElement.replaceChild(a,this),this.init=function(){this._isMixed=!1,this.slider=UITools.registerSliderControl(r,a.lastElementChild),this.slider.updateValueLabel=this.updateValueLabel.bind(this),Object.defineProperty(this.slider,"isMixed",{set:function(e){this._isMixed=!!e,this.updateValueLabel()}.bind(this),get:function(){return this._isMixed}.bind(this)}),this.valueLabel=a.querySelector("input"),this.valueUnit=a.querySelector(".slider-label__unit"),this.labelUpdatePending=!1,this.valueLabel&&(this.valueLabel.addEventListener("keydown",function(e){if(["Enter","Backspace","ArrowRight","ArrowLeft"].includes(e.key))return!1;/^[-0-9\n]+$/.test(e.key)?this.previousElementSibling.setStyles({display:"none"}):e.preventDefault()}),this.valueLabel.addEventListener("change",function(t){var n=e.slider,i=n.noUiSlider.options.range,r=i.max,a=i.min,o=t.target.value;if(this.previousElementSibling.setStyles({display:"block"}),1===r&&(r*=l),-1===a&&(a*=l),o>r&&(o=r),o<a&&(o=a),o=l>1?o/100:o,n){var s=n.noUiSlider.get();if(!o)return void(t.target.value=Math.round(s));if(s===o)return;n.noUiSlider.set(o),n.update("end",o)}else t.target.value=Math.round(o*l)})),this.updateValueLabel(),UITools.addEventListener(UIToolsEvents.TOOL_PARAM_UPDATED.type,this.handleToolParamUpdated)},this.updateValueLabel=function(){t.labelUpdatePending||(t.labelUpdatePending=!0,requestAnimationFrame(function(){var e=UITools.getToolValue(n,i),r=Math.round(e*l);t.valueLabel.value=t._isMixed?"-":"".concat(r),t.labelUpdatePending=!1,d.forEach(function(e){var t=document.getElementById(e);t&&(t.textContent=r)})}))},this.handleToolParamUpdated=function(e){e.data.toolID===n&&e.data.paramID===i&&(t._isMixed=!1,t.updateValueLabel())},this.init(),{container:a,slider:this.slider}}.bind(e)()},BFN.UI.sortableList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.handleTargetIndexUpdated,i=t.handleOrderUpdated;return function(){var t="sortable-list__item",r="drag-over",a="drag-over-down",o="drag-over-up",s="no-pointer",l={targetIndexUpdated:new Event("TARGET_INDEX_UPDATED"),listOrderUpdated:new Event("LIST_ORDER_UPDATED")};this.init=function(){this.initDefaultValues(),this.refreshList()},this.initDefaultValues=function(){this.addClass("sortable-list"),this.isSortableList=!0,e.setStyles({touchAction:"none"}),e.parentNode.setStyles({touchAction:"none"}),this._listItems=[],this._listItemH=0,this._dragging=!1,this._draggedItem=null,this._draggedItemIndex=null,this._targetIndex=null,this._hoveredItem=null,this._hoveredItemIndex=null,this._hoveredItemSide=null,this._scrollable=!1,this._scrollItem=null,this._scrollHeight=0,this._scrollRect=null,this.handleDocumentKeyDownBind=this.handleDocumentKeyDown.bind(this)},this.refreshList=function(){var n,i=this;this._listItems.splice(0),(n=this._listItems).push.apply(n,v(e.querySelectorAll(".".concat(t)))),!this.hasOwnProperty("paddingTop")&&this._listItems.length&&(this.paddingTop=this._listItems[0].offsetTop),this._listItems.forEach(function(e){e.hasClass(t)&&i.makeListItemSortable(e)})},this.makeListItemSortable=function(e){e.isSortable||(BFN.UI.sortableListItem(e),e.addEventListener("dragpress",this.handleListItemDragPress.bind(this)),e.addEventListener("dragstart",this.handleListItemDragStart.bind(this)),e.addEventListener("drag",this.handleListItemDrag.bind(this)),e.addEventListener("dragend",this.handleListItemDragEnd.bind(this)))},this.updateScrollParams=function(){var t=window.getComputedStyle(e);this._scrollable="scroll"===t.getPropertyValue("overflow-y")||"auto"===t.getPropertyValue("overflow-y"),this._scrollItem=e,this._scrollable||(t=window.getComputedStyle(e.parentNode),this._scrollable="scroll"===t.getPropertyValue("overflow-y")||"auto"===t.getPropertyValue("overflow-y"),this._scrollItem=this._scrollable?e.parentNode:e),this._scrollHeight=this._scrollItem.scrollHeight,this._scrollRect=this._scrollItem.getBoundingClientRect(),this._scrollRect=new BFN.Rectangle(this._scrollRect.left,this._scrollRect.top,this._scrollRect.width,this._scrollRect.height),this._listItems.length>1?this._listItemH=Math.abs(this._listItems[1].offsetTop-this._listItems[0].offsetTop):this._listItems.length&&(this._listItemH=this._listItems[0].offsetHeight)},this.updateDragOverClasses=function(e,t){var n=this,i=function(e,t){switch(e.addClass(r),t){case"top":e.addClass(o);break;case"bottom":e.addClass(a)}},s=null;this._listItems.forEach(function(l,u){if(l!==s&&function(e){e.removeClass(r),e.removeClass(a),e.removeClass(o)}(l),u===e)switch(t){case"top":i(l,"top");break;case"bottom":u<n._listItems.length-1?(s=n._listItems[u+1],i(s,"top")):i(l,"bottom")}})},this.ensureItemVisibility=function(e){var t=this.hasOwnProperty("paddingTop")?this.paddingTop:0,n=e.offsetTop-t,i=e.offsetHeight;n<this._scrollItem.scrollTop?this._scrollItem.scrollTop=n:n+i>this._scrollItem.scrollTop+this._scrollItem.offsetHeight&&(this._scrollItem.scrollTop=Math.max(0,n+i-this._scrollItem.offsetHeight))},this.handleListItemDragPress=function(){this.updateScrollParams()},this.handleListItemDragStart=function(e){this._dragging=!0,this._draggedItem=e.target,this._draggedItem.addClass("dragging"),this._draggedItemIndex=this._listItems.indexOf(this._draggedItem),this._draggedItem.scrollDrag?this.scrollTopStart=this._scrollItem.scrollTop:(this._hoveredItem=null,this._hoveredItemIndex=null,this._hoveredItemSide=null,this.addClass("sortable-list--dragging"),this.addClass(s),BFN.isSortableListDragActive=!0,document.addEventListener("keydown",this.handleDocumentKeyDownBind,!0))},this.handleListItemDrag=function(e){if(this._draggedItem.scrollDrag)this._scrollable&&(this._scrollItem.scrollTop=Math.max(0,Math.min(this._scrollHeight-this._scrollRect.height,this.scrollTopStart+(this._draggedItem.pointerDownPoint.y-e.pageY))));else{var t=e.pageY-this._scrollRect.y;if(this._scrollable){var i=0;t<0?i=-Math.max(1,Math.min(10,Math.round(Math.abs(t)/10))):t>this._scrollRect.height&&(i=Math.max(1,Math.min(10,Math.round((t-this._scrollRect.height)/10)))),i&&(this._scrollItem.scrollTop=Math.max(0,Math.min(this._scrollHeight-this._scrollRect.height,this._scrollItem.scrollTop+i)))}t=Math.max(0,Math.min(this._scrollRect.height,t));var r=Math.floor((this._scrollItem.scrollTop+t)/this._listItemH);if(r>=0&&r<this._listItems.length){var a,o=this._listItems[r],s=t<r*this._listItemH-this._scrollItem.scrollTop+this._listItemH/2?"top":"bottom";if(o!==this._hoveredItem||this._hoveredItemIndex!==r||s!==this._hoveredItemSide)this._hoveredItem=o,this._hoveredItemIndex=r,this._hoveredItemSide=s,this.updateDragOverClasses(this._hoveredItemIndex,this._hoveredItemSide),a=this._hoveredItemIndex===this._draggedItemIndex||this._draggedItemIndex===this._hoveredItemIndex-1&&"top"===this._hoveredItemSide||this._draggedItemIndex===this._hoveredItemIndex+1&&"bottom"===this._hoveredItemSide?this._draggedItemIndex:this._hoveredItemIndex+("bottom"===this._hoveredItemSide?1:0)-(this._draggedItemIndex<this._hoveredItemIndex?1:0),(a=Math.max(0,Math.min(a,this._listItems.length-1)))!==this._targetIndex&&(this._targetIndex=a,n?n(this._draggedItem,this._draggedItemIndex,this._targetIndex):this.dispatchEvent(l.targetIndexUpdated))}}},this.handleListItemDragEnd=function(){var n=this;if(this._draggedItem.scrollDrag)this.completeDrag();else if(this._dragging&&this._targetIndex!==this._draggedItemIndex){var r,a=this._targetIndex;if(i)r=i(this._draggedItem,this._draggedItemIndex,this._targetIndex);else{switch(this._hoveredItemSide){case"top":e.insertBefore(this._draggedItem,this._hoveredItem);break;case"bottom":e.insertBefore(this._draggedItem,this._hoveredItem.nextSibling||null)}r=Promise.resolve()}r.then(function(){var r;n._listItems.splice(0),(r=n._listItems).push.apply(r,v(e.querySelectorAll(".".concat(t)))),i||n.dispatchEvent(l.listOrderUpdated);var o=n._listItems[a];void 0!==o?(n.ensureItemVisibility(o),o.addClass("dropped"),setTimeout(function(){o.removeClass("dropped")},220),n.completeDrag()):n.completeDrag()})}else this.completeDrag()},this.handleDocumentKeyDown=function(e){27===e.keyCode&&this._dragging&&this._draggedItem&&(this._dragging=!1,this._draggedItem.stopDrag(),this._targetIndex!==this._draggedItemIndex&&(this._targetIndex=this._draggedItemIndex,this.dispatchEvent(l.targetIndexUpdated)),e.stopImmediatePropagation(),this.completeDrag())},this.completeDrag=function(){this._dragging=!1,this._draggedItem.removeClass("dragging"),this._draggedItem=null,this._draggedItemIndex=null,this._targetIndex=null,this._hoveredItem=null,this._hoveredItemIndex=null,this._hoveredItemSide=null,this.removeClass("sortable-list--dragging"),this.removeClass(s),this.updateDragOverClasses(),BFN.isSortableListDragActive=!1,document.removeEventListener("keydown",this.handleDocumentKeyDownBind,!0)},Object.defineProperty(this,"draggedItem",{get:function(){return this._draggedItem}}),Object.defineProperty(this,"targetIndex",{get:function(){return this._targetIndex}}),Object.defineProperty(this,"listItems",{get:function(){return this._listItems}}),this.init()}.bind(e)()},BFN.UI.sortableListItem=function(e){return function(){this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.isSortable=!0,this.draggingEnabled=!0,this.dragging=!1,this.hovering=!1,this.dragThreshold=10,this.scrollDrag=!1,this.pointerType=null,this.pointerDownPoint=null,this.pointerPosition={x:0,y:0},this.pointerOffset={x:0,y:0},this.pointerDownTime=0,this.handlePointerMoveBind=this.handlePointerMove.bind(this),this.handlePointerUpBind=this.handlePointerUp.bind(this),this.handlePointerOverBind=this.handlePointerOver.bind(this),this.handlePointerOutBind=this.handlePointerOut.bind(this),this.addEventListener(BeFunky.pointerdown,this.handlePointerDown.bind(this),!0)},this.activate=function(){this.addEventListener(BeFunky.pointerover,this.handlePointerOverBind,!0),this.addEventListener(BeFunky.pointerout,this.handlePointerOutBind,!0)},this.deactivate=function(){this.hovering=!1,this.removeEventListener(BeFunky.pointerover,this.handlePointerOverBind,!0),this.removeEventListener(BeFunky.pointerout,this.handlePointerOutBind,!0)},this.stopDrag=function(){this.dragging&&(this.dragging=!1,BFN.DragScreen.hide(),this.handlePointerUp())},this.dragInterval=function(){this.dragging&&(this.dispatchEvent(this.getMouseEvent("drag")),setTimeout(this.dragInterval.bind(this),BFN.frameInterval))},this.overInterval=function(){this.hovering&&(this.pointerPosition.x===BeFunky.globalPointerCoords.x&&this.pointerPosition.y===BeFunky.globalPointerCoords.y||(Object.assign(this.pointerPosition,BeFunky.globalPointerCoords),this.dispatchEvent(this.getMouseEvent("dragover"))),setTimeout(this.overInterval.bind(this),BFN.frameInterval))},this.getMouseEvent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=new Event(e);return t.pageX=BeFunky.globalPointerCoords.x,t.pageY=BeFunky.globalPointerCoords.y,t},this.handlePointerDown=function(e){2!==e.button&&this.draggingEnabled&&(this.nextElementSibling||this.previousElementSibling)&&(this.pointerType=e.pointerType,this.pointerDownPoint={x:e.pageX,y:e.pageY},this.pointerDownTime=Date.now(),this.pointerOffset={x:e.offsetX,y:e.offsetY},document.addEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0),this.dispatchEvent(this.getMouseEvent("dragpress")))},this.handlePointerMove=function(e){var t=e.pageX-this.pointerDownPoint.x,n=e.pageY-this.pointerDownPoint.y,i=Math.sqrt(Math.pow(t,2)+Math.pow(n,2)),r=Date.now()-this.pointerDownTime;if(!this.dragging)if("touch"===this.pointerType&&Math.abs(n)>=this.dragThreshold&&r<500)this.dragging=!0,this.scrollDrag=!0,this.pointerDownPoint={x:e.pageX,y:e.pageY},this.dispatchEvent(this.getMouseEvent("dragstart"));else if(i>this.dragThreshold){this.dragging=!0,this.scrollDrag=!1,this.dispatchEvent(this.getMouseEvent("dragstart"));var a=this.getBoundingClientRect(),o=this.cloneNode(!0).setStyles({pointerEvents:"none",width:"".concat(a.width,"px"),height:"".concat(a.height,"px")}),s=document.createElement("div").setStyles({pointerEvents:"none",overflow:"visible",display:"block",position:"absolute",visibility:"visible",boxShadow:"none",left:0,top:0,width:"".concat(a.width,"px"),height:"".concat(a.height,"px")});s.appendChild(o);var l=Math.max(4,Math.min(this.pointerOffset.x,a.width-4)),u=Math.max(4,Math.min(this.pointerOffset.y,a.height-4));s.setStyles({left:"".concat(-l,"px"),top:"".concat(-u,"px")}),BFN.DragScreen.showNode(s)}this.dragging&&(document.removeEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),this.dragInterval())},this.handlePointerUp=function(e){this.dragging&&e&&(e.target&&e.target.isSortable&&e.target.dispatchEvent(this.getMouseEvent("drop")),this.dispatchEvent(this.getMouseEvent("dragend"))),this.dragging=!1,this.hovering=!1,document.removeEventListener(BeFunky.pointermove,this.handlePointerMoveBind,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpBind,!0)},this.handlePointerOver=function(e){this.hovering=!0,this.dispatchEvent(this.getMouseEvent("dragenter")),this.overInterval()},this.handlePointerOut=function(e){this.hovering=!1,this.dispatchEvent(this.getMouseEvent("dragleave"))},this.init()}.bind(e)()};var B_=BeFunky.lit.html;function F_(){var e=g(['<div class="brush_menu_container"></div>']);return F_=function(){return e},e}function E_(){var e=g(['<div class="generic_menu_container"></div>']);return E_=function(){return e},e}BFN.UI.stockSearchModal=function(e){return function(){var e=this;function t(e){var t=e.id,i=e.author,r=e.authorURL;if(!i||!r)return"";var a={pixabay:{name:"Pixabay",url:"https://pixabay.com/?utm_source=befunky&utm_medium=referral"},pexels:{name:"Pexels",url:"https://pexels.com/?utm_source=befunky&utm_medium=referral"}}[BFN.getImageType(t)],o=a.name,s=a.url;return B_(C_(),r,n,i,s,n,o)}function n(e){(parseFloat(getComputedStyle(e.target.parentElement).opacity)||0)<1?e.preventDefault():e.stopPropagation()}this.init=function(){this.initDefaultValues(),this.initSearch(),this.initTags(),this.initGallery()},this.initDefaultValues=function(){this.defaultSearch="featured",this.rightPanel=this.querySelector(".stock-search__right-panel"),this.rightPanelScroller=this.querySelector(".scrollable-content--modal-right-panel"),this.resultsHeader=this.querySelector(".stock-search__results-header"),this.resultsHeading=this.querySelector(".stock-search__results-heading"),this.clearResultsButton=this.querySelector(".stock-search__clear-results"),this.clearResultsButton.addEventListener("click",this.handleClearResults),this.modalMaxWidth=1600,this.galleryMaxWidth=this.modalMaxWidth-272-48,this.selectedImageIDs=BFN.ImageLibraryManager.selectedMenuImageVOs.filter(function(e){return["pixabay","pexels"].includes(BFN.getImageType(e.id))}).map(function(e){return e.id}),document.querySelector(".stock-search__attribution").setLang("stock_image_services",{pexels:'<a href="https://pexels.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Pexels</a>',pixabay:'<a href="https://pixabay.com/?utm_source=befunky&utm_medium=referral" target="_blank" rel="noopener">Pixabay</a>'})},this.initSearch=function(){var e=this;this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.previousSearchQuery="",this.previousSearchPage="",this.clearButton.addEventListener("click",function(){return e.searchInput.focus()}),this.searchForm.addEventListener("submit",this.handleSearch)},this.initTags=function(){var e=this;this.tagsContainer=document.querySelector(".stock-search__tags"),this.tagsContainer.addEventListener("click",function(t){var n=t.target;n&&n.hasClass("stock-search__tag")&&(e.searchInput.value=n.textContent,e.handleSearch())});this.tagButtons={};var t=document.createDocumentFragment();Object.entries({wedding:"Wedding",food:"Food",portrait:"Portrait",landscapes:"Landscapes",travel:"Travel",fine_art:"Fine Art",nature:"Nature",sky:"Sky",water:"Water",people:"People",sunset:"Sunset",dogs:"Dogs",cats:"Cats"}).forEach(function(n){var i=f(n,2),r=i[0],a=i[1],o=document.createElement("button");o.className="stock-search__tag chip",o.textContent=a,e.tagButtons[r]={button:o,name:a},t.appendChild(o)}),this.tagsContainer.appendChild(t)},this.initGallery=function(){var e=this;this.stockGallery=document.querySelector(".stock-search__results-gallery"),this.stockGallery.onSelectItem=function(t,n){return"UPLOAD_MENU"===BFN.ImageLibraryManager.mode?(e.close(),void BFN.PhotoEditorModel.confirmEditorLoadImage(function(){BFN.ImageLibraryManager.addImageToPhotoEditorCanvas(t)},function(){BFN.ImageLibraryManager.mode="UPLOAD_MENU",e.open()})):BFN.ImageLibraryManager.handleImageSelection(t,n)},this.stockGallery.rowHeight=215,this.stockGallery.gutterWidth=8,this.stockGallery.borderWidth=1,this.stockGallery.extendItemTemplate=t,this.stockGallery.addItemClass=function(e){var t=e.author,n=e.authorURL;return t&&n?"gallery__item--has-content":""},this.stockGallery.showSelectedStyles="IMAGE_MANAGER"===BFN.ImageLibraryManager.mode,this.loadSearchResults(this.defaultSearch),this.loadNextPageOnScroll=null;var n=BeFunky.listenForScroll(this.rightPanelScroller,this.handleScroll.bind(this)).recalculateScrollPosition;this.recalculateScrollPosition=n,this.updateGalleryItemSelectionState()},this.open=function(){var e=this;BeFunky.openModal(this,{onOpen:function(){BeFunky.isAndroid||e.searchInput.focus()},onClose:function(){BFN.ImageLibraryManager.mode="IMAGE_MANAGER"},onWindowResize:this.updateModalSize.bind(this),size:"xxl"})},this.close=function(){BeFunky.closeModal(this)},this.selectGalleryItem=function(e){this.selectedImageIDs=[].concat(v(this.selectedImageIDs),[e]).unique(),this.updateGalleryItemSelectionState()},this.deselectGalleryItem=function(e){this.selectedImageIDs=this.selectedImageIDs.filter(function(t){return t!==e}),this.updateGalleryItemSelectionState()},this.updateGalleryItemSelectionState=function(){this.stockGallery.selectedImageIDs="UPLOAD_MENU"===BFN.ImageLibraryManager.mode?void 0:this.selectedImageIDs.slice()},this.loadSearchResults=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!(this.previousSearchQuery===e&&n<=this.previousSearchPage)){this.previousSearchQuery=e,this.previousSearchPage=n,this.loadNextPageOnScroll=null,1===n&&(this.stockGallery.images=[],this.rightPanelScroller.scrollTop=0),this.stockGallery.message="",this.stockGallery.isLoading=!0;var i=e===this.defaultSearch;this.resultsHeader.setStyles({display:""}),i?this.resultsHeading.setLang("featured_images"):this.resultsHeading.setLang("search_results_for",{query:"<strong>".concat(BeFunky.escapeHTML(e),"</strong>")}),this.toggleInteractivity(!1),this.clearResultsButton.setStyles({visibility:"hidden"}),1===n&&this.selectRelatedTag(e),BFN.ImageLibraryService.getStockImages(n,e,function(r){var a=r.data,o=r.totalPages,s=r.error;if(t.stockGallery.isLoading=!1,t.toggleInteractivity(!0),i||t.clearResultsButton.setStyles({visibility:""}),s)return BeFunky.logError("Unable to fetch images",s),void("no_results"===s?(t.resultsHeader.setStyles({display:"none"}),t.stockGallery.message="",t.stockGallery.emptyState={imageUrl:"".concat(BFN.imagesURL,"app/illustrations/no-search-results-canvas.svg"),text:BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'"<strong>'.concat(e,'</strong>"')})}):(t.stockGallery.message={isError:!0,text:BeFunky.failureReason(s),buttonText:"try_again",buttonAction:function(){return t.loadSearchResults(e,n)}},t.previousSearchPage=t.previousSearchPage-1));t.stockGallery.images=[].concat(v(t.stockGallery.images),v(a)),t.stockGallery.message="",t.recalculateScrollPosition();var l=function(){return t.loadSearchResults(e,n+1)};n>=o||(n<=2?t.loadNextPageOnScroll=l:t.stockGallery.message={buttonText:"load_more",buttonAction:l})})}},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearResultsButton.disabled=!e,this.tagsContainer.setStyles({pointerEvents:e?"":"none"})},this.selectRelatedTag=function(e){Object.values(this.tagButtons).forEach(function(t){var n=t.name;t.button.toggleClass("chip--selected",n.toLowerCase()===e.toLowerCase())})},this.updateModalSize=function(t){var n=t.availableWidth,i=e.galleryMaxWidth+(n-e.modalMaxWidth);e.rightPanelScroller.style.setProperty("--scrollable-content-width",i),e.stockGallery.currentWidth=i,e.recalculateScrollPosition()},this.handleSearch=function(t){t&&t.preventDefault();var n=e.searchInput.value.replace(/[`~!@#$%^&*()_|+=?;:'",.<>{}\[\]\\\/]/gi," ").replace(/ {2,}/g," ").trim();e.searchInput.value=n,n&&e.loadSearchResults(n)},this.handleClearResults=function(){e.loadSearchResults(e.defaultSearch),e.searchInput.value="",e.searchInput.focus()},this.handleScroll=function(t){var n=t.scrollHeight,i=t.offsetHeight,r=t.scrollTop;if(e.stockGallery.images.length&&(e.stockGallery.viewport=[r,r+i],e.loadNextPageOnScroll)){n-i-r<=800&&e.loadNextPageOnScroll()}},this.init()}.bind(e)()};var P_=BeFunky.lit.elem;function k_(){var e=g(['\n            <video class="webcam__video" autoplay>\n                <string data-lang="video_stream_not_available">',"</string>\n            </video>"]);return k_=function(){return e},e}function N_(){var e=g(["<div class="," style=",">","</div>"]);return N_=function(){return e},e}function M_(){var e=g(['<span class="tabs__underline" style=',"></span>"]);return M_=function(){return e},e}function D_(){var e=g(["\n        <button @click="," class="," .tabName=",'>\n            <span class="tabs__button-text">\n                <string>',"</string>\n                ","\n                ","\n            </span>\n        </button>"]);return D_=function(){return e},e}function w_(){var e=g(['\n            <nav class="tabs__nav">\n                ','\n            </nav>\n            <div class="tabs__panels" style=',">\n                ","\n            </div>\n        "]);return w_=function(){return e},e}BFN.UI.toolMenuAdjustAndPaint=function(e,t){var n=t.toolID,i=t.menuName,r=t.controlData,a=t.tutorialLink,o=void 0!==a&&a,s=t.tutorialName,l=void 0!==s&&s,u=t.tabIDs,c=void 0===u?["adjust","erase"]:u,h=t.adjustHelpClueID,d=void 0===h?"":h,m=t.eraseHelpClueID,p=void 0===m?"erase_mode":m;return function(){this.addClass("tool-menu");var e=o&&l?'\n        <div class="tutorial">\n            <svg class="icon icon--18 tutorial__icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#info-icon"></use>\n            </svg>\n            <p>\n                <string class="tutorial__text" data-lang="need_help">'.concat(BeFunky.LanguageManager.getString("need_help"),'</string>\n                <a href="').concat(o,'" data-bfntrack="CREATE|HELP|').concat(l,'" class="tutorial__link" target="_blank">\n                    <string data-lang="tutorial_link">').concat(BeFunky.LanguageManager.getString("tutorial_link"),"</string>\n                </a>\n            </p>\n        </div>\n    "):"";this.innerHTML='\n        <panel-header lang-id="'.concat(i||n,'" modifier="tertiary" clue-id="').concat(p,'" buttons="back"></panel-header>\n        <div class="panel-header"></div>\n        <div class="popover-placeholder"></div>\n        <div class="scrollable-content">\n            <div class="control-item-set">\n                <tabbed-layout></tabbed-layout>\n                <div class="control-item control-item-bottom">\n                    <div class="apply_cancel_menu_container"></div>\n                </div>\n            </div>\n            ').concat(e,"\n        </div>\n    "),this.init=function(){this.initDefaultValues(),this.initPanelHeader(),this.initTabbedLayout(),this.initAdjustControls()},this.initDefaultValues=function(){this.panelHeader=this.querySelector("panel-header"),this.helpCluePlaceholder=this.querySelector(".popover-placeholder"),this.tabbedLayout=this.querySelector("tabbed-layout"),this.tabbedLayoutReady=new Promise(function(e){Promise.resolve().then(function(){return Promise.resolve().then(e)})}),this.genericMenuContainer=P_(E_()),this.brushMenuContainer=P_(F_())},this.initPanelHeader=function(){var e=this,t=i||n;BFN.BatchToolManager.batchEditToolIDs.includes(t)&&this.tabbedLayoutReady.then(function(){BFN.BatchIconManager.registerPanelHeader(e.panelHeader,t)}),this.panelHeader.addEventListener("BACK",function(){UIToggler.cancelActiveEditorTool()})},this.initTabbedLayout=function(){var e=this;this.tabID1=c&&c[0]?c[0]:"adjust",this.tabID2=c&&c[1]?c[1]:"erase",this.tabbedLayout.tabs={[this.tabID1]:this.genericMenuContainer,[this.tabID2]:this.brushMenuContainer},this.tabbedLayout.addEventListener("TAB_CHANGE",function(){var t=e.tabbedLayout.activeTab===e.tabID2;d&&(e.panelHeader.buttonPosition=t?{help:"right1"}:{help:"right2"}),e.updateImagePainter(),e.panelHeader.toggleButtons({help:Boolean(t||d)}),e.panelHeader.clueId=e.panelHeader.clueId===p?d:p,BFN.HelpClueManager.toggle(p,t,{renderOptions:{side:"left",positionFactor:0,left:"260px",top:"-22px",container:e.helpCluePlaceholder},force:!1}),d&&BFN.HelpClueManager.toggle(d,!t,{renderOptions:{side:"left",positionFactor:0,left:"260px",top:"-22px",container:e.helpCluePlaceholder},force:!1})})},this.initAdjustControls=function(){var e=this,t=[];for(var i in r){var a=i.replace("".concat(n,"_"),""),o=r[i];t.push({toolID:n,controlID:i,controlName:a,controlParamObject:Object.assign({},o)})}this.tabbedLayoutReady.then(function(){UITools.setupControlItems(t,e.tabbedLayout.querySelector(".tabs__panel")),Object.keys(r).forEach(function(e){return UITools.registerControl(e)})})},this.resetTabbedLayout=function(){var e=this;this.tabbedLayoutReady.then(function(){e.tabbedLayout.activeTab===e.tabbedLayout.tabNames[1]?e.tabbedLayout.activeTab="":e.updateImagePainter()})},this.updateImagePainter=function(){var e=this.tabbedLayout.activeTab===this.tabID2;BFN.ImagePainterUndoManager.currentImagePainter&&(BFN.ImagePainterUndoManager.currentImagePainter.paintingEnabled=e,e&&BFN.ImagePainterUndoManager.currentImagePainter.brushSizeChanged&&BFN.ImagePainterUndoManager.currentImagePainter.updateBrush())},this.init()}.bind(e)()},BFN.UI.toolMenuTouchupPaint=function(e,t){var n=t.toolID,i=t.controlData,r=t.tutorialLink,a=void 0!==r&&r,o=t.tutorialName,s=void 0!==o&&o,l=t.helpClueID;return function(){this.addClass("tool-menu");var e=a&&s?'\n        <div class="tutorial">\n            <svg class="icon icon--18 tutorial__icon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#info-icon"></use>\n            </svg>\n            <p>\n                <string class="tutorial__text" data-lang="need_help">'.concat(BeFunky.LanguageManager.getString("need_help"),'</string>\n                <a href="').concat(a,'" data-bfntrack="CREATE|HELP|').concat(s,'" class="tutorial__link" target="_blank">\n                    <string data-lang="tutorial_link">').concat(BeFunky.LanguageManager.getString("tutorial_link"),"</string>\n                </a>\n            </p>\n        </div>\n    "):"",t=l?"back,help":"back";this.innerHTML='\n        <panel-header lang-id="'.concat(n,'" modifier="tertiary" clue-id="').concat(l||"",'" buttons="').concat(t,'"></panel-header>\n        <div class="scrollable-content">\n            <div class="control-item-set">\n                <div class="generic_menu_container"></div>\n                <div class="control_container"></div>\n                <div class="brush_menu_container"></div>\n                <div class="control-item control-item-bottom">\n                    <div class="apply_cancel_menu_container"></div>\n                </div>\n            </div>\n            ').concat(e,"\n        </div>\n    "),this.init=function(){this.initDefaultValues(),this.initPanelHeader(),this.initControls()},this.initDefaultValues=function(){this.controlContainer=this.querySelector(".control_container"),this.panelHeader=this.querySelector("panel-header"),l&&BFN.HelpClueManager.setup(l,{})},this.initPanelHeader=function(){this.panelHeader.addEventListener("BACK",function(){UIToggler.cancelActiveEditorTool()})},this.initControls=function(){var e=[];Object.entries(i).forEach(function(t){var i=f(t,2),r=i[0],a=i[1],o=r.replace("".concat(n,"_"),"");e.push({toolID:n,controlID:r,controlName:o,controlParamObject:Object.assign({},a)})});var t=this.controlContainer;UITools.setupControlItems(e,t);var r=t.firstElementChild;r&&r.firstElementChild&&r.firstElementChild.hasClass("control-item-label")&&r.firstElementChild.setStyles({marginTop:0})},this.init()}.bind(e)()},BFN.UI.tooltipScreen=function(e){return function(){var e=this;this.addClass("tooltip-screen"),this.init=function(){this.active=!1,this.mouseEvent=null,this.xOffset=15,this.reserved=!1,this.followMouse=!1,this.message="",this.dimensions=null},this.setMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&"string"==typeof e||(e="(no tooltip)"),t?this.innerHTML=e:this.textContent=e,this.message.length!==e.length&&(this.dimensions=null),this.isGuides=n,this.message=e},this.setPosition=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.dimensions=this.dimensions||this.getBoundingClientRect(),this.isOnCanvas=this.isGuides||r;var o,s,l=this.dimensions,u=l.width,c=l.height,h=n?this.xOffset:0,d=e+u/2>BFN.appRect.width-u/2;this.removeClass("tooltip-screen--left"),this.removeClass("tooltip-screen--right"),this.removeClass("tooltip-screen--top"),o=this.isOnCanvas&&d?e-u-18:d?n?e-u/2-h:e-u-u/2+6:n&&!this.isOnCanvas||a?e-u/2:e+12,s=this.isOnCanvas?t:a?t+12:n?t-6:t-c/2,i||(a?this.addClass("tooltip-screen--top"):!n&&d?this.addClass("tooltip-screen--right"):n||d||a?this.addClass("tooltip-screen--bottom"):this.addClass("tooltip-screen--left")),o=Math.round(o),s=Math.round(s),this.setStyles({transform:"translate(".concat(o,"px, ").concat(s,"px)")})},this.show=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.setMessage(e,i),this.reserved=t,this.followMouse=n,this.active||(this.active=!0,this.addClass("active"),document.addEventListener(BeFunky.pointermove,this.handleMouseMove))},this.hide=function(e){this.reserved=!1;var t=this.prevTooltip!==e;(this.active&&t||!e)&&(this.active=!1,this.removeClass("active"),this.removeClass("tooltip-screen--bottom"),document.removeEventListener(BeFunky.pointermove,this.handleMouseMove))},this.handleMouseMove=function(t){e.followMouse&&(e.mouseEvent=t,e.setPosition(t.pageX,t.pageY,!1,!0,!0))},this.init()}.bind(e)()},BFN.UI.watermarkControl=function(e){return function(){this.addClass("control-item");var e="watermark_toggle_".concat(BeFunky.randomString(10));this.innerHTML='\n        <div class="checkbox">\n            <input type="checkbox" id="'.concat(e,'">\n            <label class="checkbox__label" for="').concat(e,'">\n                <span class="checkbox__box checkbox__box--sm">\n                    <svg class="icon checkbox__icon icon--12">\n                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkmark-icon"></use>\n                    </svg>\n                </span>\n                <string data-lang="use_watermark">').concat(BeFunky.LanguageManager.getString("use_watermark"),'</string>\n            </label>\n        </div>\n        <div class="watermark-control-container">\n            <div class="watermark-control-presets"></div>\n            <button class="watermark-control-edit button button--icon button--white-outline" data-tooltip="manage_watermark_presets">\n                <svg class="icon icon--14">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#gear-icon"></use>\n                </svg>\n            </button>\n            <button class="watermark-control-create button button--has-icon button--white-outline" data-tooltip="create_watermark_preset">\n                <svg class="icon">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#plus-icon"></use>\n                </svg>\n                <string class="watermark-control-preset-default" data-lang="create_watermark_preset">').concat(BeFunky.LanguageManager.getString("create_watermark_preset"),"</string>\n            </button>\n        </div>\n    "),this.init=function(){var e=this;this.checkbox=this.querySelector('input[type="checkbox"]'),this.presetDropdown=this.querySelector(".watermark-control-presets"),Pi(this.presetDropdown,{registerControl:!1,translateOptionNames:!1,onChange:function(e){BFN.WatermarkManager.selectedPresetID!==e&&(BFN.WatermarkManager.selectedPresetID=e)}}),this.manageButton=this.querySelector(".watermark-control-edit"),this.createButton=this.querySelector(".watermark-control-create"),this.watermarkControlContainer=this.querySelector(".watermark-control-container"),this.selected=!1,this.sourceTexture=null,this.selectedPresetID=null,this.checkbox.addEventListener("change",function(){BFN.WatermarkManager.useWatermark=e.checkbox.checked}),this.manageButton.addEventListener("click",function(t){e._selectedPresetID&&e.sourceTexture&&BFN.WatermarkManager.presetModal.open(e.sourceTexture)}),this.createButton.addEventListener("click",function(t){if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();e.sourceTexture&&BFN.WatermarkManager.editModal.open(e.sourceTexture)})},this.updateDisplay=function(){this.checkbox.checked=this._selected,this.watermarkControlContainer.toggleClass("active",this._selected)},this.updatePresetList=function(e){if(e){var t=[];e.forEach(function(e){t.push({name:e.presetName,value:e.presetID})});var n=t.length?t[t.length-1].value:"";this.presetDropdown.setState({options:t,selectedValue:n}),this.updatePresetSelection()}},this.updatePresetSelection=function(){this._selectedPresetID&&(this.presetDropdown.selectedValue=this._selectedPresetID)},Object.defineProperty(this,"selected",{set:function(e){e=!!e,this._selected!==e&&(this._selected=e,this.updateDisplay())},get:function(){return this._selected}}),Object.defineProperty(this,"selectedPresetID",{set:function(e){var t=e?BFN.WatermarkManager.getPresetObjectById(e):null;this._selectedPresetID=t?e:"",this.updatePresetSelection(),this.presetDropdown.toggleClass("active",!!t),this.manageButton.toggleClass("active",!!t),this.createButton.toggleClass("button--has-icon",!t).toggleClass("button--grey-outline",!t),this.createButton.toggleClass("button--icon",!!t).toggleClass("button--white-outline",!!t)},get:function(){return this._selectedPresetID}}),this.init()}.bind(e)()},BFN.UI.watermarkEditModal=function(e){return function(){var e=this;this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this;this.isOpen=!1,this.editingPresetID="",this.previewContainer=document.getElementById("watermark_upload"),this.watermarkUploadPreviewImage=this.querySelector(".watermark-upload__preview-image"),this.watermarkUploadPreviewString=this.querySelector(".watermark-upload__preview-string"),this.watermarkNameInput=this.querySelector("#watermark_name_input"),this.editingExistingPreset=!1,this.watermarkPlacementMap={tl:"top_left",tc:"top_center",tr:"top_right",ml:"middle_left",mc:"middle_center",mr:"middle_right",bl:"bottom_left",bc:"bottom_center",br:"bottom_right"},this.watermarkPlacementString=this.querySelector("#watermark_placement_popover_button string"),this.setPreviewWatermarkParams(UITools.getToolVO("watermark")),this.previewImage=this.querySelector(".watermark-preview-image"),this.previewImageW=0,this.previewImageH=0,this.previewImageReady=!1,this.previewImage.addEventListener("load",function(t){e.previewImage.setStyles({display:"block"}),e.previewImageSrcCallback&&(e.previewImageSrcCallback(),e.previewImageSrcCallback=null),requestAnimationFrame(function(){var t=e.previewImage.getBoundingClientRect();e.previewImageW=t.width,e.previewImageH=t.height,e.previewImageReady=!0,e.updateWatermarkDisplay()})}),this.previewWatermark=this.querySelector(".watermark-preview-watermark"),this.previewWatermarkW=0,this.previewWatermarkH=0,this.previewWatermarkReady=!1,this.previewWatermark.addEventListener("load",function(t){e.previewWatermark.setStyles({display:"block"}),requestAnimationFrame(function(){e.previewWatermarkW=e.previewWatermark.naturalWidth,e.previewWatermarkH=e.previewWatermark.naturalHeight,e.previewWatermarkReady=!0,UIToggler.toggleLoadScreen(!1),e.updateWatermarkDisplay()})})},this.open=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&t.baseTexture){t=t.renderClone(),this.editingPresetID=n.hasOwnProperty("presetID")?n.presetID:"",this.editingExistingPreset=!!n.presetName,this.watermarkNameInput.value=this.editingExistingPreset?n.presetName:"",UITools.disableControlItem(this.watermarkNameInput.id,this.editingExistingPreset,"input",.6);var i=Math.min(640/t.width,640/t.height),r=Math.round(t.width*i),a=Math.round(t.height*i),o=BFN.Util.resizeTexture(t,4*r,4*a),s=BFN.Util.getThumbTexture(o,640);s.renderClone().destroyGC(!0);var l=s.determineTransparency(),u=BFN.TextureUtils.textureToBase64(s,{isTransparent:l});t.destroyGC(!0),o.destroyGC(!0),s.destroyGC(!0);var c=UITools.getToolVO("watermark");for(var h in n)switch(h){case"watermarkPlacement":c.placement=n.watermarkPlacement;break;case"watermarkSize":c.size=n.watermarkSize;break;case"watermarkPadding":c.padding=n.watermarkPadding;break;case"watermarkOpacity":c.opacity=n.watermarkOpacity}UITools.updateToolControls("watermark"),this.setPreviewWatermarkParams(c),this.setPreviewImageSRC(u,function(){BeFunky.openModal(e,{closeOnClickOutside:!1,onOpen:function(){n.watermarkURL&&(BFN.WatermarkManager.previewWatermarkURL=n.watermarkURL,e.setPreviewWatermarkSRC(n.watermarkURL)),e.isOpen=!0},onClose:function(){e.resetControls(),BFN.WatermarkManager.clearPreviewWatermark(),e.previewImage.src="",e.isOpen=!1,BFN.WatermarkManager.selectedPresetID||BFN.WatermarkManager.updateSelectedPreset()},onWindowResize:e.updateModalSize.bind(e),size:"large"})})}},this.close=function(){BeFunky.closeModal(this)},this.setPreviewImageSRC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.previewImageSrcCallback=t,this.previewImageW=0,this.previewImageH=0,this.previewImageReady=!1,this.previewImage.setStyles({display:"none"}),this.previewImage.src=e,!e&&this.previewImageSrcCallback&&(this.previewImageSrcCallback(),this.previewImageSrcCallback=null)},this.setPreviewWatermarkSRC=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e&&UIToggler.toggleLoadScreen(!0,{isCancellable:!1}),this.previewWatermarkW=0,this.previewWatermarkH=0,this.previewWatermarkReady=!1,this.previewWatermark.setStyles({display:"none"}),this.previewWatermark.src=e,this.watermarkUploadPreviewImage.src=e,this.watermarkUploadPreviewImage.toggleClass("active",!!e),this.watermarkUploadPreviewString.toggleClass("active",!e),this.previewContainer.toggleClass("watermark-upload__preview-container--has-image",!!e)},this.setPreviewWatermarkParams=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e){var n=e[t];switch(t){case"placement":this.watermarkPlacement=n,this.watermarkPlacementString.setLang(this.watermarkPlacementMap[n]);break;case"size":this.watermarkSize=n;break;case"padding":this.watermarkPadding=n;break;case"opacity":this.watermarkOpacity=n}}this.updateWatermarkDisplay()},this.updateWatermarkDisplay=function(){var e=this;if(this.previewImageReady&&this.previewWatermarkReady){var t=.4*Math.min(this.previewImageW,this.previewImageH),n=Math.round(this.watermarkPadding/100*t),i=this.previewImageW-2*n,r=this.previewImageH-2*n,a=Math.min(this.previewImageW/this.previewWatermarkW,this.previewImageH/this.previewWatermarkH),o=this.watermarkSize/100*a,s=Math.round(this.previewWatermarkW*o),l=Math.round(this.previewWatermarkH*o);if(s>i||l>r){var u=function(){if("padding"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)){var i=2*n;o=Math.min((e.previewImageW-i)/e.previewWatermarkW,(e.previewImageH-i)/e.previewWatermarkH),s=Math.round(e.previewWatermarkW*o),l=Math.round(e.previewWatermarkH*o),e.watermarkSize=Math.round(o/a*100),UITools.setToolValue("watermark","size",e.watermarkSize,!1),UITools.updateToolControl("watermark_size")}else n=Math.round(Math.min((e.previewImageW-s)/2,(e.previewImageH-l)/2)),e.watermarkPadding=Math.round(n/t*100),UITools.setToolValue("watermark","padding",e.watermarkPadding,!1),UITools.updateToolControl("watermark_padding")},c=UITools.getToolVO("watermark");c.updating?u(c.updating_id):u("size")}var h=0,d=0;this.watermarkPlacement.includes("l")&&(h=n),this.watermarkPlacement.includes("c")&&(h=this.previewImageW/2-s/2),this.watermarkPlacement.includes("r")&&(h=this.previewImageW-n-s),this.watermarkPlacement.includes("t")&&(d=n),this.watermarkPlacement.includes("m")&&(d=this.previewImageH/2-l/2),this.watermarkPlacement.includes("b")&&(d=this.previewImageH-n-l);var m={};m.left="".concat(h,"px"),m.top="".concat(d,"px"),m.width="".concat(s,"px"),m.height="".concat(l,"px"),m.opacity=this.watermarkOpacity/100,this.previewWatermark.setStyles(m)}},this.resetControls=function(){this.setPreviewWatermarkSRC();var e=UITools.getToolVO("watermark");for(var t in e.defaultValues){var n=e.defaultValues[t];e[t]=n}UITools.updateToolControls("watermark"),this.setPreviewWatermarkParams(e)},this.getWatermarkData=function(){if(!e.previewImageReady||!e.previewWatermarkReady)return null;var t=e.previewImage.getBoundingClientRect(),n=e.previewWatermark.getBoundingClientRect(),i=Math.round(Math.min(n.x-t.x,n.y-t.y,t.x+t.width-(n.x+n.width),t.y+t.height-(n.y+n.height)));return{frameW:Math.round(t.width),frameH:Math.round(t.height),framePadding:i,watermarkW:Math.round(n.width),watermarkH:Math.round(n.height),watermarkNaturalW:e.previewWatermarkW,watermarkNaturalH:e.previewWatermarkH,watermarkAlpha:e.watermarkOpacity/100,watermarkSize:e.watermarkSize,watermarkPadding:e.watermarkPadding,watermarkOpacity:e.watermarkOpacity,watermarkPlacement:e.watermarkPlacement}},this.handleClose=function(){e.close()},this.updateModalSize=function(e){e.availableWidth,e.availableHeight},Object.defineProperty(this,"nameInputValue",{get:function(){return this.watermarkNameInput.value.trim()}}),this.init()}.bind(e)()},BFN.UI.watermarkPresetModal=function(e){return function(){var e=this,t=function(){e.presetButtons={},e._selectedPresetID=null,e.sourceTexture=null,e.previewSourceTexture=null,e.isEditingPresetName=!1,e.previewImage=document.getElementById("watermark_preset_image"),e.presetList=e.querySelector(".watermark-preset__preset-list"),e.presetList.innerHTML="",BFN.UI.sortableList(e.presetList),e.presetList.addEventListener("LIST_ORDER_UPDATED",e.handlePresetListOrderUpdated.bind(e)),document.getElementById("watermark_preset_done").addEventListener("click",function(){BeFunky.closeModal(e)}),e.handleWatermarkUpdatedBind=e.handleWatermarkUpdated.bind(e)};this.open=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&t.baseTexture){this.sourceTexture=t;var n=Math.min(600/t.width,600/t.height),i=Math.round(t.width*n),r=Math.round(t.height*n),a=BFN.Util.resizeTexture(t,4*i,4*r);this.previewSourceTexture=BFN.Util.getThumbTexture(a,600),this.previewSourceTexture.renderClone().destroyGC(!0),a.destroyGC(!0),BeFunky.openModal(this,{onOpen:function(){e.updatePreview(),BFN.WatermarkManager.addEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,e.handleWatermarkUpdatedBind)},onClose:function(){e.clearPreview(),BFN.WatermarkManager.removeEventListener(BFN.WatermarkManagerEvents.WATERMARK_UPDATED.type,e.handleWatermarkUpdatedBind)},closeOnEscape:function(){return!e.isEditingPresetName},onWindowResize:function(t){var n=t.availableWidth,i=t.availableHeight;e.setStyles({width:"".concat(Math.min(944,n),"px"),height:"".concat(Math.min(512,i),"px")})}})}},this.close=function(){this.sourceTexture=null,BeFunky.closeModal(this)},this.updatePreview=function(){if(this.previewSourceTexture){var e=this.previewSourceTexture.renderClone();BFN.WatermarkManager.drawWatermark(e),e.renderClone().destroyGC(!0);var t=BFN.Util.isTransparent(e);this.previewImage.src=BFN.TextureUtils.textureToBase64(e,{isTransparent:t}),e.destroyGC(!0)}},this.clearPreview=function(){this.previewSourceTexture&&(this.previewSourceTexture.destroyGC(!0),this.previewSourceTexture=null),this.previewImage.src=""},this.updatePresetButtons=function(e){var t=this;if(e){var n=e.map(function(e){return e.presetID});for(var i in this.presetButtons){var r=this.presetButtons[i];n.includes(i)||(r.parentNode.removeChild(r),delete this.presetButtons[i])}e.forEach(function(e){t.presetButtons.hasOwnProperty(e.presetID)||(t.presetButtons[e.presetID]=t.createPresetButton(e.presetID,e.presetName))}),e.forEach(function(e){var n=t.presetButtons[e.presetID];n.string.textContent=e.presetName,t.presetList.appendChild(n)}),this.presetList.refreshList(),this.updatePresetButtonSelection()}},this.updatePresetButtonSelection=function(){for(var e in this.presetButtons){this.presetButtons[e].toggleClass("button--selected",e===this._selectedPresetID)}},this.editPresetName=function(e,t,n){var i=this;if(!t.isEditing){t.isEditing=!0,t.parentElement.draggingEnabled=!1,this.isEditingPresetName=!0,t.addClass("watermark-preset__select-preset--is-editing");var r=document.createElement("input").setClass("input watermark-preset__update-name"),a=n.textContent;r.value=a,t.appendChild(r),requestAnimationFrame(function(){r.focus(),r.select(),o()});var o=function(){r.addEventListener("keydown",l),r.addEventListener("click",function(e){e.stopPropagation()}),r.addEventListener("blur",u)},s=function(){t.isEditing&&(t.isEditing=!1,t.parentElement.draggingEnabled=!0,t.removeClass("watermark-preset__select-preset--is-editing"),t.removeChild(r),setTimeout(function(){i.isEditingPresetName=!1},100))},l=function(e){27===e.keyCode?s():13===e.keyCode&&u()},u=function(){if(t.isEditing){var n=r.value.trim();n&&n!==a&&BFN.WatermarkManager.renameWatermarkPreset(e,n),s()}}}},this.createPresetButton=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=document.createElement("div").setClass("watermark-preset__preset-button-row sortable-list__item button button--grey-200");i.dataset.presetId=e;var r=document.createElement("button").setClass("button button--transparent button--ellipsis watermark-preset__select-preset");r.dataset.tooltip="select_watermark_preset",n=n||e;var a=document.createElement("string").setClass(" button--ellipsis");a.textContent=n,r.appendChild(a),i.string=a,r.addEventListener("click",function(n){if(BFN.WatermarkManager.selectedPresetID!==e){BFN.WatermarkManager.selectedPresetID=e;var o=v(i.parentElement.children).find(function(e){return!e.firstElementChild.hasAttribute("data-tooltip")});return o&&(o.firstElementChild.dataset.tooltip="select_watermark_preset"),void r.removeAttribute("data-tooltip")}n.shiftKey||n.ctrlKey||n.metaKey||t.editPresetName(e,r,a)});var o=document.createElement("button").setClass("button button--transparent button--icon watermark-preset__edit-preset");o.innerHTML='<svg class="icon icon--14"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#edit-icon"></use></svg>',o.dataset.tooltip="edit_watermark_preset",o.addEventListener("click",function(e){if(t.sourceTexture){var n=BFN.WatermarkManager.getPresetObjectById(t._selectedPresetID);n&&BFN.WatermarkManager.editModal.open(t.sourceTexture,n)}});var s=document.createElement("button").setClass("button button--transparent button--icon watermark-preset__remove-preset");return s.innerHTML='<svg class="icon icon--14"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#delete-icon"></use></svg>',s.dataset.tooltip="delete_watermark_preset",s.addEventListener("click",function(){BeFunky.confirm("confirm_delete_watermark_preset",{onConfirm:function(){if(BFN.WatermarkManager.deleteWatermarkPreset(e)){var n=t.presetButtons[e];n&&(n.parentNode.removeChild(n),delete t.presetButtons[e]),BFN.WatermarkManager.watermarkPresets.length||t.close()}},confirmText:"delete",focusConfirmButton:!1})}),i.appendChild(r),i.appendChild(o),i.appendChild(s),i},this.handlePresetListOrderUpdated=function(e){var t=v(this.presetList.querySelectorAll(".sortable-list__item")).map(function(e){return e.dataset.presetId});BFN.WatermarkManager.updateWatermarkPresetOrder(t)},this.handleWatermarkUpdated=function(e){this.updatePreview()},Object.defineProperty(this,"selectedPresetID",{set:function(e){this._selectedPresetID=e,this.updatePresetButtonSelection()},get:function(){return this._selectedPresetID}}),t()}.bind(e)()},BFN.UI.webcamModal=function(e){return function(){this.init=function(){this.initDefaultValues(),this.initButtons()},this.initDefaultValues=function(){this.webcamRecorder=null,this.image=this.querySelector(".webcam__image"),this.error=this.querySelector(".webcam__error"),this.video=BeFunky.lit.elem(k_(),BeFunky.LanguageManager.getString("video_stream_not_available","modal")),this.image.insertAdjacentElement("beforebegin",this.video)},this.initButtons=function(){this.querySelector(".webcam__cancel").addEventListener("click",this.handleCancel.bind(this)),this.querySelector(".webcam__take-photo").addEventListener("click",this.handleTakePhoto.bind(this)),this.querySelector(".webcam__apply").addEventListener("click",this.handleApply.bind(this)),this.querySelector(".webcam__discard").addEventListener("click",this.handleDiscard.bind(this)),this.querySelector(".webcam__refresh").addEventListener("click",this.handleRefresh.bind(this))},this.open=function(){var e=this;BeFunky.openModal(this,{onOpen:function(){e.showVideo(),e.startWebcam()},onClose:function(){e.webcamRecorder.stop(),e.webcamRecorder=null,e.image.src=""},closeOnClickOutside:!1,size:"medium"})},this.close=function(){BeFunky.closeModal(this)},this.startWebcam=function(){var e=this;this.webcamRecorder=new BFN.WebcamRecorder(this.video,function(t){BeFunky.logError("Webcam error:",t),e.showError()})},this.showVideo=function(){this.setClass("modal webcam webcam--show-video")},this.showImage=function(){this.setClass("modal webcam webcam--show-image")},this.showError=function(){this.setClass("modal webcam webcam--show-error")},this.handleCancel=function(){this.close()},this.handleTakePhoto=function(){var e=this;this.webcamRecorder.stop(!0),this.webcamRecorder.getSnapshot(function(t){BFN.BlobUtils.blobToBase64(t).then(function(t){e.image.src=t,e.showImage()},function(e){BeFunky.throwError("Unable to get snapshot",e)})})},this.handleApply=function(){var e=this,t=this.image.src;this.close(),BFN.PhotoEditorModel.confirmEditorLoadImage(function(){BFN.PhotoEditorModel.loadBase64OrBlob(t,{filename:"BeFunky-snapshot"}),BFN.BfnService.track("CREATE","UPLOAD","WEBCAM"),BFN.BfnService.trackMediaOpened("image","webcam")},function(){e.open()})},this.handleDiscard=function(){this.showVideo(),this.webcamRecorder.start(),this.image.src=""},this.handleRefresh=function(){this.startWebcam()},this.init()}.bind(e)()},BFN.UI.zoomRegion=function(e){return function(){this.innerHTML='\n    <div class="zoom-region-container">\n        <img class="zoom-region-preview-image-background" draggable="false">\n        <div class="zoom-region-viewport">\n            <img class="zoom-region-preview-image-foreground">\n            <div class="zoom-region-viewport-grid-h"></div>\n            <div class="zoom-region-viewport-grid-v"></div>\n        </div>\n    </div>\n  ',this.init=function(){this.initDefaultValues(),this.reset()},this.initDefaultValues=function(){this.previewImageMaxSize=160,this.previewExceptions=[BFN.PhotoEditorCanvasModelViewStates.VIEWING_BORDER,BFN.PhotoEditorCanvasModelViewStates.VIEWING_DROP_SHADOW,BFN.PhotoEditorCanvasModelViewStates.VIEWING_FRAME,BFN.PhotoEditorCanvasModelViewStates.VIEWING_ROTATE,BFN.PhotoEditorCanvasModelViewStates.VIEWING_RESIZE,BFN.PhotoEditorCanvasModelViewStates.VIEWING_SLIMMING,BFN.PhotoEditorCanvasModelViewStates.VIEWING_TILT],BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING&&this.previewExceptions.push(BFN.PhotoEditorCanvasModelViewStates.VIEWING_MATTING),this._validPreview=!1,this._showing=!1,this._active=!1,this.currentPreviewID=null,this.container=this.querySelector(".zoom-region-container"),this.previewImageBackground=this.querySelector(".zoom-region-preview-image-background"),this.viewport=this.querySelector(".zoom-region-viewport"),this.previewImageForeground=this.querySelector(".zoom-region-preview-image-foreground"),BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,this.handleAppModelViewstateUpdated.bind(this)),BFN.StageModel.addEventListener(BFN.StageModelEvents.STAGE_DIMENSIONS_UPDATED.type,this.handleStageDimensionsUpdated.bind(this)),BFN.PhotoEditorCanvasModel.addEventListener(BFN.PhotoEditorCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.CollageMakerCanvasModel.addEventListener(BFN.CollageMakerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.DesignerCanvasModel.addEventListener(BFN.DesignerCanvasModelEvents.CANVAS_SCALE_UPDATED.type,this.handleCanvasScaleUpdated.bind(this)),BFN.PhotoEditorCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),BFN.CollageMakerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),BFN.DesignerCanvas.canvasDragger.addEventListener(BFN.DraggerEvents.DRAGGING.type,this.handleCanvasDraggerDragging.bind(this)),BFN.MainUI.addEventListener(BFN.MainUIEvents.MOUSE_DOWN.type,this.handleMainUIMouseDown.bind(this)),this.addEventListener(BeFunky.pointerdown,this.handleViewportMouseDown.bind(this)),this.addEventListener("transitionend",this.handleTransitionEnd.bind(this)),this.addEventListener("wheel",this.handleMouseWheel.bind(this))},this.updatePreview=BeFunky.debounce(function(){var e=this;this._validPreview=!1;var t=null,n=!1,i=null,r=null,a=null;BFN.TransformItemIsolator.active&&BFN.TransformItemIsolator.itemTexture.width>0&&BFN.TransformItemIsolator.itemTexture.height>0?t=BFN.TransformItemIsolator.itemTexture:BFN.AppModel.viewingEditor&&BFN.ImageEditManager.editingImage&&(t=BFN.PhotoEditorCanvas.getFlattenedImage(),n=!0);var o=function(){e.currentPreviewID=BeFunky.randomString(10);var o=BFN.Util.getThumbTexture(t,e.previewImageMaxSize,!1,!1);i=BFN.TextureUtils.textureToBase64(o),r=o.width,a=o.height,o.destroyGC(!0),e.imageW=t.width,e.imageH=t.height,n&&t.destroyGC(!0)};if(t)o();else{var s=BFN.AppModel.sectionID;if(BFN.ProjectManager.savedCanvasThumbs.hasOwnProperty(s)){var l=BFN.ProjectManager.savedCanvasThumbs[s];if(this.currentPreviewID===l.thumbID)return void(this._validPreview=!0);this.currentPreviewID=l.thumbID,i=l.thumbSRC,r=l.thumbW,a=l.thumbH,this.imageW=l.canvasW,this.imageH=l.canvasH}}if(!i&&!BFN.ProjectManager.projectLoading){if(BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture)return this.reset();var u=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);u&&(t=u.getFlattenedImage(),n=!0,o())}if(!i)return this.reset();this._validPreview=!0,this.previewImageBackground.src=i,this.previewImageForeground.src=i,this.previewImageScale=Math.min(1,this.previewImageMaxSize/r,this.previewImageMaxSize/a),this.previewImageW=Math.min(this.previewImageMaxSize,2*Math.round(r*this.previewImageScale/2)),this.previewImageH=Math.min(this.previewImageMaxSize,2*Math.round(a*this.previewImageScale/2)),this.previewImageBackground.setStyles({width:"".concat(this.previewImageW,"px"),height:"".concat(this.previewImageH,"px")}),this.previewImageForeground.setStyles({width:"".concat(this.previewImageW,"px"),height:"".concat(this.previewImageH,"px")}),this.container.setStyles({width:"".concat(this.previewImageW,"px"),height:"".concat(this.previewImageH,"px")}),this.updateViewport()},100),this.updateViewport=function(){if(this._validPreview){var e=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas),t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);this.canvasW=Math.round(this.imageW*t.canvasScale),this.canvasH=Math.round(this.imageH*t.canvasScale),this.viewportW=Math.round(Math.min(1,BFN.StageModel.stageW/this.canvasW)*this.previewImageW),this.viewportH=Math.round(Math.min(1,BFN.StageModel.stageH/this.canvasH)*this.previewImageH),this.viewport.setStyles({width:"".concat(this.viewportW,"px"),height:"".concat(this.viewportH,"px")});var n=(this.previewImageW-this.viewportW)/2-e.canvasContainer.x*(this.previewImageW/this.imageW),i=(this.previewImageH-this.viewportH)/2-e.canvasContainer.y*(this.previewImageH/this.imageH);this.viewport.setStyles({left:"".concat(n,"px"),top:"".concat(i,"px")}),this.previewImageForeground.setStyles({left:"".concat(-n,"px"),top:"".concat(-i,"px")}),this.viewportW<this.previewImageW||this.viewportH<this.previewImageH?this._showing&&!this._active&&(this._active=!0,this.setStyles({display:"block"}),this.classList.add("active")):this._active&&(this._active=!1,this.classList.remove("active"))}},this.reset=function(){this.previewImageBackground.src="",this.previewImageForeground.src="",this.imageW=0,this.imageH=0,this.previewImageScale=0,this.previewImageW=0,this.previewImageH=0,this.canvasW=0,this.canvasH=0,this.viewportW=0,this.viewportH=0,this.hide()},this.show=function(){!this._validPreview||this._showing||this.previewExceptions.includes(BFN.PhotoEditorCanvasModel.viewState)||(this._showing=!0,this.updateViewport())},this.hide=function(){this._showing&&(this._showing=!1,this._active=!1,this.classList.remove("active"))},this.handleAppModelViewstateUpdated=function(e){this.updatePreview()},this.handleStageDimensionsUpdated=function(e){this.updateViewport()},this.handleCanvasScaleUpdated=function(e){this.updateViewport()},this.handleCanvasDraggerDragging=function(e){this.updateViewport()},this.handleMainUIMouseDown=function(){this.hide()},this.handleViewportMouseDown=function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas);t.canvasDragger.altScale=-this.previewImageW/this.imageW,t.handleMoveTouchSurfacePressed(e),e.stopPropagation()},this.handleTransitionEnd=function(e){this._active||this.setStyles({display:"none"})},this.handleMouseWheel=function(e){e.altKey&&BFN.ZoomManager.handleMainUIMouseWheel(e)},this.init()}.bind(e)()};var L_=BeFunky.lit,O_=L_.html,R_=L_.lang,A_=L_.defineCustomElement,V_=L_.useEffect,U_=L_.useState,G_=L_.useLayoutEffect,H_=L_.useLanguageUpdate,z_=L_.styleMap;function j_(){var e=g(["<button class=",' data-tooltip="','" @click=',">","</button>"]);return j_=function(){return e},e}function X_(){var e=g(["",""]);return X_=function(){return e},e}A_("tabbed-layout",function(e){var t=e.tabs,n=void 0===t?{}:t,i=e.activeTab,r=void 0===i?"":i,a=e.tabIndicatorTemplate,o=e._privateState,s=this,l=Object.keys(n),u=f(U_({}),2),c=u[0],h=u[1];l.includes(r)||(r=l[0]);o||(s._privateState={priorTab:r,cancelAnimation:null,tabNames:l},Object.defineProperty(s,"tabNames",{get:function(){return s._privateState.tabNames}}));H_("app");var d=s._privateState.priorTab;return G_(function(){if(s._privateState.priorTab=r,s.dispatchEvent(new Event("TAB_CHANGE")),r!==d){var e=l.indexOf(d),t=l.indexOf(r);if(-1===e||-1===t)return;var n=f(s.children,2),i=n[0],a=n[1],o=i.children,u=a.children;if(o.length!==l.length||u.length!==l.length)return;var c="function"==typeof s._privateState.cancelAnimation;c&&(s._privateState.cancelAnimation(),s._privateState.cancelAnimation=null);var m=o[e].firstElementChild.getBoundingClientRect(),p=o[t].firstElementChild.getBoundingClientRect(),g=c?Math.round(a.getBoundingClientRect().height):u[e].getBoundingClientRect().height,v=u[t].getBoundingClientRect().height;h({underline:{transition:"none",transform:"translateX(".concat(m.left-p.left,"px)"),width:"".concat(m.width,"px")},panelContainer:{transition:"none",height:"".concat(g,"px")}}),y=function(){var e,t;h({underline:"",panelContainer:{height:"".concat(v,"px")}}),e=300,t=function(){h({underline:"",panelContainer:""}),s._privateState.cancelAnimation=null},s._privateState.cancelAnimation=BeFunky.wait([e,"ric"],t)},s._privateState.cancelAnimation=BeFunky.wait(["raf","raf"],y)}var y},[r]),V_(function(){s._privateState.tabNames=l},[n]),m=c.panelContainer?z_(c.panelContainer):"",O_(w_(),l.map(p),m,l.map(g));var m;function p(e){var t,n=e===r,i="".concat(x("tabs__button",[n?"active":""])," button");return O_(D_(),y,i,e,R_(e),a?a(e):"",n?(t=c.underline?z_(c.underline):"",O_(M_(),t)):"")}function g(e){var t=e===r,i="".concat(x("tabs__panel",[t?"active":""])," ").concat(t?"":"focus-avoid");return O_(N_(),i,t?"position: static":"",n[e])}function y(e){var t=e.target.tabName;t!==r&&(s.activeTab=t)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[e].concat(v(t.filter(Boolean).map(function(t){return"".concat(e,"--").concat(t)}))).join(" ")}});var W_=BeFunky.lit,Y_=W_.html,q_=W_.defineCustomElement,K_=W_.lang,Q_=W_.icon,Z_=W_.useLanguageUpdate,J_=W_.ifDefined;function $_(){var e=g(['\n            <label class="radio-button">\n                <input type="radio" name='," .value="," @change="," .checked=",'>\n                <span class="radio-button__circle"></span>\n                <span class="radio-button__text">',"</span>\n            </label>\n        "]);return $_=function(){return e},e}function eI(){var e=g(["",""]);return eI=function(){return e},e}q_("toggle-group",function(e){var t=e.buttons,n=void 0===t?[]:t,i=e.value,r=void 0===i?"":i,a=this;this._hasInitialized||(this._hasInitialized=!0,this.addClass("toggle-group"));return Z_("app"),Y_(X_(),n.map(function(e){return function(e){var t,n;"string"==typeof e?(t=e,n=K_(e)):e.hasOwnProperty("value")?(t=e.value,n=e.icon?Q_(e.icon,"icon icon--".concat(e.iconSize||18),{style:e.iconStyle}):e.text||K_(e.langID)):BeFunky.throwError("Toggle group button missing value",a.id);var i=Boolean(e.icon||e.text&&1===e.text.length),o=["toggle-group__button","button",e.colorClass||"button--white-outline",i?"button--icon":"",r===t?"button--selected":""].filter(Boolean).join(" ");return Y_(j_(),o,J_(e.tooltip),function(){return function(e){a.value=e,a.dispatchEvent(new CustomEvent("change"))}(t)},n)}(e)}))});var tI=BeFunky.lit,nI=tI.html,iI=tI.defineCustomElement,rI=tI.lang,aI=tI.useLanguageUpdate;function oI(){var e=g(['<div class="expandable-checkbox__mixed-icon"></div>']);return oI=function(){return e},e}function sI(){var e=g(['\n        <div class="expandable-checkbox__control button-group">\n            <button class='," @click=",">\n                <div class=",">\n                ","\n                </div>\n                <string>","</string>\n            </button>\n            <button class="," @click="," data-tooltip=",">\n                ","\n            </button>\n        </div>\n        <div class="," style=",">","</div>\n        "]);return sI=function(){return e},e}iI("radio-buttons",function(e){var t=e.buttons,n=void 0===t?[]:t,i=e.value,r=void 0===i?"":i,a=this;this._name||(this._name="radio_button_group_".concat(BeFunky.randomString(10)),this.addClass("radio-buttons"));return aI("app"),nI(eI(),n.map(function(e){return function(e){return nI($_(),a._name,e.value,o,e.value===r,rI(e.langID))}(e)}));function o(e){a.value=e.target.value}});var lI=BeFunky.lit,uI=lI.html,cI=lI.lang,hI=lI.icon,dI=lI.defineCustomElement,mI=lI.render,pI=lI.useLanguageUpdate,gI=lI.useLayoutEffect;function fI(){var e=g(['<div class="color-picker__ghost">\n            ',"\n            ","\n        </div>"]);return fI=function(){return e},e}function vI(){var e=g(["<div class="," @change=","></div>"]);return vI=function(){return e},e}function yI(){var e=g(["\n            <span class=",">","</span>\n        "]);return yI=function(){return e},e}function xI(){var e=g(["<div class="," .hashColor="," .gridIndex=",' style="','" data-tooltip=',"></div>"]);return xI=function(){return e},e}function _I(){var e=g(['\n        <div class="','"\n             style=',"\n             @click=","\n             @mouseover=","\n             @mouseout=","\n             @contextmenu=",'\n        >\n            <div class="color-picker__grid"\n                 @dragstarted=',"\n                 @dragmoved=","\n                 @dragstopped=","\n            >\n            ","\n            </div>\n        </div>"]);return _I=function(){return e},e}function II(){var e=g(['\n            <div class="color-picker__library color-picker__library--empty scrollable-content">\n                <img src="','app/illustrations/color-library-empty-state.svg" alt="">\n                <p>',"</p>\n            </div>"]);return II=function(){return e},e}function TI(){var e=g(['<button class="color-picker__grid-square button" style="cursor: auto"></button>']);return TI=function(){return e},e}function bI(){var e=g(['\n        <div class="color-picker__recent-colors">\n            <label class="control-item-label" style="margin-bottom: 4px">','</label>\n            <div class="color-picker__grid" @click='," @mouseover="," @mouseout=",">\n                ","\n            </div>\n        </div>"]);return bI=function(){return e},e}function SI(){var e=g(["<button class="," .hashColor=",' style="',';"></button>']);return SI=function(){return e},e}function CI(){var e=g(['\n        <div class="color-picker__grid ','" style="margin-bottom: 12px" @click='," @mouseover="," @mouseout=",">\n            ","\n        </div>"]);return CI=function(){return e},e}function BI(){var e=g(['\n        <div class="color-picker__input-container" data-tooltip="color_hex_code">\n            <div class="color-picker__input-box" style=','>\n                <div class="color-picker__input-box-color" style=','></div>\n            </div>\n            <string class="color-picker__input-hash">#</string>\n            <input aria-label="Input Color" class="color-picker__input input" id="color_picker_input" .value='," @change="," @click=",' maxLength="7" type="text"/>\n        </div>']);return BI=function(){return e},e}function FI(){var e=g(["<button class=",' data-tooltip="eyedropper_tool" @click=',">","</button>"]);return FI=function(){return e},e}function EI(){var e=g(["<button class=",' data-tooltip="no_color" @click=',">","</button>"]);return EI=function(){return e},e}function PI(){var e=g(["<button class=",' data-tooltip="reset" @click=',">","</button>"]);return PI=function(){return e},e}function kI(){var e=g(['\n            <div class="color-picker__controls button-group">\n                ','\n                <div class="button-group" style="justify-content: flex-end; --gap: 4px">\n                    ',"\n                    ","\n                    ","\n                    <button class=",' data-tooltip="switch_view" @click=',">\n                        ","\n                    </button>\n                    <button class="," data-tooltip="," .disabled="," @click=",">\n                        ","\n                    </button>\n                </div>\n            </div>\n        "]);return kI=function(){return e},e}function NI(){var e=g(['\n        <div class="color-picker__hsv-tab">\n            ',"\n            ","\n            ",'\n            <div class="control-item control-item--slider slider-custom--opacity" style=',">\n                ","\n            </div>\n            ","\n        </div>"]);return NI=function(){return e},e}function MI(){var e=g(["\n        <tabbed-layout class="," .tabs="," .tabIndicatorTemplate="," @TAB_CHANGE=","></tabbed-layout>\n        ","\n        "]);return MI=function(){return e},e}function DI(){var e=g(['<div id="context_menu_color_picker"></div>']);return DI=function(){return e},e}dI("expandable-checkbox",function(e){var t=e.langId,n=void 0===t?"test":t,i=e.checked,r=void 0===i?"off":i,a=e.isOpen,o=void 0!==a&&a,s=e.contentTemplate,l=e.contentHeight,u=void 0===l?"0px":l,c=e._contentElement,h=e._canAnimate,d=void 0!==h&&h,m=e._canAnimateTimeout,p=e.openWhenChecked,g=void 0!==p&&p,f=this;if(!c&&(f.addClass("expandable-checkbox"),f._contentElement=c=document.createElement("div"),!s))for(;f.firstChild;)c.appendChild(f.firstChild);s&&mI(s,c);o&&"on"!==r&&(f.isOpen=o=!1);return gI(function(){if(o){var e=c.getBoundingClientRect().height;f.contentHeight=e?"".concat(e,"px"):"auto"}d&&(clearTimeout(m),f._canAnimateTimeout=setTimeout(function(){f._canAnimate=!1},100))},[r,o,s]),pI("app"),v=o?u:"0px",uI(sI(),"expandable-checkbox__check-button button button--left-align button--transparent-text-grey-800 ".concat("off"!==r?"button--selected":""),y,"expandable-checkbox__box expandable-checkbox__box--".concat(r),"mixed"!==r?hI("checkmark-icon","expandable-checkbox__icon icon icon--12"):uI(oI()),cI(n,"app"),"expandable-checkbox__open-button button button--icon button--transparent-text-grey-800 ".concat("off"!==r?"button--selected":""),x,o?"collapse":"expand",hI("chevron-icon","icon icon--8",{style:o?"transform: scale(-1)":""}),"expandable-checkbox__content ".concat(o?"":"focus-avoid"),"height: ".concat(v,"; ").concat(d?"":"transition-duration: 0s"),c);var v;function y(){if(g&&(f.openWhenChecked=!1,"on"!==r))return _();f.checked="on"===r?"off":"on",f.dispatchEvent(new CustomEvent("change")),f._canAnimate=!0}function x(){if(g&&(f.openWhenChecked=!1,!o))return _();f.isOpen=!o,f._canAnimate=!0,f.isOpen&&"on"!==r&&(f.checked="on",f.dispatchEvent(new CustomEvent("change")))}function _(){f.isOpen=!0,f.checked="on",f.dispatchEvent(new CustomEvent("change")),f._canAnimate=!0}},{observedAttributes:["lang-id"]});var wI=BeFunky.lit,LI=wI.html,OI=wI.elem,RI=wI.useState,AI=wI.useEffect,VI=wI.useLayoutEffect,UI=wI.appLang,GI=wI.icon,HI=wI.defineCustomElement,zI=wI.styleMap,jI=new Event("change"),XI=new Event("finechange"),WI="FF0000",YI=!1,qI=function(e){return-1===e||"string"==typeof e&&6===e.length&&e===e.toUpperCase()};function KI(e){var t,n,i,r,a,o,s,l,u,c,h,d,m,p,g,y=e.colorButton,x=void 0===y?null:y,_=e.recentColors,I=void 0===_?[]:_,T=e.colorLibraries,b=void 0===T?[]:T,S=e._privateState,C=this,B=f(RI(WI),2),F=B[0],E=B[1],P=f(RI(!1),2),k=P[0],N=P[1],M=f(RI(!1),2),D=M[0],w=M[1],L=f(RI(!1),2),O=L[0],R=L[1],A=f(RI(),2),V=A[0],U=A[1],G=f(RI(1),2),H=G[0],z=G[1],j=f(RI(242),2),X=j[0],W=j[1],Y=f(RI("picker"),2),q=Y[0],K=Y[1],Q=f(RI(),2),Z=Q[0],J=Q[1],$=f(RI(0),2),ee=$[0],te=$[1],ne=f(RI(!1),2),ie=ne[0],re=ne[1],ae=f(RI(!1),2),oe=ae[0],se=ae[1],le=b.find(function(e){return"default"===e.name})||{name:"default",colors:[]};if(YI||qI(F)||(YI=!0,BeFunky.throwError("Invalid selectedColor",F,I.includes(F),le.colors.includes(F))),!S){var ue=(Object.defineProperty(C,"handleIntensitySliderUpdate",{get:function(){return function(){if(C.colorButton){var e=UITools.getToolVO("color_picker_panel");"intensity"===e.updating_id&&(C.colorButton.fineChangeEnabled&&e.updating?(C.colorButton.intensity=e.intensity/100,C.colorButton.dispatchEvent(XI)):e.updating||(C.colorButton.intensity=e.intensity/100,C.colorButton.dispatchEvent(XI),C.colorButton.dispatchEvent(jI)),z(e.intensity/100))}}}}),UITools.registerSliderItemControl("color_picker_panel_intensity",document.createElement("div"))),ce=ue.slider,he=ue.container;C._privateState=S={opacitySlider:ce,opacitySliderContainer:he,colorPickerHSV:function(){var e=OI(vI(),D?"color-picker__hsv--hidden":"",function(){var e=this.hashColor.toUpperCase();E(e),se(!0),re(!1);var t=C.colorButton;if(!t)return;t.fineChangeEnabled&&this.updating?(t.hashColor=e,t.dispatchEvent(XI)):this.updating||(t.hashColor=e,t.dispatchEvent(jI))});return BFN.UI.colorPickerHSV(e),e}(),handleDocumentPointerDown:null,latestColorHash:WI,contextMenu:OI(DI()),lastContextMenuColorHash:null,ghost:null},C.zIndexOverFabric=!0,C.zIndexOverModal=!0,BeFunky.waitUntil({condition:function(){return t=C.querySelector(".tabs__nav")},onTimeout:function(){BeFunky.throwError("Failed to initialize draggable color picker")},onSuccess:function(){BFN.UI.draggablePanel(C,t),R(!0)},interval:50,maxAttempts:20}),BeFunky.contextMenu(S.contextMenu,{delete:{onClick:function(){ve(function(e){return e.filter(function(e){return e!==S.lastContextMenuColorHash})})}}}),C.refreshIntensitySlider=function(){C.colorButton&&C.colorButton.intensityEnabled?(UITools.setToolValue("color_picker_panel","intensity",100*C.colorButton.intensity),UITools.updateToolControl("color_picker_panel_intensity"),z(C.colorButton.intensity)):z(C.colorButton.intensity)},C.handleColorButtonUpdated=function(){C.colorButton&&E(-1===C.colorButton.hashColor?WI:C.colorButton.hashColor.toUpperCase())}}return VI(function(){x&&U(Boolean(x.intensityEnabled&&(-1!==x.hashColor||x.intensityWhileTransparent))),-1!==F&&(S.opacitySlider.firstElementChild.setStyles({backgroundImage:"linear-gradient(90deg, transparent, #".concat(F,")")}),S.latestColorHash=F)},[F]),VI(function(){if(O)if(w(!1),x){var e=-1===x.hashColor?WI:x.hashColor.toUpperCase();E(e),U(Boolean(x.intensityEnabled&&(-1!==x.hashColor||x.intensityWhileTransparent))),C.refreshIntensitySlider();var t=function(e){var t=e.getBoundingClientRect(),n=(t.width-31)/2;return{leftOffset:Math.floor(t.left+t.width-n+20),topOffset:Math.floor(t.top+n)}}(x),n=t.leftOffset,i=t.topOffset;C.show(n,i),oe&&(fe(),se(!1))}else if(C.hasClass("active")){if(C.hide(),!oe)return;fe()}},[x,O]),VI(function(){S.colorPickerHSV.toggleClass("color-picker__hsv--hidden",D)},[D]),VI(function(){if(!D&&-1!==F){var e=S.colorPickerHSV;e.updating||e.hashColor===F||e.setColor(parseInt(F,16))}},[F,D]),VI(function(){var e=304;V&&(e+=24),e!==X&&(W(e),C.style.height="".concat(e,"px"),C._panelSize={width:244,height:e})},[V]),AI(function(){S.handleDocumentPointerDown&&(document.removeEventListener(BeFunky.pointerdown,S.handleDocumentPointerDown),S.handleDocumentPointerDown=null),x&&(S.handleDocumentPointerDown=_e,document.addEventListener(BeFunky.pointerdown,S.handleDocumentPointerDown))},[x,k]),AI(function(){"library"===q&&(te(0),ye())},[q]),n={picker:LI(NI(),(c="button button--icon button--grey-200 button--xs",h="".concat(c," button--selected"),d=Boolean(x&&x.resetColorEnabled),m=Boolean(x&&x.emptyEnabled),p=!BeFunky.isModalOpen(),g=le.colors.includes(F),LI(kI(),(a=-1===F||H<.5||(i=F,r=JI(i),"light"===sn()?r>225:r<40),o=H<1&&V,s={border:a?"1px solid var(--border-color)":"none",backgroundImage:-1===F||o?"url('".concat(BFN.imagesURL,"app/checker_pattern.jpg')"):"",backgroundPosition:a?"-1px -1px":"0 0"},l={opacity:H,background:-1===F?"none":"#".concat(F),border:a?"1px solid var(--border-color)":"none"},LI(BI(),zI(s),zI(l),de(),Me,De)),d?LI(PI(),c,ke,GI("reset-icon")):"",m?LI(EI(),c,ke,GI("no-color-icon")):"",p?LI(FI(),k?h:c,Ne,GI("color-picker-icon")):"",D?h:c,Pe,GI("mosaic-icon"),g?h:c,g?"added_to_library":"add_to_library",-1===F,Ee,GI(g?"checkmark-icon":"plus-icon"))),(["000000","4D4D4D","808080","B3B3B3","E6E6E6","FFFFFF","FF8686","FFB800","FCFF59","AFDF48","53E0E0","CC00FF","DB1400","FF6B00","F2DE25","41C036","3E9AEF","7600ED","7D0D00","7D4B00","9F8600","456500","000F99","530070"],LI(CI(),D?"":"color-picker__grid--hidden",be,Ie,Te,["000000","4D4D4D","808080","B3B3B3","E6E6E6","FFFFFF","FF8686","FFB800","FCFF59","AFDF48","53E0E0","CC00FF","DB1400","FF6B00","F2DE25","41C036","3E9AEF","7600ED","7D0D00","7D4B00","9F8600","456500","000F99","530070"].map(me))),S.colorPickerHSV,"display: ".concat(V?"":"none"),S.opacitySliderContainer,(6,u=I.length<6?[].concat(v(I.slice()),v(new Array(6-I.length).fill("EMPTY"))):I,LI(bI(),UI("recent_colors"),be,Ie,Te,u.map(function(e){return function(e){if("EMPTY"===e)return LI(TI());return me(e)}(e)})))),library:pe()},LI(MI(),"color-picker__tabs ".concat(Z?"color-picker__tabs--dragging-color":""),n,ge,xe,S.contextMenu);function de(){return-1===F?S.latestColorHash:F}function me(e){var t=x&&-1!==x.hashColor&&x.hashColor.toUpperCase()===e,n="color-picker__grid-square ".concat(t?"color-picker__grid-square--selected":""," button");return LI(SI(),n,e,"background-color: #".concat(e))}function pe(){if(!le.colors.length)return LI(II(),BFN.imagesURL,UI(["no_colors_in_library",{learn_more:'<a href="'.concat(BeFunky.Params.blogUrl,'improved-color-picker/" target="_blank" class="tutorial-link">').concat(UI("learn_more",!0),"</a>")}]));var e=le.colors;Z&&(e=e.slice(),Z.isOutside?e.splice(e.indexOf(Z.color),1):(e.splice(e.indexOf(Z.color),1),e.splice(Z.index,0,"EMPTY")));var t=X-40-28,n=BeFunky.isFirefox&&BeFunky.isWindows?"color-picker__library color-picker__library--win-firefox scrollable-content":"color-picker__library scrollable-content";return LI(_I(),n,"height: ".concat(t,"px"),be,Ie,Te,Se,Ce,Be,Fe,e.map(function(e,t){var n=x&&-1!==x.hashColor&&x.hashColor.toUpperCase()===e,i="color-picker__grid-square color-picker__grid-square--draggable ".concat(n?"color-picker__grid-square--selected":""," button"),r="EMPTY"===e?"border: 1px dashed var(--primary-500)":"background-color: #".concat(e);return LI(xI(),i,e,t,r,"EMPTY"===e?"":"#".concat(e))}))}function ge(e){if(ee&&"library"===e){var t="";return ie&&(t="tabs__indicator--animate"),LI(yI(),"tabs__indicator ".concat(t),ee)}}function fe(){if(-1!==F){var e=S.latestColorHash,t=[e].concat(v(I.filter(function(t){return t!==e}))).slice(0,6);t.isIdenticalTo(C.recentColors)||BFN.SettingsManager.updateSetting("colors_recent",t)}else S.latestColorHash=WI}function ve(e){var t=C.colorLibraries,n=t.find(function(e){return"default"===e.name})||{name:"default",colors:[]},i=JSON.parse(JSON.stringify(n));i.colors=e(i.colors),i.colors.length>n.colors.length&&te(ee+i.colors.length-n.colors.length),i.colors=i.colors.slice(0,100),BFN.SettingsManager.updateSetting("color_library",[i].concat(v(t.filter(function(e){return"default"!==e.name}))))}function ye(){requestIdleCallback(function(){v(C.querySelectorAll(".color-picker__grid-square--draggable")).filter(function(e){return!e.hasOwnProperty("dragging")}).forEach(function(e){return BFN.UI.draggableElement(e,e.parentElement,{fireMoveEvents:!0,eventDispatcher:e.parentElement})})})}function xe(e){var t=e.target.activeTab;if("library"===t&&!BFN.BfnService.userIsPlus&&le.colors.length)return e.target.activeTab="picker",we();K(t)}function _e(e){k||C.contains(e.target)||(e.target===x&&(e.target.ignoreNextClick=!0,setTimeout(function(){e.target.ignoreNextClick=!1},500)),C.colorButton=null)}function Ie(e){if(!Z){var t=e.target.hashColor;t&&E(t)}}function Te(){Z||x&&E(-1===x.hashColor?-1:x.hashColor.toUpperCase())}function be(e){if(!Z){var t=e.target.hashColor;t&&(E(t),se(!0),x.hashColor=t,x.dispatchEvent(XI),x.dispatchEvent(jI))}}function Se(e){e.preventDefault();var t=e.target.hashColor;t&&(S.contextMenu.show(e.pageX,e.pageY),S.lastContextMenuColorHash=t)}function Ce(e){var t=e.detail.draggedElement,n=t.hashColor,i=t.gridIndex;n&&(BFN.TooltipScreen.hide(),S.ghost=OI(fI(),GI("delete-icon"),t.cloneNode(!0)),BFN.DragScreen.showNode(S.ghost),J({color:n,index:i,isOutside:!1}))}function Be(e){var t=e.detail.dragTarget;if(!Z.isOutside&&!C.contains(t))return J({color:Z.color,index:Z.index,isOutside:!0}),void S.ghost.addClass("color-picker__ghost--delete");var n=t.hashColor,i=t.gridIndex;n&&"EMPTY"!==n&&i!==Z.index?(J({color:Z.color,index:i,isOutside:!1}),Z.isOutside&&S.ghost.removeClass("color-picker__ghost--delete")):Z.isOutside&&C.contains(t)&&(J({color:Z.color,index:le.colors.indexOf(Z.color),isOutside:!1}),S.ghost.removeClass("color-picker__ghost--delete"))}function Fe(){S.ghost=null,Z.isOutside?ve(function(e){return e.filter(function(e){return e!==Z.color})}):Z.index!==le.colors.indexOf(Z.color)&&ve(function(e){return e.splice(e.indexOf(Z.color),1),e.splice(Z.index,0,Z.color),e}),J(),ye()}function Ee(){if(-1!==F&&!le.colors.includes(F)){if(!BFN.BfnService.userIsPlus)return we();re(!0),ve(function(e){return[F].concat(v(e))})}}function Pe(){w(!D)}function ke(){E(-1),C._emptyButtonClicked=!0,z(1),UITools.setToolValue("color_picker_panel","intensity",100),UITools.updateToolControl("color_picker_panel_intensity"),x.hashColor=-1,x.dispatchEvent(XI),x.dispatchEvent(jI),C._emptyButtonClicked=!1}function Ne(){if(!k){N(!0);var e=BFN.MainUI.getFlattenedImage(),t=e.width,n=e.height,i=BFN.Stage.extract.pixels(e),r=BFN.Stage.view,a=document.querySelector(".upper-canvas"),o=QI(),s=o.x,l=o.y;s-=BFN.MainUI.x,BFN.EyeDropper.activate(e,s,l),document.addEventListener(BeFunky.pointermove,u,!0),document.addEventListener(BeFunky.pointerdown,c,!0),window.addEventListener("resize",c)}function u(){var e=QI(),t=e.x,n=e.y;BFN.EyeDropper.update(t,n)}function c(e){if(N(!1),document.removeEventListener(BeFunky.pointermove,u,!0),document.removeEventListener(BeFunky.pointerdown,c,!0),window.removeEventListener("resize",c),BFN.EyeDropper.deactivate(),e.type===BeFunky.pointerdown){e.preventDefault(),e.stopImmediatePropagation();var o=function(e){if(e.target!==r&&e.target!==a)return F;var o=BFN.appViewportRect;if(e.pageX<o.x||e.pageX>o.x+o.width||e.pageY<o.y||e.pageY>o.y+o.height)return F;return function(e,t,n,i){var r=QI(),a=r.x,o=r.y;if(a<0||o<0||a>=t||o>=n)return{hex:i,x:a,y:o};var s=o*t*4+4*a;return{hex:ZI.apply(void 0,v(e.slice(s,s+3))),x:a,y:o}}(i,t,n,F).hex.toUpperCase()}(e);o!==F&&(E(o),x.hashColor=o,x.dispatchEvent(XI),x.dispatchEvent(jI))}}}function Me(e){var t=e.target,n=t.value;if(n.startsWith("#")&&(n=n.slice(1)),n.length>6&&(n=n.slice(0,6)),n=n.toUpperCase(),/^[0-9A-F]{6}$/.test(n)){if(E(n),se(!0),!x)return;x.hashColor=n,x.dispatchEvent(XI),x.dispatchEvent(jI)}else t.value=de()}function De(e){e.target.select()}function we(){C.colorButton=null,BFN.FabricManager.currentTextTransformItem&&BFN.FabricManager.handleTextDeselected();var e=Date.now()+200;!function t(){if(Date.now()>=e)return;BFN.TooltipScreen.active&&BFN.TooltipScreen.hide();setTimeout(t,16)}(),BeFunky.openTeaserModal("color_management")}}function QI(){var e=BFN.MainUI.getPointerPosition(BFN.MainUI.pointerEvent),t=e.x,n=e.y;return{x:t=Math.round(t),y:n=Math.round(n)}}function ZI(e,t,n){return i(e)+i(t)+i(n);function i(e){var t=e.toString(16);return 1===t.length?"0".concat(t):t}}function JI(e){var t=parseInt(e,16);return.2126*(t>>16&255)+.7152*(t>>8&255)+.0722*(t>>0&255)}function $I(){var e=g(['\n        <p class="dialog__sub-heading">','</p>\n        <div class="survey__body-text">\n            <form id="survey_modal_form" class="survey__form" @submit=',">\n                ",'\n                <button class="button button--md button--blue survey__submit" style="margin-top: 20px;" type="submit">',"</button>\n            </form>\n        </div>"]);return $I=function(){return e},e}function eT(){var e=g(['\n            <label class="radio-button">\n                <input type="radio" name="survey" value=','>\n                    <span class="radio-button__circle"></span>\n                    <span class="radio-button__text">',"</span>\n            </label>"]);return eT=function(){return e},e}var tT=BeFunky.lit,nT=tT.html,iT=tT.appLang;BFN.EDITOR_MENU={},BFN.EDITOR_MENU.presetGenericMenuIDs={},BFN.EDITOR_MENU.presetBrushMenuIDs={},BFN.EDITOR_MENU.applyCancelMenuIDs={},BFN.mainMenuStates={editor:{primary:"editor_main_menu",secondary:null,tertiary:null},collage:{primary:"collage_main_menu",secondary:null,tertiary:null},designer:{primary:"designer_main_menu",secondary:null,tertiary:null},edit_layer:{primary:"editor_main_menu",secondary:"editor_edit_menu",tertiary:null}},BFN.activeMenuStateID=void 0;var rT,aT=[];function oT(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BFN.AppModel.sectionID,t=BFN.mainMenuStates[e];BFN.activeMenuStateID=e,sT(t.primary),t.secondary?sT(t.secondary):document.querySelectorAll(".secondary-panel .tool-menu.active").removeClass("active"),aT.includes(t.tertiary)&&(console.log("Preventing tertiary menu re-open",t.tertiary),t.tertiary=null),t.tertiary?sT(t.tertiary):document.querySelectorAll(".tertiary-panel .tool-menu.active").removeClass("active"),t.tertiary?showMenuPanel("tertiary"):t.secondary?showMenuPanel("secondary"):showMenuPanel("primary"),UIToggler.toggleMainMenu(BFN.AppModel.viewingEditor&&null!=BFN.PhotoEditorModel.currentTexture||BFN.AppModel.viewingDesigner||BFN.AppModel.viewingCollage),UIToggler.toggleZoomMenu(BFN.AppModel.viewingEditor&&null!=BFN.PhotoEditorModel.currentTexture||BFN.AppModel.viewingDesigner||BFN.AppModel.viewingCollage)}function sT(e,t){var n=t||document.getElementById(e);n?(v(n.parentElement.children).filter(function(e){return e!==n}).forEach(function(e){return e.removeClass("active")}),n.addClass("active"),cancelIdleCallback(rT),rT=requestIdleCallback(function(){n.hasClass("active")&&function(e){var t={editor_image_manager_menu:["image_manager",{left:"260px",top:"16px",positionFactor:.1}],designer_templates_menu:["template_search",{left:"260px",top:"16px",positionFactor:0}],editor_graphic_menu:["basic_shapes",{left:"260px",top:"156px",positionFactor:0}],editor_edit_menu:["image_enhancer",{left:"260px",top:"28px",positionFactor:.13}],editor_touch_up_menu:["portrait_enhancer",{left:"260px",top:"28px",positionFactor:.13}],clone_menu:["clone",{left:"228px",top:"86px",positionFactor:.775}],perfectskin_menu:["skin_heal"],wrinkles_menu:["wrinkles"],collage_layouts_menu:["collage_layouts",{left:"260px",top:"14px",positionFactor:0}],cutout_menu:["cutout",{left:"260px",top:"83px",positionFactor:.165}],collage_customize_menu:["resize_template",{left:"260px",top:"16px",positionFactor:0}],replace_color_menu:["replace_color",{left:"260px",top:"83px",positionFactor:.165}],blemish_fix_menu:["blemish_fix"]};if(t[e.id]){var n=f(t[e.id],2),i=n[0],r=n[1];if(r&&!r.wasSetup&&(BFN.HelpClueManager.setup(i,Object.assign({},r,{container:e.querySelector(".popover-placeholder")})),r.wasSetup=!0),"resize_template"===i&&BFN.AppModel.viewingCollage)return;BFN.HelpClueManager.show(i)}}(n)})):BeFunky.logError("Invalid Menu ID",e)}function lT(e,t){var n=document.createDocumentFragment();t.forEach(function(e){var t=e.id,i=e.icon,r=e.name,a=document.createElement("button").setClass("primary-panel__button button button--sm button--transparent");a.id=t,a.innerHTML='\n            <svg class="icon icon--20"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'.concat(i,'"></use></svg>\n            <string data-lang="').concat(r,'">').concat(BeFunky.LanguageManager.getString(r),"</string>\n        ").trim(),n.appendChild(a)}),document.getElementById(e).appendChild(n)}function uT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.disableButtons,r=void 0!==i&&i,a=n.getImagesToPreloadOnHover,o=void 0!==a&&a,s=document.getElementById(e).addClass("category-menu").addClass("scrollable-content"),l=document.createDocumentFragment(),u=1,c=0;t.forEach(function(e){var n=e.id,i=e.name,a=e.imageName,s=e.icon;t.length;l.appendChild(function(e,t,n,i,r,a,o,s,l){var u,c,h=document.createElement("button");if(h.setAttribute("id",i),h.setAttribute("class","button button--md button--has-image button-fullwidth button--grey-200"),o)u='<span class="button__image"><svg class="icon icon--20"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=\'#'.concat(o,"'></use></svg></span>");else{var d="".concat(BFN.imagesURL,"app/menu-backgrounds/");u='<span class="button__image button--sprite-'.concat(a,"-").concat(e,'" style="background-image:url(').concat(d,"bg-").concat(a,".jpg?auto=webp); background-position:0px ").concat(t,'px; background-size: 100%;"></span>')}h.innerHTML="\n        ".concat(u,'\n        <string data-lang="').concat(r,'">').concat(BeFunky.LanguageManager.getString(r),"</string>\n    "),l&&!BeFunky.isSafari&&h.addEventListener(BeFunky.pointerover,function e(){c=c||l(h);var t=!0;h.addEventListener(BeFunky.pointerout,function e(){h.removeEventListener(BeFunky.pointerout,e),t=!1}),requestIdleCallback(function n(){if(!c.length)return h.removeEventListener(BeFunky.pointerover,e);if(!t)return;var i=new Image;i.src=c.shift();i.onload=n})});return h.disabled=s,h}(u,c,0,n,i,a,s,r,o)),s||(u++,c-=28)}),s.appendChild(l)}function cT(e,t){var n={};t.forEach(function(e){var t=e.name,i=e.items,r=e.isOpen;n[t]={isOpen:void 0===r||!!r,content:i.map(function(e){var t=e.id,n=e.icon,i=e.name,r=e.isPlus,a=void 0!==r&&r,o=e.iconStroke,s=void 0===o||o;return'\n                <button id="'.concat(t,'" class="button button--grey-200 button--md button--has-icon button--fullwidth accordion__menu-button">\n                    <svg class="icon ').concat(s?"icon-stroke":"",'"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#').concat(n,'"></use></svg>\n                    <string data-lang="').concat(i,'">').concat(BeFunky.LanguageManager.getString(i),"</string>\n                    ").concat(a?'<span class="badge badge--plus"></span>':"","\n                </button>\n                ")}).join("")}});var i=document.getElementById(e).addClass("accordion");BFN.UI.accordionLayout(i,{sections:n})}function hT(e,t){var n=t.genericMenuID,i=t.brushMenuID,r=t.presetAmountSliderID,a=t.thumbnailPath,o=t.useFavoriteIcon,s=void 0!==o&&o,l=t.useBatchProcessingIcon,u=void 0!==l&&l,c=t.helpClueID,h=t.paintModeHelpClueID,d=document.getElementById("editor_tool_menu_container"),m=document.getElementById(n),p=document.getElementById(i),g=document.getElementById("editor_apply_cancel_menu");e.forEach(function(e){!0===s&&null===e.graphic&&(s=!1);var t=e.id,o=e.name,l="".concat(t,"_menu"),f=document.createElement("div");f.setAttribute("id",l),f.setAttribute("class","tool-menu"),f.innerHTML='\n            <panel-header lang-id="'.concat(e.langID||o,'" modifier="tertiary" clue-id="').concat(c,'" buttons="back"></panel-header>\n            <div class="popover-placeholder"></div>\n            <div class="menu-content scrollable-content"></div>\n        ');var v,y=f.querySelector("panel-header"),x=f.querySelector(".popover-placeholder"),_=f.querySelector(".menu-content");y.addEventListener("BACK",function(){UIToggler.cancelActiveEditorTool(),showMenuPanel("secondary")}),e.presets.forEach(function(o,l){var d,f=o.langID||e.langID||o.name||e.name,I=f!==o.name,T="".concat(t,"_").concat(o.id),b=o.presetSuffix||l+1,S=I?[f,{suffix:"".concat(b)}]:f,C=document.createElement("div");C.setAttribute("id","".concat(T,"_menu")),_.appendChild(C),a&&(v=v||224*(BeFunky.isRetina()?2:1),d="".concat(a).concat(o.thumb,"?auto=webp&width=").concat(v));var B=o.useGeneric,F=void 0===B||B,E=o.useBasicAmount,P=void 0===E||E,k=o.usePaint,N=void 0===k||k;BFN.UI.presetMenuItem(C,{presetID:T,presetLang:S,presetObject:o,useGeneric:F,usePaint:N,useFavoriteIcon:s,useBatchProcessingIcon:u,genericMenu:m,brushMenu:p,applyCancelMenu:g,imageThumbnailSrc:d,useProcessedThumb:!a,useBasicAmount:P,presetAmountSliderID:r,helpClueID:c,helpCluePlaceholder:x,paintModeHelpClueID:h,categoryHeader:c?y:null}),BFN.EDITOR_MENU.presetGenericMenuIDs[T]=n||null,BFN.EDITOR_MENU.presetBrushMenuIDs[T]=i||null,BFN.EDITOR_MENU.applyCancelMenuIDs[T]="editor_apply_cancel_menu"}),d.appendChild(f)})}function dT(e){!function(e){var t=UITools.getToolValue(e,"updating_id");switch(e){case"editor_main":case"collage_main":case"designer_main":UIToggler.cancelActiveEditorTool();var n="edit_layer"===BFN.activeMenuStateID?"editor":BFN.AppModel.sectionID;["graphic","layer_manager","text","image_manager"].includes(t)?n="editor":["customize","patterns"].includes(t)&&(n="collage"),sT("".concat(n,"_").concat(t,"_menu")),showMenuPanel("secondary"),"graphic"===t&&BFN.GraphicLibraryManager.loadTagsAndSetupMenu(),"overlay"===t&&BFN.OverlaysManager.loadCategories(),"patterns"===t&&BFN.CollageMakerPatternManager.loadCategories(),"templates"===t&&(BFN.DesignerTemplateManager.setupRecentProjects(),BFN.DesignerTemplateManager.preloadTags()),"text"===t&&BFN.PatchManager.loadTextPatches(),BFN.retrievePresetThumbHelperGraphics(t);break;case"editor_edit":case"editor_touch_up":case"editor_effect":case"editor_artsy":case"editor_frame":case"editor_texture":case"editor_overlay":case"editor_text":case"collage_layouts":case"collage_patterns":"editor_overlay"===e?t="overlay_".concat(t):"collage_layouts"===e?t="collage_layout_".concat(t):"collage_patterns"===e&&(t="collage_patterns_".concat(t));var i="".concat(t,"_menu"),r=document.getElementById("".concat(t,"_menu"));if("add_text"!==t&&"add_layer"!==t){sT(i,r),"editor_edit"===e&&BFN.setupAdjustAndPaintMenu(i,r),"editor_touch_up"===e&&BFN.setupTouchupPaintMenu(i,r),showMenuPanel("tertiary");var a=r.querySelectorAll(".preset-menu-item");a.length?(v(a).forEach(function(e){return e.generateItem()}),BFN.PresetMenuItemThumbManager.processItems(a)):BFN.AppModel.viewingEditor&&!aT.includes(i)&&aT.push(i)}var o=BFN.EDITOR_MENU.presetGenericMenuIDs[t];o&&(r.genericMenuContainer||r.querySelector(".generic_menu_container")).appendChild(document.getElementById(o));var s=BFN.EDITOR_MENU.presetBrushMenuIDs[t];if(s&&((r.brushMenuContainer||r.querySelector(".brush_menu_container")).appendChild(document.getElementById(s)),r.resetTabbedLayout&&r.resetTabbedLayout()),BFN.EDITOR_MENU.applyCancelMenuIDs[t]){var l=UITools.toolPlusHash[t];BFN.applyCancelMenu.upgradeMode=!!l&&!BFN.BfnService.userIsPlus,r.querySelector(".apply_cancel_menu_container").appendChild(BFN.applyCancelMenu)}"add_text"===t&&BFN.FabricManager.createNewText();break;case"editor_apply_cancel":if("apply"===UITools.getToolVO("editor_apply_cancel").updating_id&&BFN.applyCancelMenu.alternateApply)return;!BFN.AppModel.viewingEditor&&!BFN.TransformItemIsolator.active||BFN.TransformItemIsolator.usingAlternateMenu||(BFN.activePresetMenuItem?BFN.activePresetMenuItem.deselectItem():showMenuPanel("secondary",BFN.TransformItemIsolator.active&&!BFN.TransformItemIsolator.usingAlternateMenu?"edit_layer":"editor"))}}(e.data)}function mT(){BFN.appContainer.toggleClass("user-is-plus",BFN.BfnService.userIsPlus),v(document.querySelectorAll(".popover")).forEach(function(e){return e.updateDisplay()})}BFN.readyApp=function(e){try{PIXI.utils.skipHello()}catch(e){PIXI.utils._saidHello=!0}try{BFN.PIXIScaleMode=PIXI.settings.SCALE_MODE}catch(e){BFN.PIXIScaleMode=PIXI.SCALE_MODES.DEFAULT}BFN.appContainer=document.getElementById("bfn-app"),un(function(e){BFN.appContainer.addClass("bfn--toggling-theme"),requestAnimationFrame(function(){BFN.appContainer.toggleClass("bfn--dark-theme","dark"===e),requestAnimationFrame(function(){BFN.appContainer.removeClass("bfn--toggling-theme")})})}),window.setupShowMenuPanel();var t=BeFunky.trackUserTiming("App Init","singleton_queue","browser");BFN.SingletonQueue.process(),t();var n=BeFunky.trackUserTiming("App Init","shader_pool","browser");BFN.ShaderManager.createShaderPool(function(){n();var t=BeFunky.trackUserTiming("App Init","init_ui","browser");window.dispatchEvent(new Event("INIT")),BeFunky.cleanupEnterAppImmediately(),BeFunky.showLoadScreen(),function(){BFN.UI.accountMenu(document.getElementById("account_menu")),function(){UITools.addEventListener(UIToolsEvents.UPDATE_TOOL.type,dT),BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,mT);var e,t=BFN.appContainer;BFN.BfnService.userIsPlus&&t.addClass("user-is-plus");BeFunky.isDropShadowSupported||t.addClass("drop-shadow-not-supported");(function(){if(BeFunky.isChromium)return BeFunky.chromiumVersion>=84;if(BeFunky.isFirefox)return BeFunky.firefoxVersion>=63;var e=document.createElement("div").setStyles({display:"flex",flexDirection:"column",rowGap:"1px"});e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),document.body.appendChild(e);var t=1===e.scrollHeight;return e.parentNode.removeChild(e),t})()||t.addClass("flexbox-gap-not-supported");BeFunky.isTablet&&t.addClass("bfn--is-tablet");BFN.UI.applyCancelUpgradeButtons(BFN.applyCancelMenu,{id:"editor_apply_cancel"}),UIToggler.alternateMenu.addEventListener(BeFunky.pointerdown,function(e){e.stopImmediatePropagation(),BFN.ColorPickerPanel.colorButton=null,"transform_menu_popover_button"!==e.target.id&&document.getElementById("transform_menu_popover").hideUnlessPressed(),"text_edit_spacing_menu_popover_button"!==e.target.id&&document.getElementById("text_edit_spacing_menu_popover").hideUnlessPressed()}),HI("color-picker",KI),BFN.ColorPickerPanel=document.getElementById("color_picker_panel_haunted"),BeFunky.isWindows&&BeFunky.isFirefox&&BFN.ColorPickerPanel.addClass("color-picker--win-firefox");v(BFN.appContainer.querySelectorAll(".popover")).forEach(function(e){return BFN.UI.popover(e)}),BFN.appContainer.addEventListener("click",function(e){var t,n=e.target;if(n&&n.nodeName&&"A"===n.nodeName){var i=n.getAttribute("data-bfntrack");if(i){var r=i.split("|");if(3!==r.length)return BeFunky.logError("Malformed data-bfntrack attribute: ".concat(i),n);(t=BFN.BfnService).track.apply(t,v(r))}}}),document.addEventListener("visibilitychange",function(){clearTimeout(e),"visible"!==document.visibilityState?BFN.tabRecentlyReopened=!1:(BFN.tabRecentlyReopened=!0,e=setTimeout(function(){BFN.tabRecentlyReopened=!1},1e4),BeFunky.setLocal("lastAppSection",BFN.AppModel.sectionValue("Photo Editor","Collage Maker","Designer")))}),window.addEventListener("resize",BeFunky.debounce(function(){if(BeFunky.html5app_created){if(BFN.FabricManager.iTextEditing&&BeFunky.isAndroid)return;BFN._appRect=null,BFN.BfnService.dispatchEvent(BFN.BfnServiceEvents.CUSTOM_RESIZE_EVENT)}},"raf")),n=document.getElementById("app_goto_photo_editor"),i=document.getElementById("app_goto_collage_maker"),r=document.getElementById("app_goto_designer"),a=document.querySelectorAll(".navbar-center .editor-include"),o=document.querySelectorAll(".navbar-center .designer-include"),window.handleAppViewstateUpdated=function(){UIToggler.cancelActiveEditorTool(),a.setStyles({display:BFN.AppModel.viewingEditor?"":"none"}),o.setStyles({display:BFN.AppModel.viewingDesigner?"":"none"}),n.disabled=BFN.AppModel.viewingEditor,i.disabled=BFN.AppModel.viewingCollage,r.disabled=BFN.AppModel.viewingDesigner,BFN.BfnService.track("CREATE","APPMODE",BFN.AppModel.sectionValue("PHOTOEDITOR","COLLAGE","DESIGNER"));var e,t,s=BFN.AppModel.sectionValue("editor","collage","designer"),l=!BFN.openedSections.length;l&&BeFunky.hideLoadScreen(),BFN.IndexedDB.ignoreAutosaveNextSession&&BeFunky.setLocal("ignore_autosave__".concat(s),"true"),"editor"===s&&(BeFunky.addToServiceWorkerCache("data-files","".concat(BFN.assetsURL,"datas/textures_thumbs.xml")),BeFunky.addToServiceWorkerCache("data-files","".concat(BFN.assetsURL,"datas/effect_thumbs").concat(BFN.assetsDataVersions.effects_thumbs_data,".json"))),function(e,t){var n,i=BFN.AppModel.sectionID;if((BFN.AppModel.viewingEditor&&BFN.hasEnteredEditor||BFN.AppModel.viewingCollage&&BFN.hasEnteredCollage||BFN.AppModel.viewingDesigner&&BFN.hasEnteredDesigner)&&(t=function(){}),BeFunky.projectToOpenInSection[i]){var r=BeFunky.projectToOpenInSection[i],a=r.projectVO,o=r.userSavedProjectData;delete BeFunky.projectToOpenInSection[i],a?n=function(){return BFN.ProjectManager.loadProject(a).catch(function(e){return new Promise(function(t,n){BFN.ProjectManager.handleOpenProjectError(e,i,a.filename).then(function(){return n(e)})})})}:o?n=function(){return BeFunky.SavedProjectManager.openUserSavedProject(o).then(function(e){if("pending_section_change"===e)throw BeFunky.throwError("Unexpected section change",BFN.AppModel.sectionID,o),"pending_section_change"})}:BeFunky.throwError("ProjectVO or userSavedProjectData required")}if(BFN.AppModel.viewingEditor&&(!BFN.hasEnteredEditor&&!BFN.ImageEditManager.editingImage||BFN.editorProjectShelved)){if(BFN.hasEnteredEditor=!0,BeFunky.editorExternalImage&&BeFunky.editorExternalImage.ignoreExistingProject)return h(function(){BFN.DeepLinkManager.handleEditorDeepLink(),t()});c(!1),u(function(){if(BeFunky.editorExternalImage)return h(function(){BFN.DeepLinkManager.handleEditorDeepLink()});c(!0),BFN.DeepLinkManager.handleEditorDeepLink(),Promise.all([BFN.ProjectService.clearLocalAssets("editor"),BFN.ProjectService.removeLocalProject("editor")]).catch(function(e){BeFunky.throwError(e,"Unable to clear existing Photo Editor project")})},function(){BeFunky.editorExternalImage=null})}else c(),BFN.AppModel.viewingEditor&&!BFN.ImageEditManager.editingImage&&(n?n().catch(function(e){"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e)}):BeFunky.editorExternalImage&&BeFunky.editorExternalImage.ignoreExistingProject?h(function(){BFN.DeepLinkManager.handleEditorDeepLink()}):BFN.DeepLinkManager.handleEditorDeepLink(),BeFunky.editorExternalImage=null);if(BFN.AppModel.viewingCollage&&!BFN.hasEnteredCollage){BFN.hasEnteredCollage=!0,UITools.setToolValue("collage_main","image_manager",!0),UITools.applyTool("collage_main"),UITools.setToolValue("collage_main","image_manager",!1);var s=function(){v(document.querySelectorAll("#collage_layouts_category_menu button")).forEach(function(e){e.disabled=!1}),u(function(){BFN.ProjectService.clearLocalAssets("collage"),BFN.CollageMakerCanvasPhotoGrid.initInitialTemplate()})};BFN.CollageMakerTemplateData.loadTemplateData({showLoadScreen:!n}).then(s,function e(t){BeFunky.throwError("Failed to fetch collage layouts: ".concat(t)),BeFunky.confirm(BeFunky.failureReason(t),{confirmText:"try_again",onConfirm:function(){return BFN.CollageMakerTemplateData.loadTemplateData().then(s,e)}})})}else BFN.AppModel.viewingCollage&&n&&n().catch(function(e){"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e)});if(BFN.AppModel.viewingDesigner&&!BFN.hasEnteredDesigner){BFN.hasEnteredDesigner=!0,UITools.setToolValue("designer_main","templates",!0),UITools.applyTool("designer_main"),UITools.setToolValue("designer_main","templates",!1);var l=function(){if(BeFunky.testingFlags.includes("set_default_designer_template")){var e=window.location.search.match(/default_designer_template=([a-z0-9_]+)/);if(e)return BFN.DesignerTemplateManager.loadTemplateForTesting(e[1]),!0;BeFunky.logError("Unable to get default designer template ID for testing")}return!1};u(function(){if(!l()){var e=window.currentDeepLinkParameters,t=e.tag,n=e.template;t||!n?(BFN.DesignerModel.loadBlankProject(),BFN.DeepLinkManager.handleDesignerDeepLink()):BFN.DesignerTemplateManager.applyTemplate({id:n})}},function(e){l()||e||BFN.DeepLinkManager.handleDesignerDeepLink()})}else BFN.AppModel.viewingDesigner&&n?n().catch(function(e){"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e)}):BFN.AppModel.viewingDesigner&&BFN.DeepLinkManager.handleDesignerDeepLink();function u(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},o="true"===BeFunky.getLocal("force_use_autosave__".concat(i));o&&BeFunky.removeLocal("force_use_autosave__".concat(i));var s="true"===BeFunky.getLocal("ignore_autosave__".concat(i));if(s&&BFN.IndexedDB.indexedDBReady.then(function(e){e&&BeFunky.removeLocal("ignore_autosave__".concat(i))}),n)n().then(t,function(e){"cancelled_by_user"!==e&&BeFunky.logError("Failed to open queued project",e),BFN.SettingsManager.getSetting("autosave").then(function(e){"no"===e?h():u()})});else{if(BFN.AppModel.viewingEditor&&BFN.editorProjectShelved)return BFN.editorProjectShelved=!1,u();if(s)return BeFunky.logWarning("Ignoring ".concat(i," autosave after IndexedDB was disabled halfway through prior session.")),h();if(o)return BeFunky.logWarning("Attempting to restore ".concat(i," autosave after prior session crashed.")),u();BeFunky.showLoadScreen();var l=e?BeFunky.trackUserTiming("App Init","user_settings",BFN.BfnService.userLoggedIn?"network":"IndexedDB"):function(){};BFN.SettingsManager.getSetting("autosave").then(function(e){return l(),BeFunky.hideLoadScreen(),"yes"===e?u():"no"===e?h():void BFN.ProjectService.getLocalProject(i,{excludeAssets:!0,showLoadScreen:!0}).then(function(e){if(!0===e._wasReset)return BeFunky.logError("Loading recently reset project without asking user"),u(e);var t,n=!1;(t=e,BFN.ProjectManager.getThumbnailHtmlForDialog(t.thumbBase64,{width:t.projectWidth,height:t.projectHeight}).catch(function(){return""}).then(function(e){return"".concat(e,'\n                    <div data-lang="confirm_load_autosave">\n                        ').concat(BeFunky.LanguageManager.getString("confirm_load_autosave"),'\n                    </div>\n                    <div class="checkbox" style="margin-top: 1rem;">\n                        <input type="checkbox" id="persist_autosave_choice">\n                        <label class="checkbox__label" for="persist_autosave_choice">\n                        <span class="checkbox__box checkbox__box--sm">\n                            <svg class="icon checkbox__icon icon--12">\n                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#checkmark-icon"></use>\n                            </svg>\n                        </span>\n                            <string data-lang="set_default_setting">').concat(BeFunky.LanguageManager.getString("set_default_setting"),"</string>\n                        </label>\n                    </div>\n                ")})).then(function(t){BeFunky.confirm(t,{onConfirm:function(){n&&BFN.SettingsManager.updateSetting("autosave","yes"),u(e,!0)},onCancel:function(){n&&BFN.SettingsManager.updateSetting("autosave","no"),h()},confirmText:"continue_editing",cancelText:"start_new"});var i=document.getElementById("persist_autosave_choice");i.addEventListener("change",function(){n=i.checked})})},function(e){c(e)})})}function u(n){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=function(){},s=n?BFN.ProjectService.addImagesToProject(n,{showLoadScreen:!0,fallbackToCanvas:!1}):BFN.ProjectService.getLocalProject(i,{showLoadScreen:!0,fallbackToCanvas:!1});s.then(function(t){return e&&(o=BeFunky.trackUserTiming("App Init","autosaved_project_fonts","network")),BFN.ParseBFD.prepareV2(t)}).then(function(e){o();var t=BFN.ProjectManager.getProjectVO(e);return t._isLocalProject=!0,BFN.ProjectManager.loadProject(t)}).then(function(){var e={editor:BFN.PhotoEditorModel,collage:BFN.CollageMakerModel,designer:BFN.DesignerModel};e[i].hasUnsavedChanges=!0,a(r),t()}).catch(function(e){c(e)})}function c(e){if(BeFunky.hideLoadScreen(),"invalid_editor_image_blob"===e)return BeFunky.confirm("error_load_autosave",{confirmText:"try_again",cancelText:"start_new",onConfirm:function(){window.onbeforeunload=null,window.location.reload()},onCancel:h});"No saved project exists"!==e&&BeFunky.logError(e),h()}function h(){r(),t()}}function c(e){void 0===e&&(e=BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture),UIToggler.toggleSampleImagePopover(e),UIToggler.toggleSaveButtons(!e)}function h(e){BFN.hasFullyOpenedEditor=!0;var t=BeFunky.editorExternalImage.loadImage;BeFunky.editorExternalImage=null,console.log("Loading external image in Photo Editor"),t(),"function"==typeof e&&e()}}(l,function(){var e=BFN.AppModel.sectionValue("editor","collage","designer");s===e?(BFN.openedSections.push(s),console.log("".concat(s," opened for the first time")),BFN.AppModel.viewingEditor&&(BFN.hasFullyOpenedEditor=!0),BFN.openedSections.length>1||requestIdleCallback(function(){BFN.BfnService.onUserLogin(function(){BeFunky.User&&BeFunky.User.isNewUser||BeFunky.showAnnouncementOnce("color_management").then(function(e){e||BeFunky.showAnnouncementOnce("layer_effects").then(function(e){e||function(e){if(!BeFunky.beforeInstallPromptEvent)return e(!1);BeFunky.showAnnouncementOnce("pwa",{onConfirm:function(){BeFunky.beforeInstallPromptEvent.prompt(),BeFunky.beforeInstallPromptEvent.userChoice.then(function(e){"accepted"===e.outcome?BFN.BfnService.track("PROMOTION","PWA","Accepted - Installed"):BFN.BfnService.track("PROMOTION","PWA","Accepted - Not Installed")})},onCancel:function(e){BFN.BfnService.track("PROMOTION","PWA","Dismissed - ".concat(e?"Ask me later":"Click outside / Escape"))}}).then(function(t){t&&BFN.BfnService.track("PROMOTION","PWA","Shown"),e(t)})}(function(e){e||BeFunky.isPlus()&&BFN.SettingsManager.getSetting("use_case").then(function(e){e||(BeFunky.isModalOpen()?console.log("Not showing survey b/c another modal is open"):function(){var e=[{value:"educator",text:"survey_educator"},{value:"student",text:"survey_student"},{value:"small_business",text:"survey_small_business"},{value:"large_company",text:"survey_large_company"},{value:"nonprofit",text:"survey_nonprofit"},{value:"personal",text:"survey_personal"}];function t(e){return nT(eT(),e.value,iT(e.text))}var n=BeFunky.openNebulaDialog({heading:"welcome_back",body:function(){return nT($I(),iT("survey_use_case_prompt"),i,e.map(t),iT("submit"))},modalOptions:{size:"medium",isForm:!0}});function i(e){e.preventDefault();var t=this.querySelector('input[name="survey"]:checked');t&&t.value&&(BFN.SettingsManager.updateSetting("use_case",t.value),n(),UIMessages.display("thank_you_befunky"))}}())})})})})})})):BeFunky.throwError("Section changed while in section opener from ".concat(s," to ").concat(e))}),e=document.querySelector("#app_goto_button string"),t=BFN.AppModel.sectionValue("photo_editor","collage_maker","graphic_designer"),e.setLang(t),oT()},BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,window.handleAppViewstateUpdated);var n,i,r,a,o}(),function(){lT("editor_main_menu",BFN.UIMenuData.mainMenus.editor),lT("collage_main_menu",BFN.UIMenuData.mainMenus.collage),lT("designer_main_menu",BFN.UIMenuData.mainMenus.designer);var e,t,n,i=document.getElementById("primary-panel"),r=!1,a={};i.addEventListener("click",function(n){r||n.target!==i?(r||t)&&"BUTTON"===n.target.nodeName&&(s(),(e=n.target).ignoreNextClick&&n.stopImmediatePropagation()):(UIToggler.cancelActiveEditorTool(),showMenuPanel("primary"))},!0);var o=450;function s(){if(t&&(t(),t=void 0),r){var e=requestAnimationFrame(l);n=function(){return cancelAnimationFrame(e)}}}function l(){r=!1,i.removeClass("primary-panel--expanded"),n=void 0}function u(){r=!0,t=void 0;var e="".concat(BFN.AppModel.sectionID,"-").concat(BeFunky.LanguageManager.language.app);if(a[e])return c(a[e]),void i.addClass("primary-panel--expanded");i.addClass("primary-panel--expanded").setStyles({transition:"none",width:"auto"}).style.setProperty("--primary-side-menu-expanded-button-width","auto");var n=Math.ceil(i.getBoundingClientRect().width);c(n),a[e]=n,i.removeClass("primary-panel--expanded").setStyles({width:""}),requestAnimationFrame(function(){i.addClass("primary-panel--expanded").setStyles({transition:""})})}function c(e){i.style.setProperty("--primary-side-menu-expanded-width","".concat(e,"px")),i.style.setProperty("--primary-side-menu-expanded-button-width","".concat(e-24,"px"))}i.addEventListener("pointerover",function(a){var s=a.target;if(BeFunky.isPointerDown)return;if(s===i)return;if(r||t)return;if(e&&("BUTTON"!==s.nodeName||s===e))return;n&&(n(),n=void 0);var l=setTimeout(function(){var e=requestAnimationFrame(u);t=function(){return cancelAnimationFrame(e)}},e?0:o);t=function(){return clearTimeout(l)}}),i.addEventListener("pointerleave",function(){e=void 0,s()})}(),cT("editor_edit_accordion_menu",BFN.UIMenuData.accordionMenus.editor_edit),cT("editor_touch_up_accordion_menu",BFN.UIMenuData.accordionMenus.editor_touch_up),uT("editor_effect_category_menu",BFN.UIMenuData.categoryMenus.editor_effect),uT("editor_artsy_category_menu",BFN.UIMenuData.categoryMenus.editor_artsy,{getImagesToPreloadOnHover:function(e){var t="".concat(e.id.replace("editor_artsy_",""),"_menu"),n=document.querySelectorAll("#".concat(t," .preset-menu-item"));return v(n).map(function(e){return e.imageThumbnailSrc})}}),uT("editor_frame_category_menu",BFN.UIMenuData.categoryMenus.editor_frame),uT("editor_overlay_category_menu",BFN.UIMenuData.categoryMenus.editor_overlay,{disableButtons:!0}),uT("editor_texture_category_menu",BFN.UIMenuData.categoryMenus.editor_texture),uT("collage_layouts_category_menu",BFN.UIMenuData.categoryMenus.collage_layouts,{disableButtons:!0}),uT("collage_patterns_category_menu",BFN.UIMenuData.categoryMenus.collage_patterns,{disableButtons:!0}),v(document.querySelectorAll("#tertiary-panel panel-header")).forEach(function(e){BFN.BatchToolManager.batchEditToolIDs.includes(e.langId)&&BFN.BatchIconManager.registerPanelHeader(e,e.langId),e.addEventListener("BACK",function(){UIToggler.cancelActiveEditorTool()})}),Object.entries(BFN.UIToolData).forEach(function(e){var t=f(e,2),n=t[0],i=t[1];i.ignoreInitialControlRegister||(BFN.EDITOR_MENU.presetGenericMenuIDs[n]=i.hasOwnProperty("genericMenuID")?i.genericMenuID:null,BFN.EDITOR_MENU.presetBrushMenuIDs[n]=i.hasOwnProperty("brushMenuID")?i.brushMenuID:null,BFN.EDITOR_MENU.applyCancelMenuIDs[n]=i.hasOwnProperty("applyCancelMenuID")?i.applyCancelMenuID:null,Object.entries(i.controls).forEach(function(e){var t=f(e,2),n=t[0],i=t[1];i.hasOwnProperty("type")?"static"!==i.type&&(document.getElementById(n)?UITools.registerControl(n):"slider_item"!==i.type&&i.type):BeFunky.logError('Control Object "'.concat(n,'" has no type'))}))}),hT(BFN.EffectData,{genericMenuID:"effect_generic_menu",brushMenuID:"effect_brush_menu",presetAmountSliderID:"effect_generic_amount",useFavoriteIcon:!0,useBatchProcessingIcon:!0,helpClueID:"effect_basic_settings_favorites",paintModeHelpClueID:"erase_mode"}),hT(BFN.ArtsyData,{genericMenuID:"artsy_generic_menu",brushMenuID:"artsy_brush_menu",presetAmountSliderID:"artsy_generic_amount",thumbnailPath:BFN.artsyThumbURL,useFavoriteIcon:!0,helpClueID:"effect_basic_settings_favorites",paintModeHelpClueID:"erase_mode"}),hT(BFN.TextureData,{genericMenuID:"texture_generic_menu",brushMenuID:"texture_brush_menu",presetAmountSliderID:"texture_generic_opacity",helpClueID:"effect_basic_settings",paintModeHelpClueID:"erase_mode"}),hT(BFN.LensFlareData.menuData,{genericMenuID:"lens_flare_generic_menu",brushMenuID:null,presetAmountSliderID:"lens_flare_generic_intensity",helpClueID:"effect_lens_flare"}),hT(BFN.FrameData.crop_rotate,{genericMenuID:"frame_crop_rotate_generic_menu",brushMenuID:null,presetAmountSliderID:"frame_crop_rotate_generic_position",helpClueID:"effect_basic_settings_frames"}),hT(BFN.FrameData.crop,{genericMenuID:"frame_crop_generic_menu",brushMenuID:null,presetAmountSliderID:"frame_crop_generic_position",helpClueID:"effect_basic_settings_frames"}),hT(BFN.FrameData.full,{genericMenuID:"frame_full_generic_menu",brushMenuID:null,presetAmountSliderID:"frame_full_generic_position",helpClueID:"effect_basic_settings_frames"}),function(){try{BFN.isWebCamSupported()||document.getElementById("editor_load_image_webcam").setStyles({display:"none"})}catch(e){}v(document.querySelectorAll(".navbar-dropdown")).forEach(function(e){var t={};"editor_load_image_menu"===e.id?(t.onOpen=function(){UIToggler.toggleSampleImagePopover(!1)},t.onClose=function(){setTimeout(function(){var e=BeFunky.getModal("image_library"),t=BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture&&!(e&&e.isVisible);UIToggler.toggleSampleImagePopover(t,!0)},300)}):"editor_save_image_menu"===e.id?t.onDisabledClick=function(){BFN.AppModel.viewingEditor&&!BFN.PhotoEditorModel.currentTexture&&UIToggler.toggleSampleImagePopover(!0,!0)}:"account_menu_dropdown"===e.id&&(t.onOpen=function(){window.zE&&window.zE.hide()}),BFN.UI.navbarDropdown(e,t)}),document.querySelector(".navbar__logo").addEventListener("click",function(){function e(){BFN.AppModel.removeEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,e),BeFunky.confirm("confirm_hide",{onConfirm:BFN.BfnService.hideEditor,confirmText:"yes",cancelText:"no"})}BFN.ImageEditManager.editingImage?(BFN.AppModel.addEventListener(BFN.AppModelEvents.VIEWSTATE_UPDATED.type,e),BFN.AppModel.viewState=BFN.ImageEditManager.targetViewstate):e()}),BFN.CollageWizardModal=document.getElementById("collage_wizard"),BFN.UI.collageWizardModal(BFN.CollageWizardModal),BFN.ZoomRegion=document.getElementById("zoom_region"),BFN.UI.zoomRegion(BFN.ZoomRegion),[{callback:function(e,t,n){var i=e.slider,r=i.noUiSlider.options.step||1,a="left"===t||"right"===t?0:r*("up"===t?9:-9);a&&"keydown"===n.type&&i.noUiSlider.set(parseFloat(i.noUiSlider.get())+a);var o="keydown"===n.type?"slide":"end",s=i.noUiSlider.get();i.update(o,s)},condition:function(e){return!!e.slider}}].forEach(function(e){return BeFunky.addArrowKeyHandler(e)}),document.addEventListener("keyup",function(e){if("Enter"===e.key||13===e.keyCode){var t=e.target;"INPUT"===t.nodeName&&["checkbox","radio"].includes(t.type)&&BFN.appContainer.contains(t)&&("checkbox"===t.type?(t.checked=!t.checked,t.dispatchEvent(new Event("change"))):t.checked||(t.checked=!0,t.dispatchEvent(new Event("change"))))}}),BeFunky.isIPadOS&&document.getElementById("zoom_full_screen").setStyles({display:"none"}).nextElementSibling.setStyles({marginLeft:0});BeFunky.isChromeOnIOS&&document.getElementById("batch_processing_open_modal").setStyles({display:"none"})}(),UIToggler.toggleMainMenu(!1),UIToggler.toggleZoomMenu(!1);var e=document.getElementById("alternateMenu"),t=BFN.ColorPickerPanel,n=document.getElementById("zoom_menu");document.addEventListener(BeFunky.pointerdown,function(i){var r=i.target;if((!r||!r.preventItemDeselect)&&BFN.TransformModel.selectedTransformItem&&!BFN.ColorPickerPanel.eyeDropperActive&&!(r.hasClass&&r.hasClass("context-menu__item")||e.contains(r)||t.contains(r)||BFN.FontManager.fontMenuComponent&&BFN.FontManager.fontMenuComponent.contains(r)))if(n!==r&&n.contains(r))r.preventItemDeselect=!0;else if(!BeFunky.isModalOpen()&&!BeFunky.isLoadScreenActive()){var a=v(document.querySelectorAll(".draggable-panel")),o=!1;if(a.forEach(function(e){e.hasClass("active")&&e.contains(r)&&(o=!0)}),!o){UIToggler.isAlternateMenuActive&&BFN.mainMenuStates[BFN.activeMenuStateID].tertiary&&i.target&&i.target.hasClass("primary-panel__button")&&i.target.hasClass("active")&&(i.target.ignoreNextClick=!0,setTimeout(function(){i.target.ignoreNextClick=!1},500));var s=i.pageX,l=i.pageY,u=BFN.appViewportRect;if(s<u.x||s>u.x+u.width||l<u.y||l>u.y+u.height)return function(){if(Date.now()-UITools.lastClickTime<400)return void console.log("Transform item de-selection ignored on double-click");BFN.AppModel.sectionValue(BFN.PhotoEditorCanvas,BFN.CollageMakerCanvas,BFN.DesignerCanvas).transformLayer.deselectItem()}()}}},!0),document.querySelector(".navbar").addEventListener("click",function(e){var t=BFN.AppModel.sectionValue(BFN.PhotoEditorCanvasModel,BFN.CollageMakerCanvasModel,BFN.DesignerCanvasModel);t.canvasScaling&&e.stopPropagation()},!0),function(){var e=!1,t=document.getElementById("zendesk_help_button"),n=!1,i=!1,r=!1;t.addEventListener("click",function(t){if(t.stopPropagation(),!e){if(n)return window.zE("webWidget","close"),void(n=!1);r=!1;var l=function(){var t,n;i=!0,o(),a||(a=!0,BeFunky.LanguageManager.addLanguageUpdateListener(o)),e=!1,BeFunky.hideLoadScreen(),s(),BeFunky.waitUntil({condition:function(){return!!r||!!(t=t||document.getElementById("webWidget"))&&(n=t.contentDocument.querySelector("style"),Boolean(n))},onTimeout:function(){BeFunky.reportWarning("Failed to inject Zendesk styles",t,n)},onSuccess:function(){r||(n.insertAdjacentHTML("beforebegin",'\n        <style>\n            div[data-embed="ticketSubmissionForm"] form > div > div > div:nth-child(3) {\n                display: none;\n            }\n            footer > div > a[href^="https://www.zendesk.com/embeddables/"] {\n                visibility: hidden;\n            }\n        </style>'),r=!0)},interval:200,maxAttempts:50})};e=!0,BeFunky.showLoadScreen(),window.getSystemInformation(!0).catch(function(e){return BeFunky.throwError(e,"Unable to get system information"),""}).then(function(e){return console.log("init zendesk",e),window.zESettings={webWidget:{position:{horizontal:"right",vertical:"top"},offset:{horizontal:"-8px",vertical:"64px"},color:{header:"#5D5B75",button:"#3A36E4",articleLinks:"#3A36E4"},contactForm:{fields:[{id:360004395771,prefill:{"*":e}}]}}},new Promise(function(e,t){if(window.zE)return i();var n=document.createElement("script");function i(){BeFunky.waitUntil({condition:function(){return"function"==typeof window.zE.activate},onSuccess:e,onTimeout:t,maxAttempts:100})}n.id="ze-snippet",n.src="https://static.zdassets.com/ekr/snippet.js?key=9c4d8d68-edce-4ce7-bc08-02c49d971e00",n.onerror=t,n.onload=i,document.head.appendChild(n)})}).then(function(){i||(window.zE("webWidget:on","close",function(){n=!1}),window.zE("webWidget:on","userEvent",function(e){"Web Widget Minimised"===e.action&&(n=!1)})),window.zE("webWidget","open"),window.zE("webWidget","show"),n=!0,l()},function(t){BeFunky.throwError("Unable to load Zendesk Widget",t),e=!1,BeFunky.hideLoadScreen()})}});var a=!1;function o(){window.zE.setLocale&&window.zE.setLocale(BeFunky.LanguageManager.language.app)}function s(){BFN.BfnService.removeEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,s),BeFunky.User.email?window.zE("webWidget","identify",{email:BeFunky.User.email}):BFN.BfnService.addEventListener(BFN.BfnServiceEvents.USER_DATA_CHANGED.type,s)}}()}(),window.dispatchEvent(new Event("INIT_COMPLETE")),t(),"function"==typeof e&&e()})},BFN.updateAppMenuDisplay=oT,BFN.adjustAndPaintMenus={background_menu:{toolID:"background",controlData:BFN.UIToolData.background.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024821391",tutorialName:"BACKGROUND",tabIDs:["fill","erase"],eraseHelpClueID:"erase_mode_background"},blur_menu:{toolID:"blur",controlData:BFN.UIToolData.blur.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/210432543",tutorialName:"BLUR"},lens_blur_menu:{toolID:"lens_blur",controlData:BFN.UIToolData.lens_blur.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027639771",tutorialName:"LENS_BLUR"},exposure_menu:{toolID:"exposure",controlData:BFN.UIToolData.exposure.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/208612466",tutorialName:"EXPOSURE"},levels_menu:{toolID:"levels",controlData:BFN.UIToolData.levels.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025676532",tutorialName:"LEVELS"},vibrance_menu:{toolID:"vibrance",controlData:BFN.UIToolData.vibrance.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024933592",tutorialName:"VIBRANCE"},color_menu:{toolID:"color",controlData:BFN.UIToolData.color.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025170471",tutorialName:"COLOR"},replace_color_menu:{toolID:"replace_color",controlData:BFN.UIToolData.replace_color.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360010912612",tutorialName:"REPLACE_COLOR",adjustHelpClueID:"replace_color"},fill_light_menu:{toolID:"fill_light",controlData:BFN.UIToolData.fill_light.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360015199512",tutorialName:"FILL_LIGHT"},sharpen_menu:{toolID:"sharpen",controlData:BFN.UIToolData.sharpen.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/210193063",tutorialName:"SHARPEN"},clarity_menu:{toolID:"clarity",controlData:BFN.UIToolData.clarity.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024853032",tutorialName:"CLARITY"},tint_menu:{toolID:"tint",controlData:BFN.UIToolData.tint.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025626252",tutorialName:"TINT"},beautify_menu:{toolID:"beautify",controlData:BFN.UIToolData.beautify.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024868452",tutorialName:"BEAUTIFY"},color_mixer_menu:{toolID:"color_mixer",controlData:BFN.UIToolData.color_mixer.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025732132",tutorialName:"COLOR_MIXER"},auto_enhance_menu:{toolID:"auto_enhance",controlData:BFN.UIToolData.auto_enhance.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024860052",tutorialName:"AUTO_ENHANCE"},glow_menu:{toolID:"glow",controlData:BFN.UIToolData.glow.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024937192",tutorialName:"GLOW"},blur_edges_menu:{toolID:"blur_edges",controlData:BFN.UIToolData.blur_edges.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/210432543",tutorialName:"BLUR_EDGES"},smoothing_menu:{toolID:"smoothing",controlData:BFN.UIToolData.smoothing.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360025236791",tutorialName:"SMOOTHING"},soften_menu:{toolID:"soften",controlData:BFN.UIToolData.soften.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360024949252",tutorialName:"SOFTEN"},ai_image_menu:{toolID:"ai_image",menuName:BFN.UIToolData.ai_image.name,controlData:BFN.UIToolData.ai_image.controls,tutorialLink:"",tutorialName:"AI_IMAGE"},ai_portrait_menu:{toolID:"ai_portrait",menuName:BFN.UIToolData.ai_portrait.name,controlData:BFN.UIToolData.ai_portrait.controls,tutorialLink:"https://www.befunky.com/learn/ai-portrait-enhancer/",tutorialName:"AI_PORTRAIT"},hdr_dlx_menu:{toolID:"hdr_dlx",menuName:BFN.UIToolData.hdr_dlx.name,controlData:BFN.UIToolData.hdr_dlx.controls},sharpen_dlx_menu:{toolID:"sharpen_dlx",menuName:BFN.UIToolData.sharpen_dlx.name,controlData:BFN.UIToolData.sharpen_dlx.controls},vibrant_colors_dlx_menu:{toolID:"vibrant_colors_dlx",menuName:BFN.UIToolData.vibrant_colors_dlx.name,controlData:BFN.UIToolData.vibrant_colors_dlx.controls},denoise_dlx_menu:{toolID:"denoise_dlx",menuName:BFN.UIToolData.denoise_dlx.name,controlData:BFN.UIToolData.denoise_dlx.controls}},BFN.setupAdjustAndPaintMenu=function(e,t){if(!(t=t||document.getElementById(e)).hasClass("tool-menu")){var n=BFN.adjustAndPaintMenus[e];if(!n)throw new Error("Unable to find config for menu id = ".concat(e));BFN.UI.toolMenuAdjustAndPaint(t,n)}},BFN.touchupPaintMenus={perfectskin_menu:{toolID:"skin_heal",controlData:BFN.UIToolData.perfectskin.controls,helpClueID:"skin_heal"},wrinkles_menu:{toolID:"wrinkles",controlData:BFN.UIToolData.wrinkles.controls,helpClueID:"wrinkles"},bronzer_menu:{toolID:"bronzer",controlData:BFN.UIToolData.bronzer.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027463752",tutorialName:"BRONZER"},blush_menu:{toolID:"blush",controlData:BFN.UIToolData.blush.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027753471",tutorialName:"BLUSH"},flashspot_menu:{toolID:"flashspot",controlData:BFN.UIToolData.flashspot.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027789991",tutorialName:"FLASHSPOT"},mascara_menu:{toolID:"mascara",controlData:BFN.UIToolData.mascara.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/208497686",tutorialName:"MASCARA"},eye_color_menu:{toolID:"eye_color",controlData:BFN.UIToolData.eye_color.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027513812",tutorialName:"EYE_COLOR"},eye_brighten_menu:{toolID:"eye_brighten",controlData:BFN.UIToolData.eye_brighten.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027513812",tutorialName:"EYE_BRIGHTEN"},eyebrow_pencil_menu:{toolID:"eyebrow_pencil",controlData:BFN.UIToolData.eyebrow_pencil.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027513812",tutorialName:"EYEBROW_PENCIL"},fix_redeye_menu:{toolID:"fix_redeye",controlData:BFN.UIToolData.fix_redeye.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027513812",tutorialName:"FIX_REDEYE"},lipstick_menu:{toolID:"lipstick",controlData:BFN.UIToolData.lipstick.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/208497486",tutorialName:"LIPSTICK"},teeth_whiten_menu:{toolID:"teeth_whiten",controlData:BFN.UIToolData.teeth_whiten.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360027892191",tutorialName:"TEETH_WHITEN"},hair_color_menu:{toolID:"hair_color",controlData:BFN.UIToolData.hair_color.controls,tutorialLink:"https://support.befunky.com/hc/en-us/articles/360021913512",tutorialName:"HAIR_COLOR"}},BFN.setupTouchupPaintMenu=function(e,t){if(!(t=t||document.getElementById(e)).hasClass("tool-menu")){var n=BFN.touchupPaintMenus[e];if(!n)throw new Error("Unable to find config for menu id = ".concat(e));BFN.UI.toolMenuTouchupPaint(t,n),Object.keys(n.controlData).forEach(function(e){return UITools.registerControl(e)})}},window.setupShowMenuPanel=function(){window.showMenuPanel=function(t,n){n||(n="edit_layer"===BFN.activeMenuStateID?"edit_layer":BFN.AppModel.sectionID,BFN.activeMenuStateID=n);var h=BFN.mainMenuStates[n],d=o!==n||s!==t;if(o!==n&&u!==("edit_layer"===n)){u=!u;["editor_main_image_manager","editor_main_graphic","editor_main_text"].forEach(function(e){document.getElementById(e).setStyles({display:u?"none":""})})}switch(o=n,s=t,t){case"primary":(r.hasClass("open")||a.hasClass("open"))&&(BFN.MainUI.viewportUpdating||d||console.log("viewportUpdating set to true but never set to false",r.hasClass("open"),a.hasClass("open")),r.removeClass("open"),a.removeClass("open"),document.body.removeClass("app-side-menu-is-open"),BFN.MainUI.viewportUpdating=!0),h.secondary=null,h.tertiary=null;var m=document.getElementById(h.primary).querySelector(".active");m&&m.removeClass("active"),c(i);break;case"secondary":r.hasClass("open")||(r.addClass("open"),a.removeClass("open"),document.body.addClass("app-side-menu-is-open")),h.secondary=r.querySelector(".tool-menu.active").id,h.tertiary=null;var p,g=h.secondary.replace(/(editor_|collage_|designer_|_menu)/g,""),f=h.primary.split("_")[0];try{p=BFN.UIMenuData.mainMenus[f].find(function(e){var t=e.id;return t.includes("_".concat(g))}).id}catch(e){throw console.log({secondaryMenuName:g,primaryMenuName:f}),e}var v=document.getElementById(p);v&&!v.hasClass("active")&&(v.parentNode.querySelectorAll(".active").removeClass("active"),v.addClass("active")),c(document.getElementById(h.secondary));break;case"tertiary":a.hasClass("open")||(r.removeClass("open"),a.addClass("open"),document.body.addClass("app-side-menu-is-open")),h.secondary=r.querySelector(".tool-menu.active").id,h.tertiary=a.querySelector(".tool-menu.active").id,c(document.getElementById(h.tertiary))}if(BFN.HelpClueManager.handleSideMenuTransition(),d){var y={primary:BFN.CSS.leftMenuBarWidth,secondary:BFN.CSS.leftMenuBarWidth+BFN.CSS.sideMenuWidth,tertiary:BFN.CSS.leftMenuBarWidth+BFN.CSS.sideMenuWidth},x=BFN.getAppViewportLeftOffset(),_=y[t],I=Date.now();BFN.getAppViewportLeftOffset=function(){if(_===x)return _;var e=Date.now(),t=e-I;return t>=200?_:x+t/200*(_-x)},clearTimeout(e),x!==_&&(BFN.MainUI.viewportUpdating=!0,e=setTimeout(function(){requestAnimationFrame(function(){BFN.MainUI.viewportUpdating&&(BFN.MainUI.viewportUpdating=!1)})},200))}var T=BFN.mainMenuStates[BFN.activeMenuStateID],b=[T.primary,T.secondary,T.tertiary].filter(Boolean).map(function(e){return e.replace(/^(editor|collage|designer)_/,"").replace(/_menu$/,"")}),S="".concat(BFN.activeMenuStateID," > ").concat(b.join(" > "));if(S===l)return;l=S,window.Sentry&&Sentry.addBreadcrumb({category:"side_menu",message:S,level:Sentry.Severity.Info})};var e,t,n=document.getElementById("side_panel_menu_panels"),i=document.getElementById("primary-panel"),r=document.getElementById("secondary-panel"),a=document.getElementById("tertiary-panel"),o="editor",s="primary",l="",u=!1;function c(e){cancelIdleCallback(t),t=requestIdleCallback(function(){n.contains(document.activeElement)&&("DIV"!==e.nodeName||e.hasAttribute("tabindex")?e.focus():(e.setAttribute("tabindex","0"),e.focus(),e.addEventListener("blur",function t(){e.removeEventListener("blur",t),e.removeAttribute("tabindex")})))})}},window.rebuildAppVersion=8}!function t(){if(window.appBundleLoaded=!0,"undefined"!=typeof PIXI&&"undefined"!=typeof BeFunky&&"undefined"!=typeof BfnmaxImageSize)return window.BFN?BeFunky.logError("Not executing app bundle twice"):e();setTimeout(t,50)}()}();

//# sourceMappingURL=bundle.js.map
